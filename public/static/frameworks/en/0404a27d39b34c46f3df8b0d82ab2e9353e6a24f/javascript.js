SC.Animatable={isAnimatable:YES,transitions:{},concatenatedProperties:["transitions"],style:{},_cssTransitionFor:{left:"left",top:"top",right:"right",bottom:"bottom",width:"width",height:"height",opacity:"opacity",transform:"transform"},_styleProperties:["opacity","display","transform"],_layoutStyles:"width height top bottom marginLeft marginTop left right zIndex minWidth maxWidth minHeight maxHeight centerX centerY".w(),_animationsToStart:{},_animationOrder:["top","left","bottom","right","width","height","centerX","centerY","opacity","display","transform"],initMixin:function(){this._animatable_original_didCreateLayer=this.didCreateLayer||function(){};
this.didCreateLayer=this._animatable_didCreateLayer;this._animatable_original_willDestroyLayer=this.willDestroyLayer||function(){};
this.willDestroyLayer=this._animatable_willDestroyLayer;this._animatable_original_willRemoveFromParent=this.willRemoveFromParent||function(){};
this.willRemoveFromParent=this._animatable_will_remove_from_parent;this._animateTickPixel.displayName="animate-tick";
var e;if(SC.isArray(this.transitions)){var d={};for(e=0;e<this.transitions.length;
e++){SC.mixin(d,this.transitions[e])}this.transitions=d}for(e in this.transitions){if(typeof this.transitions[e]=="number"){this.transitions[e]={duration:this.transitions[e]}
}}this._animatableCurrentStyle=null;this._animators={};this._animatableSetCSS="";
this._last_transition_css="";this._disableAnimation=0;this._transitionCallbacks={};
if(!SC.none(this.get("layer"))){var g=this._animatable_original_didCreateLayer;this._animatable_original_didCreateLayer=function(){};
this.didCreateLayer();this._animatable_original_didCreateLayer=g}},_animatable_didCreateLayer:function(){this.resetAnimation();
SC.Event.add(this.get("layer"),"webkitTransitionEnd",this,this.transitionEnd);SC.Event.add(this.get("layer"),"transitionend",this,this.transitionEnd);
return this._animatable_original_didCreateLayer()},_animatable_willDestroyLayer:function(){SC.Event.remove(this.get("layer"),"webkitTransitionEnd",this,this.transitionEnd);
SC.Event.remove(this.get("layer"),"transitionend",this,this.transitionEnd);return this._animatable_original_willDestroyLayer()
},_animatable_will_remove_from_parent:function(){this.resetAnimation()},disableAnimation:function(){this._disableAnimation++
},enableAnimation:function(){this._disableAnimation--;if(this._disableAnimation<0){this._disableAnimation=0
}},adjust:function(o,p){if(!SC.none(p)){var s=o;o={};o[s]=p}else{o=SC.clone(o)}var d=SC.clone(this.get("style")),g=NO,l=SC.clone(this.get("layout")),e=NO;
var u=this._styleProperties;for(var j in o){var m=NO;var n=(u.indexOf(j)>=0)?d:l;
var h=n[j],k=o[j];if(k!==undefined&&h!==k){if(k===null){if(h!==undefined){m=YES}delete n[j]
}else{n[j]=k;m=YES}}if(m){if(n===d){g=YES}else{e=YES}}}if(g){this.set("style",d)}if(e){this.set("layout",l)
}return this},transitionEnd:function(d){SC.RunLoop.begin();var e=d.originalEvent.propertyName,g=this._transitionCallbacks[e];
if(g){SC.Animatable.runCallback(g)}SC.RunLoop.end()},getCurrentJavaScriptStyles:function(){return this._animatableCurrentStyle
},resetAnimation:function(){this._animatableCurrentStyle=null;this._stopJavaScriptAnimations();
this.disableAnimation();this.updateStyle();this.enableAnimation();this.updateStyle()
},_stopJavaScriptAnimations:function(){for(var d in this._animators){if(this._animators[d]&&this._animators[d].isQueued){SC.Animatable.removeTimer(this._animators[d])
}}},_getStartStyleHash:function(m,k){var j=this.layout;this.layout=m;var h=this.computeParentDimensions();
var g=this.computeFrameWithParentFrame(h);this.layout=j;var d={};for(var e in k){if(g){if(e=="left"){d[e]=g.x;
continue}else{if(e=="top"){d[e]=g.y;continue}else{if(e=="right"){d[e]=h.width-g.x-g.width;
continue}else{if(e=="bottom"){d[e]=h.height-g.y-g.height;continue}else{if(e=="width"){d[e]=g.width;
continue}else{if(e=="height"){d[e]=g.height;continue}else{if(e=="centerX"){d[e]=g.x+(g.width/2)-(h.width/2);
continue}else{if(e=="centerY"){d[e]=g.y+(g.height/2)-(h.height/2);continue}}}}}}}}}if(SC.none(d[e])){if(!SC.none(m[e])){d[e]=m[e]
}else{d[e]=k[e]}}}return d},_TMP_CSS_TRANSITIONS:[],cssTimingStringFor:function(g){var e="linear";
if(g.timing||SC.Animatable.defaultTimingFunction){var d=g.timing||SC.Animatable.defaultTimingFunction;
if(SC.typeOf(d)!=SC.T_STRING){e="cubic-bezier("+d[0]+", "+d[1]+", "+d[2]+", "+d[3]+")"
}else{e=d}}return e},updateStyle:function(){var G=this.get("layer");var u=this.get("style");
var p=NO,h="";if(SC.Animatable.enableCSSTransforms&&this.transitions.left&&this.transitions.top&&this.transitions.left.duration===this.transitions.top.duration&&this.transitions.left.timing===this.transitions.top.timing&&(SC.none(u.right)||u.right==="")&&(SC.none(u.bottom)||u.bottom==="")){p=YES;
this._useSpecialCaseTransform=YES}else{this._useSpecialCaseTransform=NO}var D;if(!this._animatableCurrentStyle||this._disableAnimation>0||!G){this._animatableSetCSS="";
this._animatableCurrentStyle={};for(D in u){if(D[0]!="_"){this._animatableCurrentStyle[D]=u[D]
}}if(G){this._animatableApplyStyles(G,u)}return this}if(!G){return}var s=true;for(D in u){if(D[0]=="_"){continue
}if(u[D]!=this._animatableCurrentStyle[D]){s=false;break}}if(s){return this}var g=this._getStartStyleHash(this._animatableCurrentStyle,u);
var j={};var y;var k=this._TMP_CSS_TRANSITIONS;if(SC.Animatable.enableCSSTransitions){var o;
if(p){p=YES;o=this.cssTimingStringFor(this.transitions.left);k.push("-webkit-transform "+this.transitions.left.duration+"s "+o)
}for(D in this.transitions){if(!this._cssTransitionFor[D]){continue}if(p&&(D=="left"||D=="top")){if(this.transitions.left.action){this._transitionCallbacks["-webkit-transform"]={source:this,target:(this.transitions.left.target||this),action:this.transitions.left.action}
}if(this.transitions.top.action){this._transitionCallbacks["-webkit-transform"]={source:this,target:(this.transitions.right.target||this),action:this.transitions.right.action}
}continue}o=this.cssTimingStringFor(this.transitions[D]);k.push(this._cssTransitionFor[D]+" "+this.transitions[D].duration+"s "+o)
}}for(D in u){if(D[0]=="_"){continue}var e=!this.transitions[D]||u[D]==g[D];if(D=="display"&&u[D]!="none"){e=true
}if(e){g[D]=u[D];var F=this._animators[D];if(F){F.endValue=u[D];F.end=0}continue}if(SC.Animatable.enableCSSTransitions&&this._cssTransitionFor[D]){j[D]=u[D];
if(this.transitions[D].action){this._transitionCallbacks[D]={source:this,target:(this.transitions[D].target||this),action:this.transitions[D].action}
}continue}var C=this._animateTickPixel,d=D,x=g[D],n=u[D];if(d=="centerX"||d=="centerY"){C=this._animateTickCenter
}else{if(d=="opacity"){C=this._animateTickNumber}else{if(d=="display"){C=this._animateTickDisplay
}}}if(!this._animators[D]){this._animators[D]={}}var E=this._animators[D];E.start=null;
E.duration=Math.floor(this.transitions[D].duration*1000);E.startValue=x;E.endValue=n;
E.layer=G;E.property=d;E.action=C;E.style=G.style;E.holder=this;if(this.transitions[D].action){E.callback={source:this,target:(this.transitions[D].target||this),action:this.transitions[D].action}
}y=this.transitions[D].timing||SC.Animatable.defaultTimingFunction;if(y&&SC.typeOf(y)!=SC.T_STRING){E.timingFunction=y
}if(!E.going){this._animationsToStart[D]=E}}var z=this._animationOrder,A=this._animationOrder.length;
for(D=0;D<A;D++){var B=z[D];if(this._animationsToStart[B]){SC.Animatable.addTimer(this._animationsToStart[B]);
delete this._animationsToStart[B]}}var m=k.join(",");k.length="";this._animatableSetCSS=m;
this._animatableApplyStyles(G,g,j);return this}.observes("style"),_style_opacity_helper:function(g,d,e){g.opacity=e.opacity;
g.mozOpacity=e.opacity;g.filter="alpha(opacity="+e.opacity*100+")"},_animatableApplyStyles:function(e,g,d){if(!e){return
}var j=NO;if(g.display&&e.style.display!==g.display){e.style.display=g.display;j=YES
}if(this._animatableSetCSS!=this._last_transition_css){e.style["-webkit-transition"]=this._animatableSetCSS;
e.style["-moz-transition"]=this._animatableSetCSS;this._last_transition_css=this._animatableSetCSS;
j=YES}if(!this._animators["display-styles"]){this._animators["display-styles"]={}
}var h=this._animators["display-styles"];h.holder=this;h.action=this._animatableApplyNonDisplayStylesFromTimer;
h.inLoopAction=this._animatableApplyNonDisplayStyles;h.layer=e;h.styles=g;h.delayed=d;
this._animatableCurrentStyle=g;if(this._disableAnimation>0){h.inLoopAction()}else{SC.Animatable.addTimer(h)
}},_animatableApplyNonDisplayStylesFromTimer:function(){SC.RunLoop.begin();this.inLoopAction();
SC.RunLoop.end()},_animatableApplyNonDisplayStyles:function(){var k=this.layer,o=this.holder._animatableCurrentStyle;
var g={opacity:this.holder._style_opacity_helper};var l={},p=NO,d=k.style;var m="";
for(var j in o){if(j=="display"){continue}if(this.holder._layoutStyles.indexOf(j)>=0){if(this.holder._useSpecialCaseTransform&&j==="left"){l[j]=0;
m+="translateX("+o[j]+"px) ";p=YES;continue}else{if(this.holder._useSpecialCaseTransform&&j==="top"){l[j]=0;
m+="translateY("+o[j]+"px) ";p=YES;continue}}l[j]=o[j];p=YES;continue}else{if(g[j]){g[j](d,j,o)
}else{d[j]=o[j]}}}if(m){d.webkitTransform=m}if(p){var e=this.holder.layout;this.holder.layout=l;
this.holder.notifyPropertyChange("layoutStyle");var h=this.holder.get("layoutStyle");
for(var n in h){if(SC.none(h[n])){d[n]=""}else{if(d[n]!=h[n]){d[n]=h[n]}}}this.holder.layout=e
}if(this.delayed){SC.mixin(this.holder._animatableCurrentStyle,this.delayed);this.styles=this.delayed;
this.delayed=undefined;if(this._disableAnimation>0){this.inLoopAction()}else{SC.Animatable.addTimer(this)
}}},updateLayout:function(g,d){var e=SC.clone(this.get("style"));var l=this.get("layout");
var h=0,j=this._layoutStyles,m=j.length,k=NO;for(h=0;h<m;h++){var n=j[h];if(e[n]!==l[n]){if(SC.none(l[n])){e[n]=undefined
}else{e[n]=l[n]}k=YES}}if(k){this.style=e;this.updateStyle()}return this},_solveBezierForT:function(e,z,s,p,k,h,u,j){var y=1/(200*j);
var o,n,m,g,d,l;for(m=u,l=0;l<8;l++){g=((e*m+s)*m+k)*m-u;if(Math.abs(g)<y){return m
}d=(3*e*m+2*s)*m+k;if(Math.abs(d)<Math.pow(10,-6)){break}m=m-g/d}o=0;n=1;m=u;if(m<o){return o
}if(m>n){return n}while(o<n){g=((e*m+s)*m+k)*m;if(Math.abs(g-u)<y){return m}if(u>g){o=m
}else{n=m}m=(n-o)*0.5+o}return m},_solveBezier:function(g,e,o,n,p,j){var k=3*g;var m=3*(o-g)-k;
var d=1-k-m;var h=3*e;var l=3*(n-e)-h;var u=1-h-l;var s=this._solveBezierForT(d,u,m,l,k,h,p,j);
return((u*s+l)*s+h)*s},_animateTickPixel:function(u){if(SC.none(this.start)){this.start=u;
this.end=this.start+this.duration}var x=this.start,k=this.end;var p=this.startValue,n=this.endValue;
var l=k-x;var h=n-p;var m=u-x;var j=Math.min(m/l,1);if(this.timingFunction){var g=this.timingFunction;
j=this.holder._solveBezier(g[0],g[1],g[2],g[3],j,l)}var o=Math.floor(p+(h*j));this.holder._animatableCurrentStyle[this.property]=o;
this.style[this.property]=o+"px";if(u<k){SC.Animatable.addTimer(this)}else{this.going=false;
if(this.callback){SC.Animatable.runCallback(this.callback)}this.styles=null;this.layer=null
}},_animateTickDisplay:function(d){if(SC.none(this.start)){this.start=d;this.end=this.start+this.duration
}var g=this.end;if(d<g){SC.Animatable.addTimer(this);return}this.holder._animatableCurrentStyle[this.property]=this.endValue;
this.style[this.property]=this.endValue;this.going=false;if(this.callback){SC.Animatable.runCallback(this.callback)
}this.styles=null;this.layer=null},_animateTickNumber:function(u){if(SC.none(this.start)){this.start=u;
this.end=this.start+this.duration}var x=this.start,k=this.end;var p=this.startValue,n=this.endValue;
var l=k-x;var h=n-p;var m=u-x;var j=Math.min(m/l,1);if(this.timingFunction){var g=this.timingFunction;
j=this.holder._solveBezier(g[0],g[1],g[2],g[3],j,l)}var o=Math.round((p+(h*j))*100)/100;
this.holder._animatableCurrentStyle[this.property]=o;this.style[this.property]=o;
if(this.property=="opacity"){this.style.zoom=1;this.style.filter="alpha(opacity="+Math.round(o*20)*5+")"
}if(u<k){SC.Animatable.addTimer(this)}else{this.going=false;if(this.callback){SC.Animatable.runCallback(this.callback)
}this.styles=null;this.layer=null}},_animateTickCenter:function(y){if(SC.none(this.start)){this.start=y;
this.end=this.start+this.duration}var z=this.start,l=this.end;var x=this.startValue,o=this.endValue;
var m=l-z;var j=o-x;var n=y-z;var k=Math.min(n/m,1);if(this.timingFunction){var h=this.timingFunction;
k=this.holder._solveBezier(h[0],h[1],h[2],h[3],k,m)}var u=x+(j*k);this.holder._animatableCurrentStyle[this.property]=u;
var p,g;if(this.property=="centerX"){p="width";g="marginLeft"}else{p="height";g="marginTop"
}this.style[g]=Math.round(u-(this.holder._animatableCurrentStyle[p]/2))+"px";if(y<l){SC.Animatable.addTimer(this)
}else{this.going=false;if(this.callback){SC.Animatable.runCallback(this.callback)
}this.styles=null;this.layer=null}}};SC.mixin(SC.Animatable,{NAMESPACE:"SC.Animatable",VERSION:"0.1.0",TRANSITION_NONE:"linear",TRANSITION_CSS_EASE:"ease",TRANSITION_CSS_EASE_IN:"ease-in",TRANSITION_CSS_EASE_OUT:"ease-out",TRANSITION_CSS_EASE_IN_OUT:"ease-in-out",TRANSITION_EASE:[0.25,0.1,0.25,1],TRANSITION_LINEAR:[0,0,1,1],TRANSITION_EASE_IN:[0.42,0,1,1],TRANSITION_EASE_OUT:[0,0,0.58,1],TRANSITION_EASE_IN_OUT:[0.42,0,0.58,1],defaultTimingFunction:null,baseTimer:{next:null},going:false,_ticks:0,_timer_start_time:null,interval:10,currentTime:new Date().getTime(),enableCSSTransitions:NO,enableCSSTransforms:NO,stats:SC.Object.create({lastFPS:0}),addTimer:function(d){if(d.isQueued){return
}d.prev=SC.Animatable.baseTimer;d.next=SC.Animatable.baseTimer.next;if(SC.Animatable.baseTimer.next){SC.Animatable.baseTimer.next.prev=d
}SC.Animatable.baseTimer.next=d;d.isQueued=true;if(!SC.Animatable.going){SC.Animatable.start()
}},removeTimer:function(d){if(!d.isQueued){return}if(d.next){d.next.prev=d.prev}d.prev.next=d.next;
d.isQueued=false},start:function(){SC.Animatable._ticks=0;SC.Animatable._timer_start_time=new Date().getTime();
SC.Animatable.going=true;setTimeout(function(){SC.Animatable.timeout()},SC.Animatable.interval)
},timeout:function(){SC.Animatable.currentTime=new Date().getTime();var m=SC.Animatable.currentTime;
var k=SC.Animatable.baseTimer.next;SC.Animatable.baseTimer.next=null;var j=0;while(k){var h=k.next;
k.isQueued=false;k.next=null;k.prev=null;k.action.call(k,m);k=h;j++}if(SC.Animatable._ticks<1000000){SC.Animatable._ticks++
}var g=new Date().getTime();var e=g-m;if(SC.Animatable.baseTimer.next){setTimeout(function(){SC.Animatable.timeout()
},Math.max(0,SC.Animatable.interval-e))}else{SC.Animatable.going=false;var l=g-SC.Animatable._timer_start_time;
var d=SC.RunLoop.begin();SC.Animatable.stats.set("lastFPS",SC.Animatable._ticks/(l/1000));
d.end()}},runCallback:function(k){var d=SC.typeOf(k.action);if(d==SC.T_FUNCTION){k.action.call(k.target,k.source)
}else{if(d===SC.T_STRING){if(k.action.indexOf(".")>=0){var j=k.action.split(".");
var g=j.pop();var h=SC.objectForPropertyPath(j,window);var e=h.get?h.get(g):h[g];
if(e&&SC.typeOf(e)==SC.T_FUNCTION){e.call(h,k.source)}else{throw"SC.Animator could not find a function at %@".fmt(k.action)
}}else{SC.RootResponder.responder.sendAction(k.action,k.target,k.source)}}}}});(function(){var k=NO,l=NO;
var h=document.createElement("div");var j=["-webkit-","-moz-","-o-","-ms-"];var d=["moz","Moz","o","ms","webkit"];
var g="",e=null;for(e=0;e<j.length;e++){g+=j[e]+"transition:all 1s linear;";g+=j[e]+"transform: translate3d(1px, 1px, 1px)"
}h.style.cssText=g;for(e=0;e<d.length;e++){if(h.style[d[e]+"TransitionProperty"]!==undefined){l=YES
}if(h.style[d[e]+"Transform"]!==undefined){k=YES}}SC.Animatable.enableCSSTransitions=l;
SC.Animatable.enableCSSTransforms=k})();var view,base,inherited,pane,computed;module("Animatable",{setup:function(){SC.RunLoop.begin();
pane=SC.Pane.create({layout:{top:0,right:0,width:200,height:200}});pane.append();
view=SC.View.create(SC.Animatable,{layout:{left:100,top:100,height:100,width:100},style:{opacity:0.5},transitions:{left:0.25,top:{duration:0.35},width:{duration:0.2,timing:SC.Animatable.TRANSITION_EASE_IN_OUT},style:{opacity:1}}});
pane.appendChild(view);base=SC.View.extend(SC.Animatable,{layout:{left:100,top:100,height:100,width:100},transitions:{left:0.25,top:{duration:0.35},width:{duration:0.2,timing:SC.Animatable.TRANSITION_EASE_IN_OUT}}});
inherited=base.create({transitions:{left:0.99}});computed=base.create({_test_left:5,layout:function(){return{left:this._test_left,top:5,width:50,height:50}
}.property("_test_left").cacheable()});SC.RunLoop.end()}});test("animatable should have init-ed correctly",function(){var g=view.transitions.left;
var e=view.transitions.top;var d=view.transitions.width;equals(g.duration,0.25,"left duration is .25");
equals(e.duration,0.35,"top duration is .35");equals(d.duration,0.2,"width duration is .2");
equals(g.timing,undefined,"No timing for left.");equals(e.timing,undefined,"No timing for top.");
equals(d.timing,SC.Animatable.TRANSITION_EASE_IN_OUT,"SC.Animatable.TRANSITION_EASE_IN_OUT for width.")
});test("animatable should handle concatenated transitions properly",function(){var g=inherited.transitions.left;
var e=inherited.transitions.top;var d=inherited.transitions.width;equals(g.duration,0.99,"left duration is .99 (the overridden value)");
equals(e.duration,0.35,"top duration is .35");equals(d.duration,0.2,"width duration is .2");
equals(g.timing,undefined,"No timing for left.");equals(e.timing,undefined,"No timing for top.");
equals(d.timing,SC.Animatable.TRANSITION_EASE_IN_OUT,"SC.Animatable.TRANSITION_EASE_IN_OUT for width.")
});test("animatable handler for layer update should ensure both layout and styles are set in the 'current style'.",function(){var e=SC.Animatable.enableCSSTransitions;
SC.Animatable.enableCSSTransitions=NO;var d=view.getCurrentJavaScriptStyles();ok(!SC.none(d),"There now SHOULD be a current JS style.");
equals(d.opacity,0.5,"opacity should be .5");equals(d.left,100,"left should be 100");
SC.Animatable.enableCSSTransitions=e});test("animatable callbacks work in general",function(){SC.RunLoop.begin();
view.transitions.left={duration:0.25,action:function(){start();ok(true,"Callback was called.")
}};view.updateLayout();view.adjust("left",0).updateLayout();SC.RunLoop.end();stop();
setTimeout(function(){start();ok(false,"Timeout! Callback was not called.")},1000)
});test("animation should not interfere with layout property observers or frame",function(){SC.RunLoop.begin();
equals(view.get("layout").left,100,"layout left before adjust");equals(view.get("frame").x,100,"frame x before adjust");
view.adjust("left",0).updateLayout();equals(view.get("layout").left,0,"layout left after adjust");
equals(view.get("frame").x,0,"frame x after adjust");SC.RunLoop.end()});test("animation should not interfere with computed layout properties.",function(){equals(computed.get("layout").left,5,"layout left before change and animation");
computed.adjust("left",20);equals(computed.get("layout").left,5,"layout left after change (shouldn't change)");
computed.updateLayout();equals(computed.get("layout").left,5,"layout left after updateLayout");
computed.set("_test_left",21);equals(computed.get("layout").left,21,"layout left after setting _test_left (make sure computed property is undisturbed)")
});var SC=SC||{BUNDLE_INFO:{},LAZY_INSTANTIATION:{}};SC.browser=(function(){var g=navigator.userAgent.toLowerCase();
var d=(g.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1];var e={version:d,safari:(/webkit/).test(g)?d:0,opera:(/opera/).test(g)?d:0,msie:(/msie/).test(g)&&!(/opera/).test(g)?d:0,mozilla:(/mozilla/).test(g)&&!(/(compatible|webkit)/).test(g)?d:0,mobileSafari:(/apple.*mobile.*safari/).test(g)?d:0,chrome:(/chrome/).test(g)?d:0,windows:!!(/(windows)/).test(g),mac:!!((/(macintosh)/).test(g)||(/(mac os x)/).test(g)),language:(navigator.language||navigator.browserLanguage).split("-",1)[0]};
e.current=e.msie?"msie":e.mozilla?"mozilla":e.safari?"safari":e.opera?"opera":"unknown";
return e})();SC.bundleDidLoad=function(d){var e=this.BUNDLE_INFO[d];if(!e){e=this.BUNDLE_INFO[d]={}
}e.loaded=true};SC.bundleIsLoaded=function(d){var e=this.BUNDLE_INFO[d];return e?!!e.loaded:false
};SC.loadBundle=function(){throw"SC.loadBundle(): SproutCore is not loaded."};SC.setupBodyClassNames=function(){var j=document.body;
if(!j){return}var g,d,k,e,l,h;g=SC.browser.current;d=SC.browser.windows?"windows":SC.browser.mac?"mac":"other-platform";
h=document.documentElement.style;k=(h.MozBoxShadow!==undefined)||(h.webkitBoxShadow!==undefined)||(h.oBoxShadow!==undefined)||(h.boxShadow!==undefined);
e=(h.MozBorderRadius!==undefined)||(h.webkitBorderRadius!==undefined)||(h.oBorderRadius!==undefined)||(h.borderRadius!==undefined);
l=j.className?j.className.split(" "):[];if(k){l.push("box-shadow")}if(e){l.push("border-rad")
}l.push(g);l.push(d);if(parseInt(SC.browser.msie,0)==7){l.push("ie7")}if(SC.browser.mobileSafari){l.push("mobile-safari")
}j.className=l.join(" ")};CoreTools=SC.Object.create({NAMESPACE:"CoreTools",VERSION:"1.0.0"});
CoreTools.DataSource=SC.DataSource.extend({fetch:function(d,g){var e=NO;switch(g.get("recordType")){case CoreTools.Target:e=this.fetchTargets(d,g);
break;case CoreTools.Test:e=this.fetchTests(d,g);break}return e},fetchTargets:function(d,e){if(!e.get("isRemote")){return NO
}SC.Request.getUrl("/sc/targets.json").set("isJSON",YES).notify(this,"fetchTargetsDidComplete",{query:e,store:d}).send();
return YES},fetchTargetsDidComplete:function(j,h){var e=j.get("response"),k=h.query,d=h.store,g;
if(!SC.$ok(e)){console.error("TODO: Add handler when fetching targets fails")}else{g=d.loadRecords(CoreTools.Target,e);
d.loadQueryResults(k,g)}},fetchTests:function(d,g){var e=g.get("url");if(!g.get("isRemote")||!e){return NO
}SC.Request.getUrl(e).set("isJSON",YES).notify(this,"fetchTestsDidComplete",{query:g,store:d}).send();
return YES},fetchTestsDidComplete:function(j,h){var e=j.get("response"),d=h.store,k=h.query,g;
if(!SC.$ok(e)){console.error("TODO: Add handler when fetching tests fails")}else{g=d.loadRecords(CoreTools.Test,e);
d.loadQueryResults(k,g)}}});SC.stringsFor("English",{});sc_require("models/target");
CoreTools.Target.FIXTURES=[{name:"/sample_controls",kind:"app",link_docs:"/static/sample_controls/en/current/docs/-index.json",link_root:"/static/sample_controls",link_tests:"/static/sample_controls/en/current/tests/-index.json",parent:""},{name:"/twitter",kind:"app",link_docs:"/static/twitter/en/current/docs/-index.json",link_root:"/static/twitter",link_tests:"/static/twitter/en/current/tests/-index.json",parent:""},{name:"/sproutcore",kind:"framework",link_docs:"/static/sproutcore/en/current/docs/-index.json",link_root:"/static/sproutcore",link_tests:"/static/sproutcore/en/current/tests/-index.json",parent:""},{name:"/sproutcore/foundation",kind:"framework",link_docs:"/static/sproutcore/foundation/en/current/docs/-index.json",link_root:"/static/sproutcore/foundation",link_tests:"/static/sproutcore/foundation/en/current/tests/-index.json",parent:"/sproutcore"},{name:"/sproutcore/datastore",kind:"framework",link_docs:"/static/sproutcore/datastore/en/current/docs/-index.json",link_root:"/static/sproutcore/datastore",link_tests:"/static/sproutcore/datastore/en/current/tests/-index.json",parent:"/sproutcore"},{name:"/sproutcore/desktop",kind:"framework",link_docs:"/static/sproutcore/desktop/en/current/docs/-index.json",link_root:"/static/sproutcore/desktop",link_tests:"/static/sproutcore/desktop/en/current/tests/-index.json",parent:"/sproutcore"},{name:"/sproutcore/runtime",kind:"framework",link_docs:"/static/sproutcore/runtime/en/current/docs/-index.json",link_root:"/static/sproutcore/runtime",link_tests:"/static/sproutcore/runtime/en/current/tests/-index.json",parent:"/sproutcore"},{name:"/sproutcore/welcome",kind:"app",link_docs:"/static/sproutcore/welcome/en/current/docs/-index.json",link_root:"/static/sproutcore/welcome",link_tests:"/static/sproutcore/welcome/en/current/tests/-index.json",parent:"/sproutcore"},{name:"/sproutcore/tests",kind:"app",link_docs:"/static/sproutcore/tests/en/current/docs/-index.json",link_root:"/static/sproutcore/tests",link_tests:"/static/sproutcore/tests/en/current/tests/-index.json",parent:"/sproutcore"}];
sc_require("models/test");CoreTools.Test.FIXTURES=[{url:"/static/sproutcore/runtime/en/current/tests/core/beget.html",filename:"tests/core/beget"},{url:"/static/sproutcore/runtime/en/current/tests/core/clone.html",filename:"tests/core/clone"},{url:"/static/sproutcore/runtime/en/current/tests/core/compare.html",filename:"tests/core/compare"},{url:"/static/sproutcore/runtime/en/current/tests/core/console.html",filename:"tests/core/console"},{url:"/static/sproutcore/runtime/en/current/tests/core/guidFor.html",filename:"tests/core/guidFor"},{url:"/static/sproutcore/runtime/en/current/tests/core/inspect.html",filename:"tests/core/inspect"},{url:"/static/sproutcore/runtime/en/current/tests/core/isArray.html",filename:"tests/core/isArray"},{url:"/static/sproutcore/runtime/en/current/tests/core/IsEqual.html",filename:"tests/core/IsEqual"},{url:"/static/sproutcore/runtime/en/current/tests/core/itemType.html",filename:"tests/core/itemType"},{url:"/static/sproutcore/runtime/en/current/tests/core/keys.html",filename:"tests/core/keys"},{url:"/static/sproutcore/runtime/en/current/tests/core/makeArray.html",filename:"tests/core/makeArray"}];
CoreTools.Target=SC.Record.extend({primaryKey:"name",name:SC.Record.attr(String),parent:SC.Record.toOne("CoreTools.Target"),testsUrl:SC.Record.attr(String,{key:"link_tests"}),appUrl:function(){return(this.get("kind")==="app")?this.get("name"):null
}.property("kind","name").cacheable(),isExpanded:SC.Record.attr(Boolean,{defaultValue:NO}),children:function(){var d=this.get("store"),g=CoreTools.TARGETS_QUERY,e=d.find(g).filterProperty("parent",this);
if(e){e=e.sortProperty("kind","displayName")}return(e&&e.get("length")>0)?e:null}.property().cacheable(),displayName:function(){var d=(this.get("name")||"(unknown)").split("/");
return d[d.length-1]}.property("name").cacheable(),targetIcon:function(){var d="sc-icon-document-16";
switch(this.get("kind")){case"framework":d="sc-icon-folder-16";break;case"app":d="sc-icon-options-16";
break}return d}.property("kind").cacheable(),sortKind:function(){if(this.get("name")==="/sproutcore"){return null
}var d=this.get("parent");if(d&&(d.get("name")==="/sproutcore")){return"sproutcore"
}else{return(this.get("kind")||"unknown").toLowerCase()}}.property("kind","parent").cacheable(),testsQuery:function(){return SC.Query.remote(CoreTools.Test,{url:this.get("testsUrl")})
}.property("testsUrl").cacheable(),tests:function(){return this.get("store").find(this.get("testsQuery"))
}.property("testsQuery").cacheable()});CoreTools.TARGETS_QUERY=SC.Query.remote(CoreTools.Target);
CoreTools.Test=SC.Record.extend({primaryKey:"url",filename:SC.Record.attr(String),url:SC.Record.attr(String),displayName:function(){return(this.get("filename")||"").replace(/^tests\//,"")
}.property("filename").cacheable(),icon:"sc-icon-document-16",isRunnable:YES});sc_require("data_sources/data_source");
SC.CascadeDataSource=SC.DataSource.extend({dataSources:null,from:function(d){var e=this.get("dataSources");
if(!e){this.set("dataSources",e=[])}e.push(d);return this},fetch:function(g,l){var j=this.get("dataSources"),e=j?j.length:0,h=NO,m,k,d;
for(d=0;(h!==YES)&&d<e;d++){k=j.objectAt(d);m=k.fetch?k.fetch.call(k,g,l):NO;h=this._handleResponse(h,m)
}return h},retrieveRecords:function(g,k){var j=this.get("dataSources"),e=j?j.length:0,h=NO,m,l,d;
for(d=0;(h!==YES)&&d<e;d++){l=j.objectAt(d);m=l.retrieveRecords.call(l,g,k);h=this._handleResponse(h,m)
}return h},commitRecords:function(n,g,l,h){var e=this.get("dataSources"),j=e?e.length:0,k=NO,o,d,m;
for(m=0;(k!==YES)&&m<j;m++){d=e.objectAt(m);o=d.commitRecords.call(d,n,g,l,h);k=this._handleResponse(k,o)
}return k},cancel:function(g,k){var j=this.get("dataSources"),e=j?j.length:0,h=NO,m,l,d;
for(d=0;(h!==YES)&&d<e;d++){l=j.objectAt(d);m=l.cancel.call(l,g,k);h=this._handleResponse(h,m)
}return h},init:function(){arguments.callee.base.apply(this,arguments);var e=this.get("dataSources"),d=e?e.get("length"):0,g;
while(--d>=0){g=e[d];if(SC.typeOf(g)===SC.T_STRING){e[d]=this.get(g)}}},_handleResponse:function(e,d){if(d===YES){return YES
}else{if(e===NO){return(d===NO)?NO:SC.MIXED_STATE}else{return SC.MIXED_STATE}}}});
SC.DataSource=SC.Object.extend({fetch:function(d,e){return NO},retrieveRecords:function(d,g,e){return this._handleEach(d,g,this.retrieveRecord,e)
},commitRecords:function(g,e,l,k,m){var h,j,d;if(e.length>0){h=this.createRecords.call(this,g,e,m)
}if(l.length>0){j=this.updateRecords.call(this,g,l,m)}if(k.length>0){d=this.destroyRecords.call(this,g,k,m)
}return((h===j)&&(h===d))?h:SC.MIXED_STATE},cancel:function(d,e){return NO},updateRecords:function(d,e,g){return this._handleEach(d,e,this.updateRecord,null,g)
},createRecords:function(d,e,g){return this._handleEach(d,e,this.createRecord,null,g)
},destroyRecords:function(d,e,g){return this._handleEach(d,e,this.destroyRecord,null,g)
},_handleEach:function(l,h,g,d,e){var j=h.length,m,k,n,o;if(!d){d=[]}for(m=0;m<j;
m++){o=d[m]?d[m]:e;n=g.call(this,l,h[m],o,e);if(k===undefined){k=n}else{if(k===YES){k=(n===YES)?YES:SC.MIXED_STATE
}else{if(k===NO){k=(n===NO)?NO:SC.MIXED_STATE}}}}return k?k:null},updateRecord:function(d,e,g){return NO
},retrieveRecord:function(d,e,g){return NO},createRecord:function(d,e,g){return NO
},destroyRecord:function(d,e,g){return NO}});sc_require("data_sources/data_source");
sc_require("models/record");SC.FixturesDataSource=SC.DataSource.extend({simulateRemoteResponse:NO,latency:50,cancel:function(d,e){return NO
},fetch:function(d,e){if(e.get("location")!==SC.Query.LOCAL){throw SC.$error("SC.Fixture data source can only fetch local queries")
}if(!e.get("recordType")&&!e.get("recordTypes")){throw SC.$error("SC.Fixture data source can only fetch queries with one or more record types")
}if(this.get("simulateRemoteResponse")){this.invokeLater(this._fetch,this.get("latency"),d,e)
}else{this._fetch(d,e)}},_fetch:function(d,g){var h=g.get("recordType"),e=g.get("recordTypes")||[h];
e.forEach(function(j){if(SC.typeOf(j)===SC.T_STRING){j=SC.objectForPropertyPath(j)
}if(j){this.loadFixturesFor(d,j)}},this);d.dataSourceDidFetchQuery(g)},retrieveRecords:function(d,g){var h=this.get("latency"),e=this.hasFixturesFor(g);
if(!e){return e}if(this.get("simulateRemoteResponse")){this.invokeLater(this._retrieveRecords,h,d,g)
}else{this._retrieveRecords(d,g)}return e},_retrieveRecords:function(d,e){e.forEach(function(h){var g=[],l=SC.Store.recordTypeFor(h),k=d.idFor(h),j=this.fixtureForStoreKey(d,h);
g.push(h);d.dataSourceDidComplete(h,j,k)},this)},updateRecords:function(d,g,j){var h=this.get("latency"),e=this.hasFixturesFor(g);
if(!e){return e}if(this.get("simulateRemoteResponse")){this.invokeLater(this._updateRecords,h,d,g)
}else{this._updateRecords(d,g)}return e},_updateRecords:function(d,e){e.forEach(function(g){var h=d.readDataHash(g);
this.setFixtureForStoreKey(d,g,h);d.dataSourceDidComplete(g)},this)},createRecords:function(d,e,h){var g=this.get("latency");
if(this.get("simulateRemoteResponse")){this.invokeLater(this._createRecords,g,d,e)
}else{this._createRecords(d,e)}return YES},_createRecords:function(d,e){e.forEach(function(j){var l=d.idFor(j),k=d.recordTypeFor(j),h=d.readDataHash(j),g=this.fixturesFor(k);
if(!l){l=this.generateIdFor(k,h,d,j)}this._invalidateCachesFor(k,j,l);g[l]=h;d.dataSourceDidComplete(j,null,l)
},this)},destroyRecords:function(d,g,j){var h=this.get("latency"),e=this.hasFixturesFor(g);
if(!e){return e}if(this.get("simulateRemoteResponse")){this.invokeLater(this._destroyRecords,h,d,g)
}else{this._destroyRecords(d,g)}return e},_destroyRecords:function(d,e){e.forEach(function(h){var k=d.idFor(h),j=d.recordTypeFor(h),g=this.fixturesFor(j);
this._invalidateCachesFor(j,h,k);if(k){delete g[k]}d.dataSourceDidDestroy(h)},this)
},loadFixturesFor:function(d,l,g){var e=[],j,h,k;j=this.fixturesFor(l);for(h in j){k=l.storeKeyFor(h);
if(d.peekStatus(k)===SC.Record.EMPTY){e.push(j[h])}if(g){g.push(k)}}if(e&&e.length>0){d.loadRecords(l,e)
}return this},generateIdFor:function(h,e,d,g){return"@id%@".fmt(SC.Store.generateStoreKey())
},fixtureForStoreKey:function(d,g){var j=d.idFor(g),h=d.recordTypeFor(g),e=this.fixturesFor(h);
return e?e[j]:null},setFixtureForStoreKey:function(d,h,g){var k=d.idFor(h),j=d.recordTypeFor(h),e=this.fixturesFor(j);
this._invalidateCachesFor(j,h,k);e[k]=g;return this},fixturesFor:function(m){if(!this._fixtures){this._fixtures={}
}var k=this._fixtures[SC.guidFor(m)];if(k){return k}var j=m?m.FIXTURES:null,e=j?j.length:0,g=m?m.prototype.primaryKey:"guid",d,h,l;
this._fixtures[SC.guidFor(m)]=k={};for(d=0;d<e;d++){h=j[d];l=h[g];if(!l){l=this.generateIdFor(m,h)
}k[l]=h}return k},fixturesLoadedFor:function(g){if(!this._fixtures){return NO}var d=[],e=this._fixtures[SC.guidFor(g)];
return e?YES:NO},hasFixturesFor:function(e){var d=NO;e.forEach(function(h){if(d!==SC.MIXED_STATE){var j=SC.Store.recordTypeFor(h),g=j?j.FIXTURES:null;
if(g&&g.length&&g.length>0){if(d===NO){d=YES}}else{if(d===YES){d=SC.MIXED_STATE}}}},this);
return d},_invalidateCachesFor:function(h,e,g){var d=this._storeKeyCache;if(d){delete d[SC.guidFor(h)]
}return this}});SC.Record.fixtures=SC.FixturesDataSource.create();var json0_9=[{type:"Author",guid:"4995bc653acad",fullName:"Trecia Williamson 4",bookTitle:"The Death Doors",address:" UC Santa Cruz, 35 First St, Wichita, KS"},{type:"Author",guid:"4995bc653acfe",fullName:"Jarrod Schreckengost 1",bookTitle:"The Fear of the Thieves",address:" Michigan State University, 285 Lazaneo St, Ann Arbor, MI"},{type:"Author",guid:"4995bc653ad23",fullName:"Colbert Ward 3",bookTitle:"The Menace Myth",address:" College University, 351 Van Ness Blvd, London, UK"},{type:"Author",guid:"4995bc653ad43",fullName:"Kurtis Hall 3",bookTitle:"The Creature of Madness",address:" MIT, 122 Fifth Ave, Santa Clara, CA"},{type:"Author",guid:"4995bc653ad56",fullName:"Marilyn Bellinger 2",bookTitle:"The Fear of the Gods",address:" New York University, 438 Dana St, Southampton, UK"},{type:"Author",guid:"4995bc653ad6b",fullName:"Annalisa Butt 1",bookTitle:"The Planet of Horror",address:" Foothill College, 146 Bloom St, Los Angeles, CA"},{type:"Author",guid:"4995bc653ad7f",fullName:"Jesse Robinson 4",bookTitle:"The Ice of Madness",address:" Michigan State University, 153 Broadway Blvd, Los Angeles, CA"},{type:"Author",guid:"4995bc653ad93",fullName:"Zilla Fea 4",bookTitle:"The Time of the Reign",address:" Stanford University, 309 Van Ness Blvd, Wichita, KS"},{type:"Author",guid:"4995bc653adad",fullName:"Milburn Holdeman 2",bookTitle:"The Jaws of Night",address:" Michigan State University, 236 Elm St, St. Louis, MO"},{type:"Author",guid:"4995bc653adc4",fullName:"Martina Read 4",bookTitle:"The Fear of the Spiders",address:" London University, 142 Castro St, London, UK"}];
var json10_19=[{type:"Author",guid:"4995bc653ade7",fullName:"Gallagher Burch 1",bookTitle:"The Day of Time",address:" CalTech, 92 Main St, San Francisco, CA"},{type:"Author",guid:"4995bc653ae03",fullName:"Sorrel Dugmore 3",bookTitle:"The Madness of the History",address:" MIT, 120 Dana St, Los Angeles, CA"},{type:"Author",guid:"4995bc653ae17",fullName:"Pamila Blois 3",bookTitle:"The Ultimate Resurrection",address:" Michigan State University, 262 Fifth Ave, Cupertino, CA"},{type:"Author",guid:"4995bc653ae2d",fullName:"Jessamyn Graff 4",bookTitle:"The Fear of the Key",address:" Foothill College, 442 Main St, Cupertino, CA"},{type:"Author",guid:"4995bc653ae43",fullName:"Camden Whiteman 4",bookTitle:"The Doomed Monster",address:" UC Santa Cruz, 64 University Loop, St. Louis, MO"},{type:"Author",guid:"4995bc653ae64",fullName:"Eldon Ream 1",bookTitle:"The Impossible Herald",address:" London University, 32 Dana St, New York, NY"},{type:"Author",guid:"4995bc653ae78",fullName:"Erskine Aultman 2",bookTitle:"The Thief",address:" University of Southampton, 101 Oak Ave, Ann Arbor, MI"},{type:"Author",guid:"4995bc653ae8c",fullName:"Missie Marjorie 4",bookTitle:"The Warrior of Horror",address:" Springfield University, 452 Lazaneo St, London, UK"},{type:"Author",guid:"4995bc653ae9f",fullName:"Lonnie Linton 3",bookTitle:"The Time of the Dead",address:" Harvard, 140 Castro St, Cupertino, CA"},{type:"Author",guid:"4995bc653aeba",fullName:"Lesley Sanforth 4",bookTitle:"The Underworld",address:" New York University, 43 Fifth Ave, Southampton, UK"}];
var json20_29=[{type:"Author",guid:"4995bc653aecc",fullName:"Alton Saline 4",bookTitle:"The Horror Secret",address:" Santa Clara University, 431 Main St, Seattle, WA"},{type:"Author",guid:"4995bc653aee2",fullName:"Homer Sandys 2",bookTitle:"The Day Seeds",address:" Stanford University, 75 First St, Wichita, KS"},{type:"Author",guid:"4995bc653aef6",fullName:"Katherine Hozier 3",bookTitle:"The Dominators",address:" Stanford University, 348 Broadway Blvd, Seattle, WA"},{type:"Author",guid:"4995bc653af0a",fullName:"Lavone Baxter 2",bookTitle:"The Bride of Day",address:" Foothill College, 34 Bloom St, Cambridge, MA"},{type:"Author",guid:"4995bc653af24",fullName:"Hailey Berkheimer 3",bookTitle:"The Long Machine",address:" Santa Clara University, 47 Broadway Blvd, San Francisco, CA"},{type:"Author",guid:"4995bc653af3b",fullName:"Shanelle Fry 2",bookTitle:"The Enemies of Fear",address:" Foothill College, 323 Van Ness Blvd, Southampton, UK"},{type:"Author",guid:"4995bc653af5e",fullName:"Booker Earl 2",bookTitle:"The Fury Doors",address:" Harvard, 180 Castro St, Cambridge, MA"},{type:"Author",guid:"4995bc653af72",fullName:"Emery Cavalet 2",bookTitle:"The Inferno",address:" Stanford University, 430 Dana St, St. Louis, MO"},{type:"Author",guid:"4995bc653af86",fullName:"Robynne Unk 3",bookTitle:"The Fear Memories",address:" Foothill College, 343 Lazaneo St, Santa Clara, CA"},{type:"Author",guid:"4995bc653af9a",fullName:"Lyssa Ashbaugh 1",bookTitle:"The Angels",address:" Harvard, 42 First St, Palo Alto, CA"}];
var json30_39=[{type:"Author",guid:"4995bc653afb5",fullName:"Rolph Burris 3",bookTitle:"Dreams of Menace",address:" Springfield University, 256 Fifth Ave, Southampton, UK"},{type:"Author",guid:"4995bc653afcb",fullName:"Sheree Kiefer 1",bookTitle:"The Doom of the Night",address:" Michigan State University, 432 Dana St, Palo Alto, CA"},{type:"Author",guid:"4995bc653afde",fullName:"Shaun Drabble 2",bookTitle:"The Future Creatures",address:" Springfield University, 388 Fifth Ave, Los Angeles, CA"},{type:"Author",guid:"4995bc653aff4",fullName:"Melvyn Stafford 1",bookTitle:"The Fury of the Runaway",address:" New York University, 252 Dana St, Southampton, UK"},{type:"Author",guid:"4995bc653b008",fullName:"Alfreda Rahl 3",bookTitle:"The Time of the Enemies",address:" CalTech, 13 Bloom St, Los Angeles, CA"},{type:"Author",guid:"4995bc653b022",fullName:"Auberon Coughenour 1",bookTitle:"The Horror of the Rock",address:" MIT, 429 Bloom St, Cambridge, MA"},{type:"Author",guid:"4995bc653b043",fullName:"Clitus Mccallum 2",bookTitle:"The Horror Dead",address:" Springfield University, 121 Bloom St, Palo Alto, CA"},{type:"Author",guid:"4995bc653b05f",fullName:"Jackie Munson 4",bookTitle:"Seed of Day",address:" Stanford University, 232 Oak Ave, San Francisco, CA"},{type:"Author",guid:"4995bc653b075",fullName:"Kerri Mayers 3",bookTitle:"The Madness of the Fear",address:" Foothill College, 443 Lazaneo St, Southampton, UK"},{type:"Author",guid:"4995bc653b08a",fullName:"Lyric Richards 3",bookTitle:"The Horror Dead",address:" Michigan State University, 391 Van Ness Blvd, London, UK"}];
var json40_49=[{type:"Author",guid:"4995bc653b09f",fullName:"Marci Caesar 1",bookTitle:"The Seventh Child",address:" College University, 469 Dana St, London, UK"},{type:"Author",guid:"4995bc653b0b7",fullName:"Jade Sloan 4",bookTitle:"The Menace of the Seas",address:" UC Santa Cruz, 295 Van Ness Blvd, Cambridge, MA"},{type:"Author",guid:"4995bc653b0cf",fullName:"Leyton Jyllian 2",bookTitle:"The Foe",address:" Stanford University, 419 University Loop, St. Louis, MO"},{type:"Author",guid:"4995bc653b11d",fullName:"Janette Koepple 2",bookTitle:"The Arc of Day",address:" Springfield University, 57 Main St, Wichita, KS"},{type:"Author",guid:"4995bc653b136",fullName:"Thea Sullivan 4",bookTitle:"Suns of Doom",address:" Michigan State University, 115 First St, Cupertino, CA"},{type:"Author",guid:"4995bc653b14a",fullName:"Caileigh Todd 3",bookTitle:"The Horror Leisure",address:" UC Santa Cruz, 330 First St, London, UK"},{type:"Author",guid:"4995bc653b15f",fullName:"Melvin Wilkerson 1",bookTitle:"The Menace Alien",address:" University of Southampton, 490 Elm St, Wichita, KS"},{type:"Author",guid:"4995bc653b173",fullName:"Leyton Jyllian 4",bookTitle:"The Assassin of Fear",address:" Harvard, 60 Elm St, Palo Alto, CA"},{type:"Author",guid:"4995bc653b187",fullName:"Sloane Moulton 1",bookTitle:"The Crater of Horror",address:" University of Southampton, 272 Broadway Blvd, New York, NY"},{type:"Author",guid:"4995bc653b19b",fullName:"Tamsen Newton 3",bookTitle:"The Long Crater",address:" Harvard, 420 Second St, St. Louis, MO"}];
var MyApp;var StandardTestSetup={setup:function(){MyApp=SC.Object.create({store:SC.Store.create()});
MyApp.Author=SC.Record.extend({isCylon:function(){switch(this.get("fullName")){case"Saul Tigh":case"Galen Tyrol":return YES;
default:return NO}}.property("fullName").cacheable()});return this},loadRecords:function(){function e(k){var j=[],h=k.length,g;
for(g=0;g<h;g++){j[g]=SC.clone(k[g])}return j}MyApp.store.loadRecords(e(json0_9),MyApp.Author);
MyApp.store.loadRecords(e(json10_19),MyApp.Author,"guid");var d=[MyApp.Author,MyApp.Author,MyApp.Author,MyApp.Author,MyApp.Author,MyApp.Author,MyApp.Author,MyApp.Author,MyApp.Author,MyApp.Author];
MyApp.store.loadRecords(e(json20_29),d);d=[MyApp.Author,MyApp.Author,MyApp.Author,MyApp.Author,MyApp.Author,MyApp.Author,MyApp.Author,MyApp.Author,MyApp.Author,MyApp.Author];
MyApp.store.loadRecords(e(json30_39),d,"guid");MyApp.store.loadRecords(e(json40_49));
return this}};var AuthorFixtures=[{type:"Author",guid:"4995bc373454a",fullName:"Gerry Woolery 4",bookTitle:"The Madness of the Meddler",address:" MIT, 21 Castro St, San Francisco, CA"},{type:"Author",guid:"4995bc37345ab",fullName:"Forrest Eggbert 2",bookTitle:"The Night Inferno",address:" Harvard, 86 University Loop, Southampton, UK"},{type:"Author",guid:"4995bc37345c0",fullName:"Dorthy Wilson 4",bookTitle:"The Nightmare of Space",address:" Harvard, 283 Elm St, Los Angeles, CA"},{type:"Author",guid:"4995bc37345e4",fullName:"Nathan Lineman 4",bookTitle:"The Night of the Ice",address:" College University, 199 First St, Seattle, WA"},{type:"Author",guid:"4995bc3734605",fullName:"Phinehas Laurenzi 3",bookTitle:"The Day Infinity",address:" Foothill College, 144 First St, Wichita, KS"},{type:"Author",guid:"4995bc3734618",fullName:"Avis Cass 3",bookTitle:"Masque of Space",address:" London University, 75 Fifth Ave, Los Angeles, CA"},{type:"Author",guid:"4995bc373462d",fullName:"Everard Richardson 1",bookTitle:"The Day of the Horn",address:" London University, 265 Lazaneo St, New York, NY"},{type:"Author",guid:"4995bc3734641",fullName:"Su Strickland 2",bookTitle:"The Day Ambassador",address:" Santa Clara University, 461 Dana St, Los Angeles, CA"},{type:"Author",guid:"4995bc3734655",fullName:"Patton Kooser 2",bookTitle:"The Ultimate Seed",address:" London University, 235 Van Ness Blvd, St. Louis, MO"},{type:"Author",guid:"4995bc373466e",fullName:"Janelle Howard 3",bookTitle:"The Fury Massacre",address:" Springfield University, 411 Main St, Southampton, UK"},{type:"Author",guid:"4995bc3734685",fullName:"Eliza Ropes 2",bookTitle:"The Fear Robots",address:" Foothill College, 386 Broadway Blvd, Ann Arbor, MI"},{type:"Author",guid:"4995bc373469a",fullName:"Alisya Drennan 2",bookTitle:"The Fear Paradise",address:" University of Southampton, 282 Elm St, Santa Clara, CA"},{type:"Author",guid:"4995bc37346b1",fullName:"Lori Magor 4",bookTitle:"The Madness Attack",address:" MIT, 429 Dana St, San Francisco, CA"},{type:"Author",guid:"4995bc37346c4",fullName:"Amethyst Evans 4",bookTitle:"The Fear of the Thieves",address:" London University, 309 Main St, Cupertino, CA"},{type:"Author",guid:"4995bc37346d8",fullName:"Ridley Ewing 2",bookTitle:"The Killer Angel",address:" New York University, 470 Broadway Blvd, New York, NY"},{type:"Author",guid:"4995bc37346ef",fullName:"Sloane Moulton 1",bookTitle:"The Dead of Time",address:" Springfield University, 1 Dana St, Southampton, UK"},{type:"Author",guid:"4995bc3734704",fullName:"Marquis Fuchs 3",bookTitle:"The Seeds of Menace",address:" CalTech, 348 Fifth Ave, Santa Clara, CA"},{type:"Author",guid:"4995bc3734718",fullName:"August Feufer 4",bookTitle:"The Fangs",address:" CalTech, 244 Broadway Blvd, Cambridge, MA"},{type:"Author",guid:"4995bc373472c",fullName:"Alix Rifler 1",bookTitle:"The Day Whisper",address:" Santa Clara University, 368 Oak Ave, Los Angeles, CA"},{type:"Author",guid:"4995bc3734740",fullName:"Virgil Pinney 3",bookTitle:"The Death of the Hive",address:" College University, 452 Elm St, Los Angeles, CA"},{type:"Author",guid:"4995bc373475d",fullName:"Carin Burnett 4",bookTitle:"The Space of the Mist",address:" Michigan State University, 331 University Loop, Santa Clara, CA"},{type:"Author",guid:"4995bc3734774",fullName:"Matty Cypret 2",bookTitle:"Crater of Day",address:" London University, 37 Broadway Blvd, Seattle, WA"},{type:"Author",guid:"4995bc3734794",fullName:"Matilda Rockwell 3",bookTitle:"The Pirate Masters",address:" CalTech, 487 Bloom St, Cambridge, MA"},{type:"Author",guid:"4995bc37347b0",fullName:"Luann Garneis 1",bookTitle:"The Day of the Keys",address:" Springfield University, 418 Dana St, New York, NY"},{type:"Author",guid:"4995bc37347c4",fullName:"Alysha Fox 1",bookTitle:"The Death Face",address:" Springfield University, 423 Castro St, Southampton, UK"},{type:"Author",guid:"4995bc37347d9",fullName:"Clifford Dugger 3",bookTitle:"The Ultimate Inferno",address:" MIT, 478 Lazaneo St, San Francisco, CA"},{type:"Author",guid:"4995bc37347ec",fullName:"Christianne Taggart 3",bookTitle:"The Curse of Day",address:" Stanford University, 83 Lazaneo St, Cambridge, MA"},{type:"Author",guid:"4995bc373480b",fullName:"Kestrel Nehling 2",bookTitle:"The Machines History",address:" Santa Clara University, 296 Bloom St, Ann Arbor, MI"},{type:"Author",guid:"4995bc373481f",fullName:"Mackenzie Pittman 1",bookTitle:"Cave of Night",address:" New York University, 489 Elm St, Ann Arbor, MI"},{type:"Author",guid:"4995bc3734833",fullName:"Sheila Ammons 4",bookTitle:"Robots of Menace",address:" Harvard, 211 Second St, Cambridge, MA"},{type:"Author",guid:"4995bc3734847",fullName:"September Glover 4",bookTitle:"The Illusion Carnival",address:" London University, 370 Fifth Ave, New York, NY"},{type:"Author",guid:"4995bc3734863",fullName:"Porsche Gilman 1",bookTitle:"The Seeds of Menace",address:" Michigan State University, 1 Fifth Ave, Los Angeles, CA"},{type:"Author",guid:"4995bc3734875",fullName:"Vance Jolce 1",bookTitle:"The Final Time",address:" CalTech, 364 University Loop, London, UK"},{type:"Author",guid:"4995bc373488a",fullName:"Clifford Dugger 4",bookTitle:"Dreams of Menace",address:" Springfield University, 211 First St, New York, NY"},{type:"Author",guid:"4995bc373489e",fullName:"Zander Pershing 1",bookTitle:"Killer of Menace",address:" Harvard, 464 Dana St, London, UK"},{type:"Author",guid:"4995bc37348b2",fullName:"Joye Eisenman 3",bookTitle:"The Whisper Faces",address:" College University, 171 Lazaneo St, St. Louis, MO"},{type:"Author",guid:"4995bc37348c5",fullName:"Phyliss Saylor 3",bookTitle:"The Fury Secret",address:" London University, 443 Dana St, St. Louis, MO"},{type:"Author",guid:"4995bc37348e1",fullName:"Duke Rosenstiehl 1",bookTitle:"The Time Fangs",address:" CalTech, 28 Oak Ave, Los Angeles, CA"},{type:"Author",guid:"4995bc37348f3",fullName:"Silvester Mcfall 3",bookTitle:"Whispers of Madness",address:" MIT, 217 First St, Cambridge, MA"},{type:"Author",guid:"4995bc3734909",fullName:"Branda Wood 1",bookTitle:"The Inferno",address:" London University, 120 University Loop, Wichita, KS"},{type:"Author",guid:"4995bc373491d",fullName:"Em Leichter 1",bookTitle:"The Day of the Massacre",address:" CalTech, 113 Castro St, Wichita, KS"},{type:"Author",guid:"4995bc3734931",fullName:"Bonita Downing 4",bookTitle:"Minds of Fury",address:" Santa Clara University, 64 University Loop, London, UK"},{type:"Author",guid:"4995bc3734944",fullName:"Norm Burns 4",bookTitle:"The Machines Mists",address:" UC Santa Cruz, 27 Lazaneo St, Cupertino, CA"},{type:"Author",guid:"4995bc373495f",fullName:"Victor Painter 3",bookTitle:"The Laboratory",address:" MIT, 5 Elm St, Los Angeles, CA"},{type:"Author",guid:"4995bc3734974",fullName:"Lalla Haverrman 2",bookTitle:"Planet of Death",address:" University of Southampton, 60 Oak Ave, London, UK"},{type:"Author",guid:"4995bc3734988",fullName:"Jeri Stroh 3",bookTitle:"The Meddler",address:" London University, 390 Oak Ave, Southampton, UK"},{type:"Author",guid:"4995bc373499c",fullName:"Raynard Peters 1",bookTitle:"The Horror of the Minds",address:" Michigan State University, 186 Van Ness Blvd, New York, NY"},{type:"Author",guid:"4995bc37349bb",fullName:"Buck Eisaman 3",bookTitle:"Future of Night",address:" New York University, 470 First St, Southampton, UK"},{type:"Author",guid:"4995bc37349d8",fullName:"Annie Surrency 3",bookTitle:"The Menace Androids",address:" Foothill College, 192 Bloom St, Southampton, UK"},{type:"Author",guid:"4995bc37349f3",fullName:"Ashlie Newman 4",bookTitle:"The Horror Key",address:" MIT, 106 First St, Cupertino, CA"},{type:"Author",guid:"4995bc3734a07",fullName:"Mabelle Staymates 2",bookTitle:"The Riders of Death",address:" Foothill College, 42 Broadway Blvd, Ann Arbor, MI"},{type:"Author",guid:"4995bc3734a22",fullName:"Eveleen Mixey 3",bookTitle:"The Doom of the Jaws",address:" New York University, 218 University Loop, Los Angeles, CA"},{type:"Author",guid:"4995bc3734a5f",fullName:"Anneka Gist 3",bookTitle:"Ark of Space",address:" London University, 301 Van Ness Blvd, Cambridge, MA"},{type:"Author",guid:"4995bc3734a75",fullName:"Avis Cass 3",bookTitle:"The Doomed Pit",address:" Foothill College, 40 Second St, Seattle, WA"},{type:"Author",guid:"4995bc3734a89",fullName:"Cedar Garry 3",bookTitle:"The Death Dead",address:" University of Southampton, 206 Bloom St, Palo Alto, CA"},{type:"Author",guid:"4995bc3734aa3",fullName:"Kezia Henry 1",bookTitle:"The Operation",address:" MIT, 294 First St, New York, NY"},{type:"Author",guid:"4995bc3734ab8",fullName:"Lindsey Straub 3",bookTitle:"The Fury of the Angel",address:" Stanford University, 11 Dana St, Cambridge, MA"},{type:"Author",guid:"4995bc3734aca",fullName:"Cornell Siegrist 1",bookTitle:"The Ghost",address:" College University, 310 Second St, Southampton, UK"},{type:"Author",guid:"4995bc3734ae5",fullName:"Raine Warrick 2",bookTitle:"The Menace Myth",address:" Springfield University, 360 University Loop, San Francisco, CA"},{type:"Author",guid:"4995bc3734af9",fullName:"Marci Caesar 2",bookTitle:"Fangs of Fury",address:" Santa Clara University, 486 Main St, Ann Arbor, MI"},{type:"Author",guid:"4995bc3734b0d",fullName:"Hewie Rose 2",bookTitle:"Mirror of Night",address:" CalTech, 419 Elm St, Wichita, KS"},{type:"Author",guid:"4995bc3734b26",fullName:"Titania Tilton 3",bookTitle:"The Day of the Mists",address:" Michigan State University, 251 Main St, Los Angeles, CA"},{type:"Author",guid:"4995bc3734b3b",fullName:"Amyas Hice 1",bookTitle:"City of Menace",address:" Santa Clara University, 380 Lazaneo St, San Francisco, CA"},{type:"Author",guid:"4995bc3734b5c",fullName:"Lyric Richards 1",bookTitle:"The Impossible Doors",address:" MIT, 412 Elm St, Cambridge, MA"},{type:"Author",guid:"4995bc3734b6f",fullName:"Lianne Kemble 4",bookTitle:"The Mind Massacre",address:" Harvard, 318 Fifth Ave, Ann Arbor, MI"},{type:"Author",guid:"4995bc3734b83",fullName:"Gabe Milliron 4",bookTitle:"The Carnival",address:" MIT, 187 Second St, Los Angeles, CA"},{type:"Author",guid:"4995bc3734b97",fullName:"Willis Costello 4",bookTitle:"The Night of the Bandits",address:" Michigan State University, 114 Elm St, Cambridge, MA"},{type:"Author",guid:"4995bc3734bb6",fullName:"Lottie Sherlock 3",bookTitle:"The Space Skull",address:" Foothill College, 165 Main St, Cambridge, MA"},{type:"Author",guid:"4995bc3734bc8",fullName:"Frieda Wade 2",bookTitle:"The Operation",address:" Santa Clara University, 179 University Loop, Cupertino, CA"},{type:"Author",guid:"4995bc3734bde",fullName:"Chip Haynes 1",bookTitle:"The Robot of Night",address:" Foothill College, 258 First St, Ann Arbor, MI"},{type:"Author",guid:"4995bc3734bf2",fullName:"Denzel Buehler 3",bookTitle:"The Night of the Brides",address:" Michigan State University, 138 First St, Cambridge, MA"},{type:"Author",guid:"4995bc3734c0e",fullName:"Kaelee Johnson 3",bookTitle:"The Evil Invasion",address:" MIT, 121 Fifth Ave, Southampton, UK"},{type:"Author",guid:"4995bc3734c25",fullName:"Prissy Cressman 1",bookTitle:"Monster of Day",address:" CalTech, 53 Second St, Los Angeles, CA"},{type:"Author",guid:"4995bc3734c38",fullName:"Anne Roadman 4",bookTitle:"The Meddler of Fear",address:" MIT, 374 Broadway Blvd, St. Louis, MO"},{type:"Author",guid:"4995bc3734c57",fullName:"Stacy Moffat 3",bookTitle:"The Menace Mist",address:" University of Southampton, 42 Second St, London, UK"},{type:"Author",guid:"4995bc3734c6b",fullName:"Jerold Jenkins 3",bookTitle:"The Thieves of Time",address:" London University, 188 Broadway Blvd, London, UK"},{type:"Author",guid:"4995bc3734c7f",fullName:"Berniece Berry 2",bookTitle:"The Illusion Ark",address:" College University, 148 Second St, Palo Alto, CA"},{type:"Author",guid:"4995bc3734c92",fullName:"Tim Beck 3",bookTitle:"The Warrior",address:" New York University, 47 Broadway Blvd, London, UK"},{type:"Author",guid:"4995bc3734cad",fullName:"Alexis Weisgarber 1",bookTitle:"The Space of the Crater",address:" Harvard, 47 Elm St, Palo Alto, CA"},{type:"Author",guid:"4995bc3734cc0",fullName:"Levi Wilkinson 1",bookTitle:"The Ambassador of Horror",address:" UC Santa Cruz, 34 Lazaneo St, Ann Arbor, MI"},{type:"Author",guid:"4995bc3734cd4",fullName:"Bailey Lauffer 3",bookTitle:"Fury of Doom",address:" New York University, 227 Castro St, Santa Clara, CA"},{type:"Author",guid:"4995bc3734ce7",fullName:"Gerry Woolery 1",bookTitle:"The Menace of the Computers",address:" Springfield University, 8 Main St, Ann Arbor, MI"},{type:"Author",guid:"4995bc3734cfb",fullName:"Hale Alliman 2",bookTitle:"The Paradise of Death",address:" Santa Clara University, 21 University Loop, Cupertino, CA"},{type:"Author",guid:"4995bc3734d0f",fullName:"Everard Richardson 2",bookTitle:"The Skull",address:" Santa Clara University, 391 Elm St, Cupertino, CA"},{type:"Author",guid:"4995bc3734d2c",fullName:"Tammie Crawford 1",bookTitle:"The Empty Runaway",address:" Michigan State University, 155 Van Ness Blvd, Cambridge, MA"},{type:"Author",guid:"4995bc3734d3f",fullName:"Xavier Porter 3",bookTitle:"The Resurrection of Death",address:" Springfield University, 187 Lazaneo St, Palo Alto, CA"},{type:"Author",guid:"4995bc3734d53",fullName:"Alec Owens 3",bookTitle:"The Madness of the History",address:" New York University, 385 University Loop, St. Louis, MO"},{type:"Author",guid:"4995bc3734d67",fullName:"Jancis Busk 2",bookTitle:"The Mind Seed",address:" Harvard, 49 Main St, Santa Clara, CA"},{type:"Author",guid:"4995bc3734d7b",fullName:"Daffodil Harper 1",bookTitle:"Monster of Day",address:" Michigan State University, 254 Castro St, Ann Arbor, MI"},{type:"Author",guid:"4995bc3734d8f",fullName:"Davey Moore 2",bookTitle:"Ghost of Fury",address:" Harvard, 160 Broadway Blvd, Cupertino, CA"},{type:"Author",guid:"4995bc3734dca",fullName:"Ridley Ewing 3",bookTitle:"The Fear Awakening",address:" College University, 86 Lazaneo St, San Francisco, CA"},{type:"Author",guid:"4995bc3734dde",fullName:"Loreto Isemann 1",bookTitle:"The Madness Night",address:" Foothill College, 496 Van Ness Blvd, Wichita, KS"},{type:"Author",guid:"4995bc3734df2",fullName:"Deshawn Pyle 4",bookTitle:"Suns of Time",address:" Santa Clara University, 271 Fifth Ave, Southampton, UK"},{type:"Author",guid:"4995bc3734e07",fullName:"Hailey Berkheimer 3",bookTitle:"The Time Smuggler",address:" Stanford University, 345 Main St, St. Louis, MO"},{type:"Author",guid:"4995bc3734e51",fullName:" 3",bookTitle:"The Menace Nightmares",address:" Stanford University, 346 Main St, Santa Clara, CA"},{type:"Author",guid:"4995bc3734e74",fullName:"Simona Craig 2",bookTitle:"The Horror of the Ice",address:" Michigan State University, 47 Bloom St, Cambridge, MA"},{type:"Author",guid:"4995bc3734e89",fullName:"Peta Filby 1",bookTitle:"Masque of Space",address:" Santa Clara University, 95 Broadway Blvd, Wichita, KS"},{type:"Author",guid:"4995bc3734ea6",fullName:"Kathi Williams 4",bookTitle:"Madness of Death",address:" Springfield University, 307 Second St, San Francisco, CA"},{type:"Author",guid:"4995bc3734eba",fullName:"Barret Lalty 1",bookTitle:"The Space of the Mirror",address:" University of Southampton, 287 Fifth Ave, St. Louis, MO"},{type:"Author",guid:"4995bc3734ed9",fullName:"Russ Nicola 4",bookTitle:"The Bride of Horror",address:" University of Southampton, 270 Elm St, Cupertino, CA"},{type:"Author",guid:"4995bc3734eed",fullName:"Maya Schrader 2",bookTitle:"The Terrible Sea",address:" College University, 206 First St, London, UK"},{type:"Author",guid:"4995bc3734f01",fullName:"Hazel Holts 1",bookTitle:"The Carnival",address:" CalTech, 65 University Loop, London, UK"},{type:"Author",guid:"4995bc3734f26",fullName:"Saffron Elinor 3",bookTitle:"The Seeds of Menace",address:" Springfield University, 462 Castro St, San Francisco, CA"},{type:"Author",guid:"4995bc3734f39",fullName:"Tiger Whitling 2",bookTitle:"The Night of the Brides",address:" MIT, 139 Castro St, Palo Alto, CA"},{type:"Author",guid:"4995bc3734f4e",fullName:"Rolph Burris 4",bookTitle:"The Horror Power",address:" Harvard, 418 Second St, London, UK"},{type:"Author",guid:"4995bc3734f61",fullName:"Mark Wheeler 1",bookTitle:"The Horror Key",address:" University of Southampton, 441 Bloom St, New York, NY"},{type:"Author",guid:"4995bc3734f75",fullName:"Wenona Tennant 2",bookTitle:"The Men",address:" Stanford University, 122 Main St, New York, NY"},{type:"Author",guid:"4995bc3734f89",fullName:"Callista Bishop 1",bookTitle:"The Pirate Masters",address:" UC Santa Cruz, 127 Main St, Cambridge, MA"},{type:"Author",guid:"4995bc3734fa4",fullName:"Cecil Rodacker 2",bookTitle:"The Fury of the Wings",address:" MIT, 499 Fifth Ave, Santa Clara, CA"},{type:"Author",guid:"4995bc3734fb7",fullName:"Liliana Northey 4",bookTitle:"The Fear Awakening",address:" Harvard, 185 First St, Cambridge, MA"},{type:"Author",guid:"4995bc3734fcb",fullName:"Webster Jelliman 1",bookTitle:"The Talons of Day",address:" University of Southampton, 472 Lazaneo St, Los Angeles, CA"},{type:"Author",guid:"4995bc3734fdf",fullName:"Loreen Buck 4",bookTitle:"The Masque of Doom",address:" UC Santa Cruz, 122 Broadway Blvd, Cupertino, CA"},{type:"Author",guid:"4995bc3734ff3",fullName:"Keisha Klockman 2",bookTitle:"The Ice Web",address:" MIT, 88 Lazaneo St, Cupertino, CA"},{type:"Author",guid:"4995bc3735006",fullName:"Bennett Little 1",bookTitle:"Revelation of Menace",address:" UC Santa Cruz, 118 University Loop, Palo Alto, CA"},{type:"Author",guid:"4995bc3735022",fullName:"Louis Waldron 1",bookTitle:"The Mountain Suns",address:" CalTech, 79 First St, San Francisco, CA"},{type:"Author",guid:"4995bc3735034",fullName:"Sophia Spring 1",bookTitle:"The Death of the Nightmares",address:" Santa Clara University, 450 First St, San Francisco, CA"},{type:"Author",guid:"4995bc3735048",fullName:"Joscelin Nash 3",bookTitle:"The Day Monster",address:" Santa Clara University, 191 Lazaneo St, St. Louis, MO"},{type:"Author",guid:"4995bc373505c",fullName:"Porsche Gilman 1",bookTitle:"Robots of Night",address:" CalTech, 338 First St, St. Louis, MO"},{type:"Author",guid:"4995bc3735070",fullName:"Deshawn Pyle 4",bookTitle:"The Space Brides",address:" Michigan State University, 204 Second St, Southampton, UK"},{type:"Author",guid:"4995bc3735084",fullName:"Galen Flanders 2",bookTitle:"The Secret Devils",address:" CalTech, 219 Castro St, Palo Alto, CA"},{type:"Author",guid:"4995bc37350a5",fullName:"Lonnie Linton 3",bookTitle:"The Armageddon",address:" London University, 214 Elm St, Los Angeles, CA"},{type:"Author",guid:"4995bc37350ba",fullName:"Melvin Wilkerson 4",bookTitle:"The Space Reign",address:" Harvard, 71 Bloom St, San Francisco, CA"},{type:"Author",guid:"4995bc37350d0",fullName:"Eleanor Bennett 4",bookTitle:"Runaway of Death",address:" Harvard, 148 Castro St, San Francisco, CA"},{type:"Author",guid:"4995bc37350e4",fullName:"Fawn Carr 3",bookTitle:"The Warrior of Menace",address:" Springfield University, 202 Oak Ave, Ann Arbor, MI"},{type:"Author",guid:"4995bc37350f8",fullName:"Linsay Mcmullen 4",bookTitle:"The Doom Masters",address:" Harvard, 116 First St, Los Angeles, CA"},{type:"Author",guid:"4995bc3735110",fullName:"Amyas Hice 4",bookTitle:"The Space Skull",address:" College University, 6 Fifth Ave, St. Louis, MO"},{type:"Author",guid:"4995bc3735123",fullName:"Monty Kava 4",bookTitle:"The Day Ice",address:" Santa Clara University, 175 Elm St, Cambridge, MA"},{type:"Author",guid:"4995bc3735138",fullName:"Brock Young 4",bookTitle:"The Killer Sound",address:" College University, 414 University Loop, Southampton, UK"},{type:"Author",guid:"4995bc373514c",fullName:"Belinda Alice 3",bookTitle:"The Deadly Memories",address:" UC Santa Cruz, 172 Elm St, Wichita, KS"},{type:"Author",guid:"4995bc3735160",fullName:"Marlene Agnes 4",bookTitle:"The Death Creature",address:" CalTech, 291 Van Ness Blvd, Ann Arbor, MI"},{type:"Author",guid:"4995bc3735174",fullName:"Godric Sommer 3",bookTitle:"The Fury Infinity",address:" CalTech, 290 Oak Ave, Southampton, UK"},{type:"Author",guid:"4995bc373518d",fullName:"Janis Bullard 2",bookTitle:"The Wings",address:" Foothill College, 265 Van Ness Blvd, Southampton, UK"},{type:"Author",guid:"4995bc37351a3",fullName:"Pamella Mckee 3",bookTitle:"The Children of Madness",address:" London University, 273 Broadway Blvd, London, UK"},{type:"Author",guid:"4995bc37351c8",fullName:"Prince Demuth 4",bookTitle:"The Riders",address:" Michigan State University, 193 Main St, St. Louis, MO"},{type:"Author",guid:"4995bc37351dc",fullName:"Kristal Young 2",bookTitle:"The Pirate Nightmares",address:" Foothill College, 354 Castro St, St. Louis, MO"},{type:"Author",guid:"4995bc37351ef",fullName:"Osmund Pritchard 1",bookTitle:"The Time Suns",address:" University of Southampton, 250 Dana St, Ann Arbor, MI"},{type:"Author",guid:"4995bc3735209",fullName:"Jazmine Adams 3",bookTitle:"The Day of the Computers",address:" Stanford University, 340 Van Ness Blvd, Cambridge, MA"},{type:"Author",guid:"4995bc3735221",fullName:"Rose Mays 3",bookTitle:"Meddler of Space",address:" UC Santa Cruz, 409 Bloom St, Los Angeles, CA"},{type:"Author",guid:"4995bc373523f",fullName:"Rylee Fiddler 2",bookTitle:"Masque of Space",address:" UC Santa Cruz, 413 Fifth Ave, Wichita, KS"},{type:"Author",guid:"4995bc3735253",fullName:"Meg Coveney 1",bookTitle:"Devils of Fury",address:" MIT, 446 Oak Ave, Southampton, UK"},{type:"Author",guid:"4995bc3735267",fullName:"Pamelia Mang 4",bookTitle:"The Time of the Pyramid",address:" New York University, 131 Main St, Cupertino, CA"},{type:"Author",guid:"4995bc373527b",fullName:"Raphael Wilks 4",bookTitle:"Ark of Day",address:" Foothill College, 44 Fifth Ave, Cambridge, MA"},{type:"Author",guid:"4995bc373529a",fullName:"Matilda Rockwell 4",bookTitle:"The Time Smugglers",address:" Michigan State University, 135 Van Ness Blvd, Ann Arbor, MI"},{type:"Author",guid:"4995bc37352ae",fullName:"Duke Rosenstiehl 1",bookTitle:"Mist of Death",address:" Santa Clara University, 160 First St, Ann Arbor, MI"},{type:"Author",guid:"4995bc37352cf",fullName:"Effie Greenwood 2",bookTitle:"The Fury Mist",address:" UC Santa Cruz, 288 Main St, Santa Clara, CA"},{type:"Author",guid:"4995bc37352e3",fullName:"Kathy Huston 4",bookTitle:"History of Doom",address:" Harvard, 299 Bloom St, Cupertino, CA"},{type:"Author",guid:"4995bc37352f6",fullName:"Rina Prescott 1",bookTitle:"The Children of Madness",address:" College University, 458 Elm St, Los Angeles, CA"},{type:"Author",guid:"4995bc3735319",fullName:"Raven Pirl 4",bookTitle:"Smugglers of Night",address:" UC Santa Cruz, 467 Main St, St. Louis, MO"},{type:"Author",guid:"4995bc373532c",fullName:"Xavier Porter 2",bookTitle:"The Robot of Night",address:" University of Southampton, 52 Lazaneo St, London, UK"},{type:"Author",guid:"4995bc373533f",fullName:"Lianne Kemble 1",bookTitle:"The Seeds",address:" College University, 482 Castro St, Cupertino, CA"},{type:"Author",guid:"4995bc3735353",fullName:"Byrne Bruxner 1",bookTitle:"The Long Suns",address:" CalTech, 238 Dana St, Ann Arbor, MI"},{type:"Author",guid:"4995bc3735367",fullName:"Byrne Bruxner 3",bookTitle:"The Wings",address:" New York University, 331 Van Ness Blvd, Cambridge, MA"},{type:"Author",guid:"4995bc373537a",fullName:"Fawn Carr 4",bookTitle:"The Laboratory",address:" CalTech, 237 Fifth Ave, London, UK"},{type:"Author",guid:"4995bc3735398",fullName:"Alyx Hincken 2",bookTitle:"The Revelation",address:" CalTech, 41 First St, Palo Alto, CA"},{type:"Author",guid:"4995bc37353aa",fullName:"Xerxes Newbern 1",bookTitle:"The Ghost",address:" Stanford University, 424 Van Ness Blvd, Southampton, UK"},{type:"Author",guid:"4995bc37353c0",fullName:"Alton Saline 3",bookTitle:"The Space of the Leisure",address:" London University, 102 Bloom St, London, UK"},{type:"Author",guid:"4995bc37353d3",fullName:"Lina Sanborn 1",bookTitle:"The Night Caves",address:" Michigan State University, 79 Second St, Ann Arbor, MI"},{type:"Author",guid:"4995bc37353e7",fullName:"Laura Herrold 3",bookTitle:"The Runaway Gods",address:" College University, 476 Dana St, Ann Arbor, MI"},{type:"Author",guid:"4995bc37353fb",fullName:"Maximilian Wolfe 1",bookTitle:"The Doom Meddler",address:" Stanford University, 400 Lazaneo St, Santa Clara, CA"},{type:"Author",guid:"4995bc3735418",fullName:"Ben Lombardi 3",bookTitle:"The Day",address:" College University, 139 Bloom St, St. Louis, MO"},{type:"Author",guid:"4995bc373543d",fullName:"Tiger Whitling 4",bookTitle:"The Fury Sea",address:" MIT, 55 Second St, St. Louis, MO"},{type:"Author",guid:"4995bc3735450",fullName:"Nena Davis 1",bookTitle:"The Operation of Menace",address:" University of Southampton, 2 First St, Cambridge, MA"},{type:"Author",guid:"4995bc3735464",fullName:"Luther Johnston 3",bookTitle:"The Keeper of Space",address:" Foothill College, 76 University Loop, San Francisco, CA"},{type:"Author",guid:"4995bc373547e",fullName:"Rikki Graham 3",bookTitle:"The Devil",address:" Foothill College, 322 Castro St, Cupertino, CA"},{type:"Author",guid:"4995bc3735493",fullName:"Alec Owens 1",bookTitle:"The Hive of Doom",address:" Michigan State University, 448 Bloom St, Wichita, KS"},{type:"Author",guid:"4995bc37354b2",fullName:"Lettie Roberts 3",bookTitle:"Dead of Time",address:" Stanford University, 152 Second St, Southampton, UK"},{type:"Author",guid:"4995bc37354c5",fullName:"Amalia Grant 2",bookTitle:"The Talons of Day",address:" University of Southampton, 42 Oak Ave, New York, NY"},{type:"Author",guid:"4995bc37354d9",fullName:"Brady Smail 2",bookTitle:"The Horror Visitor",address:" University of Southampton, 350 Castro St, Ann Arbor, MI"},{type:"Author",guid:"4995bc37354ed",fullName:"Lori Magor 2",bookTitle:"The Ultimate Seed",address:" London University, 397 Main St, Cambridge, MA"},{type:"Author",guid:"4995bc373550f",fullName:"Jewel Mortland 2",bookTitle:"The Horror of the Ragnarok",address:" College University, 46 Elm St, St. Louis, MO"},{type:"Author",guid:"4995bc3735538",fullName:"Kaitlyn Paul 1",bookTitle:"The Memories",address:" New York University, 489 Lazaneo St, Los Angeles, CA"},{type:"Author",guid:"4995bc373554e",fullName:"Aletha Lambert 1",bookTitle:"The Horror of the Universe",address:" Stanford University, 425 Van Ness Blvd, Los Angeles, CA"},{type:"Author",guid:"4995bc3735563",fullName:"Lela Warner 2",bookTitle:"The Menace of the Anvil",address:" CalTech, 430 Fifth Ave, Seattle, WA"},{type:"Author",guid:"4995bc3735578",fullName:"Brandi Bauerle 4",bookTitle:"The Fear of the Key",address:" College University, 485 Elm St, San Francisco, CA"},{type:"Author",guid:"4995bc373558c",fullName:"Marva Wise 4",bookTitle:"The Meddler",address:" Stanford University, 388 Second St, Cupertino, CA"},{type:"Author",guid:"4995bc373559e",fullName:"Seymour Fischer 1",bookTitle:"The Rock",address:" Springfield University, 375 First St, San Francisco, CA"},{type:"Author",guid:"4995bc37355b2",fullName:"Honor Simmons 3",bookTitle:"The Menace Mist",address:" CalTech, 179 Broadway Blvd, San Francisco, CA"},{type:"Author",guid:"4995bc37355c7",fullName:"Sarah Chapman 1",bookTitle:"The Day Androids",address:" UC Santa Cruz, 317 Dana St, Cupertino, CA"},{type:"Author",guid:"4995bc37355db",fullName:"Suzanna Neely 1",bookTitle:"The Secret Devils",address:" CalTech, 201 Main St, New York, NY"},{type:"Author",guid:"4995bc37355ee",fullName:"Wil Hoffhants 2",bookTitle:"The Empty Machines",address:" UC Santa Cruz, 446 Bloom St, San Francisco, CA"},{type:"Author",guid:"4995bc3735602",fullName:"Ridley Ewing 4",bookTitle:"The Ghost of Menace",address:" College University, 252 Broadway Blvd, Southampton, UK"},{type:"Author",guid:"4995bc3735616",fullName:"Rodge Catherina 2",bookTitle:"The Empty Herald",address:" Michigan State University, 367 Van Ness Blvd, Palo Alto, CA"},{type:"Author",guid:"4995bc373562a",fullName:"Brady Smail 1",bookTitle:"The Day Ice",address:" London University, 426 Elm St, Los Angeles, CA"},{type:"Author",guid:"4995bc373563e",fullName:"Antony Stern 4",bookTitle:"Reign of Night",address:" University of Southampton, 6 Van Ness Blvd, St. Louis, MO"},{type:"Author",guid:"4995bc3735652",fullName:"Loreen Buck 1",bookTitle:"The Day Whisper",address:" Michigan State University, 47 Main St, Palo Alto, CA"},{type:"Author",guid:"4995bc3735666",fullName:"Melita Barkley 1",bookTitle:"The Meddler of Fear",address:" CalTech, 328 Lazaneo St, Cambridge, MA"},{type:"Author",guid:"4995bc373567a",fullName:"Kerensa Benford 2",bookTitle:"The Menace of the Ghosts",address:" New York University, 411 Elm St, Seattle, WA"},{type:"Author",guid:"4995bc373568e",fullName:"Prue Putnam 2",bookTitle:"The Doom of the Night",address:" College University, 340 Oak Ave, Southampton, UK"},{type:"Author",guid:"4995bc37356aa",fullName:"Rosaleen Mench 3",bookTitle:"The Devil",address:" College University, 266 First St, Palo Alto, CA"},{type:"Author",guid:"4995bc37356bc",fullName:"Washington Rummel 4",bookTitle:"Man of Madness",address:" College University, 54 Castro St, San Francisco, CA"},{type:"Author",guid:"4995bc37356d0",fullName:"Leyton Jyllian 1",bookTitle:"The Menace of the Computers",address:" Springfield University, 432 First St, St. Louis, MO"},{type:"Author",guid:"4995bc37356e4",fullName:"Perce Pennington 3",bookTitle:"The Seventh Child",address:" College University, 178 Oak Ave, London, UK"},{type:"Author",guid:"4995bc37356f8",fullName:"Sabrina Beedell 3",bookTitle:"Runaway of Death",address:" Stanford University, 105 Lazaneo St, Ann Arbor, MI"},{type:"Author",guid:"4995bc3735713",fullName:"Mckenzie Carden 2",bookTitle:"The Universe",address:" Springfield University, 436 Broadway Blvd, Palo Alto, CA"},{type:"Author",guid:"4995bc3735728",fullName:"Ginny Finlay 2",bookTitle:"The Doom of the Massacre",address:" Foothill College, 56 Broadway Blvd, Wichita, KS"},{type:"Author",guid:"4995bc373573c",fullName:"Fox Omara 4",bookTitle:"The Madness Horns",address:" Foothill College, 239 Fifth Ave, London, UK"},{type:"Author",guid:"4995bc373574f",fullName:"Cherice Blatenberger 2",bookTitle:"The Claws of Fury",address:" Harvard, 235 Van Ness Blvd, Cupertino, CA"},{type:"Author",guid:"4995bc3735763",fullName:"Harriette Alington 4",bookTitle:"The Whispers",address:" College University, 203 Lazaneo St, Wichita, KS"},{type:"Author",guid:"4995bc3735777",fullName:"Eldon Ream 2",bookTitle:"The Revelation",address:" University of Southampton, 97 Broadway Blvd, Cambridge, MA"},{type:"Author",guid:"4995bc373578b",fullName:"Ambrosine Echard 4",bookTitle:"The Android of Madness",address:" University of Southampton, 133 Oak Ave, Los Angeles, CA"},{type:"Author",guid:"4995bc373579f",fullName:"Bekki Blunt 4",bookTitle:"Evil of Fury",address:" Springfield University, 236 Oak Ave, Los Angeles, CA"},{type:"Author",guid:"4995bc37357b2",fullName:"Zena Giesler 1",bookTitle:"The Terrible Ghosts",address:" Foothill College, 228 Bloom St, Santa Clara, CA"},{type:"Author",guid:"4995bc37357c6",fullName:"Lalo Pery 4",bookTitle:"The Fury of the Devils",address:" Michigan State University, 39 Lazaneo St, Cupertino, CA"},{type:"Author",guid:"4995bc37357da",fullName:"Rowina Bicknell 2",bookTitle:"Evil of Fury",address:" University of Southampton, 471 Second St, Santa Clara, CA"},{type:"Author",guid:"4995bc37357ee",fullName:"Candis Kanaga 4",bookTitle:"The Operation",address:" UC Santa Cruz, 11 Bloom St, London, UK"},{type:"Author",guid:"4995bc3735802",fullName:"Jess Richter 4",bookTitle:"The Bride of Fury",address:" MIT, 91 University Loop, Seattle, WA"},{type:"Author",guid:"4995bc3735816",fullName:"Elfreda Vanleer 1",bookTitle:"The Madness of the Face",address:" College University, 147 Main St, Cupertino, CA"},{type:"Author",guid:"4995bc373582a",fullName:"Rolo Orner 1",bookTitle:"The Dead Sea",address:" London University, 475 Dana St, St. Louis, MO"},{type:"Author",guid:"4995bc373583e",fullName:"Lottie Sherlock 1",bookTitle:"The Robbers",address:" Michigan State University, 306 Van Ness Blvd, New York, NY"},{type:"Author",guid:"4995bc3735851",fullName:"Shyla Clarke 3",bookTitle:"The Attack",address:" College University, 299 Dana St, Cupertino, CA"},{type:"Author",guid:"4995bc3735865",fullName:"Bethany Veith 3",bookTitle:"The Secret Pyramids",address:" Harvard, 248 Fifth Ave, Wichita, KS"},{type:"Author",guid:"4995bc3735879",fullName:"Bertha Jesse 3",bookTitle:"The Space of the Pit",address:" Harvard, 364 University Loop, London, UK"},{type:"Author",guid:"4995bc373588d",fullName:"Marylou Frankenberger 1",bookTitle:"The Time Keys",address:" College University, 322 Elm St, Cambridge, MA"},{type:"Author",guid:"4995bc37358a1",fullName:"Roderick Powell 3",bookTitle:"The Inferno of Death",address:" University of Southampton, 266 Main St, St. Louis, MO"},{type:"Author",guid:"4995bc37358b5",fullName:"Maureen Leach 3",bookTitle:"The Unearthly Assassin",address:" Santa Clara University, 170 Bloom St, Cupertino, CA"},{type:"Author",guid:"4995bc37358c8",fullName:"Jaclyn Stiffey 1",bookTitle:"Dominator of Death",address:" Harvard, 236 Second St, Palo Alto, CA"},{type:"Author",guid:"4995bc37358dc",fullName:"Lindsey Straub 3",bookTitle:"The Decay of Space",address:" UC Santa Cruz, 155 Castro St, Cambridge, MA"},{type:"Author",guid:"4995bc37358f7",fullName:"Lyric Richards 1",bookTitle:"The Paradise of Menace",address:" Foothill College, 293 Elm St, Santa Clara, CA"},{type:"Author",guid:"4995bc373590b",fullName:"Allycia Mackendrick 1",bookTitle:"The Long Suns",address:" Santa Clara University, 449 Castro St, San Francisco, CA"},{type:"Author",guid:"4995bc373591f",fullName:"James Buzzard 2",bookTitle:"The Death of the Thieves",address:" University of Southampton, 341 Oak Ave, San Francisco, CA"},{type:"Author",guid:"4995bc3735933",fullName:"Pamelia Mang 2",bookTitle:"The Masque of Doom",address:" Santa Clara University, 411 University Loop, Southampton, UK"},{type:"Author",guid:"4995bc3735947",fullName:"Chandler Wildman 3",bookTitle:"The Fear Awakening",address:" Santa Clara University, 144 Main St, New York, NY"},{type:"Author",guid:"4995bc373595b",fullName:"Tyrese Knight 2",bookTitle:"The Messenger of Fear",address:" Michigan State University, 342 Castro St, Ann Arbor, MI"},{type:"Author",guid:"4995bc373596e",fullName:"Emery Cavalet 2",bookTitle:"City of Menace",address:" CalTech, 477 Fifth Ave, Ann Arbor, MI"},{type:"Author",guid:"4995bc3735982",fullName:"Jackson Garratt 3",bookTitle:"The Claws of Fear",address:" College University, 25 Dana St, London, UK"},{type:"Author",guid:"4995bc3735996",fullName:"Gussie Bowman 2",bookTitle:"The Space of the Runaway",address:" Michigan State University, 372 Main St, San Francisco, CA"},{type:"Author",guid:"4995bc37359aa",fullName:"Kezia Henry 2",bookTitle:"The Time Ark",address:" Stanford University, 199 Main St, San Francisco, CA"},{type:"Author",guid:"4995bc37359bd",fullName:"Quintin Hays 1",bookTitle:"The Nightmares of Doom",address:" Santa Clara University, 172 University Loop, London, UK"},{type:"Author",guid:"4995bc37359d1",fullName:"Amalia Grant 2",bookTitle:"The Fang Ghost",address:" University of Southampton, 471 Fifth Ave, Seattle, WA"},{type:"Author",guid:"4995bc37359e5",fullName:"Jasper Swarner 4",bookTitle:"The Time Armageddon",address:" Foothill College, 65 Lazaneo St, Southampton, UK"},{type:"Author",guid:"4995bc37359f9",fullName:"Tania Scott 4",bookTitle:"The Secret Monster",address:" Michigan State University, 24 Second St, London, UK"},{type:"Author",guid:"4995bc3735a0d",fullName:"Jarrod Schreckengost 3",bookTitle:"Dreams of Menace",address:" New York University, 126 Bloom St, Cambridge, MA"},{type:"Author",guid:"4995bc3735a21",fullName:"Lesley Sanforth 3",bookTitle:"The Jaws of Death",address:" CalTech, 357 Castro St, New York, NY"},{type:"Author",guid:"4995bc3735a34",fullName:"Roosevelt Stewart 3",bookTitle:"The Fear of the Mist",address:" College University, 6 Main St, Cambridge, MA"},{type:"Author",guid:"4995bc3735a48",fullName:"Jacaline Mathews 2",bookTitle:"The Day of the Runaway",address:" Santa Clara University, 420 Broadway Blvd, Seattle, WA"},{type:"Author",guid:"4995bc3735a5c",fullName:"Kaitlyn Paul 3",bookTitle:"The Carnival",address:" Michigan State University, 322 Bloom St, London, UK"},{type:"Author",guid:"4995bc3735a70",fullName:"Christianne Taggart 1",bookTitle:"The Doomed Bride",address:" Michigan State University, 289 Van Ness Blvd, London, UK"},{type:"Author",guid:"4995bc3735a84",fullName:"Lawrie Toyley 1",bookTitle:"The Night of the Ice",address:" University of Southampton, 367 University Loop, Palo Alto, CA"},{type:"Author",guid:"4995bc3735a98",fullName:"Gladwyn Handyside 1",bookTitle:"The Fury Face",address:" Springfield University, 350 University Loop, Wichita, KS"},{type:"Author",guid:"4995bc3735ab0",fullName:"Raphael Wilks 4",bookTitle:"Myth of Madness",address:" CalTech, 187 Fifth Ave, London, UK"},{type:"Author",guid:"4995bc3735ad1",fullName:"Matilda Rockwell 3",bookTitle:"The Unearthly Assassin",address:" Stanford University, 84 Fifth Ave, Southampton, UK"},{type:"Author",guid:"4995bc3735ae5",fullName:"Alan Brown 4",bookTitle:"The Menace of the Visitor",address:" Springfield University, 45 Oak Ave, Santa Clara, CA"},{type:"Author",guid:"4995bc3735af8",fullName:"Romy Ward 3",bookTitle:"The Space Underworld",address:" Harvard, 387 Lazaneo St, Los Angeles, CA"},{type:"Author",guid:"4995bc3735b0c",fullName:"Eldreda Flick 2",bookTitle:"The Death of the Dominators",address:" MIT, 453 Oak Ave, Santa Clara, CA"},{type:"Author",guid:"4995bc3735b20",fullName:"Em Leichter 1",bookTitle:"The Future Web",address:" University of Southampton, 291 First St, Santa Clara, CA"},{type:"Author",guid:"4995bc3735b34",fullName:"Janella Warner 3",bookTitle:"The Final Claws",address:" Springfield University, 398 Castro St, New York, NY"},{type:"Author",guid:"4995bc3735b48",fullName:"Chip Haynes 3",bookTitle:"The Menace Thieves",address:" Michigan State University, 490 Broadway Blvd, Seattle, WA"},{type:"Author",guid:"4995bc3735b5c",fullName:"Lita Rumbaugh 3",bookTitle:"The Child of Space",address:" Springfield University, 444 First St, Ann Arbor, MI"},{type:"Author",guid:"4995bc3735b6f",fullName:"Zena Giesler 3",bookTitle:"The Deadly Memories",address:" Harvard, 420 Main St, Ann Arbor, MI"},{type:"Author",guid:"4995bc3735b83",fullName:"Polly Van 3",bookTitle:"Horns of Day",address:" New York University, 57 Dana St, Palo Alto, CA"},{type:"Author",guid:"4995bc3735b97",fullName:"Ceara Sanner 1",bookTitle:"The Evil Assassin",address:" Michigan State University, 410 Second St, St. Louis, MO"},{type:"Author",guid:"4995bc3735bab",fullName:"Nola Bell 4",bookTitle:"The Last Alien",address:" Harvard, 261 Oak Ave, Seattle, WA"},{type:"Author",guid:"4995bc3735bbf",fullName:"Hamilton Heyman 1",bookTitle:"The Minds of Madness",address:" New York University, 352 Fifth Ave, Cambridge, MA"},{type:"Author",guid:"4995bc3735bd2",fullName:"Neville Mildred 3",bookTitle:"Mutants of Night",address:" CalTech, 115 University Loop, Ann Arbor, MI"},{type:"Author",guid:"4995bc3735be6",fullName:"Fran Willcox 4",bookTitle:"The Menace of the Spider",address:" London University, 432 Second St, San Francisco, CA"},{type:"Author",guid:"4995bc3735bfa",fullName:"Matty Cypret 3",bookTitle:"The Day of the Vengeance",address:" College University, 218 Lazaneo St, Cupertino, CA"},{type:"Author",guid:"4995bc3735c0e",fullName:"Austen Fonblanque 4",bookTitle:"The Space Reign",address:" Foothill College, 142 Bloom St, Cupertino, CA"},{type:"Author",guid:"4995bc3735c21",fullName:"Felix Mitchell 4",bookTitle:"God of Doom",address:" Foothill College, 45 Castro St, Wichita, KS"},{type:"Author",guid:"4995bc3735c35",fullName:"Matty Cypret 3",bookTitle:"The Night of the Leisure",address:" London University, 9 Fifth Ave, Seattle, WA"},{type:"Author",guid:"4995bc3735c49",fullName:"Cassarah Vinsant 4",bookTitle:"The Seed of Night",address:" Michigan State University, 20 Van Ness Blvd, London, UK"},{type:"Author",guid:"4995bc3735c5d",fullName:"Vernon Perkins 1",bookTitle:"Reign of Night",address:" MIT, 274 Fifth Ave, Cupertino, CA"},{type:"Author",guid:"4995bc3735c71",fullName:"Shirley Mingle 2",bookTitle:"The Smugglers of Menace",address:" Harvard, 125 Dana St, Cambridge, MA"},{type:"Author",guid:"4995bc3735c85",fullName:"Kemp Lord 4",bookTitle:"The Horror Angel",address:" London University, 159 Second St, Palo Alto, CA"},{type:"Author",guid:"4995bc3735c98",fullName:"Kermit Throckmorton 1",bookTitle:"The Tenth Web",address:" London University, 106 Van Ness Blvd, Palo Alto, CA"},{type:"Author",guid:"4995bc3735cb3",fullName:"Delma Auman 4",bookTitle:"Killer of Night",address:" University of Southampton, 226 Second St, Cambridge, MA"},{type:"Author",guid:"4995bc3735cc7",fullName:"Marly Friedline 4",bookTitle:"Runaway of Horror",address:" Foothill College, 256 Dana St, San Francisco, CA"},{type:"Author",guid:"4995bc3735cdb",fullName:"Noah Kline 4",bookTitle:"The Menace of the Ragnarok",address:" Springfield University, 63 Bloom St, St. Louis, MO"},{type:"Author",guid:"4995bc3735cef",fullName:"Wendy Sayre 1",bookTitle:"History of Doom",address:" New York University, 39 Castro St, Southampton, UK"},{type:"Author",guid:"4995bc3735d03",fullName:"Izzy Wyatt 4",bookTitle:"The Assassin of Fear",address:" University of Southampton, 73 Bloom St, Los Angeles, CA"},{type:"Author",guid:"4995bc3735d17",fullName:"Ann Sachse 2",bookTitle:"The Doom Fury",address:" CalTech, 133 Elm St, Ann Arbor, MI"},{type:"Author",guid:"4995bc3735d2b",fullName:"Ebba Hil 1",bookTitle:"Talons of Madness",address:" Harvard, 54 Broadway Blvd, Santa Clara, CA"},{type:"Author",guid:"4995bc3735d3f",fullName:"Alexina Compton 2",bookTitle:"War of Time",address:" University of Southampton, 44 Main St, St. Louis, MO"},{type:"Author",guid:"4995bc3735d53",fullName:"Sybella Henley 2",bookTitle:"The Illusion Revelation",address:" UC Santa Cruz, 107 Van Ness Blvd, Santa Clara, CA"},{type:"Author",guid:"4995bc3735d66",fullName:"Tylar Monahan 1",bookTitle:"Image of Space",address:" London University, 126 Second St, Los Angeles, CA"},{type:"Author",guid:"4995bc3735d7a",fullName:" 4",bookTitle:"The False Masque",address:" MIT, 318 Oak Ave, Wichita, KS"},{type:"Author",guid:"4995bc3735d91",fullName:"Lorrin Reichard 2",bookTitle:"The Fear of the Androids",address:" Springfield University, 467 Main St, Cambridge, MA"},{type:"Author",guid:"4995bc3735da5",fullName:"Harriette Alington 1",bookTitle:"The Future of Time",address:" Stanford University, 5 Castro St, St. Louis, MO"},{type:"Author",guid:"4995bc3735db9",fullName:"Dominic Groah 3",bookTitle:"Smuggler of Day",address:" UC Santa Cruz, 246 Fifth Ave, St. Louis, MO"},{type:"Author",guid:"4995bc3735dcc",fullName:"Everard Richardson 1",bookTitle:"The Revelation",address:" Springfield University, 261 Dana St, Seattle, WA"},{type:"Author",guid:"4995bc3735de0",fullName:"Gladwyn Handyside 2",bookTitle:"The Secret Monster",address:" UC Santa Cruz, 94 Main St, Wichita, KS"},{type:"Author",guid:"4995bc3735df4",fullName:"Kyla Moore 3",bookTitle:"The Horror Robot",address:" Santa Clara University, 456 Castro St, London, UK"},{type:"Author",guid:"4995bc3735e08",fullName:"Latonya Roche 4",bookTitle:"The Machines Spider",address:" Michigan State University, 429 Elm St, Palo Alto, CA"},{type:"Author",guid:"4995bc3735e1c",fullName:"Chanel Boyd 2",bookTitle:"The Horror of the Minds",address:" London University, 482 Elm St, Southampton, UK"},{type:"Author",guid:"4995bc3735e2f",fullName:"Delice Kimmons 4",bookTitle:"The Death of the Memory",address:" MIT, 257 Broadway Blvd, Palo Alto, CA"},{type:"Author",guid:"4995bc3735e43",fullName:"Cornelius Metzer 2",bookTitle:"City of Menace",address:" Springfield University, 353 Bloom St, Wichita, KS"},{type:"Author",guid:"4995bc3735e57",fullName:"Meg Coveney 2",bookTitle:"The Assassin of Fear",address:" College University, 348 Lazaneo St, Los Angeles, CA"},{type:"Author",guid:"4995bc3735e6a",fullName:"Roxanna Loewentsein 2",bookTitle:"The Riders of Death",address:" CalTech, 125 Bloom St, St. Louis, MO"},{type:"Author",guid:"4995bc3735e7e",fullName:"Emmett Agg 2",bookTitle:"The Last Mists",address:" UC Santa Cruz, 210 Oak Ave, Los Angeles, CA"},{type:"Author",guid:"4995bc3735e99",fullName:"Junior Christman 4",bookTitle:"Ragnarok of Space",address:" Foothill College, 264 Second St, Palo Alto, CA"},{type:"Author",guid:"4995bc3735eae",fullName:"Wendy Sayre 2",bookTitle:"The Madness Myth",address:" University of Southampton, 398 Bloom St, Santa Clara, CA"},{type:"Author",guid:"4995bc3735ec0",fullName:"Amandine Catlay 1",bookTitle:"The Night Inferno",address:" MIT, 364 Oak Ave, Santa Clara, CA"},{type:"Author",guid:"4995bc3735ed8",fullName:"Gordon Zadovsky 4",bookTitle:"The Key of Death",address:" Foothill College, 68 Fifth Ave, Los Angeles, CA"},{type:"Author",guid:"4995bc3735eec",fullName:"Earline Judge 1",bookTitle:"The Doom of the Claws",address:" CalTech, 462 Bloom St, London, UK"},{type:"Author",guid:"4995bc3735f00",fullName:"Chryssa Robertson 3",bookTitle:"The Fear of Day",address:" New York University, 323 First St, San Francisco, CA"},{type:"Author",guid:"4995bc3735f14",fullName:"Tim Beck 4",bookTitle:"The Fear of the Arc",address:" New York University, 287 Lazaneo St, Seattle, WA"},{type:"Author",guid:"4995bc3735f28",fullName:"Sarah Chapman 4",bookTitle:"Pyramids of Menace",address:" University of Southampton, 289 Lazaneo St, Los Angeles, CA"},{type:"Author",guid:"4995bc3735f3b",fullName:"Serrena Canham 2",bookTitle:"The Ultimate Seed",address:" Springfield University, 268 Castro St, Seattle, WA"},{type:"Author",guid:"4995bc3735f4f",fullName:"Pierce Conrad 4",bookTitle:"Future of Night",address:" New York University, 44 Elm St, Southampton, UK"},{type:"Author",guid:"4995bc3735f63",fullName:"Sheard Alcocke 1",bookTitle:"The Claws of Day",address:" Springfield University, 23 Van Ness Blvd, Wichita, KS"},{type:"Author",guid:"4995bc3735f77",fullName:"Prue Putnam 1",bookTitle:"Robbers of Doom",address:" College University, 244 Main St, San Francisco, CA"},{type:"Author",guid:"4995bc3735f8a",fullName:"Kezia Henry 3",bookTitle:"Creature of Space",address:" Stanford University, 440 Lazaneo St, New York, NY"},{type:"Author",guid:"4995bc3735f9f",fullName:"Chrystal Prevatt 4",bookTitle:"The Day of the Mirror",address:" New York University, 135 Main St, Cupertino, CA"},{type:"Author",guid:"4995bc3735fb3",fullName:"Kim Oppenheimer 2",bookTitle:"The Killers of Time",address:" London University, 226 Oak Ave, Cambridge, MA"},{type:"Author",guid:"4995bc3735fc8",fullName:"Adolph Hayhurst 2",bookTitle:"Messenger of Fear",address:" MIT, 298 Fifth Ave, Ann Arbor, MI"},{type:"Author",guid:"4995bc3735fdb",fullName:"Luann Garneis 1",bookTitle:"The Masque",address:" Santa Clara University, 109 Van Ness Blvd, Cupertino, CA"},{type:"Author",guid:"4995bc3735ff0",fullName:"Hazel Holts 4",bookTitle:"The Pirate Memory",address:" Santa Clara University, 241 Dana St, London, UK"},{type:"Author",guid:"4995bc3736005",fullName:"Brittney Lowe 1",bookTitle:"The Time Smugglers",address:" Springfield University, 216 University Loop, Palo Alto, CA"},{type:"Author",guid:"4995bc3736367",fullName:"Missie Marjorie 2",bookTitle:"The Computer Time",address:" Michigan State University, 306 Elm St, New York, NY"},{type:"Author",guid:"4995bc3736381",fullName:"Blondie Rogers 3",bookTitle:"The Empty Runaway",address:" UC Santa Cruz, 336 Castro St, Seattle, WA"},{type:"Author",guid:"4995bc3736396",fullName:"Kyla Moore 2",bookTitle:"The First Cave",address:" Michigan State University, 269 University Loop, Santa Clara, CA"},{type:"Author",guid:"4995bc37363ab",fullName:"Kaylynn Herndon 4",bookTitle:"The Time of the Seeds",address:" Stanford University, 201 Bloom St, Seattle, WA"},{type:"Author",guid:"4995bc37363bf",fullName:"Jancis Busk 1",bookTitle:"The Ultimate Resurrection",address:" Harvard, 314 Main St, London, UK"},{type:"Author",guid:"4995bc37363e0",fullName:"Linnie Fraser 3",bookTitle:"The God",address:" University of Southampton, 302 Fifth Ave, San Francisco, CA"},{type:"Author",guid:"4995bc37363f5",fullName:"Tyrell Riggle 1",bookTitle:"Visitors of Time",address:" University of Southampton, 258 First St, Southampton, UK"},{type:"Author",guid:"4995bc373640a",fullName:"Luanne Mens 3",bookTitle:"The Day Sea",address:" Stanford University, 422 Fifth Ave, San Francisco, CA"},{type:"Author",guid:"4995bc373641e",fullName:"Everitt Thompson 3",bookTitle:"The Enemies",address:" University of Southampton, 57 Fifth Ave, Cambridge, MA"},{type:"Author",guid:"4995bc3736432",fullName:"Robynne Unk 4",bookTitle:"The Fear of the Devil",address:" Springfield University, 326 Castro St, Cambridge, MA"},{type:"Author",guid:"4995bc373644e",fullName:"Lake Elder 1",bookTitle:"Spiders of Death",address:" University of Southampton, 237 Fifth Ave, Santa Clara, CA"},{type:"Author",guid:"4995bc3736465",fullName:"Gale Cross 4",bookTitle:"The Mutants",address:" Foothill College, 323 Broadway Blvd, St. Louis, MO"},{type:"Author",guid:"4995bc3736479",fullName:"Amy Mcelroy 4",bookTitle:"The Caves of Madness",address:" MIT, 255 Fifth Ave, San Francisco, CA"},{type:"Author",guid:"4995bc373648d",fullName:"Lowell Holtzer 3",bookTitle:"The Spider",address:" College University, 370 Oak Ave, Cambridge, MA"},{type:"Author",guid:"4995bc37364a1",fullName:"Zola Haines 4",bookTitle:"The Fear of the Mist",address:" New York University, 286 Fifth Ave, Palo Alto, CA"},{type:"Author",guid:"4995bc37364b4",fullName:"Pearce Swartzbaugh 4",bookTitle:"The Menace Killers",address:" Stanford University, 34 Dana St, New York, NY"},{type:"Author",guid:"4995bc37364cc",fullName:"Lorayne Losey 1",bookTitle:"The Messenger",address:" Springfield University, 70 University Loop, Cupertino, CA"},{type:"Author",guid:"4995bc37364e0",fullName:"Perdita Casteel 3",bookTitle:"Illusion of Doom",address:" College University, 103 First St, Los Angeles, CA"},{type:"Author",guid:"4995bc37364f4",fullName:"Jules Leech 4",bookTitle:"The Dominator",address:" Foothill College, 405 Broadway Blvd, St. Louis, MO"},{type:"Author",guid:"4995bc3736508",fullName:"Reagan Ironmonger 1",bookTitle:"Hive of Menace",address:" London University, 447 University Loop, Los Angeles, CA"},{type:"Author",guid:"4995bc373651c",fullName:"Bevis Powers 3",bookTitle:"The Sun of Death",address:" Foothill College, 447 Main St, Santa Clara, CA"},{type:"Author",guid:"4995bc3736530",fullName:"Kip Mosser 4",bookTitle:"The Door of Space",address:" Stanford University, 294 University Loop, London, UK"},{type:"Author",guid:"4995bc3736543",fullName:"Jilly Poorbaugh 3",bookTitle:"The Doom of the Battlefield",address:" Harvard, 360 Elm St, Los Angeles, CA"},{type:"Author",guid:"4995bc3736557",fullName:"Chip Haynes 1",bookTitle:"The Unearthly Androids",address:" MIT, 483 Elm St, Cupertino, CA"},{type:"Author",guid:"4995bc373656b",fullName:"Daffodil Harper 4",bookTitle:"The War of Fury",address:" Michigan State University, 483 Second St, Palo Alto, CA"},{type:"Author",guid:"4995bc373657f",fullName:"Dorthy Wilson 2",bookTitle:"The Mind Crime",address:" Michigan State University, 412 Broadway Blvd, Seattle, WA"},{type:"Author",guid:"4995bc3736593",fullName:"Ridley Ewing 3",bookTitle:"The Night of the Universe",address:" New York University, 287 First St, Wichita, KS"},{type:"Author",guid:"4995bc37365a7",fullName:"Brennan Whishaw 1",bookTitle:"The War of Fury",address:" University of Southampton, 499 First St, Los Angeles, CA"},{type:"Author",guid:"4995bc37365bb",fullName:"Hale Alliman 1",bookTitle:"Devils of Fury",address:" Foothill College, 265 Main St, Southampton, UK"},{type:"Author",guid:"4995bc37365d6",fullName:"Petronella Eckhardstein 1",bookTitle:"The Mind Massacre",address:" MIT, 78 Castro St, St. Louis, MO"},{type:"Author",guid:"4995bc37365ea",fullName:"Maurice Bagley 4",bookTitle:"The Decay Claws",address:" Foothill College, 159 Fifth Ave, Ann Arbor, MI"},{type:"Author",guid:"4995bc37365fe",fullName:"Shaun Drabble 3",bookTitle:"The Fang Secret",address:" Michigan State University, 79 Broadway Blvd, Wichita, KS"},{type:"Author",guid:"4995bc3736612",fullName:"Brady Smail 3",bookTitle:"Sound of Time",address:" UC Santa Cruz, 456 Elm St, Los Angeles, CA"},{type:"Author",guid:"4995bc3736626",fullName:"Juliet Shaw 3",bookTitle:"The Ghost Universe",address:" New York University, 379 Castro St, Los Angeles, CA"},{type:"Author",guid:"4995bc373663a",fullName:"Lorayne Losey 3",bookTitle:"The Jaws of Death",address:" Michigan State University, 398 University Loop, Ann Arbor, MI"},{type:"Author",guid:"4995bc373664e",fullName:"Lisha Enderly 4",bookTitle:"The Web",address:" Santa Clara University, 86 Broadway Blvd, Ann Arbor, MI"},{type:"Author",guid:"4995bc3736662",fullName:"Becky Davis 1",bookTitle:"The Doom of the Claws",address:" London University, 284 Van Ness Blvd, New York, NY"},{type:"Author",guid:"4995bc3736676",fullName:"Leyton Jyllian 3",bookTitle:"Operation of Night",address:" MIT, 137 Dana St, Wichita, KS"},{type:"Author",guid:"4995bc373668a",fullName:"Alice Yates 1",bookTitle:"The Madness of the Spiders",address:" Stanford University, 484 First St, London, UK"},{type:"Author",guid:"4995bc373669d",fullName:"Lemoine James 1",bookTitle:"The Deadly Mutants",address:" Springfield University, 359 Oak Ave, Cambridge, MA"},{type:"Author",guid:"4995bc37366b1",fullName:"Baylee Raybould 1",bookTitle:"Curse of Fear",address:" Michigan State University, 154 Lazaneo St, London, UK"},{type:"Author",guid:"4995bc37366c5",fullName:"Ford Steiner 2",bookTitle:"The Masque of Doom",address:" Michigan State University, 390 Second St, Southampton, UK"},{type:"Author",guid:"4995bc37366d9",fullName:"Laureen Moon 1",bookTitle:"The Fear Memories",address:" Stanford University, 372 Castro St, Ann Arbor, MI"},{type:"Author",guid:"4995bc37366ed",fullName:"Colin Hair 4",bookTitle:"The Time of the Secret",address:" Springfield University, 464 Bloom St, Cupertino, CA"},{type:"Author",guid:"4995bc3736701",fullName:"Haven Crissman 1",bookTitle:"The Armageddon Laboratory",address:" College University, 141 Lazaneo St, Palo Alto, CA"},{type:"Author",guid:"4995bc373671a",fullName:"Ludmilla Candles 2",bookTitle:"The Pyramids",address:" CalTech, 303 Bloom St, Southampton, UK"},{type:"Author",guid:"4995bc373672f",fullName:"Alberta Fowler 1",bookTitle:"The Day of the Door",address:" London University, 271 University Loop, Cambridge, MA"},{type:"Author",guid:"4995bc3736744",fullName:"Lowell Holtzer 3",bookTitle:"The Night of the Bandits",address:" University of Southampton, 173 Second St, Seattle, WA"},{type:"Author",guid:"4995bc3736758",fullName:"Lesley Sanforth 4",bookTitle:"Robbers of Doom",address:" University of Southampton, 129 Van Ness Blvd, Seattle, WA"},{type:"Author",guid:"4995bc373676c",fullName:"Vic Close 1",bookTitle:"The Bride of Horror",address:" MIT, 390 Main St, Santa Clara, CA"},{type:"Author",guid:"4995bc3736780",fullName:"Lorraine Butler 2",bookTitle:"The Time of the Seeds",address:" New York University, 13 Oak Ave, Wichita, KS"},{type:"Author",guid:"4995bc3736794",fullName:"Cedar Garry 3",bookTitle:"The Madness Myth",address:" CalTech, 45 Fifth Ave, New York, NY"},{type:"Author",guid:"4995bc37367a8",fullName:"Sinclair Dale 2",bookTitle:"The Night of the Dominator",address:" New York University, 493 Bloom St, Cambridge, MA"},{type:"Author",guid:"4995bc37367bc",fullName:"Goldie Pickering 1",bookTitle:"Menace of Day",address:" University of Southampton, 216 First St, St. Louis, MO"},{type:"Author",guid:"4995bc37367cf",fullName:"Kaleigh Brooks 2",bookTitle:"The Doom Fury",address:" UC Santa Cruz, 189 Bloom St, London, UK"},{type:"Author",guid:"4995bc37367e3",fullName:"Rain Joyce 3",bookTitle:"The Day",address:" New York University, 499 Dana St, Palo Alto, CA"},{type:"Author",guid:"4995bc37367f7",fullName:"Merton Fillmore 3",bookTitle:"Dreams of Menace",address:" Santa Clara University, 98 Bloom St, Cambridge, MA"},{type:"Author",guid:"4995bc373680b",fullName:"Bekki Blunt 4",bookTitle:"The Whispers of Day",address:" UC Santa Cruz, 112 Lazaneo St, Ann Arbor, MI"},{type:"Author",guid:"4995bc373681f",fullName:"Godric Sommer 1",bookTitle:"Men of Night",address:" College University, 88 Lazaneo St, New York, NY"},{type:"Author",guid:"4995bc3736832",fullName:"Thorburn Smith 4",bookTitle:"Door of Horror",address:" CalTech, 401 Elm St, Santa Clara, CA"},{type:"Author",guid:"4995bc3736846",fullName:"Frankie Giesen 3",bookTitle:"The Jaws",address:" Harvard, 117 Van Ness Blvd, London, UK"},{type:"Author",guid:"4995bc373685a",fullName:"Brock Young 3",bookTitle:"The Killer Key",address:" New York University, 225 Van Ness Blvd, Santa Clara, CA"},{type:"Author",guid:"4995bc373686e",fullName:"Pleasance Mcloskey 1",bookTitle:"Sound of Fear",address:" College University, 331 Fifth Ave, Cupertino, CA"},{type:"Author",guid:"4995bc3736881",fullName:"Colin Hair 3",bookTitle:"The Faceless Universe",address:" Harvard, 185 Broadway Blvd, New York, NY"},{type:"Author",guid:"4995bc3736895",fullName:"Jo Brindle 2",bookTitle:"The Day Ice",address:" UC Santa Cruz, 278 Fifth Ave, Palo Alto, CA"},{type:"Author",guid:"4995bc37368a9",fullName:"Loreen Buck 2",bookTitle:"Underworld of Space",address:" Harvard, 385 Main St, London, UK"},{type:"Author",guid:"4995bc37368bd",fullName:"Darrell Reade 4",bookTitle:"The Madness Seeds",address:" UC Santa Cruz, 423 Dana St, Cambridge, MA"},{type:"Author",guid:"4995bc37368d0",fullName:"Delice Kimmons 2",bookTitle:"The Fear of the Key",address:" MIT, 161 First St, New York, NY"},{type:"Author",guid:"4995bc37368e4",fullName:"Bettye Bode 1",bookTitle:"The Thieves of Time",address:" College University, 207 Main St, Southampton, UK"},{type:"Author",guid:"4995bc37368f8",fullName:"Dillon Rowe 3",bookTitle:"The Mind Wings",address:" Foothill College, 374 Broadway Blvd, Cambridge, MA"},{type:"Author",guid:"4995bc373690c",fullName:"Bennett Little 4",bookTitle:"The Day Nemesis",address:" MIT, 129 Lazaneo St, Los Angeles, CA"},{type:"Author",guid:"4995bc373691f",fullName:"Bevis Powers 4",bookTitle:"The Horror of Madness",address:" Santa Clara University, 68 Oak Ave, St. Louis, MO"},{type:"Author",guid:"4995bc3736933",fullName:"Perce Pennington 3",bookTitle:"The Massacre",address:" New York University, 432 Bloom St, Los Angeles, CA"},{type:"Author",guid:"4995bc3736947",fullName:"America Thigpen 4",bookTitle:"The Long Suns",address:" University of Southampton, 217 University Loop, Cupertino, CA"},{type:"Author",guid:"4995bc373695b",fullName:"Lyndsea Roberts 4",bookTitle:"The Keeper",address:" UC Santa Cruz, 153 Fifth Ave, Los Angeles, CA"},{type:"Author",guid:"4995bc373696f",fullName:"Loreen Buck 1",bookTitle:"The Space of the Devil",address:" CalTech, 65 University Loop, Santa Clara, CA"},{type:"Author",guid:"4995bc3736983",fullName:"Unique Whitten 1",bookTitle:"Infinity of Night",address:" University of Southampton, 238 Dana St, Ann Arbor, MI"},{type:"Author",guid:"4995bc3736997",fullName:"Bernadine Raub 4",bookTitle:"The Menace of the Ark",address:" London University, 369 Dana St, London, UK"},{type:"Author",guid:"4995bc37369b2",fullName:"Gabe Milliron 4",bookTitle:"The Machines",address:" UC Santa Cruz, 331 University Loop, London, UK"},{type:"Author",guid:"4995bc37369c6",fullName:"Ronda Higgens 2",bookTitle:"Spiders of Death",address:" Foothill College, 496 Castro St, Cupertino, CA"},{type:"Author",guid:"4995bc37369da",fullName:"Oscar Camp 2",bookTitle:"The Day of the Computers",address:" Santa Clara University, 292 Fifth Ave, New York, NY"},{type:"Author",guid:"4995bc37369ed",fullName:"Hudson Cable 4",bookTitle:"The Fury of the Angel",address:" Stanford University, 116 Oak Ave, San Francisco, CA"},{type:"Author",guid:"4995bc3736a01",fullName:"Willis Costello 4",bookTitle:"The Ghosts of Day",address:" Foothill College, 370 Castro St, Cupertino, CA"},{type:"Author",guid:"4995bc3736a15",fullName:"Douglas Bennett 3",bookTitle:"The Universe",address:" New York University, 74 University Loop, Seattle, WA"},{type:"Author",guid:"4995bc3736a29",fullName:"Chonsie Conkle 1",bookTitle:"The Seas of Fear",address:" Santa Clara University, 479 Main St, London, UK"},{type:"Author",guid:"4995bc3736a3c",fullName:"Lalage Schmidt 3",bookTitle:"The Fear of the Awakening",address:" CalTech, 415 Elm St, St. Louis, MO"},{type:"Author",guid:"4995bc3736a50",fullName:"Patton Kooser 1",bookTitle:"The Madness Nightmares",address:" Stanford University, 38 University Loop, Los Angeles, CA"},{type:"Author",guid:"4995bc3736a64",fullName:"Mya Eckert 3",bookTitle:"The Tenth Web",address:" Harvard, 89 Dana St, New York, NY"},{type:"Author",guid:"4995bc3736a78",fullName:"Kayleen Trout 2",bookTitle:"The Riders",address:" London University, 355 Second St, Wichita, KS"},{type:"Author",guid:"4995bc3736a8c",fullName:"Tawnie Vorrasi 2",bookTitle:"The Runaway Gods",address:" College University, 183 Elm St, Southampton, UK"},{type:"Author",guid:"4995bc3736aa0",fullName:"Marian Gearhart 4",bookTitle:"The Pyramids of Death",address:" UC Santa Cruz, 176 First St, Cambridge, MA"},{type:"Author",guid:"4995bc3736ab4",fullName:"York Merryman 2",bookTitle:"The Horns",address:" New York University, 154 Castro St, Ann Arbor, MI"},{type:"Author",guid:"4995bc3736ac8",fullName:"Dene Fair 1",bookTitle:"The Menace Pyramid",address:" MIT, 226 First St, Santa Clara, CA"},{type:"Author",guid:"4995bc3736adb",fullName:"Konnor Wells 4",bookTitle:"Planet of Death",address:" UC Santa Cruz, 94 Fifth Ave, Ann Arbor, MI"},{type:"Author",guid:"4995bc3736aef",fullName:"Chanel Boyd 4",bookTitle:"The Horror Alien",address:" CalTech, 125 Broadway Blvd, Cupertino, CA"},{type:"Author",guid:"4995bc3736b03",fullName:"Crispian Nickolson 2",bookTitle:"The Impossible Armageddon",address:" CalTech, 67 Oak Ave, Los Angeles, CA"},{type:"Author",guid:"4995bc3736b1d",fullName:"Elouise Langston 3",bookTitle:"The Doom of the Night",address:" New York University, 48 University Loop, Ann Arbor, MI"},{type:"Author",guid:"4995bc3736b33",fullName:"Eliza Ropes 4",bookTitle:"The Mirror",address:" CalTech, 158 University Loop, Southampton, UK"},{type:"Author",guid:"4995bc3736b46",fullName:"Raynard Peters 3",bookTitle:"Child of Fear",address:" MIT, 385 Lazaneo St, Seattle, WA"},{type:"Author",guid:"4995bc3736b5a",fullName:"Kaylynn Herndon 4",bookTitle:"The Reign",address:" Stanford University, 237 Van Ness Blvd, Cambridge, MA"},{type:"Author",guid:"4995bc3736b6e",fullName:"Priscilla Dean 4",bookTitle:"The Space of the Horn",address:" CalTech, 317 First St, St. Louis, MO"},{type:"Author",guid:"4995bc3736b81",fullName:"Leighton Wickes 3",bookTitle:"Pyramids of Menace",address:" Springfield University, 313 Oak Ave, Los Angeles, CA"},{type:"Author",guid:"4995bc3736b9c",fullName:"Anneka Gist 3",bookTitle:"The God",address:" Foothill College, 6 University Loop, Los Angeles, CA"},{type:"Author",guid:"4995bc3736bb0",fullName:"Roseanne Rowley 2",bookTitle:"The Horror of the Ice",address:" Harvard, 253 First St, Seattle, WA"},{type:"Author",guid:"4995bc3736bc4",fullName:"Brandi Bauerle 1",bookTitle:"The Children of Madness",address:" Foothill College, 497 First St, Santa Clara, CA"},{type:"Author",guid:"4995bc3736bd8",fullName:"Kaitlyn Paul 3",bookTitle:"The Mind Massacre",address:" College University, 490 Lazaneo St, St. Louis, MO"},{type:"Author",guid:"4995bc3736beb",fullName:"Silvester Mcfall 3",bookTitle:"The Fear Child",address:" CalTech, 348 Broadway Blvd, St. Louis, MO"},{type:"Author",guid:"4995bc3736bff",fullName:"Woodrow Fleming 2",bookTitle:"The Empty Fear",address:" Springfield University, 340 First St, Los Angeles, CA"},{type:"Author",guid:"4995bc3736c13",fullName:"Wynonna Erskine 3",bookTitle:"Cave of Night",address:" UC Santa Cruz, 37 Castro St, Ann Arbor, MI"},{type:"Author",guid:"4995bc3736c27",fullName:"Lawrie Toyley 2",bookTitle:"The Horror City",address:" Stanford University, 172 University Loop, Southampton, UK"},{type:"Author",guid:"4995bc3736c3b",fullName:"Breana Bastion 3",bookTitle:"The Doomed Whisper",address:" London University, 157 Lazaneo St, Cupertino, CA"},{type:"Author",guid:"4995bc3736c4e",fullName:"Delice Kimmons 2",bookTitle:"The Space of the Leisure",address:" Stanford University, 308 Bloom St, Seattle, WA"},{type:"Author",guid:"4995bc3736c62",fullName:"Sybella Henley 2",bookTitle:"The Armageddon",address:" University of Southampton, 314 Lazaneo St, New York, NY"},{type:"Author",guid:"4995bc3736c76",fullName:"Sebastian Stone 2",bookTitle:"The Stone",address:" Springfield University, 348 Second St, St. Louis, MO"},{type:"Author",guid:"4995bc3736c8a",fullName:"Perdita Casteel 2",bookTitle:"The Space Alien",address:" Stanford University, 38 Castro St, Santa Clara, CA"},{type:"Author",guid:"4995bc3736c9e",fullName:"Lyndsea Roberts 4",bookTitle:"The Fear Paradise",address:" New York University, 433 Second St, Ann Arbor, MI"},{type:"Author",guid:"4995bc3736cb2",fullName:"Reanna Meyers 2",bookTitle:"Image of Menace",address:" MIT, 452 Second St, San Francisco, CA"},{type:"Author",guid:"4995bc3736cc6",fullName:"Paul Parrish 4",bookTitle:"The Death Angels",address:" MIT, 468 Castro St, Ann Arbor, MI"},{type:"Author",guid:"4995bc3736cda",fullName:"Eldred West 2",bookTitle:"The Time of the Mirror",address:" College University, 420 Bloom St, Los Angeles, CA"},{type:"Author",guid:"4995bc3736ced",fullName:"Tawnie Vorrasi 2",bookTitle:"The Madness of the Horror",address:" Michigan State University, 289 Lazaneo St, Cupertino, CA"},{type:"Author",guid:"4995bc3736d01",fullName:"Vic Close 4",bookTitle:"The Death of the Pyramid",address:" New York University, 229 Main St, Southampton, UK"},{type:"Author",guid:"4995bc3736d15",fullName:"Shana Owen 4",bookTitle:"The Killer Fury",address:" London University, 438 First St, Southampton, UK"},{type:"Author",guid:"4995bc3736d29",fullName:"Lissa Tillson 1",bookTitle:"The Fear Killers",address:" Harvard, 100 Castro St, San Francisco, CA"},{type:"Author",guid:"4995bc3736d3d",fullName:"Gabriel Cherry 1",bookTitle:"The Reign of Madness",address:" Stanford University, 319 Elm St, San Francisco, CA"},{type:"Author",guid:"4995bc3736d51",fullName:"Willis Costello 4",bookTitle:"The Horror Angel",address:" UC Santa Cruz, 411 Van Ness Blvd, Ann Arbor, MI"},{type:"Author",guid:"4995bc3736d65",fullName:"Seward Romanoff 2",bookTitle:"The Day Monster",address:" University of Southampton, 371 University Loop, Wichita, KS"},{type:"Author",guid:"4995bc3736d80",fullName:"Cornelius Metzer 3",bookTitle:"Hive of Menace",address:" CalTech, 99 Second St, Seattle, WA"},{type:"Author",guid:"4995bc3736d94",fullName:"Pansy Summy 4",bookTitle:"The Day Thieves",address:" New York University, 419 University Loop, London, UK"},{type:"Author",guid:"4995bc3736da8",fullName:"Jaymes Cox 3",bookTitle:"The Fear of the Minds",address:" MIT, 54 First St, Palo Alto, CA"},{type:"Author",guid:"4995bc3736dbc",fullName:"Pansy Summy 4",bookTitle:"The Runaway Gods",address:" Foothill College, 85 Elm St, Palo Alto, CA"},{type:"Author",guid:"4995bc3736dcf",fullName:"August Feufer 2",bookTitle:"God of Doom",address:" Michigan State University, 237 Second St, Cambridge, MA"},{type:"Author",guid:"4995bc3736de3",fullName:"Raphael Wilks 4",bookTitle:"The Creature",address:" College University, 46 Main St, Los Angeles, CA"},{type:"Author",guid:"4995bc3736df7",fullName:"Colin Hair 4",bookTitle:"The Horror Child",address:" Foothill College, 244 Castro St, Seattle, WA"},{type:"Author",guid:"4995bc3736e0a",fullName:"Colten Stange 2",bookTitle:"Dreams of Menace",address:" CalTech, 212 Fifth Ave, San Francisco, CA"},{type:"Author",guid:"4995bc3736e1e",fullName:"Chonsie Conkle 3",bookTitle:"The Menace Carnival",address:" CalTech, 470 Broadway Blvd, Southampton, UK"},{type:"Author",guid:"4995bc3736e32",fullName:"Kaleigh Brooks 4",bookTitle:"The Fury Massacre",address:" New York University, 361 Lazaneo St, Cupertino, CA"},{type:"Author",guid:"4995bc3736e46",fullName:"Kaye Harding 3",bookTitle:"The Doom of the Battlefield",address:" Harvard, 246 Castro St, San Francisco, CA"},{type:"Author",guid:"4995bc3736e59",fullName:"Kendal Ritter 1",bookTitle:"The Whisper Faces",address:" Foothill College, 80 Fifth Ave, San Francisco, CA"},{type:"Author",guid:"4995bc3736e6d",fullName:"Eleanor Bennett 4",bookTitle:"The Angels of Madness",address:" CalTech, 263 Oak Ave, San Francisco, CA"},{type:"Author",guid:"4995bc3736e81",fullName:"Lindsey Straub 3",bookTitle:"The Doom of the Jaws",address:" MIT, 146 Van Ness Blvd, St. Louis, MO"},{type:"Author",guid:"4995bc3736e95",fullName:"Fawn Carr 1",bookTitle:"Door of Space",address:" Stanford University, 22 Oak Ave, Los Angeles, CA"},{type:"Author",guid:"4995bc3736ea9",fullName:"Deshawn Pyle 3",bookTitle:"The Secret",address:" MIT, 180 University Loop, Wichita, KS"},{type:"Author",guid:"4995bc3736ebd",fullName:"Virgee Mcdonald 1",bookTitle:"The Space Mists",address:" MIT, 288 Lazaneo St, San Francisco, CA"},{type:"Author",guid:"4995bc3736ed0",fullName:"Tex Koster 4",bookTitle:"The Time Ambassador",address:" Santa Clara University, 372 Main St, Ann Arbor, MI"},{type:"Author",guid:"4995bc3736ee4",fullName:"Sorrel Dugmore 2",bookTitle:"The Robber",address:" Stanford University, 390 Oak Ave, Santa Clara, CA"},{type:"Author",guid:"4995bc3736ef8",fullName:"Beverly Harrold 2",bookTitle:"The Planet of Doom",address:" Harvard, 289 Fifth Ave, London, UK"},{type:"Author",guid:"4995bc3736f0c",fullName:"Webster Jelliman 4",bookTitle:"The Madness Masters",address:" Foothill College, 316 First St, London, UK"},{type:"Author",guid:"4995bc3736f24",fullName:"Tracee Martin 4",bookTitle:"The Minds of Fury",address:" UC Santa Cruz, 272 First St, Wichita, KS"},{type:"Author",guid:"4995bc3736f3b",fullName:"Delice Kimmons 2",bookTitle:"The Warrior of Day",address:" University of Southampton, 364 University Loop, London, UK"},{type:"Author",guid:"4995bc3736f5c",fullName:"Godric Sommer 1",bookTitle:"Robots of Menace",address:" MIT, 251 University Loop, Palo Alto, CA"},{type:"Author",guid:"4995bc3736f70",fullName:"Tatianna Johns 3",bookTitle:"The Death of the Riders",address:" Santa Clara University, 416 Oak Ave, St. Louis, MO"},{type:"Author",guid:"4995bc3736f8c",fullName:"Herbert Durstine 1",bookTitle:"The Space of the Devil",address:" New York University, 384 Fifth Ave, Seattle, WA"},{type:"Author",guid:"4995bc3736fa0",fullName:"Myron Rhodes 4",bookTitle:"The Devil",address:" London University, 8 Castro St, Los Angeles, CA"},{type:"Author",guid:"4995bc3736fb3",fullName:"Hank Hughes 2",bookTitle:"The Machine of Doom",address:" Springfield University, 42 First St, London, UK"},{type:"Author",guid:"4995bc3736fc7",fullName:"Fox Omara 2",bookTitle:"The Night of the Leisure",address:" CalTech, 468 Fifth Ave, Wichita, KS"},{type:"Author",guid:"4995bc3736fdb",fullName:"Dyan Bratton 1",bookTitle:"The Child of Space",address:" Springfield University, 463 Castro St, St. Louis, MO"},{type:"Author",guid:"4995bc3736fef",fullName:"Eleanor Bennett 4",bookTitle:"Machine of Night",address:" Springfield University, 301 Second St, London, UK"},{type:"Author",guid:"4995bc3737002",fullName:"Seward Romanoff 3",bookTitle:"The Secret Pit",address:" College University, 353 University Loop, Wichita, KS"},{type:"Author",guid:"4995bc3737016",fullName:"Erick Sulyard 1",bookTitle:"Whispers of Day",address:" Harvard, 223 Castro St, Wichita, KS"},{type:"Author",guid:"4995bc373702a",fullName:"Godric Sommer 3",bookTitle:"The Menace Mist",address:" London University, 260 Van Ness Blvd, Cupertino, CA"},{type:"Author",guid:"4995bc373703d",fullName:" 2",bookTitle:"The Horror Robot",address:" New York University, 499 Castro St, Palo Alto, CA"},{type:"Author",guid:"4995bc3737055",fullName:"Porsche Gilman 3",bookTitle:"The Time Suns",address:" CalTech, 336 First St, San Francisco, CA"},{type:"Author",guid:"4995bc3737069",fullName:"Phineas Poehl 1",bookTitle:"Ark of Day",address:" London University, 162 Bloom St, Wichita, KS"},{type:"Author",guid:"4995bc373707d",fullName:"Tylar Monahan 3",bookTitle:"The Menace of the Robbers",address:" Springfield University, 498 Broadway Blvd, Seattle, WA"},{type:"Author",guid:"4995bc3737091",fullName:"Harvey Wardle 3",bookTitle:"Mutants of Night",address:" MIT, 58 Bloom St, Ann Arbor, MI"},{type:"Author",guid:"4995bc37370a5",fullName:"Thea Sullivan 1",bookTitle:"The Night of the Dominator",address:" Santa Clara University, 443 Lazaneo St, San Francisco, CA"},{type:"Author",guid:"4995bc37370b9",fullName:"Brandie Tue 2",bookTitle:"The Fury Secret",address:" CalTech, 130 Lazaneo St, London, UK"},{type:"Author",guid:"4995bc37370cd",fullName:"Tessa Pullman 3",bookTitle:"The Menace of the Pit",address:" CalTech, 393 Oak Ave, San Francisco, CA"},{type:"Author",guid:"4995bc37370e0",fullName:"Freeman Marcotte 4",bookTitle:"The Jaws of Night",address:" Harvard, 288 Second St, Seattle, WA"},{type:"Author",guid:"4995bc37370f4",fullName:"Tex Koster 2",bookTitle:"The Madness Attack",address:" College University, 233 Fifth Ave, Ann Arbor, MI"},{type:"Author",guid:"4995bc3737108",fullName:"Barret Lalty 2",bookTitle:"The Unearthly Assassin",address:" London University, 399 Elm St, Seattle, WA"},{type:"Author",guid:"4995bc373711c",fullName:"Timotha Weeks 4",bookTitle:"The Death Face",address:" Stanford University, 302 Lazaneo St, Cambridge, MA"},{type:"Author",guid:"4995bc3737130",fullName:"Tybalt Hahn 2",bookTitle:"Masque of Space",address:" New York University, 108 Elm St, Los Angeles, CA"},{type:"Author",guid:"4995bc3737144",fullName:"Dewayne Patton 3",bookTitle:"The Armageddon",address:" Harvard, 83 Bloom St, Seattle, WA"},{type:"Author",guid:"4995bc3737158",fullName:"Tommie Keilbach 4",bookTitle:"The First Cave",address:" College University, 124 First St, Ann Arbor, MI"},{type:"Author",guid:"4995bc3737196",fullName:"Boyce Baughman 3",bookTitle:"The Stone of Madness",address:" Stanford University, 366 Second St, London, UK"},{type:"Author",guid:"4995bc37371ac",fullName:"Godric Sommer 3",bookTitle:"Killer of Night",address:" London University, 489 Oak Ave, Southampton, UK"},{type:"Author",guid:"4995bc37371c1",fullName:"Kenelm Tomco 2",bookTitle:"The Fury of the Master",address:" UC Santa Cruz, 142 Bloom St, London, UK"},{type:"Author",guid:"4995bc37371d4",fullName:"Wendell Osteen 3",bookTitle:"The Fear Awakening",address:" New York University, 419 First St, Santa Clara, CA"},{type:"Author",guid:"4995bc37371eb",fullName:"Antwan Biery 4",bookTitle:"The Day of the Invasion",address:" Santa Clara University, 445 Fifth Ave, Cupertino, CA"},{type:"Author",guid:"4995bc37371ff",fullName:"Stacy Moffat 4",bookTitle:"Door of Horror",address:" College University, 282 Oak Ave, Ann Arbor, MI"},{type:"Author",guid:"4995bc3737213",fullName:"Alyx Hincken 3",bookTitle:"The Day Nemesis",address:" CalTech, 235 University Loop, St. Louis, MO"},{type:"Author",guid:"4995bc3737227",fullName:"Silvester Mcfall 1",bookTitle:"The Monster",address:" Springfield University, 86 Lazaneo St, Southampton, UK"},{type:"Author",guid:"4995bc373723a",fullName:"Janella Warner 2",bookTitle:"The Madness Man",address:" Stanford University, 96 Dana St, Ann Arbor, MI"},{type:"Author",guid:"4995bc373724e",fullName:"Braeden Seidner 2",bookTitle:"The Menace Pit",address:" Santa Clara University, 154 Bloom St, New York, NY"},{type:"Author",guid:"4995bc3737263",fullName:"Cyrus Hatfield 2",bookTitle:"The Night Nightmares",address:" Michigan State University, 46 Van Ness Blvd, St. Louis, MO"},{type:"Author",guid:"4995bc3737277",fullName:"Carly Reiss 4",bookTitle:"The Spiders of Fear",address:" CalTech, 420 Dana St, San Francisco, CA"},{type:"Author",guid:"4995bc373728b",fullName:"Anselm Swift 4",bookTitle:"The Final Time",address:" Stanford University, 203 Main St, Seattle, WA"},{type:"Author",guid:"4995bc373729f",fullName:"Dallas Hawker 2",bookTitle:"The Day Galaxy",address:" CalTech, 195 First St, San Francisco, CA"},{type:"Author",guid:"4995bc37372b3",fullName:"Horatio Hutton 1",bookTitle:"The Time Ambassador",address:" Springfield University, 183 Castro St, Palo Alto, CA"},{type:"Author",guid:"4995bc37372c7",fullName:"Trev Hallauer 1",bookTitle:"The Final Time",address:" New York University, 51 Broadway Blvd, Los Angeles, CA"},{type:"Author",guid:"4995bc37372db",fullName:"Sharyn Quinn 4",bookTitle:"The Reign of Day",address:" Foothill College, 493 Lazaneo St, Palo Alto, CA"},{type:"Author",guid:"4995bc37372ee",fullName:"Raphael Wilks 1",bookTitle:"The Masque of Death",address:" New York University, 96 Oak Ave, Los Angeles, CA"}];
sc_require("models/record");sc_require("models/record_attribute");SC.ChildAttribute=SC.RecordAttribute.extend({isChildRecordTransform:YES,toType:function(h,g,j){var e=null,k=SC.keyFor("__kid__",SC.guidFor(this)),l=this.get("typeClass");
if(h[k]){return h[k]}if(!h){throw"SC.Child: Error during transform: Unable to retrieve parent record."
}if(j){var d=h.get("childRecordNamespace");if(j.type&&!SC.none(d)){l=d[j.type]}if(!l||SC.typeOf(l)!==SC.T_CLASS){throw"SC.Child: Error during transform: Invalid record type."
}e=h[k]=h.registerChildRecord(l,j)}return e},fromType:function(d,e,g){return g},call:function(d,e,g){var h=this.get("key")||e,k=SC.keyFor("__kid__",SC.guidFor(this)),j;
if(g!==undefined){this.orphan(d);j=this.fromType(d,e,g);d[k]=null;d.writeAttribute(h,j);
g=this.toType(d,e,g)}else{g=d.readAttribute(h);if(SC.none(g)&&(g=this.get("defaultValue"))){if(typeof g===SC.T_FUNCTION){g=this.defaultValue(d,e,this);
if(d.attributes()){d.writeAttribute(h,g,true)}}}else{g=this.toType(d,e,g)}}return g
},orphan:function(j){var m=SC.keyFor("__kid__",SC.guidFor(this)),e,k,g,h,l,d;d=j?j[m]:null;
if(d){g=d.get("readOnlyAttributes");for(h in g){l=d[h];if(l&&l.isChildRecordTransform){l.orphan(j)
}}e=d.get("store");if(e){k=d.storeKey}if(k){e.unloadRecord(undefined,undefined,k)
}}}});sc_require("core");sc_require("models/record");sc_require("system/query");SC.ChildRecord=SC.Record.extend({isChildRecord:YES,type:null,primaryKey:"childRecordKey",_parentRecord:null,status:function(){var d=SC.Record.EMPTY;
if(this._parentRecord){d=this._parentRecord.get("status");this.store.writeStatus(this.storeKey,d);
this.store.dataHashDidChange(this.storeKey)}else{d=this.store.readStatus(this.storeKey)
}return d}.property("storeKey").cacheable(),recordDidChange:function(){if(this._parentRecord&&this._parentRecord.recordDidChange){this._parentRecord.recordDidChange()
}else{arguments.callee.base.apply(this,arguments)}},createChildRecord:function(h,g){var d,e=this._parentRecord;
if(e){d=e.createChildRecord(h,g)}else{d=arguments.callee.base.apply(this,arguments)
}return d}});sc_require("models/record");sc_require("models/record_attribute");sc_require("models/child_attribute");
SC.ChildrenAttribute=SC.ChildAttribute.extend({toType:function(e,h,j){var l=this.get("key")||h,k=SC.keyFor("__kidsArray__",SC.guidFor(this)),g=e[k],m=this.get("typeClass"),d;
if(!g){g=SC.ChildArray.create({record:e,propertyName:l,defaultRecordType:m});e[k]=this._cachedRef=g;
d=e.get("relationships");if(!d){e.set("relationships",d=[])}d.push(g)}return g},orphan:function(d){var j=this._cachedRef,k,n,m,l,g,e,h;
if(j){j.forEach(function(o){m=o.get("readOnlyAttributes");for(l in m){e=o[l];if(e&&e.isChildRecordTransform){e.orphan(d)
}}k=o.get("store");if(k){n=o.storeKey}if(n){k.unloadRecord(undefined,undefined,n)
}},this)}}});sc_require("models/record");sc_require("models/record_attribute");SC.FetchedAttribute=SC.RecordAttribute.extend({paramValueKey:"link",paramOwnerKey:"owner",paramRelKey:"rel",queryKey:null,isEditable:NO,toType:function(h,n,l){var m=h.get("store");
if(!m){return null}var e=this.get("paramValueKey"),d=this.get("paramOwnerKey"),k=this.get("paramRelKey"),j=this.get("queryKey")||this.get("typeClass"),g={};
if(e){g[e]=l}if(d){g[d]=h}if(k){g[k]=this.get("key")||n}return m.findAll(j,g)},fromType:function(d,e,g){return g
}});sc_require("models/record");sc_require("models/record_attribute");SC.ManyAttribute=SC.RecordAttribute.extend({inverse:null,isMaster:YES,orderBy:null,toType:function(e,h,k){var j=this.get("typeClass"),m=this.get("key")||h,l=SC.keyFor("__manyArray__",SC.guidFor(this)),g=e[l],d;
if(!g){g=SC.ManyArray.create({recordType:j,record:e,propertyName:m,manyAttribute:this});
e[l]=g;d=e.get("relationships");if(!d){e.set("relationships",d=[])}d.push(g)}return g
},fromType:function(e,j,k){var g=[];if(!SC.isArray(k)){throw"Expects toMany attribute to be an array"
}var d=k.get("length");for(var h=0;h<d;h++){g[h]=k.objectAt(h).get("id")}return g
},inverseDidRemoveRecord:function(d,e,g,h){var j=d.get(e);if(j){j.removeInverseRecord(g)
}},inverseDidAddRecord:function(d,e,g,h){var j=d.get(e);if(j){j.addInverseRecord(g)
}}});SC.Record=SC.Object.extend({isRecord:YES,primaryKey:"guid",id:function(d,e){if(e!==undefined){this.writeAttribute(this.get("primaryKey"),e);
return e}else{return SC.Store.idFor(this.storeKey)}}.property("storeKey").cacheable(),status:function(){return this.store.readStatus(this.storeKey)
}.property("storeKey").cacheable(),store:null,storeKey:null,isDestroyed:function(){return !!(this.get("status")&SC.Record.DESTROYED)
}.property("status").cacheable(),isEditable:function(d,e){if(e!==undefined){this._screc_isEditable=e
}if(this.get("status")&SC.Record.READY){return this._screc_isEditable}else{return NO
}}.property("status").cacheable(),_screc_isEditable:YES,isLoaded:function(){var e=SC.Record,d=this.get("status");
return !((d===e.EMPTY)||(d===e.BUSY_LOADING)||(d===e.ERROR))}.property("status").cacheable(),relationships:null,attributes:function(){var d=this.get("store"),e=this.storeKey;
return d.readEditableDataHash(e)}.property(),readOnlyAttributes:function(){var d=this.get("store"),e=this.storeKey;
ret=d.readDataHash(e);if(ret){ret=SC.clone(ret)}return ret}.property(),childRecords:null,childRecordNamespace:null,refresh:function(){this.get("store").refreshRecord(null,null,this.get("storeKey"));
return this},destroy:function(){this.get("store").destroyRecord(null,null,this.get("storeKey"));
this.propertyDidChange("status");return this},recordDidChange:function(d){this.get("store").recordDidChange(null,null,this.get("storeKey"),d);
this.notifyPropertyChange("status");return this},_editLevel:0,beginEditing:function(){this._editLevel++;
return this},endEditing:function(d){if(--this._editLevel<=0){this._editLevel=0;this.recordDidChange(d)
}return this},readAttribute:function(g){var d=this.get("store"),h=this.storeKey;var e=d.readDataHash(h);
return e?e[g]:undefined},writeAttribute:function(l,h,n){var j=this.get("store"),m=this.storeKey,g=j.peekStatus(m),d=this[l],e=SC.Store.recordTypeFor(m),k;
k=j.readEditableDataHash(m);if(!k){throw SC.Record.BAD_STATE_ERROR}if(h!==k[l]){if(!n){this.beginEditing()
}k[l]=h;if(l===this.get("primaryKey")){SC.Store.replaceIdFor(m,h);this.propertyDidChange("id")
}if(!n){this.endEditing(l)}}if(!e.aggregates||e.aggregates.length>0){this.propagateToAggregates()
}return this},propagateToAggregates:function(){var s=this.get("storeKey"),g=SC.Store.recordTypeFor(s),o,l,p,d,n;
var j=g.aggregates;if(!j){var h=this.get("store").readDataHash(s);j=[];for(var e in h){if(this[e]&&this[e].get&&this[e].get("aggregate")===YES){j.push(e)
}}g.aggregates=j}var m=SC.Record;for(o=0,l=j.length;o<l;++o){p=j[o];d=this.get(p);
n=SC.kindOf(d,SC.ManyArray)?d:[d];n.forEach(function(x){if(x){var k=this.get("status");
if(k&m.DIRTY){var u=x.get("status");if(u===m.READY_CLEAN){x.get("store").recordDidChange(x.constructor,null,x.get("storeKey"),null,YES)
}}}},this)}},storeDidChangeProperties:function(d,e){if(d){this.notifyPropertyChange("status")
}else{if(e){this.beginPropertyChanges();e.forEach(function(j){this.notifyPropertyChange(j)
},this);this.notifyPropertyChange("status");this.endPropertyChanges()}else{this.allPropertiesDidChange()
}var h=this.relationships,g=h?h.length:0;while(--g>=0){h[g].recordPropertyDidChange(e)
}}},normalize:function(j){var o=this.primaryKey,g=this.get("id"),p=this.get("store"),u=this.get("storeKey"),s,m,h,y,l,x,e,d,n;
var k=p.readEditableDataHash(u)||{};k[o]=g;y=p.readDataHash(u);for(s in this){m=this[s];
if(m){h=m.typeClass;if(h){e=SC.typeOf(h.call(m))===SC.T_CLASS;d=m.isChildRecordTransform;
if(!e&&!d){l=this.get(s);if(l!==undefined||(l===null&&j)){k[s]=l}}else{if(d){l=this.get(s);
l.normalize()}else{if(e){l=y[s];if(l!==undefined){k[s]=l}else{n=m.get("defaultValue");
if(SC.typeOf(n)===SC.T_FUNCTION){k[s]=n(this,s,n)}else{k[s]=n}}}}}}}}return this},unknownProperty:function(e,h){if(h!==undefined){var g=this.get("storeKey"),j=SC.Store.recordTypeFor(g);
if(j.ignoreUnknownProperties===YES){this[e]=h;return h}var d=this.get("primaryKey");
this.writeAttribute(e,h);if(e===d){SC.Store.replaceIdFor(g,h)}}return this.readAttribute(e)
},commitRecord:function(e){var d=this.get("store");d.commitRecord(undefined,undefined,this.get("storeKey"),e);
return this},isError:function(){return this.get("status")&SC.Record.ERROR}.property("status").cacheable(),errorValue:function(){return this.get("isError")?SC.val(this.get("errorObject")):null
}.property("isError").cacheable(),errorObject:function(){if(this.get("isError")){var d=this.get("store");
return d.readError(this.get("storeKey"))||SC.Record.GENERIC_ERROR}else{return null
}}.property("isError").cacheable(),toString:function(){var d=this.get("store").readDataHash(this.get("storeKey"));
return"%@(%@) %@".fmt(this.constructor.toString(),SC.inspect(d),this.statusString())
},statusString:function(){var e=[],d=this.get("status");for(var g in SC.Record){if(g.match(/[A-Z_]$/)&&SC.Record[g]===d){e.push(g)
}}return e.join(" ")},registerChildRecord:function(k,j){var g=k.primaryKey||"childRecordKey";
var h=j[g];var e=null;var d=this.get("childRecords");if(h&&d){e=d[h]}if(SC.none(e)){e=this.createChildRecord(k,j)
}return e},createChildRecord:function(l,m){SC.RunLoop.begin();var h=SC.Record._generateChildKey();
m=m||{};var g=l.primaryKey||"childRecordKey";var k=m[g];m[g]=h;var e=this.get("store");
if(SC.none(e)){throw"Error: during the creation of a child record: NO STORE ON PARENT!"
}var j=e.createRecord(l,m);j._parentRecord=this;if(this.generateIdForChild){this.generateIdForChild(j)
}var d=this.get("childRecords");if(SC.none(d)){d=SC.Object.create();this.set("childRecords",d)
}d[h]=j;SC.RunLoop.end();return j},generateIdForChild:function(d){}});SC.Record.mixin({ignoreUnknownProperties:NO,CLEAN:1,DIRTY:2,EMPTY:256,ERROR:4096,READY:512,READY_CLEAN:513,READY_DIRTY:514,READY_NEW:515,DESTROYED:1024,DESTROYED_CLEAN:1025,DESTROYED_DIRTY:1026,BUSY:2048,BUSY_LOADING:2052,BUSY_CREATING:2056,BUSY_COMMITTING:2064,BUSY_REFRESH:2080,BUSY_REFRESH_CLEAN:2081,BUSY_REFRESH_DIRTY:2082,BUSY_DESTROYING:2112,BAD_STATE_ERROR:SC.$error("Internal Inconsistency"),RECORD_EXISTS_ERROR:SC.$error("Record Exists"),NOT_FOUND_ERROR:SC.$error("Not found "),BUSY_ERROR:SC.$error("Busy"),GENERIC_ERROR:SC.$error("Generic Error"),_nextChildKey:0,attr:function(d,e){return SC.RecordAttribute.attr(d,e)
},fetch:function(e,d){return SC.FetchedAttribute.attr(e,d)},toMany:function(h,e){e=e||{};
var g=e.nested;var d;if(g){d=SC.ChildrenAttribute.attr(h,e)}else{d=SC.ManyAttribute.attr(h,e)
}return d},toOne:function(h,e){e=e||{};var g=e.nested;var d;if(g){d=SC.ChildAttribute.attr(h,e)
}else{d=SC.SingleAttribute.attr(h,e)}return d},storeKeysById:function(){var e=SC.keyFor("storeKey",SC.guidFor(this)),d=this[e];
if(!d){d=this[e]={}}return d},storeKeyFor:function(g){var e=this.storeKeysById(),d=e[g];
if(!d){d=SC.Store.generateStoreKey();SC.Store.idsByStoreKey[d]=g;SC.Store.recordTypesByStoreKey[d]=this;
e[g]=d}return d},storeKeyExists:function(g){var e=this.storeKeysById(),d=e[g];return d
},find:function(d,e){return d.find(this,e)},extend:function(){var d=SC.Object.extend.apply(this,arguments);
SC.Query._scq_didDefineRecordType(d);return d},_generateChildKey:function(){var d=SC.Record._nextChildKey+1;
SC.Record._nextChildKey=d;return d}});sc_require("models/record");sc_require("models/child_record");
SC.RecordAttribute=SC.Object.extend({defaultValue:null,type:String,key:null,isRequired:NO,isEditable:YES,useIsoDate:YES,aggregate:NO,typeClass:function(){var d=this.get("type");
if(SC.typeOf(d)===SC.T_STRING){d=SC.objectForPropertyPath(d)}return d}.property("type").cacheable(),transform:function(){var d=this.get("typeClass")||String,g=SC.RecordAttribute.transforms,e;
while(d&&!(e=g[SC.guidFor(d)])){if(d.superclass.hasOwnProperty("create")){d=d.superclass
}else{d=SC.T_FUNCTION}}return e}.property("typeClass").cacheable(),toType:function(d,g,j){var e=this.get("transform"),h=this.get("typeClass");
if(e&&e.to){j=e.to(j,this,h,d,g)}return j},fromType:function(d,g,j){var e=this.get("transform"),h=this.get("typeClass");
if(e&&e.from){j=e.from(j,this,h,d,g)}return j},call:function(d,e,g){var h=this.get("key")||e,j;
if((g!==undefined)&&this.get("isEditable")){j=this.fromType(d,e,g);d.writeAttribute(h,j)
}j=g=d.readAttribute(h);if(SC.none(g)&&(g=this.get("defaultValue"))){if(typeof g===SC.T_FUNCTION){g=this.defaultValue(d,e,this);
if((j!==g)&&d.get("store").readDataHash(d.get("storeKey"))){d.writeAttribute(h,g,true)
}}}else{g=this.toType(d,e,g)}return g},isProperty:YES,isCacheable:YES,dependentKeys:[],init:function(){arguments.callee.base.apply(this,arguments);
this.cacheKey="__cache__"+SC.guidFor(this);this.lastSetValueKey="__lastValue__"+SC.guidFor(this)
}});SC.RecordAttribute.attr=function(d,e){if(!e){e={}}if(!e.type){e.type=d||String
}return this.create(e)};SC.RecordAttribute.transforms={};SC.RecordAttribute.registerTransform=function(d,e){SC.RecordAttribute.transforms[SC.guidFor(d)]=e
};SC.RecordAttribute.registerTransform(Boolean,{to:function(d){return SC.none(d)?null:!!d
}});SC.RecordAttribute.registerTransform(Number,{to:function(d){return SC.none(d)?null:Number(d)
}});SC.RecordAttribute.registerTransform(String,{to:function(d){if(!(typeof d===SC.T_STRING)&&!SC.none(d)&&d.toString){d=d.toString()
}return d}});SC.RecordAttribute.registerTransform(Array,{to:function(d){if(!SC.isArray(d)&&!SC.none(d)){d=[]
}return d}});SC.RecordAttribute.registerTransform(Object,{to:function(d){if(!(typeof d==="object")&&!SC.none(d)){d={}
}return d}});SC.RecordAttribute.registerTransform(SC.Record,{to:function(j,d,h,g){var e=g.get("store");
if(SC.none(j)||(j==="")){return null}else{return e.find(h,j)}},from:function(d){return d?d.get("id"):null
}});SC.RecordAttribute.registerTransform(SC.T_FUNCTION,{to:function(j,d,h,g){h=h.apply(g);
var e=g.get("store");return e.find(h,j)},from:function(d){return d.get("id")}});SC.RecordAttribute.registerTransform(Date,{to:function(n,e){if(n===null){return null
}var h;n=n.toString()||"";if(e.get("useIsoDate")){var j="([0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(\\.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?",m=n.match(new RegExp(j)),l=0,g=new Date(m[1],0,1),k;
if(m[3]){g.setMonth(m[3]-1)}if(m[5]){g.setDate(m[5])}if(m[7]){g.setHours(m[7])}if(m[8]){g.setMinutes(m[8])
}if(m[10]){g.setSeconds(m[10])}if(m[12]){g.setMilliseconds(Number("0."+m[12])*1000)
}if(m[14]){l=(Number(m[16])*60)+Number(m[17]);l*=((m[15]=="-")?1:-1)}l-=g.getTimezoneOffset();
k=(Number(g)+(l*60*1000));h=new Date();h.setTime(Number(k))}else{h=new Date(Date.parse(n))
}return h},_dates:{},_zeropad:function(d){return((d<0)?"-":"")+((d<10)?"0":"")+Math.abs(d)
},from:function(e){var d=this._dates[e.getTime()];if(d){return d}var h=this._zeropad,g=0-e.getTimezoneOffset()/60;
g=(g===0)?"Z":"%@:00".fmt(h(g));this._dates[e.getTime()]=d="%@-%@-%@T%@:%@:%@%@".fmt(h(e.getFullYear()),h(e.getMonth()+1),h(e.getDate()),h(e.getHours()),h(e.getMinutes()),h(e.getSeconds()),g);
return d}});if(SC.DateTime&&!SC.RecordAttribute.transforms[SC.guidFor(SC.DateTime)]){SC.RecordAttribute.registerTransform(SC.DateTime,{to:function(g,d){if(SC.none(g)||SC.instanceOf(g,SC.DateTime)){return g
}var e=d.get("format");return SC.DateTime.parse(g,e?e:SC.DateTime.recordFormat)},from:function(e,d){if(SC.none(e)){return e
}var g=d.get("format");return e.toFormattedString(g?g:SC.DateTime.recordFormat)}})
}sc_require("models/record");sc_require("models/record_attribute");SC.SingleAttribute=SC.RecordAttribute.extend({inverse:null,isMaster:YES,call:function(g,n,e){var d=this.get("key")||n,m,l,o,k,j,h;
if(e!==undefined){if(e&&!SC.kindOf(e,SC.Record)){throw"%@ is not an instance of SC.Record".fmt(e)
}m=this.get("inverse");if(m){o=this._scsa_call(g,n)}h=this.fromType(g,n,e);g.writeAttribute(d,h,!this.get("isMaster"));
j=e;if(m&&(o!==e)){if(o&&(k=o[m])){k.inverseDidRemoveRecord(o,m,g,n)}if(e&&(k=e[m])){k.inverseDidAddRecord(e,m,g,n)
}}}else{j=this._scsa_call(g,n,e)}return j},_scsa_call:SC.RecordAttribute.prototype.call,inverseDidRemoveRecord:function(g,k,l,m){var e=this.get("inverse"),j=this._scsa_call(g,k),h=this.get("isMaster"),d;
g.writeAttribute(k,null,!h);g.notifyPropertyChange(k);if((j!==l)||(m!==e)){if(j&&(d=j[e])){d.inverseDidRemoveRecord(j,e,g,k)
}}},inverseDidAddRecord:function(d,m,g,l){var j=this.get("inverse"),n=this._scsa_call(d,m),k=this.get("isMaster"),h,e;
e=this.fromType(d,m,g);d.writeAttribute(m,e,!k);d.notifyPropertyChange(m);if((n!==g)||(l!==j)){if(n&&(h=n[j])){h.inverseDidRemoveRecord(n,j,d,m)
}}}});SC.ChildArray=SC.Object.extend(SC.Enumerable,SC.Array,{defaultRecordType:null,record:null,propertyName:null,children:null,store:function(){return this.get("record").get("store")
}.property("record").cacheable(),storeKey:function(){return this.get("record").get("storeKey")
}.property("record").cacheable(),readOnlyChildren:function(){return this.get("record").readAttribute(this.get("propertyName"))
}.property(),editableChildren:function(){var d=this.get("store"),h=this.get("storeKey"),g=this.get("propertyName"),e,j;
e=d.readEditableProperty(h,g);if(!e){j=d.readEditableDataHash(h);e=j[g]=[]}if(e!==this._prevChildren){this.recordPropertyDidChange()
}return e}.property(),length:function(){var d=this.get("readOnlyChildren");return d?d.length:0
}.property("readOnlyChildren"),objectAt:function(e){var j=this._records,h=this.get("readOnlyChildren"),k,g;
var d=h?h.length:0;if(!h){return undefined}if(j&&(g=j[e])){return g}if(!j){this._records=j=[]
}if(e>=d){return undefined}k=h.objectAt(e);if(!k){return undefined}j[e]=g=this._materializeChild(k);
return g},replace:function(o,d,n){var e=this.get("editableChildren"),l=n?(n.get?n.get("length"):n.length):0,k=this.get("record"),h=this.get("propertyName"),m,g;
e.replace(o,d,n);for(var j=o;j<=o+d;j+=1){this.objectAt(j)}k.recordDidChange(h);return this
},normalize:function(){this.forEach(function(e,d){if(e.normalize){e.normalize()}})
},_materializeChild:function(j){var m=this.get("store"),e=this.get("record"),h=this.get("defaultRecordType"),d,k,n,g;
if(!e){return undefined}var l=e.get("childRecordNamespace");if(j.type&&!SC.none(l)){h=l[j.type]
}if(!h||SC.typeOf(h)!==SC.T_CLASS){throw"ChildrenArray: Error during transform: Invalid record type."
}g=h.prototype.primaryKey||"childRecordKey";d=j[g];n=m.storeKeyExists(h,d);if(n){k=m.materializeRecord(n)
}else{k=e.registerChildRecord(h,j)}return k},recordPropertyDidChange:function(h){if(h&&!h.contains(this.get("propertyName"))){return this
}var e=this.get("readOnlyChildren");var g=this._prevChildren,j=this._childrenContentDidChange;
if(e===g){return this}if(g){g.removeObserver("[]",this,j)}this._prevChildren=e;if(e){e.addObserver("[]",this,j)
}var d=(e)?e.propertyRevision:-1;this._childrenContentDidChange(e,"[]",e,d)},_childrenContentDidChange:function(h,e,g,d){this._records=null;
this.enumerableContentDidChange()},init:function(){arguments.callee.base.apply(this,arguments);
this.recordPropertyDidChange()}});SC.ManyArray=SC.Object.extend(SC.Enumerable,SC.Array,{recordType:null,record:null,propertyName:null,manyAttribute:null,store:function(){return this.get("record").get("store")
}.property("record").cacheable(),storeKey:function(){return this.get("record").get("storeKey")
}.property("record").cacheable(),readOnlyStoreIds:function(){return this.get("record").readAttribute(this.get("propertyName"))
}.property(),editableStoreIds:function(){var d=this.get("store"),h=this.get("storeKey"),g=this.get("propertyName"),e,j;
e=d.readEditableProperty(h,g);if(!e){j=d.readEditableDataHash(h);e=j[g]=[]}if(e!==this._prevStoreIds){this.recordPropertyDidChange()
}return e}.property(),isEditable:function(){var d=this.manyAttribute;return d?d.get("isEditable"):NO
}.property("manyAttribute").cacheable(),inverse:function(){var d=this.manyAttribute;
return d?d.get("inverse"):null}.property("manyAttribute").cacheable(),isMaster:function(){var d=this.manyAttribute;
return d?d.get("isMaster"):null}.property("manyAttribute").cacheable(),orderBy:function(){var d=this.manyAttribute;
return d?d.get("orderBy"):null}.property("manyAttribute").cacheable(),length:function(){var d=this.get("readOnlyStoreIds");
return d?d.get("length"):0}.property("readOnlyStoreIds"),objectAt:function(d){var l=this._records,k=this.get("readOnlyStoreIds"),g=this.get("store"),m=this.get("recordType"),j,h,e;
if(!k||!g){return undefined}if(l&&(h=l[d])){return h}if(!l){this._records=l=[]}e=k.objectAt(d);
if(e){j=g.storeKeyFor(m,e);if(g.readStatus(j)===SC.Record.EMPTY){g.retrieveRecord(m,null,j)
}l[d]=h=g.materializeRecord(j)}return h},replace:function(u,h,s){if(!this.get("isEditable")){throw"%@.%@[] is not editable".fmt(this.get("record"),this.get("propertyName"))
}var g=this.get("editableStoreIds"),o=s?(s.get?s.get("length"):s.length):0,m=this.get("record"),j=this.get("propertyName"),l,x,d,e,k,p,n;
d=[];for(l=0;l<o;l++){d[l]=s.objectAt(l).get("id")}k=this.get("inverse");if(k&&h>0){e=SC.ManyArray._toRemove;
if(e){SC.ManyArray._toRemove=null}else{e=[]}for(l=0;l<h;l++){e[l]=this.objectAt(l)
}}g.replace(u,h,d);if(k){for(l=0;l<h;l++){n=e[l];p=n?n[k]:null;if(p&&p.inverseDidRemoveRecord){p.inverseDidRemoveRecord(n,k,m,j)
}}if(e){e.length=0;if(!SC.ManyArray._toRemove){SC.ManyArray._toRemove=e}}for(l=0;
l<o;l++){n=s.objectAt(l);p=n?n[k]:null;if(p&&p.inverseDidAddRecord){p.inverseDidAddRecord(n,k,m,j)
}}}if(m&&(!k||this.get("isMaster"))){m.recordDidChange(j)}return this},removeInverseRecord:function(g){if(!g){return this
}var j=g.get("id"),h=this.get("editableStoreIds"),d=(h&&j)?h.indexOf(j):-1,e;if(d>=0){h.removeAt(d);
if(this.get("isMaster")&&(e=this.get("record"))){e.recordDidChange(this.get("propertyName"))
}}return this},addInverseRecord:function(h){if(!h){return this}var l=h.get("id"),j=this.get("editableStoreIds"),k=this.get("orderBy"),e=j.get("length"),d,g;
if(k){d=this._findInsertionLocation(h,0,e,k)}else{d=e}j.insertAt(d,h.get("id"));if(this.get("isMaster")&&(g=this.get("record"))){g.recordDidChange(this.get("propertyName"))
}return this},_findInsertionLocation:function(l,h,g,k){var e=h+Math.floor((g-h)/2),j=this.objectAt(e),d=this._compare(l,j,k);
if(d<0){if(e===0){return e}else{return this._findInsertionLocation(l,0,e,k)}}else{if(d>0){if(e>=g){return e
}else{return this._findInsertionLocation(l,e,g,k)}}else{return e}}},_compare:function(h,g,l){var k=SC.typeOf(l),j,e,d;
if(k===SC.T_FUNCTION){j=l(h,g)}else{if(k===SC.T_STRING){j=SC.compare(h,g)}else{d=l.get("length");
j=0;for(e=0;(j===0)&&(e<d);e++){j=SC.compare(h,g)}}}return j},recordPropertyDidChange:function(g){if(g&&!g.contains(this.get("propertyName"))){return this
}var j=this.get("readOnlyStoreIds");var e=this._prevStoreIds,h=this._storeIdsContentDidChange;
if(j===e){return this}if(e){e.removeObserver("[]",this,h)}this._prevStoreIds=j;if(j){j.addObserver("[]",this,h)
}var d=(j)?j.propertyRevision:-1;this._storeIdsContentDidChange(j,"[]",j,d)},_storeIdsContentDidChange:function(h,e,g,d){this._records=null;
this.enumerableContentDidChange()},unknownProperty:function(e,g){var d=this.reducedProperty(e,g);
return d===undefined?arguments.callee.base.apply(this,arguments):d},init:function(){arguments.callee.base.apply(this,arguments);
this.recordPropertyDidChange()}});sc_require("system/store");SC.NestedStore=SC.Store.extend({hasChanges:NO,parentStore:null,isNested:YES,lockOnRead:YES,locks:null,chainedChanges:null,find:function(d){if(d&&d.isQuery&&d.get("location")!==SC.Query.LOCAL){throw"SC.Store#find() can only accept LOCAL queries in nested stores"
}return arguments.callee.base.apply(this,arguments)},commitChanges:function(e){if(this.get("hasChanges")){var d=this.get("parentStore");
d.commitChangesFromNestedStore(this,this.chainedChanges,e)}this.reset();return this
},discardChanges:function(){var g,k;if((g=this.records)&&(k=this.locks)){var e=this.get("parentStore"),m=e.revisions;
var l=this.revisions,j,h,d;for(j in g){if(!g.hasOwnProperty(j)){continue}if(!(h=k[j])){continue
}d=m[j];if((d!==h)||(l[j]>d)){this._notifyRecordPropertyChange(parseInt(j,10))}}}this.reset();
this.flush();return this},destroy:function(){this.discardChanges();var d=this.get("parentStore");
if(d){d.willDestroyNestedStore(this)}arguments.callee.base.apply(this,arguments);
return this},reset:function(){var d=this.get("parentStore");if(!d){throw SC.Store.NO_PARENT_STORE_ERROR
}this.dataHashes=SC.beget(d.dataHashes);this.revisions=SC.beget(d.revisions);this.statuses=SC.beget(d.statuses);
this.chainedChanges=this.locks=this.editables=null;this.changelog=null;this.set("hasChanges",NO)
},refreshQuery:function(e){var d=this.get("parentStore");if(d){d.refreshQuery(e)}return this
},readError:function(e){var d=this.get("parentStore");return d?d.readError(e):null
},readQueryError:function(e){var d=this.get("parentStore");return d?d.readQueryError(e):null
},storeKeyEditState:function(e){var g=this.editables,d=this.locks;return(g&&g[e])?SC.Store.EDITABLE:(d&&d[e])?SC.Store.LOCKED:SC.Store.INHERITED
},_lock:function(j){var h=this.locks,d,k;if(h&&h[j]){return this}if(!h){h=this.locks=[]
}k=this.editables;if(k){k[j]=0}var g=this.get("parentStore"),e;while(g&&(e=g.storeKeyEditState(j))===SC.Store.INHERITED){g=g.get("parentStore")
}if(g&&e===SC.Store.EDITABLE){this.dataHashes[j]=SC.clone(g.dataHashes[j]);if(!k){k=this.editables=[]
}k[j]=1}else{this.dataHashes[j]=this.dataHashes[j]}this.statuses[j]=this.statuses[j];
d=this.revisions[j]=this.revisions[j];h[j]=d||1;return this},readDataHash:function(d){if(this.get("lockOnRead")){this._lock(d)
}return this.dataHashes[d]},readEditableDataHash:function(d){this._lock(d);return arguments.callee.base.apply(this,arguments)
},writeDataHash:function(h,k,e){var g=this.locks,l=NO,d;if(k){this.dataHashes[h]=k
}else{this._lock(h);l=YES}if(e){this.statuses[h]=e}else{if(!l){this.statuses[h]=(this.statuses[h]||SC.Record.READY_NEW)
}}if(!l){d=this.revisions[h]=this.revisions[h];if(!g){g=this.locks=[]}if(!g[h]){g[h]=d||1
}}var j=this.editables;if(!j){j=this.editables=[]}j[h]=1;return this},removeDataHash:function(g,d){var e=this.locks;
if(!e){e=this.locks=[]}if(!e[g]){e[g]=this.revisions[g]||1}return arguments.callee.base.apply(this,arguments)
},dataHashDidChange:function(h,e,d,m){if(!e){e=SC.Store.generateStoreKey()}var g,j,l,n;
g=SC.typeOf(h)===SC.T_ARRAY;if(g){j=h.length}else{j=1;n=h}var k=this.chainedChanges;
if(!k){k=this.chainedChanges=SC.Set.create()}for(l=0;l<j;l++){if(g){n=h[l]}this._lock(n);
this.revisions[n]=e;k.add(n);this._notifyRecordPropertyChange(n,d,m)}this.setIfChanged("hasChanges",YES);
return this},commitChangesFromNestedStore:function(j,k,d){arguments.callee.base.apply(this,arguments);
var e=this.get("parentStore"),m=e.revisions,g;var o=this.locks,l=this.chainedChanges,h,n;
if(!o){o=this.locks=[]}if(!l){l=this.chainedChanges=SC.Set.create()}h=k.length;for(g=0;
g<h;g++){n=k[g];if(!o[n]){o[n]=m[n]||1}l.add(n)}this.setIfChanged("hasChanges",l.get("length")>0);
this.flush();return this},queryFor:function(g,d,e){return this.get("parentStore").queryFor(g,d,e)
},findAll:function(j,e,h,g,d){if(!d){d=this}return this.get("parentStore").findAll(j,e,h,g,d)
},retrieveRecords:function(k,u,e,g){var d=this.get("parentStore"),p,h,z,y=(!e)?u.length:e.length,n=SC.Record,x;
if(g){for(p=0;p<y;p++){h=!e?d.storeKeyFor(k,u[p]):e[p];x=this.peekStatus(h);if(x&n.DIRTY){throw SC.Store.NESTED_STORE_RETRIEVE_DIRTY_ERROR
}else{var l=this.dataHashes,o=this.revisions,m=this.statuses,s=this.editables,B=this.locks;
var j=NO;var A=NO;if(l&&l.hasOwnProperty(h)){delete l[h];j=YES}if(o&&o.hasOwnProperty(h)){delete o[h];
j=YES}if(s){delete s[h]}if(B){delete B[h]}if(m&&m.hasOwnProperty(h)){delete m[h];
if(!j){A=YES}j=YES}if(j){this._notifyRecordPropertyChange(h,A)}}}}return d.retrieveRecords(k,u,e,g)
},commitRecords:function(d,e,g){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},commitRecord:function(g,e,d){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR
},cancelRecords:function(d,e,g){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},cancelRecord:function(g,e,d){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR
},dataSourceDidCancel:function(d){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},dataSourceDidComplete:function(g,e,d){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR
},dataSourceDidDestroy:function(d){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},dataSourceDidError:function(e,d){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR
},pushRetrieve:function(h,g,d,e){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},pushDestroy:function(g,e,d){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR
},pushError:function(h,g,d,e){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR}});sc_require("core");
sc_require("models/record");SC.Query=SC.Object.extend(SC.Copyable,SC.Freezable,{isQuery:YES,conditions:null,orderBy:null,recordType:null,recordTypes:null,expandedRecordTypes:function(){var e=SC.CoreSet.create(),d,g;
if(d=this.get("recordType")){this._scq_expandRecordType(d,e)}else{if(d=this.get("recordTypes")){d.forEach(function(h){this._scq_expandRecordType(h,e)
},this)}else{this._scq_expandRecordType(SC.Record,e)}}g=SC.Query._scq_queriesWithExpandedRecordTypes;
if(!g){g=SC.Query._scq_queriesWithExpandedRecordTypes=SC.CoreSet.create()}g.add(this);
return e.freeze()}.property("recordType","recordTypes").cacheable(),_scq_expandRecordType:function(e,d){if(d.contains(e)){return
}d.add(e);if(SC.typeOf(e)===SC.T_STRING){e=SC.objectForPropertyPath(e)}e.subclasses.forEach(function(g){this._scq_expandRecordType(g,d)
},this)},parameters:null,location:"local",scope:null,isRemote:function(){return this.get("location")===SC.Query.REMOTE
}.property("location").cacheable(),isLocal:function(){return this.get("location")===SC.Query.LOCAL
}.property("location").cacheable(),isEditable:NO,contains:function(d,h){var j,e=YES;
if(j=this.get("recordTypes")){e=j.find(function(k){return SC.kindOf(d,k)})}else{if(j=this.get("recordType")){e=SC.kindOf(d,j)
}}if(!e){return NO}var g=this.get("scope");if(g&&!g.contains(d)){return NO}if(!this._isReady){this.parse()
}if(!this._isReady){return NO}if(h===undefined){h=this.parameters||this}return this._tokenTree.evaluate(d,h)
},containsRecordTypes:function(d){var e=this.get("recordType");if(e){return !!d.find(function(g){return SC.kindOf(g,e)
})}else{if(e=this.get("recordTypes")){return !!e.find(function(g){return !!d.find(function(h){return SC.kindOf(h,g)
})})}else{return YES}}},compare:function(k,h){var g=0,j,e,d,l;if(k===h){return 0}if(!this._isReady){this.parse()
}if(!this._isReady){return SC.compare(k.get("id"),h.get("id"))}e=this._order;if(SC.typeOf(e)===SC.T_FUNCTION){g=e.call(null,k,h)
}else{d=e?e.length:0;for(l=0;g===0&&(l<d);l++){j=e[l].propertyName;if(SC.Query.comparisons[j]){g=SC.Query.comparisons[j](k.get(j),h.get(j))
}else{g=SC.compare(k.get(j),h.get(j))}if((g!==0)&&e[l].descending){g=(-1)*g}}}if(g!==0){return g
}else{return SC.compare(k.get("id"),h.get("id"))}},_isReady:NO,parse:function(){var g=this.get("conditions"),h=this.get("queryLanguage"),e,d;
e=this._tokenList=this.tokenizeString(g,h);d=this._tokenTree=this.buildTokenTree(e,h);
this._order=this.buildOrder(this.get("orderBy"));this._isReady=!!d&&!d.error;if(d&&d.error){throw d.error
}return this._isReady},queryWithScope:function(g){var e=SC.keyFor("__query__",SC.guidFor(this)),d=g[e];
if(!d){g[e]=d=this.copy();d.set("scope",g);d.freeze()}return d},copyKeys:"conditions orderBy recordType recordTypes parameters location scope".w(),concatenatedProperties:"copyKeys".w(),copy:function(){var h={},g=this.get("copyKeys"),k=g?g.length:0,e,j,d;
while(--k>=0){e=g[k];j=this.get(e);if(j!==undefined){h[e]=j}}d=this.constructor.create(h);
h=null;return d},queryLanguage:{UNKNOWN:{firstCharacter:/[^\s'"\w\d\(\)\{\}]/,notAllowed:/[\s'"\w\d\(\)\{\}]/},PROPERTY:{firstCharacter:/[a-zA-Z_]/,notAllowed:/[^a-zA-Z_0-9]/,evalType:"PRIMITIVE",evaluate:function(e,d){return e.get(this.tokenValue)
}},NUMBER:{firstCharacter:/[\d\-]/,notAllowed:/[^\d\-\.]/,format:/^-?\d+$|^-?\d+\.\d+$/,evalType:"PRIMITIVE",evaluate:function(e,d){return parseFloat(this.tokenValue)
}},STRING:{firstCharacter:/['"]/,delimeted:true,evalType:"PRIMITIVE",evaluate:function(e,d){return this.tokenValue
}},PARAMETER:{firstCharacter:/\{/,lastCharacter:"}",delimeted:true,evalType:"PRIMITIVE",evaluate:function(e,d){return d[this.tokenValue]
}},"%@":{rememberCount:true,reservedWord:true,evalType:"PRIMITIVE",evaluate:function(e,d){return d[this.tokenValue]
}},OPEN_PAREN:{firstCharacter:/\(/,singleCharacter:true},CLOSE_PAREN:{firstCharacter:/\)/,singleCharacter:true},AND:{reservedWord:true,leftType:"BOOLEAN",rightType:"BOOLEAN",evalType:"BOOLEAN",evaluate:function(g,d){var h=this.leftSide.evaluate(g,d);
var e=this.rightSide.evaluate(g,d);return h&&e}},OR:{reservedWord:true,leftType:"BOOLEAN",rightType:"BOOLEAN",evalType:"BOOLEAN",evaluate:function(g,d){var h=this.leftSide.evaluate(g,d);
var e=this.rightSide.evaluate(g,d);return h||e}},NOT:{reservedWord:true,rightType:"BOOLEAN",evalType:"BOOLEAN",evaluate:function(g,d){var e=this.rightSide.evaluate(g,d);
return !e}},"=":{reservedWord:true,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(g,d){var h=this.leftSide.evaluate(g,d);
var e=this.rightSide.evaluate(g,d);return SC.isEqual(h,e)}},"!=":{reservedWord:true,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(g,d){var h=this.leftSide.evaluate(g,d);
var e=this.rightSide.evaluate(g,d);return !SC.isEqual(h,e)}},"<":{reservedWord:true,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(g,d){var h=this.leftSide.evaluate(g,d);
var e=this.rightSide.evaluate(g,d);return SC.compare(h,e)==-1}},"<=":{reservedWord:true,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(g,d){var h=this.leftSide.evaluate(g,d);
var e=this.rightSide.evaluate(g,d);return SC.compare(h,e)!=1}},">":{reservedWord:true,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(g,d){var h=this.leftSide.evaluate(g,d);
var e=this.rightSide.evaluate(g,d);return SC.compare(h,e)==1}},">=":{reservedWord:true,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(g,d){var h=this.leftSide.evaluate(g,d);
var e=this.rightSide.evaluate(g,d);return SC.compare(h,e)!=-1}},BEGINS_WITH:{reservedWord:true,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(g,d){var e=this.leftSide.evaluate(g,d);
var h=this.rightSide.evaluate(g,d);return(e&&e.indexOf(h)===0)}},ENDS_WITH:{reservedWord:true,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(h,e){var g=this.leftSide.evaluate(h,e);
var d=this.rightSide.evaluate(h,e);return(g&&g.indexOf(d)===(g.length-d.length))}},CONTAINS:{reservedWord:true,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(h,d){var g=this.leftSide.evaluate(h,d)||[];
var k=this.rightSide.evaluate(h,d);switch(SC.typeOf(g)){case SC.T_STRING:return(g.indexOf(k)!==-1);
case SC.T_ARRAY:var j=false;var e=0;while(j===false&&e<g.length){if(k==g[e]){j=true
}e++}return j;default:break}}},ANY:{reservedWord:true,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(h,d){var k=this.leftSide.evaluate(h,d);
var e=this.rightSide.evaluate(h,d);var j=false;var g=0;while(j===false&&g<e.length){if(k==e[g]){j=true
}g++}return j}},MATCHES:{reservedWord:true,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(g,d){var h=this.leftSide.evaluate(g,d);
var e=this.rightSide.evaluate(g,d);return e.test(h)}},TYPE_IS:{reservedWord:true,rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(h,d){var g=SC.Store.recordTypeFor(h.storeKey);
var e=this.rightSide.evaluate(h,d);var j=SC.objectForPropertyPath(e);return g==j}},"null":{reservedWord:true,evalType:"PRIMITIVE",evaluate:function(e,d){return null
}},"undefined":{reservedWord:true,evalType:"PRIMITIVE",evaluate:function(e,d){return undefined
}},"false":{reservedWord:true,evalType:"PRIMITIVE",evaluate:function(e,d){return false
}},"true":{reservedWord:true,evalType:"PRIMITIVE",evaluate:function(e,d){return true
}},YES:{reservedWord:true,evalType:"PRIMITIVE",evaluate:function(e,d){return true
}},NO:{reservedWord:true,evalType:"PRIMITIVE",evaluate:function(e,d){return false
}}},tokenizeString:function(C,y){var n=[],A=null,l=null,j=null,B=null,d=null,m=null,g=null,k=null,z=false,e=false,p=false,s=false,u={};
function h(F,D){l=y[F];if(l.format&&!l.format.test(D)){F="UNKNOWN"}if(l.delimeted){s=true
}if(!l.delimeted){for(var E in y){if(y[E].reservedWord&&E==D){F=E}}}l=y[F];if(l&&l.rememberCount){if(!u[F]){u[F]=0
}D=u[F];u[F]+=1}n.push({tokenType:F,tokenValue:D});d=null;m=null;g=null}if(!C){return[]
}var o=C.length;for(var x=0;x<o;x++){z=(x===o-1);A=C.charAt(x);s=false;if(d){l=y[d];
e=l.delimeted?A===k:l.notAllowed.test(A);if(!e){g+=A}if(e||z){h(d,g)}if(z&&!e){s=true
}}if(!d&&!s){for(j in y){l=y[j];if(l.firstCharacter&&l.firstCharacter.test(A)){d=j
}}if(d){l=y[d];g=A;if(l.delimeted){g="";if(l.lastCharacter){k=l.lastCharacter}else{k=A
}}if(l.singleCharacter||z){h(d,g)}}}}return n},buildTokenTree:function(p,d){var x=p.slice();
var z=0;var B=[];var g=false;var y=[];if(!p||p.length===0){return{evaluate:function(){return true
}}}function A(l){var F=l;if(F<0){return false}var E=d[x[F].tokenType];if(!E){y.push("logic for token '"+x[F].tokenType+"' is not defined");
return false}x[F].evaluate=E.evaluate;return E}function e(F,l){var G=l;var E=A(G);
if(!E){return false}if(F=="left"){return E.leftType}if(F=="right"){return E.rightType
}}function u(l){var F=l;var E=A(F);if(!E){return false}else{return E.evalType}}function k(l){x.splice(l,1);
if(l<=z){z--}}function C(l){var E=l||z;if(E>0){return true}else{return false}}function o(l){var E=l;
if(E<0){return true}return(e("left",E)&&!x[E].leftSide)||(e("right",E)&&!x[E].rightSide)
}function n(E,F){var l=(F<E)?"left":"right";if(E<0||F<0){return false}if(!e(l,E)){return false
}if(!u(F)){return false}if(e(l,E)==u(F)){return true}else{return false}}function s(l){var E=l;
if(!o(E)){return false}if(!C(E)){return false}if(n(E,E-1)){return true}else{return false
}}function h(l){var E=l;if(o(E)){return false}if(!C(E)){return false}if(!o(E-1)){return false
}if(n(E-1,E)){return true}else{return false}}function m(l){var E=l;if(E<1){return false
}x[E].leftSide=x[E-1];k(E-1)}function D(l){var E=l;if(E<1){return false}x[E-1].rightSide=x[E];
k(E)}function j(l){k(l);k(B.pop())}for(z=0;z<x.length;z++){g=false;if(x[z].tokenType=="UNKNOWN"){y.push("found unknown token: "+x[z].tokenValue)
}if(x[z].tokenType=="OPEN_PAREN"){B.push(z)}if(x[z].tokenType=="CLOSE_PAREN"){j(z)
}if(s(z)){m(z)}if(h(z)){D(z);g=true}if(g){z--}}if(x.length==1){x=x[0]}else{y.push("string did not resolve to a single tree")
}if(y.length>0){return{error:y.join(",\n"),tree:x}}else{return x}},buildOrder:function(d){if(!d){return[]
}else{if(SC.typeOf(d)===SC.T_FUNCTION){return d}else{var h=d.split(",");for(var e=0;
e<h.length;e++){var g=h[e];g=g.replace(/^\s+|\s+$/,"");g=g.replace(/\s+/,",");g=g.split(",");
h[e]={propertyName:g[0]};if(g[1]&&g[1]=="DESC"){h[e].descending=true}}return h}}}});
SC.Query.mixin({LOCAL:"local",REMOTE:"remote",storeKeyFor:function(d){return d?d.get("storeKey"):null
},containsRecords:function(l,j,h){var k=[];for(var e=0,d=j.get("length");e<d;e++){var g=j.objectAt(e);
if(g&&l.contains(g)){k.push(g.get("storeKey"))}}k=SC.Query.orderStoreKeys(k,l,h);
return k},orderStoreKeys:function(j,k,e){if(j){var d=SC.Query,h=d._TMP_STORES,l=d._TMP_QUERIES;
if(!h){h=d._TMP_STORES=[]}if(!l){l=d._TMP_QUERIES=[]}h.push(e);l.push(k);var g=j.sort(SC.Query.compareStoreKeys);
d._TMP_STORES.pop();d._TMP_QUERIES.pop()}return j},compareStoreKeys:function(m,k){var u=SC.Query,p=u._TMP_STORES,e=u._TMP_QUERIES,x=p[p.length-1],s=e[e.length-1],g=s.compare,h=x.materializeRecord(m),d=x.materializeRecord(k);
if(g!==u.prototype.compare){return g.call(s,h,d)}else{var y=0,o,j,n,l;if(h===d){return 0
}if(!s._isReady){s.parse()}if(!s._isReady){return SC.compare(h.get("id"),d.get("id"))
}j=s._order;if(SC.typeOf(j)===SC.T_FUNCTION){y=j.call(null,h,d)}else{n=j?j.length:0;
for(l=0;y===0&&(l<n);l++){o=j[l].propertyName;if(SC.Query.comparisons[o]){y=SC.Query.comparisons[o](h.get(o),d.get(o))
}else{y=SC.compare(h.get(o),d.get(o))}if((y!==0)&&j[l].descending){y=(-1)*y}}}if(y!==0){return y
}else{return SC.compare(h.get("id"),d.get("id"))}}},build:function(m,g,l,h){var d=null,k,e,n,j;
if(g&&g.isQuery){if(g.get("location")===m){return g}else{return g.copy().set("location",m).freeze()
}}if(typeof g===SC.T_STRING){k=SC.objectForPropertyPath(g);if(!k){throw"%@ did not resolve to a class".fmt(g)
}g=k}else{if(g&&g.isEnumerable){k=[];g.forEach(function(o){if(typeof o===SC.T_STRING){o=SC.objectForPropertyPath(o)
}if(!o){throw"cannot resolve record types: %@".fmt(g)}k.push(o)},this);g=k}else{if(!g){g=SC.Record
}}}if(h===undefined){h=null}if(l===undefined){l=null}if(!h&&(typeof l!==SC.T_STRING)){d=l;
l=null}if(!h&&!d){j=SC.Query._scq_recordTypeCache;if(!j){j=SC.Query._scq_recordTypeCache={}
}e=j[m];if(!e){e=j[m]={}}if(g.isEnumerable){n=g.map(function(o){return SC.guidFor(o)
});n=n.sort().join(":")}else{n=SC.guidFor(g)}if(l){n=[n,l].join("::")}k=e[n];if(!k){if(g.isEnumerable){d={recordTypes:g.copy()}
}else{d={recordType:g}}d.location=m;d.conditions=l;k=e[n]=SC.Query.create(d).freeze()
}}else{if(!d){d={}}if(!d.location){d.location=m}if(g&&g.isEnumerable){d.recordsTypes=g
}else{d.recordType=g}if(l){d.conditions=l}if(h){d.parameters=h}k=SC.Query.create(d).freeze()
}return k},local:function(g,d,e){return this.build(SC.Query.LOCAL,g,d,e)},remote:function(g,d,e){return this.build(SC.Query.REMOTE,g,d,e)
},_scq_didDefineRecordType:function(){var d=SC.Query._scq_queriesWithExpandedRecordTypes;
if(d){d.forEach(function(e){e.notifyPropertyChange("expandedRecordTypes")},this);
d.clear()}}});SC.Query.comparisons={};SC.Query.registerComparison=function(d,e){SC.Query.comparisons[d]=e
};SC.Query.registerQueryExtension=function(e,d){SC.Query.prototype.queryLanguage[e]=d
};SC.Q=SC.Query.from;sc_require("models/record");SC.RecordArray=SC.Object.extend(SC.Enumerable,SC.Array,{store:null,query:null,storeKeys:null,status:SC.Record.EMPTY,isEditable:function(){var d=this.get("query");
return d?d.get("isEditable"):NO}.property("query").cacheable(),length:function(){this.flush();
var d=this.get("storeKeys");return d?d.get("length"):0}.property("storeKeys").cacheable(),_scra_records:null,objectAt:function(d){this.flush();
var k=this._scra_records,j=this.get("storeKeys"),e=this.get("store"),h,g;if(!j||!e){return undefined
}if(k&&(g=k[d])){return g}if(!k){this._scra_records=k=[]}h=j.objectAt(d);if(h){if(e.peekStatus(h)===SC.Record.EMPTY){e.retrieveRecord(null,null,h)
}k[d]=g=e.materializeRecord(h)}return g},forEach:function(m,h){this.flush();var j=this._scra_records,e=this.get("storeKeys"),k=this.get("store"),g=e?e.get("length"):0,l,n,d;
if(!e||!k){return this}if(!j){j=this._scra_records=[]}if(!h){h=this}for(l=0;l<g;l++){d=j[l];
if(!d){d=j[l]=k.materializeRecord(e.objectAt(l))}m.call(h,d,l,this)}return this},replace:function(e,m,l){this.flush();
var j=this.get("storeKeys"),d=l?(l.get?l.get("length"):l.length):0,g,h;if(!j){throw"storeKeys required"
}var k=this.get("query");if(k&&!k.get("isEditable")){throw SC.RecordArray.NOT_EDITABLE
}h=[];for(g=0;g<d;g++){h[g]=l.objectAt(g).get("storeKey")}j.replace(e,m,h);return this
},contains:function(d){return this.indexOf(d)>=0},indexOf:function(e,d){if(!SC.kindOf(e,SC.Record)){return NO
}this.flush();var h=e.get("storeKey"),g=this.get("storeKeys");return g?g.indexOf(h,d):-1
},lastIndexOf:function(e,d){if(!SC.kindOf(e,SC.Record)){return NO}this.flush();var h=e.get("storeKey"),g=this.get("storeKeys");
return g?g.lastIndexOf(h,d):-1},add:function(d){if(!SC.kindOf(d,SC.Record)){return this
}if(this.indexOf(d)<0){this.pushObject(d)}return this},remove:function(d){if(!SC.kindOf(d,SC.Record)){return this
}this.removeObject(d);return this},find:function(d,e){if(d&&d.isQuery){return this.get("store").find(d.queryWithScope(this))
}else{return arguments.callee.base.apply(this,arguments)}},refresh:function(){this.get("store").refreshQuery(this.get("query"));
return this},reload:function(){this.flush(YES);return this},destroy:function(){if(!this.get("isDestroyed")){this.get("store").recordArrayWillDestroy(this)
}arguments.callee.base.apply(this,arguments)},storeWillFetchQuery:function(g){var e=this.get("status"),d=SC.Record;
if((e===d.EMPTY)||(e===d.ERROR)){e=d.BUSY_LOADING}if(e&d.READY){e=d.BUSY_REFRESH}this.setIfChanged("status",e);
return this},storeDidFetchQuery:function(d){this.setIfChanged("status",SC.Record.READY_CLEAN);
return this},storeDidCancelQuery:function(g){var e=this.get("status"),d=SC.Record;
if(e===d.BUSY_LOADING){e=d.EMPTY}else{if(e===d.BUSY_REFRESH){e=d.READY_CLEAN}}this.setIfChanged("status",e);
return this},storeDidErrorQuery:function(d){this.setIfChanged("status",SC.Record.ERROR);
return this},storeDidChangeStoreKeys:function(e,d){var g=this.get("query");if(g.get("location")!==SC.Query.LOCAL){return this
}if(!g.containsRecordTypes(d)){return this}var h=this._scq_changedStoreKeys;if(!h){h=this._scq_changedStoreKeys=SC.IndexSet.create()
}h.addEach(e);this.set("needsFlush",YES);this.enumerableContentDidChange();return this
},flush:function(d){if(this._insideFlush){this.set("needsFlush",YES);return this}if(!this.get("needsFlush")&&!d){return this
}this.set("needsFlush",NO);var n=this.get("query"),s=this.get("store");if(!s||!n||n.get("location")!==SC.Query.LOCAL){return this
}this._insideFlush=YES;var l=this.get("storeKeys"),j=this._scq_changedStoreKeys,k=NO,o=SC.Record,g,h,e,x,u,m;
var p=l;if(l&&!d){if(j){j.forEach(function(y){h=s.peekStatus(y);if(!(h&o.EMPTY)&&!((h&o.DESTROYED)||(h===o.BUSY_DESTROYING))){g=s.materializeRecord(y);
m=!!(g&&n.contains(g))}else{m=NO}if(m){if(l.indexOf(y)<0){if(!k){l=l.copy()}l.pushObject(y)
}}else{if(l.indexOf(y)>=0){if(!k){l=l.copy()}l.removeObject(y)}}},this);k=YES}}else{if(u=n.get("scope")){x=u.flush().get("storeKeys")
}else{if(e=n.get("expandedRecordTypes")){x=SC.IndexSet.create();e.forEach(function(y){x.addEach(s.storeKeysFor(e))
})}}l=[];x.forEach(function(y){h=s.peekStatus(y);if(!(h&o.EMPTY)&&!((h&o.DESTROYED)||(h===o.BUSY_DESTROYING))){g=s.materializeRecord(y);
if(g&&n.contains(g)){l.push(y)}}});k=YES}if(j){j.clear()}if(k){if(l&&(l===p)){l=l.copy()
}l=SC.Query.orderStoreKeys(l,n,s);if(SC.compare(p,l)!==0){this.set("storeKeys",SC.clone(l))
}}this._insideFlush=NO;return this},needsFlush:YES,isError:function(){return this.get("status")&SC.Record.ERROR
}.property("status").cacheable(),errorValue:function(){return this.get("isError")?SC.val(this.get("errorObject")):null
}.property("isError").cacheable(),errorObject:function(){if(this.get("isError")){var d=this.get("store");
return d.readQueryError(this.get("query"))||SC.Record.GENERIC_ERROR}else{return null
}}.property("isError").cacheable(),_storeKeysDidChange:function(){var h=this.get("storeKeys");
var g=this._prevStoreKeys,j=this._storeKeysContentDidChange,d=this._storeKeysStateDidChange;
if(h===g){return}if(g){g.removeObserver("[]",this,j)}this._prevStoreKeys=h;if(h){h.addObserver("[]",this,j)
}var e=(h)?h.propertyRevision:-1;this._storeKeysContentDidChange(h,"[]",h,e)}.observes("storeKeys"),_storeKeysContentDidChange:function(h,e,g,d){if(this._scra_records){this._scra_records.length=0
}this.beginPropertyChanges().notifyPropertyChange("length").enumerableContentDidChange().endPropertyChanges()
},init:function(){arguments.callee.base.apply(this,arguments);this._storeKeysDidChange()
}});SC.RecordArray.mixin({NOT_EDITABLE:SC.Error.desc("SC.RecordArray is not editable")});
sc_require("models/record");SC.Store=SC.Object.extend({name:null,nestedStores:null,dataSource:null,isNested:NO,commitRecordsAutomatically:NO,from:function(d){this.set("dataSource",d);
return this},_getDataSource:function(){var d=this.get("dataSource");if(typeof d===SC.T_STRING){d=SC.objectForPropertyPath(d);
if(d){d=d.create()}if(d){this.set("dataSource",d)}}return d},cascade:function(d){var e=SC.A(arguments);
d=SC.CascadeDataSource.create({dataSources:e});return this.from(d)},chain:function(e,g){if(!e){e={}
}e.parentStore=this;if(g){if(SC.typeOf(g)!=="class"){throw new Error("%@ is not a valid class".fmt(g))
}if(!SC.kindOf(g,SC.NestedStore)){throw new Error("%@ is not a type of SC.NestedStore".fmt(g))
}}else{g=SC.NestedStore}var d=g.create(e),h=this.nestedStores;if(!h){h=this.nestedStores=[]
}h.push(d);return d},willDestroyNestedStore:function(d){if(this.nestedStores){this.nestedStores.removeObject(d)
}return this},hasNestedStore:function(d){while(d&&(d!==this)){d=d.get("parentStore")
}return d===this},dataHashes:null,statuses:null,revisions:null,editables:null,changelog:null,recordArraysWithQuery:null,recordErrors:null,queryErrors:null,storeKeyEditState:function(e){var g=this.editables,d=this.locks;
return(g&&g[e])?SC.Store.EDITABLE:SC.Store.LOCKED},readDataHash:function(d){return this.dataHashes[d]
},readEditableDataHash:function(e){var d=this.dataHashes[e];if(!d){return d}var g=this.editables;
if(!g){g=this.editables=[]}if(!g[e]){g[e]=1;d=this.dataHashes[e]=SC.clone(d)}return d
},readEditableProperty:function(g,d){var j=this.readEditableDataHash(g),h=this.editables[g],e=j[d];
if(h===1){h=this.editables[g]={}}if(!h[d]){e=j[d];if(e&&e.isCopyable){e=j[d]=e.copy()
}h[d]=YES}return e},writeDataHash:function(e,h,d){if(h){this.dataHashes[e]=h}if(d){this.statuses[e]=d
}var g=this.editables;if(!g){g=this.editables=[]}g[e]=1;return this},removeDataHash:function(g,e){var d;
this.dataHashes[g]=null;this.statuses[g]=e||SC.Record.EMPTY;d=this.revisions[g]=this.revisions[g];
var h=this.editables;if(h){h[g]=0}return this},readStatus:function(d){this.readDataHash(d);
return this.statuses[d]||SC.Record.EMPTY},peekStatus:function(d){return this.statuses[d]||SC.Record.EMPTY
},writeStatus:function(e,d){return this.writeDataHash(e,null,d)},dataHashDidChange:function(m,h,j,k){if(!h){h=SC.Store.generateStoreKey()
}var g,e,d,l;g=SC.typeOf(m)===SC.T_ARRAY;if(g){e=m.length}else{e=1;l=m}for(d=0;d<e;
d++){if(g){l=m[d]}this.revisions[l]=h;this._notifyRecordPropertyChange(l,j,k)}return this
},_notifyRecordPropertyChange:function(u,j,s){var d=this.records,l=this.get("nestedStores"),m=SC.Store,g,e,k,p,o,h,x;
k=l?l.length:0;for(p=0;p<k;p++){o=l[p];h=o.peekStatus(u);e=o.storeKeyEditState(u);
if(e===m.INHERITED){o._notifyRecordPropertyChange(u,j,s)}else{if(h&SC.Record.BUSY){if(o.get("hasChanges")){throw m.CHAIN_CONFLICT_ERROR
}o.reset()}}}var n=this.recordPropertyChanges;if(!n){n=this.recordPropertyChanges={storeKeys:SC.CoreSet.create(),records:SC.CoreSet.create(),hasDataChanges:SC.CoreSet.create(),propertyForStoreKeys:{}}
}n.storeKeys.add(u);if(d&&(g=d[u])){n.records.push(u);if(!j){n.hasDataChanges.push(u)
}if(s){if(!(x=n.propertyForStoreKeys[u])){x=n.propertyForStoreKeys[u]=SC.CoreSet.create()
}if(x!=="*"){x.add(s)}}else{n.propertyForStoreKeys[u]="*"}}this.invokeOnce(this.flush);
return this},flush:function(){if(!this.recordPropertyChanges){return this}var n=this.recordPropertyChanges,m=n.storeKeys,s=n.hasDataChanges,d=n.records,k=n.propertyForStoreKeys,h=SC.CoreSet.create(),g,e,j,o,l,p,u;
m.forEach(function(x){if(d.contains(x)){j=s.contains(x)?NO:YES;g=this.records[x];
u=k?k[x]:null;if(u==="*"){u=null}d.remove(x);if(g){g.storeDidChangeProperties(j,u)
}}e=SC.Store.recordTypeFor(x);h.add(e)},this);if(m.get("length")>0){this._notifyRecordArrays(m,h)
}m.clear();s.clear();d.clear();this.recordPropertyChanges.propertyForStoreKeys={};
return this},reset:function(){this.dataHashes={};this.revisions={};this.statuses={};
this.chainedChanges=this.locks=this.editables=null;this.changelog=null;this.recordErrors=null;
this.queryErrors=null;var d=this.records,e;if(d){for(e in d){if(!d.hasOwnProperty(e)){continue
}this._notifyRecordPropertyChange(parseInt(e,10),NO)}}this.set("hasChanges",NO)},commitChangesFromNestedStore:function(o,p,g){if(!g){this._verifyLockRevisions(p,o.locks)
}var l=p.length,j,x,k,d,u,e,h,s,n;e=this.revisions;k=this.dataHashes;d=this.statuses;
u=this.editables;if(!u){u=this.editables=[]}h=o.dataHashes;n=o.revisions;s=o.statuses;
for(j=0;j<l;j++){x=p[j];k[x]=h[x];d[x]=s[x];e[x]=n[x];u[x]=0;this._notifyRecordPropertyChange(x,NO)
}var y=this.changelog,m=o.changelog;if(m){if(!y){y=this.changelog=SC.CoreSet.create()
}y.addEach(m)}this.changelog=y;if(!this.get("parentStore")){this.flush()}return this
},_verifyLockRevisions:function(k,m){var d=k.length,g=this.revisions,j,l,h,e;if(m&&g){for(j=0;
j<d;j++){l=k[j];h=m[l]||1;e=g[l]||1;if(h<e){throw SC.Store.CHAIN_CONFLICT_ERROR}}}return this
},find:function(e,d){if(SC.typeOf(e)===SC.T_STRING){e=SC.objectForPropertyPath(e)
}if((arguments.length===1)&&!(e&&e.get&&e.get("isRecord"))){if(!e){throw new Error("SC.Store#find() must pass recordType or query")
}if(!e.isQuery){e=SC.Query.local(e)}return this._findQuery(e,YES,YES)}else{return this._findRecord(e,d)
}},findAll:function(g,d,e){console.warn("SC.Store#findAll() will be removed in a future version of SproutCore.  Use SC.Store#find() instead");
if(!g||!g.isQuery){g=SC.Query.local(g,d,e)}return this._findQuery(g,YES,YES)},_findQuery:function(k,d,j){var e=this._scst_recordArraysByQuery,h=SC.guidFor(k),g,l;
if(!e){e=this._scst_recordArraysByQuery={}}g=e[h];if(!g&&d){e[h]=g=SC.RecordArray.create({store:this,query:k});
l=this.get("recordArrays");if(!l){this.set("recordArrays",l=SC.Set.create())}l.add(g);
if(j){this.refreshQuery(k)}}this.flush();return g},_findRecord:function(g,e){var d;
if(g&&g.get&&g.get("isRecord")){d=g.get("storeKey")}else{d=e?g.storeKeyFor(e):null
}if(d&&(this.readStatus(d)===SC.Record.EMPTY)){d=this.retrieveRecord(g,e)}return d?this.materializeRecord(d):null
},recordArrayWillDestroy:function(e){var d=this._scst_recordArraysByQuery,g=this.get("recordArrays");
if(d){delete d[SC.guidFor(e.get("query"))]}if(g){g.remove(e)}return this},refreshQuery:function(h){if(!h){throw new Error("refreshQuery() requires a query")
}var d=this._scst_recordArraysByQuery,g=d?d[SC.guidFor(h)]:null,e=this._getDataSource();
if(e&&e.fetch){if(g){g.storeWillFetchQuery(h)}e.fetch.call(e,this,h)}return this},_notifyRecordArrays:function(e,d){var g=this.get("recordArrays");
if(!g){return this}g.forEach(function(h){if(h){h.storeDidChangeStoreKeys(e,d)}},this);
return this},recordsFor:function(k){var h=[],d=k.storeKeysById(),j,g,e;for(j in d){g=d[j];
if(this.readStatus(g)!==SC.RECORD_EMPTY){h.push(g)}}if(h.length>0){e=SC.RecordArray.create({store:this,storeKeys:h})
}else{e=h}return e},_TMP_REC_ATTRS:{},materializeRecord:function(h){var d=this.records,g,j,e;
if(!d){d=this.records={}}g=d[h];if(g){return g}j=SC.Store.recordTypeFor(h);if(!j){return null
}e=this._TMP_REC_ATTRS;e.storeKey=h;e.store=this;g=d[h]=j.create(e);return g},createRecord:function(e,h,d){var m,n,g,l=SC.Record,j,k;
if(!d&&(m=e.prototype.primaryKey)){d=h[m];k=e.prototype[m]?e.prototype[m].defaultValue:null;
if(!d&&SC.typeOf(k)===SC.T_FUNCTION){d=h[m]=k()}}n=d?e.storeKeyFor(d):SC.Store.generateStoreKey();
g=this.readStatus(n);if((g&l.BUSY)||(g&l.READY)||(g==l.DESTROYED_DIRTY)){throw d?l.RECORD_EXISTS_ERROR:l.BAD_STATE_ERROR
}else{if(!d&&(g==SC.DESTROYED_CLEAN||g==SC.ERROR)){throw l.BAD_STATE_ERROR}}this.writeDataHash(n,(h?h:{}),l.READY_NEW);
SC.Store.replaceRecordTypeFor(n,e);this.dataHashDidChange(n);j=this.changelog;if(!j){j=SC.Set.create()
}j.add(n);this.changelog=j;if(this.get("commitRecordsAutomatically")){this.invokeLast(this.commitRecords)
}return this.materializeRecord(n)},createRecords:function(h,n,d){var l=[],g,e,j,k=n.length,m;
j=SC.typeOf(h)===SC.T_ARRAY;if(!j){g=h}for(m=0;m<k;m++){if(j){g=h[m]||SC.Record}e=d?d[m]:undefined;
l.push(this.createRecord(g,n[m],e))}return l},unloadRecord:function(k,j,h,g){if(h===undefined){h=k.storeKeyFor(j)
}var e=this.readStatus(h),d=SC.Record;g=g||d.EMPTY;if((e===d.BUSY_DESTROYING)||(e&d.DESTROYED)){return this
}else{if(e&d.BUSY){throw d.BUSY_ERROR}else{e=g}}this.removeDataHash(h,e);this.dataHashDidChange(h);
return this},unloadRecords:function(h,d,l,j){var m,k,n,e,g,o;if(l===undefined){m=d.length;
k=SC.typeOf(h)===SC.T_ARRAY;if(!k){g=h}for(n=0;n<m;n++){if(k){g=h[n]||SC.Record}e=d?d[n]:undefined;
this.unloadRecord(g,e,undefined,j)}}else{m=l.length;for(n=0;n<m;n++){o=l?l[n]:undefined;
this.unloadRecord(undefined,undefined,o,j)}}return this},destroyRecord:function(k,j,h){if(h===undefined){h=k.storeKeyFor(j)
}var e=this.readStatus(h),g,d=SC.Record;if((e===d.BUSY_DESTROYING)||(e&d.DESTROYED)){return this
}else{if(e==d.EMPTY){throw d.NOT_FOUND_ERROR}else{if(e&d.BUSY){throw d.BUSY_ERROR
}else{if(e==d.READY_NEW){e=d.DESTROYED_CLEAN}else{e=d.DESTROYED_DIRTY}}}}this.writeStatus(h,e);
this.dataHashDidChange(h);g=this.changelog;if(!g){g=this.changelog=SC.Set.create()
}((e&d.DIRTY)?g.add(h):g.remove(h));this.changelog=g;if(this.get("commitRecordsAutomatically")){this.invokeLast(this.commitRecords)
}return this},destroyRecords:function(h,d,k){var l,j,m,e,g,n;if(k===undefined){l=d.length;
j=SC.typeOf(h)===SC.T_ARRAY;if(!j){g=h}for(m=0;m<l;m++){if(j){g=h[m]||SC.Record}e=d?d[m]:undefined;
this.destroyRecord(g,e,undefined)}}else{l=k.length;for(m=0;m<l;m++){n=k?k[m]:undefined;
this.destroyRecord(undefined,undefined,n)}}return this},recordDidChange:function(m,l,k,h,g){if(k===undefined){k=m.storeKeyFor(l)
}var e=this.readStatus(k),j,d=SC.Record;if(e&d.BUSY){throw d.BUSY_ERROR}else{if(!(e&d.READY)){throw d.NOT_FOUND_ERROR
}else{if(e!=d.READY_NEW){this.writeStatus(k,d.READY_DIRTY)}}}this.dataHashDidChange(k,null,g,h);
j=this.changelog;if(!j){j=this.changelog=SC.Set.create()}j.add(k);this.changelog=j;
if(this.get("commitRecordsAutomatically")){this.invokeLast(this.commitRecords)}return this
},recordsDidChange:function(h,d,k){var l,j,m,e,g,n;if(k===undefined){l=d.length;j=SC.typeOf(h)===SC.T_ARRAY;
if(!j){g=h}for(m=0;m<l;m++){if(j){g=h[m]||SC.Record}e=d?d[m]:undefined;n=k?k[m]:undefined;
this.recordDidChange(g,e,n)}}else{l=k.length;for(m=0;m<l;m++){n=k?k[m]:undefined;
this.recordDidChange(undefined,undefined,n)}}return this},retrieveRecords:function(k,e,n,g){var d=this._getDataSource(),m=SC.typeOf(k)===SC.T_ARRAY,o=(!n)?e.length:n.length,p=[],l=SC.Store.generateStoreKey(),u=SC.Record,h,x,y,j,s;
if(!m){h=k}for(x=0;x<o;x++){if(n){y=n[x]}else{if(m){h=k[x]}y=h.storeKeyFor(e[x])}j=this.readStatus(y);
if((j==u.EMPTY)||(j==u.ERROR)||(j==u.DESTROYED_CLEAN)){this.writeStatus(y,u.BUSY_LOADING);
this.dataHashDidChange(y,l,YES);p.push(y)}else{if(g){if(j&u.READY){this.writeStatus(y,u.BUSY_REFRESH|(j&3));
this.dataHashDidChange(y,l,YES);p.push(y)}else{if((j==u.BUSY_DESTROYING)||(j==u.BUSY_CREATING)||(j==u.BUSY_COMMITTING)){throw u.BUSY_ERROR
}else{if(j==u.DESTROYED_DIRTY){throw u.BAD_STATE_ERROR}}}}}}s=NO;if(d){s=d.retrieveRecords.call(d,this,p,e)
}if(!s){o=p.length;l=SC.Store.generateStoreKey();for(x=0;x<o;x++){y=p[x];j=this.readStatus(y);
if(j===u.BUSY_LOADING){this.writeStatus(y,u.ERROR);this.dataHashDidChange(y,l,YES)
}else{if(j&u.BUSY_REFRESH){this.writeStatus(y,u.READY|(j&3));this.dataHashDidChange(y,l,YES)
}}}p.length=0}return p},_TMP_RETRIEVE_ARRAY:[],retrieveRecord:function(k,j,e,g){var h=this._TMP_RETRIEVE_ARRAY,d;
if(e){h[0]=e;e=h;j=null}else{h[0]=j;j=h}d=this.retrieveRecords(k,j,e,g);h.length=0;
return d[0]},refreshRecord:function(g,e,d){return !!this.retrieveRecord(g,e,d,YES)
},refreshRecords:function(e,g,h){var d=this.retrieveRecords(e,g,h,YES);return d&&d.length>0
},commitRecords:function(j,s,e,y){var p=this._getDataSource(),l=SC.typeOf(j)===SC.T_ARRAY,g=[],n=[],o=[],z=SC.Store.generateStoreKey(),k=SC.Record,d,m,h,u,B,A,x;
if(!j&&!s&&!e){e=this.changelog}x=e?e.get("length"):(s?s.get("length"):0);for(m=0;
m<x;m++){if(e){h=e[m]}else{if(l){d=j[m]||SC.Record}else{d=j}h=d.storeKeyFor(s[m])
}u=this.readStatus(h);if((u==k.EMPTY)||(u==k.ERROR)){throw k.NOT_FOUND_ERROR}else{if(u==k.READY_NEW){this.writeStatus(h,k.BUSY_CREATING);
this.dataHashDidChange(h,z,YES);g.push(h)}else{if(u==k.READY_DIRTY){this.writeStatus(h,k.BUSY_COMMITTING);
this.dataHashDidChange(h,z,YES);n.push(h)}else{if(u==k.DESTROYED_DIRTY){this.writeStatus(h,k.BUSY_DESTROYING);
this.dataHashDidChange(h,z,YES);o.push(h)}else{if(u==k.DESTROYED_CLEAN){this.dataHashDidChange(h,z,YES)
}}}}}}if(p&&(x>0||y)){A=p.commitRecords.call(p,this,g,n,o,y)}if(A&&!j&&!s&&e===this.changelog){this.changelog=null
}return A},commitRecord:function(k,j,e,g){var h=this._TMP_RETRIEVE_ARRAY,d;if(j===undefined&&e===undefined){return NO
}if(e!==undefined){h[0]=e;e=h;j=null}else{h[0]=j;j=h}d=this.commitRecords(k,j,e,g);
h.length=0;return d},cancelRecords:function(j,e,n){var d=this._getDataSource(),l=SC.typeOf(j)===SC.T_ARRAY,p=SC.Record,o=[],k,m,s,g,h,u;
m=(n===undefined)?e.length:n.length;for(s=0;s<m;s++){if(l){h=j[s]||SC.Record}else{h=j||SC.Record
}g=e?e[s]:undefined;if(n===undefined){u=h.storeKeyFor(g)}else{u=n?n[s]:undefined}if(u){k=this.readStatus(u);
if((k==p.EMPTY)||(k==p.ERROR)){throw p.NOT_FOUND_ERROR}o.push(u)}}if(d){d.cancel.call(d,this,o)
}return this},cancelRecord:function(j,h,e){var g=this._TMP_RETRIEVE_ARRAY,d;if(e!==undefined){g[0]=e;
e=g;h=null}else{g[0]=h;h=g}d=this.cancelRecords(j,h,e);g.length=0;return this},loadRecord:function(l,h,k){var d=SC.Record,g,e,j;
l=l||SC.Record;e=l.prototype.primaryKey;k=k||h[e];g=j=l.storeKeyFor(k);if(this.readStatus(j)&d.BUSY){this.dataSourceDidComplete(j,h,k)
}else{this.pushRetrieve(l,k,h,j)}return g},loadRecords:function(h,u,d){var k=SC.typeOf(h)===SC.T_ARRAY,l=u.get("length"),m=[],n=SC.Record,g,e,p,o,j,s;
if(!k){g=h||SC.Record;p=g.prototype.primaryKey}for(o=0;o<l;o++){j=u.objectAt(o);if(k){g=h.objectAt(o)||SC.Record;
p=g.prototype.primaryKey}e=(d)?d.objectAt(o):j[p];m[o]=this.loadRecord(g,j,e)}return m
},readError:function(d){var e=this.recordErrors;return e?e[d]:undefined},readQueryError:function(d){var e=this.queryErrors;
return e?e[SC.guidFor(d)]:undefined},dataSourceDidCancel:function(g){var e=this.readStatus(g),d=SC.Record;
if(!(e&d.BUSY)){throw d.BAD_STATE_ERROR}switch(e){case d.BUSY_LOADING:e=d.EMPTY;break;
case d.BUSY_CREATING:e=d.READY_NEW;break;case d.BUSY_COMMITTING:e=d.READY_DIRTY;break;
case d.BUSY_REFRESH_CLEAN:e=d.READY_CLEAN;break;case d.BUSY_REFRESH_DIRTY:e=d.READY_DIRTY;
break;case d.BUSY_DESTROYING:e=d.DESTROYED_DIRTY;break;default:throw d.BAD_STATE_ERROR
}this.writeStatus(g,e);this.dataHashDidChange(g,null,YES);return this},dataSourceDidComplete:function(k,j,h){var e=this.readStatus(k),d=SC.Record,g;
if(!(e&d.BUSY)){throw d.BAD_STATE_ERROR}if(e===d.BUSY_DESTROYING){throw d.BAD_STATE_ERROR
}else{e=d.READY_CLEAN}this.writeStatus(k,e);if(j){this.writeDataHash(k,j,e)}if(h){SC.Store.replaceIdFor(k,h)
}g=j||h?NO:YES;this.dataHashDidChange(k,null,g);return this},dataSourceDidDestroy:function(g){var e=this.readStatus(g),d=SC.Record;
if(!(e&d.BUSY)){throw d.BAD_STATE_ERROR}else{e=d.DESTROYED_CLEAN}this.removeDataHash(g,e);
this.dataHashDidChange(g);return this},dataSourceDidError:function(h,g){var e=this.readStatus(h),j=this.recordErrors,d=SC.Record;
if(!(e&d.BUSY)){throw d.BAD_STATE_ERROR}else{e=d.ERROR}if(g&&g.isError){if(!j){j=this.recordErrors=[]
}j[h]=g}this.writeStatus(h,e);this.dataHashDidChange(h,null,YES);return this},pushRetrieve:function(k,j,g,h){var e=SC.Record,d;
if(h===undefined){h=k.storeKeyFor(j)}d=this.readStatus(h);if(d==e.EMPTY||d==e.ERROR||d==e.READY_CLEAN||d==e.DESTROYED_CLEAN){d=e.READY_CLEAN;
if(g===undefined){this.writeStatus(h,d)}else{this.writeDataHash(h,g,d)}this.dataHashDidChange(h);
return h}return NO},pushDestroy:function(j,h,g){var e=SC.Record,d;if(g===undefined){g=j.storeKeyFor(h)
}d=this.readStatus(g);if(d==e.EMPTY||d==e.ERROR||d==e.READY_CLEAN||d==e.DESTROYED_CLEAN){d=e.DESTROYED_CLEAN;
this.removeDataHash(g,d);this.dataHashDidChange(g);return g}return NO},pushError:function(l,k,g,h){var e=SC.Record,d,j=this.recordErrors;
if(h===undefined){h=l.storeKeyFor(k)}d=this.readStatus(h);if(d==e.EMPTY||d==e.ERROR||d==e.READY_CLEAN||d==e.DESTROYED_CLEAN){d=e.ERROR;
if(g&&g.isError){if(!j){j=this.recordErrors=[]}j[h]=g}this.writeStatus(h,d);this.dataHashDidChange(h,null,YES);
return h}return NO},loadQueryResults:function(g,d){if(g.get("location")===SC.Query.LOCAL){throw new Error("Cannot load query results for a local query")
}var e=this._findQuery(g,YES,NO);if(e){e.set("storeKeys",d)}this.dataSourceDidFetchQuery(g);
return this},dataSourceDidFetchQuery:function(d){return this._scstore_dataSourceDidFetchQuery(d,YES)
},_scstore_dataSourceDidFetchQuery:function(h,d){var g=this._findQuery(h,d,NO),e=this.get("nestedStores"),j=e?e.get("length"):0;
if(g){g.storeDidFetchQuery(h)}while(--j>=0){e[j]._scstore_dataSourceDidFetchQuery(h,NO)
}return this},dataSourceDidCancelQuery:function(d){return this._scstore_dataSourceDidCancelQuery(d,YES)
},_scstore_dataSourceDidCancelQuery:function(h,d){var g=this._findQuery(h,d,NO),e=this.get("nestedStores"),j=e?e.get("length"):0;
if(g){g.storeDidCancelQuery(h)}while(--j>=0){e[j]._scstore_dataSourceDidCancelQuery(h,NO)
}return this},dataSourceDidErrorQuery:function(e,d){var g=this.queryErrors;if(d&&d.isError){if(!g){g=this.queryErrors={}
}g[SC.guidFor(e)]=d}return this._scstore_dataSourceDidErrorQuery(e,YES)},_scstore_dataSourceDidErrorQuery:function(h,d){var g=this._findQuery(h,d,NO),e=this.get("nestedStores"),j=e?e.get("length"):0;
if(g){g.storeDidErrorQuery(h)}while(--j>=0){e[j]._scstore_dataSourceDidErrorQuery(h,NO)
}return this},init:function(){arguments.callee.base.apply(this,arguments);this.reset()
},toString:function(){var e=this.get("name");if(!e){return arguments.callee.base.apply(this,arguments)
}else{var d=arguments.callee.base.apply(this,arguments);return"%@ (%@)".fmt(e,d)}},idFor:function(d){return SC.Store.idFor(d)
},recordTypeFor:function(d){return SC.Store.recordTypeFor(d)},storeKeyFor:function(e,d){return e.storeKeyFor(d)
},storeKeyExists:function(e,d){return e.storeKeyExists(d)},storeKeysFor:function(k){var d=[],j=k&&k.isEnumerable,g,h,e;
if(!this.statuses){return d}for(h in SC.Store.recordTypesByStoreKey){g=SC.Store.recordTypesByStoreKey[h];
if(j){e=k.contains(g)}else{e=g===k}if(e&&this.statuses[h]){d.push(parseInt(h,10))
}}return d},storeKeys:function(){var d=[],e;if(!this.statuses){return d}for(e in this.statuses){if(this.statuses[e]!=SC.Record.EMPTY){d.push(parseInt(e,10))
}}return d},statusString:function(d){var e=this.materializeRecord(d);return e.statusString()
}});SC.Store.mixin({CHAIN_CONFLICT_ERROR:new Error("Nested Store Conflict"),NO_PARENT_STORE_ERROR:new Error("Parent Store Required"),NESTED_STORE_UNSUPPORTED_ERROR:new Error("Unsupported In Nested Store"),NESTED_STORE_RETRIEVE_DIRTY_ERROR:new Error("Cannot Retrieve Dirty Record in Nested Store"),EDITABLE:"editable",LOCKED:"locked",INHERITED:"inherited",idsByStoreKey:[],recordTypesByStoreKey:{},queriesByStoreKey:[],nextStoreKey:1,generateStoreKey:function(){return this.nextStoreKey++
},idFor:function(d){return this.idsByStoreKey[d]},queryFor:function(d){return this.queriesByStoreKey[d]
},recordTypeFor:function(d){return this.recordTypesByStoreKey[d]},replaceIdFor:function(g,d){var h=this.idsByStoreKey[g],j,e;
if(h!==d){j=this.recordTypeFor(g);if(!j){throw new Error("replaceIdFor: storeKey %@ does not exist".fmt(g))
}this.idsByStoreKey[g]=d;e=j.storeKeysById();delete e[h];e[d]=g}return this},replaceRecordTypeFor:function(d,e){this.recordTypesByStoreKey[d]=e;
return this}});SC.Store.prototype.nextStoreIndex=1;SC.Store._getDefaultStore=function(){var d=this._store;
if(!d){this._store=d=SC.Store.create()}return d};SC.Store.updateRecords=function(k,l,m,g){console.warn("SC.Store.updateRecords() is deprecated.  Use loadRecords() instead");
var h=this._getDefaultStore(),e=k.length,d,j;if(!m){m=[];for(d=0;d<e;d++){m[d]=k[d].recordType
}}j=h.loadRecords(m,k);e=j.length;for(d=0;d<e;d++){j[d]=h.materializeRecord(j[d])
}return j};SC.Store.find=function(d,e){return this._getDefaultStore().find(e,d)};
SC.Store.findAll=function(d,e){return this._getDefaultStore().findAll(d,e)};var store,fds,storeKey1,storeKey2;
module("SC.FixturesDataSource",{setup:function(){SC.RunLoop.begin();var d=(window.Sample=SC.Object.create());
d.File=SC.Record.extend({test:"hello"});d.File.FIXTURES=[{guid:"10",name:"Home",url:"/emily_parker",isDirectory:true,parent:null,children:"Collection"},{guid:"11",name:"Documents",fileType:"documents",url:"/emily_parker/Documents",isDirectory:true,parent:"10",children:"Collection",createdAt:"June 15, 2007",modifiedAt:"October 21, 2007",filetype:"directory",isShared:false},{guid:"137",name:"Library",fileType:"library",url:"/emily_parker/Library",isDirectory:true,parent:"10",children:"Collection",createdAt:"June 15, 2007",modifiedAt:"October 21, 2007",filetype:"directory",isShared:false},{guid:"12",name:"Movies",fileType:"movies",url:"/emily_parker/Movies",isDirectory:true,parent:"10",children:"Collection",createdAt:"June 15, 2007",modifiedAt:"June 15, 2007",filetype:"directory",isShared:true,sharedAt:"October 15, 2007",sharedUntil:"March 31, 2008",sharedUrl:"2fhty",isPasswordRequired:true},{guid:"134",name:"Music",fileType:"music",url:"/emily_parker/Music",isDirectory:true,parent:"10",children:"Collection",createdAt:"June 15, 2007",modifiedAt:"June 15, 2007",filetype:"directory",isShared:true,sharedAt:"October 15, 2007",sharedUntil:"March 31, 2008",sharedUrl:"2fhty",isPasswordRequired:true},{guid:"135",name:"Pictures",fileType:"pictures",url:"/emily_parker/Pictures",isDirectory:true,parent:"10",children:"Collection",createdAt:"June 15, 2007",modifiedAt:"June 15, 2007",filetype:"directory",isShared:true,sharedAt:"October 15, 2007",sharedUntil:"March 31, 2008",sharedUrl:"2fhty",isPasswordRequired:true},{guid:"13",name:"Auto Insurance",fileType:"folder",url:"/emily_parker/Documents/Auto%20Insurance",isDirectory:true,parent:"11",children:"Collection",createdAt:"June 15, 2007",modifiedAt:"October 21, 2007",filetype:"directory",isShared:false},{guid:"150",name:"Birthday Invitation.pdf",fileType:"file",url:"/emily_parker/Documents/Birthday%20Invitation",isDirectory:false,parent:"11",createdAt:"October 17, 2007",modifiedAt:"October 21, 2007",filetype:"pdf",isShared:false},{guid:"136",name:"Software",fileType:"software",url:"/emily_parker/Software",isDirectory:true,parent:"10",children:"Collection",createdAt:"June 15, 2007",modifiedAt:"June 15, 2007",filetype:"directory",isShared:true,sharedAt:"October 15, 2007",sharedUntil:"March 31, 2008",sharedUrl:"2fhty",isPasswordRequired:true}];
store=SC.Store.create().from(SC.Record.fixtures)},teardown:function(){SC.RunLoop.end()
}});test("Verify find() loads all fixture data",function(){var g=store.find(Sample.File),l,k,h;
ok(g,"should return a result");equals(g.get("length"),Sample.File.FIXTURES.get("length"),"should return records for each item in FIXTURES");
var e,d=g.get("length"),j=[];for(e=0;e<d;e++){l=g.objectAt(e);k=l?l.get("storeKey"):null;
h=k?store.readDataHash(k):null;ok(!!h,"storeKey at result[%@] (%@) should return dataHash".fmt(e,k));
j.push(l)}g=store.find(Sample.File);equals(g.get("length"),j.length,"second result should have same length as first");
d=g.get("length");for(e=0;e<d;e++){l=g.objectAt(e);equals(l,j[e],"record returned at index %@ should be same as previous".fmt(e))
}});test("Verify find() loads data from store",function(){var d=store.find(Sample.File,"150");
equals(d.get("name"),"Birthday Invitation.pdf","returns record should have name from fixture")
});test("Destroy a record and commit",function(){var d=store.find(Sample.File,"136"),g=d.get("storeKey"),e=store.get("dataSource");
ok(d,"precond - must have record in store");ok(e.fixtureForStoreKey(store,g),"precond - fixtures should have data for record");
store.destroyRecord(Sample.File,"136");store.commitRecords();ok(!e.fixtureForStoreKey(store,g),"fixtures should no longer have data for record")
});test("Create a record and commit it",function(){var e=store.get("dataSource"),d={guid:"200",name:"Software",fileType:"software",url:"/emily_parker/Software",isDirectory:true,parent:"10",children:"Collection",createdAt:"June 15, 2007",modifiedAt:"June 15, 2007",filetype:"directory",isShared:true,sharedAt:"October 15, 2007",sharedUntil:"March 31, 2008",sharedUrl:"2fhty",isPasswordRequired:true},g;
store.createRecord(Sample.File,d);store.commitRecords();g=Sample.File.storeKeyFor(d.guid);
ok(e.fixtureForStoreKey(store,g),"should have data hash in fixtures")});test("Update and commit a record",function(){var h=store.find(Sample.File,"10"),g=Sample.File.storeKeyFor("10"),d=store.get("dataSource"),e=d.fixtureForStoreKey(store,g);
equals(e.name,h.get("name"),"precond - fixture state should match name");h.set("name","foo");
store.commitRecords();e=d.fixtureForStoreKey(store,g);equals(e.name,h.get("name"),"fixture state should update to match new name")
});var AB;module("Sample Model from an address book app",{setup:function(){AB=SC.Application.create({store:SC.Store.create(SC.Record.fixtures)});
AB.ContactDetail=SC.Record.extend({});AB.Contact=SC.Record.extend({details:SC.Record.toMany(AB.ContactDetail)});
AB.ContactGroup=SC.Record.extend({contacts:SC.Collection.fetch({inverse:"group",recordType:"AB.Contact"})});
AB.ContactDetail=SC.Record.extend({validateLabel:SC.Record.validate(String).required(),validateKind:SC.Record.validate(String).required()});
AB.PhoneNumber=AB.ContactDetail.extend({kindDefault:"phone",labelDefault:"home"});
AB.Contact=SC.Record.extend({isCompany:SC.Record.property(Boolean,{defaultValue:NO}),phones:SC.Collection.inline({recordType:"AB.PhoneNumber"})});
AB.Contact=SC.Record.extend({firstNameType:String,lastNameType:String,contactDetailsType:SC.Collection.inline({isDependent:YES,recordType:"AB.ContactDetail"}),groups:function(e,d){if(d!==undefined){this.writeAttribute("groups",d.getEach("guid"));
d.invoke("notifyPropertyChange","contacts")}return this.get("store").records(this.readAttribute("groups"))
}.property().cacheable()});AB.ContactAddress=SC.Record.extend({descriptionType:String,street1:String,street2:String,city:String,state:String,country:String,contact:function(){this.get("store").record(this.readAttribute("contact"))
}})}});module("Cyclical relationships",{setup:function(){window.AB=SC.Object.create({store:SC.Store.create().from(SC.Record.fixtures)});
AB.Contact=SC.Record.extend({name:SC.Record.attr(String),group:SC.Record.toOne("AB.Group"),isFavorite:SC.Record.attr(Boolean)});
AB.Group=SC.Record.extend({name:SC.Record.attr(String),contacts:function(){var d=SC.Query.local(AB.Contact,"group = {record}",{record:this});
return this.get("store").find(d)}.property().cacheable(),favoriteContacts:function(){return this.get("contacts").filterProperty("isFavorite",YES)
}.property("contacts").cacheable(),contactsContentDidChange:function(){this.notifyPropertyChange("favoriteContacts")
}.observes(".contacts*[]")});AB.Group.FIXTURES=[{guid:100,name:"G1"},{guid:101,name:"G2"}];
AB.Contact.FIXTURES=[{guid:1,name:"G1-Fav1",group:100,isFavorite:YES},{guid:2,name:"G1-Fav2",group:100,isFavorite:YES},{guid:3,name:"G1-Norm1",group:100,isFavorite:NO},{guid:4,name:"G2-Fav1",group:101,isFavorite:YES},{guid:5,name:"G1-Norm1",group:101,isFavorite:NO}];
SC.RunLoop.begin()},teardown:function(){SC.RunLoop.end();AB=null}});test("getting all contacts in a group",function(){var e=AB.store.find(AB.Group,100);
var d=AB.store.find(AB.Contact).filterProperty("group",e);same(e.get("contacts"),d,"contacts")
});test("finding favoriteContacts",function(){var e=AB.store.find(AB.Group,100);var d=AB.store.find(AB.Contact).filterProperty("group",e).filterProperty("isFavorite",YES);
same(e.get("favoriteContacts"),d,"contacts");var g=AB.store.find(AB.Contact,4);g.set("group",e);
SC.RunLoop.end();SC.RunLoop.begin();d.push(g);same(e.get("favoriteContacts"),d,"favoriteContacts after adding extra")
});var Mail;module("Sample Model from a webmail app",{setup:function(){Mail=SC.Object.create({store:SC.Store.create()});
Mail.Mailbox=SC.Record.extend({name:SC.Record.attr(String,{isRequired:YES}),mailbox:SC.Record.attr(String,{isRequired:YES,only:"INBOX TRASH OTHER".w()}),sortKey:SC.Record.attr(String,{isRequired:YES,only:"subject date from to".w()}),messages:SC.Record.fetch("Mail.Message")});
Mail.Message=SC.Record.extend({date:SC.Record.attr(Date,{isRequired:YES}),mailboxes:SC.Record.toMany("Mail.Mailbox",{inverse:"messages",isMaster:YES,minimum:1}),messageDetail:SC.Record.toOne("Mail.MessageDetail",{inverse:"message",isDependent:YES}),body:SC.Record.through("messageDetail"),cc:SC.Record.through("messageDetail"),bcc:SC.Record.through("messageDetail"),subject:SC.Record.through("messageDetail")});
Mail.Contact=SC.Record.extend({firstName:SC.Record.attr(String),lastName:SC.Record.attr(String),email:SC.Record.attr(String)});
Mail.server=SC.RestServer.create({fetchMailboxes:function(d){return this.fetchRequest("/ma/mailboxes?alt=json")
}})}});var TestRunner;module("Sample Model from TestRunner Application",{setup:function(){TestRunner=SC.Object.create({store:SC.Store.create()});
TestRunner.Target=SC.Record.extend({name:SC.Record.attr(String),type:SC.Record.attr(String,{only:"single group all".w()}),tests:SC.Record.fetch("TestRunner.Test")});
TestRunner.Test=SC.Record.extend({testUrl:SC.Record.attr({key:"link_test"}),target:SC.Record.attr("TestRunner.Target",{inverse:"tests",isMaster:YES,isEditable:NO})})
}});var storeKeys,rec,rec2,rec3,rec4;var foo1,foo2,foo3,bar1,bar2,bar3;module("SC.ManyAttribute core methods",{setup:function(){SC.RunLoop.begin();
MyApp=SC.Object.create({store:SC.Store.create()});MyApp.Foo=SC.Record.extend({firstName:SC.Record.attr(String),otherName:SC.Record.attr(String,{key:"firstName"}),date:SC.Record.attr(Date),defaultValue:SC.Record.attr(String,{defaultValue:"default"}),fooMany:SC.Record.toMany("MyApp.Foo"),fooManyKeyed:SC.Record.toMany("MyApp.Foo",{key:"fooIds"}),barToMany:SC.Record.toMany("MyApp.Bar",{inverse:"fooToMany",isMaster:YES,orderBy:"name"}),barToOne:SC.Record.toMany("MyApp.Bar",{inverse:"fooToOne",isMaster:NO})});
MyApp.Bar=SC.Record.extend({fooToMany:SC.Record.toMany("MyApp.Foo",{inverse:"barToMany",isMaster:NO}),fooToOne:SC.Record.toOne("MyApp.Foo",{inverse:"barToOne",isMaster:YES})});
storeKeys=MyApp.store.loadRecords(MyApp.Foo,[{guid:1,firstName:"John",lastName:"Doe",barToMany:["bar1"],barToOne:["bar1","bar2"]},{guid:2,firstName:"Jane",lastName:"Doe",barToMany:["bar1","bar2"],barToOne:[]},{guid:3,firstName:"Emily",lastName:"Parker",fooMany:[1,2],barToMany:["bar2"],barToOne:[]},{guid:4,firstName:"Johnny",lastName:"Cash",fooIds:[1,2]}]);
MyApp.store.loadRecords(MyApp.Bar,[{guid:"bar1",name:"A",fooToMany:[1,2],fooToOne:1},{guid:"bar2",name:"Z",fooToMany:[2,3],fooToOne:1},{guid:"bar3",name:"C"}]);
foo1=rec=MyApp.store.find(MyApp.Foo,1);foo2=rec2=MyApp.store.find(MyApp.Foo,2);foo3=rec3=MyApp.store.find(MyApp.Foo,3);
rec4=MyApp.store.find(MyApp.Foo,4);equals(rec.storeKey,storeKeys[0],"should find record");
bar1=MyApp.store.find(MyApp.Bar,"bar1");bar2=MyApp.store.find(MyApp.Bar,"bar2");bar3=MyApp.store.find(MyApp.Bar,"bar3");
SC.RunLoop.end()},teardown:function(){MyApp=rec=rec2=rec3=foo1=foo2=foo3=bar1=bar2=null
}});test("pass-through should return builtin value",function(){equals(rec.get("firstName"),"John","reading prop should get attr value")
});test("getting toMany relationship should map guid to real records",function(){var d=MyApp.store.find(MyApp.Foo,3);
equals(d.get("id"),3,"precond - should find record 3");equals(d.get("fooMany").objectAt(0),rec,"should get rec1 instance for rec3.fooMany");
equals(d.get("fooMany").objectAt(1),rec2,"should get rec2 instance for rec3.fooMany")
});test("getting toMany relationship should map guid to real records when using different key",function(){var d=MyApp.store.find(MyApp.Foo,4);
equals(d.get("id"),4,"precond - should find record 4");equals(d.get("fooManyKeyed").objectAt(0),rec,"should get rec1 instance for rec4.fooManyKeyed");
equals(d.get("fooManyKeyed").objectAt(1),rec2,"should get rec2 instance for rec4.fooManyKeyed")
});test("getting toMany relation should not change record state",function(){equals(rec3.get("status"),SC.Record.READY_CLEAN,"precond - status should be READY_CLEAN");
var d=rec3.get("fooMany");ok(d,"rec3.get(fooMany) should return records");equals(rec3.get("status"),SC.Record.READY_CLEAN,"getting toMany should not change state")
});test("reading toMany in chained store",function(){var e,h,g,d;e=rec3.get("fooMany");
g=MyApp.store.chain();d=g.find(rec3);h=d.get("fooMany");same(h.getEach("storeKey"),e.getEach("storeKey"),"returns arrays from chained and parent should be same");
ok(h!==e,"returned arrays should not be same instance")});test("reading a null relation",function(){equals(rec.readAttribute("fooMany"),null,"rec1.fooMany attr should be null");
var d=rec.get("fooMany");equals(d.get("length"),0,"rec1.get(fooMany).length should be 0");
same(d.getEach("storeKey"),[],"rec1.get(fooMany) should return empty array")});test("writing to a to-many relationship should update set guids",function(){var d=MyApp.store.find(MyApp.Foo,3);
equals(d.get("id"),3,"precond - should find record 3");equals(d.get("fooMany").objectAt(0),rec,"should get rec1 instance for rec3.fooMany");
SC.RunLoop.begin();d.set("fooMany",[rec2,rec4]);SC.RunLoop.end();equals(d.get("fooMany").objectAt(0),rec2,"should get rec2 instance for rec3.fooMany");
equals(d.get("fooMany").objectAt(1),rec4,"should get rec4 instance for rec3.fooMany")
});test("writing to a to-many relationship should update set guids when using a different key",function(){var d=MyApp.store.find(MyApp.Foo,4);
equals(d.get("id"),4,"precond - should find record 4");equals(d.get("fooManyKeyed").objectAt(0),rec,"should get rec1 instance for rec4.fooManyKeyed");
SC.RunLoop.begin();d.set("fooManyKeyed",[rec2,rec3]);SC.RunLoop.end();ok(d.get("fooIds").isEqual([2,3]),"should get array of guids (2, 3) for rec4.fooIds")
});test("pushing an object to a to-many relationship attribute should update set guids",function(){var d=MyApp.store.find(MyApp.Foo,3);
equals(d.get("id"),3,"precond - should find record 3");equals(d.get("fooMany").length(),2,"should be 2 foo instances related");
d.get("fooMany").pushObject(rec4);equals(d.get("fooMany").length(),3,"should be 3 foo instances related");
equals(d.get("fooMany").objectAt(0),rec,"should get rec instance for rec3.fooMany");
equals(d.get("fooMany").objectAt(1),rec2,"should get rec2 instance for rec3.fooMany");
equals(d.get("fooMany").objectAt(2),rec4,"should get rec4 instance for rec3.fooMany")
});test("modifying a toMany array should mark the record as changed",function(){var d=rec3.get("fooMany");
equals(rec3.get("status"),SC.Record.READY_CLEAN,"precond - rec3.status should be READY_CLEAN");
ok(!!rec4,"precond - rec4 should be defined");SC.RunLoop.begin();d.pushObject(rec4);
SC.RunLoop.end();equals(rec3.get("status"),SC.Record.READY_DIRTY,"record status should have changed to dirty")
});test("modifying a toMany array within a nested store",function(){var k=MyApp.store.chain();
var e=rec3.get("fooMany");var g=k.find(rec3);var j=g.get("fooMany");var h=e.getEach("storeKey");
var d=k.find(rec4);equals(j.get("length"),2,"precond - childFooMany should be like parent");
j.pushObject(d);equals(j.get("length"),3,"childFooMany should have 1 more item");
SC.RunLoop.end();same(e.getEach("storeKey"),h,"parent.fooMany should not have changed yet");
equals(rec3.get("status"),SC.Record.READY_CLEAN,"parent rec3 should still be READY_CLEAN");
h=j.getEach("storeKey");SC.RunLoop.begin();k.commitChanges();SC.RunLoop.end();equals(e.get("length"),3,"parent.fooMany length should have changed");
same(e.getEach("storeKey"),h,"parent.fooMany should now have changed form child store");
equals(rec3.get("status"),SC.Record.READY_DIRTY,"parent rec3 should now be READY_DIRTY")
});test("should be able to modify an initially empty record",function(){same(rec.get("fooMany").getEach("storeKey"),[],"precond - fooMany should be empty");
rec.get("fooMany").pushObject(rec4);same(rec.get("fooMany").getEach("storeKey"),[rec4.get("storeKey")],"after edit should have new array")
});function checkAllClean(){SC.A(arguments).forEach(function(d){equals(d.get("status"),SC.Record.READY_CLEAN,"PRECOND - %@.status should be READY_CLEAN".fmt(d.get("id")))
},this)}test("removing a record from a many-to-many",function(){ok(foo1.get("barToMany").indexOf(bar1)>=0,"PRECOND - foo1.barToMany should contain bar1");
ok(bar1.get("fooToMany").indexOf(foo1)>=0,"PRECOND - bar1.fooToMany should contain foo1");
checkAllClean(foo1,bar1);foo1.get("barToMany").removeObject(bar1);ok(foo1.get("barToMany").indexOf(bar1)<0,"foo1.barToMany should NOT contain bar1");
ok(bar1.get("fooToMany").indexOf(foo1)<0,"bar1.fooToMany should NOT contain foo1");
equals(foo1.get("status"),SC.Record.READY_DIRTY,"foo1.status should be READY_DIRTY");
equals(bar1.get("status"),SC.Record.READY_CLEAN,"bar1.status should be READY_CLEAN")
});test("removing a record from a many-to-many; other side",function(){ok(foo1.get("barToMany").indexOf(bar1)>=0,"PRECOND - foo1.barToMany should contain bar1");
ok(bar1.get("fooToMany").indexOf(foo1)>=0,"PRECOND - bar1.fooToMany should contain foo1");
checkAllClean(foo1,bar1);bar1.get("fooToMany").removeObject(foo1);ok(foo1.get("barToMany").indexOf(bar1)<0,"foo1.barToMany should NOT contain bar1");
ok(bar1.get("fooToMany").indexOf(foo1)<0,"bar1.fooToMany should NOT contain foo1");
equals(foo1.get("status"),SC.Record.READY_DIRTY,"foo1.status should be READY_DIRTY");
equals(bar1.get("status"),SC.Record.READY_CLEAN,"bar1.status should be READY_CLEAN")
});test("adding a record to a many-to-many; bar side",function(){ok(foo2.get("barToMany").indexOf(bar3)<0,"PRECOND - foo1.barToMany should NOT contain bar1");
ok(bar3.get("fooToMany").indexOf(foo2)<0,"PRECOND - bar3.fooToMany should NOT contain foo1");
checkAllClean(foo2,bar3);bar3.get("fooToMany").pushObject(foo2);equals(foo2.get("barToMany").indexOf(bar3),1,"foo1.barToMany should contain bar1");
ok(bar3.get("fooToMany").indexOf(foo2)>=0,"bar1.fooToMany should contain foo1");equals(foo2.get("status"),SC.Record.READY_DIRTY,"foo1.status should be READY_DIRTY");
equals(bar1.get("status"),SC.Record.READY_CLEAN,"bar1.status should be READY_CLEAN")
});test("adding a record to a many-to-many; foo side",function(){ok(foo2.get("barToMany").indexOf(bar3)<0,"PRECOND - foo1.barToMany should NOT contain bar3");
ok(bar3.get("fooToMany").indexOf(foo2)<0,"PRECOND - bar3.fooToMany should NOT contain foo1");
checkAllClean(foo2,bar3);foo2.get("barToMany").pushObject(bar3);ok(foo2.get("barToMany").indexOf(bar3)>=0,"foo1.barToMany should contain bar3");
ok(bar3.get("fooToMany").indexOf(foo2)>=0,"bar1.fooToMany should contain foo3");equals(foo2.get("status"),SC.Record.READY_DIRTY,"foo1.status should be READY_DIRTY");
equals(bar1.get("status"),SC.Record.READY_CLEAN,"bar3.status should be READY_CLEAN")
});test("removing a record from a one-to-many",function(){ok(foo1.get("barToOne").indexOf(bar1)>=0,"PRECOND - foo1.barToOne should contain bar1");
equals(bar1.get("fooToOne"),foo1,"PRECOND - bar1.fooToOne should eq foo1");checkAllClean(foo1,bar1);
foo1.get("barToOne").removeObject(bar1);ok(foo1.get("barToOne").indexOf(bar1)<0,"foo1.barToOne should NOT contain bar1");
equals(bar1.get("fooToOne"),null,"bar1.fooToOne should eq null");equals(foo1.get("status"),SC.Record.READY_CLEAN,"foo1.status should be READY_CLEAN");
equals(bar1.get("status"),SC.Record.READY_DIRTY,"bar1.status should be READY_DIRTY")
});test("removing a record from a one-to-many; other-side",function(){ok(foo1.get("barToOne").indexOf(bar1)>=0,"PRECOND - foo1.barToOne should contain bar1");
equals(bar1.get("fooToOne"),foo1,"PRECOND - bar1.fooToOne should eq foo1");checkAllClean(foo1,bar1);
bar1.set("fooToOne",null);ok(foo1.get("barToOne").indexOf(bar1)<0,"foo1.barToOne should NOT contain bar1");
equals(bar1.get("fooToOne"),null,"bar1.fooToOne should eq null");equals(foo1.get("status"),SC.Record.READY_CLEAN,"foo1.status should be READY_CLEAN");
equals(bar1.get("status"),SC.Record.READY_DIRTY,"bar1.status should be READY_DIRTY")
});test("add a record to a one-to-many; many-side",function(){ok(foo1.get("barToOne").indexOf(bar3)<0,"PRECOND - foo1.barToOne should NOT contain bar3");
equals(bar3.get("fooToOne"),null,"PRECOND - bar3.fooToOne should eq null");checkAllClean(foo1,bar1);
foo1.get("barToOne").pushObject(bar3);ok(foo1.get("barToOne").indexOf(bar3)>=0,"foo1.barToOne should contain bar3");
equals(bar3.get("fooToOne"),foo1,"bar3.fooToOne should eq foo1");equals(foo1.get("status"),SC.Record.READY_CLEAN,"foo1.status should be READY_CLEAN");
equals(bar3.get("status"),SC.Record.READY_DIRTY,"bar3.status should be READY_DIRTY")
});test("add a record to a one-to-many; one-side",function(){ok(foo1.get("barToOne").indexOf(bar3)<0,"PRECOND - foo1.barToOne should NOT contain bar3");
equals(bar3.get("fooToOne"),null,"PRECOND - bar3.fooToOne should eq null");checkAllClean(foo1,bar1);
bar3.set("fooToOne",foo1);ok(foo1.get("barToOne").indexOf(bar3)>=0,"foo1.barToOne should contain bar3");
equals(bar3.get("fooToOne"),foo1,"bar3.fooToOne should eq foo1");equals(foo1.get("status"),SC.Record.READY_CLEAN,"foo1.status should be READY_CLEAN");
equals(bar3.get("status"),SC.Record.READY_DIRTY,"bar3.status should be READY_DIRTY")
});var NestedRecord,store,testParent,testParent2,childData1;var initModels=function(){NestedRecord.ParentRecordTest=SC.Record.extend({childRecordNamespace:NestedRecord,name:SC.Record.attr(String),info:SC.Record.toOne("NestedRecord.ChildRecordTest",{nested:true})});
NestedRecord.ChildRecordTest=SC.ChildRecord.extend({id:SC.Record.attr(String),name:SC.Record.attr(String),value:SC.Record.attr(String)})
};module("Basic SC.Record Functions w/ Parent > Child",{setup:function(){NestedRecord=SC.Object.create({store:SC.Store.create()});
store=NestedRecord.store;initModels();SC.RunLoop.begin();testParent=store.createRecord(NestedRecord.ParentRecordTest,{name:"Parent Name",info:{type:"ChildRecordTest",name:"Child Name",value:"Blue Goo",id:"5001"}});
testParent2=NestedRecord.store.createRecord(NestedRecord.ParentRecordTest,{name:"Parent Name 2",info:{type:"ChildRecordTest",name:"Child Name 2",value:"Purple Goo",id:"5002"}});
SC.RunLoop.end();childData1={type:"ChildRecordTest",name:"Child Name",value:"Green Goo",id:"5002"}
},teardown:function(){delete NestedRecord.ParentRecordTest;delete NestedRecord.ChildRecordTest;
testParent=null;testParent2=null;store=null;childData1=null;NestedRecord=null}});
test("Function: readAttribute()",function(){equals(testParent.readAttribute("name"),"Parent Name","readAttribute should be correct for name attribute");
equals(testParent.readAttribute("nothing"),null,"readAttribute should be correct for invalid key");
same(testParent.readAttribute("info"),{type:"ChildRecordTest",name:"Child Name",value:"Blue Goo",id:"5001"},"readAttribute should be correct for info child attribute")
});test("Support Multiple Parent Records With Different Child Records",function(){same(testParent2.readAttribute("info"),{type:"ChildRecordTest",name:"Child Name 2",value:"Purple Goo",id:"5002"},"readAttribute should be correct for info child attribute on new record");
equals(testParent2.get("info").get("value"),"Purple Goo","get should retrieve the proper value on new record");
same(testParent.readAttribute("info"),{type:"ChildRecordTest",name:"Child Name",value:"Blue Goo",id:"5001"},"readAttribute should be correct for info child attribute on first record");
equals(testParent.get("info").get("value"),"Blue Goo","get should retrieve the proper value on first record")
});test("Function: writeAttribute()",function(){testParent.writeAttribute("name","New Parent Name");
equals(testParent.get("name"),"New Parent Name","writeAttribute should be the new name attribute");
testParent.writeAttribute("nothing","nothing");equals(testParent.get("nothing"),"nothing","writeAttribute should be correct for new key");
testParent.writeAttribute("info",{type:"ChildRecordTest",name:"New Child Name",value:"Red Goo"});
same(testParent.readAttribute("info"),{type:"ChildRecordTest",name:"New Child Name",value:"Red Goo"},"writeAttribute with readAttribute should be correct for info child attribute")
});test("Basic Read",function(){var m;equals(testParent.get("name"),"Parent Name","get should be correct for name attribute");
equals(testParent.get("nothing"),null,"get should be correct for invalid key");var g=testParent.get("info");
ok(SC.kindOf(g,SC.ChildRecord),"get() creates an actual instance that is a kind of a SC.ChildRecord Object");
ok(SC.instanceOf(g,NestedRecord.ChildRecordTest),"get() creates an actual instance of a ChildRecordTest Object");
var e=g.get("primaryKey");var d=g.get(e);var j=store.find(NestedRecord.ChildRecordTest,d);
ok(j,"checking that the store has the instance of the child record with proper primary key");
equals(g,j,"checking the parent reference is the same as the direct store reference");
same(j.get("attributes"),testParent.readAttribute("info"),"check that the ChildRecord's attributes are the same as the ParentRecord's readAttribute for the reference");
var l=testParent.get("info");ok(l,"check to see if we have an instance of a child record again");
var h=g.get(e),k=l.get(e);equals(h,k,"check to see if the Primary Key are the same");
same(l,g,"check to see that it is the same child record as before");m=l.get("id");
ok((m!==h),"if there is an id param, it should be different from the Primary Key: %@ != %@".fmt(m,h))
});test("Basic Write",function(){testParent.set("name","New Parent Name");equals(testParent.get("name"),"New Parent Name","set() should change name attribute");
testParent.set("nothing","nothing");equals(testParent.get("nothing"),"nothing","set should change non-existent property to a new property");
var g=testParent.get("info");testParent.set("info",{type:"ChildRecordTest",name:"New Child Name",value:"Red Goo"});
var h=testParent.get("info");ok(SC.kindOf(h,SC.ChildRecord),"set() with an object creates an actual instance that is a kind of a SC.ChildRecord Object");
ok(SC.instanceOf(h,NestedRecord.ChildRecordTest),"set() with an object creates an actual instance of a ChildRecordTest Object");
var e=h.get("primaryKey");var d=h.get(e);var k=store.find(NestedRecord.ChildRecordTest,d);
ok(k,"after a set() with an object, checking that the store has the instance of the child record with proper primary key");
equals(h,k,"after a set with an object, checking the parent reference is the same as the direct store reference");
var j=g.get(e);ok(!(j===d),"check to see that the old child record has a different key from the new child record");
h.set("name","Child Name Change");equals(h.get("name"),"Child Name Change","after a set('name', <new>) on child, checking that the value is updated");
ok(h.get("status")&SC.Record.DIRTY,"check that the child record is dirty");ok(testParent.get("status")&SC.Record.DIRTY,"check that the parent record is dirty");
var l=testParent.get("info");same(l,h,"after a set('name', <new>) on child, checking to see that the parent has recieved the changes from the child record");
same(testParent.readAttribute("info"),h.get("attributes"),"after a set('name', <new>) on child, readAttribute on the parent should be correct for info child attributes")
});test("Child Status Changed",function(){var d;d=testParent.get("info");equals(d.get("status"),testParent.get("status"),"after initializing the parent to READY_NEW, check that the child record matches");
SC.RunLoop.begin();store.writeStatus(testParent.storeKey,SC.Record.DIRTY_NEW);store.dataHashDidChange(testParent.storeKey);
equals(d.get("status"),testParent.get("status"),"after setting the parent to DIRTY_NEW, check that the child record matches");
SC.RunLoop.end();SC.RunLoop.begin();store.writeStatus(testParent.storeKey,SC.Record.BUSY_REFRESH);
store.dataHashDidChange(testParent.storeKey);equals(d.get("status"),testParent.get("status"),"after setting the parent to BUSY_REFRESH, check that the child record matches");
SC.RunLoop.end()});var NestedRecord,store,testParent,testParent2;var initModels=function(){NestedRecord.ParentRecordTest=SC.Record.extend({childRecordNamespace:NestedRecord,name:SC.Record.attr(String),elements:SC.Record.toMany("SC.ChildRecord",{nested:true})});
NestedRecord.ChildRecordTest1=SC.ChildRecord.extend({name:SC.Record.attr(String),value:SC.Record.attr(String)});
NestedRecord.ChildRecordTest2=SC.ChildRecord.extend({name:SC.Record.attr(String),info:SC.Record.attr(String),value:SC.Record.attr(String)})
};module("Basic SC.Record w/ a Parent > Array of Children",{setup:function(){NestedRecord=SC.Object.create({store:SC.Store.create()});
store=NestedRecord.store;initModels();SC.RunLoop.begin();testParent=store.createRecord(NestedRecord.ParentRecordTest,{name:"Parent Name",elements:[{type:"ChildRecordTest1",name:"Child 1",value:"eeney"},{type:"ChildRecordTest2",name:"Child 2",info:"This is the other type",value:"meeney"},{type:"ChildRecordTest1",name:"Child 3",value:"miney"},{type:"ChildRecordTest1",name:"Child 4",value:"moe"}]});
testParent2=store.createRecord(NestedRecord.ParentRecordTest,{name:"Parent 2",elements:[]});
SC.RunLoop.end()},teardown:function(){delete NestedRecord.ParentRecordTest;delete NestedRecord.ChildRecordTest;
testParent=null;testParent2=null;store=null;NestedRecord=null}});test("Function: readAttribute()",function(){var d=testParent.readAttribute("elements");
ok(d,"check to see that the child records array exists");equals(d.get("length"),4,"checking to see that the length of the elements array is 4");
same(d[0],{type:"ChildRecordTest1",name:"Child 1",value:"eeney"},"check to see if the first child is as expected");
same(d[3],{type:"ChildRecordTest1",name:"Child 4",value:"moe"},"check to see if the last child is as expected")
});test("Function: writeAttribute()",function(){testParent.writeAttribute("elements",[{type:"ChildRecordTest1",name:"Tom",value:"Jones"},{type:"ChildRecordTest1",name:"Dick",value:"Smothers"},{type:"ChildRecordTest1",name:"Harry",value:"Balls"}]);
var d=testParent.readAttribute("elements");ok(d,"after writeAttribute(), check to see that the child records array exists");
equals(d.length,3,"after writeAttribute(), checking to see that the length of the elements array is 3");
same(d[0],{type:"ChildRecordTest1",name:"Tom",value:"Jones"},"check to see if the first child is as expected");
same(d[2],{type:"ChildRecordTest1",name:"Harry",value:"Balls"},"check to see if the last child is as expected")
});test("Basic Read",function(){equals(testParent.get("name"),"Parent Name","get should be correct for name attribute");
equals(testParent.get("nothing"),null,"get should be correct for invalid key");var d=testParent.get("elements");
ok(SC.instanceOf(d,SC.ChildArray),"check that get() creates an actual instance of a SC.ChildArray");
equals(d.get("length"),4,"check that the length of the array of child records is 4");
var l=d.objectAt(0);ok(SC.kindOf(l,SC.ChildRecord),"check that first ChildRecord from the get() creates an actual instance that is a kind of a SC.ChildRecord Object");
ok(SC.instanceOf(l,NestedRecord.ChildRecordTest1),"check that first ChildRecord from the get() creates an actual instance of a ChildRecordTest1 Object");
var g=l.get("primaryKey");var n=l.get(g);var e=store.find(NestedRecord.ChildRecordTest1,n);
ok(e,"check that first ChildRecord that the store has the instance of the child record with proper primary key");
equals(l,e,"check the parent reference to the first child is the same as the direct store reference");
var h=testParent.readAttribute("elements");ok(!SC.instanceOf(h,SC.ChildArray),"check that get() creates an actual instance of a SC.ChildArray");
same(h[0],e.get("attributes"),"check that the ChildRecord's attributes are the same as the ParentRecord's readAttribute for the reference");
var o=testParent.get("elements");ok(o,"check to see that we get an array on the second call to the parent for the child records");
equals(o.get("length"),4,"check that the length of the array of child records is still 4");
var k=o.objectAt(0);ok(k,"check to see if we have an instance of a child record again");
var j=l.get(g),m=k.get(g);equals(j,m,"check to see if the primary key are the same");
equals(SC.guidFor(l),SC.guidFor(k),"check to see if the guid are the same");same(k,l,"check to see that it is the same child record as before")
});test("Basic Write",function(){testParent.set("name","New Parent Name");equals(testParent.get("name"),"New Parent Name","set() should change name attribute");
testParent.set("nothing","nothing");equals(testParent.get("nothing"),"nothing","set should change non-existent property to a new property");
var e=testParent.get("elements");var h=[{type:"ChildRecordTest1",name:"Tom",value:"Jones"},{type:"ChildRecordTest1",name:"Dick",value:"Smothers"},{type:"ChildRecordTest1",name:"Harry",value:"Balls"}];
testParent.set("elements",h);var d=testParent.get("elements");ok(SC.instanceOf(d,SC.ChildArray),"check that get() creates an actual instance of a SC.ChildArray");
equals(d.get("length"),3,"after set() on parent, check that the length of the array of child records is 3");
var g=d.objectAt(0);ok(SC.kindOf(g,SC.ChildRecord),"check that first ChildRecord from the get() creates an actual instance that is a kind of a SC.ChildRecord Object");
ok(SC.instanceOf(g,NestedRecord.ChildRecordTest1),"check that first ChildRecord from the get() creates an actual instance of a ChildRecordTest1 Object")
});test("Basic Write: reference tests",function(){var h,d,k,g,l,e;d=testParent.get("elements");
k=d.objectAt(0);h=k.get("primaryKey");g=k.get(h);l=store.find(NestedRecord.ChildRecordTest1,g);
ok(l,"after a set() with an object, checking that the store has the instance of the child record with proper primary keys");
equals(k,l,"after a set with an object, checking the parent reference is the same as the direct store reference");
k.set("name","Child Name Change");equals(k.get("name"),"Child Name Change","after a set('name', <new>) on child, checking that the value is updated");
ok(k.get("status")&SC.Record.DIRTY,"check that the child record is dirty");ok(testParent.get("status")&SC.Record.DIRTY,"check that the parent record is dirty");
e=testParent.get("elements");var m=e.objectAt(0);same(m,k,"after a set('name', <new>) on child, checking to see that the parent has recieved the changes from the child record");
var j=testParent.readAttribute("elements");ok(j,"checks to make sure the readAttibute works with a change to the name in the first child.");
equals(j.length,4,"after set() on parent, check that the length of the attribute array of child records is 4");
same(j[0],m.get("attributes"),"after a set('name', <new>) on child, readAttribute on the parent should be correct for info child attributes")
});test("Basic Array Functionality: pushObject",function(){var j,d,e,h,g;j=testParent.get("elements");
j.pushObject({type:"ChildRecordTest1",name:"Testikles",value:"God Of Fertility"});
j=testParent.get("elements");equals(j.get("length"),5,"after pushObject() on parent, check that the length of the array of child records is 5");
e=j.objectAt(4);ok(SC.kindOf(e,SC.ChildRecord),"check that newly added ChildRecord creates an actual instance that is a kind of a SC.ChildRecord Object");
ok(SC.instanceOf(e,NestedRecord.ChildRecordTest1),"check that newly added ChildRecord creates an actual instance of a ChildRecordTest1 Object");
equals(e.get("name"),"Testikles","after a pushObject on parent, check to see if it has all the right values for the attributes");
ok(e.get("status")&SC.Record.DIRTY,"check that the child record is dirty");ok(testParent.get("status")&SC.Record.DIRTY,"check that the parent record is dirty");
d=testParent.readAttribute("elements");equals(d.length,5,"after pushObject() on parent, check that the length of the attribute array of child records is 5");
h=j.objectAt(0).get("attributes");g=j.objectAt(4).get("attributes");same(d[0],h,"verify that parent attributes are the same as the first individual child attributes");
same(d[4],g,"verify that parent attributes are the same as the last individual child attributes")
});test("Basic Array Functionality: popObject",function(){var j,d,e,h,g;j=testParent.get("elements");
j.popObject();j=testParent.get("elements");equals(j.get("length"),3,"after popObject() on parent, check that the length of the array of child records is 3");
ok(testParent.get("status")&SC.Record.DIRTY,"check that the parent record is dirty");
d=testParent.readAttribute("elements");equals(d.length,3,"after pushObject() on parent, check that the length of the attribute array of child records is 3");
h=j.objectAt(0).get("attributes");g=j.objectAt(2).get("attributes");same(d[0],h,"verify that parent attributes are the same as the first individual child attributes");
same(d[2],g,"verify that parent attributes are the same as the last individual child attributes")
});test("Basic Array Functionality: shiftObject",function(){var e,d;e=testParent.get("elements");
e.shiftObject();e=testParent.get("elements");equals(e.get("length"),3,"after shiftObject() on parent, check that the length of the array of child records is 3");
ok(testParent.get("status")&SC.Record.DIRTY,"check that the parent record is dirty")
});test("Basic Array Functionality: unshiftObject",function(){var j,d,e,h,g;j=testParent.get("elements");
j.unshiftObject({type:"ChildRecordTest1",name:"Testikles",value:"God Of Fertility"});
j=testParent.get("elements");equals(j.get("length"),5,"after pushObject() on parent, check that the length of the array of child records is 5");
e=j.objectAt(0);ok(SC.kindOf(e,SC.ChildRecord),"check that newly added ChildRecord creates an actual instance that is a kind of a SC.ChildRecord Object");
ok(SC.instanceOf(e,NestedRecord.ChildRecordTest1),"check that newly added ChildRecord creates an actual instance of a ChildRecordTest1 Object");
equals(e.get("name"),"Testikles","after a pushObject on parent, check to see if it has all the right values for the attributes");
ok(e.get("status")&SC.Record.DIRTY,"check that the child record is dirty");ok(testParent.get("status")&SC.Record.DIRTY,"check that the parent record is dirty");
d=testParent.readAttribute("elements");equals(d.length,5,"after pushObject() on parent, check that the length of the attribute array of child records is 5");
h=j.objectAt(0).get("attributes");g=j.objectAt(4).get("attributes");same(d[0],h,"verify that parent attributes are the same as the first individual child attributes");
same(d[4],g,"verify that parent attributes are the same as the last individual child attributes")
});test("Create Parent with Broken Child Array",function(){var e=testParent2.get("elements");
ok(!SC.none(e),"elements should be something");var g=e.instanceOf(SC.ChildArray);
ok(g,"elements array is of right type");var d=e.get("length");equals(d,0,"length should be zero");
e.pushObject({type:"ChildRecordTest1",name:"Child 1",value:"eeney"});d=e.get("length");
equals(d,1,"length should be one")});var NestedRecord,store,testParent,peopleData1,peopleData2,personData1,addressData1;
var initModels=function(){NestedRecord.Group=SC.Record.extend({childRecordNamespace:NestedRecord,name:SC.Record.attr(String),people:SC.Record.toMany("NestedRecord.Person",{nested:true})});
NestedRecord.Person=SC.ChildRecord.extend({childRecordNamespace:NestedRecord,name:SC.Record.attr(String),addresses:SC.Record.toMany("NestedRecord.Address",{nested:true})});
NestedRecord.Address=SC.ChildRecord.extend({street:SC.Record.attr(String),city:SC.Record.attr(String),state:SC.Record.attr(String,{defaultValue:"VA"})})
};module("Complex SC.ChildRecord: Parent > Array of Children > Array of Children",{setup:function(){NestedRecord=SC.Object.create({store:SC.Store.create()});
store=NestedRecord.store;initModels();SC.RunLoop.begin();testParent=store.createRecord(NestedRecord.Group,{name:"Test Group",people:[{type:"Person",name:"Barack Obama",addresses:[{type:"Address",street:"123 Some Street",city:"Chicago",state:"IL"},{type:"Address",street:"222 Socialist Way ",city:"Washington",state:"DC"}]},{type:"Person",name:"John Doe",addresses:[{type:"Address",street:"1111 Cross Street",city:"Anywhere",state:"CA"},{type:"Address",street:"555 18th Street ",city:"Boulder",state:"CO"},{type:"Address",street:"444 Goofy Street ",city:"Redneck",state:"AR"}]},{type:"Person",name:"Jane Doe",addresses:[{type:"Address",street:"987 Crispy Kreme Lane",city:"Lard",state:"TX"}]}]});
SC.RunLoop.end();peopleData2=[{type:"Person",name:"Tom Jones",addresses:[{type:"Address",street:"1 Freezing Circle",city:"Nome",state:"AK"},{type:"Address",street:"444 Not Unusual Love Place",city:"Las Vegas",state:"NV"},{type:"Address",street:"66 On The Road",city:"Touring",state:"Anywhere"}]},{type:"Person",name:"Dick Smothers",addresses:[{type:"Address",street:"1 Mom Likes Best Place",city:"Tujunga",state:"CA"}]}];
personData1={type:"Person",name:"Testikles, God Of Fertility",addresses:[{type:"Address",street:"45 Gods and Goddess Place",city:"Mount",state:"Olympus"},{type:"Address",street:"1 Special Circle",city:"Your Mom",state:"Your State"}]};
addressData1=[{type:"Address",street:"1 Main Street",city:"Greenbow",state:"AL"},{type:"Address",street:"666 Wall Street",city:"New York",state:"NY"},{type:"Address",street:"4 Dirt Road",city:"Pleasent",state:"CO"},{type:"Address",street:"1 Yellow Brick Road",city:"Dorothy",state:"KA"}]
},teardown:function(){delete NestedRecord.Group;delete NestedRecord.Person;delete NestedRecord.Address;
NestedRecord=null;testParent=null;peopleData1=null;peopleData2=null;personData1=null;
addressData1=null;store=null}});test("Function: readAttribute()",function(){var d;
d=testParent.readAttribute("people");ok(d,"check to see that the child records array exists");
equals(d.length,3,"checking to see that the length of the elements array is 3");equals(d[0].name,"Barack Obama","first person, check to see name is Barack Obama");
equals(d[0].addresses.length,2,"first person, check to see length of the addresses is 2");
same(d[0].addresses[0],{type:"Address",street:"123 Some Street",city:"Chicago",state:"IL"},"check to see if the first person's first address is as expected");
same(d[0].addresses[1],{type:"Address",street:"222 Socialist Way ",city:"Washington",state:"DC"},"check to see if the first person's last address is as expected");
equals(d[2].name,"Jane Doe","last person, check to see name is Jane Doe");equals(d[2].addresses.length,1,"last person, check to see length of the addresses is 2");
same(d[2].addresses[0],{type:"Address",street:"987 Crispy Kreme Lane",city:"Lard",state:"TX"},"check to see if the last person's first address is as expected")
});test("Function: writeAttribute()",function(){var d;testParent.writeAttribute("people",peopleData2);
d=testParent.readAttribute("people");ok(d,"after writeAttribute(), check to see that the child records array exists");
equals(d.length,2,"after writeAttribute(), checking to see that the length of the elements array is 2");
equals(d[0].name,"Tom Jones","first person, check to see name is Tom Jones");equals(d[0].addresses.length,3,"first person, check to see length of the addresses is 3");
same(d[0].addresses[0],{type:"Address",street:"1 Freezing Circle",city:"Nome",state:"AK"},"check to see if the first person's first address is as expected");
same(d[0].addresses[2],{type:"Address",street:"66 On The Road",city:"Touring",state:"Anywhere"},"check to see if the first person's last address is as expected");
equals(d[1].name,"Dick Smothers","last person, check to see name is Dick Smothers");
equals(d[1].addresses.length,1,"last person, check to see length of the addresses is 2");
same(d[1].addresses[0],{type:"Address",street:"1 Mom Likes Best Place",city:"Tujunga",state:"CA"},"check to see if the last person's first address is as expected")
});test("Basic Read, Testing the First Child Array",function(){var e,k,h,j,d,n,m,l,g;
equals(testParent.get("name"),"Test Group","get should be correct for name attribute: Test Group");
equals(testParent.get("nothing"),null,"get should be correct for invalid key");k=testParent.get("people");
ok(SC.instanceOf(k,SC.ChildArray),"check that get() creates an actual instance of a SC.ChildArray");
equals(k.get("length"),3,"check that the length of the array of child records is 3");
d=k.objectAt(0);ok(SC.kindOf(d,SC.ChildRecord),"check that first ChildRecord from the get() creates an actual instance that is a kind of a SC.ChildRecord Object");
ok(SC.instanceOf(d,NestedRecord.Person),"check that first ChildRecord from the get() creates an actual instance of a Person Object");
e=d.get("primaryKey");l=d.get(e);m=store.find(NestedRecord.Person,l);ok(m,"check that first ChildRecord that the store has the instance of the child record with proper primary key");
equals(d,m,"check the parent reference to the first child is the same as the direct store reference");
h=testParent.readAttribute("people");ok(!SC.instanceOf(h,SC.ChildArray),"check that readAttribute() does not create an actual instance of a SC.ChildArray");
same(h[0],m.get("attributes"),"check that the ChildRecord's attributes are the same as the ParentRecord's readAttribute for the reference");
j=testParent.get("people");ok(j,"check to see that we get an array on the second call to the parent for the child records");
equals(j.get("length"),3,"check that the length of the array of child records is still 3");
n=j.objectAt(0);ok(n,"check to see if we have an instance of a child record again");
g=d.get(e);l=n.get(e);equals(l,g,"check to see if the primary keys are the same");
equals(SC.guidFor(n),SC.guidFor(d),"check to see if the guid are the same");same(n,d,"check to see that it is the same child record as before")
});test("Basic Read, Testing the Second Child Array",function(){var y,x;var g,m,l,d,k,o,e,n,u,h,s,j;
m=testParent.get("people");d=m.objectAt(0);k=d.get("addresses");ok(SC.instanceOf(k,SC.ChildArray),"check that get() creates an actual instance of a SC.ChildArray");
equals(k.get("length"),2,"check that the length of the array of child records is 2");
n=k.objectAt(0);ok(SC.kindOf(n,SC.ChildRecord),"check that first ChildRecord from the get() creates an actual instance that is a kind of a SC.ChildRecord Object");
ok(SC.instanceOf(n,NestedRecord.Address),"check that first ChildRecord from the get() creates an actual instance of a Address Object");
g=n.get("primaryKey");s=n.get(g);h=store.find(NestedRecord.Address,s);ok(h,"check that first ChildRecord that the store has the instance of the child record with proper primary key");
equals(n,h,"check the parent reference to the first child is the same as the direct store reference");
e=d.readAttribute("addresses");ok(!SC.instanceOf(e,SC.ChildArray),"check that readAttribute() does not create an actual instance of a SC.ChildArray");
same(e[0],h.get("attributes"),"check that the ChildRecord's attributes are the same as the ParentRecord's readAttribute for the reference");
l=testParent.readAttribute("people");ok(!SC.instanceOf(l[0].addresses,SC.ChildArray),"check from the Group (parent Record) that readAttribute() does not create an actual instance of a SC.ChildArray");
same(l[0].addresses[0],h.get("attributes"),"check from the Group (parent Record) that the ChildRecord's attributes are the same as the ParentRecord's readAttribute for the reference");
o=d.get("addresses");ok(o,"check to see that we get an array on the second call to the parent for the child records");
equals(o.get("length"),2,"check that the length of the array of child records is still 2");
u=o.objectAt(0);ok(u,"check to see if we have an instance of a child record again");
j=n.get(g);s=u.get(g);equals(s,j,"check to see if the primary key are the same");
equals(SC.guidFor(u),SC.guidFor(n),"check to see if the guid are the same");same(u,n,"check to see that it is the same child record as before")
});test("Basic Write: Testing the First Child Array",function(){var g,k,e,l,h,o,n,j,d,m;
testParent.set("name","New Group");equals(testParent.get("name"),"New Group","set() should change name attribute");
testParent.set("nothing","nothing");equals(testParent.get("nothing"),"nothing","set should change non-existent property to a new property");
testParent.set("people",peopleData2);k=testParent.get("people");ok(SC.instanceOf(k,SC.ChildArray),"check that get() creates an actual instance of a SC.ChildArray");
equals(k.get("length"),2,"after set() on parent, check that the length of the array of child records is 2");
e=k.objectAt(0);ok(SC.kindOf(e,SC.ChildRecord),"check that first ChildRecord from the get() creates an actual instance that is a kind of a SC.ChildRecord Object");
ok(SC.instanceOf(e,NestedRecord.Person),"check that first ChildRecord from the get() creates an actual instance of a Person Object");
g=e.get("primaryKey");n=e.get(g);o=store.find(NestedRecord.Person,n);ok(o,"after a set() with an object, checking that the store has the instance of the child record with proper primary key");
equals(o,e,"after a set with an object, checking the parent reference is the same as the direct store reference");
e.set("addresses",addressData1);l=e.get("addresses");ok(SC.kindOf(l,SC.ChildArray),"check to see that the set('addresses') has returned a SC.ChildArray");
equals(l.get("length"),4,"check with a get() that the new address length is 4");h=e.readAttribute("addresses");
equals(h.length,4,"check with a readAttribute() that the new address length is 4");
d=l.objectAt(0);m=l.objectAt(3);same(h[0],d.get("attributes"),"check from the Person (parent Record) that the first Address's attributes are the same as the Person's readAttribute for the reference");
same(h[3],m.get("attributes"),"check from the Person (parent Record) that the last Address's attributes are the same as the Person's readAttribute for the reference");
ok(e.get("status")&SC.Record.DIRTY,"check that the person (child record) is dirty");
ok(testParent.get("status")&SC.Record.DIRTY,"check that the group (parent record) is dirty")
});test("Basic Write: Testing the Second Child Array",function(){var k,e,j,h,g,d;
k=testParent.get("people");j=k.objectAt(0);g=j.get("addresses");d=g.objectAt("0");
d.set("street","123 New Street");ok(d.get("status")&SC.Record.DIRTY,"check that the address (child record) is dirty");
ok(j.get("status")&SC.Record.DIRTY,"check that the person (child record) is dirty");
ok(testParent.get("status")&SC.Record.DIRTY,"check that the group (parent record) is dirty");
h=j.readAttribute("addresses");equals(h.length,2,"check the length of the address attribute is still 2");
equals(h[0],d.get("attributes"),"check to see if the person's address attribute is the same as the address's attributes");
e=testParent.readAttribute("people");equals(e[0].addresses[0],d.get("attributes"),"check to see if the groups reference's address attribute is the same as the address's attributes")
});test("Basic Array Functionality: pushObject",function(){var j,g,h,e,d;j=testParent.get("people");
j.pushObject(personData1);j=testParent.get("people");equals(j.get("length"),4,"after pushObject() on parent, check that the length of the array of child records is 4");
h=j.objectAt(3);ok(SC.kindOf(h,SC.ChildRecord),"check that newly added ChildRecord creates an actual instance that is a kind of a SC.ChildRecord Object");
ok(SC.instanceOf(h,NestedRecord.Person),"check that newly added ChildRecord creates an actual instance of a Person Object");
equals(h.get("name"),"Testikles, God Of Fertility","after a pushObject on parent, check to see if it has all the right values for the attributes");
ok(h.get("status")&SC.Record.DIRTY,"check that the child record is dirty");ok(testParent.get("status")&SC.Record.DIRTY,"check that the parent record is dirty");
g=testParent.readAttribute("people");equals(g.length,4,"after pushObject() on parent, check that the length of the attribute array of child records is 4");
e=j.objectAt(0);d=j.objectAt(3);same(g[0],e.get("attributes"),"verify that parent attributes are the same as the first individual child attributes");
same(g[3],d.get("attributes"),"verify that parent attributes are the same as the last individual child attributes")
});test("Basic Array Functionality: popObject",function(){var j,g,h,e,d;j=testParent.get("people");
j.popObject();j=testParent.get("people");equals(j.get("length"),2,"after popObject() on parent, check that the length of the array of child records is 2");
h=j.objectAt(0);ok(SC.kindOf(h,SC.ChildRecord),"check that newly added ChildRecord creates an actual instance that is a kind of a SC.ChildRecord Object");
ok(SC.instanceOf(h,NestedRecord.Person),"check that newly added ChildRecord creates an actual instance of a Person Object");
equals(h.get("name"),"Barack Obama","after a pushObject on parent, check to see if it has all the right values for the attributes");
ok(h.get("status")&SC.Record.DIRTY,"check that the child record is dirty");ok(testParent.get("status")&SC.Record.DIRTY,"check that the parent record is dirty");
g=testParent.readAttribute("people");equals(g.length,2,"after pushObject() on parent, check that the length of the attribute array of child records is 2");
e=j.objectAt(0);d=j.objectAt(1);same(g[0],e.get("attributes"),"verify that parent attributes are the same as the first individual child attributes");
same(g[1],d.get("attributes"),"verify that parent attributes are the same as the last individual child attributes")
});test("Basic Array Functionality: shiftObject",function(){var e,d;e=testParent.get("people");
e.shiftObject();e=testParent.get("people");equals(e.get("length"),2,"after shiftObject() on parent, check that the length of the array of child records is 2");
d=e.objectAt("0");equals(d.get("name"),"John Doe","after a shiftObject on parent, check to see if it has all the right values for the attributes");
ok(testParent.get("status")&SC.Record.DIRTY,"check that the parent record is dirty")
});test("Basic Array Functionality: unshiftObject",function(){var j,g,h,e,d;j=testParent.get("people");
j.unshiftObject(personData1);j=testParent.get("people");equals(j.get("length"),4,"after unshiftObject() on parent, check that the length of the array of child records is 4");
h=j.objectAt(0);ok(SC.kindOf(h,SC.ChildRecord),"check that newly added ChildRecord creates an actual instance that is a kind of a SC.ChildRecord Object");
ok(SC.instanceOf(h,NestedRecord.Person),"check that newly added ChildRecord creates an actual instance of a Person Object");
equals(h.get("name"),"Testikles, God Of Fertility","after a pushObject on parent, check to see if it has all the right values for the attributes");
ok(h.get("status")&SC.Record.DIRTY,"check that the child record is dirty");ok(testParent.get("status")&SC.Record.DIRTY,"check that the parent record is dirty");
g=testParent.readAttribute("people");equals(g.length,4,"after unshiftObject() on parent, check that the length of the attribute array of child records is 4");
e=j.objectAt(0);d=j.objectAt(3);same(g[0],e.get("attributes"),"verify that parent attributes are the same as the first individual child attributes");
same(g[3],d.get("attributes"),"verify that parent attributes are the same as the last individual child attributes")
});test("Test: normalization on complex nested records",function(){var d,g,e;d=testParent.get("people");
g=d.objectAt(0).get("addresses");g.pushObject({type:"Address",street:"2 Main Street",city:"Awesome"});
testParent.normalize();e=testParent.get("attributes");equals(e.people[0].addresses[2].state,"VA","test normalization is the default value of VA")
});var NestedRecord,store,testParent;var initModels=function(){NestedRecord.Address=SC.ChildRecord.extend({street:SC.Record.attr(String),city:SC.Record.attr(String),state:SC.Record.attr(String,{defaultValue:"VA"})});
NestedRecord.Person=SC.ChildRecord.extend({childRecordNamespace:NestedRecord,name:SC.Record.attr(String),address:SC.Record.toOne("NestedRecord.Address",{nested:true})});
NestedRecord.ParentRecordTest=SC.Record.extend({childRecordNamespace:NestedRecord,name:SC.Record.attr(String),person:SC.Record.toOne("NestedRecord.Person",{nested:true})})
};module("Basic SC.Record Functions w/ a Parent > Child > Child",{setup:function(){NestedRecord=SC.Object.create({store:SC.Store.create()});
store=NestedRecord.store;initModels();SC.RunLoop.begin();testParent=store.createRecord(NestedRecord.ParentRecordTest,{name:"Parent Name",person:{type:"Person",name:"Albert",address:{type:"Address",street:"123 Sesame St",city:"New York",state:"NY"}}});
SC.RunLoop.end()},teardown:function(){delete NestedRecord.ParentRecordTest;delete NestedRecord.Person;
delete NestedRecord.Address;NestedRecord=null;testParent=null;store=null}});test("Function: readAttribute() in the Parent Record",function(){equals(testParent.readAttribute("name"),"Parent Name","readAttribute should be correct for name attribute");
equals(testParent.readAttribute("nothing"),null,"readAttribute should be correct for invalid key");
same(testParent.readAttribute("person"),{type:"Person",name:"Albert",address:{type:"Address",street:"123 Sesame St",city:"New York",state:"NY"}},"readAttribute should be correct for 'person' child attribute")
});test("Function: readAttribute() in the Parent > Child",function(){var d=testParent.get("person");
ok(d,"check to see if the first child in the chain exists");equals(d.readAttribute("name"),"Albert","child readAttribute should be correct for name attribute");
equals(d.readAttribute("nothing"),null,"child readAttribute should be correct for invalid key");
same(d.readAttribute("address"),{type:"Address",street:"123 Sesame St",city:"New York",state:"NY"},"readAttribute should be correct for address on the child")
});test("Function: readAttribute() in the Parent > Child > Child",function(){var d=testParent.getPath("person.address");
ok(d,"check to see if the child of the child in the chain exists with a getPath()");
equals(d.readAttribute("street"),"123 Sesame St","child readAttribute should be correct for street attribute w/ getPath()");
equals(d.readAttribute("nothing"),null,"child readAttribute should be correct for invalid key w/ getPath()");
var e=testParent.get("person");var g=e.get("address");ok(g,"check to see if the child of the child in the chain exists with a get");
equals(g.readAttribute("street"),"123 Sesame St","child readAttribute should be correct for street attribute w/ get()");
equals(g.readAttribute("nothing"),null,"child readAttribute should be correct for invalid key w/ get()")
});test("Function: writeAttribute() in the Parent Record",function(){testParent.writeAttribute("name","New Parent Name");
equals(testParent.get("name"),"New Parent Name","writeAttribute should be the new name attribute");
testParent.writeAttribute("nothing","nothing");equals(testParent.get("nothing"),"nothing","writeAttribute should be correct for new key");
testParent.writeAttribute("person",{type:"Person",name:"Al Gore",address:{type:"Address",street:"123 Crazy St",city:"Khacki Pants",state:"Insanity"}});
same(testParent.readAttribute("person"),{type:"Person",name:"Al Gore",address:{type:"Address",street:"123 Crazy St",city:"Khacki Pants",state:"Insanity"}},"writeAttribute with readAttribute should be correct for person child attribute")
});test("Function: writeAttribute() in the Parent > Child",function(){var d=testParent.get("person");
d.writeAttribute("name","Luke Skywalker");equals(d.readAttribute("name"),"Luke Skywalker","writeAttribute should be the new name attribute on the child");
var g=testParent.readAttribute("person");equals(g.name,"Luke Skywalker","check to see if a writeAttribute single change on the child will reflect on the parent");
var e={type:"Address",street:"1 Way Street",city:"Springfield",state:"IL"};d.writeAttribute("address",e);
same(d.readAttribute("address"),{type:"Address",street:"1 Way Street",city:"Springfield",state:"IL"},"writeAttribute should be the new address attribute on the child");
g=testParent.readAttribute("person");same(g.address,{type:"Address",street:"1 Way Street",city:"Springfield",state:"IL"},"check to see if a writeAttribute address change on the child will reflect on the parent")
});test("Function: writeAttribute() in the Parent > Child > Child",function(){var d=testParent.getPath("person.address");
d.writeAttribute("street","1 Death Star Lane");equals(d.readAttribute("street"),"1 Death Star Lane","writeAttribute should be the new name attribute on the child.street");
var g=testParent.readAttribute("person");equals(g.address.street,"1 Death Star Lane","check to see if a writeAttribute change on the child will reflect on the child > child.address.street");
var e=testParent.get("attributes");equals(e.person.address.street,"1 Death Star Lane","check to see if a writeAttribute change on the child will reflect on the child > child > parent.attributes.person.address.street")
});test("Basic Read",function(){equals(testParent.get("name"),"Parent Name","Parent.get() should be correct for name attribute");
equals(testParent.get("nothing"),null,"Parent.get() should be correct for invalid key");
var k=testParent.get("person");ok(SC.kindOf(k,SC.ChildRecord),"(parent > child).get() creates an actual instance that is a kind of a SC.ChildRecord Object");
ok(SC.instanceOf(k,NestedRecord.Person),"(parent > child).get() creates an actual instance of a Person Object");
var e=k.get("primaryKey");var g=k.get(e);var j=store.find(NestedRecord.Person,g);
ok(j,"checking that the store has the instance of the child record with proper primary key");
equals(k,j,"checking the parent reference is the same as the direct store reference");
same(j.get("attributes"),testParent.readAttribute("person"),"check that the ChildRecord's attributes are the same as the parent.person's readAttribute for the reference");
var d=testParent.getPath("person.address");ok(SC.kindOf(d,SC.ChildRecord),"(parent > child > child) w/ getPath() creates an actual instance that is a kind of a SC.ChildRecord Object");
ok(SC.instanceOf(d,NestedRecord.Address),"(parent > child > child) w/ getPath() creates an actual instance of an Address Object");
var h=d.get(e);j=store.find(NestedRecord.Address,h);ok(j,"checking that the store has the instance of the (parent > child > child) record with proper primary key");
equals(d,j,"checking the (parent > child > child) reference is the same as the direct store reference");
same(j.get("attributes"),k.readAttribute("address"),"check that the ChildRecord's attributes are the same as the (parent > child.address)'s readAttribute for the reference")
});test("Basic Write",function(){var g,m,j,l,k;var h,d,e;testParent.set("name","New Parent Name");
equals(testParent.get("name"),"New Parent Name","set() should change name attribute");
testParent.set("nothing","nothing");equals(testParent.get("nothing"),"nothing","set should change non-existent property to a new property");
g=testParent.get("person");testParent.set("person",{type:"Person",name:"Al Gore",address:{type:"Address",street:"123 Crazy St",city:"Khacki Pants",state:"Insanity"}});
m=testParent.get("person");ok(SC.kindOf(m,SC.ChildRecord),"set() with an object creates an actual instance that is a kind of a SC.ChildRecord Object");
ok(SC.instanceOf(m,NestedRecord.Person),"set() with an object creates an actual instance of a ChildRecordTest Object");
h=m.get("primaryKey");j=m.get(h);k=store.find(NestedRecord.Person,j);ok(k,"after a set() with an object, checking that the store has the instance of the child record with proper primary key");
equals(m,k,"after a set with an object, checking the parent reference is the same as the direct store reference");
l=g.get(h);ok(!(l===j),"check to see that the old child record has a different key from the new child record");
m.set("name","Child Name Change");equals(m.get("name"),"Child Name Change","after a set('name', <new>) on child, checking that the value is updated");
ok(m.get("status")&SC.Record.DIRTY,"check that the child record is dirty");ok(testParent.get("status")&SC.Record.DIRTY,"check that the parent record is dirty");
g=m;m=testParent.get("person");same(m,g,"after a set('name', <new>) on child, checking to see that the parent has recieved the changes from the child record");
same(testParent.readAttribute("person"),m.get("attributes"),"after a set('name', <new>) on child, readAttribute on the parent should be correct for info child attributes");
d=testParent.getPath("person.address");d.set("street","321 Nutty Professor Lane");
e=testParent.readAttribute("person");same(d.get("attributes"),e.address,"after a set('street', <new>) on address child, checking to see that the parent has recieved the changes from the child record")
});test("Basic normalize()",function(){var d;testParent.set("person",{type:"Person",name:"Al Gore",address:{type:"Address",street:"123 Crazy St",city:"Khacki Pants"}});
testParent.normalize();d=testParent.get("attributes");equals(d.person.address.state,"VA","test normalization is the default value of VA")
});var NestedRecord,store,storeKeys;var initModels=function(){NestedRecord.Directory=SC.ChildRecord.extend({childRecordNamespace:NestedRecord,primaryKey:"id",id:SC.Record.attr(Number),name:SC.Record.attr(String),contents:SC.Record.toMany("SC.Record",{nested:true})});
NestedRecord.File=SC.ChildRecord.extend({primaryKey:"id",id:SC.Record.attr(Number),name:SC.Record.attr(String)})
};module("Parentless SC.ChildRecord",{setup:function(){NestedRecord=SC.Object.create({store:SC.Store.create()});
store=NestedRecord.store;initModels();SC.RunLoop.begin();storeKeys=store.loadRecords([NestedRecord.Directory,NestedRecord.File],[{type:"Directory",name:"Dir 1",id:1,contents:[{type:"Directory",name:"Dir 2",id:2,contents:[{type:"File",id:3,name:"File 1"},{type:"File",id:4,name:"File 2"}]}]},{type:"File",id:5,name:"File 3"}]);
SC.RunLoop.end()},teardown:function(){delete NestedRecord.Directory;delete NestedRecord.File;
NestedRecord=null;store=null}});test("Proper Initialization",function(){var e,d;equals(storeKeys.get("length"),2,"number of primary store keys should be 2");
e=store.materializeRecord(storeKeys[0]);ok(SC.kindOf(e,SC.ChildRecord),"first record is a kind of a SC.ChildRecord Object");
ok(SC.instanceOf(e,NestedRecord.Directory),"first record is a instance of a NestedRecord.Directory Object");
d=store.materializeRecord(storeKeys[1]);ok(SC.kindOf(d,SC.ChildRecord),"second record is a kind of a SC.ChildRecord Object");
ok(SC.instanceOf(d,NestedRecord.File),"second record is a instance of a NestedRecord.File Object")
});test("Proper Status",function(){var e,d;e=store.materializeRecord(storeKeys[0]);
equals(e.get("status"),SC.Record.READY_CLEAN,"first record has a READY_CLEAN State");
d=store.materializeRecord(storeKeys[1]);equals(d.get("status"),SC.Record.READY_CLEAN,"second record has a READY_CLEAN State")
});test("Can Push onto child array",function(){var e,d;e=store.materializeRecord(storeKeys[0]);
e=e.get("contents").objectAt(0);d=e.get("contents");equals(d.get("length"),2,"should have two items");
d.forEach(function(g){ok(SC.instanceOf(g,NestedRecord.File),"should be a NestedRecord.File");
ok(g.get("name"),"should have a name property")});d.pushObject({type:"File",name:"File 4",id:12});
equals(d.get("length"),3,"should have three items");d.forEach(function(g){ok(SC.instanceOf(g,NestedRecord.File),"should be a NestedRecord.File");
ok(g.get("name"),"should have a name property");equals(g.get("status"),SC.Record.READY_DIRTY,"second record has a READY_CLEAN State")
})});var MyApp,dataSource;module("SC.Record core methods",{setup:function(){dataSource=SC.DataSource.create({gotParams:NO,wasCommitted:NO,createRecord:function(d,e,g){this.wasCommitted=YES;
this.gotParams=g&&g.param1?YES:NO}});MyApp=SC.Object.create({store:SC.Store.create().from(dataSource)});
MyApp.Foo=SC.Record.extend({});MyApp.json={foo:"bar",number:123,bool:YES,array:[1,2,3],guid:1};
SC.RunLoop.begin();MyApp.foo=MyApp.store.createRecord(MyApp.Foo,MyApp.json);SC.RunLoop.end()
}});test("statusString",function(){equals(MyApp.foo.statusString(),"READY_NEW","status string should be READY_NEW")
});test("Can commitRecord() specific SC.Record instance",function(){MyApp.foo.set("foo","foobar");
MyApp.foo.commitRecord({param1:"value1"});equals(dataSource.wasCommitted,YES,"Record was committed");
equals(dataSource.gotParams,YES,"Params were properly passed through commitRecord")
});var MyFoo=null,callInfo;module("SC.Record#destroy",{setup:function(){SC.RunLoop.begin();
MyApp=SC.Object.create({store:SC.Store.create()});MyApp.Foo=SC.Record.extend();MyApp.json={foo:"bar",number:123,bool:YES,array:[1,2,3]};
MyApp.foo=MyApp.store.createRecord(MyApp.Foo,MyApp.json);callInfo=null;MyApp.store.__orig=MyApp.store.destroyRecord;
MyApp.store.destroyRecord=function(d){callInfo=SC.A(arguments);MyApp.store.__orig.apply(MyApp.store,arguments)
};SC.RunLoop.end()}});test("calling destroy on a newRecord will mark the record as destroyed and calls destroyRecords on the store",function(){equals(MyApp.foo.get("status"),SC.Record.READY_NEW,"precond - status is READY_NEW");
SC.RunLoop.begin();MyApp.foo.destroy();SC.RunLoop.end();same(callInfo,[null,null,MyApp.foo.storeKey],"destroyRecords() should not be called");
equals(MyApp.foo.get("status"),SC.Record.DESTROYED_CLEAN,"status should be SC.Record.DESTROYED_CLEAN")
});test("calling destroy on existing record should call destroyRecord() on store",function(){MyApp.store.writeStatus(MyApp.foo.storeKey,SC.Record.READY_CLEAN).dataHashDidChange(MyApp.foo.storeKey,null,YES);
equals(MyApp.foo.get("status"),SC.Record.READY_CLEAN,"precond - status is READY CLEAN");
SC.RunLoop.begin();MyApp.foo.destroy();SC.RunLoop.end();same(callInfo,[null,null,MyApp.foo.storeKey],"destroyRecord() should not be called");
equals(MyApp.foo.get("status"),SC.Record.DESTROYED_DIRTY,"status should be SC.Record.DESTROYED_DIRTY")
});test("calling destroy on a record that is already destroyed should do nothing",function(){SC.RunLoop.begin();
MyApp.foo.destroy();SC.RunLoop.end();equals(MyApp.foo.get("status"),SC.Record.DESTROYED_CLEAN,"status should be DESTROYED_CLEAN");
SC.RunLoop.begin();MyApp.foo.destroy();SC.RunLoop.end();equals(MyApp.foo.get("status"),SC.Record.DESTROYED_CLEAN,"status should be DESTROYED_CLEAN")
});test("should return receiver",function(){equals(MyApp.foo.destroy(),MyApp.foo,"should return receiver")
});test("destroy should update status cache",function(){var d=MyApp.foo.get("status");
ok(d!==SC.Record.DESTROYED_CLEAN,"precond - foo should not be destroyed");SC.RunLoop.begin();
MyApp.foo.destroy();equals(MyApp.foo.get("status"),SC.Record.DESTROYED_CLEAN,"status should be DESTROYED_CLEAN immediately when destroyed directly by record");
SC.RunLoop.end()});var store,Application;module("SC.Record Error Methods",{setup:function(){Application={};
Application.Thing=SC.Record.extend({name:SC.Record.attr(String)});SC.RunLoop.begin();
store=SC.Store.create();var d=[{guid:1,name:"Thing One"},{guid:2,name:"Thing Two"}];
var e=[Application.Thing,Application.Thing];store.loadRecords(e,d);SC.RunLoop.end()
},teardown:function(){store=null;Application=null}});test("Verify error methods behave correctly",function(){var g=store.find(Application.Thing,1);
var d=g.get("storeKey");var e=store.find(Application.Thing,2);SC.RunLoop.begin();
store.writeStatus(d,SC.Record.BUSY_LOADING);store.dataSourceDidError(d,SC.Record.GENERIC_ERROR);
SC.RunLoop.end();ok(g.get("isError"),"isError on thing1 should be YES");ok(!e.get("isError"),"isError on thing2 should be NO");
equals(g.get("errorObject"),SC.Record.GENERIC_ERROR,"get('errorObject') on thing1 should return the correct error object");
equals(e.get("errorObject"),null,"get('errorObject') on thing2 should return null")
});var storeKeys,rec,rec2,rec3,rec4;module("SC.Record normalize method",{setup:function(){SC.RunLoop.begin();
MyApp=SC.Object.create({store:SC.Store.create()});MyApp.Foo=SC.Record.extend({guid:SC.Record.attr(String,{defaultValue:function(){var g,d,j="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",h=8,e="";
for(g=0;g<h;g++){d=Math.floor(Math.random()*j.length);e+=j.substring(d,d+1)}return e
}}),firstName:SC.Record.attr(String),anArray:SC.Record.attr(Array),defaultValue:SC.Record.attr(String,{defaultValue:"default"}),relatedTo:SC.Record.toOne("MyApp.Foo",{defaultValue:"1"}),relatedToComputed:SC.Record.toOne("MyApp.Foo",{defaultValue:function(){var d=Math.floor(Math.random()*2+1);
return"foo"+d}}),relatedToMany:SC.Record.toMany("MyApp.Foo")});MyApp.Bar=SC.Record.extend({relatedTo:SC.Record.toOne("MyApp.Bar",{defaultValue:"1"})});
storeKeys=MyApp.store.loadRecords(MyApp.Foo,[{guid:"foo1",firstName:123,anArray:["one","two","three"]},{guid:"foo2",firstName:"Jane",relatedTo:"foo1"},{guid:"foo3"}]);
rec=MyApp.store.find(MyApp.Foo,"foo1");rec2=MyApp.store.find(MyApp.Foo,"foo2");rec3=MyApp.store.find(MyApp.Foo,"foo3");
equals(rec.storeKey,storeKeys[0],"should find record")},teardown:function(){SC.RunLoop.end()
}});test("normalizing a pre-populated record",function(){equals(rec.attributes()["firstName"],123,"hash value of firstName is 123");
equals(rec.get("firstName"),"123","get value of firstName is 123 string");rec.normalize();
var e=rec.attributes()["firstName"]==="123";var h=rec.attributes()["relatedTo"]==="1";
var g=rec.attributes()["relatedToComputed"];var d=["foo1","foo2","foo3"];ok(e,"hash value of firstName after normalizing is 123 string");
ok(e,"hash value of relatedTo should be 1");ok(d.indexOf(g)!==-1,"hash value of relatedToComputed should be either foo1, foo2 or foo3");
equals(rec.get("firstName"),"123","get value of firstName after normalizing is 123 string")
});test("normalizing an empty record",function(){equals(rec3.attributes()["defaultValue"],undefined,"hash value of defaultValue is undefined");
equals(rec3.get("defaultValue"),"default","get value of defaultValue is default");
rec3.normalize();equals(rec3.attributes()["defaultValue"],"default","hash value of defaultValue after normalizing is default");
equals(rec3.get("defaultValue"),"default","get value of defaultValue after normalizing is default")
});test("normalizing with includeNull flag",function(){equals(rec3.attributes()["firstName"],undefined,"hash value of firstName is undefined");
equals(rec3.get("firstName"),null,"get value of firstName is null");rec3.normalize(YES);
equals(rec3.attributes()["firstName"],null,"hash value of firstName after normalizing is null");
equals(rec3.get("firstName"),null,"get value of firstName after normalizing is null")
});test("normalizing a new record with toOne should reflect id in data hash",function(){var e={guid:"foo4",firstName:"Jack",relatedTo:"foo1"};
var d=MyApp.store.createRecord(MyApp.Foo,e);MyApp.store.commitRecords();equals(d.attributes()["relatedTo"],"foo1","hash value of relatedTo is foo1");
equals(d.get("relatedTo"),rec,"get value of relatedTo is foo1");d.normalize();equals(d.attributes()["relatedTo"],"foo1","hash value of relatedTo after normalizing is still foo1");
equals(d.get("relatedTo"),rec,"get value of relatedTo after normalizing remains foo1")
});test("normalizing a new record with toMany should reflect id in data hash",function(){var e={guid:"foo5",firstName:"Andrew",relatedToMany:["foo1","foo2"]};
var d=MyApp.store.createRecord(MyApp.Foo,e);MyApp.store.commitRecords();ok(SC.typeOf(d.attributes()["relatedToMany"])===SC.T_ARRAY,"should be a hash");
equals(d.get("relatedToMany").get("length"),2,"number of relatedToMany is 2");d.normalize();
ok(SC.typeOf(d.attributes()["relatedToMany"])===SC.T_ARRAY,"should still be a hash after normalizing");
equals(d.get("relatedToMany").get("length"),2,"number of relatedToMany is still 2")
});test("normalizing a new record with toOne that has broken relationship",function(){var e={guid:"foo5",firstName:"Andrew",relatedTo:"foo10"};
var d=MyApp.store.createRecord(MyApp.Foo,e);MyApp.store.commitRecords();equals(d.attributes()["relatedTo"],"foo10","should be foo10");
d.normalize();equals(d.attributes()["relatedTo"],"foo10","should remain foo10")});
test("normalizing a new record with toOne with relationship to wrong recordType",function(){var e={guid:"bar1",firstName:"Andrew",relatedTo:"foo1"};
var d=MyApp.store.createRecord(MyApp.Bar,e);MyApp.store.commitRecords();equals(d.attributes()["relatedTo"],"foo1","should be foo1");
d.normalize();equals(d.attributes()["relatedTo"],"foo1","should remain foo1")});test("normalizing a new record with no guid should work with defaultValue",function(){var h={firstName:"Andrew",relatedTo:"foo1"};
var e=MyApp.store.createRecord(MyApp.Foo,h);MyApp.store.commitRecords();var g=e.get("guid");
equals(e.get("firstName"),"Andrew","firstName should be Andrew");e.normalize();var d=MyApp.store.find(MyApp.Foo,g);
equals(d.get("guid"),g,"guid should be the same as first")});var store,Foo,json,foo;
module("SC.Record#readAttribute",{setup:function(){SC.RunLoop.begin();store=SC.Store.create();
Foo=SC.Record.extend();json={foo:"bar",number:123,bool:YES,array:[1,2,3]};foo=store.createRecord(Foo,json);
store.writeStatus(foo.storeKey,SC.Record.READY_CLEAN)},teardown:function(){SC.RunLoop.end()
}});test("returns unaltered JSON value for existing attributes",function(){var d;
for(d in json){if(!json.hasOwnProperty(d)){continue}equals(foo.get(d),json[d],"should return value for predefined key %@".fmt(d))
}});test("returns undefined for unknown JSON attributes",function(){equals(foo.get("imaginary"),undefined,'should return undefined for unknown key "imaginary"')
});test("returns new value if edited via writeAttribute",function(){foo.writeAttribute("bar","baz");
equals(foo.readAttribute("bar"),"baz","should return value for new attribute 'bar'")
});test("returns undefined when data hash is not present",function(){store.removeDataHash(foo.storeKey);
equals(store.readDataHash(foo.storeKey),null,"precond - data hash should be removed from store");
equals(foo.readAttribute("foo"),undefined,"should return undefined if data hash is missing")
});var MyFoo=null,callInfo;module("SC.Record#refresh",{setup:function(){SC.RunLoop.begin();
MyApp=SC.Object.create({store:SC.Store.create()});MyApp.Foo=SC.Record.extend();MyApp.json={foo:"bar",number:123,bool:YES,array:[1,2,3]};
MyApp.foo=MyApp.store.createRecord(MyApp.Foo,MyApp.json);callInfo=null;MyApp.store.refreshRecord=function(d){callInfo=SC.A(arguments)
}},teardown:function(){SC.RunLoop.end()}});test("calling refresh should call refreshRecord() on store",function(){MyApp.foo.refresh();
same(callInfo,[null,null,MyApp.foo.storeKey],"refreshRecord() should be called on parent")
});test("should return receiver",function(){equals(MyApp.foo.refresh(),MyApp.foo,"should return receiver")
});var store,child,Foo,json,foo;module("SC.Record#storeDidChangeProperties",{setup:function(){SC.RunLoop.begin();
store=SC.Store.create();Foo=SC.Record.extend({statusCnt:0,statusDidChange:function(){this.statusCnt++
}.observes("status"),fooCnt:0,fooDidChange:function(){this.fooCnt++}.observes("foo")});
json={foo:"bar",number:123,bool:YES,array:[1,2,3]};foo=store.createRecord(Foo,json);
store.writeStatus(foo.storeKey,SC.Record.READY_CLEAN);SC.RunLoop.end()}});function checkPreconditions(){equals(foo.statusCnt,0,"precond - statusCnt");
equals(foo.fooCnt,0,"precond - fooCnt")}function expect(d,e,g){equals(d.statusCnt,e,"status should have changed");
equals(d.fooCnt,g,"foo should have changed")}test("should change status only if statusOnly=YES",function(){checkPreconditions();
foo.storeDidChangeProperties(YES);expect(foo,1,0)});test("should change attrs  & status if statusOnly=NO",function(){checkPreconditions();
foo.storeDidChangeProperties(NO);expect(foo,1,1)});test("editing a clean record should change all",function(){checkPreconditions();
SC.RunLoop.begin();foo.writeAttribute("foo","baz");SC.RunLoop.end();expect(foo,2,1)
});test("editing an attribute to same value should do nothing",function(){checkPreconditions();
SC.RunLoop.begin();foo.writeAttribute("foo","bar");SC.RunLoop.end();expect(foo,0,0)
});test("destroying a record should change all",function(){checkPreconditions();SC.RunLoop.begin();
foo.destroy();expect(foo,1,0);SC.RunLoop.end();expect(foo,2,1)});test("refreshing a record should change status",function(){checkPreconditions();
SC.RunLoop.begin();foo.refresh();SC.RunLoop.end();expect(foo,1,0)});test("committing attribute changes from nested store should change attrs",function(){checkPreconditions();
SC.RunLoop.begin();var e=store.chain();var d=e.materializeRecord(foo.storeKey);d.writeAttribute("foo","baz");
SC.RunLoop.end();expect(foo,0,0);SC.RunLoop.begin();e.commitChanges();expect(foo,1,1)
});test("changing attributes on a parent store should notify child store if inherited",function(){var h=store.chain();
var g=foo;var d=store.materializeRecord(foo.storeKey);var e=h.materializeRecord(foo.storeKey);
equals(h.storeKeyEditState(foo.storeKey),SC.Store.INHERITED,"precond - foo should be inherited from parent store");
SC.RunLoop.begin();d.writeAttribute("foo","baz");SC.RunLoop.end();expect(e,1,1)});
test("changing attributes on a parent store should NOT notify child store if locked",function(){var h=store.chain();
var g=foo;var d=store.materializeRecord(foo.storeKey);var e=h.materializeRecord(foo.storeKey);
e.readAttribute("foo");equals(h.storeKeyEditState(foo.storeKey),SC.Store.EDITABLE,"precond - foo should be locked from parent store");
SC.RunLoop.begin();d.writeAttribute("foo","baz");SC.RunLoop.end();expect(e,0,0);expect(d,2,1);
SC.RunLoop.begin();h.discardChanges();expect(e,1,1);SC.RunLoop.end()});var MyFoo=null;
module("SC.Record#unknownProperty",{setup:function(){SC.RunLoop.begin();MyApp=SC.Object.create({store:SC.Store.create()});
MyApp.Foo=SC.Record.extend();MyApp.json={foo:"bar",number:123,bool:YES,array:[1,2,3]};
MyApp.foo=MyApp.store.createRecord(MyApp.Foo,MyApp.json);MyApp.FooStrict=SC.Record.extend();
SC.mixin(MyApp.FooStrict,{ignoreUnknownProperties:YES});MyApp.fooStrict=MyApp.store.createRecord(MyApp.FooStrict,MyApp.json)
},teardown:function(){SC.RunLoop.end()}});test("get() returns attributes with no type changes if they exist",function(){"foo number bool array".w().forEach(function(d){equals(MyApp.foo.get(d),MyApp.json[d],"MyApp.foo.get(%@) should === attribute".fmt(d))
})});test("get() unknown attribute returns undefined",function(){equals(MyApp.foo.get("imaginary"),undefined,"imaginary property should be undefined")
});test("set() unknown property should add to dataHash",function(){MyApp.foo.set("blue","0x00f");
equals(MyApp.store.dataHashes[MyApp.foo.storeKey].blue,"0x00f","should add blue attribute")
});test("set() should replace existing property",function(){MyApp.foo.set("foo","baz");
equals(MyApp.store.dataHashes[MyApp.foo.storeKey].foo,"baz","should update foo attribute")
});test("set() on unknown property if model ignoreUnknownProperties=YES should not write it to data hash",function(){MyApp.fooStrict.set("foo","baz");
equals(MyApp.store.dataHashes[MyApp.fooStrict.storeKey].foo,"bar","should not have written new value to dataHash")
});var store,Foo,json,foo;module("SC.Record#writeAttribute",{setup:function(){SC.RunLoop.begin();
store=SC.Store.create();Foo=SC.Record.extend();json={foo:"bar",number:123,bool:YES,array:[1,2,3],guid:1};
foo=store.createRecord(Foo,json);store.writeStatus(foo.storeKey,SC.Record.READY_CLEAN);
SC.RunLoop.end()}});test("returns receiver",function(){equals(foo.writeAttribute("bar","baz"),foo,"should return receiver")
});test("first time writing should mark record as dirty",function(){equals(foo.get("status"),SC.Record.READY_CLEAN,"precond - start clean");
SC.RunLoop.begin();foo.writeAttribute("bar","baz");SC.RunLoop.end();equals(foo.get("status"),SC.Record.READY_DIRTY,"should make READY_DIRTY after write")
});test("state change should be deferred if writing inside of a beginEditing()/endEditing() pair",function(){equals(foo.get("status"),SC.Record.READY_CLEAN,"precond - start clean");
SC.RunLoop.begin();foo.beginEditing();foo.writeAttribute("bar","baz");equals(foo.get("status"),SC.Record.READY_CLEAN,"should not change state yet");
foo.endEditing();SC.RunLoop.end();equals(foo.get("status"),SC.Record.READY_DIRTY,"should make READY_DIRTY after write")
});test("raises exception if you try to write an attribute before an attribute hash has been set",function(){store.removeDataHash(foo.storeKey);
equals(store.readDataHash(foo.storeKey),null,"precond - should not have store key");
var d=0;try{foo.writeAttribute("foo","bar")}catch(g){equals(g,SC.Record.BAD_STATE_ERROR,"should throw BAD_STATE_ERROR");
d++}equals(d,1,"should raise exception")});test("Writing to an attribute in chained store sets correct status",function(){var d=store.chain();
var e=d.find(Foo,foo.get("id"));equals(e.get("status"),SC.Record.READY_CLEAN,"precon - status should be READY_CLEAN");
SC.RunLoop.begin();e.writeAttribute("foo","newValue");SC.RunLoop.end();equals(e.get("status"),SC.Record.READY_DIRTY,"status should be READY_DIRTY")
});test("Writing a new guid",function(){equals(foo.get("id"),1,"foo.id should be 1");
foo.set("guid",2);equals(foo.get("id"),2,"foo.id should be 2")});test("Writing primaryKey of 'id'",function(){PrimaryKeyId=SC.Record.extend({primaryKey:"id"});
var d=store.createRecord(PrimaryKeyId,{id:1});equals(d.get("id"),1,"foo2.id should be 1");
d.set("id",2);equals(d.get("id"),2,"foo2.id should be 2")});var storeKeys,rec,rec2,bar,MyApp;
module("SC.RecordAttribute core methods",{setup:function(){MyApp=SC.Object.create({store:SC.Store.create()});
window.MyApp=MyApp;MyApp.Foo=SC.Record.extend({firstName:SC.Record.attr(String),otherName:SC.Record.attr(String,{key:"firstName"}),date:SC.Record.attr(Date),nonIsoDate:SC.Record.attr(Date,{useIsoDate:false}),anArray:SC.Record.attr(Array),anObject:SC.Record.attr(Object),aNumber:SC.Record.attr(Number),defaultValue:SC.Record.attr(String,{defaultValue:"default"}),defaultComputedValue:SC.Record.attr(Number,{defaultValue:function(){return Math.floor(Math.random()*3+1)
}}),relatedTo:SC.Record.toOne("MyApp.Foo"),relatedToComputed:SC.Record.toOne(function(){return(this.readAttribute("relatedToComputed").indexOf("foo")===0)?MyApp.Foo:MyApp.Bar
}),readOnly:SC.Record.attr(String,{isEditable:NO})});MyApp.Bar=SC.Record.extend({parent:SC.Record.toOne("MyApp.Foo",{aggregate:YES}),relatedMany:SC.Record.toMany("MyApp.Foo",{aggregate:YES})});
SC.RunLoop.begin();storeKeys=MyApp.store.loadRecords(MyApp.Foo,[{guid:"foo1",firstName:"John",lastName:"Doe",date:"2009-03-01T20:30-08:00",anArray:["one","two","three"],anObject:{key1:"value1",key2:"value2"},aNumber:"123",readOnly:"foo1"},{guid:"foo2",firstName:"Jane",lastName:"Doe",relatedTo:"foo1",relatedToAggregate:"bar1",anArray:"notAnArray",anObject:"notAnObject",aNumber:"123",nonIsoDate:"2009/06/10 8:55:50 +0000"},{guid:"foo3",firstName:"Alex",lastName:"Doe",relatedToComputed:"bar1",anArray:["one","two","three"],anObject:{key1:"value1",key2:"value2"},aNumber:"123"}]);
MyApp.store.loadRecords(MyApp.Bar,[{guid:"bar1",city:"Chicago",parent:"foo2",relatedMany:["foo1","foo2"]}]);
SC.RunLoop.end();rec=MyApp.store.find(MyApp.Foo,"foo1");rec2=MyApp.store.find(MyApp.Foo,"foo2");
bar=MyApp.store.find(MyApp.Bar,"bar1");equals(rec.storeKey,storeKeys[0],"should find record")
}});test("pass-through should return builtin value",function(){equals(rec.get("firstName"),"John","reading prop should get attr value")
});test("returns default value if underyling value is empty",function(){equals(rec.get("defaultValue"),"default","reading prop should return default value")
});test("naming a key should read alternate attribute",function(){equals(rec.get("otherName"),"John","reading prop otherName should get attr from firstName")
});test("getting a number",function(){equals((typeof rec.get("aNumber")),"number","reading prop aNumber should get attr as number")
});test("getting an array and object",function(){equals(rec.get("anArray").length,3,"reading prop anArray should get attr as array");
equals((typeof rec.get("anObject")),"object","reading prop anObject should get attr as object")
});test("getting an array and object attributes where underlying value is not",function(){equals(rec2.get("anArray").length,0,"reading prop anArray should return empty array");
equals((typeof rec2.get("anObject")),"object","reading prop anObject should return empty object")
});test("reading date should parse ISO date",function(){var e=new Date(1235968200000);
equals(rec.get("date").toString(),e.toString(),"should have matched date")});test("reading date should parse non-ISO date",function(){var e=new Date(1244624150000);
equals(rec2.get("nonIsoDate").toString(),e.toString(),"should have matched date")
});test("reading no date should produce null",function(){var e=new Date(1235968200000);
equals(rec2.get("date"),null,"should have yielded null")});test("reading computed default value",function(){var e=rec.get("defaultComputedValue");
var d=[1,2,3,4];ok(d.indexOf(e)!==-1,"should have a value from 1 through 4")});test("writing pass-through should simply set value",function(){rec.set("firstName","Foo");
equals(rec.readAttribute("firstName"),"Foo","should write string");rec.set("firstName",23);
equals(rec.readAttribute("firstName"),23,"should write number");rec.set("firstName",YES);
equals(rec.readAttribute("firstName"),YES,"should write bool")});test("writing when isEditable is NO should ignore",function(){var d=rec.get("readOnly");
rec.set("readOnly","NEW VALUE");equals(rec.get("readOnly"),d,"read only value should not change")
});test("writing a value should override default value",function(){equals(rec.get("defaultValue"),"default","precond - returns default");
rec.set("defaultValue","not-default");equals(rec.get("defaultValue"),"not-default","newly written value should replace default value")
});test("writing a string to a number attribute should store a number",function(){equals(rec.set("aNumber","456"),rec,"returns reciever");
equals(rec.get("aNumber"),456,"should have new value");equals(typeof rec.get("aNumber"),"number","new value should be a number")
});test("writing a date should generate an ISO date",function(){var d=new Date(1238650083966);
equals(rec.set("date",d),rec,"returns reciever");equals(rec.readAttribute("date"),"2009-04-01T22:28:03-07:00","should have new time (%@)".fmt(d.toString()))
});test("writing an attribute should make relationship aggregate dirty",function(){equals(bar.get("status"),SC.Record.READY_CLEAN,"precond - bar should be READY_CLEAN");
equals(rec2.get("status"),SC.Record.READY_CLEAN,"precond - rec2 should be READY_CLEAN");
bar.set("city","Oslo");bar.get("store").flush();equals(rec2.get("status"),SC.Record.READY_DIRTY,"foo2 should be READY_DIRTY")
});test("writing an attribute should make many relationship aggregate dirty",function(){equals(bar.get("status"),SC.Record.READY_CLEAN,"precond - bar should be READY_CLEAN");
equals(rec2.get("status"),SC.Record.READY_CLEAN,"precond - rec2 should be READY_CLEAN");
bar.set("city","Oslo");bar.get("store").flush();equals(rec.get("status"),SC.Record.READY_DIRTY,"foo1 should be READY_DIRTY");
equals(rec2.get("status"),SC.Record.READY_DIRTY,"foo2 should be READY_DIRTY")});test("writing an attribute should make many relationship aggregate dirty and add the aggregate to the store",function(){equals(bar.get("status"),SC.Record.READY_CLEAN,"precond - bar should be READY_CLEAN");
equals(rec2.get("status"),SC.Record.READY_CLEAN,"precond - rec2 should be READY_CLEAN");
bar.set("city","Oslo");var d=bar.get("store");ok(d.changelog.contains(rec.get("storeKey")),"foo1 should be in the store's changelog");
ok(d.changelog.contains(rec2.get("storeKey")),"foo2 should be in the store's changelog")
});var storeKeys,rec,rec2,bar,bar2;module("SC.RecordAttribute core methods",{setup:function(){MyApp=SC.Object.create({store:SC.Store.create()});
MyApp.Foo=SC.Record.extend({relatedTo:SC.Record.toOne("MyApp.Foo"),relatedToComputed:SC.Record.toOne(function(){return(this.readAttribute("relatedToComputed").indexOf("foo")===0)?MyApp.Foo:MyApp.Bar
}),bar:SC.Record.toOne("MyApp.Bar",{inverse:"foo"}),barKeyed:SC.Record.toOne("MyApp.Bar",{key:"barId"})});
MyApp.Bar=SC.Record.extend({foo:SC.Record.toOne("MyApp.Foo",{inverse:"bar",isMaster:NO})});
SC.RunLoop.begin();storeKeys=MyApp.store.loadRecords(MyApp.Foo,[{guid:"foo1",firstName:"John",lastName:"Doe",date:"2009-03-01T20:30-08:00",anArray:["one","two","three"],anObject:{key1:"value1",key2:"value2"},bar:"bar1"},{guid:"foo2",firstName:"Jane",lastName:"Doe",relatedTo:"foo1",anArray:"notAnArray",anObject:"notAnObject",nonIsoDate:"2009/06/10 8:55:50 +0000"},{guid:"foo3",firstName:"Alex",lastName:"Doe",relatedToComputed:"bar1",anArray:["one","two","three"],anObject:{key1:"value1",key2:"value2"},bar:"bar2"},{guid:"foo4",firstName:"Joe",lastName:"Schmo",barId:"bar1"}]);
MyApp.store.loadRecords(MyApp.Bar,[{guid:"bar1",city:"Chicago",foo:"foo1"},{guid:"bar2",city:"New York",foo:"foo3"}]);
SC.RunLoop.end();rec=MyApp.store.find(MyApp.Foo,"foo1");rec2=MyApp.store.find(MyApp.Foo,"foo2");
bar=MyApp.store.find(MyApp.Bar,"bar1");bar2=MyApp.store.find(MyApp.Bar,"bar2");equals(rec.storeKey,storeKeys[0],"should find record")
}});test("getting toOne relationship should map guid to a real record",function(){var d=MyApp.store.find(MyApp.Foo,"foo2");
equals(d.get("id"),"foo2","precond - should find record 2");equals(d.get("relatedTo"),rec,"should get rec1 instance for rec2.relatedTo")
});test("getting toOne relationship from computed attribute should map guid to a real record",function(){var d=MyApp.store.find(MyApp.Foo,"foo3");
equals(d.get("id"),"foo3","precond - should find record 3");equals(d.get("relatedToComputed"),bar,"should get bar1 instance for rec3.relatedToComputed")
});test("reading an inverse relationship",function(){equals(rec.get("bar"),bar,"foo1.bar should == bar");
equals(bar.get("foo"),rec,"bar.foo should == foo1")});test("reading a keyed relationship",function(){var d=MyApp.store.find(MyApp.Foo,"foo4");
equals(d.get("barKeyed"),bar,"foo4.barKeyed should == bar")});test("writing to a to-one relationship should update set guid",function(){var d=MyApp.store.find(MyApp.Foo,"foo2");
equals(d.get("id"),"foo2","precond - should find record 2");equals(d.get("relatedTo"),rec,"precond - should get rec1 instance for rec2.relatedTo");
d.set("relatedTo",d);equals(d.readAttribute("relatedTo"),"foo2","should write ID for set record to relatedTo attribute");
equals(d.get("relatedTo"),d,"should get foo record that was just set")});test("writing to a to-one computed relationship should update set guid",function(){var d=MyApp.store.find(MyApp.Foo,"foo3");
equals(d.get("id"),"foo3","precond - should find record 2");equals(d.get("relatedToComputed"),bar,"precond - should get bar1 instance for rec3.relatedToComputed");
d.set("relatedToComputed",rec);equals(d.readAttribute("relatedToComputed"),"foo1","should write ID for set record to relatedTo attribute")
});test("clearing a toOne relationship",function(){ok(rec2.get("relatedTo")!==null,"precond - rec.relatedTo should have a value");
rec2.set("relatedTo",null);equals(rec2.get("relatedTo"),null,"rec.relatedTo should be null");
equals(rec2.readAttribute("relatedTo"),null,"rec.relatedTo attribute should be null")
});test("clearing a toOne relationship with an inverse - foo isMaster",function(){equals(rec.get("bar"),bar,"precond - foo1.bar should eq bar");
equals(bar.get("foo"),rec,"precond - bar.foo should eq foo1");equals(rec.get("status"),SC.Record.READY_CLEAN,"precond - foo1.status should be READY_CLEAN");
equals(bar.get("status"),SC.Record.READY_CLEAN,"precond - bar1.status should be READY_CLEAN");
rec.set("bar",null);equals(rec.get("bar"),null,"foo1.bar should be null after change");
equals(bar.get("foo"),null,"bar.foo should also be null after change");equals(rec.get("status"),SC.Record.READY_DIRTY,"foo1.status should be READY_DIRTY");
equals(bar.get("status"),SC.Record.READY_CLEAN,"bar1.status should be READY_CLEAN")
});test("modifying a toOne relationship with an inverse from null",function(){equals(rec.get("bar"),bar,"precond - foo1.bar should eq bar");
equals(bar.get("foo"),rec,"precond - bar.foo should eq foo1");equals(rec2.get("bar"),null,"precond - foo2.bar should eq null");
[rec,rec2,bar].forEach(function(d){equals(d.get("status"),SC.Record.READY_CLEAN,"precond - %@.status should be READY_CLEAN".fmt(d.get("id")))
},this);bar.set("foo",rec2);equals(rec.get("bar"),null,"foo1.bar should be null after change");
equals(bar.get("foo"),rec2,"bar.foo should eq foo2 after change");equals(rec2.get("bar"),bar,"foo2.bar should eq bar after change");
equals(rec.get("status"),SC.Record.READY_DIRTY,"foo1.status should be READY_DIRTY");
equals(rec2.get("status"),SC.Record.READY_DIRTY,"foo1.status should be READY_DIRTY");
equals(bar.get("status"),SC.Record.READY_CLEAN,"bar1.status should be READY_CLEAN")
});test("modifying a toOne relationship with an inverse from other",function(){var g=rec,e=MyApp.store.find(MyApp.Foo,"foo3"),d=bar;
equals(g.get("bar"),d,"precond - foo1.bar should eq bar1");equals(d.get("foo"),g,"precond - bar.foo should eq foo1");
equals(e.get("bar"),bar2,"precond - foo3.bar should eq null");equals(bar2.get("foo"),e,"precond - bar2.foo should eq foo3");
[g,e,d,bar2].forEach(function(h){equals(h.get("status"),SC.Record.READY_CLEAN,"precond - %@.status should be READY_CLEAN".fmt(h.get("id")))
},this);d.set("foo",e);equals(g.get("bar"),null,"foo1.bar should be null after change");
equals(d.get("foo"),e,"bar.foo should eq foo3 after change");equals(e.get("bar"),d,"foo3.bar should be bar after change");
equals(bar2.get("foo"),null,"bar2.foo should eq null after change");equals(g.get("status"),SC.Record.READY_DIRTY,"foo1.status should be READY_DIRTY");
equals(g.get("status"),SC.Record.READY_DIRTY,"foo1.status should be READY_DIRTY");
equals(d.get("status"),SC.Record.READY_CLEAN,"bar1.status should be READY_CLEAN");
equals(bar2.get("status"),SC.Record.READY_CLEAN,"bar1.status should be READY_CLEAN")
});test("modifying a keyed toOne relationship",function(){var d=MyApp.store.find(MyApp.Foo,"foo4");
d.set("barKeyed",bar2);equals(d.get("barId"),"bar2","foo4.barId should == bar2")});
var store,storeKey,storeId,rec,storeIds,recs,arrayRec;module("SC.ManyArray core methods",{setup:function(){MyApp=SC.Object.create({store:SC.Store.create()});
MyApp.Foo=SC.Record.extend({});SC.RunLoop.begin();storeIds=[1,2,3,4];MyApp.store.loadRecords(MyApp.Foo,[{guid:1,firstName:"John",lastName:"Doe",age:32},{guid:2,firstName:"Jane",lastName:"Doe",age:30},{guid:3,firstName:"Emily",lastName:"Parker",age:7},{guid:4,firstName:"Johnny",lastName:"Cash",age:17},{guid:50,firstName:"Holder",fooMany:storeIds}]);
storeKey=MyApp.store.storeKeyFor(MyApp.Foo,1);rec=MyApp.store.materializeRecord(storeKey);
storeId=rec.get("id");arrayRec=MyApp.store.materializeRecord(MyApp.store.storeKeyFor(MyApp.Foo,50));
recs=SC.ManyArray.create({record:arrayRec,propertyName:"fooMany",recordType:MyApp.Foo,isEditable:YES});
arrayRec.relationships=[recs]},teardown:function(){SC.RunLoop.end()}});test("should pass through length",function(){equals(recs.get("length"),storeIds.length,"rec should pass through length")
});test("changing storeIds length should change length of rec array also",function(){var d=recs.get("length");
storeIds.pushObject(SC.Store.generateStoreKey());ok(storeIds.length>d,"precond - storeKeys.length should have changed");
equals(recs.get("length"),storeIds.length,"rec should pass through length")});test("should materialize record for object",function(){equals(storeIds[0],storeId,"precond - storeIds[0] should be storeId");
equals(recs.objectAt(0),rec,"recs.objectAt(0) should materialize record")});test("reading past end of array length should return undefined",function(){equals(recs.objectAt(2000),undefined,"recs.objectAt(2000) should be undefined")
});test("modifying the underlying storeId should change the returned materialized record",function(){equals(recs.objectAt(0),rec,"recs.objectAt(0) should materialize record");
var e=MyApp.store.createRecord(MyApp.Foo,{guid:5,firstName:"Fred"});var d=e.get("id");
storeIds.unshiftObject(d);equals(recs.get("length"),5,"should now have length of 5");
equals(recs.objectAt(0),e,"objectAt(0) should return new record");equals(recs.objectAt(1),rec,"objectAt(1) should return old record")
});test("reading a record not loaded in store should trigger retrieveRecord",function(){var d=0;
MyApp.store.removeDataHash(storeKey,SC.Record.EMPTY);MyApp.store.retrieveRecord=function(){d++
};var e=recs.objectAt(0);equals(MyApp.store.readStatus(e),SC.Record.EMPTY,"precond - storeKey must not be loaded");
equals(d,1,"store.retrieveRecord() should have been called")});test("adding a record to the ManyArray should pass through storeIds",function(){equals(recs.objectAt(0),rec,"recs.objectAt(0) should materialize record");
var e=MyApp.store.createRecord(MyApp.Foo,{guid:5,firstName:"rec2"});var d=e.get("id");
recs.unshiftObject(e);equals(recs.get("length"),5,"should now have length of 2");
equals(recs.objectAt(0),e,"recs.objectAt(0) should return new record");equals(recs.objectAt(1),rec,"recs.objectAt(1) should return old record");
storeIds=arrayRec.readAttribute("fooMany");equals(storeIds.objectAt(0),d,"storeKeys[0] should return new storeKey");
equals(storeIds.objectAt(1),storeId,"storeKeys[1] should return old storeKey")});
test("changing the underlying storeIds should notify observers of records",function(){var d=SC.Object.create({cnt:0,observer:function(){this.cnt++
}});recs.addObserver("[]",d,d.observer);storeIds.pushObject(5);equals(d.cnt,1,"observer should have fired after changing storeKeys")
});test("swapping storeIds array should change ManyArray and observers",function(){var g=MyApp.store.createRecord(MyApp.Foo,{guid:5,firstName:"rec2"});
var e=g.get("id");var d=[e];var h=SC.Object.create({cnt:0,observer:function(){this.cnt++
}});recs.addObserver("[]",h,h.observer);equals(recs.objectAt(0),rec,"recs.objectAt(0) should materialize record");
h.cnt=0;arrayRec.writeAttribute("fooMany",d);SC.RunLoop.end();SC.RunLoop.begin();
equals(h.cnt,1,"observer should have fired after swap");equals(recs.objectAt(0),g,"recs.objectAt(0) should return new rec");
h.cnt=0;d.unshiftObject(storeId);equals(h.cnt,1,"observer should have fired after edit");
equals(recs.get("length"),2,"should reflect new length");equals(recs.objectAt(0),rec,"recs.objectAt(0) should return pushed rec")
});test("reduced properties",function(){equals(recs.get("@sum(age)"),32+30+7+17,"sum reducer should return the correct value");
equals(recs.get("@max(age)"),32,"max reducer should return the correct value");equals(recs.get("@min(age)"),7,"min reducer should return the correct value");
equals(recs.get("@average(age)"),(32+30+7+17)/4,"average reducer should return the correct value")
});var Rec=SC.Record.extend({title:SC.Record.attr(String),fired:NO,reset:function(){this.fired=NO
},titleDidChange:function(){this.fired=YES}.observes("title")});module("SC.Store#chain - init");
test("initial setup for chained store",function(){var e=SC.Store.create();var d=e.chain();
ok(d!==e,"chain should return new child store");equals(d.get("parentStore"),e,"should have parentStore");
equals(SC.typeOf(d.dataHashes),SC.T_HASH,"should have dataHashes");e.dataHashes.foo="bar";
equals(d.dataHashes.foo,"bar","dataHashes should inherit from parent");equals(SC.typeOf(d.revisions),SC.T_HASH,"should have revisions");
e.revisions.foo="bar";equals(d.revisions.foo,"bar","revisions should inherit from parent");
equals(SC.typeOf(d.statuses),SC.T_HASH,"should have statuses");e.statuses.foo="bar";
equals(d.statuses.foo,"bar","statuses should inherit from parent");ok(!d.locks,"should not have locks");
ok(!d.chainedChanges,"should not have chainedChanges");ok(!d.editables,"should not have editables")
});test("allow for custom subclasses of SC.NestedStore",function(){var h=SC.Store.create();
var d=null;try{var g=h.chain({},"I am not a class")}catch(k){d=k}ok(d&&d.message&&d.message.indexOf("not a valid class")!==-1,'chain should report that our bogus "class" it is not a valid class');
d=null;try{var g=h.chain({},SC.Store)}catch(k){d=k}ok(d&&d.message&&d.message.indexOf("is not a type of SC.NestedStore")!==-1,"chain should report that our class needs to be a subclass of SC.NestedStore");
var j=SC.NestedStore.extend();var l=h.chain({},j);ok(l.kindOf(j),"our nested store should be the SC.NestedStore subclass we specified")
});test("chained store changes should propagate reliably",function(){var e=SC.Store.create(),h,d,g;
SC.run(function(){e.loadRecords(Rec,[{title:"foo",guid:1}])});h=e.find(Rec,1);ok(h&&h.get("title")==="foo","precond - base store should have record");
SC.RunLoop.begin();d=e.chain();g=d.find(Rec,1);ok(g&&g.get("title")==="foo","chain store should have record");
h.reset();g.set("title","bar");SC.RunLoop.end();equals(g.get("title"),"bar","chained rec.title should changed");
equals(h.get("title"),"foo","original rec.title should NOT change");equals(d.get("hasChanges"),YES,"chained store.hasChanges");
equals(h.fired,NO,"original rec.title should not have notified");SC.RunLoop.begin();
h.reset();d.commitChanges();d.destroy();SC.RunLoop.end();equals(h.get("title"),"bar","original rec.title should change");
equals(h.fired,YES,"original rec.title should have notified");SC.RunLoop.begin();
d=e.chain();g=d.find(Rec,1);ok(g&&g.get("title")==="bar","chain store should have record");
h.reset();g.set("title","baz");SC.RunLoop.end();equals(g.get("title"),"baz","chained rec.title should changed");
equals(h.get("title"),"bar","original rec.title should NOT change");equals(d.get("hasChanges"),YES,"chained store.hasChanges");
equals(h.fired,NO,"original rec.title should not have notified");SC.RunLoop.begin();
h.reset();d.commitChanges();d.destroy();SC.RunLoop.end();equals(h.get("title"),"baz","original rec.title should change");
equals(h.fired,YES,"original rec.title should have notified");SC.RunLoop.begin();
d=e.chain();g=d.find(Rec,1);ok(g&&g.get("title")==="baz","chain store should have record");
h.reset();g.set("title","FOO2");SC.RunLoop.end();equals(g.get("title"),"FOO2","chained rec.title should changed");
equals(h.get("title"),"baz","original rec.title should NOT change");equals(d.get("hasChanges"),YES,"chained store.hasChanges");
equals(h.fired,NO,"original rec.title should not have notified");SC.RunLoop.begin();
h.reset();d.commitChanges();d.destroy();SC.RunLoop.end();equals(h.get("title"),"FOO2","original rec.title should change");
equals(h.fired,YES,"original rec.title should have notified")});var parent,store,child,storeKey,json,args;
module("SC.NestedStore#commitChanges",{setup:function(){parent=SC.Store.create();
json={string:"string",number:23,bool:YES};args=[];storeKey=SC.Store.generateStoreKey();
store=parent.chain();child=store.chain();parent.commitChangesFromNestedStore=child.commitChangesFromNestedStore=store.commitChangesFromNestedStore=function(d,e,g){args.push({target:this,store:d,changes:e,force:g})
}}});function testStateTransition(h,d){equals(store.commitChanges(),store,"should return receiver");
equals(store.storeKeyEditState(storeKey),SC.Store.INHERITED,"data edit state");if(d===NO){ok(!args||args.length===0,"should not call commitChangesFromNestedStore")
}else{equals(args.length,1,"should have called commitChangesFromNestedStore");var j=args[0]||{};
equals(j.target,parent,"should have called on parent store");var g=j.changes;var e=g&&g.contains(storeKey);
if(h){ok(e,"passed set of changes should include storeKey")}else{ok(!e,"passed set of changes should NOT include storeKey")
}}equals(store.get("hasChanges"),NO,"hasChanges should be cleared");ok(!store.chainedChanges||store.chainedChanges.length===0,"should have empty chainedChanges set")
}test("state = INHERITED",function(){parent.writeDataHash(storeKey,json);equals(store.storeKeyEditState(storeKey),SC.Store.INHERITED,"precond - data edit state");
testStateTransition(NO,NO)});test("state = LOCKED",function(){parent.writeDataHash(storeKey,json);
parent.editables=null;store.readDataHash(storeKey);equals(store.storeKeyEditState(storeKey),SC.Store.LOCKED,"precond - data edit state");
ok(!store.chainedChanges||!store.chainedChanges.contains(storeKey),"locked record should not be in chainedChanges set");
testStateTransition(NO,NO)});test("state = EDITABLE",function(){store.writeDataHash(storeKey,json);
store.dataHashDidChange(storeKey);equals(store.storeKeyEditState(storeKey),SC.Store.EDITABLE,"precond - data edit state");
ok(store.chainedChanges&&store.chainedChanges.contains(storeKey),"editable record should be in chainedChanges set");
testStateTransition(YES,YES)});test("commiting a changed record should immediately notify outstanding records in parent store",function(){var g=SC.Record.extend({fooCnt:0,fooDidChange:function(){this.fooCnt++
}.observes("foo"),statusCnt:0,statusDidChange:function(){this.statusCnt++}.observes("status"),reset:function(){this.fooCnt=this.statusCnt=0
},equals:function(l,k,m){if(!m){m=""}equals(this.get("fooCnt"),l,m+":fooCnt");equals(this.get("statusCnt"),k,m+":statusCnt")
}});SC.RunLoop.begin();var d=SC.Store.create();var e=d.createRecord(g,{foo:"bar",guid:1});
var j=d.chain();var h=j.find(g,e.get("id"));ok(!!h,"prerec - should find child record");
equals(h.get("foo"),"bar","prerec - child record should have foo");e.reset();h.set("foo","baz");
equals(e.get("foo"),"bar","should not modify parent before commit");e.equals(0,0,"before commitChanges");
j.commitChanges();equals(e.get("foo"),"baz","should push data to parent");e.equals(1,1,"after commitChanges");
SC.RunLoop.end();e.equals(1,1,"after runloop ends - should not notify again")});var parent,store,child,storeKey,json;
module("SC.NestedStore#commitChangesFromNestedStore",{setup:function(){parent=SC.Store.create();
json={string:"string",number:23,bool:YES};storeKey=SC.Store.generateStoreKey();store=parent.chain();
child=store.chain();child.writeDataHash(storeKey,json,SC.Record.READY_DIRTY);child.dataHashDidChange(storeKey);
child.changelog=SC.Set.create();child.changelog.add(storeKey)}});test("copies changed data hashes, statuses, and revisions",function(){SC.RunLoop.begin();
equals(store.readDataHash(storeKey),null,"precond - should not have data yet");ok(child.chainedChanges.contains(storeKey),"precond - child changes should include storeKey");
equals(store.commitChangesFromNestedStore(child,child.chainedChanges,NO),store,"should return receiver");
SC.RunLoop.end();equals(store.readDataHash(storeKey),json,"now should have json");
equals(store.readStatus(storeKey),SC.Record.READY_DIRTY,"now should have status");
equals(store.revisions[storeKey],child.revisions[storeKey],"now shoulave have revision from child")
});test("adds lock on any items not already locked",function(){SC.RunLoop.begin();
var g=SC.Store.generateStoreKey();var e={kind:"json2"};store.readDataHash(storeKey);
ok(store.locks[storeKey],"precond - storeKey should have lock");ok(!store.locks[g],"precond - storeKey2 should not have lock");
child.writeDataHash(g,e,SC.Record.READY_DIRTY);child.dataHashDidChange(g);var d=child.chainedChanges;
ok(d.contains(storeKey),"precond - child.chainedChanges should contain storeKey");
ok(d.contains(g),"precond - child.chainedChanges should contain storeKey2");equals(store.commitChangesFromNestedStore(child,d,NO),store,"should return reciever");
SC.RunLoop.end();ok(store.locks[storeKey],"storeKey should have lock after commit (actual: %@)".fmt(store.locks[storeKey]));
ok(store.locks[g],"storeKey2 should have lock after commit (actual: %@)".fmt(store.locks[g]))
});test("adds items in chainedChanges to reciever chainedChanges",function(){SC.RunLoop.begin();
var d=SC.Store.generateStoreKey();store.dataHashDidChange(d);ok(child.chainedChanges.contains(storeKey),"precond - child.chainedChanges should contain store key");
equals(store.commitChangesFromNestedStore(child,child.chainedChanges,NO),store,"should return receiver");
SC.RunLoop.end();ok(store.chainedChanges.contains(d),"chainedChanges should still contain key1");
ok(store.chainedChanges.contains(storeKey),"chainedChanges should also contain storeKey")
});test("should set hasChanges to YES if has changes",function(){SC.RunLoop.begin();
var d=child.chainedChanges;ok(d.length>0,"precond - should have some changes in child");
equals(store.get("hasChanges"),NO,"precond - store should not have changes");store.commitChangesFromNestedStore(child,d,NO);
equals(store.get("hasChanges"),YES,"store should now have changes")});test("should set hasChanges to NO if no changes",function(){SC.RunLoop.begin();
child=store.chain();var d=child.chainedChanges||SC.Set.create();ok(!d||!d.length,"precond - should have not have changes in child");
equals(store.get("hasChanges"),NO,"precond - store should not have changes");store.commitChangesFromNestedStore(child,d,NO);
SC.RunLoop.end();equals(store.get("hasChanges"),NO,"store should NOT now have changes")
});test("committing changes should chain back each step",function(){SC.RunLoop.begin();
equals(child.readDataHash(storeKey),json,"precond - child should have data");equals(store.readDataHash(storeKey),null,"precond - store should not have data");
equals(parent.readDataHash(storeKey),null,"precond - parent should not have data");
child.commitChanges();equals(store.get("hasChanges"),YES,"store should now have changes");
equals(store.readDataHash(storeKey),json,"store should now have json");store.commitChanges();
equals(store.get("hasChanges"),NO,"store should no longer have changes");equals(parent.readDataHash(storeKey),json,"parent should now have json");
SC.RunLoop.end()});var store,nestedStore,Application,dataSource;module("SC.NestedStore Core Methods",{setup:function(){dataSource=SC.DataSource.create();
Application={};Application._nameDidChange=0;Application.File=SC.Record.extend({nameDidChange:function(e,g){Application._nameDidChange++
}.observes("name","url","isDirectory")});Application.FileDisk=SC.Record.extend({});
Application.Data={FileDisk:[{guid:"14",name:"Main Drive",parent:null,children:null}],File:[{guid:"10",name:"Home",url:"/emily_parker",isDirectory:true,parent:null,children:"Collection"},{guid:"11",name:"Documents",fileType:"documents",url:"/emily_parker/Documents",isDirectory:true,parent:"10",children:"Collection",createdAt:"June 15, 2007",modifiedAt:"October 21, 2007",filetype:"directory",isShared:false},{guid:"137",name:"Library",fileType:"library",url:"/emily_parker/Library",isDirectory:true,parent:"10",children:"Collection",createdAt:"June 15, 2007",modifiedAt:"October 21, 2007",filetype:"directory",isShared:false},{guid:"12",name:"Movies",fileType:"movies",url:"/emily_parker/Movies",isDirectory:true,parent:"10",children:"Collection",createdAt:"June 15, 2007",modifiedAt:"June 15, 2007",filetype:"directory",isShared:true,sharedAt:"October 15, 2007",sharedUntil:"March 31, 2008",sharedUrl:"2fhty",isPasswordRequired:true},{guid:"134",name:"Music",fileType:"music",url:"/emily_parker/Music",isDirectory:true,parent:"10",children:"Collection",createdAt:"June 15, 2007",modifiedAt:"June 15, 2007",filetype:"directory",isShared:true,sharedAt:"October 15, 2007",sharedUntil:"March 31, 2008",sharedUrl:"2fhty",isPasswordRequired:true},{guid:"135",name:"Pictures",fileType:"pictures",url:"/emily_parker/Pictures",isDirectory:true,parent:"10",children:"Collection",createdAt:"June 15, 2007",modifiedAt:"June 15, 2007",filetype:"directory",isShared:true,sharedAt:"October 15, 2007",sharedUntil:"March 31, 2008",sharedUrl:"2fhty",isPasswordRequired:true},{guid:"13",name:"Auto Insurance",fileType:"folder",url:"/emily_parker/Documents/Auto%20Insurance",isDirectory:true,parent:"11",children:"Collection",createdAt:"June 15, 2007",modifiedAt:"October 21, 2007",filetype:"directory",isShared:false},{guid:"14",name:"Birthday Invitation.pdf",fileType:"file",url:"/emily_parker/Documents/Birthday%20Invitation",isDirectory:false,parent:"11",createdAt:"October 17, 2007",modifiedAt:"October 21, 2007",filetype:"pdf",isShared:false},{guid:"136",name:"Software",fileType:"software",url:"/emily_parker/Software",isDirectory:true,parent:"10",children:"Collection",createdAt:"June 15, 2007",modifiedAt:"June 15, 2007",filetype:"directory",isShared:true,sharedAt:"October 15, 2007",sharedUntil:"March 31, 2008",sharedUrl:"2fhty",isPasswordRequired:true}]};
SC.RunLoop.begin();store=SC.Store.create({name:"Test nested store"}).from(dataSource);
for(var d in Application.Data){store.loadRecords(Application[d],Application.Data[d])
}SC.RunLoop.end();window.Application=Application;nestedStore=store.chain()}});test("Make sure that setting an attribute on a record will only notify respective observers once",function(){var d=nestedStore.find(Application.File,"14");
Application._nameDidChange=0;SC.RunLoop.begin();d.writeAttribute("name","My Great New Name");
SC.RunLoop.end();equals(Application._nameDidChange,1,"observer was only fired once")
});var parent,store,child,storeKey,json;module("SC.NestedStore#dataHashDidChange",{setup:function(){parent=SC.Store.create();
json={string:"string",number:23,bool:YES};storeKey=SC.Store.generateStoreKey();SC.RunLoop.begin();
parent.writeDataHash(storeKey,json,SC.Record.READY_CLEAN);SC.RunLoop.end();parent.editables=null;
store=parent.chain();child=store.chain()}});function testStateTransition(g,d){equals(store.get("hasChanges"),NO,"should not have changes");
equals(store.storeKeyEditState(storeKey),g,"precond - storeKey edit state");if(store.chainedChanges){ok(!store.chainedChanges.contains(storeKey),"changedChanges should NOT include storeKey")
}var e=store.revisions[storeKey];equals(store.dataHashDidChange(storeKey),store,"should return receiver");
equals(store.storeKeyEditState(storeKey),d,"store key edit state is in same state");
ok(e!==store.revisions[storeKey],"revisions should change. was: %@ - now: %@".fmt(e,store.revisions[storeKey]));
ok(store.chainedChanges.contains(storeKey),"changedChanges should now include storeKey");
equals(store.get("hasChanges"),YES,"should have changes")}test("edit state = INHERITED, parent editable = NO",function(){equals(parent.storeKeyEditState(storeKey),SC.Store.LOCKED,"precond - parent store edit state is not EDITABLE");
testStateTransition(SC.Store.INHERITED,SC.Store.LOCKED)});test("edit state = INHERITED, parent editable = YES",function(){parent.readEditableDataHash(storeKey);
equals(parent.storeKeyEditState(storeKey),SC.Store.EDITABLE,"precond - parent store edit state is EDITABLE");
testStateTransition(SC.Store.INHERITED,SC.Store.EDITABLE)});test("edit state = LOCKED",function(){store.readDataHash(storeKey);
testStateTransition(SC.Store.LOCKED,SC.Store.LOCKED)});test("edit state = EDITABLE",function(){store.readEditableDataHash(storeKey);
testStateTransition(SC.Store.EDITABLE,SC.Store.EDITABLE)});test("calling with array of storeKeys will edit all store keys",function(){var e=[storeKey,SC.Store.generateStoreKey()],d;
store.dataHashDidChange(e,2000);for(d=0;d<e.length;d++){equals(store.revisions[e[d]],2000,"storeKey at index %@ should have new revision".fmt(d));
ok(store.chainedChanges.contains(e[d]),"chainedChanges should include storeKey at index %@".fmt(d))
}});test("marking change should update revision but leave lock alone",function(){parent.dataHashDidChange(storeKey);
store.readDataHash(storeKey);store.dataHashDidChange(storeKey);equals(store.locks[storeKey],parent.revisions[storeKey],"lock should have parent revision");
ok(store.revisions[storeKey]!==parent.revisions[storeKey],"revision should not match parent rev")
});var parent,store,child,storeKey,json,args;module("SC.NestedStore#discardChanges",{setup:function(){parent=SC.Store.create();
json={string:"string",number:23,bool:YES};args=null;storeKey=SC.Store.generateStoreKey();
parent.writeDataHash(storeKey,json,SC.Record.READY_CLEAN);parent.editables=null;store=parent.chain();
child=store.chain();parent.commitChangesFromNestedStore=child.commitChangesFromNestedStore=store.commitChangesFromNestedStore=function(d,e,g){if(!args){args=[]
}args.push({target:this,store:d,changes:e,force:g})}}});function testStateTransition(){equals(store.discardChanges(),store,"should return receiver");
equals(store.storeKeyEditState(storeKey),SC.Store.INHERITED,"data edit state");equals(store.get("hasChanges"),NO,"hasChanges should be NO");
equals(store.readDataHash(storeKey),json,"data hash should return parent hash again");
equals(store.readStatus(storeKey),parent.readStatus(storeKey),"should return record status from parent");
ok(!store.chainedChanges||!store.chainedChanges.length,"should have no chainedChanges queued");
equals(args,null,"should not call commitChangesFromNestedStore")}test("state = INHERITED",function(){equals(store.storeKeyEditState(storeKey),SC.Store.INHERITED,"precond - data edit state");
testStateTransition()});test("state = LOCKED",function(){store.readDataHash(storeKey);
equals(store.storeKeyEditState(storeKey),SC.Store.LOCKED,"precond - data edit state");
testStateTransition()});test("state = EDITABLE",function(){store.writeDataHash(storeKey,json);
store.dataHashDidChange(storeKey);equals(store.storeKeyEditState(storeKey),SC.Store.EDITABLE,"precond - data edit state");
ok(store.chainedChanges&&store.chainedChanges.contains(storeKey),"editable record should be in chainedChanges set");
testStateTransition()});var parent,store,child,storeKey,json;module("SC.NestedStore#readDataHash",{setup:function(){parent=SC.Store.create();
json={string:"string",number:23,bool:YES};storeKey=SC.Store.generateStoreKey();parent.writeDataHash(storeKey,json,SC.Record.READY_CLEAN);
parent.editables=null;store=parent.chain();child=store.chain()}});test("data state=INHERITED, lockOnRead=YES, parent editable=NO",function(){equals(store.get("lockOnRead"),YES,"precond - lockOnRead should be YES");
equals(store.storeKeyEditState(storeKey),SC.Store.INHERITED,"precond - storeKey should be inherited from parent");
var d=store.revisions[storeKey];equals(store.readDataHash(storeKey),json,"should return json");
equals(store.storeKeyEditState(storeKey),SC.Store.LOCKED,"storeKey should be read-locked now");
ok(store.dataHashes.hasOwnProperty(storeKey),"should copy reference to json");equals(store.revisions[storeKey],d,"should not change revision");
if(!SC.none(d)){ok(store.revisions.hasOwnProperty(storeKey),"should copy reference to revision")
}});test("data state=INHERITED, lockOnRead=NO, parent editable=NO",function(){store.set("lockOnRead",NO);
equals(store.get("lockOnRead"),NO,"precond - lockOnRead should be NO");equals(store.storeKeyEditState(storeKey),SC.Store.INHERITED,"precond - storeKey should be inherited from parent");
var d=store.revisions[storeKey];equals(store.readDataHash(storeKey),json,"should return json");
equals(store.storeKeyEditState(storeKey),SC.Store.INHERITED,"storeKey should still be inherited");
ok(!store.dataHashes.hasOwnProperty(storeKey),"should NOT copy reference to json");
equals(store.revisions[storeKey],d,"should not change revision");if(!SC.none(d)){ok(store.revisions.hasOwnProperty(storeKey),"should copy reference to revision")
}});test("data state=INHERITED, lockOnRead=YES, parent editable=YES",function(){parent.readEditableDataHash(storeKey);
equals(parent.storeKeyEditState(storeKey),SC.Store.EDITABLE,"precond - parent storeKey should be editable");
equals(store.get("lockOnRead"),YES,"precond - lockOnRead should be YES");equals(store.storeKeyEditState(storeKey),SC.Store.INHERITED,"precond - storeKey should be inherited from parent");
var e=store.revisions[storeKey];var d=store.readDataHash(storeKey);same(d,json,"should return equivalent json object");
ok(!(d===json),"should return clone of json instance not exact same instance");equals(store.storeKeyEditState(storeKey),SC.Store.EDITABLE,"storeKey should be locked");
ok(store.dataHashes.hasOwnProperty(storeKey),"should have reference to json");equals(store.revisions[storeKey],e,"should not change revision");
if(!SC.none(e)){ok(store.revisions.hasOwnProperty(storeKey),"should copy reference to revision")
}});test("data state=LOCKED",function(){store.set("lockOnRead",YES);var e=store.readDataHash(storeKey);
equals(store.storeKeyEditState(storeKey),SC.Store.LOCKED,"precond - data state should be LOCKED");
var g=store.revisions[storeKey];var d=store.readDataHash(storeKey);equals(e,d,"should read same data hash once locked");
equals(store.storeKeyEditState(storeKey),SC.Store.LOCKED,"should remain in locked state");
equals(store.revisions[storeKey],g,"should not change revision");if(!SC.none(g)){ok(store.revisions.hasOwnProperty(storeKey),"should copy reference to revision")
}});test("data state=EDITABLE",function(){store.set("lockOnRead",YES);var e=store.readEditableDataHash(storeKey);
equals(store.storeKeyEditState(storeKey),SC.Store.EDITABLE,"precond - data state should be EDITABLE");
var g=store.revisions[storeKey];var d=store.readDataHash(storeKey);equals(e,d,"should read same data hash once editable");
equals(store.storeKeyEditState(storeKey),SC.Store.EDITABLE,"should remain in editable state");
equals(store.revisions[storeKey],g,"should not change revision");if(!SC.none(g)){ok(store.revisions.hasOwnProperty(storeKey),"should copy reference to revision")
}});test("should return null when accessing an unknown storeKey",function(){equals(store.readDataHash(20000000),null,"shuld return null for non-existant store key");
equals(store.storeKeyEditState(20000000),SC.Store.LOCKED,"should put into locked edit state")
});test("locking deep nested store when top-level parent is editable and middle store is inherited",function(){json=parent.readEditableDataHash(storeKey);
equals(parent.storeKeyEditState(storeKey),SC.Store.EDITABLE,"parent edit state should be EDITABLE");
equals(store.storeKeyEditState(storeKey),SC.Store.INHERITED,"middle store edit state should be INHERITED");
equals(child.storeKeyEditState(storeKey),SC.Store.INHERITED,"child store edit state should be INHERITED");
var d=child.readDataHash(storeKey);equals(child.storeKeyEditState(storeKey),SC.Store.EDITABLE,"child store edit state should be locked after reading data");
json.newItem="bar";ok(child.readDataHash(storeKey).newItem!=="bar","child json should not pick up edit from parent store since it is now locked")
});var parent,store,storeKey,json;module("SC.NestedStore#readEditableDataHash",{setup:function(){parent=SC.Store.create();
json={string:"string",number:23,bool:YES};storeKey=SC.Store.generateStoreKey();parent.writeDataHash(storeKey,json,SC.Record.READY_CLEAN);
parent.editables=null;store=parent.chain()}});test("data state=INHERITED, parent editable = NO",function(){equals(parent.storeKeyEditState(storeKey),SC.Store.LOCKED,"precond - parent edit state should be LOCKED");
equals(store.storeKeyEditState(storeKey),SC.Store.INHERITED,"precond - edit state should be INHERITED");
var e=store.revisions[storeKey];var d=store.readEditableDataHash(storeKey);same(d,json,"should return equivalent json object");
ok(!(d===json),"should not return same json instance");equals(store.storeKeyEditState(storeKey),SC.Store.EDITABLE,"edit state should be editable");
equals(store.revisions[storeKey],e,"should not change revision");if(!SC.none(e)){ok(store.revisions.hasOwnProperty(storeKey),"should clone revision reference")
}});test("data state=INHERITED, parent editable = YES",function(){parent.readEditableDataHash(storeKey);
equals(parent.storeKeyEditState(storeKey),SC.Store.EDITABLE,"precond - parent edit state should be EDITABLE");
equals(store.storeKeyEditState(storeKey),SC.Store.INHERITED,"precond - edit state should be INHERITED");
var e=store.revisions[storeKey];var d=store.readEditableDataHash(storeKey);same(d,json,"should return equivalent json object");
ok(!(d===json),"should not return same json instance");equals(store.storeKeyEditState(storeKey),SC.Store.EDITABLE,"edit state should be editable");
equals(store.revisions[storeKey],e,"should not change revision");if(!SC.none(e)){ok(store.revisions.hasOwnProperty(storeKey),"should clone revision reference")
}});test("data state=LOCKED",function(){store.readDataHash(storeKey);equals(store.storeKeyEditState(storeKey),SC.Store.LOCKED,"precond - edit state should be LOCKED");
var e=store.revisions[storeKey];var d=store.readEditableDataHash(storeKey);same(d,json,"should return equivalent json object");
ok(!(d===json),"should not return same json instance");equals(store.storeKeyEditState(storeKey),SC.Store.EDITABLE,"edit state should be editable");
equals(store.revisions[storeKey],e,"should not change revision");if(!SC.none(e)){ok(store.revisions.hasOwnProperty(storeKey),"should clone revision reference")
}});test("data state=EDITABLE",function(){json=store.readEditableDataHash(storeKey);
equals(store.storeKeyEditState(storeKey),SC.Store.EDITABLE,"precond - edit state should be EDITABLE");
var e=store.revisions[storeKey];var d=store.readEditableDataHash(storeKey);equals(d,json,"should return same editable json instance");
equals(store.storeKeyEditState(storeKey),SC.Store.EDITABLE,"edit state should be editable");
equals(store.revisions[storeKey],e,"should not change revision");if(!SC.none(e)){ok(store.revisions.hasOwnProperty(storeKey),"should clone revision reference")
}});var parent,store,child,storeKey,json;module("SC.NestedStore#removeDataHash",{setup:function(){parent=SC.Store.create();
json={string:"string",number:23,bool:YES};storeKey=SC.Store.generateStoreKey();parent.writeDataHash(storeKey,json,SC.Record.READY_CLEAN);
parent.editables=null;store=parent.chain();child=store.chain()}});function testRemoveDataHash(){var d=store.revisions[storeKey];
equals(store.removeDataHash(storeKey,SC.Record.DESTROYED_CLEAN),store,"should return receiver");
equals(store.storeKeyEditState(storeKey),SC.Store.LOCKED,"new edit state should be locked");
equals(store.readDataHash(storeKey),null,"should have NO json data");equals(store.readStatus(storeKey),SC.Record.DESTROYED_CLEAN,"should have new status");
equals(store.revisions[storeKey],d,"should not change revision");if(!SC.none(d)){ok(store.revisions.hasOwnProperty(storeKey),"should clone reference to revision")
}}test("edit state=INHERITED",function(){equals(store.storeKeyEditState(storeKey),SC.Store.INHERITED,"precond - edit state should be inherited");
testRemoveDataHash()});test("edit state=LOCKED",function(){store.readDataHash(storeKey);
equals(store.storeKeyEditState(storeKey),SC.Store.LOCKED,"precond - edit state should be locked");
testRemoveDataHash()});test("edit state=EDITABLE",function(){store.readEditableDataHash(storeKey);
equals(store.storeKeyEditState(storeKey),SC.Store.EDITABLE,"precond - edit state should be editable");
testRemoveDataHash()});test("remove a non-existing hash",function(){storeKey=SC.Store.generateStoreKey();
equals(parent.readDataHash(storeKey),null,"precond - parent should not have a data hash for store key yet");
equals(store.storeKeyEditState(storeKey),SC.Store.INHERITED,"precond - edit status should be inherited");
equals(store.removeDataHash(storeKey,SC.Record.DESTROYED_CLEAN),store,"should return receiver");
equals(store.storeKeyEditState(storeKey),SC.Store.LOCKED,"new status should be locked");
equals(store.readDataHash(storeKey),null,"should still be null");equals(store.readStatus(storeKey),SC.Record.DESTROYED_CLEAN,"should have new record status")
});test("change should propogate to child if child edit state = INHERITED",function(){equals(child.storeKeyEditState(storeKey),SC.Store.INHERITED,"precond - child edit state should be INHERITED");
store.removeDataHash(storeKey,SC.Record.DESTROYED_CLEAN);same(child.readDataHash(storeKey),null,"child should pick up change");
equals(parent.readDataHash(storeKey),json,"parent should still have old json");equals(child.readStatus(storeKey),SC.Record.DESTROYED_CLEAN,"child should pick up new status");
equals(parent.readStatus(storeKey),SC.Record.READY_CLEAN,"parent should still have old status")
});function testLockedOrEditableChild(){store.removeDataHash(storeKey,SC.Record.DESTROYED_CLEAN);
same(child.readDataHash(storeKey),json,"child should NOT pick up change");equals(parent.readDataHash(storeKey),json,"parent should still have old json");
equals(child.readStatus(storeKey),SC.Record.READY_CLEAN,"child should pick up new status");
equals(parent.readStatus(storeKey),SC.Record.READY_CLEAN,"parent should still have old status")
}test("change should not propogate to child if child edit state = LOCKED",function(){child.readDataHash(storeKey);
equals(child.storeKeyEditState(storeKey),SC.Store.LOCKED,"precond - child edit state should be LOCKED");
testLockedOrEditableChild()});test("change should not propogate to child if child edit state = EDITABLE",function(){child.readEditableDataHash(storeKey);
equals(child.storeKeyEditState(storeKey),SC.Store.EDITABLE,"precond - child edit state should be EDITABLE");
testLockedOrEditableChild()});var parent,store,child,storeKey,json;module("SC.NestedStore#writeDataHash",{setup:function(){parent=SC.Store.create();
json={string:"string",number:23,bool:YES};storeKey=SC.Store.generateStoreKey();parent.writeDataHash(storeKey,json,SC.Record.READY_CLEAN);
parent.editables=null;store=parent.chain();child=store.chain()}});function testWriteDataHash(){var e=store.revisions[storeKey];
var d={foo:"bar"};equals(store.writeDataHash(storeKey,d,SC.Record.READY_NEW),store,"should return receiver");
equals(store.storeKeyEditState(storeKey),SC.Store.EDITABLE,"new edit state should be editable");
equals(store.readDataHash(storeKey),d,"should have new json data hash");equals(store.readStatus(storeKey),SC.Record.READY_NEW,"should have new status");
equals(store.revisions[storeKey],e,"should not change revision");if(!SC.none(e)){ok(store.revisions.hasOwnProperty(storeKey),"should clone reference to revision")
}}test("edit state=INHERITED",function(){equals(store.storeKeyEditState(storeKey),SC.Store.INHERITED,"precond - edit state should be inherited");
testWriteDataHash()});test("edit state=LOCKED",function(){store.readDataHash(storeKey);
equals(store.storeKeyEditState(storeKey),SC.Store.LOCKED,"precond - edit state should be locked");
testWriteDataHash()});test("edit state=EDITABLE",function(){store.readEditableDataHash(storeKey);
equals(store.storeKeyEditState(storeKey),SC.Store.EDITABLE,"precond - edit state should be editable");
testWriteDataHash()});test("writing a new hash",function(){storeKey=SC.Store.generateStoreKey();
equals(parent.readDataHash(storeKey),null,"precond - parent should not have a data hash for store key yet");
equals(store.storeKeyEditState(storeKey),SC.Store.INHERITED,"precond - edit status should be inherited");
equals(store.writeDataHash(storeKey,json,SC.Record.READY_NEW),store,"should return receiver");
equals(store.storeKeyEditState(storeKey),SC.Store.EDITABLE,"new status should be editable");
equals(store.readDataHash(storeKey),json,"should match new json");equals(store.readStatus(storeKey),SC.Record.READY_NEW,"should have new record status")
});test("change should propogate to child if child edit state = INHERITED",function(){equals(child.storeKeyEditState(storeKey),SC.Store.INHERITED,"precond - child edit state should be INHERITED");
var d={version:2};store.writeDataHash(storeKey,d,SC.Record.READY_NEW);same(child.readDataHash(storeKey),d,"child should pick up change");
equals(parent.readDataHash(storeKey),json,"parent should still have old json");equals(child.readStatus(storeKey),SC.Record.READY_NEW,"child should pick up new status");
equals(parent.readStatus(storeKey),SC.Record.READY_CLEAN,"parent should still have old status")
});function testLockedOrEditableChild(){var d={version:2};store.writeDataHash(storeKey,d,SC.Record.READY_NEW);
same(child.readDataHash(storeKey),json,"child should NOT pick up change");equals(parent.readDataHash(storeKey),json,"parent should still have old json");
equals(child.readStatus(storeKey),SC.Record.READY_CLEAN,"child should pick up new status");
equals(parent.readStatus(storeKey),SC.Record.READY_CLEAN,"parent should still have old status")
}test("change should not propogate to child if child edit state = LOCKED",function(){child.readDataHash(storeKey);
equals(child.storeKeyEditState(storeKey),SC.Store.LOCKED,"precond - child edit state should be LOCKED");
testLockedOrEditableChild()});test("change should not propogate to child if child edit state = EDITABLE",function(){child.readEditableDataHash(storeKey);
equals(child.storeKeyEditState(storeKey),SC.Store.EDITABLE,"precond - child edit state should be EDITABLE");
testLockedOrEditableChild()});var TestRecord=SC.Record.extend();var TestRecord2=SC.Record.extend();
function queryEquals(h,e,l,j,d,k){if(k===undefined&&typeof d==="string"){k=d;d=undefined
}if(!k){k=""}ok(!!h,k+": should have a query");equals(h.get("isFrozen"),YES,k+": should be frozen");
if(h){if(e){equals(h.get("location"),e,k+": should have location")}if(l&&l.isEnumerable){same(h.get("recordTypes"),l,k+": should have recordTypes (plural)")
}else{equals(h.get("recordType"),l,k+": should have recordType (singular)")}equals(h.get("conditions"),j,k+": should have conditions");
if(d){for(var g in d){if(!d.hasOwnProperty(g)){continue}equals(h.get(g),d[g],k+": should have extra key "+g)
}}}}function performBasicTests(d,g){module("SC.Query.%@()".fmt(d),{setup:function(){window.TestRecord=TestRecord;
window.TestRecord2=TestRecord2},teardown:function(){window.TestRecord=window.TestRecord2=null
}});function e(){return SC.Query[d].apply(SC.Query,arguments)}test("basic query with just record type",function(){var j,h,m,l,k;
j=e(TestRecord);queryEquals(j,g,TestRecord,null,"first query");h=e(TestRecord);equals(h,j,"second call should return cached value");
m=e("TestRecord");equals(m,j,"queryFor with string should return cached value");l=e([TestRecord]);
equals(l,j,"queryFor([TestRecord]) should return cached value");k=e(["TestRecord"]);
equals(k,j,'queryFor(["TestRecord"]) with string should return cached value')});test("query with multiple recordtypes",function(){var j=[TestRecord,TestRecord2],h,o,n,l,k,m;
h=e(j);queryEquals(h,g,j,null,"first query");o=e(j);equals(o,h,"second queryFor call should return cached value");
q3=e([TestRecord2,TestRecord]);equals(q3,h,"queryFor with different order of record types should return same cached value");
m=SC.Set.create().add(TestRecord).add(TestRecord2);l=e(m);equals(l,h,"should return cached query even if using an enumerable for types");
k=e("TestRecord TestRecord2".w());equals(k,h,"should return cached query even if string record names are used")
});test("query with record type and conditions",function(){var h,o,n,m,l,k,j;h=e(TestRecord,"foobar");
queryEquals(h,g,TestRecord,"foobar","first query");o=e(TestRecord,"foobar");equals(o,h,"second call to queryFor(TestRecord, foobar) should return cached instance");
n=e(TestRecord2,"foobar");queryEquals(n,g,TestRecord2,"foobar","query(TestRecord2, foobar)");
ok(n!==h,"different recordType same conditions should return new query");m=e(TestRecord,"baz");
queryEquals(m,g,TestRecord,"baz","query(TestRecord2, baz)");ok(m!==h,"different conditions should return new query");
l=e(TestRecord,"baz");equals(l,m,"second call for different conditions should return cache")
});test("query with no record type and with conditions",function(){var h,j;h=e(null,"foobar");
queryEquals(h,g,SC.Record,"foobar","first query");j=e(null,"foobar");equals(j,h,"should return cached value")
});test("query with recordtype, conditions, and parameters hash",function(){var j={opt1:"bar",opt2:"baz"},h,k;
h=e(TestRecord,"foo",j);queryEquals(h,g,TestRecord,"foo",{parameters:j},"first query");
k=e(TestRecord,"foo",j);ok(h!==k,"second call to queryFor with opts cannot be cached");
queryEquals(h,g,TestRecord,"foo",{parameters:j},"second query")});test("query with recordtype, conditions, and parameters array",function(){var j=["foo","bar"],h,k;
h=e(TestRecord,"foo",j);queryEquals(h,g,TestRecord,"foo",{parameters:j},"first query should include parameters prop");
k=e(TestRecord,"foo",j);ok(h!==k,"second call to queryFor with opts cannot be cached");
queryEquals(h,g,TestRecord,"foo",{parameters:j},"second query")});test("passing query object",function(){var h=SC.Query.local(TestRecord),k=SC.Query.remote(TestRecord),j;
j=e(h);if(g===SC.Query.LOCAL){equals(j,h,"invoking with local query should return same query")
}else{ok(j!==h,"invoke with local query should return new instance")}equals(j.get("location"),g,"query should have expected location");
j=e(k);if(g===SC.Query.REMOTE){equals(j,k,"invoking with remote query should return same query")
}else{ok(j!==k,"invoke with remote query should return new instance")}equals(j.get("location"),g,"query should have expected location")
});test("no options (matches everything)",function(){var h,j;h=e();queryEquals(h,g,SC.Record,null,"first query - matches everything");
j=e();equals(j,h,"should return same cached query")})}performBasicTests("local",SC.Query.LOCAL);
performBasicTests("remote",SC.Query.REMOTE);var store,storeKey,rec1,rec2,rec3,rec4,rec5,MyApp,q;
module("SC.Query comparison of records",{setup:function(){SC.RunLoop.begin();MyApp=SC.Object.create({store:SC.Store.create()});
MyApp.Foo=SC.Record.extend({});MyApp.store.loadRecords(MyApp.Foo,[{guid:1,firstName:"John",lastName:"Doe",year:1974},{guid:2,firstName:"Jane",lastName:"Doe",year:1975},{guid:3,firstName:"Emily",lastName:"Parker",year:1975,active:null},{guid:4,firstName:"Johnny",lastName:"Cash",active:false},{guid:5,firstName:"Bert",lastName:"Berthold",active:true}]);
SC.RunLoop.end();rec1=MyApp.store.find(MyApp.Foo,1);rec2=MyApp.store.find(MyApp.Foo,2);
rec3=MyApp.store.find(MyApp.Foo,3);rec4=MyApp.store.find(MyApp.Foo,4);rec5=MyApp.store.find(MyApp.Foo,5);
q=SC.Query.create()}});test("parse() should work with conditions = null",function(){q.parse()
});test("building the order",function(){q.orderBy=null;q.parse();equals(q._order.length,0,"order should be empty");
q.orderBy="";q.parse();equals(q._order.length,0,"order should be empty");q.orderBy="firstName";
q.parse();equals(q._order[0].propertyName,"firstName","propertyName should be firstName");
q.orderBy="lastName, firstName";q.parse();equals(q._order[0].propertyName,"lastName","propertyName should be lastName");
equals(q._order[1].propertyName,"firstName","propertyName should be firstName");q.orderBy="lastName, firstName, year DESC";
q.parse();equals(q._order[0].propertyName,"lastName","propertyName should be lastName");
ok(!q._order[0].descending,"descending should be false");equals(q._order[1].propertyName,"firstName","propertyName should be firstName");
ok(!q._order[1].descending,"descending should be false");equals(q._order[2].propertyName,"year","propertyName should be year");
ok(q._order[2].descending,"descending should be true")});test("no order should result in comparison by guid",function(){q.orderBy=null;
q.parse();equals(q.compare(rec1,rec2),-1,"guid 1 should be before guid 2")});test("comparing non existent properties",function(){q.orderBy="year";
q.parse();equals(q.compare(rec5,rec1),-1,"null should be before 1974")});test("comparing null and boolean properties",function(){q.orderBy="active";
q.parse();equals(q.compare(rec3,rec4),-1,"null should be before false");equals(q.compare(rec4,rec5),-1,"false should be before true")
});test("comparing number properties",function(){q.orderBy="year";q.parse();equals(q.compare(rec1,rec2),-1,"1974 should be before 1975");
q.orderBy="year DESC";q.parse();equals(q.compare(rec1,rec2),1,"1974 should be after 1975 with DESC")
});test("comparing string properties",function(){q.orderBy="firstName";q.parse();
equals(q.compare(rec1,rec2),1,"John should be after Jane");q.orderBy="firstName DESC";
q.parse();equals(q.compare(rec1,rec2),-1,"John should be before Jane with DESC")});
test("comparing by equal properties should use guid for order",function(){q.orderBy="lastName";
q.parse();equals(q.compare(rec1,rec2),-1,"guid 1 should be before guid 2")});test("specifying a custom orderBy comparison function",function(){var d=NO;
q.orderBy=function(g,e){d=YES;return SC.compare(e.get("year"),g.get("year"))};q.parse();
equals(q.compare(rec1,rec2),1,"guid 2 should be before guid 1");equals(d,YES,"we should have used our custom comparison function")
});var store,storeKey,foo1,foo2,bar1,bar2,baz,barChild,MyApp,q;module("SC.Query comparison of records",{setup:function(){SC.RunLoop.begin();
MyApp=SC.Object.create({store:SC.Store.create()});MyApp.Foo=SC.Record.extend();MyApp.Bar=SC.Record.extend();
MyApp.BarChild=MyApp.Bar.extend();MyApp.Baz=SC.Record.extend();MyApp.store.loadRecords(MyApp.Foo,[{guid:1,firstName:"John",lastName:"Doe",year:1974},{guid:2,firstName:"Jane",lastName:"Doe",year:1975}]);
MyApp.store.loadRecords(MyApp.Bar,[{guid:3,firstName:"Emily",lastName:"Parker",year:1975,active:null},{guid:4,firstName:"Johnny",lastName:"Cash",active:false}]);
MyApp.store.loadRecords(MyApp.Baz,[{guid:5,firstName:"Bert",lastName:"Berthold",active:true}]);
MyApp.store.loadRecords(MyApp.BarChild,[{guid:6,firstName:"Bert",lastName:"Ernie",active:true}]);
SC.RunLoop.end();foo1=MyApp.store.find(MyApp.Foo,1);foo2=MyApp.store.find(MyApp.Foo,2);
bar1=MyApp.store.find(MyApp.Bar,3);bar2=MyApp.store.find(MyApp.Bar,4);barChild=MyApp.store.find(MyApp.BarChild,6);
baz=MyApp.store.find(MyApp.Baz,5)},teardown:function(){MyApp=foo1=foo2=bar1=bar2=baz=barChild=q=null
}});test("should only contain records matching recordType or recordTypes",function(){q=SC.Query.create({recordType:MyApp.Foo});
equals(q.contains(foo1),YES,"q with recordType=Foo should contain record of type Foo");
equals(q.contains(bar1),NO,"q with recordType=Foo should NOT contain record of type Bar");
equals(q.contains(barChild),NO,"q with recordType=Foo should NOT contain record of type BarChild");
equals(q.contains(baz),NO,"q with recordType=Foo should NOT contain record of type Baz");
q=SC.Query.create({recordTypes:[MyApp.Foo,MyApp.Bar]});equals(q.contains(foo1),YES,"q with recordTypes=Foo,Bar should contain record of type Foo");
equals(q.contains(bar1),YES,"q with recordTypes=Foo,Bar should contain record of type Bar");
equals(SC.kindOf(barChild,MyApp.Bar),YES,"SC.kindOf(barChild, MyApp.Bar)");equals(q.contains(barChild),YES,"q with recordTypes=Foo,Bar should contain record of type BarChild");
equals(q.contains(baz),NO,"q with recordTypes=Foo,Bar should NOT contain record of type Baz");
q=SC.Query.create();equals(q.contains(foo1),YES,"no recordType should contain record of type Foo");
equals(q.contains(bar1),YES,"no recordType should contain record of type Foo");equals(q.contains(barChild),YES,"no recordType should contain record of type BarChild");
equals(q.contains(baz),YES,"no recordType should contain record of type Foo")});test("should only contain records within parent scope, if one is defined",function(){q=SC.Query.create({scope:SC.Set.create().add(foo1).add(bar1)});
equals(q.contains(foo1),YES,"scope=[foo1,bar1] should return YES for foo1");equals(q.contains(foo2),NO,"scope=[foo1,bar1] should return NO for foo2");
equals(q.contains(bar1),YES,"scope=[bar1] should return YES for bar1");equals(q.contains(bar2),NO,"scope=[foo1,bar1] should return NO for bar2")
});test("should evaluate query against record",function(){q=SC.Query.create({conditions:"firstName = {firstName}",parameters:{firstName:"Bert"}});
equals(q.contains(bar2),NO,"q(firstName=Bert) should return NO for bar[firstName=Johnny]");
equals(q.contains(baz),YES,"q(firstName=Bert) should return YES for baz[firstName=Bert]");
equals(q.contains(barChild),YES,"q(firstName=Bert) should return YES for barChild[firstName=Bert]");
var d={firstName:"Johnny"};equals(q.contains(bar2,d),YES,"q(firstName=Johnny) should return YES for bar[firstName=Johnny]");
equals(q.contains(baz,d),NO,"q(firstName=Johnny) should return NO for baz[firstName=Bert]");
equals(q.contains(barChild,d),NO,"q(firstName=Johnny) should return NO for barChild[firstName=Bert]")
});test("should consider recordType + query conditions",function(){q=SC.Query.create({conditions:"firstName = {firstName}",recordType:MyApp.Bar,parameters:{firstName:"Bert"}});
equals(q.contains(bar1),NO,"should not contain bar1 (wrong firstName)");equals(q.contains(bar2),NO,"should not contain bar2 (wrong firstName)");
equals(q.contains(barChild),YES,"should contain barChild");equals(q.contains(baz),NO,"should contain baz (wrong type)")
});var store,storeKey,rec1,rec2,rec3,rec4,rec5,MyApp,q;module("SC.Query#containsRecordTypes",{setup:function(){MyApp=SC.Object.create();
MyApp.Contact=SC.Record.extend();MyApp.Person=MyApp.Contact.extend();MyApp.Group=SC.Record.extend();
MyApp.Foo=SC.Record.extend()},teardown:function(){MyApp=null}});test("comparing a single record type",function(){var e,d;
d=SC.Query.create({recordType:MyApp.Contact});e=SC.Set.create().add(MyApp.Contact);
equals(d.containsRecordTypes(e),YES,"should return YES when set includes recordType");
e=SC.Set.create().add(MyApp.Person);equals(d.containsRecordTypes(e),YES,"should return YES when set include subclass of recordType");
e=SC.Set.create().add(MyApp.Group);equals(d.containsRecordTypes(e),NO,"should return NO when set include unrelated of recordType");
e=SC.Set.create().add(MyApp.Group).add(MyApp.Contact);equals(d.containsRecordTypes(e),YES,"should return YES when set includes  recordType along with others")
});test("comparing a multiple record type",function(){var e,d;d=SC.Query.create({recordTypes:[MyApp.Contact,MyApp.Group]});
e=SC.Set.create().add(MyApp.Contact);equals(d.containsRecordTypes(e),YES,"should return YES when set includes one of recordTypes");
e=SC.Set.create().add(MyApp.Group);equals(d.containsRecordTypes(e),YES,"should return YES when set includes one of recordTypes");
e=SC.Set.create().add(MyApp.Person);equals(d.containsRecordTypes(e),YES,"should return YES when set include subclass of recordTypes");
e=SC.Set.create().add(MyApp.Group).add(MyApp.Foo);equals(d.containsRecordTypes(e),YES,"should return YES when set includes  recordType along with others")
});test("comparing with no recordType set",function(){var e,d;d=SC.Query.create({});
e=SC.Set.create().add(MyApp.Contact);equals(d.containsRecordTypes(e),YES,"should always return YES");
e=SC.Set.create().add(MyApp.Group);equals(d.containsRecordTypes(e),YES,"should always return YES");
e=SC.Set.create().add(MyApp.Person);equals(d.containsRecordTypes(e),YES,"should always return YES");
e=SC.Set.create().add(MyApp.Group).add(MyApp.Foo);equals(d.containsRecordTypes(e),YES,"should always return YES")
});module("SC.Query#copy");test("basic copy",function(){var e=SC.Query.create({conditions:"foo = bar",parameters:{foo:"bar"},orderBy:"foo",recordType:SC.Record,recordTypes:[SC.Record],location:SC.Query.REMOTE,scope:SC.CoreSet.create()}).freeze();
var d="conditions orderBy recordType recordTypes parameters location scope".w();var g=e.copy();
equals(g.isFrozen,NO,"copy should not be frozen");d.forEach(function(h){equals(g.get(h),e.get(h),"copy.%@ should = original.%@".fmt(h,h))
},this)});var q;module("SC.Query evaluation",{setup:function(){q=SC.Query.create()
}});test("should evaluate all primitives",function(){q.conditions="null";q.parse();
ok(q._tokenTree.evaluate()===null,"null should be null");q.conditions="undefined";
q.parse();ok(q._tokenTree.evaluate()===undefined,"undefined should be undefined");
q.conditions="true";q.parse();ok(q._tokenTree.evaluate()===true,"true should be true");
q.conditions="false";q.parse();ok(q._tokenTree.evaluate()===false,"false should be false");
q.conditions="1";q.parse();ok(q._tokenTree.evaluate()===1,"1 should be 1");q.conditions="1.5";
q.parse();ok(q._tokenTree.evaluate()===1.5,"1.5 should be 1.5");q.conditions="'Hyperion'";
q.parse();ok(q._tokenTree.evaluate()==="Hyperion","'Hyperion' should be 'Hyperion'")
});test("should evaluate all comparators",function(){q.conditions="true = true";q.parse();
ok(q._tokenTree.evaluate()===true,"true = true should be true");q.conditions="true = false";
q.parse();ok(q._tokenTree.evaluate()===false,"true = false should be false");q.conditions="false != true";
q.parse();ok(q._tokenTree.evaluate()===true,"false != true should be true");q.conditions="1 < 1.2";
q.parse();ok(q._tokenTree.evaluate()===true,"1 < 1.2 should be true");q.conditions="1.1 <= 1.2";
q.parse();ok(q._tokenTree.evaluate()===true,"1.1 <= 1.2 should be true");q.conditions="1.2 <= 1.2";
q.parse();ok(q._tokenTree.evaluate()===true,"1.2 <= 1.2 should be true");q.conditions="1.1 > 1.2";
q.parse();ok(q._tokenTree.evaluate()===false,"1.1 > 1.2 should be false");q.conditions="1.3 >= 1.2";
q.parse();ok(q._tokenTree.evaluate()===true,"1.3 >= 1.2 should be true");q.conditions="'Tea pot' BEGINS_WITH 'Tea'";
q.parse();ok(q._tokenTree.evaluate()===true,"'Tea pot' BEGINS_WITH 'Tea' should be true");
q.conditions="'Tea pot' BEGINS_WITH 'Coffee'";q.parse();ok(q._tokenTree.evaluate()===false,"'Tea pot' BEGINS_WITH 'Coffee' should be false");
q.conditions="'Tea pot' ENDS_WITH 'a pot'";q.parse();ok(q._tokenTree.evaluate()===true,"'Tea pot' ENDS_WITH 'a pot' should be true");
q.conditions="'Tea pot' ENDS_WITH 'a cup'";q.parse();ok(q._tokenTree.evaluate()===false,"'Tea pot' ENDS_WITH 'a cup' should be false");
q.conditions="'Tea pot' CONTAINS 'Tea pot'";q.parse();ok(q._tokenTree.evaluate()==true,"'Tea pot' CONTAINS 'Tea pot' should be true");
q.conditions="'Tea pot' CONTAINS 'Tea'";q.parse();ok(q._tokenTree.evaluate()==true,"'Tea pot' CONTAINS 'Tea' should be true");
q.conditions="'Tea pot' CONTAINS 'pot'";q.parse();ok(q._tokenTree.evaluate()==true,"'Tea pot' CONTAINS 'pot' should be true");
q.conditions="'Tea pot' CONTAINS 'a po'";q.parse();ok(q._tokenTree.evaluate()==true,"'Tea pot' CONTAINS 'a po' should be true");
q.conditions="'Tea pot' CONTAINS 'a cup'";q.parse();ok(q._tokenTree.evaluate()==false,"'Tea pot' CONTAINS 'a cup' should be false");
q.conditions="{myTeapot} CONTAINS 'Tea'";q.parse();ok(q._tokenTree.evaluate(null,{myTeapot:["Tea","pot"]})==true,"['Tea', 'pot'] CONTAINS 'Tea' should be true");
q.conditions="{myTeapot} CONTAINS 'pot'";q.parse();ok(q._tokenTree.evaluate(null,{myTeapot:["Tea","pot"]})==true,"['Tea', 'pot'] CONTAINS 'pot' should be true");
q.conditions="{myTeapot} CONTAINS 'coffee'";q.parse();ok(q._tokenTree.evaluate(null,{myTeapot:["Tea","pot"]})==false,"['Tea', 'pot'] CONTAINS 'coffee' should be false");
q.conditions="'Tea pot' MATCHES {myCup}";q.parse();ok(q._tokenTree.evaluate(null,{myCup:/a\sp/})===true,"'Tea pot' MATCHES /asp/ should be true");
q.conditions="'Tea pot' MATCHES {myCup}";q.parse();ok(q._tokenTree.evaluate(null,{myCup:(/ap/)})===false,"'Tea pot' MATCHES /ap/ should be false");
q.conditions="'Veterano' ANY {drinks}";q.parse();ok(q._tokenTree.evaluate(null,{drinks:["Tempranillo","Bacardi","Veterano"]})===true,"'Veterano' should be in ['Tempranillo','Bacardi','Veterano']");
q.conditions="'Veterano' ANY {drinks}";q.parse();ok(q._tokenTree.evaluate(null,{drinks:["soda","water"]})===false,"'Veterano' should not be in ['soda','water']")
});test("boolean operators should work",function(){q.conditions="1=1 AND 1=1";q.parse();
ok(q._tokenTree.evaluate()===true,"true AND true should be true");q.conditions="1=1 AND 1=2";
q.parse();ok(q._tokenTree.evaluate()===false,"true AND false should be false");q.conditions="1=1 OR 1=1";
q.parse();ok(q._tokenTree.evaluate()===true,"true OR true should be true");q.conditions="1=2 OR 1=2";
q.parse();ok(q._tokenTree.evaluate()===false,"false OR false should be false");q.conditions="NOT 1=1";
q.parse();ok(q._tokenTree.evaluate()===false,"NOT true should be false")});var store,storeKey,rec1,rec2,rec3,rec4,rec5,MyApp,q;
module("SC.Query evaluation of records",{setup:function(){SC.RunLoop.begin();MyApp=SC.Object.create({store:SC.Store.create()});
MyApp.Foo=SC.Record.extend({});MyApp.store.loadRecords(MyApp.Foo,[{guid:1,firstName:"John",lastName:"Doe",married:true},{guid:2,firstName:"Jane",lastName:"Doe",married:false},{guid:3,firstName:"Emily",lastName:"Parker",bornIn:1975,married:true},{guid:4,firstName:"Johnny",lastName:"Cash",married:true},{guid:5,firstName:"Bert",lastName:"Berthold",married:true}]);
rec1=MyApp.store.find(MyApp.Foo,1);rec2=MyApp.store.find(MyApp.Foo,2);rec3=MyApp.store.find(MyApp.Foo,3);
rec4=MyApp.store.find(MyApp.Foo,4);rec5=MyApp.store.find(MyApp.Foo,5);SC.RunLoop.end();
q=SC.Query.create()}});test("should get record properties correctly",function(){q.conditions="firstName = 'John'";
q.parse();equals(q.contains(rec1),true,'John should match: firstName = "John"');equals(q.contains(rec2),false,'Jane should not match: firstName = "John"');
q.conditions="lastName BEGINS_WITH firstName";q.parse();equals(q.contains(rec5),true,"Bert Berthold should match: lastName BEGINS_WITH firstName");
equals(q.contains(rec2),false,"Jane Doe should not match: lastName BEGINS_WITH firstName");
q.conditions="lastName CONTAINS firstName";q.parse();equals(q.contains(rec5),true,"Bert Berthold should match: lastName CONTAINS firstName");
equals(q.contains(rec2),false,"Jane Doe should not match: lastName CONTAINS firstName")
});test("should handle undefined record properties correctly",function(){q.conditions="bornIn = 1975";
q.parse();equals(q.contains(rec3),true,"record with bornIn set should match");equals(q.contains(rec2),false,"record without bornIn set should not match");
q.conditions="bornIn = undefined";q.parse();equals(q.contains(rec3),false,"record with bornIn set different to null should not match");
equals(q.contains(rec2),true,"record without bornIn set should match")});test("should handle boolean correctly",function(){q.conditions="married = true";
q.parse();equals(q.contains(rec1),true,"record with married set should match");equals(q.contains(rec2),false,"record without married set should not match")
});var store,storeKey,rec1,rec2,rec3,rec4,rec5,MyApp,q;module("SC.Query#containsRecordTypes",{setup:function(){MyApp=SC.Object.create();
MyApp.Contact=SC.Record.extend();MyApp.Person=MyApp.Contact.extend();MyApp.Group=SC.Record.extend();
MyApp.Foo=SC.Record.extend()},teardown:function(){MyApp=null;SC.Record.subclasses=SC.Set.create()
}});test("single recordType with no subclasses",function(){var e=SC.Query.local(MyApp.Foo),d=SC.CoreSet.create().add(MyApp.Foo);
same(e.get("expandedRecordTypes"),d,"should have only MyApp.Foo")});test("multiple recordTypes with no subclasses",function(){var e=SC.Query.local([MyApp.Foo,MyApp.Group]),d=SC.CoreSet.create().add(MyApp.Foo).add(MyApp.Group);
same(e.get("expandedRecordTypes"),d,"should have MyApp.Foo, MyApp.Group")});test("base SC.Record",function(){var e=SC.Query.local(),d=SC.CoreSet.create().addEach([SC.Record,MyApp.Foo,MyApp.Group,MyApp.Contact,MyApp.Person]);
same(e.get("expandedRecordTypes"),d,"should have all defined types")});test("type with subclass",function(){var e=SC.Query.local(MyApp.Contact),d=SC.CoreSet.create().addEach([MyApp.Contact,MyApp.Person]);
same(e.get("expandedRecordTypes"),d,"should have all Contact and Person")});test("adding new type should invalidate property",function(){var g=SC.Query.local(MyApp.Contact),e=SC.CoreSet.create().addEach([MyApp.Contact,MyApp.Person]);
same(g.get("expandedRecordTypes"),e,"precond - should have all Contact and Person");
var d=MyApp.Person.extend();e.add(d);same(g.get("expandedRecordTypes"),e,"should have all Contact, Person, and Bar")
});var q;module("SC.Query parsing",{setup:function(){q=SC.Query.create()}});test("should recognize all primitives",function(){q.conditions="what_to_do_now";
q.parse();ok(q._tokenList.length==1,"list should have one token");equals(q._tokenList[0].tokenType,"PROPERTY","type should be PROPERTY");
equals(q._tokenList[0].tokenValue,"what_to_do_now","value should be what_to_do_now");
q.conditions="a";q.parse();ok(q._tokenList.length==1,"list should have one token");
equals(q._tokenList[0].tokenType,"PROPERTY","type should be PROPERTY");equals(q._tokenList[0].tokenValue,"a",'value should be "a"');
q.conditions="false";q.parse();ok(q._tokenList.length==1,"list should have one token");
equals(q._tokenList[0].tokenType,"false","type should be false");equals(q._tokenList[0].tokenValue,"false","value should be false");
q.conditions="true";q.parse();ok(q._tokenList.length==1,"list should have one token");
equals(q._tokenList[0].tokenType,"true","type should be true");equals(q._tokenList[0].tokenValue,"true","value should be true");
q.conditions="null";q.parse();ok(q._tokenList.length==1,"list should have 2 tokens");
equals(q._tokenList[0].tokenType,"null","type should be null");q.conditions="undefined";
q.parse();ok(q._tokenList.length==1,"list should have 2 tokens");equals(q._tokenList[0].tokenType,"undefined","type should be undefined");
q.conditions="1234";q.parse();ok(q._tokenList.length==1,"list should have one token");
equals(q._tokenList[0].tokenType,"NUMBER","type should be NUMBER");equals(q._tokenList[0].tokenValue,1234,"value should be 1234");
q.conditions="12.34";q.parse();ok(q._tokenList.length==1,"list should have one token");
equals(q._tokenList[0].tokenType,"NUMBER","type should be NUMBER");equals(q._tokenList[0].tokenValue,12.34,"value should be 12.34");
q.conditions="-1";q.parse();ok(q._tokenList.length==1,"list should have one token");
equals(q._tokenList[0].tokenType,"NUMBER","type should be NUMBER");equals(q._tokenList[0].tokenValue,-1,"value should be -1");
q.conditions="-1.234";q.parse();ok(q._tokenList.length==1,"list should have one token");
equals(q._tokenList[0].tokenType,"NUMBER","type should be NUMBER");equals(q._tokenList[0].tokenValue,-1.234,"value should be -1.234");
q.conditions="'ultravisitor'";q.parse();ok(q._tokenList.length==1,"list should have one token");
equals(q._tokenList[0].tokenType,"STRING","type should be STRING");equals(q._tokenList[0].tokenValue,"ultravisitor","value should be ultravisitor");
q.conditions='"Feed me weird things"';q.parse();ok(q._tokenList.length==1,"list should have one token");
equals(q._tokenList[0].tokenType,"STRING","type should be STRING");equals(q._tokenList[0].tokenValue,"Feed me weird things","value should be Feed me weird things");
q.conditions="''";q.parse();ok(q._tokenList.length==1,"list should have one token");
equals(q._tokenList[0].tokenType,"STRING","type should be STRING");equals(q._tokenList[0].tokenValue,"",'value should be ""');
q.conditions="{my_best_friends}";q.parse();ok(q._tokenList.length==1,"list should have one token");
equals(q._tokenList[0].tokenType,"PARAMETER","type should be PARAMETER");equals(q._tokenList[0].tokenValue,"my_best_friends","value should be my_best_friends");
q.conditions="%@";q.parse();ok(q._tokenList.length==1,"list should have one token");
equals(q._tokenList[0].tokenType,"%@","type should be %@");equals(q._tokenList[0].tokenValue,0,"value should be 0");
q.conditions="()";try{q.parse()}catch(g){}ok(q._tokenList.length==2,"list should have two tokens");
equals(q._tokenList[0].tokenType,"OPEN_PAREN","type should be OPEN_PAREN");equals(q._tokenList[1].tokenType,"CLOSE_PAREN","type should be CLOSE_PAREN");
q.conditions="= != < <= > >= BEGINS_WITH ENDS_WITH CONTAINS ANY MATCHES TYPE_IS";
try{q.parse()}catch(h){}equals(q._tokenList.length,12,"q._tokenList.length");equals(q._tokenList[0].tokenType,"=","type should be =");
equals(q._tokenList[0].tokenValue,"=","value should be =");equals(q._tokenList[1].tokenType,"!=","type should be !=");
equals(q._tokenList[1].tokenValue,"!=","value should be !=");equals(q._tokenList[2].tokenType,"<","type should be <");
equals(q._tokenList[2].tokenValue,"<","value should be <");equals(q._tokenList[3].tokenType,"<=","type should be <=");
equals(q._tokenList[3].tokenValue,"<=","value should be <=");equals(q._tokenList[4].tokenType,">","type should be >");
equals(q._tokenList[4].tokenValue,">","value should be >");equals(q._tokenList[5].tokenType,">=","type should be >=");
equals(q._tokenList[5].tokenValue,">=","value should be >=");equals(q._tokenList[6].tokenType,"BEGINS_WITH","type should be BEGINS_WITH");
equals(q._tokenList[6].tokenValue,"BEGINS_WITH","value should be BEGINS_WITH");equals(q._tokenList[7].tokenType,"ENDS_WITH","type should be ENDS_WITH");
equals(q._tokenList[7].tokenValue,"ENDS_WITH","value should be ENDS_WITH");equals(q._tokenList[8].tokenType,"CONTAINS","type should be CONTAINS");
equals(q._tokenList[8].tokenValue,"CONTAINS","value should be CONTAINS");equals(q._tokenList[9].tokenType,"ANY","type should be ANY");
equals(q._tokenList[9].tokenValue,"ANY","value should be ANY");equals(q._tokenList[10].tokenType,"MATCHES","type should be MATCHES");
equals(q._tokenList[10].tokenValue,"MATCHES","value should be MATCHES");equals(q._tokenList[11].tokenType,"TYPE_IS","type should be TYPE_IS");
equals(q._tokenList[11].tokenValue,"TYPE_IS","value should be TYPE_IS");q.conditions="AND OR NOT";
try{q.parse()}catch(d){}ok(q._tokenList.length==3,"list should have 3 tokens");equals(q._tokenList[0].tokenType,"AND","type should be AND");
equals(q._tokenList[0].tokenValue,"AND","value should be AND");equals(q._tokenList[1].tokenType,"OR","type should be OR");
equals(q._tokenList[1].tokenValue,"OR","value should be OR");equals(q._tokenList[2].tokenType,"NOT","type should be NOT");
equals(q._tokenList[2].tokenValue,"NOT","value should be NOT")});test("token tree should build",function(){q.conditions="(firstName MATCHES {firstName} OR lastName BEGINS_WITH 'Lone') AND is_a_beauty = true";
q.parse();ok(q._tokenList.length==13,"list should have 13 tokens");ok(!q._tokenTree.error,"there should be no errors");
ok(q._tokenTree.tokenValue=="AND","tree root shoud be AND")});var q,scope1,scope2;
module("SC.Query#queryWithScope",{setup:function(){q=SC.Query.create({conditions:"foo = bar",parameters:{foo:"bar"},orderBy:"foo",recordType:SC.Record,recordTypes:[SC.Record],location:SC.Query.REMOTE}).freeze();
scope1=SC.CoreSet.create();scope2=SC.CoreSet.create()},teardown:function(){q=scope1=scope2=null
}});function verifyCopy(g,d){var e="conditions orderBy recordType recordTypes parameters location".w();
e.forEach(function(h){equals(g.get(h),d.get(h),"copy.%@ should equal original.%@".fmt(h,h))
})}test("getting into scope first time",function(){var e=q.queryWithScope(scope1);
verifyCopy(e,q);equals(e.get("scope"),scope1,"new query should have scope1");var d=q.queryWithScope(scope1);
equals(d,e,"calling again with same scope should return same instance")});test("chained scope",function(){var g=q.queryWithScope(scope1);
var e=g.queryWithScope(scope2);verifyCopy(e,g);equals(e.get("scope"),scope2,"new query should have scope2");
var d=g.queryWithScope(scope2);equals(d,e,"calling again with same scope should return same instance")
});var rec,q;module("SC.Query comparison of record types",{setup:function(){window.MyApp=SC.Object.create({store:SC.Store.create()});
window.MyApp.Foo=SC.Record.extend({});window.MyApp.store.loadRecords(window.MyApp.Foo,[{guid:1,firstName:"John",lastName:"Doe"}]);
rec=window.MyApp.store.find(window.MyApp.Foo,1);q=SC.Query.create()}});test("should handle record types",function(){q.conditions="TYPE_IS 'MyApp.Foo'";
q.parse();equals(SC.Store.recordTypeFor(rec.storeKey),SC.objectForPropertyPath("MyApp.Foo"),"record type should be MyApp.Foo");
ok(q.contains(rec),"record with proper type should match");q.conditions="TYPE_IS 'MyApp.Baz'";
q.parse();ok(!q.contains(rec),"record with wrong type should not match")});var store,storeKey,rec1,rec2,rec3,rec4,rec5,MyApp,q;
module("SC.Query comparison of records",{setup:function(){MyApp=SC.Object.create({store:SC.Store.create()});
MyApp.Foo=SC.Record.extend({});MyApp.store.loadRecords(MyApp.Foo,[{guid:1,firstName:"John",lastName:"Doe",year:1974},{guid:2,firstName:"Jane",lastName:"Doe",year:1975},{guid:3,firstName:"Emily",lastName:"Parker",year:1975,active:null},{guid:4,firstName:"Johnny",lastName:"Cash",active:false},{guid:5,firstName:"Bert",lastName:"Berthold",active:true}]);
rec1=MyApp.store.find(MyApp.Foo,1);rec2=MyApp.store.find(MyApp.Foo,2);rec3=MyApp.store.find(MyApp.Foo,3);
rec4=MyApp.store.find(MyApp.Foo,4);rec5=MyApp.store.find(MyApp.Foo,5);q=SC.Query.create()
},teardown:function(){delete SC.Query.comparisons.firstName}});test("SC.Query.comparisons",function(){SC.Query.registerComparison("firstName",function(e,d){if(e.length<d.length){return -1
}if(e.length>d.length){return 1}return 0});ok(SC.Query.comparisons.firstName,"comparison for firstName should be set");
q.orderBy="firstName";q.parse();equals(q.compare(rec2,rec3),-1,"firstName should be compared by registered comparison");
q.orderBy="lastName";q.parse();equals(q.compare(rec2,rec3),-1,"lastName should be compared by SC.compare()")
});var store,storeKey,rec1,rec2,rec3,rec4,rec5,MyApp,q;module("SC.Query registered query extensions",{setup:function(){MyApp=SC.Object.create({store:SC.Store.create()});
MyApp.Foo=SC.Record.extend({});MyApp.store.loadRecords(MyApp.Foo,[{guid:1,firstName:"John",lastName:"Doe",year:1974},{guid:2,firstName:"Jane",lastName:"Doe",year:1975},{guid:3,firstName:"Emily",lastName:"Parker",year:1975,active:null},{guid:4,firstName:"Johnny",lastName:"Cash",active:false},{guid:5,firstName:"Bert",lastName:"Jules",active:true}]);
rec1=MyApp.store.find(MyApp.Foo,1);rec2=MyApp.store.find(MyApp.Foo,2);rec3=MyApp.store.find(MyApp.Foo,3);
rec4=MyApp.store.find(MyApp.Foo,4);rec5=MyApp.store.find(MyApp.Foo,5);q=SC.Query.create()
}});test("SC.Query.queryExtensions",function(){SC.Query.registerQueryExtension("STARTS_WITH_J",{reservedWord:true,leftType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(e,d){var g=this.leftSide.evaluate(e,d);
return(g.substr(0,1)=="J")}});ok(q.queryLanguage.STARTS_WITH_J,"extension STARTS_WITH_J should be set");
q.conditions="firstName STARTS_WITH_J";q.parse();ok(q.contains(rec2),"Jane should match");
ok(!q.contains(rec3),"Emily should not match");q.conditions="firstName STARTS_WITH_J OR lastName STARTS_WITH_J";
q.parse();ok(q.contains(rec2),"Jane Doe should match");ok(q.contains(rec5),"Bert Jules should match")
});var store,storeKey,json,rec,storeKeys,recs;module("SC.RecordArray core methods",{setup:function(){store=SC.Store.create();
storeKey=SC.Record.storeKeyFor("foo");json={guid:"foo",foo:"bar"};store.writeDataHash(storeKey,json,SC.Record.READY_CLEAN);
rec=store.materializeRecord(storeKey);equals(rec.get("foo"),"bar","record should have json");
storeKeys=[storeKey];recs=SC.RecordArray.create({store:store,storeKeys:storeKeys})
}});test("initial status",function(){equals(recs.get("status"),SC.Record.EMPTY,"status should be SC.Record.EMPTY")
});test("should pass through length",function(){equals(recs.get("length"),storeKeys.length,"rec should pass through length")
});test("changing storeKeys length should change length of rec array also",function(){var d=recs.get("length");
storeKeys.pushObject(SC.Store.generateStoreKey());ok(storeKeys.length>d,"precond - storeKeys.length should have changed");
equals(recs.get("length"),storeKeys.length,"rec should pass through length")});test("should materialize record for object",function(){equals(storeKeys[0],storeKey,"precond - storeKeys[0] should be storeKey");
equals(recs.objectAt(0),rec,"recs.objectAt(0) should materialize record")});test("reading past end of array length should return undefined",function(){equals(recs.objectAt(2000),undefined,"recs.objectAt(2000) should be undeinfed")
});test("modifying the underlying storeKey should change the returned materialized record",function(){equals(recs.objectAt(0),rec,"recs.objectAt(0) should materialize record");
SC.RunLoop.begin();var e=store.createRecord(SC.Record,{foo:"rec2"});SC.RunLoop.end();
var d=e.get("storeKey");storeKeys.unshiftObject(d);equals(recs.get("length"),2,"should now have length of 2");
equals(recs.objectAt(0),e,"objectAt(0) should return new record");equals(recs.objectAt(1),rec,"objectAt(1) should return old record")
});test("reading a record not loaded in store should trigger retrieveRecord",function(){var d=0;
store.removeDataHash(storeKey,SC.Record.EMPTY);store.retrieveRecord=function(){d++
};equals(store.peekStatus(storeKeys.objectAt(0)),SC.Record.EMPTY,"precond - storeKey must not be loaded");
var e=recs.objectAt(0);equals(d,1,"store.retrieveRecord() should have been called")
});test("adding a record to the record array should pass through storeKeys",function(){equals(recs.objectAt(0),rec,"recs.objectAt(0) should materialize record");
SC.RunLoop.begin();var e=store.createRecord(SC.Record,{foo:"rec2"});SC.RunLoop.end();
var d=e.get("storeKey");recs.unshiftObject(e);equals(recs.get("length"),2,"should now have length of 2");
equals(recs.objectAt(0),e,"recs.objectAt(0) should return new record");equals(recs.objectAt(1),rec,"recs.objectAt(1) should return old record");
equals(storeKeys.objectAt(0),d,"storeKeys[0] should return new storeKey");equals(storeKeys.objectAt(1),storeKey,"storeKeys[1] should return old storeKey")
});test("changing the underlying storeKeys should notify observers of records",function(){var d=SC.Object.create({cnt:0,observer:function(){this.cnt++
}});recs.addObserver("[]",d,d.observer);storeKeys.pushObject(SC.Store.generateStoreKey());
equals(d.cnt,1,"observer should have fired after changing storeKeys")});test("swapping storeKey array should change recordArray and observers",function(){SC.RunLoop.begin();
var g=store.createRecord(SC.Record,{foo:"rec2"});SC.RunLoop.end();var e=g.get("storeKey");
var d=[e];var h=SC.Object.create({cnt:0,observer:function(){this.cnt++}});recs.addObserver("[]",h,h.observer);
equals(recs.objectAt(0),rec,"recs.objectAt(0) should materialize record");h.cnt=0;
recs.set("storeKeys",d);equals(h.cnt,1,"observer should have fired after swap");equals(recs.objectAt(0),g,"recs.objectAt(0) should return new rec");
h.cnt=0;d.unshiftObject(storeKey);equals(h.cnt,1,"observer should have fired after edit");
equals(recs.get("length"),2,"should reflect new length");equals(recs.objectAt(0),rec,"recs.objectAt(0) should return pushed rec")
});var store,Application;module("SC.RecordArray Error Methods",{setup:function(){Application={};
Application.Thing=SC.Record.extend({name:SC.Record.attr(String)});SC.RunLoop.begin();
store=SC.Store.create();var d=[{guid:1,name:"Thing One"},{guid:2,name:"Thing Two"}];
var e=[Application.Thing,Application.Thing];store.loadRecords(e,d);SC.RunLoop.end()
},teardown:function(){store=null;Application=null}});test("Verify error methods behave correctly",function(){var d=SC.Query.local(Application.Thing);
var e=store.find(d);SC.RunLoop.begin();e.set("status",SC.Record.BUSY_LOADING);store.dataSourceDidErrorQuery(d,SC.Record.GENERIC_ERROR);
SC.RunLoop.end();ok(e.get("isError"),"isError on things array should be YES");equals(e.get("errorObject"),SC.Record.GENERIC_ERROR,"get('errorObject') on things array should return the correct error object")
});var store,storeKey,json,rec,storeKeys,recs,query;module("SC.RecordArray core methods",{setup:function(){store=SC.Store.create();
storeKey=SC.Record.storeKeyFor("foo");json={guid:"foo",foo:"foo"};store.writeDataHash(storeKey,json,SC.Record.READY_CLEAN);
rec=store.materializeRecord(storeKey);equals(rec.get("foo"),"foo","record should have json");
query=SC.Query.create({recordType:SC.Record});recs=SC.RecordArray.create({store:store,query:query})
}});test("should not initially populate storeKeys array until we flush()",function(){equals(recs.get("storeKeys"),null,"should not have storeKeys yet");
recs.flush();var d=recs.get("storeKeys");same(d,[storeKey],"after flush should have initial set of storeKeys")
});test("length property should flush",function(){equals(recs.get("storeKeys"),null," should not have storeKeys yet");
equals(recs.get("length"),1,"should have length 1 when called");same(recs.get("storeKeys"),[storeKey],"after flush should have initial set of storeKeys")
});test("objectAt() should flush",function(){equals(recs.get("storeKeys"),null," should not have storeKeys yet");
equals(recs.objectAt(0),rec,"objectAt(0) should return record");same(recs.get("storeKeys"),[storeKey],"after flush should have initial set of storeKeys")
});test("calling storeDidChangeStoreKeys() with a matching recordType",function(){recs.flush();
var d=recs.get("storeKeys").copy();storeKey=SC.Record.storeKeyFor("bar");json={guid:"bar",foo:"bar"};
store.writeDataHash(storeKey,json,SC.Record.READY_CLEAN);equals(recs.get("needsFlush"),NO,"PRECOND - should not need flush");
recs.storeDidChangeStoreKeys([storeKey],SC.Set.create().add(SC.Record));equals(recs.get("needsFlush"),YES,"needs flush now");
same(recs.get("storeKeys"),d,"storeKeys should not have changed yet");recs.flush();
d.unshift(storeKey);equals(recs.get("needsFlush"),NO,"should not need flush anymore");
same(recs.get("storeKeys"),d,"storeKeys should now be updated - rec1[%@]{%@} = %@, rec2[%@]{%@} = %@".fmt(rec.get("id"),rec.get("storeKey"),rec,store.materializeRecord(storeKey).get("id"),storeKey,store.materializeRecord(storeKey)))
});test("calling storeDidChangeStoreKeys() with a non-mathcing recordType",function(){var e=SC.Record.extend(),d=SC.Record.extend();
storeKey=e.storeKeyFor("foo2");json={guid:"foo2"};store.writeDataHash(storeKey,json,SC.Record.READY_CLEAN);
query=SC.Query.create({recordType:e});recs=SC.RecordArray.create({store:store,query:query});
recs.flush();equals(recs.get("length"),1,"should have a Foo record");storeKey=d.storeKeyFor("bar");
json={guid:"bar"};store.writeDataHash(storeKey,json,SC.Record.READY_CLEAN);recs.storeDidChangeStoreKeys([storeKey],SC.Set.create().add(d));
equals(recs.get("needsFlush"),NO,"should not have indicated it needed a flush")});
test("calling storeDidChangeStoreKeys() to remove a record",function(){equals(recs.get("length"),1,"PRECOND - should have storeKey");
store.writeStatus(storeKey,SC.Record.DESTROYED_CLEAN);recs.storeDidChangeStoreKeys([storeKey],SC.Set.create().add(SC.Record));
equals(recs.get("needsFlush"),YES,"should need flush after change");equals(recs.get("storeKeys").length,1,"should still have storeKey");
equals(recs.get("length"),0,"should remove storeKey on flush()")});var json2,foo,bar;
module("SC.RecordArray core methods",{setup:function(){store=SC.Store.create();storeKey=SC.Record.storeKeyFor("foo");
json={guid:"foo",name:"foo"};store.writeDataHash(storeKey,json,SC.Record.READY_CLEAN);
foo=store.materializeRecord(storeKey);equals(foo.get("name"),"foo","record should have json");
storeKey=SC.Record.storeKeyFor("bar");json2={guid:"bar",name:"bar"};store.writeDataHash(storeKey,json2,SC.Record.READY_CLEAN);
bar=store.materializeRecord(storeKey);equals(bar.get("name"),"bar","record should have json");
query=SC.Query.create({recordType:SC.Record,orderBy:"name"});recs=store.find(query)
}});test("local query should notify changes",function(){same(recs.mapProperty("id"),["bar","foo"],"PRECOND - bar should appear before foo");
SC.stopIt=YES;SC.RunLoop.begin();bar.set("name","zzbar");SC.RunLoop.end();same(recs.mapProperty("id"),["foo","bar"],"order of records should change")
});var store,storeKey1,storeKey2;var json1,json2;var storeKey6,storeKey7;module("SC.Store#cancelRecord",{setup:function(){store=SC.Store.create();
json1={guid:"cancelGUID1",string:"string",number:23,bool:YES};json2={guid:"cancelGUID2",string:"string",number:23,bool:YES};
storeKey1=SC.Store.generateStoreKey();store.writeDataHash(storeKey1,json1,SC.Record.EMPTY);
storeKey2=SC.Store.generateStoreKey();store.writeDataHash(storeKey2,json2,SC.Record.READY_NEW)
}});test("Check for error state handling and make sure that the method executes.",function(){var e=false;
try{store.cancelRecord(undefined,undefined,storeKey1);e=false}catch(d){e=true}ok(e,"cancelRecord should throw and error if the record status is EMPTY or ERROR");
try{store.cancelRecord(undefined,undefined,storeKey2);e=true}catch(d){e=false}ok(e," cancelRecord was succesfully executed.")
});var store,child,storeKey,json;module("SC.Store#commitChangesFromNestedStore",{setup:function(){store=SC.Store.create();
json={string:"string",number:23,bool:YES};storeKey=SC.Store.generateStoreKey();child=store.chain();
child.writeDataHash(storeKey,json,SC.Record.READY_DIRTY);child.dataHashDidChange(storeKey);
child.changelog=SC.Set.create();child.changelog.add(storeKey)}});test("copies changed data hashes, statuses, and revisions",function(){SC.RunLoop.begin();
equals(store.readDataHash(storeKey),null,"precond - should not have data yet");ok(child.chainedChanges.contains(storeKey),"precond - child changes should include storeKey");
equals(store.commitChangesFromNestedStore(child,child.chainedChanges,NO),store,"should return receiver");
equals(store.readDataHash(storeKey),json,"now should have json");equals(store.readStatus(storeKey),SC.Record.READY_DIRTY,"now should have status");
equals(store.revisions[storeKey],child.revisions[storeKey],"now shoulave have revision from child");
SC.RunLoop.end()});test("adds items in changelog to reciever changelog",function(){var d=SC.Store.generateStoreKey();
SC.RunLoop.begin();store.changelog=SC.Set.create();store.changelog.add(d);ok(child.changelog.contains(storeKey),"precond - child.changelog should contain store key");
equals(store.commitChangesFromNestedStore(child,child.chainedChanges,NO),store,"should return receiver");
ok(store.changelog.contains(d),"changelog should still contain key1");ok(store.changelog.contains(storeKey),"changelog should also contain storeKey");
SC.RunLoop.end()});test("ignores changed data hashes not passed in changes set",function(){equals(store.readDataHash(storeKey),null,"precond - should not have data yet");
equals(store.commitChangesFromNestedStore(child,SC.Set.create(),NO),store,"should return receiver");
equals(store.readDataHash(storeKey),null,"should not copy data hash for storeKey")
});function createConflict(h){var g={kind:"json2"};var d={kind:"json3"};storeKey=SC.Store.generateStoreKey();
store.writeDataHash(storeKey,json,SC.Record.READY_CLEAN);store.dataHashDidChange(storeKey);
child.readDataHash(storeKey);ok(child.locks[storeKey],"child store should now have lock");
store.writeDataHash(storeKey,g,SC.Record.READY_CLEAN);store.dataHashDidChange(storeKey);
child.writeDataHash(storeKey,d,SC.Record.READY_DIRTY);child.dataHashDidChange(storeKey);
ok(child.locks[storeKey]!==store.revisions[storeKey],"child.lock (%@) should !== store.revision (%@)".fmt(child.locks[storeKey],store.revisions[storeKey]));
var k=0;try{child.commitChanges(h)}catch(j){equals(j,SC.Store.CHAIN_CONFLICT_ERROR,"should throw CHAIN_CONFLICT_ERROR");
k++}return k}test("throws exception if any record fails optimistic locking test",function(){var d=createConflict(NO);
equals(d,1,"should have raised error")});test("does not throw exception if optimistic locking fails but force option is passed",function(){var d=createConflict(YES);
equals(d,0,"should not raise error")});var store,storeKey1,storeKey2,storeKey3,storeKey4,storeKey5,storeKey6;
var storeKey7,json,json1,json2,json3,json4,json5,json6,json7;var ds;module("SC.Store#commitRecord",{setup:function(){ds=SC.DataSource.create({callCount:0,commitRecords:function(e,h,g,d,j){this.toCreate=h;
this.toUpdate=g;this.toDestroy=d;this.params=j;this.callCount++},reset:function(){this.toCreate=this.toUpdate=this.toDestroy=this.params=null;
this.callCount=0},expect:function(h,g,e,d,j){if(h!==undefined){equals(this.callCount,h,"expect datasource.commitRecords to be called X times")
}if(g!==undefined){same(this.toCreate,g,"expect toCreate to have items")}if(e!==undefined){same(this.toUpdate,e,"expect toUpdate to have items")
}if(d!==undefined){same(this.toDestroy,d,"expect toDestroy to have items")}if(j!==undefined){same(this.params,j,"expect params to have items")
}}});store=SC.Store.create().from(ds);json1={guid:"commitGUID1",string:"string",number:23,bool:YES};
json2={guid:"commitGUID2",string:"string",number:23,bool:YES};json3={guid:"commitGUID3",string:"string",number:23,bool:YES};
json4={guid:"commitGUID4",string:"string",number:23,bool:YES};json5={guid:"commitGUID5",string:"string",number:23,bool:YES};
json6={guid:"commitGUID6",string:"string",number:23,bool:YES};json7={guid:"commitGUID7",string:"string",number:23,bool:YES};
SC.RunLoop.begin();storeKey1=SC.Store.generateStoreKey();store.writeDataHash(storeKey1,json1,SC.Record.READY_CLEAN);
storeKey2=SC.Store.generateStoreKey();store.writeDataHash(storeKey2,json2,SC.Record.READY_NEW);
storeKey3=SC.Store.generateStoreKey();store.writeDataHash(storeKey3,json3,SC.Record.READY_DIRTY);
storeKey4=SC.Store.generateStoreKey();store.writeDataHash(storeKey4,json4,SC.Record.DESTROYED_DIRTY);
storeKey5=SC.Store.generateStoreKey();store.writeDataHash(storeKey5,json5,SC.Record.READY_EMPTY);
storeKey6=SC.Store.generateStoreKey();store.writeDataHash(storeKey6,json6,SC.Record.READY_ERROR);
storeKey7=SC.Store.generateStoreKey();store.writeDataHash(storeKey7,json7,SC.Record.READY_DESTROYED_CLEAN);
SC.RunLoop.end()}});test("Confirm that all the states are switched as expected after running commitRecord",function(){var k=false,h,d;
store.commitRecord(undefined,undefined,storeKey1);d=store.readStatus(storeKey1);equals(d,SC.Record.READY_CLEAN,"the status shouldn't have changed. It should be READY_CLEAN ");
store.commitRecord(undefined,undefined,storeKey2);d=store.readStatus(storeKey2);equals(d,SC.Record.BUSY_CREATING,"the status should be SC.Record.BUSY_CREATING");
store.commitRecord(undefined,undefined,storeKey3);d=store.readStatus(storeKey3);equals(d,SC.Record.BUSY_COMMITTING,"the status should be SC.Record.BUSY_COMMITTING");
store.dataSourceDidComplete(storeKey3);d=store.readStatus(storeKey3);equals(d,SC.Record.READY_CLEAN,"the status should be SC.Record.READY_CLEAN");
store.commitRecord(undefined,undefined,storeKey4);d=store.readStatus(storeKey4);equals(d,SC.Record.BUSY_DESTROYING,"the status should be SC.Record.BUSY_DESTROYING");
try{store.commitRecord(undefined,undefined,storeKey5);k=false;h=""}catch(j){k=true;
h=j.message}equals(h,SC.Record.NOT_FOUND_ERROR.message,"commitRecord should throw the following error");
try{store.commitRecord(undefined,undefined,storeKey6);k=false;h=""}catch(g){k=true;
h=g.message}equals(h,SC.Record.NOT_FOUND_ERROR.message,"commitRecord should throw the following error");
try{store.commitRecord(undefined,undefined,storeKey7);k=false;h=""}catch(e){k=true;
h=e.message}equals(h,SC.Record.NOT_FOUND_ERROR.message,"commitRecord should throw the following error")
});test("calling commitRecords() without explicit storeKeys",function(){var d;store.changelog=[storeKey1,storeKey2,storeKey3,storeKey4];
store.commitRecords();d=store.readStatus(storeKey1);equals(d,SC.Record.READY_CLEAN,"storeKey1 - the status shouldn't have changed. It should be READY_CLEAN ");
d=store.readStatus(storeKey2);equals(d,SC.Record.BUSY_CREATING,"storeKey2 - the status should be SC.Record.BUSY_CREATING");
d=store.readStatus(storeKey3);equals(d,SC.Record.BUSY_COMMITTING,"storeKey3 - the status should be SC.Record.BUSY_COMMITTING");
d=store.readStatus(storeKey4);equals(d,SC.Record.BUSY_DESTROYING,"storeKey4 - the status should be SC.Record.BUSY_DESTROYING");
ds.expect(1,[storeKey2],[storeKey3],[storeKey4])});test("calling commitRecords() with params",function(){var d={foo:"bar"};
store.commitRecord(null,null,storeKey2,d);ds.expect(1,[storeKey2],[],[],d);ds.reset();
store.commitRecords(null,null,null,d);ds.expect(1,[],[],[],d);ds.reset();store.commitRecords(null,null,null,null);
ds.expect(0)});var store,Application,dataSource;module("SC.Store Core Methods",{setup:function(){dataSource=SC.DataSource.create({gotParams:NO,updateRecord:function(e,g,h){this.gotParams=h&&h.param1?YES:NO
}});Application={};Application._nameDidChange=0;Application.File=SC.Record.extend({nameDidChange:function(e,g){Application._nameDidChange++
}.observes("name","url","isDirectory")});Application.FileDisk=SC.Record.extend({});
Application.Data={FileDisk:[{guid:"14",name:"Main Drive",parent:null,children:null}],File:[{guid:"10",name:"Home",url:"/emily_parker",isDirectory:true,parent:null,children:"Collection"},{guid:"11",name:"Documents",fileType:"documents",url:"/emily_parker/Documents",isDirectory:true,parent:"10",children:"Collection",createdAt:"June 15, 2007",modifiedAt:"October 21, 2007",filetype:"directory",isShared:false},{guid:"137",name:"Library",fileType:"library",url:"/emily_parker/Library",isDirectory:true,parent:"10",children:"Collection",createdAt:"June 15, 2007",modifiedAt:"October 21, 2007",filetype:"directory",isShared:false},{guid:"12",name:"Movies",fileType:"movies",url:"/emily_parker/Movies",isDirectory:true,parent:"10",children:"Collection",createdAt:"June 15, 2007",modifiedAt:"June 15, 2007",filetype:"directory",isShared:true,sharedAt:"October 15, 2007",sharedUntil:"March 31, 2008",sharedUrl:"2fhty",isPasswordRequired:true},{guid:"134",name:"Music",fileType:"music",url:"/emily_parker/Music",isDirectory:true,parent:"10",children:"Collection",createdAt:"June 15, 2007",modifiedAt:"June 15, 2007",filetype:"directory",isShared:true,sharedAt:"October 15, 2007",sharedUntil:"March 31, 2008",sharedUrl:"2fhty",isPasswordRequired:true},{guid:"135",name:"Pictures",fileType:"pictures",url:"/emily_parker/Pictures",isDirectory:true,parent:"10",children:"Collection",createdAt:"June 15, 2007",modifiedAt:"June 15, 2007",filetype:"directory",isShared:true,sharedAt:"October 15, 2007",sharedUntil:"March 31, 2008",sharedUrl:"2fhty",isPasswordRequired:true},{guid:"13",name:"Auto Insurance",fileType:"folder",url:"/emily_parker/Documents/Auto%20Insurance",isDirectory:true,parent:"11",children:"Collection",createdAt:"June 15, 2007",modifiedAt:"October 21, 2007",filetype:"directory",isShared:false},{guid:"14",name:"Birthday Invitation.pdf",fileType:"file",url:"/emily_parker/Documents/Birthday%20Invitation",isDirectory:false,parent:"11",createdAt:"October 17, 2007",modifiedAt:"October 21, 2007",filetype:"pdf",isShared:false},{guid:"136",name:"Software",fileType:"software",url:"/emily_parker/Software",isDirectory:true,parent:"10",children:"Collection",createdAt:"June 15, 2007",modifiedAt:"June 15, 2007",filetype:"directory",isShared:true,sharedAt:"October 15, 2007",sharedUntil:"March 31, 2008",sharedUrl:"2fhty",isPasswordRequired:true}]};
SC.RunLoop.begin();store=SC.Store.create({name:"Test store"}).from(dataSource);for(var d in Application.Data){store.loadRecords(Application[d],Application.Data[d])
}SC.RunLoop.end();window.Application=Application}});test("Verify that SC.Store's toString() includes the store's name, if it was specified",function(){var d=store.toString();
ok(d.indexOf("Test store")!==-1,'should contain "Test store"')});test("Verify loadRecords() loads data",function(){equals(store.find(Application.File,"14").get("name"),"Birthday Invitation.pdf","should return File 14");
equals(store.find(Application.FileDisk,"14").get("name"),"Main Drive","should return FileDisk 14")
});test("Verify storeKeys() gets all store keys",function(){var d;equals(store.storeKeys().length,10,"Length should be 10");
d=store.storeKeyFor(Application.File,"10");store.writeStatus(d,SC.Record.EMPTY);equals(store.storeKeys().length,9,"Length should be one less now")
});test("find() should take both SC.Record object and SC.Record string as recordtype argument",function(){equals(store.find("Application.File","14").get("name"),"Birthday Invitation.pdf","should return File 14");
equals(store.find(Application.File,"14").get("name"),"Birthday Invitation.pdf","should return FileDisk 14")
});test("loading more records should not sending _flushRecordChanges() until the end of the runloop",function(){var e=[{guid:"55",name:"Home",url:"/emily_parker",isDirectory:true,parent:null,children:"Collection"},{guid:"56",name:"Documents",fileType:"documents",url:"/emily_parker/Documents",isDirectory:true,parent:"10",children:"Collection",createdAt:"June 15, 2007",modifiedAt:"October 21, 2007",filetype:"directory",isShared:false},{guid:"57",name:"Library",fileType:"library",url:"/emily_parker/Library",isDirectory:true,parent:"10",children:"Collection",createdAt:"June 15, 2007",modifiedAt:"October 21, 2007",filetype:"directory",isShared:false}];
SC.RunLoop.begin();var h=store.loadRecords(Application.File,e);equals(h.length,3,"precon - should have loaded three records");
equals(store.recordPropertyChanges.storeKeys.length,3,"should be three storeKeys in changelog");
SC.RunLoop.end();var g=store.recordPropertyChanges;var d=(g&&g.storeKeys)?g.storeKeys.length:0;
equals(d,0,"should be zero storeKeys in changelog")});test("Passing params through commitRecords()",function(){var d=store.find(Application.File,"14");
d.set("name","My Great New Name");store.commitRecords(null,null,null,{param1:"value1"});
equals(dataSource.gotParams,YES,"params should have travelled through to dataSource updateRecord() call")
});test("Make sure that setting an attribute on a record will only notify respective observers once",function(){var d=store.find(Application.File,"14");
Application._nameDidChange=0;SC.RunLoop.begin();d.writeAttribute("name","My Great New Name");
SC.RunLoop.end();equals(Application._nameDidChange,1,"observer was only fired once")
});var store,storeKey,json,hash,hash2;module("SC.Store#createRecord",{setup:function(){MyRecordType=SC.Record.extend({string:SC.Record.attr(String,{defaultValue:"Untitled"}),number:SC.Record.attr(Number,{defaultValue:5}),bool:SC.Record.attr(Boolean,{defaultValue:YES})});
store=SC.Store.create();json={string:"string",number:23,bool:YES};storeKey=SC.Store.generateStoreKey();
store.writeDataHash(storeKey,json,SC.Record.READY_CLEAN)}});test("create a record",function(){var d;
var e=SC.Record.create();hash={guid:"1234abcd",string:"abcd",number:1,bool:NO};hash2={string:"abcd",number:1,bool:NO};
e=store.createRecord(SC.Record,hash);ok(e,"a record was created");d=store.storeKeyFor(SC.Record,e.id());
equals(store.readDataHash(d),hash,"data hashes are equivalent");equals(e.id(),"1234abcd","guids are the same");
e=store.createRecord(SC.Record,hash2,"priKey");ok(e,"a record with a custom id was created");
d=store.storeKeyFor(SC.Record,"priKey");equals(store.readDataHash(d),hash2,"data hashes are equivalent");
equals(e.id(),"priKey","guids are the same");equals(store.changelog.length,2,"The changelog has the following number of entries:")
});test("Creating an empty (null) record should make the hash available",function(){store.createRecord(MyRecordType,null,"guid8");
var d=store.storeKeyFor(MyRecordType,"guid8");ok(store.readDataHash(d),"data hash should not be empty/undefined")
});var MyApp={};var store,child,storeKey,json;module("SC.Store#dataHashDidChange",{setup:function(){store=SC.Store.create();
json={string:"string",number:23,bool:YES};storeKey=SC.Store.generateStoreKey();store.writeDataHash(storeKey,json,SC.Record.READY_CLEAN);
store.editables=null;child=store.chain();MyApp.Foo=SC.Record.extend({prop1:SC.Record.attr(String,{defaultValue:"Default Value for prop1"}),prop2:SC.Record.attr(String,{defaultValue:"Default Value for prop2"}),prop3:SC.Record.attr(String,{defaultValue:"Default Value for prop2"})})
}});function testStateTransition(g,d){equals(store.storeKeyEditState(storeKey),g,"precond - storeKey edit state");
if(store.chainedChanges){ok(!store.chainedChanges.contains(storeKey),"changedChanges should NOT include storeKey")
}var e=store.revisions[storeKey];equals(store.dataHashDidChange(storeKey),store,"should return receiver");
equals(store.storeKeyEditState(storeKey),d,"store key edit state is in same state");
ok(e!==store.revisions[storeKey],"revisions should change. was: %@ - now: %@".fmt(e,store.revisions[storeKey]))
}test("edit state = LOCKED",function(){SC.RunLoop.begin();store.readDataHash(storeKey);
testStateTransition(SC.Store.LOCKED,SC.Store.LOCKED);SC.RunLoop.end()});test("edit state = EDITABLE",function(){SC.RunLoop.begin();
store.readEditableDataHash(storeKey);testStateTransition(SC.Store.EDITABLE,SC.Store.EDITABLE);
SC.RunLoop.end()});test("calling with array of storeKeys will edit all store keys",function(){SC.RunLoop.begin();
var e=[storeKey,SC.Store.generateStoreKey()],d;store.dataHashDidChange(e,2000);for(d=0;
d<e.length;d++){equals(store.revisions[e[d]],2000,"storeKey at index %@ should have new revision".fmt(d))
}SC.RunLoop.end()});test("calling dataHashDidChange twice with different statusOnly values before flush is called should trigger a non-statusOnly flush if any of the statusOnly values were NO",function(){SC.RunLoop.begin();
var d=SC.Record.create({id:514});var e=SC.Record.storeKeyFor(514);d=store.materializeRecord(e);
store.dataHashDidChange(e,null,NO);store.dataHashDidChange(e,null,YES);ok(store.recordPropertyChanges.hasDataChanges.contains(e),"recordPropertyChanges.hasDataChanges should contain the storeKey %@".fmt(e));
SC.RunLoop.end()});test("calling _notifyRecordPropertyChange twice, once with a key and once without, before flush is called should invalidate all cached properties when flush is finally called",function(){SC.RunLoop.begin();
var k=SC.Store.create();var d=k.createRecord(MyApp.Foo,{});var g=d.get("prop1");g=d.get("prop2");
var j=d.get("storeKey");k._notifyRecordPropertyChange(j,NO,"prop2");var h=k.chain();
var e=h.materializeRecord(j);e.set("prop1","New value");h.commitChanges();k._notifyRecordPropertyChange(j,NO,"prop3");
SC.RunLoop.end();equals(d.get("prop1"),"New value","The main store’s record should return the correct value for prop1, not the stale cached version")
});var store,storeKey,json;module("SC.Store#dataSourceCallbacks",{setup:function(){store=SC.Store.create();
json1={guid:"commitGUID1",string:"string",number:23,bool:YES};json2={guid:"commitGUID2",string:"string",number:23,bool:YES};
json3={guid:"commitGUID3",string:"string",number:23,bool:YES};json4={guid:"commitGUID4",string:"string",number:23,bool:YES};
json5={guid:"commitGUID5",string:"string",number:23,bool:YES};json6={guid:"commitGUID6",string:"string",number:23,bool:YES};
json7={guid:"commitGUID7",string:"string",number:23,bool:YES};json8={guid:"commitGUID8",string:"string",number:23,bool:YES};
json9={guid:"commitGUID9",string:"string",number:23,bool:YES};json10={guid:"commitGUID10",string:"string",number:23,bool:YES};
json11={guid:"commitGUID11",string:"string",number:23,bool:YES};json12={guid:"commitGUID12",string:"string",number:23,bool:YES};
json13={guid:"commitGUID13",string:"string",number:23,bool:YES};json14={guid:"commitGUID14",string:"string",number:23,bool:YES};
json15={guid:"commitGUID15",string:"string",number:23,bool:YES};json16={guid:"commitGUID16",string:"string",number:23,bool:YES};
storeKey1=SC.Store.generateStoreKey();store.writeDataHash(storeKey1,json1,SC.Record.READY_CLEAN);
storeKey2=SC.Store.generateStoreKey();store.writeDataHash(storeKey2,json2,SC.Record.BUSY_LOADING);
storeKey3=SC.Store.generateStoreKey();store.writeDataHash(storeKey3,json3,SC.Record.BUSY_CREATING);
storeKey4=SC.Store.generateStoreKey();store.writeDataHash(storeKey4,json4,SC.Record.BUSY_COMMITTING);
storeKey5=SC.Store.generateStoreKey();store.writeDataHash(storeKey5,json5,SC.Record.BUSY_REFRESH_CLEAN);
storeKey6=SC.Store.generateStoreKey();store.writeDataHash(storeKey6,json6,SC.Record.BUSY_REFRESH_DIRTY);
storeKey7=SC.Store.generateStoreKey();store.writeDataHash(storeKey7,json7,SC.Record.BUSY_DESTROYING);
storeKey8=SC.Store.generateStoreKey();store.writeDataHash(storeKey8,json8,SC.Record.BUSY);
storeKey9=SC.Store.generateStoreKey();store.writeDataHash(storeKey9,json9,SC.Record.READY_CLEAN);
storeKey10=SC.Store.generateStoreKey();store.writeDataHash(storeKey10,json10,SC.Record.BUSY_DESTROYING);
storeKey11=SC.Store.generateStoreKey();store.writeDataHash(storeKey11,json11,SC.Record.BUSY_CREATING);
storeKey12=SC.Store.generateStoreKey();store.writeDataHash(storeKey12,json12,SC.Record.READY_CLEAN);
storeKey13=SC.Store.generateStoreKey();store.writeDataHash(storeKey13,json13,SC.Record.BUSY_CREATING);
storeKey14=SC.Store.generateStoreKey();store.writeDataHash(storeKey14,json14,SC.Record.READY_CLEAN);
storeKey15=SC.Store.generateStoreKey();store.writeDataHash(storeKey15,json15,SC.Record.BUSY_CREATING);
storeKey16=SC.Store.generateStoreKey();store.writeDataHash(storeKey16,json16,SC.Record.BUSY_LOADING);
SC.RunLoop.begin()},teardown:function(){SC.RunLoop.end()}});test("Confirm that dataSourceDidCancel switched the records to the right states",function(){var g="",d;
try{store.dataSourceDidCancel(storeKey1);g=""}catch(e){g=e.message}equals(SC.Record.BAD_STATE_ERROR.message,g,"should throw the following error ");
store.dataSourceDidCancel(storeKey2);d=store.readStatus(storeKey2);equals(d,SC.Record.EMPTY,"the status should have changed to EMPTY");
store.dataSourceDidCancel(storeKey3);d=store.readStatus(storeKey3);equals(d,SC.Record.READY_NEW,"the status should have changed to READY_NEW");
store.dataSourceDidCancel(storeKey4);d=store.readStatus(storeKey4);equals(d,SC.Record.READY_DIRTY,"the status should have changed to READY_DIRTY");
store.dataSourceDidCancel(storeKey5);d=store.readStatus(storeKey5);equals(d,SC.Record.READY_CLEAN,"the status should have changed to READY_CLEAN");
store.dataSourceDidCancel(storeKey6);d=store.readStatus(storeKey6);equals(d,SC.Record.READY_DIRTY,"the status should have changed to READY_DIRTY");
store.dataSourceDidCancel(storeKey7);d=store.readStatus(storeKey7);equals(d,SC.Record.DESTROYED_DIRTY,"the status should have changed to DESTROYED_DIRTY");
try{store.dataSourceDidCancel(storeKey8);g=""}catch(e){g=e.message}equals(SC.Record.BAD_STATE_ERROR.message,g,"should throw the following error ")
});test("Confirm that dataSourceDidComplete switched the records to the right states",function(){var g="",d;
try{store.dataSourceDidComplete(storeKey9);g=""}catch(e){g=e.message}equals(SC.Record.BAD_STATE_ERROR.message,g,"should throw the following error ");
try{store.dataSourceDidComplete(storeKey10);g=""}catch(e){g=e.message}equals(SC.Record.BAD_STATE_ERROR.message,g,"should throw the following error ");
store.dataSourceDidComplete(storeKey11);d=store.readStatus(storeKey11);equals(d,SC.Record.READY_CLEAN,"the status should have changed to READY_CLEAN.")
});test("Confirm that dataSourceDidDestroy switched the records to the right states",function(){var g="",d;
try{store.dataSourceDidDestroy(storeKey12);g=""}catch(e){g=e.message}equals(SC.Record.BAD_STATE_ERROR.message,g,"should throw the following error ");
store.dataSourceDidDestroy(storeKey13);d=store.readStatus(storeKey13);equals(d,SC.Record.DESTROYED_CLEAN,"the status should have changed to DESTROYED_CLEAN.")
});test("Confirm that dataSourceDidError switched the records to the right states",function(){var g="",d;
try{store.dataSourceDidError(storeKey14,SC.Record.BAD_STATE_ERROR);g=""}catch(e){g=e.message
}equals(SC.Record.BAD_STATE_ERROR.message,g,"should throw the following error ");
store.dataSourceDidError(storeKey15,SC.Record.BAD_STATE_ERROR);d=store.readStatus(storeKey15);
equals(d,SC.Record.ERROR,"the status shouldn't have changed.")});test("Confirm that errors passed to dataSourceDidError make it into the recordErrors array",function(){var e="";
ok(!store.recordErrors,"recordErrors should be null at this point");try{store.dataSourceDidError(storeKey16,SC.Record.GENERIC_ERROR)
}catch(d){e=d.message}equals(store.recordErrors[storeKey16],SC.Record.GENERIC_ERROR,"recordErrors[storeKey] should be the right error object")
});var store,storeKey1,storeKey2,storeKey3,storeKey4,storeKey5,storeKey6,json;var json1,json2,json3,json4,json5,json6;
module("SC.Store#destroyRecord",{setup:function(){store=SC.Store.create();json1={guid:"destroyGUID1",string:"string",number:23,bool:YES};
json2={guid:"destroyGUID2",string:"string",number:23,bool:YES};json3={guid:"destroyGUID3",string:"string",number:23,bool:YES};
json4={guid:"destroyGUID4",string:"string",number:23,bool:YES};json5={guid:"destroyGUID5",string:"string",number:23,bool:YES};
json6={guid:"destroyGUID6",string:"string",number:23,bool:YES};storeKey1=SC.Store.generateStoreKey();
store.writeDataHash(storeKey1,json1,SC.Record.BUSY_DESTROYING);storeKey2=SC.Store.generateStoreKey();
store.writeDataHash(storeKey2,json2,SC.Record.DESTROYED);storeKey3=SC.Store.generateStoreKey();
store.writeDataHash(storeKey3,json3,SC.Record.EMPTY);storeKey4=SC.Store.generateStoreKey();
store.writeDataHash(storeKey4,json4,SC.Record.BUSY);storeKey5=SC.Store.generateStoreKey();
store.writeDataHash(storeKey5,json5,SC.Record.READY_NEW);storeKey6=SC.Store.generateStoreKey();
store.writeDataHash(storeKey6,json6,SC.Record.READY_CLEAN)}});test("Check for different states after/before executing destroyRecord",function(){var j=false,g,d;
store.destroyRecord(undefined,undefined,storeKey1);d=store.readStatus(storeKey1);
equals(d,SC.Record.BUSY_DESTROYING,"the status shouldn't have changed. It should be BUSY_DESTROYING ");
store.destroyRecord(undefined,undefined,storeKey2);d=store.readStatus(storeKey2);
equals(d,SC.Record.DESTROYED,"the status shouldn't have changed. It should be DESTROYED ");
try{store.destroyRecord(undefined,undefined,storeKey3);g=""}catch(h){g=h.message}equals(g,SC.Record.NOT_FOUND_ERROR.message,"destroyRecord should throw the following error");
try{store.destroyRecord(undefined,undefined,storeKey4);g=""}catch(e){g=e.message}equals(g,SC.Record.BUSY_ERROR.message,"destroyRecord should throw the following error");
store.destroyRecord(undefined,undefined,storeKey5);d=store.readStatus(storeKey5);
equals(d,SC.Record.DESTROYED_CLEAN,"the status should have changed to DESTROYED_CLEAN ");
store.destroyRecord(undefined,undefined,storeKey6);d=store.readStatus(storeKey6);
equals(d,SC.Record.DESTROYED_DIRTY,"the status should have changed to DESTROYED_DIRTY ");
equals(store.changelog.length,1,"The changelog has the following number of entries:")
});var store,Application;module("SC.Store Error Methods",{setup:function(){Application={};
Application.Thing=SC.Record.extend({name:SC.Record.attr(String)});SC.RunLoop.begin();
store=SC.Store.create();var d=[{guid:1,name:"Thing One"},{guid:2,name:"Thing Two"}];
var e=[Application.Thing,Application.Thing];store.loadRecords(e,d);SC.RunLoop.end()
},teardown:function(){store=null;Application=null}});test("Verify readError() returns correct errors",function(){var e=store.find(Application.Thing,1);
var d=e.get("storeKey");SC.RunLoop.begin();store.writeStatus(d,SC.Record.BUSY_LOADING);
store.dataSourceDidError(d,SC.Record.GENERIC_ERROR);SC.RunLoop.end();equals(store.readError(d),SC.Record.GENERIC_ERROR,"store.readError(storeKey) should return the correct error object")
});test("Verify readQueryError() returns correct errors",function(){var d=SC.Query.local(Application.Thing);
var e=store.find(d);SC.RunLoop.begin();e.set("status",SC.Record.BUSY_LOADING);store.dataSourceDidErrorQuery(d,SC.Record.GENERIC_ERROR);
SC.RunLoop.end();equals(store.readQueryError(d),SC.Record.GENERIC_ERROR,"store.readQueryError(q) should return the correct error object")
});module("SC.Query querying find() on a store",{setup:function(){SC.RunLoop.begin();
MyApp=SC.Object.create({});MyApp.Foo=SC.Record.extend();MyApp.Bar=SC.Record.extend();
MyApp.DataSource=SC.DataSource.create({fetch:function(e,g){this.query=g;this.store=e;
this.fetchCount++;if(g.get("location")===SC.Query.REMOTE){if(g.get("recordType")===MyApp.Foo){e.loadQueryResults(g,this.get("storeKeys"))
}}return YES},reset:function(){this.query=this.store=null;this.fetchCount=this.prepareCount=0
},fetchEquals:function(e,h,g,j){if(j===undefined&&typeof g==="string"){j=g;g=undefined
}if(g===undefined){g=1}equals(this.store,e,j+": should get store");equals(this.query,h,j+": should get query");
equals(this.fetchCount,g,j+": should get count")},destroyRecord:function(e,g){e.dataSourceDidDestroy(g);
return YES}});MyApp.store=SC.Store.create().from(MyApp.DataSource);var d=[{guid:1,firstName:"John",lastName:"Doe",married:true},{guid:2,firstName:"Jane",lastName:"Doe",married:false},{guid:3,firstName:"Emily",lastName:"Parker",bornIn:1975,married:true},{guid:4,firstName:"Johnny",lastName:"Cash",married:true},{guid:5,firstName:"Bert",lastName:"Berthold",married:true}];
MyApp.DataSource.storeKeys=MyApp.store.loadRecords(MyApp.Foo,d);SC.RunLoop.end();
SC.RunLoop.begin();MyApp.store.loadRecords(MyApp.Bar,d);SC.RunLoop.end()},teardown:function(){MyApp=null;
SC.Record.subclasses.clear()}});test("find(recordType, id)",function(){equals(MyApp.store.find("MyApp.Foo",1).get("firstName"),"John","should return foo(1)");
equals(MyApp.store.find(MyApp.Foo,1).get("firstName"),"John","should return foo(1)")
});test("find(record)",function(){var e=MyApp.store.find(MyApp.Foo,1);equals(MyApp.store.find(e),e,"find(rec1) should return rec1");
var d=MyApp.store.chain().find(e);ok(d!==e,"nested.find(rec1) should not return same instance");
equals(d.get("storeKey"),e.get("storeKey"),"nested.find(rec1) should return same record in nested store")
});test("caching for a single store",function(){var e=MyApp.store.find(MyApp.Foo);
var d=MyApp.store.find(MyApp.Foo);ok(!!e,"should return a record array");ok(e.isEnumerable,"returned item should be enumerable");
equals(e.get("store"),MyApp.store,"return object should be owned by store");equals(d,e,"should return same record array for multiple calls")
});test("find() caching for a chained store",function(){var g=MyApp.store.find(MyApp.Foo);
var h=MyApp.store.chain();var e=h.find(MyApp.Foo);var d=h.find(MyApp.Foo);ok(!!g,"should return a record array from base store");
equals(g.get("store"),MyApp.store,"return object should be owned by store");ok(!!e,"should return a recurd array from child store");
equals(e.get("store"),h,"return object should be owned by child store");ok(e!==g,"return value for child store should not be same as parent");
equals(d,e,"return value from child store should be the same after multiple calls");
ok(!!g.get("query"),"record array should have a query");equals(e.get("query"),g.get("query"),"record arrays from parent and child stores should share the same query")
});test("data source must get the right calls",function(){var g=MyApp.store.get("dataSource");
g.reset();var d=MyApp.store.find(MyApp.Foo);var e=SC.Query.local(MyApp.Foo);g.fetchEquals(MyApp.store,e,"after fetch")
});test("should find records based on boolean",function(){SC.RunLoop.begin();var e=SC.Query.local(MyApp.Foo,"married=YES");
var d=MyApp.store.find(e);equals(d.get("length"),4,"record length should be 4");SC.RunLoop.end()
});test("should find records based on query string",function(){SC.RunLoop.begin();
var e=SC.Query.local(MyApp.Foo,{conditions:"firstName = 'John'"});var d=MyApp.store.find(e);
equals(d.get("length"),1,"record length should be 1");equals(d.objectAt(0).get("firstName"),"John","name should be John");
SC.RunLoop.end()});test("should find records based on SC.Query",function(){var e=SC.Query.create({recordType:MyApp.Foo,conditions:"firstName = 'Jane'"});
var d=MyApp.store.find(e);equals(d.get("length"),1,"record length should be 1");equals(d.objectAt(0).get("firstName"),"Jane","name should be Jane")
});test("modifying a record should update RecordArray automatically",function(){var g=SC.Query.local(MyApp.Foo,"firstName = 'Jane'"),e=MyApp.store.find(g);
equals(e.get("length"),1,"record length should be 1");equals(e.objectAt(0).get("firstName"),"Jane","name should be Jane");
SC.RunLoop.begin();var d=MyApp.store.find(MyApp.Foo,3);ok(d.get("firstName")!=="Jane","precond - firstName is not Jane");
d.set("firstName","Jane");SC.RunLoop.end();equals(e.get("length"),2,"record length should increase");
same(e.getEach("firstName"),["Jane","Jane"],"check all firstNames are Jane");SC.RunLoop.begin();
d.set("firstName","Ester");SC.RunLoop.end();equals(e.get("length"),1,"record length should decrease")
});test("should find records based on SC.Query without recordType",function(){var e=SC.Query.local(SC.Record,"lastName = 'Doe'");
var d=MyApp.store.find(e);equals(d.get("length"),4,"record length should be 2");same(d.getEach("firstName"),"John John Jane Jane".w(),"firstNames should match")
});test("should find records within a passed record array",function(){SC.RunLoop.begin();
var g=SC.Query.create({recordType:MyApp.Foo,conditions:"firstName = 'Emily'"});var e=MyApp.store.find(MyApp.Foo);
var d=e.find(g);equals(d.get("length"),1,"record length should be 1");equals(d.objectAt(0).get("firstName"),"Emily","name should be Emily");
SC.RunLoop.end()});test("sending a new store key array from the data source should update record array",function(){var g=SC.Query.remote(MyApp.Foo),e=MyApp.store.find(g);
SC.RunLoop.begin();equals(e.get("length"),5,"record length should be 5");SC.RunLoop.end();
var d=MyApp.DataSource.storeKeys.copy();d.pop();SC.RunLoop.begin();MyApp.store.loadQueryResults(g,d);
SC.RunLoop.end();equals(e.get("length"),4,"record length should be 4")});test("loading more data into the store should propagate to record array",function(){var e=MyApp.store.find(MyApp.Foo);
equals(e.get("length"),5,"record length before should be 5");SC.RunLoop.begin();var d=MyApp.store.loadRecords(MyApp.Foo,[{guid:10,firstName:"John",lastName:"Johnson"}]);
SC.RunLoop.end();equals(e.get("length"),6,"record length after should be 6")});test("loading more data into the store should propagate to record array with query",function(){var h=SC.Query.local(MyApp.Foo,"firstName = 'John'"),g=MyApp.store.find(h);
equals(g.get("length"),1,"record length before should be 1");SC.RunLoop.begin();var e=MyApp.store.loadRecords(MyApp.Foo,[{guid:10,firstName:"John",lastName:"Johnson"}]);
SC.RunLoop.end();equals(g.get("length"),2,"record length after should be 2");SC.RunLoop.begin();
var d=MyApp.store.loadRecords(MyApp.Foo,[{guid:11,firstName:"John",lastName:"Norman"}]);
SC.RunLoop.end();equals(g.get("length"),3,"record length after should be 3")});test("Loading records after SC.Query should show up",function(){var g=SC.Query.local(MyApp.Foo,"firstName = 'John'"),e=MyApp.store.find(g);
equals(e.get("length"),1,"record length should be 1");equals(e.objectAt(0).get("firstName"),"John","name should be John");
var d=[{guid:20,firstName:"John",lastName:"Johnson"},{guid:21,firstName:"John",lastName:"Anderson"},{guid:22,firstName:"Barbara",lastName:"Jones"}];
SC.RunLoop.begin();MyApp.store.loadRecords(MyApp.Foo,d);SC.RunLoop.end();equals(e.get("length"),3,"record length should be 3");
equals(e.objectAt(0).get("firstName"),"John","name should be John");equals(e.objectAt(1).get("firstName"),"John","name should be John");
equals(e.objectAt(2).get("firstName"),"John","name should be John")});test("Loading records after getting empty record array based on SC.Query should update",function(){var g=SC.Query.local(MyApp.Foo,"firstName = 'Maria'");
var e=MyApp.store.find(g);equals(e.get("length"),0,"record length should be 0");var d=[{guid:20,firstName:"Maria",lastName:"Johnson"}];
SC.RunLoop.begin();MyApp.store.loadRecords(MyApp.Foo,d);SC.RunLoop.end();equals(e.get("length"),1,"record length should be 1");
equals(e.objectAt(0).get("firstName"),"Maria","name should be Maria")});test("Changing a record should make it show up in RecordArrays based on SC.Query",function(){var g,e,d;
g=SC.Query.local(MyApp.Foo,"firstName = 'Maria'");e=MyApp.store.find(g);equals(e.get("length"),0,"record length should be 0");
SC.RunLoop.begin();d=MyApp.store.find(MyApp.Foo,1);d.set("firstName","Maria");SC.RunLoop.end();
equals(e.get("length"),1,"record length should be 1");equals(e.objectAt(0).get("firstName"),"Maria","name should be Maria")
});test("Deleting a record should make the RecordArray based on SC.Query update accordingly",function(){var e,d;
e=SC.Query.local(MyApp.Foo,"firstName = 'John'");d=MyApp.store.find(e);equals(d.get("length"),1,"record length should be 1");
SC.RunLoop.begin();d.objectAt(0).destroy();SC.RunLoop.end();equals(d.get("length"),0,"record length should be 0")
});test("Using find() with SC.Query on store with no data source should work",function(){var g,e,d;
SC.RunLoop.begin();MyApp.store3=SC.Store.create();g=SC.Query.local(MyApp.Foo,"firstName = 'John'");
e=MyApp.store3.find(g);equals(e.get("length"),0,"record length should be 0");d=[{guid:20,firstName:"John",lastName:"Johnson"},{guid:21,firstName:"John",lastName:"Anderson"},{guid:22,firstName:"Barbara",lastName:"Jones"}];
MyApp.store3.loadRecords(MyApp.Foo,d);SC.RunLoop.end();equals(e.get("length"),2,"record length should be 2")
});test("Using orderBy in SC.Query returned from find()",function(){var e,d;e=SC.Query.local(MyApp.Foo,{orderBy:"firstName ASC"});
d=MyApp.store.find(e);equals(d.get("length"),5,"record length should be 5");same(d.getEach("firstName"),["Bert","Emily","Jane","John","Johnny"],"first name should be properly sorted")
});test("Using orderBy in SC.Query returned from find() and loading more records to original store key array",function(){var g,e,d;
g=SC.Query.local(MyApp.Foo,{orderBy:"firstName ASC"});e=MyApp.store.find(g);equals(e.get("length"),5,"record length should be 5");
equals(e.objectAt(0).get("firstName"),"Bert","name should be Bert");equals(e.objectAt(4).get("firstName"),"Johnny","name should be Johnny");
SC.RunLoop.begin();d=MyApp.store.loadRecords(MyApp.Foo,[{guid:11,firstName:"Anna",lastName:"Petterson"}]);
SC.RunLoop.end();equals(e.objectAt(0).get("firstName"),"Anna","name should be Anna");
equals(e.objectAt(1).get("firstName"),"Bert","name should be Bert");equals(e.objectAt(5).get("firstName"),"Johnny","name should be Johnny")
});test("Using orderBy in SC.Query and loading more records to the store",function(){var e,d;
SC.RunLoop.begin();e=SC.Query.local(MyApp.Foo,{orderBy:"firstName ASC"});d=MyApp.store.find(e);
equals(d.get("length"),5,"record length should be 5");equals(d.objectAt(0).get("firstName"),"Bert","name should be Bert");
MyApp.store.loadRecords(MyApp.Foo,[{guid:11,firstName:"Anna",lastName:"Petterson"}]);
SC.RunLoop.end();equals(d.get("length"),6,"record length should be 6");equals(d.objectAt(0).get("firstName"),"Anna","name should be Anna");
equals(d.objectAt(5).get("firstName"),"Johnny","name should be Johnny")});test("Chaining find() queries",function(){var g,d,h,e;
g=SC.Query.local(MyApp.Foo,"lastName='Doe'");d=MyApp.store.find(g);equals(d.get("length"),2,"record length should be 2");
h=SC.Query.local(MyApp.Foo,"firstName='John'");e=d.find(h);equals(e.get("length"),1,"record length should be 1");
equals(e.objectAt(0).get("firstName"),"John","name should be John")});test("Chaining find() queries and loading more records",function(){var e,g,d;
SC.RunLoop.begin();e=SC.Query.local(MyApp.Foo,"lastName='Doe'");g=SC.Query.local(MyApp.Foo,"firstName='John'");
d=MyApp.store.find(e).find(g);equals(d.get("length"),1,"record length should be 1");
MyApp.store.loadRecords(MyApp.Foo,[{guid:11,firstName:"John",lastName:"Doe"}]);SC.RunLoop.end();
equals(d.get("length"),2,"record length should be 2")});module("create record");test("creating record appears in future find()",function(){var e,d,g;
e=SC.Record.extend({title:SC.Record.attr(String)});d=SC.Store.create();SC.run(function(){d.loadRecords(e,[{title:"A",guid:1},{title:"B",guid:2}])
});equals(d.find(e).get("length"),2,"should have two initial record");SC.run(function(){d.createRecord(e,{title:"C"});
g=d.find(e);equals(g.get("length"),3,"should return additional record")});g=d.find(e);
equals(g.get("length"),3,"should return additional record")});module("SC.Store#init");
test("initial setup for root store",function(){var d=SC.Store.create();equals(SC.typeOf(d.dataHashes),SC.T_HASH,"should have dataHashes");
equals(SC.typeOf(d.revisions),SC.T_HASH,"should have revisions");equals(SC.typeOf(d.statuses),SC.T_HASH,"should have statuses");
ok(!d.editables,"should not have editables");ok(!d.recordErrors,"should not have recordErrors");
ok(!d.queryErrors,"should not have queryErrors")});var store,storeKey,json;module("SC.Store#pushChanges",{setup:function(){SC.RunLoop.begin();
store=SC.Store.create();json={string:"string",number:23,bool:YES};storeKey1=SC.Store.generateStoreKey();
store.writeDataHash(storeKey1,json,SC.Record.EMPTY);storeKey2=SC.Store.generateStoreKey();
store.writeDataHash(storeKey2,json,SC.Record.EMPTY);storeKey3=SC.Store.generateStoreKey();
store.writeDataHash(storeKey3,json,SC.Record.EMPTY);storeKey4=SC.Store.generateStoreKey();
store.writeDataHash(storeKey4,json,SC.Record.BUSY_LOADING);storeKey5=SC.Store.generateStoreKey();
store.writeDataHash(storeKey5,json,SC.Record.BUSY_LOADING);storeKey6=SC.Store.generateStoreKey();
store.writeDataHash(storeKey6,json,SC.Record.BUSY_LOADING);SC.RunLoop.end()}});test("Do a pushRetrieve and check if there is conflicts",function(){var d=store.pushRetrieve(SC.Record,undefined,undefined,storeKey1);
equals(d,storeKey1,"There is no conflict, pushRetrieve was succesful.");d=store.pushRetrieve(SC.Record,undefined,undefined,storeKey4);
ok(!d,"There is a conflict, because of the state, this is expected.")});test("Do a pushDestroy and check if there is conflicts",function(){var d=store.pushDestroy(SC.Record,undefined,storeKey2);
equals(d,storeKey2,"There is no conflict, pushDestroy was succesful.");d=store.pushRetrieve(SC.Record,undefined,undefined,storeKey5);
ok(!d,"There is a conflict, because of the state, this is expected.")});test("Issue a pushError and check if there is conflicts",function(){var d=store.pushError(SC.Record,undefined,SC.Record.NOT_FOUND_ERROR,storeKey3);
equals(d,storeKey3,"There is no conflict, pushError was succesful.");d=store.pushRetrieve(SC.Record,undefined,undefined,storeKey6);
ok(!d,"There is a conflict, because of the state, this is expected.")});var store,storeKey,json;
module("SC.Store#readDataHash",{setup:function(){store=SC.Store.create();json={string:"string",number:23,bool:YES};
storeKey=SC.Store.generateStoreKey();store.writeDataHash(storeKey,json,SC.Record.READY_CLEAN);
store.editables=null}});test("data state=LOCKED",function(){equals(store.storeKeyEditState(storeKey),SC.Store.LOCKED,"precond - data state should be LOCKED");
var e=store.revisions[storeKey];var d=store.readDataHash(storeKey);equals(d,json,"should read same data hash once locked");
equals(store.storeKeyEditState(storeKey),SC.Store.LOCKED,"should remain in locked state");
equals(store.revisions[storeKey],e,"should not change revision");if(!SC.none(e)){ok(store.revisions.hasOwnProperty(storeKey),"should copy reference to revision")
}});test("data state=EDITABLE",function(){var e=store.readEditableDataHash(storeKey);
equals(store.storeKeyEditState(storeKey),SC.Store.EDITABLE,"precond - data state should be EDITABLE");
var g=store.revisions[storeKey];var d=store.readDataHash(storeKey);equals(e,d,"should read same data hash once editable");
equals(store.storeKeyEditState(storeKey),SC.Store.EDITABLE,"should remain in editable state");
equals(store.revisions[storeKey],g,"should not change revision");if(!SC.none(g)){ok(store.revisions.hasOwnProperty(storeKey),"should copy reference to revision")
}});test("should return null when accessing an unknown storeKey",function(){equals(store.readDataHash(20000000),null,"shuld return null for non-existant store key");
equals(store.storeKeyEditState(storeKey),SC.Store.LOCKED,"should put into locked edit state")
});var store,storeKey,json;module("SC.Store#readEditableDataHash",{setup:function(){store=SC.Store.create();
json={string:"string",number:23,bool:YES};storeKey=SC.Store.generateStoreKey();store.writeDataHash(storeKey,json,SC.Record.READY_CLEAN)
}});test("data state=LOCKED",function(){store.editables=null;equals(store.storeKeyEditState(storeKey),SC.Store.LOCKED,"precond - edit state should be LOCKED");
var e=store.revisions[storeKey];var d=store.readEditableDataHash(storeKey);same(d,json,"should return equivalent json object");
ok(!(d===json),"should not return same json instance");equals(store.storeKeyEditState(storeKey),SC.Store.EDITABLE,"edit state should be editable");
equals(store.revisions[storeKey],e,"should not change revision");if(!SC.none(e)){ok(store.revisions.hasOwnProperty(storeKey),"should clone revision reference")
}});test("data state=EDITABLE",function(){equals(store.storeKeyEditState(storeKey),SC.Store.EDITABLE,"precond - edit state should be EDITABLE");
var e=store.revisions[storeKey];var d=store.readEditableDataHash(storeKey);equals(d,json,"should return same editable json instance");
equals(store.storeKeyEditState(storeKey),SC.Store.EDITABLE,"edit state should be editable");
equals(store.revisions[storeKey],e,"should not change revision");if(!SC.none(e)){ok(store.revisions.hasOwnProperty(storeKey),"should clone revision reference")
}});var store,storeKey,json;module("SC.Store#recordDidChange",{setup:function(){store=SC.Store.create();
json1={guid:"commitGUID1",string:"string",number:23,bool:YES};json2={guid:"commitGUID2",string:"string",number:23,bool:YES};
json3={guid:"commitGUID3",string:"string",number:23,bool:YES};json4={guid:"commitGUID4",string:"string",number:23,bool:YES};
storeKey1=SC.Store.generateStoreKey();store.writeDataHash(storeKey1,json1,SC.Record.BUSY_LOADING);
storeKey2=SC.Store.generateStoreKey();store.writeDataHash(storeKey2,json2,SC.Record.EMPTY);
storeKey3=SC.Store.generateStoreKey();store.writeDataHash(storeKey3,json3,SC.Record.READY_NEW);
storeKey4=SC.Store.generateStoreKey();store.writeDataHash(storeKey4,json4,SC.Record.READY_CLEAN)
}});test("recordDidChange",function(){var d;try{store.recordDidChange(undefined,undefined,storeKey1)
}catch(g){equals(SC.Record.BUSY_ERROR.message,g.message,"the status shouldn't have changed.")
}try{store.recordDidChange(undefined,undefined,storeKey2)}catch(e){equals(SC.Record.NOT_FOUND_ERROR.message,e.message,"the status shouldn't have changed.")
}store.recordDidChange(undefined,undefined,storeKey3);d=store.readStatus(storeKey3);
equals(d,SC.Record.READY_NEW,"the status shouldn't have changed.");store.recordDidChange(undefined,undefined,storeKey4);
d=store.readStatus(storeKey4);equals(d,SC.Record.READY_DIRTY,"the status shouldn't have changed.")
});var store,child,storeKey,json;module("SC.Store#removeDataHash",{setup:function(){store=SC.Store.create();
json={string:"string",number:23,bool:YES};storeKey=SC.Store.generateStoreKey();store.writeDataHash(storeKey,json,SC.Record.READY_CLEAN);
store.editables=null;child=store.chain()}});function testRemoveDataHash(){var d=store.revisions[storeKey];
equals(store.removeDataHash(storeKey,SC.Record.DESTROYED_CLEAN),store,"should return receiver");
equals(store.storeKeyEditState(storeKey),SC.Store.LOCKED,"new edit state should be locked");
equals(store.readDataHash(storeKey),null,"should have NO json data");equals(store.readStatus(storeKey),SC.Record.DESTROYED_CLEAN,"should have new status");
equals(store.revisions[storeKey],d,"should not change revision");if(!SC.none(d)){ok(store.revisions.hasOwnProperty(storeKey),"should clone reference to revision")
}}test("edit state=LOCKED",function(){equals(store.storeKeyEditState(storeKey),SC.Store.LOCKED,"precond - edit state should be locked");
testRemoveDataHash()});test("edit state=EDITABLE",function(){store.readEditableDataHash(storeKey);
equals(store.storeKeyEditState(storeKey),SC.Store.EDITABLE,"precond - edit state should be editable");
testRemoveDataHash()});test("remove a non-existing hash",function(){storeKey=SC.Store.generateStoreKey();
equals(store.readDataHash(storeKey),null,"precond - store should not have a data hash for store key yet");
equals(store.removeDataHash(storeKey,SC.Record.DESTROYED_CLEAN),store,"should return receiver");
equals(store.storeKeyEditState(storeKey),SC.Store.LOCKED,"new status should be locked");
equals(store.readDataHash(storeKey),null,"should still be null");equals(store.readStatus(storeKey),SC.Record.DESTROYED_CLEAN,"should have new record status")
});test("change should propogate to child if child edit state = INHERITED",function(){equals(child.storeKeyEditState(storeKey),SC.Store.INHERITED,"precond - child edit state should be INHERITED");
store.removeDataHash(storeKey,SC.Record.DESTROYED_CLEAN);same(child.readDataHash(storeKey),null,"child should pick up change");
equals(child.readStatus(storeKey),SC.Record.DESTROYED_CLEAN,"child should pick up new status")
});function testLockedOrEditableChild(){store.removeDataHash(storeKey,SC.Record.DESTROYED_CLEAN);
same(child.readDataHash(storeKey),json,"child should NOT pick up change");equals(child.readStatus(storeKey),SC.Record.READY_CLEAN,"child should pick up new status")
}test("change should not propogate to child if child edit state = LOCKED",function(){child.readDataHash(storeKey);
equals(child.storeKeyEditState(storeKey),SC.Store.LOCKED,"precond - child edit state should be LOCKED");
testLockedOrEditableChild()});test("change should not propogate to child if child edit state = EDITABLE",function(){child.readEditableDataHash(storeKey);
equals(child.storeKeyEditState(storeKey),SC.Store.EDITABLE,"precond - child edit state should be EDITABLE");
testLockedOrEditableChild()});var store,storeKey1,storeKey2,storeKey3,storeKey4,storeKey5,storeKey6;
var storeKey7,storeKey8,json,json1,json2,json3,json4,json5,json6;var json7,json8;
module("SC.Store#retrieveRecord",{setup:function(){store=SC.Store.create();json1={guid:"retrieveGUID1",string:"string",number:23,bool:YES};
json2={guid:"retrieveGUID2",string:"string",number:23,bool:YES};json3={guid:"retrieveGUID3",string:"string",number:23,bool:YES};
json4={guid:"retrieveGUID4",string:"string",number:23,bool:YES};json5={guid:"retrieveGUID5",string:"string",number:23,bool:YES};
json6={guid:"retrieveGUID6",string:"string",number:23,bool:YES};json7={guid:"retrieveGUID7",string:"string",number:23,bool:YES};
json8={guid:"retrieveGUID8",string:"string",number:23,bool:YES};storeKey1=SC.Store.generateStoreKey();
store.writeDataHash(storeKey1,json1,SC.Record.EMPTY);storeKey2=SC.Store.generateStoreKey();
store.writeDataHash(storeKey2,json2,SC.Record.ERROR);storeKey3=SC.Store.generateStoreKey();
store.writeDataHash(storeKey3,json3,SC.Record.DESTROYED_CLEAN);storeKey4=SC.Store.generateStoreKey();
store.writeDataHash(storeKey4,json4,SC.Record.BUSY_DESTROYING);storeKey5=SC.Store.generateStoreKey();
store.writeDataHash(storeKey5,json5,SC.Record.BUSY_CREATING);storeKey6=SC.Store.generateStoreKey();
store.writeDataHash(storeKey6,json6,SC.Record.BUSY_COMMITTING);storeKey7=SC.Store.generateStoreKey();
store.writeDataHash(storeKey7,json7,SC.Record.DESTROYED_DIRTY);storeKey8=SC.Store.generateStoreKey();
store.writeDataHash(storeKey8,json8,SC.Record.READY_CLEAN)}});function testStates(e){var k,d;
SC.RunLoop.begin();store.retrieveRecord(undefined,undefined,storeKey1,YES);d=store.readStatus(storeKey1);
if(e){equals(d,SC.Record.BUSY_LOADING,"the status should have changed to BUSY_LOADING")
}else{equals(d,SC.Record.ERROR,"the status should remain empty")}store.retrieveRecord(undefined,undefined,storeKey2,YES);
d=store.readStatus(storeKey2);if(e){equals(d,SC.Record.BUSY_LOADING,"the status should have changed to BUSY_LOADING")
}else{equals(d,SC.Record.ERROR,"the status should become empty")}store.retrieveRecord(undefined,undefined,storeKey3,YES);
d=store.readStatus(storeKey3);if(e){equals(d,SC.Record.BUSY_LOADING,"the status should have changed to BUSY_LOADING")
}else{equals(d,SC.Record.ERROR,"the status should become empty")}try{store.retrieveRecord(undefined,undefined,storeKey4,YES);
k=""}catch(l){k=l.message}equals(k,SC.Record.BUSY_ERROR.message,"should throw error");
try{store.retrieveRecord(undefined,undefined,storeKey5,YES);k=""}catch(j){k=j.message
}equals(k,SC.Record.BUSY_ERROR.message,"should throw error");try{store.retrieveRecord(undefined,undefined,storeKey6,YES);
k=""}catch(h){k=h.message}equals(k,SC.Record.BUSY_ERROR.message,"should throw error");
try{store.retrieveRecord(undefined,undefined,storeKey7,YES);k=""}catch(g){k=g.message
}equals(k,SC.Record.BAD_STATE_ERROR.message,"should throw error");store.retrieveRecord(undefined,undefined,storeKey8,YES);
d=store.readStatus(storeKey8);if(e){ok(SC.Record.BUSY_REFRESH|(d&3),"the status changed to BUSY_REFRESH.")
}else{equals(d,SC.Record.READY_CLEAN,"the status should remain ready clean")}SC.RunLoop.end()
}test("Retrieve a record without a data source",function(){testStates(NO)});test("Retrieve a record without a working data source and check for different errors and states",function(){var d=SC.DataSource.create({retrieveRecords:function(){return NO
}});store.set("dataSource",d);testStates(NO)});test("Retrieve a record with working data source and check for different errors and states",function(){var d=SC.DataSource.create({retrieveRecords:function(){return YES
}});store.set("dataSource",d);testStates(YES)});var store,child,storeKey,json;module("SC.Store#writeDataHash",{setup:function(){store=SC.Store.create();
json={string:"string",number:23,bool:YES};storeKey=SC.Store.generateStoreKey();child=store.chain()
}});function testWriteDataHash(){var e=store.revisions[storeKey];var d={foo:"bar"};
equals(store.writeDataHash(storeKey,d,SC.Record.READY_NEW),store,"should return receiver");
equals(store.storeKeyEditState(storeKey),SC.Store.EDITABLE,"new edit state should be editable");
equals(store.readDataHash(storeKey),d,"should have new json data hash");equals(store.readStatus(storeKey),SC.Record.READY_NEW,"should have new status");
equals(store.revisions[storeKey],e,"should not change revision");if(!SC.none(e)){ok(store.revisions.hasOwnProperty(storeKey),"should clone reference to revision")
}}test("edit state=LOCKED - also writes a NEW hash",function(){equals(store.storeKeyEditState(storeKey),SC.Store.LOCKED,"precond - edit state should be locked");
testWriteDataHash()});test("edit state=EDITABLE - also overwrites an EXISTING hash",function(){store.writeDataHash(storeKey,{foo:"bar"});
equals(store.storeKeyEditState(storeKey),SC.Store.EDITABLE,"precond - edit state should be editable");
testWriteDataHash()});test("change should propogate to child if child edit state = INHERITED",function(){equals(child.storeKeyEditState(storeKey),SC.Store.INHERITED,"precond - child edit state should be INHERITED");
var d={version:2};store.writeDataHash(storeKey,d,SC.Record.READY_NEW);same(child.readDataHash(storeKey),d,"child should pick up change");
equals(child.readStatus(storeKey),SC.Record.READY_NEW,"child should pick up new status")
});function testLockedOrEditableChild(){var d={version:2};store.writeDataHash(storeKey,d,SC.Record.READY_NEW);
same(child.readDataHash(storeKey),json,"child should NOT pick up change");equals(child.readStatus(storeKey),SC.Record.READY_CLEAN,"child should pick up new status")
}test("change should not propogate to child if child edit state = LOCKED",function(){store.writeDataHash(storeKey,json,SC.Record.READY_CLEAN);
store.editables=null;child.readDataHash(storeKey);equals(child.storeKeyEditState(storeKey),SC.Store.LOCKED,"precond - child edit state should be LOCKED");
testLockedOrEditableChild()});test("change should not propogate to child if child edit state = EDITABLE",function(){store.writeDataHash(storeKey,json,SC.Record.READY_CLEAN);
store.editables=null;child.readEditableDataHash(storeKey);equals(child.storeKeyEditState(storeKey),SC.Store.EDITABLE,"precond - child edit state should be EDITABLE");
testLockedOrEditableChild()});(function(){var e=Date,d=e.prototype,h=e.CultureInfo,l=function(o,n){if(!n){n=2
}return("000"+o).slice(n*-1)};d.clearTime=function(){this.setHours(0);this.setMinutes(0);
this.setSeconds(0);this.setMilliseconds(0);return this};d.setTimeToNow=function(){var o=new Date();
this.setHours(o.getHours());this.setMinutes(o.getMinutes());this.setSeconds(o.getSeconds());
this.setMilliseconds(o.getMilliseconds());return this};e.today=function(){return new Date().clearTime()
};e.compare=function(o,n){if(isNaN(o)||isNaN(n)){throw new Error(o+" - "+n)}else{if(o instanceof Date&&n instanceof Date){return(o<n)?-1:(o>n)?1:0
}else{throw new TypeError(o+" - "+n)}}};e.equals=function(o,n){return(o.compareTo(n)===0)
};e.getDayNumberFromName=function(u){var A=h.dayNames,p=h.abbreviatedDayNames,z=h.shortestDayNames,y=u.toLowerCase();
for(var x=0;x<A.length;x++){if(A[x].toLowerCase()==y||p[x].toLowerCase()==y||z[x].toLowerCase()==y){return x
}}return -1};e.getMonthNumberFromName=function(p){var y=h.monthNames,o=h.abbreviatedMonthNames,x=p.toLowerCase();
for(var u=0;u<y.length;u++){if(y[u].toLowerCase()==x||o[u].toLowerCase()==x){return u
}}return -1};e.isLeapYear=function(n){return((n%4===0&&n%100!==0)||n%400===0)};e.getDaysInMonth=function(n,o){return[31,(e.isLeapYear(n)?29:28),31,30,31,30,31,31,30,31,30,31][o]
};e.getTimezoneAbbreviation=function(u){var s=h.timezones,o;for(var n=0;n<s.length;
n++){if(s[n].offset===u){return s[n].name}}return null};e.getTimezoneOffset=function(n){var u=h.timezones,s;
for(var o=0;o<u.length;o++){if(u[o].name===n.toUpperCase()){return u[o].offset}}return null
};d.clone=function(){return new Date(this.getTime())};d.compareTo=function(n){return Date.compare(this,n)
};d.equals=function(n){return Date.equals(this,n||new Date())};d.between=function(o,n){return this.getTime()>=o.getTime()&&this.getTime()<=n.getTime()
};d.isAfter=function(n){return this.compareTo(n||new Date())===1};d.isBefore=function(n){return(this.compareTo(n||new Date())===-1)
};d.isToday=d.isSameDay=function(n){return this.clone().clearTime().equals((n||new Date()).clone().clearTime())
};d.addMilliseconds=function(n){this.setMilliseconds(this.getMilliseconds()+n*1);
return this};d.addSeconds=function(n){return this.addMilliseconds(n*1000)};d.addMinutes=function(n){return this.addMilliseconds(n*60000)
};d.addHours=function(n){return this.addMilliseconds(n*3600000)};d.addDays=function(n){this.setDate(this.getDate()+n*1);
return this};d.addWeeks=function(n){return this.addDays(n*7)};d.addMonths=function(o){var p=this.getDate();
this.setDate(1);this.setMonth(this.getMonth()+o*1);this.setDate(Math.min(p,e.getDaysInMonth(this.getFullYear(),this.getMonth())));
return this};d.addYears=function(n){return this.addMonths(n*12)};d.add=function(o){if(typeof o=="number"){this._orient=o;
return this}var n=o;if(n.milliseconds){this.addMilliseconds(n.milliseconds)}if(n.seconds){this.addSeconds(n.seconds)
}if(n.minutes){this.addMinutes(n.minutes)}if(n.hours){this.addHours(n.hours)}if(n.weeks){this.addWeeks(n.weeks)
}if(n.months){this.addMonths(n.months)}if(n.years){this.addYears(n.years)}if(n.days){this.addDays(n.days)
}return this};var j,k,g;d.getWeek=function(){var B,A,z,y,x,u,p,o,D,C;j=(!j)?this.getFullYear():j;
k=(!k)?this.getMonth()+1:k;g=(!g)?this.getDate():g;if(k<=2){B=j-1;A=(B/4|0)-(B/100|0)+(B/400|0);
z=((B-1)/4|0)-((B-1)/100|0)+((B-1)/400|0);D=A-z;x=0;u=g-1+(31*(k-1))}else{B=j;A=(B/4|0)-(B/100|0)+(B/400|0);
z=((B-1)/4|0)-((B-1)/100|0)+((B-1)/400|0);D=A-z;x=D+1;u=g+((153*(k-3)+2)/5)+58+D}p=(B+A)%7;
y=(u+p-x)%7;o=(u+3-y)|0;if(o<0){C=53-((p-D)/5|0)}else{if(o>364+D){C=1}else{C=(o/7|0)+1
}}j=k=g=null;return C};d.getISOWeek=function(){j=this.getUTCFullYear();k=this.getUTCMonth()+1;
g=this.getUTCDate();return l(this.getWeek())};d.setWeek=function(o){return this.moveToDayOfWeek(1).addWeeks(o-this.getWeek())
};var m=function(u,s,o,p){if(typeof u=="undefined"){return false}else{if(typeof u!="number"){throw new TypeError(u+" is not a Number.")
}else{if(u<s||u>o){throw new RangeError(u+" is not a valid value for "+p+".")}}}return true
};e.validateMillisecond=function(n){return m(n,0,999,"millisecond")};e.validateSecond=function(n){return m(n,0,59,"second")
};e.validateMinute=function(n){return m(n,0,59,"minute")};e.validateHour=function(n){return m(n,0,23,"hour")
};e.validateDay=function(o,n,p){return m(o,1,e.getDaysInMonth(n,p),"day")};e.validateMonth=function(n){return m(n,0,11,"month")
};e.validateYear=function(n){return m(n,0,9999,"year")};d.set=function(n){if(e.validateMillisecond(n.millisecond)){this.addMilliseconds(n.millisecond-this.getMilliseconds())
}if(e.validateSecond(n.second)){this.addSeconds(n.second-this.getSeconds())}if(e.validateMinute(n.minute)){this.addMinutes(n.minute-this.getMinutes())
}if(e.validateHour(n.hour)){this.addHours(n.hour-this.getHours())}if(e.validateMonth(n.month)){this.addMonths(n.month-this.getMonth())
}if(e.validateYear(n.year)){this.addYears(n.year-this.getFullYear())}if(e.validateDay(n.day,this.getFullYear(),this.getMonth())){this.addDays(n.day-this.getDate())
}if(n.timezone){this.setTimezone(n.timezone)}if(n.timezoneOffset){this.setTimezoneOffset(n.timezoneOffset)
}if(n.week&&m(n.week,0,53,"week")){this.setWeek(n.week)}return this};d.moveToFirstDayOfMonth=function(){return this.set({day:1})
};d.moveToLastDayOfMonth=function(){return this.set({day:e.getDaysInMonth(this.getFullYear(),this.getMonth())})
};d.moveToNthOccurrence=function(o,p){var n=0;if(p>0){n=p-1}else{if(p===-1){this.moveToLastDayOfMonth();
if(this.getDay()!==o){this.moveToDayOfWeek(o,-1)}return this}}return this.moveToFirstDayOfMonth().addDays(-1).moveToDayOfWeek(o,+1).addWeeks(n)
};d.moveToDayOfWeek=function(n,o){var p=(n-this.getDay()+7*(o||+1))%7;return this.addDays((p===0)?p+=7*(o||+1):p)
};d.moveToMonth=function(p,n){var o=(p-this.getMonth()+12*(n||+1))%12;return this.addMonths((o===0)?o+=12*(n||+1):o)
};d.getOrdinalNumber=function(){return Math.ceil((this.clone().clearTime()-new Date(this.getFullYear(),0,1))/86400000)+1
};d.getTimezone=function(){return e.getTimezoneAbbreviation(this.getUTCOffset())};
d.setTimezoneOffset=function(p){var n=this.getTimezoneOffset(),o=Number(p)*-6/10;
return this.addMinutes(o-n)};d.setTimezone=function(n){return this.setTimezoneOffset(e.getTimezoneOffset(n))
};d.hasDaylightSavingTime=function(){return(Date.today().set({month:0,day:1}).getTimezoneOffset()!==Date.today().set({month:6,day:1}).getTimezoneOffset())
};d.isDaylightSavingTime=function(){return Date.today().set({month:0,day:1}).getTimezoneOffset()!=this.getTimezoneOffset()
};d.getUTCOffset=function(){var p=this.getTimezoneOffset()*-10/6,o;if(p<0){o=(p-10000).toString();
return o.charAt(0)+o.substr(2)}else{o=(p+10000).toString();return"+"+o.substr(1)}};
d.getElapsed=function(n){return(n||new Date())-this};if(!d.toISOString){d.toISOString=function(){function n(o){return o<10?"0"+o:o
}return'"'+this.getUTCFullYear()+"-"+n(this.getUTCMonth()+1)+"-"+n(this.getUTCDate())+"T"+n(this.getUTCHours())+":"+n(this.getUTCMinutes())+":"+n(this.getUTCSeconds())+'Z"'
}}d._toString=d.toString;d.toString=function(p){var n=this;if(p&&p.length==1){var s=h.formatPatterns;
n.t=n.toString;switch(p){case"d":return n.t(s.shortDate);case"D":return n.t(s.longDate);
case"F":return n.t(s.fullDateTime);case"m":return n.t(s.monthDay);case"r":return n.t(s.rfc1123);
case"s":return n.t(s.sortableDateTime);case"t":return n.t(s.shortTime);case"T":return n.t(s.longTime);
case"u":return n.t(s.universalSortableDateTime);case"y":return n.t(s.yearMonth)}}var o=function(u){switch(u*1){case 1:case 21:case 31:return"st";
case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}};return p?p.replace(/(\\)?(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|S)/g,function(u){if(u.charAt(0)==="\\"){return u.replace("\\","")
}n.h=n.getHours;switch(u){case"hh":return l(n.h()<13?(n.h()===0?12:n.h()):(n.h()-12));
case"h":return n.h()<13?(n.h()===0?12:n.h()):(n.h()-12);case"HH":return l(n.h());
case"H":return n.h();case"mm":return l(n.getMinutes());case"m":return n.getMinutes();
case"ss":return l(n.getSeconds());case"s":return n.getSeconds();case"yyyy":return l(n.getFullYear(),4);
case"yy":return l(n.getFullYear());case"dddd":return h.dayNames[n.getDay()];case"ddd":return h.abbreviatedDayNames[n.getDay()];
case"dd":return l(n.getDate());case"d":return n.getDate();case"MMMM":return h.monthNames[n.getMonth()];
case"MMM":return h.abbreviatedMonthNames[n.getMonth()];case"MM":return l((n.getMonth()+1));
case"M":return n.getMonth()+1;case"t":return n.h()<12?h.amDesignator.substring(0,1):h.pmDesignator.substring(0,1);
case"tt":return n.h()<12?h.amDesignator:h.pmDesignator;case"S":return o(n.getDate());
default:return u}}):this._toString()}}());Date.CultureInfo={name:"en-US",englishName:"English (United States)",nativeName:"English (United States)",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortestDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],firstLetterDayNames:["S","M","T","W","T","F","S"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],amDesignator:"AM",pmDesignator:"PM",firstDayOfWeek:0,twoDigitYearMax:2029,dateElementOrder:"mdy",formatPatterns:{shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"MMMM dd",yearMonth:"MMMM, yyyy"},regexPatterns:{jan:/^jan(uary)?/i,feb:/^feb(ruary)?/i,mar:/^mar(ch)?/i,apr:/^apr(il)?/i,may:/^may/i,jun:/^jun(e)?/i,jul:/^jul(y)?/i,aug:/^aug(ust)?/i,sep:/^sep(t(ember)?)?/i,oct:/^oct(ober)?/i,nov:/^nov(ember)?/i,dec:/^dec(ember)?/i,sun:/^su(n(day)?)?/i,mon:/^mo(n(day)?)?/i,tue:/^tu(e(s(day)?)?)?/i,wed:/^we(d(nesday)?)?/i,thu:/^th(u(r(s(day)?)?)?)?/i,fri:/^fr(i(day)?)?/i,sat:/^sa(t(urday)?)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,add:/^(\+|after|from)/i,subtract:/^(\-|before|ago)/i,yesterday:/^yesterday/i,today:/^t(oday)?/i,tomorrow:/^tomorrow/i,now:/^n(ow)?/i,millisecond:/^ms|milli(second)?s?/i,second:/^sec(ond)?s?/i,minute:/^min(ute)?s?/i,hour:/^h(ou)?rs?/i,week:/^w(ee)?k/i,month:/^m(o(nth)?s?)?/i,day:/^d(ays?)?/i,year:/^y((ea)?rs?)?/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt)/i,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a|p)/i},abbreviatedTimeZoneStandard:{GMT:"-000",EST:"-0400",CST:"-0500",MST:"-0600",PST:"-0700"},abbreviatedTimeZoneDST:{GMT:"-000",EDT:"-0500",CDT:"-0600",MDT:"-0700",PDT:"-0800"}};
(function(){var g=Date,e=g.prototype,h=g.CultureInfo,d=[],j=function(m,k){if(!k){k=2
}return("000"+m).slice(k*-1)};g.normalizeFormat=function(l){d=[];var k=new Date().$format(l);
return d.join("")};g.strftime=function(l,k){return new Date(k*1000).$format(l)};g.strtotime=function(k){var l=g.parse(k);
l.addMinutes(l.getTimezoneOffset()*-1);return Math.round(g.UTC(l.getUTCFullYear(),l.getUTCMonth(),l.getUTCDate(),l.getUTCHours(),l.getUTCMinutes(),l.getUTCSeconds(),l.getUTCMilliseconds())/1000)
};e.$format=function(m){var k=this,n,l=function(o){d.push(o);return k.toString(o)
};return m?m.replace(/(%|\\)?.|%%/g,function(o){if(o.charAt(0)==="\\"||o.substring(0,2)==="%%"){return o.replace("\\","").replace("%%","%")
}switch(o){case"d":case"%d":return l("dd");case"D":case"%a":return l("ddd");case"j":case"%e":return l("d");
case"l":case"%A":return l("dddd");case"N":case"%u":return k.getDay()+1;case"S":return l("S");
case"w":case"%w":return k.getDay();case"z":return k.getOrdinalNumber();case"%j":return j(k.getOrdinalNumber(),3);
case"%U":var u=k.clone().set({month:0,day:1}).addDays(-1).moveToDayOfWeek(0),s=k.clone().addDays(1).moveToDayOfWeek(0,-1);
return(s<u)?"00":j((s.getOrdinalNumber()-u.getOrdinalNumber())/7+1);case"W":case"%V":return k.getISOWeek();
case"%W":return j(k.getWeek());case"F":case"%B":return l("MMMM");case"m":case"%m":return l("MM");
case"M":case"%b":case"%h":return l("MMM");case"n":return l("M");case"t":return g.getDaysInMonth(k.getFullYear(),k.getMonth());
case"L":return(g.isLeapYear(k.getFullYear()))?1:0;case"o":case"%G":return k.setWeek(k.getISOWeek()).toString("yyyy");
case"%g":return k.$format("%G").slice(-2);case"Y":case"%Y":return l("yyyy");case"y":case"%y":return l("yy");
case"a":case"%p":return l("tt").toLowerCase();case"A":return l("tt").toUpperCase();
case"g":case"%I":return l("h");case"G":return l("H");case"h":return l("hh");case"H":case"%H":return l("HH");
case"i":case"%M":return l("mm");case"s":case"%S":return l("ss");case"u":return j(k.getMilliseconds(),3);
case"I":return(k.isDaylightSavingTime())?1:0;case"O":return k.getUTCOffset();case"P":n=k.getUTCOffset();
return n.substring(0,n.length-2)+":"+n.substring(n.length-2);case"e":case"T":case"%z":case"%Z":return k.getTimezone();
case"Z":return k.getTimezoneOffset()*-60;case"B":var p=new Date();return Math.floor(((p.getHours()*3600)+(p.getMinutes()*60)+p.getSeconds()+(p.getTimezoneOffset()+60)*60)/86.4);
case"c":return k.toISOString().replace(/\"/g,"");case"U":return g.strtotime("now");
case"%c":return l("d")+" "+l("t");case"%C":return Math.floor(k.getFullYear()/100+1);
case"%D":return l("MM/dd/yy");case"%n":return"\\n";case"%t":return"\\t";case"%r":return l("hh:mm tt");
case"%R":return l("H:mm");case"%T":return l("H:mm:ss");case"%x":return l("d");case"%X":return l("t");
default:d.push(o);return o}}):this._toString()};if(!e.format){e.format=e.$format}}());
/* @license Copyright (c) 2006-2007, Coolite Inc. (http://www.coolite.com/). All rights reserved.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

See also:
	http://www.datejs.com/license/
	http://www.datejs.com/

*/
(function(){Date.Parsing={Exception:function(j){this.message="Parse error at '"+j.substring(0,10)+" ...'"
}};var d=Date.Parsing;var g=d.Operators={rtoken:function(j){return function(o){var p=o.match(j);
if(p){return([p[0],o.substring(p[0].length)])}else{throw new d.Exception(o)}}},token:function(j){return function(o){return g.rtoken(new RegExp("^s*"+o+"s*"))(o)
}},stoken:function(j){return g.rtoken(new RegExp("^"+j))},until:function(j){return function(o){var p=[],x=null;
while(o.length){try{x=j.call(this,o)}catch(u){p.push(x[0]);o=x[1];continue}break}return[p,o]
}},many:function(j){return function(o){var x=[],p=null;while(o.length){try{p=j.call(this,o)
}catch(u){return[x,o]}x.push(p[0]);o=p[1]}return[x,o]}},optional:function(j){return function(o){var p=null;
try{p=j.call(this,o)}catch(u){return[null,o]}return[p[0],p[1]]}},not:function(j){return function(o){try{j.call(this,o)
}catch(p){return[null,o]}throw new d.Exception(o)}},ignore:function(j){return j?function(o){var p=null;
p=j.call(this,o);return[null,p[1]]}:null},product:function(){var o=arguments[0],p=Array.prototype.slice.call(arguments,1),s=[];
for(var j=0;j<o.length;j++){s.push(g.each(o[j],p))}return s},cache:function(p){var j={},o=null;
return function(u){try{o=j[u]=(j[u]||p.call(this,u))}catch(x){o=j[u]=x}if(o instanceof d.Exception){throw o
}else{return o}}},any:function(){var j=arguments;return function(p){var u=null;for(var o=0;
o<j.length;o++){if(j[o]==null){continue}try{u=(j[o].call(this,p))}catch(x){u=null
}if(u){return u}}throw new d.Exception(p)}},each:function(){var j=arguments;return function(p){var y=[],u=null;
for(var o=0;o<j.length;o++){if(j[o]==null){continue}try{u=(j[o].call(this,p))}catch(x){throw new d.Exception(p)
}y.push(u[0]);p=u[1]}return[y,p]}},all:function(){var o=arguments,j=j;return j.each(j.optional(o))
},sequence:function(j,o,p){o=o||g.rtoken(/^\s*/);p=p||null;if(j.length==1){return j[0]
}return function(z){var A=null,B=null;var D=[];for(var y=0;y<j.length;y++){try{A=j[y].call(this,z)
}catch(C){break}D.push(A[0]);try{B=o.call(this,A[1])}catch(x){B=null;break}z=B[1]
}if(!A){throw new d.Exception(z)}if(B){throw new d.Exception(B[1])}if(p){try{A=p.call(this,A[1])
}catch(u){throw new d.Exception(A[1])}}return[D,(A?A[1]:z)]}},between:function(o,s,j){j=j||o;
var u=g.each(g.ignore(o),s,g.ignore(j));return function(p){var x=u.call(this,p);return[[x[0][0],r[0][2]],x[1]]
}},list:function(j,o,s){o=o||g.rtoken(/^\s*/);s=s||null;return(j instanceof Array?g.each(g.product(j.slice(0,-1),g.ignore(o)),j.slice(-1),g.ignore(s)):g.each(g.many(g.each(j,g.ignore(o))),px,g.ignore(s)))
},set:function(j,o,p){o=o||g.rtoken(/^\s*/);p=p||null;return function(I){var u=null,y=null,x=null,z=null,A=[[],I],H=false;
for(var C=0;C<j.length;C++){x=null;y=null;u=null;H=(j.length==1);try{u=j[C].call(this,I)
}catch(F){continue}z=[[u[0]],u[1]];if(u[1].length>0&&!H){try{x=o.call(this,u[1])}catch(G){H=true
}}else{H=true}if(!H&&x[1].length===0){H=true}if(!H){var D=[];for(var B=0;B<j.length;
B++){if(C!=B){D.push(j[B])}}y=g.set(D,o).call(this,x[1]);if(y[0].length>0){z[0]=z[0].concat(y[0]);
z[1]=y[1]}}if(z[1].length<A[1].length){A=z}if(A[1].length===0){break}}if(A[0].length===0){return A
}if(p){try{x=p.call(this,A[1])}catch(E){throw new d.Exception(A[1])}A[1]=x[1]}return A
}},forward:function(j,o){return function(p){return j[o].call(this,p)}},replace:function(o,j){return function(p){var u=o.call(this,p);
return[j,u[1]]}},process:function(o,j){return function(p){var u=o.call(this,p);return[j.call(this,u[0]),u[1]]
}},min:function(j,o){return function(p){var u=o.call(this,p);if(u[0].length<j){throw new d.Exception(p)
}return u}}};var n=function(j){return function(){var o=null,u=[];if(arguments.length>1){o=Array.prototype.slice.call(arguments)
}else{if(arguments[0] instanceof Array){o=arguments[0]}}if(o){for(var s=0,p=o.shift();
s<p.length;s++){o.unshift(p[s]);u.push(j.apply(null,o));o.shift();return u}}else{return j.apply(null,arguments)
}}};var m="optional not ignore cache".split(/\s/);for(var h=0;h<m.length;h++){g[m[h]]=n(g[m[h]])
}var l=function(j){return function(){if(arguments[0] instanceof Array){return j.apply(null,arguments[0])
}else{return j.apply(null,arguments)}}};var k="each any all".split(/\s/);for(var e=0;
e<k.length;e++){g[k[e]]=l(g[k[e]])}}());(function(){var k=Date,s=k.prototype,l=k.CultureInfo;
var m=function(u){var x=[];for(var g=0;g<u.length;g++){if(u[g] instanceof Array){x=x.concat(m(u[g]))
}else{if(u[g]){x.push(u[g])}}}return x};k.Grammar={};k.Translator={hour:function(g){return function(){this.hour=Number(g)
}},minute:function(g){return function(){this.minute=Number(g)}},second:function(g){return function(){this.second=Number(g)
}},meridian:function(g){return function(){this.meridian=g.slice(0,1).toLowerCase()
}},timezone:function(g){return function(){var u=g.replace(/[^\d\+\-]/g,"");if(u.length){this.timezoneOffset=Number(u)
}else{this.timezone=g.toLowerCase()}}},day:function(g){var u=g[0];return function(){this.day=Number(u.match(/\d+/)[0])
}},month:function(g){return function(){this.month=(g.length==3)?"jan feb mar apr may jun jul aug sep oct nov dec".indexOf(g)/4:Number(g)-1
}},year:function(g){return function(){var u=Number(g);this.year=((g.length>2)?u:(u+(((u+2000)<l.twoDigitYearMax)?2000:1900)))
}},rday:function(g){return function(){switch(g){case"yesterday":this.days=-1;break;
case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0;
this.now=true;break}}},finishExact:function(g){g=(g instanceof Array)?g:[g];for(var y=0;
y<g.length;y++){if(g[y]){g[y].call(this)}}var u=new Date();if((this.hour||this.minute)&&(!this.month&&!this.year&&!this.day)){this.day=u.getDate()
}if(!this.year){this.year=u.getFullYear()}if(!this.month&&this.month!==0){this.month=u.getMonth()
}if(!this.day){this.day=1}if(!this.hour){this.hour=0}if(!this.minute){this.minute=0
}if(!this.second){this.second=0}if(this.meridian&&this.hour){if(this.meridian=="p"&&this.hour<12){this.hour=this.hour+12
}else{if(this.meridian=="a"&&this.hour==12){this.hour=0}}}if(this.day>k.getDaysInMonth(this.year,this.month)){throw new RangeError(this.day+" is not a valid value for days.")
}var z=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);
if(this.timezone){z.set({timezone:this.timezone})}else{if(this.timezoneOffset){z.set({timezoneOffset:this.timezoneOffset})
}}return z},finish:function(g){g=(g instanceof Array)?m(g):[g];if(g.length===0){return null
}for(var B=0;B<g.length;B++){if(typeof g[B]=="function"){g[B].call(this)}}var y=k.today();
if(this.now&&!this.unit&&!this.operator){return new Date()}else{if(this.now){y=new Date()
}}var C=!!(this.days&&this.days!==null||this.orient||this.operator);var D,A,z;z=((this.orient=="past"||this.operator=="subtract")?-1:1);
if(!this.now&&"hour minute second".indexOf(this.unit)!=-1){y.setTimeToNow()}if(this.month||this.month===0){if("year day hour minute second".indexOf(this.unit)!=-1){this.value=this.month+1;
this.month=null;C=true}}if(!C&&this.weekday&&!this.day&&!this.days){var u=Date[this.weekday]();
this.day=u.getDate();if(!this.month){this.month=u.getMonth()}this.year=u.getFullYear()
}if(C&&this.weekday&&this.unit!="month"){this.unit="day";D=(k.getDayNumberFromName(this.weekday)-y.getDay());
A=7;this.days=D?((D+(z*A))%A):(z*A)}if(this.month&&this.unit=="day"&&this.operator){this.value=(this.month+1);
this.month=null}if(this.value!=null&&this.month!=null&&this.year!=null){this.day=this.value*1
}if(this.month&&!this.day&&this.value){y.set({day:this.value*1});if(!C){this.day=this.value*1
}}if(!this.month&&this.value&&this.unit=="month"&&!this.now){this.month=this.value;
C=true}if(C&&(this.month||this.month===0)&&this.unit!="year"){this.unit="month";D=(this.month-y.getMonth());
A=12;this.months=D?((D+(z*A))%A):(z*A);this.month=null}if(!this.unit){this.unit="day"
}if(!this.value&&this.operator&&this.operator!==null&&this[this.unit+"s"]&&this[this.unit+"s"]!==null){this[this.unit+"s"]=this[this.unit+"s"]+((this.operator=="add")?1:-1)+(this.value||0)*z
}else{if(this[this.unit+"s"]==null||this.operator!=null){if(!this.value){this.value=1
}this[this.unit+"s"]=this.value*z}}if(this.meridian&&this.hour){if(this.meridian=="p"&&this.hour<12){this.hour=this.hour+12
}else{if(this.meridian=="a"&&this.hour==12){this.hour=0}}}if(this.weekday&&!this.day&&!this.days){var u=Date[this.weekday]();
this.day=u.getDate();if(u.getMonth()!==y.getMonth()){this.month=u.getMonth()}}if((this.month||this.month===0)&&!this.day){this.day=1
}if(!this.orient&&!this.operator&&this.unit=="week"&&this.value&&!this.day&&!this.month){return Date.today().setWeek(this.value)
}if(C&&this.timezone&&this.day&&this.days){this.day=this.days}return(C)?y.add(this):y.set(this)
}};var n=k.Parsing.Operators,j=k.Grammar,p=k.Translator,e;j.datePartDelimiter=n.rtoken(/^([\s\-\.\,\/\x27]+)/);
j.timePartDelimiter=n.stoken(":");j.whiteSpace=n.rtoken(/^\s*/);j.generalDelimiter=n.rtoken(/^(([\s\,]|at|@|on)+)/);
var d={};j.ctoken=function(z){var y=d[z];if(!y){var A=l.regexPatterns;var x=z.split(/\s+/),u=[];
for(var g=0;g<x.length;g++){u.push(n.replace(n.rtoken(A[x[g]]),x[g]))}y=d[z]=n.any.apply(null,u)
}return y};j.ctoken2=function(g){return n.rtoken(l.regexPatterns[g])};j.h=n.cache(n.process(n.rtoken(/^(0[0-9]|1[0-2]|[1-9])/),p.hour));
j.hh=n.cache(n.process(n.rtoken(/^(0[0-9]|1[0-2])/),p.hour));j.H=n.cache(n.process(n.rtoken(/^([0-1][0-9]|2[0-3]|[0-9])/),p.hour));
j.HH=n.cache(n.process(n.rtoken(/^([0-1][0-9]|2[0-3])/),p.hour));j.m=n.cache(n.process(n.rtoken(/^([0-5][0-9]|[0-9])/),p.minute));
j.mm=n.cache(n.process(n.rtoken(/^[0-5][0-9]/),p.minute));j.s=n.cache(n.process(n.rtoken(/^([0-5][0-9]|[0-9])/),p.second));
j.ss=n.cache(n.process(n.rtoken(/^[0-5][0-9]/),p.second));j.hms=n.cache(n.sequence([j.H,j.m,j.s],j.timePartDelimiter));
j.t=n.cache(n.process(j.ctoken2("shortMeridian"),p.meridian));j.tt=n.cache(n.process(j.ctoken2("longMeridian"),p.meridian));
j.z=n.cache(n.process(n.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),p.timezone));
j.zz=n.cache(n.process(n.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),p.timezone));
j.zzz=n.cache(n.process(j.ctoken2("timezone"),p.timezone));j.timeSuffix=n.each(n.ignore(j.whiteSpace),n.set([j.tt,j.zzz]));
j.time=n.each(n.optional(n.ignore(n.stoken("T"))),j.hms,j.timeSuffix);j.d=n.cache(n.process(n.each(n.rtoken(/^([0-2]\d|3[0-1]|\d)/),n.optional(j.ctoken2("ordinalSuffix"))),p.day));
j.dd=n.cache(n.process(n.each(n.rtoken(/^([0-2]\d|3[0-1])/),n.optional(j.ctoken2("ordinalSuffix"))),p.day));
j.ddd=j.dddd=n.cache(n.process(j.ctoken("sun mon tue wed thu fri sat"),function(g){return function(){this.weekday=g
}}));j.M=n.cache(n.process(n.rtoken(/^(1[0-2]|0\d|\d)/),p.month));j.MM=n.cache(n.process(n.rtoken(/^(1[0-2]|0\d)/),p.month));
j.MMM=j.MMMM=n.cache(n.process(j.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),p.month));
j.y=n.cache(n.process(n.rtoken(/^(\d\d?)/),p.year));j.yy=n.cache(n.process(n.rtoken(/^(\d\d)/),p.year));
j.yyy=n.cache(n.process(n.rtoken(/^(\d\d?\d?\d?)/),p.year));j.yyyy=n.cache(n.process(n.rtoken(/^(\d\d\d\d)/),p.year));
e=function(){return n.each(n.any.apply(null,arguments),n.not(j.ctoken2("timeContext")))
};j.day=e(j.d,j.dd);j.month=e(j.M,j.MMM);j.year=e(j.yyyy,j.yy);j.orientation=n.process(j.ctoken("past future"),function(g){return function(){this.orient=g
}});j.operator=n.process(j.ctoken("add subtract"),function(g){return function(){this.operator=g
}});j.rday=n.process(j.ctoken("yesterday tomorrow today now"),p.rday);j.unit=n.process(j.ctoken("second minute hour day week month year"),function(g){return function(){this.unit=g
}});j.value=n.process(n.rtoken(/^\d\d?(st|nd|rd|th)?/),function(g){return function(){this.value=g.replace(/\D/g,"")
}});j.expression=n.set([j.rday,j.operator,j.value,j.unit,j.orientation,j.ddd,j.MMM]);
e=function(){return n.set(arguments,j.datePartDelimiter)};j.mdy=e(j.ddd,j.month,j.day,j.year);
j.ymd=e(j.ddd,j.year,j.month,j.day);j.dmy=e(j.ddd,j.day,j.month,j.year);j.date=function(g){return((j[l.dateElementOrder]||j.mdy).call(this,g))
};j.format=n.process(n.many(n.any(n.process(n.rtoken(/^(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(g){if(j[g]){return j[g]
}else{throw k.Parsing.Exception(g)}}),n.process(n.rtoken(/^[^dMyhHmstz]+/),function(g){return n.ignore(n.stoken(g))
}))),function(g){return n.process(n.each.apply(null,g),p.finishExact)});var o={};
var h=function(g){return o[g]=(o[g]||j.format(g)[0])};j.formats=function(u){if(u instanceof Array){var x=[];
for(var g=0;g<u.length;g++){x.push(h(u[g]))}return n.any.apply(null,x)}else{return h(u)
}};j._formats=j.formats(['"yyyy-MM-ddTHH:mm:ssZ"',"yyyy-MM-ddTHH:mm:ssZ","yyyy-MM-ddTHH:mm:ssz","yyyy-MM-ddTHH:mm:ss","yyyy-MM-ddTHH:mmZ","yyyy-MM-ddTHH:mmz","yyyy-MM-ddTHH:mm","ddd, MMM dd, yyyy H:mm:ss tt","ddd MMM d yyyy HH:mm:ss zzz","MMddyyyy","ddMMyyyy","Mddyyyy","ddMyyyy","Mdyyyy","dMyyyy","yyyy","Mdyy","dMyy","d"]);
j._start=n.process(n.set([j.date,j.time,j.expression],j.generalDelimiter,j.whiteSpace),p.finish);
j.start=function(g){try{var u=j._formats.call({},g);if(u[1].length===0){return u}}catch(x){}return j._start.call({},g)
};k._parse=k.parse;k.parse=function(g){var u=null;if(!g){return null}if(g instanceof Date){return g
}try{u=k.Grammar.start.call({},g.replace(/^\s*(\S*(\s+\S+)*)\s*$/,"$1"))}catch(x){return null
}return((u[1].length===0)?u[0]:null)};k.getParseFunction=function(u){var g=k.Grammar.formats(u);
return function(x){var y=null;try{y=g.call({},x)}catch(z){return null}return((y[1].length===0)?y[0]:null)
}};k.parseExact=function(g,u){return k.getParseFunction(u)(g)}}());Date.CultureInfo={name:"es-CO",englishName:"Spanish (Colombia)",nativeName:"Español (Colombia)",dayNames:["domingo","lunes","martes","miércoles","jueves","viernes","sábado"],abbreviatedDayNames:["dom","lun","mar","mié","jue","vie","sáb"],shortestDayNames:["do","lu","ma","mi","ju","vi","sá"],firstLetterDayNames:["d","l","m","m","j","v","s"],monthNames:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],abbreviatedMonthNames:["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"],amDesignator:"a.m.",pmDesignator:"p.m.",firstDayOfWeek:0,twoDigitYearMax:2029,dateElementOrder:"dmy",formatPatterns:{shortDate:"dd/MM/yyyy",longDate:"dddd, dd' de 'MMMM' de 'yyyy",shortTime:"hh:mm tt",longTime:"hh:mm:ss tt",fullDateTime:"dddd, dd' de 'MMMM' de 'yyyy hh:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"dd MMMM",yearMonth:"MMMM' de 'yyyy"},regexPatterns:{jan:/^ene(ro)?/i,feb:/^feb(rero)?/i,mar:/^mar(zo)?/i,apr:/^abr(il)?/i,may:/^may(o)?/i,jun:/^jun(io)?/i,jul:/^jul(io)?/i,aug:/^ago(sto)?/i,sep:/^sep(tiembre)?/i,oct:/^oct(ubre)?/i,nov:/^nov(iembre)?/i,dec:/^dic(iembre)?/i,sun:/^do(m(ingo)?)?/i,mon:/^lu(n(es)?)?/i,tue:/^ma(r(tes)?)?/i,wed:/^mi(é(rcoles)?)?/i,thu:/^ju(e(ves)?)?/i,fri:/^vi(e(rnes)?)?/i,sat:/^sá(b(ado)?)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,add:/^(\+|after|from)/i,subtract:/^(\-|before|ago)/i,yesterday:/^yesterday/i,today:/^t(oday)?/i,tomorrow:/^tomorrow/i,now:/^n(ow)?/i,millisecond:/^ms|milli(second)?s?/i,second:/^sec(ond)?s?/i,minute:/^min(ute)?s?/i,hour:/^h(ou)?rs?/i,week:/^w(ee)?k/i,month:/^m(o(nth)?s?)?/i,day:/^d(ays?)?/i,year:/^y((ea)?rs?)?/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt)/i,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a|p)/i},abbreviatedTimeZoneStandard:{GMT:"-000",EST:"-0400",CST:"-0500",MST:"-0600",PST:"-0700"},abbreviatedTimeZoneDST:{GMT:"-000",EDT:"-0500",CDT:"-0600",MDT:"-0700",PDT:"-0800"}};
(function(){var D=Date,o=D.prototype,E=D.CultureInfo,x=Number.prototype;o._orient=+1;
o._nth=null;o._is=false;o._same=false;o._isSecond=false;x._dateElement="day";o.next=function(){this._orient=+1;
return this};D.next=function(){return D.today().next()};o.last=o.prev=o.previous=function(){this._orient=-1;
return this};D.last=D.prev=D.previous=function(){return D.today().last()};o.is=function(){this._is=true;
return this};o.same=function(){this._same=true;this._isSecond=false;return this};
o.today=function(){return this.same().day()};o.weekday=function(){if(this._is){this._is=false;
return(!this.is().sat()&&!this.is().sun())}return false};o.at=function(j){return(typeof j==="string")?D.parse(this.toString("d")+" "+j):this.set(j)
};x.fromNow=x.after=function(j){var k={};k[this._dateElement]=this;return((!j)?new Date():j.clone()).add(k)
};x.ago=x.before=function(j){var k={};k[this._dateElement]=this*-1;return((!j)?new Date():j.clone()).add(k)
};var m=("sunday monday tuesday wednesday thursday friday saturday").split(/\s/),p=("january february march april may june july august september october november december").split(/\s/),u=("Millisecond Second Minute Hour Day Week Month Year").split(/\s/),y=("Milliseconds Seconds Minutes Hours Date Week Month FullYear").split(/\s/),e=("final first second third fourth fifth").split(/\s/),G;
o.toObject=function(){var k={};for(var j=0;j<u.length;j++){k[u[j].toLowerCase()]=this["get"+y[j]]()
}return k};D.fromObject=function(j){j.week=null;return Date.today().set(j)};var F=function(j){return function(){if(this._is){this._is=false;
return this.getDay()==j}if(this._nth!==null){if(this._isSecond){this.addSeconds(this._orient*-1)
}this._isSecond=false;var l=this._nth;this._nth=null;var k=this.clone().moveToLastDayOfMonth();
this.moveToNthOccurrence(j,l);if(this>k){throw new RangeError(D.getDayName(j)+" does not occur "+l+" times in the month of "+D.getMonthName(k.getMonth())+" "+k.getFullYear()+".")
}return this}return this.moveToDayOfWeek(j,this._orient)}};var n=function(j){return function(){var l=D.today(),k=j-l.getDay();
if(j===0&&E.firstDayOfWeek===1&&l.getDay()!==0){k=k+7}return l.addDays(k)}};for(var C=0;
C<m.length;C++){D[m[C].toUpperCase()]=D[m[C].toUpperCase().substring(0,3)]=C;D[m[C]]=D[m[C].substring(0,3)]=n(C);
o[m[C]]=o[m[C].substring(0,3)]=F(C)}var H=function(j){return function(){if(this._is){this._is=false;
return this.getMonth()===j}return this.moveToMonth(j,this._orient)}};var s=function(j){return function(){return D.today().set({month:j,day:1})
}};for(var B=0;B<p.length;B++){D[p[B].toUpperCase()]=D[p[B].toUpperCase().substring(0,3)]=B;
D[p[B]]=D[p[B].substring(0,3)]=s(B);o[p[B]]=o[p[B].substring(0,3)]=H(B)}var g=function(k){return function(){if(this._isSecond){this._isSecond=false;
return this}if(this._same){this._same=this._is=false;var K=this.toObject(),J=(arguments[0]||new Date()).toObject(),I="",l=k.toLowerCase();
for(var j=(u.length-1);j>-1;j--){I=u[j].toLowerCase();if(K[I]!=J[I]){return false
}if(l==I){break}}return true}if(k.substring(k.length-1)!="s"){k+="s"}return this["add"+k](this._orient)
}};var h=function(j){return function(){this._dateElement=j;return this}};for(var A=0;
A<u.length;A++){G=u[A].toLowerCase();o[G]=o[G+"s"]=g(u[A]);x[G]=x[G+"s"]=h(G)}o._ss=g("Second");
var d=function(j){return function(k){if(this._same){return this._ss(arguments[0])
}if(k||k===0){return this.moveToNthOccurrence(k,j)}this._nth=j;if(j===2&&(k===undefined||k===null)){this._isSecond=true;
return this.addSeconds(this._orient)}return this}};for(var z=0;z<e.length;z++){o[e[z]]=(z===0)?d(-1):d(z)
}}());var TimeSpan=function(s,m,j,n,h){var p="days hours minutes seconds milliseconds".split(/\s+/);
var g=function(u){return function(){return this[u]}};var o=function(u){return function(x){this[u]=x;
return this}};for(var l=0;l<p.length;l++){var e=p[l],d=e.slice(0,1).toUpperCase()+e.slice(1);
TimeSpan.prototype[e]=0;TimeSpan.prototype["get"+d]=g(e);TimeSpan.prototype["set"+d]=o(e)
}if(arguments.length==4){this.setDays(s);this.setHours(m);this.setMinutes(j);this.setSeconds(n)
}else{if(arguments.length==5){this.setDays(s);this.setHours(m);this.setMinutes(j);
this.setSeconds(n);this.setMilliseconds(h)}else{if(arguments.length==1&&typeof s=="number"){var k=(s<0)?-1:+1;
this.setMilliseconds(Math.abs(s));this.setDays(Math.floor(this.getMilliseconds()/86400000)*k);
this.setMilliseconds(this.getMilliseconds()%86400000);this.setHours(Math.floor(this.getMilliseconds()/3600000)*k);
this.setMilliseconds(this.getMilliseconds()%3600000);this.setMinutes(Math.floor(this.getMilliseconds()/60000)*k);
this.setMilliseconds(this.getMilliseconds()%60000);this.setSeconds(Math.floor(this.getMilliseconds()/1000)*k);
this.setMilliseconds(this.getMilliseconds()%1000);this.setMilliseconds(this.getMilliseconds()*k)
}}}this.getTotalMilliseconds=function(){return(this.getDays()*86400000)+(this.getHours()*3600000)+(this.getMinutes()*60000)+(this.getSeconds()*1000)
};this.compareTo=function(y){var x=new Date(1970,1,1,this.getHours(),this.getMinutes(),this.getSeconds()),u;
if(y===null){u=new Date(1970,1,1,0,0,0)}else{u=new Date(1970,1,1,y.getHours(),y.getMinutes(),y.getSeconds())
}return(x<u)?-1:(x>u)?1:0};this.equals=function(u){return(this.compareTo(u)===0)};
this.add=function(u){return(u===null)?this:this.addSeconds(u.getTotalMilliseconds()/1000)
};this.subtract=function(u){return(u===null)?this:this.addSeconds(-u.getTotalMilliseconds()/1000)
};this.addDays=function(u){return new TimeSpan(this.getTotalMilliseconds()+(u*86400000))
};this.addHours=function(u){return new TimeSpan(this.getTotalMilliseconds()+(u*3600000))
};this.addMinutes=function(u){return new TimeSpan(this.getTotalMilliseconds()+(u*60000))
};this.addSeconds=function(u){return new TimeSpan(this.getTotalMilliseconds()+(u*1000))
};this.addMilliseconds=function(u){return new TimeSpan(this.getTotalMilliseconds()+u)
};this.get12HourHour=function(){return(this.getHours()>12)?this.getHours()-12:(this.getHours()===0)?12:this.getHours()
};this.getDesignator=function(){return(this.getHours()<12)?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator
};this.toString=function(x){this._toString=function(){if(this.getDays()!==null&&this.getDays()>0){return this.getDays()+"."+this.getHours()+":"+this.p(this.getMinutes())+":"+this.p(this.getSeconds())
}else{return this.getHours()+":"+this.p(this.getMinutes())+":"+this.p(this.getSeconds())
}};this.p=function(y){return(y.toString().length<2)?"0"+y:y};var u=this;return x?x.replace(/dd?|HH?|hh?|mm?|ss?|tt?/g,function(y){switch(y){case"d":return u.getDays();
case"dd":return u.p(u.getDays());case"H":return u.getHours();case"HH":return u.p(u.getHours());
case"h":return u.get12HourHour();case"hh":return u.p(u.get12HourHour());case"m":return u.getMinutes();
case"mm":return u.p(u.getMinutes());case"s":return u.getSeconds();case"ss":return u.p(u.getSeconds());
case"t":return((u.getHours()<12)?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator).substring(0,1);
case"tt":return(u.getHours()<12)?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator
}}):this._toString()};return this};Date.prototype.getTimeOfDay=function(){return new TimeSpan(0,this.getHours(),this.getMinutes(),this.getSeconds(),this.getMilliseconds())
};var TimePeriod=function(u,k,j,z,x,o,l){var s="years months days hours minutes seconds milliseconds".split(/\s+/);
var n=function(D){return function(){return this[D]}};var e=function(D){return function(E){this[D]=E;
return this}};for(var y=0;y<s.length;y++){var h=s[y],g=h.slice(0,1).toUpperCase()+h.slice(1);
TimePeriod.prototype[h]=0;TimePeriod.prototype["get"+g]=n(h);TimePeriod.prototype["set"+g]=e(h)
}if(arguments.length==7){this.years=u;this.months=k;this.setDays(j);this.setHours(z);
this.setMinutes(x);this.setSeconds(o);this.setMilliseconds(l)}else{if(arguments.length==2&&arguments[0] instanceof Date&&arguments[1] instanceof Date){var C=u.clone();
var B=k.clone();var A=C.clone();var m=(C>B)?-1:+1;this.years=B.getFullYear()-C.getFullYear();
A.addYears(this.years);if(m==+1){if(A>B){if(this.years!==0){this.years--}}}else{if(A<B){if(this.years!==0){this.years++
}}}C.addYears(this.years);if(m==+1){while(C<B&&C.clone().addDays(Date.getDaysInMonth(C.getYear(),C.getMonth()))<B){C.addMonths(1);
this.months++}}else{while(C>B&&C.clone().addDays(-C.getDaysInMonth())>B){C.addMonths(-1);
this.months--}}var p=B-C;if(p!==0){var d=new TimeSpan(p);this.setDays(d.getDays());
this.setHours(d.getHours());this.setMinutes(d.getMinutes());this.setSeconds(d.getSeconds());
this.setMilliseconds(d.getMilliseconds())}}}return this};sc_require("coders/object");
SC.DesignCoder=SC.ObjectCoder.extend({extendMethodName:"design",encodeMethodName:"encodeDesign"});
sc_require("coders/object");SC.LocalizationCoder=SC.ObjectCoder.extend({extendMethodName:"localization",encodeMethodName:"encodeLoc"});
SC.ObjectCoder=SC.Object.extend({className:"SC.Object",extendMethodName:"extend",encodeMethodName:"encode",attributes:null,transform:function(e,d){if(SC.typeOf(e)===SC.T_ARRAY){e=e.map(function(g){return this.transform(g,d)
},this);e="["+e+"]"}else{e=d.call(this,e)}return e},js:function(e,g,d){if(g===undefined){g=e;
e=undefined}g=this.transform(g,function(h){return(h===null)?"null":d?d.call(this,h):h
});if(e!==undefined&&(g!==undefined)){this.attributes[e]=g;return this}else{return g
}},string:function(d,e){return this.js(d,e,function(g){return'"'+g.replace(/"/g,'\\"')+'"'
})},number:function(d,e){return this.js(d,e,function(g){return g.toString()})},bool:function(d,e){return this.js(d,e,function(g){return g?"YES":"NO"
})},encode:function(d,g,e){if(e===undefined&&g instanceof Function){e=g;g=d;d=undefined
}return this.js(d,g,function(h){if(e){h=e.call(this,h,null,null)}switch(SC.typeOf(h)){case SC.T_STRING:h=this.string(h);
break;case SC.T_NUMBER:h=this.number(h);break;case SC.T_BOOL:h=this.bool(h);break;
case SC.T_ARRAY:h=this.array(h,e);break;case SC.T_HASH:h=this.hash(h,e);break;default:h=h?this.object(h):this.js(h)
}return h})},hash:function(d,g,e){if(e===undefined&&g instanceof Function){e=g;g=d;
d=undefined}return this.js(d,g,function(h){var j=[];for(var k in h){if(!h.hasOwnProperty(k)){continue
}j.push("%@: %@".fmt(this.encode(k),this.encode(h[k],e)))}return"{%@}".fmt(j.join(","))
})},array:function(d,g,e){if(e===undefined&&g instanceof Function){e=g;g=d;d=undefined
}g=g.map(function(h){return this.encode(h,e)},this);g="[%@]".fmt(g.join(","));return this.js(d,g)
},object:function(d,e){return this.js(d,e,function(g){return this.constructor.encode(g,this)
})},spaces:function(){var d=this.context?this.context.get("spaces"):"";d=d+"  ";return d
}.property().cacheable(),emit:function(){if(this.invalid){return undefined}var h=[],g=this.attributes,j;
var e=this.get("extendMethodName");var d=this.get("spaces");for(j in g){if(!g.hasOwnProperty(j)){continue
}h.push("%@: %@".fmt(j,g[j]))}if(h.length<=0){return"%@1%@2.%@3({})".fmt(d,this.className,e)
}else{h=h.join(",");return"%@2.%@3({%@4})".fmt(d,this.className,e,h)}},begin:function(g){var d=this.get("encodeMethodName");
if(SC.typeOf(g[d])!==SC.T_FUNCTION){throw SC.$error("Cannot encode %@ because it does not respond to %@()".fmt(g,d))
}this.set("className",SC._object_className(g.constructor));var e=g[d](this);this.invalid=e===NO;
return this},init:function(){arguments.callee.base.apply(this,arguments);this.set("attributes",{})
},destroy:function(){arguments.callee.base.apply(this,arguments);this.context=this.className=this.attributes=null
}});SC.ObjectCoder.encode=function(g,h){var e=this.create({context:h});var d=e.begin(g).emit();
e.destroy();return d};SC.controllersController=SC.ArrayController.create({});SC.designController=SC.ObjectController.create({contentBinding:"SC.designsController.selection",contentBindingDefault:SC.Binding.single(),viewSelected:function(){var g=this.get("content"),e,d;
if(g){e=g.get("view");if(e.kindOf&&e.kindOf(SC.View)){d=e.get("designer");if(d){d.set("designIsEnabled",NO)
}}else{if(SC._Greenhouse){SC._Greenhouse.designController.set("content",e.get("designer"));
SC._Greenhouse.sendAction("floatInspector")}}}}});SC.designsController=SC.ArrayController.create(SC.CollectionViewDelegate,{setDesigns:function(g,e){var h=[];
for(var d in g){if(g.hasOwnProperty(d)){if(g[d]&&g[d].kindOf){if(g[d].kindOf(e.SC.Pane)){h.push(SC.Object.create({type:"pane",view:g.get(d),name:d}))
}else{if(g[d].kindOf(e.SC.View)){h.push(SC.Object.create({type:"view",view:g.get(d),name:d}))
}else{if(g[d].kindOf(e.SC.Page)){h.push(SC.Object.create({type:"page",view:g.get(d),name:d}))
}else{if(g[d].kindOf(e.SC.Controller)){h.push(SC.Object.create({type:"controller",name:d,view:g.get(d)}))
}else{if(g[d].kindOf(e.SC.Object)&&!g[d].isPageDesignController){h.push(SC.Object.create({type:"controller",name:d,view:g.get(d)}))
}}}}}}}}this.set("content",h);this.set("page",g)},collectionViewComputeDragOperations:function(d,e,g){return SC.DRAG_ANY
},collectionViewValidateDragOperation:function(e,h,k,g,d){var j=h.dataForType("SC.Object");
if(j){return SC.DRAG_ANY}else{return(d&SC.DROP_ON)?SC.DRAG_NONE:k}},collectionViewPerformDragOperation:function(view,drag,op,proposedInsertionIndex,proposedDropOperation){var data=drag.dataForType("SC.Object"),page=this.get("page"),scClass,that=this;
if(data){var actionObj=SC.Object.create({data:data,addItemToPage:function(name){scClass=eval(this.getPath("data.scClass"));
var type=SC.kindOf(scClass,SC.View)?"view":"controller";page[name]=scClass.design().create({page:page});
that.pushObject(SC.Object.create({type:type,view:page.get(name),name:name}))}});SC._Greenhouse.sendAction("newPageElement",actionObj);
return SC.DRAG_ANY}return SC.DRAG_NONE}});SC.PageDesignController=SC.Object.extend({isPageDesignController:YES,selection:null,select:function(e,g){var d=this.get("selection");
if(!d||!g||!d.contains(e)){d=(!g||!d)?SC.CoreSet.create():d.copy();d.add(e);this.set("selection",d.freeze());
SC.designPage.getPath("designMainPane.container").becomeFirstResponder()}return this
},deselect:function(e){var d=this.get("selection");if(d&&d.contains(e)){d=d.copy();
d.remove(e);this.set("selection",d.freeze())}return this},selectionDidChange:function(){var e=this.get("selection"),d=this._selection;
this._selection=e;if(e){e.setEach("designIsSelected",YES)}if(d){d.forEach(function(g){if(!e||!e.contains(g)){g.set("designIsSelected",NO)
}},this)}}.observes("selection"),repositionSelection:function(d,g){var e=this.get("selection");
if(e){e.invoke("mouseReposition",d,g)}},prepareReposition:function(e){var d=this.get("selection");
if(d){d.invoke("prepareReposition",e)}},deleteSelection:function(){var e=this.get("selection"),g,d;
if(e&&e.get("length")>0){g=e.firstObject();this.deselect(g);g=g.get("view");d=g.get("parentView");
g.removeFromParent();if(parent.displayDidChange){parent.displayDidChange()}g=null
}},designers:null,registerDesigner:function(d){this.get("designers").add(d)},init:function(){this.designers=SC.Set.create();
this.sel=[];arguments.callee.base.apply(this,arguments)}});SC.pageFilesController=SC.ArrayController.create({});
SC.pageFilesController.mixin({pages:[],register:function(d){SC.pageFilesController.pages.pushObject(d)
}});SC.Designer=SC.Object.extend({});sc_require("css/css_style");SC.CSSRule=SC.Object.extend({});
SC.CSSStyle=SC.Object.extend({style:"",rule:null});sc_require("css/css_rule");SC.CSSStyleSheet=SC.Object.extend({init:function(){arguments.callee.base.apply(this,arguments);
var g=this.styleSheet;if(!g){g=this.styleSheet=document.createElement("style");g.type="text/css";
var e=document.getElementsByTagName("head")[0];if(!e){e=document.documentElement}e.appendChild(g)
}var d=this.constructor.styleSheets;if(!d){d=this.constructor.styleSheets={}}d[SC.guidFor(g)];
var h=g.rules||SC.EMPTY_ARRAY;var j=SC.SparseArray.create(h.length);j.delegate=this;
this.rules=j;return this},isEnabled:function(d,e){if(e!==undefined){this.styleSheet.disabled=!e
}return !this.styleSheet.disabled}.property(),isEnabledBindingDefault:SC.Binding.bool(),styleSheet:null,href:function(d,e){if(e!==undefined){this.styleSheet.href=e
}else{return this.styleSheet.href}}.property(),title:function(d,e){if(e!==undefined){this.styleSheet.title=e
}else{return this.styleSheet.title}}.property(),rules:null,insertRule:function(d){var e=this.get("rules")
},deleteRule:function(d){var e=this.get("rules");e.removeObject(d)},sparseArrayDidRequestIndex:function(h,d){var g=this.styleSheet.rules||SC.EMPTY_ARRAY;
var e=g[d];if(e){h.provideContentAtIndex(d,SC.CSSRule.create({rule:e,styleSheet:this}))
}},sparseArrayDidReplace:function(j,d,h,g){var e=g.collect(function(k){return k.rule
});this.styleSheet.rules.replace(d,h,e)}});SC.mixin(SC.CSSStyleSheet,{find:function(k){var n=k?k.indexOf("/")>=0:NO;
if(!k){return null}if(!n&&k.indexOf(".css")==-1){k=k+".css"}var g=this.styleSheets;
if(!g){g=this.styleSheets={}}var m=document.styleSheets;var o,h,d,j;for(var l=0,e=m.length;
l<e;++l){o=m[l];if(n){if(o.href===k){j=SC.guidFor(o);d=g[j];if(!d){d=g[j]=this.create({styleSheet:o})
}return d}}else{if(h=o.href){h=h.split("/");h=h[h.length-1];if(h==k){j=SC.guidFor(o);
d=g[j];if(!d){d=g[j]=this.create({styleSheet:o})}return d}}}}return null},styleSheets:null});
sc_require("designers/view_designer");sc_require("mixins/button");SC.ButtonView.Designer=SC.ViewDesigner.extend(SC.Button.Designer,{encodeChildViews:NO,designProperties:"theme buttonBehavior href isDefault".w(),canResizeVertical:NO,canResizeHorizontal:YES});
sc_require("designers/view_designer");SC.LabelView.Designer=SC.ViewDesigner.extend({encodeChildViews:NO,designProperties:"value escapeHTML".w()});
SC.ObjectDesigner=SC.Object.extend({object:null,objectClass:null,designIsSelected:NO,designIsEnabled:YES,page:function(){var d=this.get("object");
return(d)?d.get("page"):null}.property("object").cacheable(),designController:function(){var d=this.get("page");
return(d)?d.get("designController"):null}.property("page").cacheable(),concatenatedProperties:["designProperties","localizedProperties","excludeProperties"],encodeSimpleProperties:function(g,e){var d=this.get("object"),h=this.get("objectClass").prototype;
g.forEach(function(k){var j=d[k];if(j!==undefined&&(j!==h[k])){e.encode(k,j)}},this)
},designProperties:[],excludeProperties:[],editableProperties:function(){var d=this.get("designAttrs"),k=this.get("object"),e=[],j=this.get("designProperties"),h=this.get("excludeProperties");
if(d){d=d[0]}for(var g in d){if(d.hasOwnProperty(g)&&h.indexOf(g)<0){if(!SC.none(k[g])){e.pushObject(SC.Object.create({value:k[g],key:g,view:k}))
}}}j.forEach(function(l){if(h.indexOf(l)<0){e.pushObject(SC.Object.create({value:k[l],key:l,view:k}))
}});return e}.property("designProperties").cacheable(),encodeDesign:function(d){d.set("className",SC._object_className(this.get("objectClass")));
this.encodeDesignProperties(d);return YES},encodeDesignProperties:function(d){return this.encodeSimpleProperties(this.get("designProperties"),d)
},localizedProperties:[],encodeLoc:function(d){d.set("className",SC._object_className(this.get("objectClass")));
this.encodeLocalizedProperties(d);return YES},encodeLocalizedProperties:function(d){return this.encodeSimpleProperties(this.get("localizedProperties"),d)
},awakeDesign:function(){},unknownProperty:function(d,e){if(e!==undefined){this.object.set(d,e);
return e}else{return this.object.get(d)}},init:function(){this.awakeDesign();arguments.callee.base.apply(this,arguments);
var d=this.get("designController");if(d){d.registerDesigner(this)}},destroy:function(){arguments.callee.base.apply(this,arguments);
this.set("object",null)},tryToPerform:function(g,h,e){var j=this.object?this.object.get("page"):null;
var d=j?j.get("needsDesigner")||j.get("isDesignMode"):NO;if(d){return arguments.callee.base.apply(this,arguments)
}else{return SC.Object.prototype.tryToPerform.apply(this.object,arguments)}}});if(!SC.Object.Designer){SC.Object.Designer=SC.ObjectDesigner
}SC.ObjectDesigner.mixin({didLoadDesign:function(e,g,d){e.isDesign=YES;e.designAttrs=d;
e.sourceObject=g},didLoadLocalization:function(e,d){},didCreateObject:function(h,g){var j=h.get("page"),e=h.constructor;
if(e.isDesign&&j&&j.get("needsDesigner")){var l=e,d=e;while(l&&!l.Designer){l=l.superclass
}var k=(l)?l.Designer:SC.Object.Designer;while(e&&e.isDesign){e=e.superclass}if(!e){e=SC.Object
}h.designer=k.create({object:h,objectClass:e,designAttrs:d.designAttrs,sourceObject:d.sourceObject})
}}});sc_require("designers/view_designer");SC.TabView.Designer=SC.ViewDesigner.extend({encodeChildViews:NO,designProperties:"nowShowing items itemTitleKey itemValueKey itemIsEnabledKey itemIconKey itemWidthKey tabLocation userDefaultKey".w()});
sc_require("designers/view_designer");SC.TextFieldView.Designer=SC.ViewDesigner.extend({encodeChildViews:NO,designProperties:"isPassword isTextArea hint".w()});
SC.ViewDesigner=SC.Object.extend({view:null,viewClass:null,designIsSelected:NO,designIsEnabled:YES,page:function(){var d=this.get("view");
return(d)?d.get("page"):null}.property("view").cacheable(),designController:function(){var d=this.get("page");
return(d)?d.get("designController"):null}.property("page").cacheable(),encodeChildViews:YES,concatenatedProperties:["designProperties","localizedProperties","excludeProperties"],canResizeHorizontal:YES,canResizeVertical:YES,canReposition:YES,minWidth:10,minHeight:10,maxWidth:100000000,maxHeight:100000000,layout:function(e,g){var d=this.get("view");
if(!d){return null}if(g!==undefined){d.set("layout",g)}return d.get("layout")}.property("view").cacheable(),anchorLocation:function(o,n){var j=this.get("layout"),l=SC.ViewDesigner,e,p,d,m,s,g,k;
if(!j){return null}if(n!==undefined){k={};m=this.get("view");d=m.get("frame");s=m.get("parentView");
g=s?s.get("frame"):null;if(!g){g=SC.RootResponder.responder.computeWindowSize()}if(n&l.ANCHOR_LEFT){k.left=d.x;
k.width=d.width}else{if(n&l.ANCHOR_RIGHT){k.right=(g.width-SC.maxX(d));k.width=d.width
}else{if(n&l.ANCHOR_CENTERX){k.centerX=Math.round(SC.midX(d)-(g.width/2));k.width=d.width
}else{if(n&l.ANCHOR_WIDTH){k.left=d.x;k.right=(g.width-SC.maxX(d))}}}}if(n&l.ANCHOR_TOP){k.top=d.y;
k.height=d.height}else{if(n&l.ANCHOR_BOTTOM){k.bottom=(g.height-SC.maxY(d));k.height=d.height
}else{if(n&l.ANCHOR_CENTERY){k.centerY=Math.round(SC.midY(d)-(g.height/2));k.height=d.height
}else{if(n&l.ANCHOR_HEIGHT){k.top=d.y;k.bottom=(g.height-SC.maxY(d))}}}}this.set("layout",k);
j=k}if(!SC.none(j.left)){e=SC.none(j.width)?l.ANCHOR_WIDTH:l.ANCHOR_LEFT}else{if(!SC.none(j.right)){e=l.ANCHOR_RIGHT
}else{if(!SC.none(j.centerX)){e=l.ANCHOR_CENTERX}else{e=0}}}if(!SC.none(j.top)){p=SC.none(j.height)?l.ANCHOR_HEIGHT:l.ANCHOR_TOP
}else{if(!SC.none(j.bottom)){p=l.ANCHOR_BOTTOM}else{if(!SC.none(j.centerY)){p=l.ANCHOR_CENTERY
}else{p=0}}}return p|e}.property("layout").cacheable(),_layoutProperty:function(d,g){var e=this.get("layout");
if(!e){return null}if(!SC.none(e)&&(g!==undefined)){e=SC.copy(e);e[d]=g;this.set("layout",e)
}return e[d]},layoutTop:function(d,e){return this._layoutProperty("top",e)}.property("layout").cacheable(),layoutBottom:function(d,e){return this._layoutProperty("bottom",e)
}.property("layout").cacheable(),layoutCenterY:function(d,e){return this._layoutProperty("centerY",e)
}.property("layout").cacheable(),layoutHeight:function(d,e){return this._layoutProperty("height",e)
}.property("layout").cacheable(),layoutTop:function(d,e){return this._layoutProperty("top",e)
}.property("layout").cacheable(),layoutLeft:function(d,e){return this._layoutProperty("left",e)
}.property("layout").cacheable(),layoutRight:function(d,e){return this._layoutProperty("right",e)
}.property("layout").cacheable(),layoutCenterX:function(d,e){return this._layoutProperty("centerX",e)
}.property("layout").cacheable(),layoutWidth:function(d,e){return this._layoutProperty("width",e)
}.property("layout").cacheable(),encodeSimpleProperties:function(g,e){var d=this.get("view"),h=this.get("viewClass").prototype;
g.forEach(function(k){var j=d[k];if(j!==undefined&&(j!==h[k])){e.encode(k,j)}},this)
},designProperties:"layout isVisible isEnabled styleClass".w(),excludeProperties:"layout childViews".w(),editableProperties:function(){var e=this.get("designAttrs"),d=this.get("view"),g=[],k=this.get("designProperties"),j=this.get("excludeProperties");
if(e){e=e[0]}for(var h in e){if(e.hasOwnProperty(h)&&j.indexOf(h)<0){if(!SC.none(d[h])){g.pushObject(SC.Object.create({value:d[h],key:h,view:d}))
}}}k.forEach(function(l){if(j.indexOf(l)<0){g.pushObject(SC.Object.create({value:d[l],key:l,view:d}))
}});return g}.property("designProperties").cacheable(),encodeDesign:function(d){d.set("className",SC._object_className(this.get("viewClass")));
this.encodeDesignProperties(d);this.encodeChildViewsDesign(d);return YES},encodeDesignProperties:function(d){return this.encodeSimpleProperties(this.get("designProperties"),d)
},encodeDesignAttributeProperties:function(e){var h=this.get("designProperties"),g=this.get("designAttrs"),j=[];
if(g){g=g[0]}for(var d in g){if(g.hasOwnProperty(d)&&h.indexOf(d)<0&&d!=="childViews"){j.push(d)
}}return this.encodeSimpleProperties(j,e)},encodeChildViewsDesign:function(e){if(!this.get("encodeChildViews")){return
}var d=this.view,g=d.get("childViews");if(g.length>0){e.object("childViews",g)}},localizedProperties:[],encodeLoc:function(d){d.set("className",SC._object_className(this.get("viewClass")));
this.encodeLocalizedProperties(d);this.encodeChildViewsLoc(d);return YES},encodeLocalizedProperties:function(d){return this.encodeSimpleProperties(this.get("localizedProperties"),d)
},encodeChildViewsLoc:function(e){if(!this.get("encodeChildViews")){return}var d=this.view,g=d.childViews;
if(g.length>0){e.object("childViews",g)}},awakeDesign:function(){},viewDidChange:function(){var e=this.get("view"),d=this._designer_view;
if(e===d){return}var g=this.viewPropertyDidChange;if(d){d.removeObserver("*",this,g)
}this._designer_view=e;if(e){e.addObserver("*",this,g)}this.viewPropertyDidChange(e,"*",null,null)
}.observes("view"),viewPropertyDidChange:function(d,e){if(e==="*"){this.allPropertiesDidChange()
}else{if(this[e]===undefined){this.notifyPropertyChange(e)}}if((e==="*")||(e==="layout")){if(this.get("designIsSelected")&&this._handles){this._handles.set("layout",SC.clone(d.get("layout")))
}}},unknownProperty:function(d,e){if(e!==undefined){this.view.set(d,e);return e}else{return this.view.get(d)
}},init:function(){this.awakeDesign();arguments.callee.base.apply(this,arguments);
this.viewDidChange();var d=this.get("designController");if(d){d.registerDesigner(this)
}},destroy:function(){arguments.callee.base.apply(this,arguments);this.set("view",null)
},designIsSelectedDidChange:function(){if(SC.kindOf(this.view,SC.Pane)){return this
}var d=this.get("designIsSelected");var e=this._handles;if(d){if(!e){e=this._handles=SC.SelectionHandlesView.create({designer:this})
}var g=this.view.get("parentView");if(!e.get("parentView")!==g){g.appendChild(e)}e.set("layout",this.view.get("layout"))
}else{if(e){if(e.get("parentView")){e.removeFromParent()}}}}.observes("designIsSelected"),tryToPerform:function(g,h,e){var j=this.view?this.view.get("page"):null;
var d=j?j.get("needsDesigner")||j.get("isDesignMode"):NO;if(d){return arguments.callee.base.apply(this,arguments)
}else{return SC.Object.prototype.tryToPerform.apply(this.view,arguments)}},didCreateLayer:function(){},didUpdateLayer:function(){},willDestroyLayer:function(){},HANDLE_MARGIN:10,mouseDown:function(n){if(!this.get("designIsEnabled")){return NO
}var l=this.get("view"),e,k,o,j,d,p,h,m,g;if(!l){return NO}this._mouseDownInfo=e={layout:SC.copy(l.get("layout")),selected:this.get("designIsSelected"),dragged:NO,metaKey:n.metaKey||n.shiftKey,source:this,x:n.pageX,y:n.pageY};
e.hanchor=e.vanchor=e.reposition=NO;j=this.get("canReposition");o=k=NO;if(e.selected){d=l.get("frame");
p=l.get("parentView");if(d&&p){d=p.convertFrameToView(d,null)}h=this.HANDLE_MARGIN;
if(d){if(Math.abs(e.x-SC.minX(d))<=h){o="left"}else{if(Math.abs(e.x-SC.maxX(d))<=h){o="right"
}}if(Math.abs(e.y-SC.minY(d))<=h){k="top"}else{if(Math.abs(e.y-SC.maxY(d))<=h){k="bottom"
}}}m=this.get("canResizeHorizontal");g=this.get("canResizeVertical");if(m&&g){if(!k||!o){k=o=NO
}}else{if(m){k=NO;if(Math.abs(e.y-SC.midY(d))>h){o=NO}}else{if(g){o=NO;if(Math.abs(e.x-SC.midX(d))>h){k=NO
}}else{o=k=NO}}}}if(o){e.hanchor=o}if(k){e.vanchor=k}if(!o&&!k&&j){e.reposition=YES
}if(!e.selected){this.get("designController").select(this,e.metaKey)}if(e.reposition){this.get("designController").prepareReposition(e)
}return YES},prepareReposition:function(g){var d=this.get("view"),e=d?SC.copy(d.get("layout")):{};
g[SC.keyFor("layout",SC.guidFor(this))]=e;return this},mouseDragged:function(h){if(!this.get("designIsEnabled")){return NO
}var l=this._mouseDownInfo,g=this.get("view"),j,e,d;if(h.altKey&&SC._Greenhouse){e=h.pageX;
d=h.pageY;var k=SC.DrawingView.create({layout:{left:0,top:0,right:0,bottom:0},startPoint:{x:e,y:d},endPoint:{x:e,y:d},_pointsDidChange:function(){var p=this.get("startPoint"),m=this.get("endPoint"),s,o,n;
s=Math.abs(p.x-m.x);o=Math.abs(p.y-m.y);if(s>5||o>5){n={};n.shape=SC.LINE;n.start={x:p.x,y:p.y};
n.end={x:m.x,y:m.y};n.style={color:"green",width:3};this.setIfChanged("shapes",[n])
}}.observes("startPoint","endPoint")});SC.designPage.get("designMainPane").appendChild(k);
SC.Drag.start({event:h,source:this,dragLink:k,dragView:SC.View.create({layout:{left:0,top:0,width:0,height:0}}),ghost:NO,slideBack:YES,dataSource:this,anchorView:g})
}else{if(g&&(l.hanchor||l.vanchor)){j=SC.copy(this.get("layout"));if(l.hanchor){this._mouseResize(h,l,this.HKEYS,j)
}if(l.vanchor){this._mouseResize(h,l,this.VKEYS,j)}this.set("layout",j)}else{if(l.reposition){this.get("designController").repositionSelection(h,l)
}}}},dragDataTypes:["SC.Binding"],dragDataForType:function(e,d){return d==="SC.Binding"?this.get("view"):null
},mouseUp:function(g){if(!this.get("designIsEnabled")){return NO}var j=this._mouseDownInfo;
if(j.selected&&!j.dragged){var e=this.get("view"),k=e?e.get("frame"):null,h=e.get("parentView");
if(k&&h){k=h.convertFrameToView(k,null)}if(!k||SC.pointInRect({x:g.pageX,y:g.pageY},k)){var d=this.get("designController");
if(j.metaKey){d.deselect(this)}else{d.select(this,NO)}}}if(SC._Greenhouse&&g.clickCount===2){SC._Greenhouse.sendAction("openInspector",e)
}this._mouseDownInfo=null;return YES},mouseReposition:function(d,g){var e=SC.copy(this.get("layout"));
this._mouseReposition(d,g,this.HKEYS,e);this._mouseReposition(d,g,this.VKEYS,e);this.set("layout",e);
return this},HKEYS:{evtPoint:"pageX",point:"x",min:"minWidth",max:"maxWidth",head:"left",tail:"right",center:"centerX",size:"width",anchor:"hanchor"},VKEYS:{evtPoint:"pageY",point:"y",min:"minHeight",max:"maxHeight",head:"top",tail:"bottom",center:"centerY",size:"height",anchor:"vanchor"},_mouseResize:function(o,y,n,B){var A=o[n.evtPoint]-y[n.point],z=y.layout,l=this.get("view"),s=this.get(n.min),u=this.get(n.max),e=n.head,m=n.tail,x=n.center,p=n.size,d=!SC.none(z[n.head]),g=!SC.none(z[n.tail]),j=!SC.none(z[n.center]),h=!SC.none(z[n.size]),k;
if(y[n.anchor]===e){if(d){if(h){k=z[p];B[p]=Math.min(u,Math.max(s,Math.floor(z[p]-A)));
s=(z[e]+k)-s;u=(z[e]+k)-u;B[e]=Math.max(u,Math.min(s,Math.floor(z[e]+A)))}else{B[e]=Math.floor(z[e]+A)
}}else{if(g||j){if(j){A*=2}B[p]=Math.max(s,Math.min(u,Math.floor((z[p]||0)-A)))}else{B[e]=Math.floor((z[e]||0)+A)
}}}else{if(y[n.anchor]===m){if(g){if(h){k=z[p];B[p]=Math.min(u,Math.max(s,Math.floor(z[p]+A)));
s=(z[m]+k)-s;u=(z[m]+k)-u;B[m]=Math.max(u,Math.min(s,Math.floor(z[m]-A)))}else{B[m]=Math.floor(z[m]-A)
}}else{if(j){A*=2}B[p]=Math.max(s,Math.min(u,Math.floor((z[p]||0)+A)))}}}return this
},_mouseReposition:function(y,g,z,o){var x=y[z.evtPoint]-g[z.point],m=g[SC.keyFor("layout",SC.guidFor(this))],p=this.get("view"),u=z.head,k=z.tail,j=z.center,l=z.size,h=!SC.none(m[u]),e=!SC.none(m[k]),d=!SC.none(m[j]),n=!SC.none(m[l]),s;
if(h&&e&&!n){return NO}if(h){o[u]=m[u]+x}else{if(e){o[k]=m[k]-x}else{if(d){o[j]=m[j]+x
}else{o[u]=(m[u]||0)+x}}}return YES},dragSourceOperationMaskFor:function(d,e){return SC.DRAG_LINK
},dragDidBegin:function(d,e){},dragDidMove:function(e,m){var k=e.dragLink;var j,d,h,l,g;
if(k){h=k.get("parentView");l=k.get("frame");g=h?h.convertFrameToView(l,null):l;if(g){j=m.x-g.x;
d=m.y-g.y;k.set("endPoint",{x:j,y:d})}}},dragDidEnd:function(d,g,h){var e=d.dragLink;
if(e){e.destroy()}}});if(!SC.View.Designer){SC.View.Designer=SC.ViewDesigner}SC.ViewDesigner.mixin({ANCHOR_LEFT:1,ANCHOR_RIGHT:2,ANCHOR_CENTERX:4,ANCHOR_WIDTH:16,ANCHOR_TOP:256,ANCHOR_BOTTOM:512,ANCHOR_CENTERY:1024,ANCHOR_HEIGHT:4096,didLoadDesign:function(e,d,g){e.isDesign=YES;
e.designAttrs=g;e.sourceView=d},didLoadLocalization:function(d,e){},didCreateView:function(e,h){var j=e.get("page"),g=e.constructor;
if(g.isDesign&&j&&j.get("needsDesigner")){var l=g,d=g;while(l&&!l.Designer){l=l.superclass
}var k=(l)?l.Designer:SC.View.Designer;while(g&&g.isDesign){g=g.superclass}if(!g){g=SC.View
}e.designer=k.create({view:e,viewClass:g,designAttrs:d.designAttrs,sourceView:d.sourceView})
}}});SC.View.prototype._orig_respondsTo=SC.View.prototype.respondsTo;SC.View.prototype._orig_tryToPerform=SC.View.prototype.tryToPerform;
SC.View.prototype._orig_createLayer=SC.View.prototype.createLayer;SC.View.prototype._orig_updateLayer=SC.View.prototype.updateLayer;
SC.View.prototype._orig_destroyLayer=SC.View.prototype.destroyLayer;SC.View.prototype.respondsTo=function(d){if(this.designer){var e=!!(SC.typeOf(this[d])===SC.T_FUNCTION);
e=e||this.designer.respondsTo(d);return e}else{return this._orig_respondsTo(d)}};
SC.View.prototype.tryToPerform=function(e,g,d){if(this.designer){return this.designer.tryToPerform(e,g,d)
}else{return this._orig_tryToPerform(e,g,d)}};SC.View.prototype.createLayer=function(){var d=this._orig_createLayer.apply(this,arguments);
if(this.designer){this.designer.didCreateLayer()}return d};SC.View.prototype.updateLayer=function(){var d=this._orig_updateLayer.apply(this,arguments);
if(this.designer){this.designer.didUpdateLayer()}return d};SC.View.prototype.destroyLayer=function(){if(this.designer){this.designer.willDestroyLayer()
}return this._orig_destroyLayer.apply(this,arguments)};SC.Object.prototype.emitDesign=function(){var d=SC.DesignCoder.encode(this);
return d};SC.Object.prototype.encodeDesign=function(d){return this.designer?this.designer.encodeDesign(d):NO
};SC.Page.prototype.emitDesign=function(){this.awake();var d=this.get("pageName");
var e=SC.DesignCoder.encode(this);e=["// SproutCore ViewBuilder Design Format v1.0","// WARNING: This file is automatically generated.  DO NOT EDIT.  Changes you","// make to this file will be lost.","","%@ = %@;".fmt(d,e),""].join("\n");
return e};SC.Page.prototype.designController=function(){if(!this._designController){this._designController=SC.PageDesignController.create({page:this})
}return this._designController}.property().cacheable();SC.Page.prototype.emitLocalization=function(g){this.awake();
var d=this.get("pageName");var e=SC.LocalizationCoder.encode(this);e=["// SproutCore ViewBuilder Localization Format v1.0","// WARNING: This file is automatically generated.  DO NOT EDIT.  Changes you","// make to this file will be lost.","","%@.loc(%@);".fmt(d,e),""].join("\n");
return e};SC.Page.prototype.encodeDesign=function(g){for(var e in this){var d=this[e];
if(d instanceof SC.View||d instanceof SC.Controller||d instanceof SC.Object){g.js(e,d.emitDesign())
}}g.string("pageName",this.get("pageName"))};SC.Page.prototype.encodeLoc=function(g){for(var e in this){var d=this[e];
if(d instanceof SC.View){g.js(e,d.emitLocalization())}}};SC.View.prototype.emitDesign=function(){var d=SC.DesignCoder.encode(this);
return d};SC.View.prototype.emitLocalization=function(design){var ret=SC.LocalizationCoder.encode(this);
if(!design){design=this.emitDesign()}var views=eval(design).loc(eval(ret)).create();
var emptyElement=views.computeEmptyElement().replace(/\'/g,"'");views.destroy();ret=ret.replace(/\)$/,", '%@')".fmt(emptyElement));
return ret};SC.View.prototype.encodeDesign=function(d){return this.designer?this.designer.encodeDesign(d):NO
};SC.View.prototype.encodeLoc=function(d){return this.designer?this.designer.encodeLoc(d):NO
};SC.Button.Designer={designProperties:"title".w()};sc_require("views/drawing");SC.SNAP_ZONE=2;
SC.SNAP_LINE={shape:SC.LINE,start:{x:0,y:0},end:{x:0,y:0},style:{width:0.5,color:"#00c6ff"}};
SC.SnapLines={hasSnapLines:YES,setupData:function(x){if(!x){x=[]}this.removeLines();
this._xPositions={};this._yPositions={};var u=this._xPositions,l=this._yPositions,h=this.get("childViews"),m=this,y,g,k,p,e,j,o,d,n=(SC.SNAP_ZONE*2);
var s=function(D,C,z,G,A){var F=D,E=C,B=z;D=Math.floor(D/n);C=Math.floor(C/n);z=Math.floor(z/n);
if(A[D]){A[D].push({value:F,child:G})}else{A[D]=[{value:F,child:G}]}if(A[C]){A[C].push({value:E,child:G})
}else{A[C]=[{value:E,child:G}]}if(A[z]){A[z].push({value:B,child:G})}else{A[z]=[{value:B,child:G}]
}};parent=this;h.forEach(function(z){if(x.indexOf(z)<0){g=parent?parent.convertFrameToView(z.get("frame"),null):z.get("frame");
k=g.x;p=SC.midX(g);e=g.x+g.width;s(k,p,e,z,u);j=g.y;o=SC.midY(g);d=g.y+g.height;s(j,o,d,z,l)
}});parent=this.get("parentView");g=parent?parent.convertFrameToView(this.get("frame"),null):this.get("frame");
this._globalFrame=g;k=g.x;p=SC.midX(g);e=g.x+g.width;s(k,p,e,this,u);j=g.y;o=SC.midY(g);
d=g.y+g.height;s(j,o,d,this,l)},drawLines:function(B,H,G,J,I){if(!this._drawingView){this._drawingView=this.createChildView(SC.DrawingView.design({shapes:[]}));
this.appendChild(this._drawingView)}var E=(SC.SNAP_ZONE*2),F=[],C,k,D,s,z,h,y,x,e,u,g,M,n,m,d,p,O,j,K=this._dragDirection(H,G,J,I),L,l,o=this,P,A,N;
s=B.get("parentView");D=s?s.convertFrameToView(B.get("frame"),null):B.get("frame");
z=SC.minX(D);h=SC.midX(D);y=SC.maxX(D);x=SC.minY(D);e=SC.midY(D);u=SC.maxY(D);g=Math.floor(z/E);
M=Math.floor(h/E);n=Math.floor(y/E);m=Math.floor(x/E);d=Math.floor(e/E);p=Math.floor(u/E);
L=K.UP?[{mod:g,val:0},{mod:M,val:D.width/2},{mod:n,val:D.width}]:[{mod:n,val:D.width},{mod:M,val:D.width/2},{mod:g,val:0}];
L.forEach(function(Q){if(o._xPositions[Q.mod]){P=Q;O=o._xPositions[Q.mod][0].value-o._globalFrame.x;
return}});if(!SC.none(O)){C=SC.copy(SC.SNAP_LINE);C.start={x:O,y:0};C.end={x:O,y:this._globalFrame.height};
F.push(C)}l=K.LEFT?[{mod:m,val:0},{mod:d,val:D.height/2},{mod:p,val:D.height}]:[{mod:p,val:D.height},{mod:d,val:D.height/2},{mod:m,val:0}];
l.forEach(function(Q){if(o._yPositions[Q.mod]){A=Q;j=o._yPositions[Q.mod][0].value-o._globalFrame.y;
return}});if(!SC.none(j)){k=SC.copy(SC.SNAP_LINE);k.start={y:j,x:0};k.end={y:j,x:this._globalFrame.width};
F.push(k)}this._drawingView.set("shapes",F);N={pageX:O+this._globalFrame.x,pageY:j+this._globalFrame.y,frameX:O,frameY:j};
if(P){N.pageX-=P.val;N.frameX-=P.val}if(A){N.pageY-=A.val;N.frameY-=A.val}return N
},removeLines:function(){this._xPositions=null;this._yPositions=null;this._globalFrame=null;
if(this._drawingView){this.removeChild(this._drawingView);this._drawingView=null}},_dragDirection:function(l,k,h,g){var e=l-h,d=k-g,j={};
j.UP=e>0?NO:YES;j.DOWN=e>0?YES:NO;j.LEFT=d>0?NO:YES;j.RIGHT=d>0?YES:NO;return j}};
SC.DesignerDropTarget=SC.ContainerView.extend({acceptsFirstResponder:YES,keyDown:function(d){return this.interpretKeyEvents(d)
},keyUp:function(d){return YES},deleteForward:function(d){var e=SC.designsController.getPath("page.designController");
if(e){e.deleteSelection()}return YES},deleteBackward:function(d){var e=SC.designsController.getPath("page.designController");
if(e){e.deleteSelection()}return YES},moveLeft:function(e,d){return YES},moveRight:function(e,d){return YES
},moveUp:function(e,d){return YES},moveDown:function(e,d){return YES},isDropTarget:YES,targetIsInIFrame:YES,dragStarted:function(e,d){},dragEntered:function(e,d){},dragUpdated:function(e,d){},dragExited:function(e,d){},dragEnded:function(e,d){},computeDragOperations:function(e,d){return SC.DRAG_ANY
},acceptDragOperation:function(drag,op){var data=drag.dataForType("SC.Object"),scClass=eval(data.get("scClass"));
return scClass.kindOf(SC.View)},performDragOperation:function(drag,op){var data=drag.dataForType("SC.Object"),cv=this.get("contentView"),loc=drag.get("location"),frame=drag.iframeFrame,design,size,newView,defaults,layout;
var page=cv.get("page");size=data.get("size");loc.x=loc.x-frame.x;loc.y=loc.y-frame.y;
design=eval(data.get("scClass"));defaults=data.get("defaults")||{};layout=defaults.layout||{};
layout=SC.merge(layout,{top:loc.y,left:loc.x});defaults.layout=layout;design=design.design(defaults);
newView=design.create({page:page});if(cv&&newView){cv.appendChild(newView)}page.get("designController").select(newView.get("designer"));
return SC.DRAG_ANY}});SC.LINE="line";SC.RECT="rect";SC.CIRCLE="circle";SC.POLY="poly";
SC.FILL="fill";SC.STROKE="stroke";SC.DrawingView=SC.View.extend({classNames:"scui-drawing-view",shapes:[],_drawingManager:{},shapesDidChange:function(){this.set("layerNeedsUpdate",YES);
this.updateLayerIfNeeded()}.observes("*shapes.[]"),init:function(){arguments.callee.base.apply(this,arguments);
this.registerShapeDrawing(SC.LINE,function(d,e){if(e.style){if(e.style.width){d.lineWidth=e.style.width
}if(e.style.color){d.strokeStyle=e.style.color}if(e.style.transparency){d.globalAlpha=e.style.transparency
}}d.beginPath();d.moveTo(e.start.x,e.start.y);d.lineTo(e.end.x,e.end.y);d.stroke()
});this.registerShapeDrawing(SC.RECT,function(d,e){if(e.style){if(e.style.width){d.lineWidth=e.style.width
}if(e.style.color){d.fillStyle=d.strokeStyle=e.style.color}if(e.style.transparency){d.globalAlpha=e.style.transparency
}}switch(e.type){case SC.FILL:d.fillRect(e.start.x,e.start.y,e.size.width,e.size.height);
break;case SC.STROKE:d.strokeRect(e.start.x,e.start.y,e.size.width,e.size.height);
break;default:d.clearRect(e.start.x,e.start.y,e.size.width,e.size.height);break}});
this.registerShapeDrawing(SC.CIRCLE,function(d,e){if(e.style){if(e.style.width){d.lineWidth=e.style.width
}if(e.style.color){d.fillStyle=d.strokeStyle=e.style.color}if(e.style.transparency){d.globalAlpha=e.style.transparency
}}d.beginPath();d.arc(e.center.x,e.center.y,e.radius,0,Math.PI*2,true);if(e.type===SC.FILL){d.fill()
}else{d.stroke()}});this.registerShapeDrawing(SC.POLY,function(e,k){if(k.style){if(k.style.width){e.lineWidth=k.style.width
}if(k.style.color){e.fillStyle=e.strokeStyle=k.style.color}if(k.style.transparency){e.globalAlpha=k.style.transparency
}}e.beginPath();var d=k.path?k.path.length:0;if(d<2){return}var j=k.path,h;e.moveTo(j[0].x,j[0].y);
for(var g=1;g<d;g++){h=j[g];e.lineTo(h.x,h.y)}e.lineTo(j[0].x,j[0].y);if(k.type===SC.FILL){e.fill()
}else{e.stroke()}})},render:function(g,j){var h=this.get("frame");if(j){if(!SC.browser.msie){g.push('<canvas class="base-layer" width="%@" height="%@">You can\'t use canvas tags</canvas>'.fmt(h.width,h.height))
}}else{var e=this.$("canvas.base-layer");if(e){e.attr("width",h.width);e.attr("height",h.height);
if(e.length>0){var d=e[0].getContext("2d");if(d){d.clearRect(0,0,h.width,h.height);
this._drawShapes(d)}else{console.error("SC.DrawingView.render(): Canvas object context is not accessible.")
}}else{console.error("SC.DrawingView.render(): Canvas element array length is zero.")
}}else{console.error("SC.DrawingView.render(): Canvas element is not accessible.")
}}return arguments.callee.base.apply(this,arguments)},registerShapeDrawing:function(e,d){if(!e){console.error("Can't register this drawing paradigm because name is null");
return NO}this._drawingManager[e]=d;this.set("layerNeedsUpdate",YES);this.updateLayerIfNeeded();
return YES},_drawShapes:function(g){var k;var e=this.get("shapes");var h;for(var j=0,d=e.length;
j<d;j++){k=e[j];h=this._drawingManager[k.shape];if(h){h(g,k)}}}});SC.pageItemView=SC.ListItemView.extend({isDropTarget:YES,dragEntered:function(e,d){this.$().addClass("highlight")
},dragExited:function(e,d){this.$().removeClass("highlight")},dragEnded:function(e,d){this.$().removeClass("highlight")
},computeDragOperations:function(e,d){if(e.hasDataType("SC.Binding")){return SC.DRAG_LINK
}return SC.DRAG_NONE},acceptDragOperation:function(d,e){return YES},performDragOperation:function(e,j){var h=e.dataForType("SC.Binding"),g=this;
if(h&&SC._Greenhouse){var d=SC.Object.create({type:"Binding",source:h,target:g.get("content"),addItem:function(p,o,m){var k=this.getPath("source");
var n=g._propertyPathForProp(this.getPath("target.view.page"),this.getPath("target.view"));
k[p+"Binding"]=m[p+"Binding"]=n+"."+o;k.propertyDidChange(p+"Binding");var l=k.get("designer");
if(l){l.designProperties.pushObject(p+"Binding");l.propertyDidChange("editableProperties")
}if(k.displayDidChange){k.displayDidChange()}}});SC._Greenhouse.sendAction("newBindingPopup",d);
return SC.DRAG_LINK}else{return SC.DRAG_NONE}},_propertyPathForProp:function(e,g){for(var d in e){if(e.hasOwnProperty(d)){if(e[d]===g){return e.get("pageName")+"."+d.toString()
}}}}});SC.SelectionHandlesView=SC.View.extend({designer:null,classNames:"handles",render:function(j,k){var h=this.get("designer"),e=h?h.get("canResizeVertical"):NO,d=h?h.get("canResizeHorizontal"):NO,g;
if(k||(e!==this._vertical)||(d===this._horizontal)){this._vertical=e;this._horizontal=d;
if(e&&d){g=["top left","top right","bottom left","bottom right"]}else{if(e){g="top bottom".w()
}else{if(d){g="left right".w()}else{g=[]}}}g.forEach(function(l){j.begin("span").classNames(l.w()).addClass("handle").end()
},this)}},mouseDown:function(e){var g=this.designer;return(g&&g.mouseDown)?g.mouseDown(e):null
},mouseUp:function(e){var g=this.designer;return(g&&g.mouseUp)?g.mouseUp(e):null},mouseMoved:function(e){var g=this.designer;
return(g&&g.mouseMoved)?g.mouseMoved(e):null},mouseDragged:function(e){var g=this.designer;
return(g&&g.mouseDragged)?g.mouseDragged(e):null}});SC.allowsBackspaceToPreviousPage=NO;
require("system/drag");SC.Drag.mixin({inspectOperation:function(e){var d=[];if(e===SC.DRAG_NONE){d=["DRAG_NONE"]
}else{if(e===SC.DRAG_ANY){d=["DRAG_ANY"]}else{if(e&SC.DRAG_LINK){d.push("DRAG_LINK")
}if(e&SC.DRAG_COPY){d.push("DRAG_COPY")}if(e&SC.DRAG_MOVE){d.push("DRAG_MOVE")}if(e&SC.DRAG_REORDER){d.push("DRAG_REORDER")
}}}return d.join("|")}});SC.stringsFor("English",{"Invalid.CreditCard(%@)":"%@ is not a valid credit card number","Invalid.Email(%@)":"%@ is not a valid email address","Invalid.NotEmpty(%@)":"%@ must not be empty","Invalid.Password":"Your passwords do not match.  Please try typing them again.","Invalid.General(%@)":"%@ is invalid.  Please try again.","Invalid.Number(%@)":"%@ is not a number."});
SC.BORDER_BEZEL="sc-bezel-border";SC.BORDER_BLACK="sc-black-border";SC.BORDER_GRAY="sc-gray-border";
SC.BORDER_TOP="sc-top-border";SC.BORDER_BOTTOM="sc-bottom-border";SC.BORDER_NONE=null;
SC.Border={borderTop:0,borderRight:0,borderBottom:0,borderLeft:0,borderStyle:SC.BORDER_GRAY,hasBorder:YES,displayProperties:["borderStyle"],_BORDER_REGEXP:(/-border$/),initMixin:function(){this._sc_border_borderStyleDidChange()
},renderMixin:function(d,g){var e=this.get("borderStyle");if(e){if(this._BORDER_REGEXP.exec(e)){d.addClass(e)
}else{d.addStyle("border","1px "+e+" solid")}}},_sc_border_borderStyleDidChange:function(){var d=this.get("borderStyle"),e=SC.Border.dimensions[d];
if(e){this.borderTop=e;this.borderRight=e;this.borderBottom=e;this.borderLeft=e}}};
SC.mixin(SC.Border,{dimensions:{"sc-bezel-border":1,"sc-black-border":1,"sc-gray-border":1,"sc-top-border":1,"sc-bottom-border":1}});
SC.CollectionGroup={classNames:["sc-collection-group"]};SC.CollectionRowDelegate={isCollectionRowDelegate:YES,rowHeight:18,customRowHeightIndexes:null,contentIndexRowHeight:function(d,e,g){return this.get("rowHeight")
}};SC.CollectionViewDelegate={isCollectionViewDelegate:YES,collectionViewSelectionForProposedSelection:function(d,e){return e
},collectionViewShouldSelectIndexes:function(d,e,g){return e},collectionViewShouldDeselectIndexes:function(d,e){return e
},collectionViewShouldDeleteIndexes:function(d,e){return e},collectionViewDeleteContent:function(d,g,e){if(!g){return NO
}if(SC.typeOf(g.destroyAt)===SC.T_FUNCTION){g.destroyAt(e);d.selectPreviousItem(NO,1);
return YES}else{if(SC.typeOf(g.removeAt)===SC.T_FUNCTION){g.removeAt(e);d.selectPreviousItem(NO,1);
return YES}else{return NO}}},collectionViewShouldBeginDrag:function(d){return YES
},collectionViewDragDataTypes:function(d){return[]},collectionViewDragDataForType:function(d,g,e){return null
},collectionViewComputeDragOperations:function(d,e,g){return g},collectionViewValidateDragOperation:function(e,h,j,g,d){return(d&SC.DROP_ON)?SC.DRAG_NONE:j
},collectionViewPerformDragOperation:function(e,h,j,g,d){return SC.DRAG_NONE},collectionViewDragViewFor:function(d,e){return null
},ghostActsLikeCursor:NO};SC.Scrollable={isScrollable:true,verticalLineScroll:20,horizontalLineScroll:20,verticalPageScroll:function(){return this.get("innerFrame").height
}.property("innerFrame"),horizontalPageScroll:function(){return this.get("innerFrame").width
}.property("innerFrame"),hasVerticalScroller:function(){return this.get("scrollFrame").height>this.get("innerFrame").height
}.property("scrollFrame"),hasHorizontalScroller:function(){return this.get("scrollFrame").width>this.get("innerFrame").width
}.property("scrollFrame"),scrollBy:function(d){var e=this.get("scrollFrame");var g=this.get("innerFrame");
if(!this.get("hasVerticalScroller")){d.y=0}if(e.height<=g.height){d.y=0}if(!this.get("hasHorizontalScroller")){d.x=0
}if(e.width<=g.width){d.x=0}var h={x:e.x-(d.x||0),y:e.y-(d.y||0)};this.set("scrollFrame",h);
h=this.get("scrollFrame");return{x:h.x-e.x,y:h.y-e.y}},scrollTo:function(d,e){this.set("scrollFrame",{x:0-d,y:0-e})
},scrollToVisible:function(e){var j=this.get("innerFrame");var h=this.get("scrollFrame");
var d=this.convertFrameFromView(e.get("frame"),e);d.x-=(j.x+h.x);d.y-=(j.y+h.y);var g={x:0-h.x,y:0-h.y,width:j.width,height:j.height};
g.y-=Math.max(0,SC.minY(g)-SC.minY(d));g.x-=Math.max(0,SC.minX(g)-SC.minX(d));g.y+=Math.max(0,SC.maxY(d)-SC.maxY(g));
g.x+=Math.max(0,SC.maxX(d)-SC.maxX(g));this.scrollTo(g.x,g.y)},scrollDownLine:function(d){if(d===undefined){d=1
}return this.scrollBy({y:this.get("verticalLineScroll")*d}).y},scrollUpLine:function(d){if(d===undefined){d=1
}return 0-this.scrollBy({y:0-this.get("verticalLineScroll")*d}).y},scrollRightLine:function(d){if(d===undefined){d=1
}return this.scrollTo({y:this.get("horizontalLineScroll")*d}).x},scrollLeftLine:function(d){if(d===undefined){d=1
}return 0-this.scrollTo({y:0-this.get("horizontalLineScroll")*d}).x},scrollDownPage:function(d){if(d===undefined){d=1
}return this.scrollBy({y:this.get("verticalPageScroll")*d}).y},scrollUpPage:function(d){if(d===undefined){d=1
}return 0-this.scrollBy({y:0-this.get("verticalPageScroll")*d}).y},scrollRightPage:function(d){if(d===undefined){d=1
}return this.scrollTo({y:this.get("horizontalPageScroll")*d}).x},scrollLeftPage:function(d){if(d===undefined){d=1
}return 0-this.scrollTo({y:0-this.get("horizontalPageScroll")*d}).x}};sc_require("panes/panel");
sc_require("views/button");SC.BUTTON1_STATUS="button1";SC.BUTTON2_STATUS="button2";
SC.BUTTON3_STATUS="button3";SC.AlertPane=SC.PanelPane.extend({classNames:"sc-alert",delegate:null,icon:"sc-icon-alert-48",message:"",description:"",displayDescription:function(){var d=this.get("description");
if(!d||d.length===0){return d}d=SC.RenderContext.escapeHTML(d);return'<p class="description">'+d.split("\n").join('</p><p class="description">')+"</p>"
}.property("description").cacheable(),caption:"",displayCaption:function(){var d=this.get("caption");
if(!d||d.length===0){return d}d=SC.RenderContext.escapeHTML(d);return'<p class="caption">'+d.split("\n").join('</p><p class="caption">')+"</p>"
}.property("caption").cacheable(),buttonOne:SC.outlet("contentView.childViews.1.childViews.1"),buttonTwo:SC.outlet("contentView.childViews.1.childViews.0"),buttonThree:SC.outlet("contentView.childViews.2.childViews.0"),buttonThreeWrapper:SC.outlet("contentView.childViews.2"),layout:{top:0.3,centerX:0,width:500},contentView:SC.View.extend({useStaticLayout:YES,layout:{left:0,right:0,top:0,height:"auto"},childViews:[SC.View.extend(SC.StaticLayout,{classNames:["info"],render:function(d,h){var g=this.get("pane");
var e=SC.BLANK_IMAGE_URL;if(g.get("icon")=="blank"){d.addClass("plain")}d.push('<img src="'+e+'" class="icon '+g.get("icon")+'" />');
d.begin("h1").text(g.get("message")||"").end();d.push(g.get("displayDescription")||"");
d.push(g.get("displayCaption")||"");d.push('<div class="separator"></div>')}}),SC.View.extend({layout:{bottom:13,height:24,right:18,width:466},childViews:["cancelButton","okButton"],classNames:["text-align-right"],cancelButton:SC.ButtonView.extend({useStaticLayout:YES,actionKey:SC.BUTTON2_STATUS,localize:YES,titleMinWidth:64,layout:{right:5,height:"auto",width:"auto",bottom:0},theme:"capsule",title:"Cancel",isCancel:YES,action:"dismiss",isVisible:NO}),okButton:SC.ButtonView.extend({useStaticLayout:YES,actionKey:SC.BUTTON1_STATUS,localize:YES,titleMinWidth:64,layout:{left:0,height:"auto",width:"auto",bottom:0},theme:"capsule",title:"OK",isDefault:YES,action:"dismiss"})}),SC.View.extend({layout:{bottom:13,height:24,left:18,width:150},isVisible:NO,childViews:[SC.ButtonView.extend({useStaticLayout:YES,actionKey:SC.BUTTON3_STATUS,localize:YES,titleMinWidth:64,layout:{left:0,height:"auto",width:"auto",bottom:0},theme:"capsule",title:"Extra",action:"dismiss",isVisible:NO})]})]}),dismiss:function(e){var d=this.delegate;
if(d&&d.alertPaneDidDismiss){d.alertPaneDidDismiss(this,e.get("actionKey"))}this.remove()
},alertInfoDidChange:function(){var d=this.getPath("contentView.childViews.0");if(d){d.displayDidChange()
}}.observes("icon","message","displayDescription","displayCaption")});SC.AlertPane._normalizeArguments=function(e){e=SC.A(e);
var d=e.length,g=e[d-1];if(SC.typeOf(g)!==SC.T_STRING){e[d-1]=null}else{g=null}e[7]=g;
return e};SC.AlertPane.show=function(z,s,x,e,g,y,d,l){var k=this._normalizeArguments(arguments);
var j=this.create({message:k[0]||"",description:k[1]||null,caption:k[2]||null,icon:k[6]||"sc-icon-alert-48",delegate:k[7]});
var p="buttonOne buttonTwo buttonThree".w(),h,m;for(var o=0;o<3;o++){h=j.get(p[o]);
m=k[o+3];if(m){h.set("title",m).set("isVisible",YES);if(m=="?"){h.set("titleMinWidth",0)
}if(o==2){var u=j.get("buttonThreeWrapper");u.set("isVisible",YES)}}}var n=j.append();
j.adjust("height",j.childViews[0].$().height());j.updateLayout();return n};SC.AlertPane.warn=function(j,h,d,m,k,l,g){var e=this._normalizeArguments(arguments);
e[6]="sc-icon-alert-48";return this.show.apply(this,e)};SC.AlertPane.info=function(j,h,d,m,k,l,g){var e=this._normalizeArguments(arguments);
e[6]="sc-icon-info-48";return this.show.apply(this,e)};SC.AlertPane.error=function(j,h,d,m,k,l,g){var e=this._normalizeArguments(arguments);
e[6]="sc-icon-error-48";return this.show.apply(this,e)};SC.AlertPane.plain=function(j,h,d,m,k,l,g){var e=this._normalizeArguments(arguments);
e[6]="blank";return this.show.apply(this,e)};require("panes/picker");require("views/menu_item");
SC.MenuPane=SC.PickerPane.extend({classNames:["sc-menu"],items:[],controlSize:SC.REGULAR_CONTROL_SIZE,itemHeight:null,itemSeparatorHeight:null,menuHeight:0,menuHeightPadding:null,submenuOffsetX:null,selectedItem:null,exampleView:SC.MenuItemView,anchor:null,isSubMenu:NO,localize:YES,acceptsMenuPane:YES,popup:function(e,g){var d;
if(e){d=e.isView?e.get("layer"):e}this.beginPropertyChanges();this.set("anchorElement",d);
this.set("anchor",e);if(g){this.set("preferMatrix",g)}this.endPropertyChanges();this.adjust("height",this.get("menuHeight"));
this.positionPane();this.set("defaultResponder",this);if(parseInt(SC.browser.msie,0)===7){this.invokeLast(this.append)
}else{this.append()}},remove:function(){var d=this.get("parentMenu");this.set("currentMenuItem",null);
this.closeOpenMenus();this.resignMenuPane();if(d){d.becomeMenuPane()}return arguments.callee.base.apply(this,arguments)
},itemTitleKey:"title",itemIsEnabledKey:"isEnabled",itemValueKey:"value",itemIconKey:"icon",itemHeightKey:"height",itemSubMenuKey:"subMenu",itemSeparatorKey:"separator",itemTargetKey:"target",itemActionKey:"action",itemCheckboxKey:"checkbox",itemShortCutKey:"shortcut",itemKeyEquivalentKey:"keyEquivalent",itemDisableMenuFlashKey:"disableMenuFlash",menuItemKeys:"itemTitleKey itemValueKey itemIsEnabledKey itemIconKey itemSeparatorKey itemActionKey itemCheckboxKey itemShortCutKey itemBranchKey itemHeightKey itemSubMenuKey itemKeyEquivalentKey itemTargetKey".w(),preferType:SC.PICKER_MENU,isModal:YES,_menuView:null,init:function(){switch(this.get("controlSize")){case SC.TINY_CONTROL_SIZE:this.setIfNull("itemHeight",SC.MenuPane.TINY_MENU_ITEM_HEIGHT);
this.setIfNull("itemSeparatorHeight",SC.MenuPane.TINY_MENU_ITEM_SEPARATOR_HEIGHT);
this.setIfNull("menuHeightPadding",SC.MenuPane.TINY_MENU_HEIGHT_PADDING);this.setIfNull("submenuOffsetX",SC.MenuPane.TINY_SUBMENU_OFFSET_X);
break;case SC.SMALL_CONTROL_SIZE:this.setIfNull("itemHeight",SC.MenuPane.SMALL_MENU_ITEM_HEIGHT);
this.setIfNull("itemSeparatorHeight",SC.MenuPane.SMALL_MENU_ITEM_SEPARATOR_HEIGHT);
this.setIfNull("menuHeightPadding",SC.MenuPane.SMALL_MENU_HEIGHT_PADDING);this.setIfNull("submenuOffsetX",SC.MenuPane.SMALL_SUBMENU_OFFSET_X);
break;case SC.REGULAR_CONTROL_SIZE:this.setIfNull("itemHeight",SC.MenuPane.REGULAR_MENU_ITEM_HEIGHT);
this.setIfNull("itemSeparatorHeight",SC.MenuPane.REGULAR_MENU_ITEM_SEPARATOR_HEIGHT);
this.setIfNull("menuHeightPadding",SC.MenuPane.REGULAR_MENU_HEIGHT_PADDING);this.setIfNull("submenuOffsetX",SC.MenuPane.REGULAR_SUBMENU_OFFSET_X);
break;case SC.LARGE_CONTROL_SIZE:this.setIfNull("itemHeight",SC.MenuPane.LARGE_MENU_ITEM_HEIGHT);
this.setIfNull("itemSeparatorHeight",SC.MenuPane.LARGE_MENU_ITEM_SEPARATOR_HEIGHT);
this.setIfNull("menuHeightPadding",SC.MenuPane.LARGE_MENU_HEIGHT_PADDING);this.setIfNull("submenuOffsetX",SC.MenuPane.LARGE_SUBMENU_OFFSET_X);
break;case SC.HUGE_CONTROL_SIZE:this.setIfNull("itemHeight",SC.MenuPane.HUGE_MENU_ITEM_HEIGHT);
this.setIfNull("itemSeparatorHeight",SC.MenuPane.HUGE_MENU_ITEM_SEPARATOR_HEIGHT);
this.setIfNull("menuHeightPadding",SC.MenuPane.HUGE_MENU_HEIGHT_PADDING);this.setIfNull("submenuOffsetX",SC.MenuPane.HUGE_SUBMENU_OFFSET_X);
break}return arguments.callee.base.apply(this,arguments)},setIfNull:function(d,e){if(this.get(d)===null){this.set(d,e)
}},render:function(d,e){d.addClass(this.get("controlSize"));return arguments.callee.base.apply(this,arguments)
},createChildViews:function(){var e,d,g;e=this.createChildView(SC.MenuScrollView,{borderStyle:SC.BORDER_NONE,controlSize:this.get("controlSize")});
d=this._menuView=SC.View.create();g=this.get("menuItemViews");d.set("layout",{top:0,left:0,height:this.get("menuHeight")});
d.replaceAllChildren(g);e.set("contentView",d);this.childViews=[e];return this},paneDidAttach:function(){var d=(this.rootResponder=SC.RootResponder.responder);
d.panes.add(this);this.set("currentWindowSize",d.computeWindowSize());this.set("isPaneAttached",YES);
this.parentViewDidChange();this._notifyDidAppendToDocument();this.becomeMenuPane();
return this},becomeMenuPane:function(){if(this.rootResponder){this.rootResponder.makeMenuPane(this)
}return this},resignMenuPane:function(){if(this.rootResponder){this.rootResponder.makeMenuPane(null)
}return this},menuItemViews:function(){var y=[],s=this.get("displayItems"),o=this.get("exampleView"),A,u,z,g,p,e,k,j,m,d,l,h,x,n;
if(!s){return y}g=this.get("itemHeightKey");p=this.get("itemSeparatorKey");e=this.get("itemHeight");
d=this.get("itemKeyEquivalentKey");k=this.get("itemSeparatorHeight");m=Math.floor(this.get("menuHeightPadding")/2);
j=m;h=this.menuItemKeys.map(SC._menu_fetchKeys,this);n=s.get("length");for(x=0;x<n;
x++){A=s[x];z=A.get(g);if(!z){z=A.get(p)?k:e}u=this._menuView.createChildView(o,{layout:{height:z,top:j},contentDisplayProperties:h,content:A,parentMenu:this});
y[x]=u;j+=z;l=A.get(d);if(l){this._keyEquivalents[l]=u}}this.set("menuHeight",j+m);
return y}.property("displayItems").cacheable(),menuItemViewForContentIndex:function(d){var e=this.get("menuItemViews");
if(!e){return undefined}return e.objectAt(d)},_keyEquivalents:{},rootMenu:function(){if(this.get("isSubMenu")){return this.getPath("parentMenu.rootMenu")
}return this}.property("isSubMenu").cacheable(),windowSizeDidChange:function(e,d){this.remove();
return arguments.callee.base.apply(this,arguments)},displayItems:function(){var h=this.get("items"),g=this.get("localize"),m=this.get("itemHeight"),e,j=[],d,k,l;
if(!h){return null}e=h.get("length");for(d=0;d<e;d++){k=h.objectAt(d);if(!k){continue
}l=SC.typeOf(k);if(l===SC.T_STRING){k=SC.Object.create({title:k,value:k,isEnabled:YES})
}else{if(l===SC.T_HASH){k=SC.Object.create(k)}else{if(l===SC.T_ARRAY){k=this.convertArrayMenuItemToObject(k)
}}}k.contentIndex=d;j.push(k)}return j}.property("items").cacheable(),_sc_menu_itemsDidChange:function(){var d=this.get("menuItemViews");
this._menuView.replaceAllChildren(d);this._menuView.adjust("height",this.get("menuHeight"))
}.observes("items"),convertArrayMenuItemToObject:function(k){SC.Logger.warn("Support for Array-based menu items has been deprecated.  Please update your menus to use a hash.");
var j,g=SC._menu_fetchKeys,e=SC._menu_fetchItem,m,h=SC.Object.create(),d,l;j=this.menuItemKeys.map(g,this);
h[j[0]]=k[0];h[j[1]]=k[1];h[j[2]]=k[2];h[j[3]]=k[3];h[j[4]]=k[4];h[j[5]]=k[5];h[j[6]]=k[6];
h[j[7]]=k[7];h[j[8]]=k[8];h[j[9]]=k[9];h[j[10]]=k[10];h[j[11]]=k[11];h[j[12]]=k[12];
return h},currentMenuItem:function(d,e){if(e!==undefined){if(this._currentMenuItem!==null){this.set("previousMenuItem",this._currentMenuItem)
}this._currentMenuItem=e;this.setPath("rootMenu.targetMenuItem",e);return e}return this._currentMenuItem
}.property().cacheable(),_sc_menu_currentMenuItemDidChange:function(){var d=this.get("currentMenuItem"),e=this.get("previousMenuItem");
if(e){if(e.get("hasSubMenu")&&d===null){}else{e.resignFirstResponder();this.closeOpenMenusFor(e)
}}if(d&&d.get("isEnabled")){d.scrollToVisible()}}.observes("currentMenuItem"),closeOpenMenusFor:function(d){if(!d){return
}var e=d.get("parentMenu");while(e&&d){e=d.get("subMenu");if(e){e.remove();d.resignFirstResponder();
d=e.get("previousMenuItem")}}},closeOpenMenus:function(){this.closeOpenMenusFor(this.get("previousMenuItem"))
},mouseDown:function(d){this.modalPaneDidClick();return YES},mouseEntered:function(d){this.set("mouseHasEntered",YES)
},keyUp:function(d){var e=this.interpretKeyEvents(d);return !e?NO:e},moveUp:function(){var g=this.get("currentMenuItem"),h=this.get("menuItemViews"),e,j,d;
if(!g){d=h.get("length")-1}else{e=g.getPath("content.contentIndex");if(e===0){return YES
}d=e-1}while(d>=0){if(h[d].get("isEnabled")){this.set("currentMenuItem",h[d]);h[d].becomeFirstResponder();
break}d--}return YES},moveDown:function(){var h=this.get("currentMenuItem"),j=this.get("menuItemViews"),e=j.get("length"),g,k,d;
if(!h){d=0}else{g=h.getPath("content.contentIndex");if(g===e){return YES}d=g+1}while(d<e){if(j[d].get("isEnabled")){this.set("currentMenuItem",j[d]);
j[d].becomeFirstResponder();break}d++}return YES},insertText:function(e,d){var h=this._timer,g=this._keyBuffer;
if(h){h.invalidate()}h=this._timer=SC.Timer.schedule({target:this,action:"clearKeyBuffer",interval:500,isPooled:NO});
g=g||"";g+=e.toUpperCase();this.selectMenuItemForString(g);this._keyBuffer=g;return YES
},performKeyEquivalent:function(e){var d=this._keyEquivalents[e];if(d){d.performAction(YES);
return YES}return NO},selectMenuItemForString:function(g){var h=this.get("menuItemViews"),k,l,e,d,j;
if(!h){return}j=g.length;d=h.get("length");for(e=0;e<d;e++){k=h.objectAt(e);l=k.get("title");
if(!l){continue}l=l.replace(/ /g,"").substr(0,j).toUpperCase();if(l===g){this.set("currentMenuItem",k);
k.becomeFirstResponder();break}}},clearKeyBuffer:function(){this._keyBuffer=""},modalPaneDidClick:function(d){this.closeOpenMenusFor(this.get("previousMenuItem"));
this.remove();return YES}});SC._menu_fetchKeys=function(d){return this.get(d)};SC._menu_fetchItem=function(d){if(!d){return null
}return this.get?this.get(d):this[d]};SC.MenuPane.TINY_MENU_ITEM_HEIGHT=10;SC.MenuPane.TINY_MENU_ITEM_SEPARATOR_HEIGHT=2;
SC.MenuPane.TINY_MENU_HEIGHT_PADDING=2;SC.MenuPane.TINY_SUBMENU_OFFSET_X=0;SC.MenuPane.SMALL_MENU_ITEM_HEIGHT=16;
SC.MenuPane.SMALL_MENU_ITEM_SEPARATOR_HEIGHT=7;SC.MenuPane.SMALL_MENU_HEIGHT_PADDING=4;
SC.MenuPane.SMALL_SUBMENU_OFFSET_X=2;SC.MenuPane.REGULAR_MENU_ITEM_HEIGHT=20;SC.MenuPane.REGULAR_MENU_ITEM_SEPARATOR_HEIGHT=9;
SC.MenuPane.REGULAR_MENU_HEIGHT_PADDING=6;SC.MenuPane.REGULAR_SUBMENU_OFFSET_X=2;
SC.MenuPane.LARGE_MENU_ITEM_HEIGHT=60;SC.MenuPane.LARGE_MENU_ITEM_SEPARATOR_HEIGHT=20;
SC.MenuPane.LARGE_MENU_HEIGHT_PADDING=0;SC.MenuPane.LARGE_SUBMENU_OFFSET_X=4;SC.MenuPane.HUGE_MENU_ITEM_HEIGHT=20;
SC.MenuPane.HUGE_MENU_ITEM_SEPARATOR_HEIGHT=9;SC.MenuPane.HUGE_MENU_HEIGHT_PADDING=0;
SC.MenuPane.HUGE_SUBMENU_OFFSET_X=0;SC.MenuPane.VERTICAL_OFFSET=23;SC.ModalPane=SC.Pane.extend({classNames:"sc-modal",layout:{top:0,left:0,bottom:0,right:0},_openPaneCount:0,paneWillAppend:function(d){this._openPaneCount++;
if(!this.get("isVisibleInWindow")){this.append()}return this},paneDidRemove:function(d){this._openPaneCount--;
if(this._openPaneCount<=0){this._openPaneCount=0;if(this.get("isVisibleInWindow")){this.remove()
}}},mouseDown:function(e){var d=this.get("owner");if(d&&d.modalPaneDidClick){d.modalPaneDidClick(e)
}},touchStart:function(d){this.mouseDown(d)}});sc_require("panes/panel");SC.PalettePane=SC.PanelPane.extend({classNames:"sc-palette",isModal:NO,modalPane:SC.ModalPane,isAnchored:NO,_mouseOffsetX:null,_mouseOffsetY:null,mouseDown:function(d){var e=this.get("frame");
this._mouseOffsetX=e?(e.x-d.pageX):0;this._mouseOffsetY=e?(e.y-d.pageY):0;return YES
},mouseDragged:function(d){if(!this.isAnchored){this.set("layout",{width:this.layout.width,height:this.layout.height,left:this._mouseOffsetX+d.pageX,top:this._mouseOffsetY+d.pageY});
this.updateLayout()}return YES},touchStart:function(d){return this.mouseDown(d)},touchesDragged:function(d){return this.mouseDragged(d)
}});sc_require("panes/modal");SC.PanelPane=SC.Pane.extend({layout:{left:0,right:0,top:0,bottom:0},classNames:["sc-panel"],acceptsKeyPane:YES,isModal:YES,modalPane:SC.ModalPane.extend({classNames:"for-sc-panel"}),contentView:null,contentViewBindingDefault:SC.Binding.single(),render:function(d,e){if(d.needsContent){this.renderChildViews(d,e);
d.push("<div class='top-left-edge'></div>","<div class='top-edge'></div>","<div class='top-right-edge'></div>","<div class='right-edge'></div>","<div class='bottom-right-edge'></div>","<div class='bottom-edge'></div>","<div class='bottom-left-edge'></div>","<div class='left-edge'></div>")
}},replaceContent:function(d){this.removeAllChildren();if(d){this.appendChild(d)}},createChildViews:function(){var d=this.contentView;
if(d){d=this.contentView=this.createChildView(d);this.childViews=[d]}},contentViewDidChange:function(){this.replaceContent(this.get("contentView"))
}.observes("contentView"),_modalPane:function(){var d=this.get("modalPane");if(d&&d.isClass){d=d.create({owner:this});
this.set("modalPane",d)}return d},appendTo:function(d){var e;if(!this.get("isVisibleInWindow")&&this.get("isModal")&&(e=this._modalPane())){this._isShowingModal=YES;
e.paneWillAppend(this)}return arguments.callee.base.apply(this,arguments)},remove:function(){var e,d=arguments.callee.base.apply(this,arguments);
if(this._isShowingModal){this._isShowingModal=NO;if(e=this._modalPane()){e.paneDidRemove(this)
}}return d},_isModalDidChange:function(){var e,d=this.get("isModal");if(d){if(!this._isShowingModal&&this.get("isVisibleInWindow")&&(e=this._modalPane())){this._isShowingModal=YES;
e.paneWillAppend(this)}}else{if(this._isShowingModal&&(e=this._modalPane())){this._isShowingModal=NO;
e.paneDidRemove(this)}}}.observes("isModal"),paneDidAttach:function(){var d=arguments.callee.base.apply(this,arguments);
this.becomeKeyPane();return d}});sc_require("panes/palette");SC.PICKER_MENU="menu";
SC.PICKER_FIXED="fixed";SC.PICKER_POINTER="pointer";SC.PICKER_MENU_POINTER="menu-pointer";
SC.POINTER_LAYOUT=["perfectRight","perfectLeft","perfectTop","perfectBottom"];SC.PickerPane=SC.PalettePane.extend({classNames:"sc-picker",isAnchored:YES,isModal:YES,pointerPos:"perfectRight",pointerPosX:0,pointerPosY:0,anchorElement:null,preferType:null,preferMatrix:null,pointerOffset:null,extraRightOffset:0,popup:function(h,g,j,d){var e=h.isView?h.get("layer"):h;
this.beginPropertyChanges();this.set("anchorElement",e);if(g){this.set("preferType",g)
}if(j){this.set("preferMatrix",j)}if(d){this.set("pointerOffset",d)}this.endPropertyChanges();
this.positionPane();this.append()},positionPane:function(){var e=this.get("anchorElement"),g=this.get("preferType"),h=this.get("preferMatrix"),j=this.get("layout"),d;
if(e){e=this.computeAnchorRect(e);if(e.x===0&&e.y===0){return}d=SC.cloneRect(e);if(g){switch(g){case SC.PICKER_MENU:case SC.PICKER_FIXED:if(!h||h.length!==3){this.set("preferMatrix",[1,4,3])
}d.x+=((this.preferMatrix[2]===0)?d.width:0)+this.preferMatrix[0];d.y+=((this.preferMatrix[2]===3)?d.height:0)+this.preferMatrix[1];
break;default:d.y+=d.height;break}}else{d.y+=d.height}d=this.fitPositionToScreen(d,this.get("frame"),e);
this.adjust({width:d.width,height:d.height,left:d.x,top:d.y})}else{this.adjust({width:j.width,height:j.height,centerX:0,centerY:0})
}this.updateLayout();return this},computeAnchorRect:function(g){var e=SC.viewportOffset(g);
var h=SC.$(g);var d=SC.RootResponder.responder.computeWindowSize();e.width=h.outerWidth();
e.height=(d.height-e.y)<h.outerHeight()?(d.height-e.y):h.outerHeight();return e},fitPositionToScreen:function(j,g,e){var d=SC.RootResponder.responder.computeWindowSize();
var h={x:0,y:0,width:d.width,height:d.height};g.x=j.x;g.y=j.y;if(this.preferType){switch(this.preferType){case SC.PICKER_MENU:g=this.fitPositionToScreenMenu(h,g,this.get("isSubMenu"));
break;case SC.PICKER_POINTER:case SC.PICKER_MENU_POINTER:this.setupPointer(e);g=this.fitPositionToScreenPointer(h,g,e);
break;case SC.PICKER_FIXED:break;default:break}}else{g=this.fitPositionToScreenDefault(h,g,e)
}this.displayDidChange();return g},fitPositionToScreenDefault:function(e,g,d){if(SC.maxX(g)>e.width){var h=Math.max(SC.maxX(d),g.width);
g.x=Math.min(h,e.width)-g.width}if(SC.minX(g)<0){g.x=SC.minX(Math.max(d,0));if(SC.maxX(g)>e.width){g.x=Math.max(0,e.width-g.width)
}}if(SC.maxY(g)>e.height){h=Math.max((d.y-g.height),0);if(h>e.height){g.y=Math.max(0,e.height-g.height)
}else{g.y=h}}if(SC.minY(g)<0){h=Math.min(SC.maxY(d),(e.height-d.height));g.y=Math.max(h,0)
}return g},fitPositionToScreenMenu:function(g,e,d){if(d){e.x-=this.get("submenuOffsetX");
e.y-=Math.floor(this.get("menuHeightPadding")/2)}if((e.x+e.width)>(g.width-20)){if(d){e.x=e.x-(e.width*2)
}else{e.x=g.width-e.width-20}}if(e.x<7){e.x=7}if(e.y<7){e.height+=e.y;e.y=7}if(e.height+e.y+35>=g.height){if(e.height+50>=g.height){e.y=SC.MenuPane.VERTICAL_OFFSET;
e.height=g.height-(SC.MenuPane.VERTICAL_OFFSET*2)}else{e.y+=(g.height-(e.height+e.y+35))
}}return e},fitPositionToScreenPointer:function(s,o,p){var k=[this.pointerOffset[0],this.pointerOffset[1],this.pointerOffset[2],this.pointerOffset[3]];
var h=[[p.x+p.width+k[0],p.y+parseInt(p.height/2,0)-40],[p.x-o.width+k[1],p.y+parseInt(p.height/2,0)-40],[p.x+parseInt((p.width/2)-(o.width/2),0),p.y-o.height+k[2]],[p.x+parseInt((p.width/2)-(o.width/2),0),p.y+p.height+k[3]]];
var e=[[p.x+p.width+o.width+k[0],p.y+parseInt(p.height/2,0)+o.height-24],[p.x+k[1],p.y+parseInt(p.height/2,0)+o.height-24],[p.x+parseInt((p.width/2)-(o.width/2),0)+o.width,p.y+k[2]],[p.x+parseInt((p.width/2)-(o.width/2),0)+o.width,p.y+p.height+o.height+k[3]]];
var j=[[h[0][1]>0?0:0-h[0][1],e[0][0]<s.width?0:e[0][0]-s.width,e[0][1]<s.height?0:e[0][1]-s.height,h[0][0]>0?0:0-h[0][0]],[h[1][1]>0?0:0-h[1][1],e[1][0]<s.width?0:e[1][0]-s.width,e[1][1]<s.height?0:e[1][1]-s.height,h[1][0]>0?0:0-h[1][0]],[h[2][1]>0?0:0-h[2][1],e[2][0]<s.width?0:e[2][0]-s.width,e[2][1]<s.height?0:e[2][1]-s.height,h[2][0]>0?0:0-h[2][0]],[h[3][1]>0?0:0-h[3][1],e[3][0]<s.width?0:e[3][0]-s.width,e[3][1]<s.height?0:e[3][1]-s.height,h[3][0]>0?0:0-h[3][0]]];
var g=this.preferMatrix;if(g[4]===-1){o.x=p.x+parseInt(p.width/2,0);o.y=p.y+parseInt(p.height/2,0)-parseInt(o.height/2,0);
this.set("pointerPos",SC.POINTER_LAYOUT[0]+" fallback");this.set("pointerPosY",parseInt(o.height/2,0)-40)
}else{o.x=h[g[4]][0];o.y=h[g[4]][1];this.set("pointerPos",SC.POINTER_LAYOUT[g[4]]);
this.set("pointerPosY",0)}this.set("pointerPosX",0);for(var l=0,d,n=SC.POINTER_LAYOUT.length;
l<n;l++){d=g[l];if(j[d][0]===0&&j[d][1]===0&&j[d][2]===0&&j[d][3]===0){if(g[4]!==d){o.x=h[d][0];
o.y=h[d][1];this.set("pointerPosY",0);this.set("pointerPos",SC.POINTER_LAYOUT[d])
}l=SC.POINTER_LAYOUT.length}else{if((d===0||d===1)&&j[d][0]===0&&j[d][1]===0&&j[d][2]<o.height-91&&j[d][3]===0){if(g[4]!==d){o.x=h[d][0];
this.set("pointerPos",SC.POINTER_LAYOUT[d])}o.y=h[d][1]-j[d][2];this.set("pointerPosY",j[d][2]);
l=SC.POINTER_LAYOUT.length}else{if((d===0||d===1)&&j[d][0]===0&&j[d][1]===0&&j[d][2]<=o.height-51&&j[d][3]===0){if(g[4]!==d){o.x=h[d][0]
}o.y=h[d][1]-(o.height-51);this.set("pointerPosY",(o.height-53));this.set("pointerPos",SC.POINTER_LAYOUT[d]+" extra-low");
l=SC.POINTER_LAYOUT.length}else{if((d===2||d===3)&&j[d][0]===0&&j[d][1]<=parseInt(o.width/2,0)-this.get("extraRightOffset")&&j[d][2]===0&&j[d][3]===0){if(g[4]!==d){o.y=h[d][1]
}o.x=h[d][0]-(parseInt(o.width/2,0)-this.get("extraRightOffset"));this.set("pointerPos",SC.POINTER_LAYOUT[d]+" extra-right");
l=SC.POINTER_LAYOUT.length}else{if((d===2||d===3)&&j[d][0]===0&&j[d][1]===0&&j[d][2]===0&&j[d][3]<=parseInt(o.width/2,0)-this.get("extraRightOffset")){if(g[4]!==d){o.y=h[d][1]
}o.x=h[d][0]+(parseInt(o.width/2,0)-this.get("extraRightOffset"));this.set("pointerPos",SC.POINTER_LAYOUT[d]+" extra-left");
l=SC.POINTER_LAYOUT.length}}}}}}return o},setupPointer:function(d){if(!this.pointerOffset||this.pointerOffset.length!==4){if(this.get("preferType")==SC.PICKER_MENU_POINTER){switch(this.get("controlSize")){case SC.TINY_CONTROL_SIZE:this.set("pointerOffset",SC.PickerPane.TINY_PICKER_MENU_POINTER_OFFSET);
this.set("extraRightOffset",SC.PickerPane.TINY_PICKER_MENU_EXTRA_RIGHT_OFFSET);break;
case SC.SMALL_CONTROL_SIZE:this.set("pointerOffset",SC.PickerPane.SMALL_PICKER_MENU_POINTER_OFFSET);
this.set("extraRightOffset",SC.PickerPane.SMALL_PICKER_MENU_EXTRA_RIGHT_OFFSET);break;
case SC.REGULAR_CONTROL_SIZE:this.set("pointerOffset",SC.PickerPane.REGULAR_PICKER_MENU_POINTER_OFFSET);
this.set("extraRightOffset",SC.PickerPane.REGULAR_PICKER_MENU_EXTRA_RIGHT_OFFSET);
break;case SC.LARGE_CONTROL_SIZE:this.set("pointerOffset",SC.PickerPane.LARGE_PICKER_MENU_POINTER_OFFSET);
this.set("extraRightOffset",SC.PickerPane.LARGE_PICKER_MENU_EXTRA_RIGHT_OFFSET);break;
case SC.HUGE_CONTROL_SIZE:this.set("pointerOffset",SC.PickerPane.HUGE_PICKER_MENU_POINTER_OFFSET);
this.set("extraRightOffset",SC.PickerPane.HUGE_PICKER_MENU_EXTRA_RIGHT_OFFSET);break
}}else{var g=(d.width<16)?((d.width<4)?9:6):0;var e=(d.height<16)?((d.height<4)?9:6):0;
var h=[SC.PickerPane.PICKER_POINTER_OFFSET[0]+g,SC.PickerPane.PICKER_POINTER_OFFSET[1]-g,SC.PickerPane.PICKER_POINTER_OFFSET[2]-e,SC.PickerPane.PICKER_POINTER_OFFSET[3]+e];
this.set("pointerOffset",h);this.set("extraRightOffset",SC.PickerPane.PICKER_EXTRA_RIGHT_OFFSET)
}}if(!this.preferMatrix||this.preferMatrix.length!==5){this.set("preferMatrix",this.get("preferType")==SC.PICKER_MENU_POINTER?[3,0,1,2,3]:[0,1,2,3,2])
}},displayProperties:["pointerPosY"],render:function(e,h){var d=arguments.callee.base.apply(this,arguments);
if(e.needsContent){if(this.get("preferType")==SC.PICKER_POINTER||this.get("preferType")==SC.PICKER_MENU_POINTER){e.push('<div class="sc-pointer '+this.get("pointerPos")+'" style="margin-top: '+this.get("pointerPosY")+'px"></div>');
e.addClass(this.get("pointerPos"))}}else{if(this.get("preferType")==SC.PICKER_POINTER||this.get("preferType")==SC.PICKER_MENU_POINTER){var g=this.$(".sc-pointer");
g.attr("class","sc-pointer "+this.get("pointerPos"));g.attr("style","margin-top: "+this.get("pointerPosY")+"px");
e.addClass(this.get("pointerPos"))}}return d},modalPaneDidClick:function(d){var e=this.get("frame");
if(!this.clickInside(e,d)){this.remove()}return YES},mouseDown:function(d){return this.modalPaneDidClick(d)
},clickInside:function(e,d){return SC.pointInRect({x:d.pageX,y:d.pageY},e)},windowSizeDidChange:function(e,d){this.positionPane()
}});SC.PickerPane.PICKER_POINTER_OFFSET=[9,-9,-18,18];SC.PickerPane.PICKER_EXTRA_RIGHT_OFFSET=20;
SC.PickerPane.TINY_PICKER_MENU_POINTER_OFFSET=[9,-9,-18,18];SC.PickerPane.TINY_PICKER_MENU_EXTRA_RIGHT_OFFSET=12;
SC.PickerPane.SMALL_PICKER_MENU_POINTER_OFFSET=[9,-9,-8,8];SC.PickerPane.SMALL_PICKER_MENU_EXTRA_RIGHT_OFFSET=11;
SC.PickerPane.REGULAR_PICKER_MENU_POINTER_OFFSET=[9,-9,-12,12];SC.PickerPane.REGULAR_PICKER_MENU_EXTRA_RIGHT_OFFSET=13;
SC.PickerPane.LARGE_PICKER_MENU_POINTER_OFFSET=[9,-9,-16,16];SC.PickerPane.LARGE_PICKER_MENU_EXTRA_RIGHT_OFFSET=17;
SC.PickerPane.HUGE_PICKER_MENU_POINTER_OFFSET=[9,-9,-18,18];SC.PickerPane.HUGE_PICKER_MENU_EXTRA_RIGHT_OFFSET=12;
sc_require("views/button");SC.SelectButtonView=SC.ButtonView.extend({objects:[],objectsBindingDefault:SC.Binding.multiple(),nameKey:null,sortKey:null,valueKey:null,iconKey:null,isEnabledKey:"isEnabled",localize:YES,disableSort:YES,classNames:["select-button"],menu:null,itemList:[],itemIdx:null,value:null,checkboxEnabled:YES,separatorPostion:null,_defaultVal:null,_defaultTitle:null,_defaultIcon:null,theme:"popup",displayProperties:["icon","value","controlSize","objects"],preferMatrix:null,SELECT_BUTTON_SPRITE_WIDTH:28,isActiveBinding:"*menu.isVisibleInWindow",isDefaultPosition:NO,lastMenuWidth:null,customView:null,customViewClassName:null,customViewMenuOffsetWidth:0,needsEllipsis:YES,menuPaneHeightPadding:0,supportFocusRing:YES,leftAlign:function(){switch(this.get("controlSize")){case SC.TINY_CONTROL_SIZE:return SC.SelectButtonView.TINY_OFFSET_X;
case SC.SMALL_CONTROL_SIZE:return SC.SelectButtonView.SMALL_OFFSET_X;case SC.REGULAR_CONTROL_SIZE:return SC.SelectButtonView.REGULAR_OFFSET_X;
case SC.LARGE_CONTROL_SIZE:return SC.SelectButtonView.LARGE_OFFSET_X;case SC.HUGE_CONTROL_SIZE:return SC.SelectButtonView.HUGE_OFFSET_X
}return 0}.property("controlSize"),sortObjects:function(e){if(!this.get("disableSort")){var d=this.get("sortKey")||this.get("nameKey");
e=e.sort(function(h,g){if(d){h=h.get?h.get(d):h[d];g=g.get?g.get(d):g[d]}return(h<g)?-1:((h>g)?1:0)
})}return e},render:function(e,j){arguments.callee.base.apply(this,arguments);var g,d,x,A,D,k,C,l,s,y,p,h,n,E,z,u,B,o,m;
g=this.layout.width;if(j&&g){this.adjust({width:g-this.SELECT_BUTTON_SPRITE_WIDTH})
}d=this.get("objects");d=this.sortObjects(d);x=d.length;A=this.get("nameKey");D=this.get("iconKey");
k=this.get("valueKey");m=this.get("isEnabledKey");C=this.get("checkboxEnabled");l=this.get("value");
s=this.get("localize");y=this.get("separatorPostion");p=[];h=YES;n=0;d.forEach(function(F){if(F){E=A?(F.get?F.get(A):F[A]):F.toString();
E=s?E.loc():E;z=D?(F.get?F.get(D):F[D]):null;if(SC.none(F[D])){z=null}u=(k)?(F.get?F.get(k):F[k]):F;
if(!SC.none(l)&&!SC.none(u)){if(l===u){this.set("title",E);this.set("icon",z)}}if(u===this.get("value")){this.set("itemIdx",n);
h=!C?NO:YES}else{h=NO}o=F[m];if(NO!==o){o=YES}if(n===0){this._defaultVal=u;this._defaultTitle=E;
this._defaultIcon=z}var G=SC.Object.create({title:E,icon:z,value:u,isEnabled:o,checkbox:h,target:this,action:this.displaySelectedItem});
p.push(G)}n+=1;if(y&&n===(x-y)){var H=SC.Object.create({separator:YES});p.push(H)
}this.set("itemList",p)},this);if(j){this.invokeLast(function(){var F=this.get("value");
if(SC.none(F)){this.set("value",this._defaultVal);this.set("title",this._defaultTitle);
this.set("icon",this._defaultIcon)}})}this.changeSelectButtonPreferMatrix(this.itemIdx)
},_action:function(s){var m,d,n,o,A,x,H,j,G,g,u,B,y,E,k,l,p,e,F;m=this.$(".sc-button-label")[0];
var I=SC.SelectButtonView.MENU_WIDTH_OFFSET;if(!this.get("isDefaultPosition")){switch(this.get("controlSize")){case SC.TINY_CONTROL_SIZE:I+=SC.SelectButtonView.TINY_POPUP_MENU_WIDTH_OFFSET;
break;case SC.SMALL_CONTROL_SIZE:I+=SC.SelectButtonView.SMALL_POPUP_MENU_WIDTH_OFFSET;
break;case SC.REGULAR_CONTROL_SIZE:I+=SC.SelectButtonView.REGULAR_POPUP_MENU_WIDTH_OFFSET;
break;case SC.LARGE_CONTROL_SIZE:I+=SC.SelectButtonView.LARGE_POPUP_MENU_WIDTH_OFFSET;
break;case SC.HUGE_CONTROL_SIZE:I+=SC.SelectButtonView.HUGE_POPUP_MENU_WIDTH_OFFSET;
break}}d=this.get("layer").offsetWidth+I;n=m.scrollWidth;o=this.get("lastMenuWidth");
if(n){A=m.offsetWidth;if(n&&A){d=d+n-A}}if(!o||(d>o)){o=d}x=this.get("itemList");
var C=this.get("customViewClassName");var z=this.get("customViewMenuOffsetWidth");
var h="sc-view sc-pane sc-panel sc-palette sc-picker sc-menu select-button sc-scroll-view sc-menu-scroll-view sc-container-view menuContainer sc-button-view sc-menu-item sc-regular-size";
h=C?(h+" "+C):h;for(u=0,F=x.length;u<F;++u){G=x.objectAt(u);g=document.createElement("div");
g.style.cssText="top:-10000px; left: -10000px;  position: absolute;";g.className=h;
g.innerHTML=G.title;document.body.appendChild(g);H=g.offsetWidth+z;if(!j||(H>j)){j=H
}document.body.removeChild(g)}o=(j>o)?j:o;var D=SC.RootResponder.responder.get("currentWindowSize").width;
if(o>D){o=(D-25)}this.set("lastMenuWidth",o);B=this.get("value");y=this.get("itemList");
E=this.get("controlSize");l=this.get("customView");p=l?l:SC.MenuItemView;e=SC.MenuPane.create({classNames:["select-button"],items:y,exampleView:p,isEnabled:YES,preferType:SC.PICKER_MENU,itemHeightKey:"height",layout:{width:o},controlSize:E,itemWidth:o});
if(!e){return NO}e.popup(this,this.preferMatrix);this.set("menu",e);l=e.menuItemViewForContentIndex(this.get("itemIdx"));
e.set("currentMenuItem",l);l.becomeFirstResponder();this.set("isActive",YES);return YES
},displaySelectedItem:function(d){var e=d.get("selectedItem");this.set("value",e.get("value"));
this.set("title",e.get("title"));this.set("itemIdx",e.get("contentIndex"))},changeSelectButtonPreferMatrix:function(){var g=0,l=0;
switch(this.get("controlSize")){case SC.TINY_CONTROL_SIZE:g=SC.SelectButtonView.TINY_OFFSET_Y;
l=SC.MenuPane.TINY_MENU_ITEM_HEIGHT;break;case SC.SMALL_CONTROL_SIZE:g=SC.SelectButtonView.SMALL_OFFSET_Y;
l=SC.MenuPane.SMALL_MENU_ITEM_HEIGHT;break;case SC.REGULAR_CONTROL_SIZE:g=SC.SelectButtonView.REGULAR_OFFSET_Y;
l=SC.MenuPane.REGULAR_MENU_ITEM_HEIGHT;break;case SC.LARGE_CONTROL_SIZE:g=SC.SelectButtonView.LARGE_OFFSET_Y;
l=SC.MenuPane.LARGE_MENU_ITEM_HEIGHT;break;case SC.HUGE_CONTROL_SIZE:g=SC.SelectButtonView.HUGE_OFFSET_Y;
l=SC.MenuPane.HUGE_MENU_ITEM_HEIGHT;break}var j=g,e=this.get("itemIdx"),d=this.get("leftAlign"),k,h;
if(this.get("isDefaultPosition")){k=[1,0,3];this.set("preferMatrix",k)}else{if(e){j=e*l+g
}h=[d,-j,2];this.set("preferMatrix",h)}},mouseDown:function(d){if(!this.get("isEnabled")){return YES
}this.set("isActive",YES);this._isMouseDown=YES;this._mouseDownTimestamp=d.timeStamp;
this.becomeFirstResponder();this._action();return YES},mouseUp:function(e){var h=this.get("menu"),d,g;
if(h){d=h.getPath("rootMenu.targetMenuItem");if(d&&h.get("mouseHasEntered")){if(!d.performAction()){h.remove()
}}else{if(e.timeStamp-this._mouseDownTimestamp>400){h.remove()}}}this._isMouseDown=NO;
return YES},mouseExited:function(){return YES},keyDown:function(d){if(this.interpretKeyEvents(d)){return YES
}else{arguments.callee.base.apply(this,arguments)}},interpretKeyEvents:function(d){if(d){if((d.keyCode===38||d.keyCode===40)){this._action()
}else{if(d.keyCode===27){this.resignFirstResponder()}}}return arguments.callee.base.apply(this,arguments)
},acceptsFirstResponder:function(){return this.get("isEnabled")}.property("isEnabled"),_button_isSelectedDidChange:function(){}.observes("isSelected")});
SC.SelectButtonView.TINY_OFFSET_X=0;SC.SelectButtonView.TINY_OFFSET_Y=0;SC.SelectButtonView.TINY_POPUP_MENU_WIDTH_OFFSET=0;
SC.SelectButtonView.SMALL_OFFSET_X=-18;SC.SelectButtonView.SMALL_OFFSET_Y=3;SC.SelectButtonView.SMALL_POPUP_MENU_WIDTH_OFFSET=7;
SC.SelectButtonView.REGULAR_OFFSET_X=-17;SC.SelectButtonView.REGULAR_OFFSET_Y=3;SC.SelectButtonView.REGULAR_POPUP_MENU_WIDTH_OFFSET=4;
SC.SelectButtonView.LARGE_OFFSET_X=-17;SC.SelectButtonView.LARGE_OFFSET_Y=6;SC.SelectButtonView.LARGE_POPUP_MENU_WIDTH_OFFSET=3;
SC.SelectButtonView.HUGE_OFFSET_X=0;SC.SelectButtonView.HUGE_OFFSET_Y=0;SC.SelectButtonView.HUGE_POPUP_MENU_WIDTH_OFFSET=0;
SC.SelectButtonView.MENU_WIDTH_OFFSET=-2;sc_require("panes/panel");SC.SheetPane=SC.PanelPane.extend({classNames:"sc-sheet",modalPane:SC.ModalPane,transitionDuration:200,_state:"NO_VIEW",init:function(){arguments.callee.base.apply(this,arguments);
if(SC.Animatable){SC.SheetPane.ANIMATABLE_AVAILABLE=YES;this.mixin(SC.Animatable);
if(!this.transitions){this.transitions={}}if(!this.transitions.top){this.transitions.top={duration:this.transitionDuration===200?0.3:this.transitionDuration/1000,action:"_complete",target:this}
}}},append:function(){var d=this.get("layout");if(!d.height||!d.top){d=SC.View.convertLayoutToAnchoredLayout(d,this.computeParentDimensions())
}d.top=-1*d.height;if(this.disableAnimation){this.disableAnimation()}this.adjust(d);
this.updateLayout();if(this.enableAnimation){this.enableAnimation()}return arguments.callee.base.apply(this,arguments)
},remove:function(){var e=this,d=arguments;this.invokeLater(function(){d.callee.base.apply(e,d)
},this.transitionDuration);this.slideUp();return this},paneDidAttach:function(){var d=arguments.callee.base.apply(this,arguments);
this.slideDown();return d},slideDown:function(){this._state=SC.SheetPane.ANIMATING;
this._direction=SC.SheetPane.SLIDE_DOWN;if(SC.SheetPane.ANIMATABLE_AVAILABLE){this.transitions.top.timing=SC.Animatable.TRANSITION_EASE_OUT;
this.adjust("top",0)}else{this._start=Date.now();this._end=this._start+this.get("transitionDuration");
this.tick()}},slideUp:function(){this._state=SC.SheetPane.ANIMATING;this._direction=SC.SheetPane.SLIDE_UP;
if(SC.SheetPane.ANIMATABLE_AVAILABLE){var d=this.get("layout");this.transitions.top.timing=SC.Animatable.TRANSITION_EASE_IN;
this.adjust("top",-1*d.height)}else{this._start=Date.now();this._end=this._start+this.get("transitionDuration");
this.tick()}},_complete:function(){var d=this._direction;if(d===SC.SheetPane.SLIDE_DOWN){if(!SC.SheetPane.ANIMATABLE_AVAILABLE){this.adjust("top",0)
}if(SC.browser.mozilla){this.parentViewDidChange()}}else{var e=this.get("layout");
if(!SC.SheetPane.ANIMATABLE_AVAILABLE){this.adjust("top",-1*e.height)}}this._state=SC.SheetPane.READY;
this.updateLayout()},blurTo:function(d){this.setFirstResponder("")},tick:function(){this._timer=null;
var e=Date.now();var j=(e-this._start)/(this._end-this._start),l=this,d=this._direction,g=this.get("layout"),h,k;
if(j<0){j=0}if(j>=1){this._complete();return this}k=Math.floor(g.height*j);if(d==SC.SheetPane.SLIDE_DOWN){l.adjust("top",0-(g.height-k))
}else{if(d==SC.SheetPane.SLIDE_UP){l.adjust("top",0-k)}}this._timer=this.invokeLater(this.tick,20);
l.updateLayout();return this}});SC.SheetPane.mixin({ANIMATABLE_AVAILABLE:NO,NO_VIEW:"NO_VIEW",ANIMATING:"ANIMATING",READY:"READY",SLIDE_DOWN:"SLIDEDOWN",SLIDE_UP:"SLIDEUP"});
require("system/drag");SC.DragDataSource={dragDataTypes:[],dragDataForType:function(e,d){return null
}};require("system/drag");SC.DragSource={dragSourceOperationMaskFor:function(d,e){return SC.DRAG_NONE
},ignoreModifierKeysWhileDragging:NO,dragDidBegin:function(d,e){},dragDidMove:function(d,e){},dragDidEnd:function(d,e,g){}};
require("system/drag");SC.DropTarget={isDropTarget:true,dragStarted:function(e,d){},dragEntered:function(e,d){},dragUpdated:function(e,d){},dragExited:function(e,d){},dragEnded:function(e,d){},computeDragOperations:function(e,d){return SC.DRAG_NONE
},acceptDragOperation:function(d,e){return YES},performDragOperation:function(d,e){return SC.DRAG_NONE
}};SC.ResponderProtocol={mouseDown:function(d){},mouseUp:function(d){},mouseDragged:function(d){},mouseOut:function(d){},mouseOver:function(d){},mouseMoved:function(d){},selectStart:function(d){},contextMenu:function(d){},insertText:function(d){},performKeyEquivalent:function(e,d){return false
},cancel:function(e,d){},deleteBackward:function(e,d){},deleteForward:function(e,d){},insertBacktab:function(e,d){},insertNewline:function(e,d){},insertTab:function(e,d){},moveLeft:function(e,d){},moveRight:function(e,d){},moveUp:function(e,d){},moveDown:function(e,d){},moveLeftAndModifySelection:function(e,d){},moveRightAndModifySelection:function(e,d){},moveUpAndModifySelection:function(e,d){},moveDownAndModifySelection:function(e,d){},moveToBeginningOfDocument:function(e,d){},moveToEndOfDocument:function(e,d){},pageDown:function(e,d){},pageUp:function(e,d){},selectAll:function(e,d){}};
SC.DRAG_LINK=4;SC.DRAG_COPY=1;SC.DRAG_MOVE=2;SC.DRAG_NONE=0;SC.DRAG_ANY=7;SC.DRAG_AUTOSCROLL_ZONE_THICKNESS=20;
SC.Drag=SC.Object.extend({source:null,ghostView:null,ghostActsLikeCursor:NO,dragView:null,ghost:YES,slideBack:YES,mouseDownEvent:null,ghostOffset:{x:0,y:0},location:{},dataTypes:function(){if(this.dataSource){return this.dataSource.get("dragDataTypes")||[]
}var h=this.data;if(h){var d=[];for(var e in h){if(h.hasOwnProperty(e)){d.push(e)
}}return d}var g=this.get("source");if(g&&g.dragDataTypes){return g.get("dragDataTypes")||[]
}return[]}.property().cacheable(),hasDataType:function(d){return(this.get("dataTypes").indexOf(d)>=0)
},dataForType:function(d){if(this.dataSource){return this.dataSource.dragDataForType(this,d)
}else{if(this.data){return this.data[d]}else{var e=this.get("source");if(e&&SC.typeOf(e.dragDataForType)==SC.T_FUNCTION){return e.dragDataForType(this,d)
}else{return null}}}},dataSource:null,data:null,allowedDragOperations:SC.DRAG_ANY,_dragInProgress:YES,_dragViewWasVisible:null,startDrag:function(){this._createGhostView();
var m=this.event;var j={x:m.pageX,y:m.pageY};this.set("location",j);var e=this._getDragView();
var n=e.get("parentView");var k=n?n.convertFrameToView(e.get("frame"),null):e.get("frame");
if(this.get("ghost")){this._dragViewWasVisible=e.get("isVisible");e.set("isVisible",NO)
}if(this.ghostActsLikeCursor){this.ghostOffset={x:14,y:14}}else{this.ghostOffset={x:(j.x-k.x),y:(j.y-k.y)}
}if(!this._ghostViewHidden){this._positionGhostView(m)}this.ghostView.rootResponder.dragDidStart(this);
var d=this.source;if(d&&d.dragDidBegin){d.dragDidBegin(this,j)}var g=this._dropTargets();
for(var l=0,h=g.length;l<h;l++){g[l].tryToPerform("dragStarted",this,m)}},mouseDragged:function(d){var e=this._autoscroll(d);
var k=this.get("location");if(!e&&(d.pageX===k.x)&&(d.pageY===k.y)){return}k={x:d.pageX,y:d.pageY};
this.set("location",k);var h=this.source;var g=this._lastTarget;var j=this._findDropTarget(d);
var l=SC.DRAG_NONE;while(j&&(j!==g)&&(l===SC.DRAG_NONE)){if(j&&h&&h.dragSourceOperationMaskFor){l=h.dragSourceOperationMaskFor(this,j)
}else{l=SC.DRAG_ANY}if((l!==SC.DRAG_NONE)&&j&&j.computeDragOperations){l=l&j.computeDragOperations(this,d,l)
}else{l=SC.DRAG_NONE}this.allowedDragOperations=l;if(l===SC.DRAG_NONE){j=this._findNextDropTarget(j)
}}if(j!==g){if(g&&g.dragExited){g.dragExited(this,d)}if(j){if(j.dragEntered){j.dragEntered(this,d)
}if(j.dragUpdated){j.dragUpdated(this,d)}}this._lastTarget=j}else{if(j&&j.dragUpdated){j.dragUpdated(this,d)
}}if(h&&h.dragDidMove){h.dragDidMove(this,k)}if(!this._ghostViewHidden){this._positionGhostView(d)
}},mouseUp:function(s){var l={x:s.pageX,y:s.pageY},m=this._lastTarget,j=this.allowedDragOperations;
this.set("location",l);try{if(m&&m.acceptDragOperation&&m.acceptDragOperation(this,j)){j=m.performDragOperation?m.performDragOperation(this,j):SC.DRAG_NONE
}else{j=SC.DRAG_NONE}}catch(n){console.error("Exception in SC.Drag.mouseUp(acceptDragOperation|performDragOperation): %@".fmt(n))
}try{if(m&&m.dragExited){m.dragExited(this,s)}}catch(o){console.error("Exception in SC.Drag.mouseUp(target.dragExited): %@".fmt(o))
}var h=this._dropTargets();for(var p=0,k=h.length;p<k;p++){try{h[p].tryToPerform("dragEnded",this,s)
}catch(g){console.error("Exception in SC.Drag.mouseUp(dragEnded on %@): %@".fmt(h[p],g))
}}this._destroyGhostView();if(this.get("ghost")){if(this._dragViewWasVisible){this._getDragView().set("isVisible",YES)
}this._dragViewWasVisible=null}var d=this.source;if(d&&d.dragDidEnd){d.dragDidEnd(this,l,j)
}this._lastTarget=null;this._dragInProgress=NO},_getDragView:function(){if(!this.dragView){if(!this.source||!this.source.isView){throw"Source can't be used as dragView, because it's not a view."
}this.dragView=this.source}return this.dragView},_createGhostView:function(){var g=this,e=this._getDragView(),h=e.get("frame"),d;
d=this.ghostView=SC.Pane.create({classNames:["sc-ghost-view"],layout:{top:h.y,left:h.x,width:h.width,height:h.height},owner:this,didCreateLayer:function(){if(e){var j=e.get("layer");
if(j){j=j.cloneNode(true);j.style.top="0px";j.style.left="0px";this.get("layer").appendChild(j)
}}}});d.append()},_positionGhostView:function(d){var g=this.get("location");g.x-=this.ghostOffset.x;
g.y-=this.ghostOffset.y;var e=this.ghostView;if(e){e.adjust({top:g.y,left:g.x});e.invokeOnce("updateLayout")
}},_ghostViewHidden:NO,hideGhostView:function(){if(this.ghostView&&!this._ghostViewHidden){this.ghostView.remove();
this._ghostViewHidden=YES}},unhideGhostView:function(){if(this._ghostViewHidden){this._ghostViewHidden=NO;
this._createGhostView()}},_destroyGhostView:function(){if(this.ghostView){this.ghostView.remove();
this.ghostView=null;this._ghostViewHidden=NO}},_dropTargets:function(){if(this._cachedDropTargets){return this._cachedDropTargets
}var e=[];var h=SC.Drag._dropTargets;for(var g in h){if(h.hasOwnProperty(g)){e.push(h[g])
}}var k={};var j=SC.Drag._dropTargets;var d=function(l){if(!l){return 0}var n=SC.guidFor(l);
var m=k[n];if(!m){m=1;while(l=l.get("parentView")){if(j[SC.guidFor(l)]!==undefined){m++
}}k[n]=m}return m};e.sort(function(m,l){if(m===l){return 0}m=d(m);l=d(l);return(m>l)?-1:1
});this._cachedDropTargets=e;return e},_findDropTarget:function(g){var l={x:g.pageX,y:g.pageY};
var j,k;var h=this._dropTargets();for(var e=0,d=h.length;e<d;e++){j=h[e];if(!j.get("isVisibleInWindow")){continue
}k=j.convertFrameToView(j.get("clippingFrame"),null);if(SC.pointInRect(l,k)){return j
}}return null},_findNextDropTarget:function(d){var e=SC.Drag._dropTargets;while(d=d.get("parentView")){if(e[SC.guidFor(d)]){return d
}}return null},_autoscroll:function(p){if(!p){p=this._lastAutoscrollEvent}if(!this._dragInProgress){return NO
}var k=p?{x:p.pageX,y:p.pageY}:this.get("location"),l=this._findScrollableView(k),s=null,o,g,h,m,e,d,j;
while(l&&!s){o=l.get("canScrollVertical")?1:0;g=l.get("canScrollHorizontal")?1:0;
if(o||g){d=l.get("containerView");if(d){j=l.convertFrameToView(d.get("frame"),null)
}else{o=g=0}}if(o){m=SC.maxY(j);h=m-SC.DRAG_AUTOSCROLL_ZONE_THICKNESS;if(k.y>=h&&k.y<=m){o=1
}else{h=SC.minY(j);m=h+SC.DRAG_AUTOSCROLL_ZONE_THICKNESS;if(k.y>=h&&k.y<=m){o=-1}else{o=0
}}}if(g){m=SC.maxX(j);h=m-SC.DRAG_AUTOSCROLL_ZONE_THICKNESS;if(k.x>=h&&k.x<=m){g=1
}else{h=SC.minX(j);m=h+SC.DRAG_AUTOSCROLL_ZONE_THICKNESS;if(k.x>=h&&k.x<=m){g=-1}else{g=0
}}}if(o||g){s=l}else{l=this._findNextScrollableView(l)}}if(s&&(this._lastScrollableView===s)){if((Date.now()-this._hotzoneStartTime)>100){this._horizontalScrollAmount*=1.05;
this._verticalScrollAmount*=1.05}}else{this._lastScrollableView=s;this._horizontalScrollAmount=15;
this._verticalScrollAmount=15;this._hotzoneStartTime=(s)?Date.now():null;g=o=0}if(s&&(g||o)){var n={x:g*this._horizontalScrollAmount,y:o*this._verticalScrollAmount};
s.scrollBy(n)}if(s){if(p){this._lastAutoscrollEvent={pageX:p.pageX,pageY:p.pageY}
}this.invokeLater(this._autoscroll,100,null);return YES}else{this._lastAutoscrollEvent=null;
return NO}},_scrollableViews:function(){if(this._cachedScrollableView){return this._cachedScrollableView
}var d=[];var g=SC.Drag._scrollableViews;for(var e in g){if(g.hasOwnProperty(e)){d.push(g[e])
}}d=d.sort(function(k,h){var j=k;while(j=j.get("parentView")){if(h==j){return -1}}return 1
});this._cachedScrollableView=d;return d},_findScrollableView:function(k){var g=this._scrollableViews(),e=g?g.length:0,h,j,d;
for(d=0;d<e;d++){h=g[d];if(!h.get("isVisibleInWindow")){continue}j=h.convertFrameToView(h.get("clippingFrame"),null);
if(SC.pointInRect(k,j)){return h}}return null},_findNextScrollableView:function(d){var e=SC.Drag._scrollableViews;
while(d=d.get("parentView")){if(e[SC.guidFor(d)]){return d}}return null}});SC.Drag.mixin({start:function(e){var d=this.create(e);
d.startDrag();return d},_dropTargets:{},_scrollableViews:{},addDropTarget:function(d){this._dropTargets[SC.guidFor(d)]=d
},removeDropTarget:function(d){delete this._dropTargets[SC.guidFor(d)]},addScrollableView:function(d){this._scrollableViews[SC.guidFor(d)]=d
},removeScrollableView:function(d){delete this._scrollableViews[SC.guidFor(d)]}});
SC.MODIFIED_KEY_BINDINGS={"ctrl_.":"cancel",shift_tab:"insertBacktab",shift_left:"moveLeftAndModifySelection",shift_right:"moveRightAndModifySelection",shift_up:"moveUpAndModifySelection",shift_down:"moveDownAndModifySelection",alt_left:"moveLeftAndModifySelection",alt_right:"moveRightAndModifySelection",alt_up:"moveUpAndModifySelection",alt_down:"moveDownAndModifySelection",ctrl_a:"selectAll"};
SC.BASE_KEY_BINDINGS={escape:"cancel",backspace:"deleteBackward","delete":"deleteForward","return":"insertNewline",tab:"insertTab",left:"moveLeft",right:"moveRight",up:"moveUp",down:"moveDown",home:"moveToBeginningOfDocument",end:"moveToEndOfDocument",pagedown:"pageDown",pageup:"pageUp"};
require("core");SC.UndoManager=SC.Object.extend({undoActionName:function(){return this.undoStack?this.undoStack.name:null
}.property("undoStack"),redoActionName:function(){return this.redoStack?this.redoStack.name:null
}.property("redoStack"),canUndo:function(){return this.undoStack!=null}.property("undoStack"),canRedo:function(){return this.redoStack!=null
}.property("redoStack"),undo:function(){this._undoOrRedo("undoStack","isUndoing")
},redo:function(){this._undoOrRedo("redoStack","isRedoing")},isUndoing:false,isRedoing:false,groupingLevel:0,registerUndo:function(e,d){this.beginUndoGroup(d);
this._activeGroup.actions.push(e);this.endUndoGroup(d)},beginUndoGroup:function(e){if(this._activeGroup){this.groupingLevel++
}else{var d=this.isUndoing?"redoStack":"undoStack";this._activeGroup={name:e,actions:[],prev:this.get(d)};
this.set(d,this._activeGroup);this.groupingLevel=1}},endUndoGroup:function(d){if(!this._activeGroup){raise("endUndoGroup() called outside group.")
}if(this.groupingLevel>1){this.groupingLevel--}else{this._activeGroup=null;this.groupingLevel=0
}this.propertyDidChange(this.isUndoing?"redoStack":"undoStack")},setActionName:function(d){if(!this._activeGroup){raise("setActionName() called outside group.")
}this._activeGroup.name=d},_activeGroup:null,undoStack:null,redoStack:null,_undoOrRedo:function(d,g){if(this._activeGroup){return false
}if(this.get(d)==null){return true}this.set(g,true);var j=this.get(d);this.set(d,j.prev);
var e;var h=j.actions.length>1;if(h){this.beginUndoGroup(j.name)}while(e=j.actions.pop()){e()
}if(h){this.endUndoGroup(j.name)}this.set(g,false)}});var sprocket,nullSprocket,d1,d2;
module("SC.DateTime transform",{setup:function(){d1=SC.DateTime.create({year:2009,month:3,day:1,hour:20,minute:30,timezone:480});
d2=SC.DateTime.create({year:2009,month:3,day:1,hour:20,minute:30,timezone:SC.DateTime.timezone});
var d=SC.Object.create({store:SC.Store.create()});d.Sprocket=SC.Record.extend({createdAt:SC.Record.attr(SC.DateTime),frenchCreatedAt:SC.Record.attr(SC.DateTime,{format:"%d/%m/%Y %H:%M:%S"})});
SC.RunLoop.begin();d.store.loadRecords(d.Sprocket,[{guid:"1",createdAt:"2009-03-01T20:30:00-08:00",frenchCreatedAt:"01/03/2009 20:30:00"},{guid:"2",createdAt:null,frenchCreatedAt:null}]);
SC.RunLoop.end();sprocket=d.store.find(d.Sprocket,"1");nullSprocket=d.store.find(d.Sprocket,"2")
}});test("reading a DateTime should successfully parse the underlying string value",function(){equals(sprocket.get("createdAt"),d1,"reading a DateTime should return the correct SC.DateTime object");
equals(sprocket.get("frenchCreatedAt"),d2,"reading a DateTime with a custom format should return the correct SC.DateTime object")
});test("writing a DateTime should successfully format the value into a string",function(){d1=d1.advance({year:1,hour:2,minute:28});
d2=d2.advance({month:-2,minute:16});sprocket.set("createdAt",d1);sprocket.set("frenchCreatedAt",d2);
equals(sprocket.readAttribute("createdAt"),"2010-03-01T22:58:00-08:00","writing a DateTime should successfully format the value into the a string");
equals(sprocket.readAttribute("frenchCreatedAt"),"01/01/2009 20:46:00","writing a DateTime with a custom format should successfully format the value into the a string")
});test("reading or writing null values should work",function(){sprocket.set("createdAt",null);
equals(sprocket.readAttribute("createdAt"),null);equals(nullSprocket.get("createdAt"),null)
});module("A dialog with some basic controls and buttons");var pane;test("adding dialog to screen",function(){var d=SC.Object.create({couldNotSend:function(){pane=SC.AlertPane.warn("Email could not be sent","There might be a problem with the server or with your internet connection.  Try again in a few minutes.","Try Again","Cancel","Report Problem...",this)
},showMoreInfo:function(){pane=SC.AlertPane.info("Sending Email","Sometimes email doesn't make it.  It's a fact of life.  We all love email, but hey that's how it goes.  \nAnyway, the nice thing is that we can provide this helpful dialog message, with multiple paragraphs and everything because of SproutCore.\nEmail is OK, AlertPanes are great. So just deal m'kay?  Bye bye.",d)
},alertPaneDidDismiss:function(g,e){switch(e){case SC.OK_STATUS:this.invokeLater(this.couldNotSend,1000);
break;case SC.EXTRA_STATUS:this.showMoreInfo();break}}});SC.RunLoop.begin();d.couldNotSend();
SC.RunLoop.end()});var pane;module("SC.Border",{setup:function(){SC.RunLoop.begin();
pane=SC.MainPane.create();pane.append();SC.RunLoop.end()},teardown:function(){pane.remove();
pane=null}});var boxstyles="<style>.box1-border { border-top: 10px solid red; border-left: 25px solid red; border-right: 109px solid green; border-bottom: 79px solid red; }.box2-border { border-top: 10px solid red; border-left: 25px solid red; border-right: 109px solid green; border-bottom: 79px solid red; }.box3-border { border-top: 10px solid red; border-left: 25px solid red; border-right: 109px solid green; border-bottom: 79px solid red; }</style>";
htmlbody(boxstyles);test("SC.View should not have border properties by default",function(){var d=SC.View.create();
ok(!d.get("hasBorder"),"view should not have hasBorder set");ok(d.get("borderStyle")===undefined,"view should not have borderStyle set")
});test("Views with SC.Border mixin should default to gray border",function(){var d=SC.View.create(SC.Border,{});
equals(d.get("borderStyle"),SC.BORDER_GRAY,"borderStyle should be SC.BORDER_GRAY");
equals(d.get("borderTop"),1,"borderTop should be 1");equals(d.get("borderBottom"),1,"borderBottom should be 1");
equals(d.get("borderRight"),1,"borderRight should be 1");equals(d.get("borderLeft"),1,"borderLeft should be 1")
});test("Views that specify a non-built-in border should have border dimensions set to 0",function(){var d=SC.View.create(SC.Border,{borderStyle:"fat-and-chunky"});
equals(d.get("borderTop"),0,"borderTop should be 0");equals(d.get("borderBottom"),0,"borderBottom should be 0");
equals(d.get("borderRight"),0,"borderRight should be 0");equals(d.get("borderLeft"),0,"borderLeft should be 0")
});test('Views that specify a string that ends in "-border" should have that string added as a class',function(){var d=SC.View.create(SC.Border,{borderStyle:"fat-and-chunky-border"});
pane.appendChild(d);SC.RunLoop.begin().end();ok(d.$().hasClass("fat-and-chunky-border"),"should have fat-and-chunky-border class")
});test('Views that specify a string that does not end in "-border" should not have that string added as a class',function(){var d=SC.View.create(SC.Border,{borderStyle:"border-at-beginning"});
pane.appendChild(d);SC.RunLoop.begin().end();ok(!d.$().hasClass("border-at-beginning"),"should not have border-at-beginning class")
});test("Views should rerender if borderStyle changes",function(){var d=SC.View.create(SC.Border,{borderStyle:"first-border"});
pane.appendChild(d);SC.RunLoop.begin().end();ok(d.$().hasClass("first-border"),"precond - view should have first-border class");
d.set("borderStyle","second-border");SC.RunLoop.begin().end();ok(d.$().hasClass("second-border"),"view should have second-border class")
});test("View frame should account for borders if border dimension properties are set",function(){var g=SC.View.create(SC.Border,{borderStyle:"box1-border",borderTop:10,borderLeft:25,borderRight:109,borderBottom:79}),e=SC.View.create(SC.Border,{borderStyle:"box2-border",borderTop:10,borderLeft:25,borderRight:109,borderBottom:79}),d=SC.View.create(SC.Border,{borderStyle:"box3-border",borderTop:10,borderLeft:25,borderRight:109,borderBottom:79});
g.appendChild(e);e.appendChild(d);pane.appendChild(g);SC.RunLoop.begin().end();var j=d.get("frame"),h=d.get("layer");
equals(j.x,h.clientLeft,"horizontal positions equal");equals(j.y,h.clientTop,"vertical positions equal");
equals(j.width,h.clientWidth,"width equal");equals(j.height,h.clientHeight,"height equal")
});module("TODO: Test SC.AlertPane Methods");module("SC.AlertPane UI");var pane;function evaluatePane(e,p,m,n,d,g,o,l){ok(e.get("isVisibleInWindow"),"pane.isVisibleInWindow should be YES");
ok(e.$().hasClass("sc-alert"),"pane should have sc-alert class");ok(e.childViews[0].get("isVisibleInWindow"),"pane.div.isVisibleInWindow should be YES");
ok(e.childViews[0].$().hasClass("sc-view"),"pane.div should have sc-view class");
ok(e.childViews[0].childViews[0].get("isVisibleInWindow"),"pane.div.info.isVisibleInWindow should be YES");
ok(e.childViews[0].childViews[0].$().hasClass("info"),"pane.div.info should have info class");
ok(e.childViews[0].childViews[1].get("isVisibleInWindow"),"pane.div.div.isVisibleInWindow should be YES");
ok(e.childViews[0].childViews[0].$("img"),"pane.div.info.img existance should be YES");
ok(e.childViews[0].childViews[0].$("img").hasClass("icon"),"pane.div.info.img should have icon class");
ok(e.childViews[0].childViews[0].$("img").hasClass(l),"pane.div.info.img should have %@ class".fmt(l));
ok(e.childViews[0].childViews[0].$("h1"),"pane.div.info.h1 existance should be YES");
equals(e.childViews[0].childViews[0].$("h1").text(),"AlertPane.message","pane.div.info.h1 should have title");
if(m){ok(e.childViews[0].childViews[0].$("p.description"),"pane.div.info.description existance should be YES");
equals(e.childViews[0].childViews[0].$("p.description").text(),"AlertPane.description","pane.div.info.description should have description")
}else{equals(e.childViews[0].childViews[0].$("p.description").length,0,"pane.div.info should have 0 description")
}if(n){ok(e.childViews[0].childViews[0].$("p.caption"),"pane.div.info.caption existance should be YES");
equals(e.childViews[0].childViews[0].$("p.caption").text(),"AlertPane.caption","pane.div.info.caption should have caption")
}else{equals(e.childViews[0].childViews[0].$("p.caption").length,0,"pane.div.info should have 0 caption")
}ok(e.childViews[0].childViews[1].$("div"),"pane.div.div.div existance should be YES");
equals(e.childViews[0].childViews[1].$("div").length,2,"pane.div.div should have 2 Buttons");
ok(e.childViews[0].$("div"),"pane.div.div existance should be YES");var k=e.childViews[0].childViews[1].childViews[1];
var j=e.childViews[0].childViews[1].childViews[0];var h=e.childViews[0].childViews[2].childViews[0];
if(d){equals(k.$("span").text(),d,"pane.div.div button1 should have custom title %@".fmt(d))
}else{equals(k.$("span").text(),"OK","pane.div.div button1 should have default title OK")
}if(g){equals(j.$("span").text(),g,"pane.div.div button2 should have custom title %@".fmt(g))
}else{ok(j.$().hasClass("hidden"),"pane.div.div button2 should be hidden")}if(o){equals(h.$("span").text(),o,"pane.div button3 should have custom title %@".fmt(o))
}else{ok(h.$().hasClass("hidden"),"pane.div button3 should be hidden")}}test("AlertPane.show with icon, message, description, caption and 3 buttons",function(){pane=SC.AlertPane.show("AlertPane.message","AlertPane.description","AlertPane.caption","okButtonTitle","cancelButtonTitle","extraButtonTitle","sc-icon-tools-24",this);
evaluatePane(pane,"AlertPane.message","AlertPane.description","AlertPane.caption","okButtonTitle","cancelButtonTitle","extraButtonTitle","sc-icon-tools-24");
pane.dismiss()});test("AlertPane.warn with icon, message, description, caption and 3 buttons",function(){pane=SC.AlertPane.warn("AlertPane.message","AlertPane.description","AlertPane.caption","okButtonTitle","cancelButtonTitle","extraButtonTitle",this);
evaluatePane(pane,"AlertPane.message","AlertPane.description","AlertPane.caption","okButtonTitle","cancelButtonTitle","extraButtonTitle","sc-icon-alert-48");
pane.dismiss()});test("AlertPane.error with icon, message, description, caption and 3 buttons",function(){pane=SC.AlertPane.error("AlertPane.message","AlertPane.description","AlertPane.caption","okButtonTitle","cancelButtonTitle","extraButtonTitle",this);
evaluatePane(pane,"AlertPane.message","AlertPane.description","AlertPane.caption","okButtonTitle","cancelButtonTitle","extraButtonTitle","sc-icon-error-48");
pane.dismiss()});test("AlertPane.plain with message, description, caption and 3 buttons",function(){pane=SC.AlertPane.plain("AlertPane.message","AlertPane.description","AlertPane.caption","okButtonTitle","cancelButtonTitle","extraButtonTitle",this);
evaluatePane(pane,"AlertPane.message","AlertPane.description","AlertPane.caption","okButtonTitle","cancelButtonTitle","extraButtonTitle","blank");
pane.dismiss()});test("AlertPane.info with icon, message, description, caption and 3 buttons",function(){pane=SC.AlertPane.info("AlertPane.message","AlertPane.description","AlertPane.caption","okButtonTitle","cancelButtonTitle","extraButtonTitle",this);
evaluatePane(pane,"AlertPane.message","AlertPane.description","AlertPane.caption","okButtonTitle","cancelButtonTitle","extraButtonTitle","sc-icon-info-48");
pane.dismiss()});test("AlertPane.info with icon, message and 1 default button (omit all optional parameters)",function(){pane=SC.AlertPane.info("AlertPane.message");
evaluatePane(pane,"AlertPane.message",null,null,null,null,null,"sc-icon-info-48");
pane.dismiss()});test("AlertPane.info with icon, message and 3 buttons (passing null to optional description and caption)",function(){pane=SC.AlertPane.info("AlertPane.message",null,null,"okButtonTitle","cancelButtonTitle","extraButtonTitle",this);
evaluatePane(pane,"AlertPane.message",null,null,"okButtonTitle","cancelButtonTitle","extraButtonTitle","sc-icon-info-48");
pane.dismiss()});test("AlertPane.info with icon, message, description, caption and 1 button (passing null to 3 buttons)",function(){pane=SC.AlertPane.info("AlertPane.message","AlertPane.description","AlertPane.caption",null,null,null,this);
evaluatePane(pane,"AlertPane.message","AlertPane.description","AlertPane.caption",null,null,null,"sc-icon-info-48");
pane.dismiss()});test("users interaction with mutiple alert panes with 1-3 buttons",function(){var d=SC.Object.create({threeButtonAlertPane:function(){pane=SC.AlertPane.warn("AlertPane.warn title","Click OK to see this alert pane again.  \nClick Other... to see other alert panes.","Click cancel to dismiss.","OK","Cancel","Other...",this)
},twoButtonAlertPane:function(){pane=SC.AlertPane.error("AlertPane.error title","Click OK to see one button alert pane.","Click cancel to dismiss.","OK","Cancel",d)
},oneButtonAlertPane:function(){pane=SC.AlertPane.info("AlertPane.info title","Click OK to dismiss.",d)
},alertPaneDidDismiss:function(g,e){switch(e){case SC.BUTTON1_STATUS:if(g.icon&&g.icon.indexOf("alert")!=-1){this.invokeLater(this.threeButtonAlertPane,1000)
}if(g.icon&&g.icon.indexOf("error")!=-1){this.oneButtonAlertPane()}break;case SC.BUTTON3_STATUS:this.twoButtonAlertPane();
break}}});SC.RunLoop.begin();d.threeButtonAlertPane();SC.RunLoop.end()});var items=[{title:"Menu Item",keyEquivalent:"ctrl_shift_n"},{title:"Checked Menu Item",isChecked:YES,keyEquivalent:"ctrl_a"},{title:"Selected Menu Item",keyEquivalent:"backspace"},{separator:YES},{title:"Menu Item with Icon",icon:"inbox",keyEquivalent:"ctrl_m"},{title:"Menu Item with Icon",icon:"folder",keyEquivalent:"ctrl_p"},{separator:YES},{title:"Selected Menu Item…",isChecked:YES,keyEquivalent:"ctrl_shift_o"},{title:"Item with Submenu",subMenu:[{title:"Submenu item 1"},{title:"Submenu item 2"}]},{title:"Disabled Menu Item",isEnabled:NO}];
var menu,anchor;module("SC.MenuPane Methods",{setup:function(){menu=SC.MenuPane.create({layout:{width:206},items:items,displayItemsCount:0,displayItemsDidChange:function(){this.displayItemsCount++
}.observes("displayItems")});anchor=SC.Pane.create({layout:{top:15,left:15,width:100,height:100}})
},teardown:function(){menu.remove();anchor.remove();menu.destroy();menu=null}});test("popup() without anchor",function(){var d;
menu.popup();d=menu.get("layout");equals(d.centerX,0,"menu should be horizontally centered");
equals(d.centerY,0,"menu should be vertically centered");equals(d.width,206,"menu should maintain the width specified");
equals(d.height,184,"menu height should resize based on item content");menu.remove()
});test("popup() with anchor",function(){var d;anchor.append();menu.popup(anchor);
d=menu.get("layout");equals(d.left,16,"menu should be aligned to the left of the anchor");
equals(d.top,119,"menu should be positioned below the anchor");equals(d.width,206,"menu should maintain the width specified");
equals(d.height,184,"menu height should resize based on item content");menu.remove()
});test("displayItems",function(){var d=["Alpha","Beta","Gaga"],e,h;menu.menuHeight=1;
menu.set("items",d);equals(1,menu.displayItemsCount,"displayItems should change when items array changes");
ok(menu.get("menuHeight")>1,"menuHeight should be recalculated when displayItems changes");
e=menu.get("displayItems")[0];equals(SC.typeOf(e),SC.T_OBJECT,"strings should be transformed into objects");
equals(e.title,"Alpha","title property of transformed object should match original string");
equals(e.value,"Alpha","value property of transformed object should match original string");
equals(e.isEnabled,YES,"isEnabled property of transformed object should be YES");
var g=[{title:"Yankee"},{title:"Hotel"},{title:"Foxtrot"}];menu.set("items",g);e=menu.get("displayItems")[0];
equals(SC.typeOf(e),SC.T_OBJECT,"displayItems should convert hashes to objects");
equals(e.get("title"),"Yankee","object properties should correspond to hash properties");
var j=[SC.Object.create({title:"Whiskey"}),SC.Object.create({title:"Mystics"}),SC.Object.create({title:"Men"})];
menu.set("items",j);e=menu.get("displayItems")[0];equals(SC.typeOf(e),SC.T_OBJECT,"displayItems should not convert objects");
equals(SC.guidFor(e),SC.guidFor(j[0]),"objects should be identical to provided objects")
});test("displayItems - Edge Cases",function(){menu.set("items",[null,null,false,0,"Real Item"]);
var d=menu.get("displayItems");equals(d.get("length"),1,"displayItems should strip out invalid items");
menu.set("items",["Yellow",{title:"Country"},SC.Object.create({title:"Teeth"})]);
d=menu.get("displayItems");ok(d[0].title==="Yellow"&&d[1].title==="Country"&&d[2].title==="Teeth","displayItems should accept a mix of supported item types");
menu.set("items",[]);equals(menu.getPath("displayItems.length"),0,"displayItems should be empty if items is empty");
menu.set("items",null);equals(menu.get("displayItems"),null,"displayItems should be null if items is null")
});test("menuItemViewForContentIndex",function(){menu.popup();var d=menu.menuItemViewForContentIndex(0);
equals(items[0].title,d.$(".value").text(),"menu item views should match content items")
});var items=[{title:"Menu Item",keyEquivalent:"ctrl_shift_n"},{title:"Checked Menu Item",isChecked:YES,keyEquivalent:"ctrl_a"},{title:"Selected Menu Item",keyEquivalent:"backspace"},{separator:YES},{title:"Menu Item with Icon",icon:"inbox",keyEquivalent:"ctrl_m"},{title:"Menu Item with Icon",icon:"folder",keyEquivalent:"ctrl_p"},{separator:YES},{title:"Selected Menu Item…",isChecked:YES,keyEquivalent:"ctrl_shift_o"},{title:"Item with Submenu",subMenu:[{title:"Submenu item 1"},{title:"Submenu item 2"}]},{title:"Disabled Menu Item",isEnabled:NO}];
var menu;module("SC.MenuPane UI",{setup:function(){menu=SC.MenuPane.create({layout:{width:206},selectedItemChanged:function(){this._selectedItemCount=(this._selectedItemCount||0)+1
}.observes("selectedItem"),countAction:function(){this._actionCount=(this._actionCount||0)+1
}});items[0].target=menu;items[0].action="countAction";items[1].action=function(){menu._functionActionCount=(menu._functionActionCount||0)+1
};menu.set("items",items)},teardown:function(){menu.destroy();menu=null}});function clickOn(d,h,m){var g=d.get("layer"),k={shiftKey:h,ctrlKey:m},l,j,e;
ok(g,"precond - view %@ should have layer".fmt(d.toString()));j=SC.Event.simulateEvent(g,"mousedown",k);
SC.Event.trigger(g,"mousedown",[j]);j=SC.Event.simulateEvent(g,"mouseup",k);SC.Event.trigger(g,"mouseup",[j]);
SC.RunLoop.begin();SC.RunLoop.end();g=null}test("Basic UI",function(){menu.popup();
ok(menu.$().hasClass("sc-menu"),'pane should have "sc-menu" class');ok(menu.$().hasClass("sc-regular-size"),"pane should have default control size class");
ok(!menu.get("isSubMenu"),"isSubMenu should be NO on menus that are not submenus");
var d=menu.get("menuItemViews")[0],e;d.mouseEntered();clickOn(d,NO,NO);stop();setTimeout(function(){e=menu.get("selectedItem");
ok(e,"menu should have selectedItem property set after clicking on menu item");equals(e.title,d.get("content").title,"selectedItem should be set to the content item that was clicked");
equals(1,menu._selectedItemCount,"selectedItem should only change once when a menu item is clicked");
equals(1,menu._actionCount,"action is fired once when menu item is clicked");menu.remove();
ok(!menu.get("isVisibleInWindow"),"menu should not be visible after being removed");
equals(menu.get("currentMenuItem"),null,"currentMenuItem should be null after being removed");
start()},250)});test("Control size",function(){var d,h,e,g=[{title:"Can I get get get"},{title:"To know know know know",separator:YES},{title:"Ya better better baby"}];
d=SC.MenuPane.create({controlSize:SC.SMALL_CONTROL_SIZE,items:g});d.popup();e=d.get("menuItemViews");
equals(e[0].get("frame").height,SC.MenuPane.SMALL_MENU_ITEM_HEIGHT,"should change itemHeight");
equals(e[1].get("frame").height,SC.MenuPane.SMALL_MENU_ITEM_SEPARATOR_HEIGHT,"should change itemSeparatorHeight");
equals(e[0].get("frame").y,SC.MenuPane.SMALL_MENU_HEIGHT_PADDING/2,"should change menuHeightPadding");
d.remove();h=SC.MenuPane.create({controlSize:SC.LARGE_CONTROL_SIZE,items:g});h.popup();
e=h.get("menuItemViews");equals(e[0].get("frame").height,SC.MenuPane.LARGE_MENU_ITEM_HEIGHT,"should change itemHeight");
equals(e[1].get("frame").height,SC.MenuPane.LARGE_MENU_ITEM_SEPARATOR_HEIGHT,"should change itemSeparatorHeight");
equals(e[0].get("frame").y,SC.MenuPane.LARGE_MENU_HEIGHT_PADDING/2,"should change menuHeightPadding");
h.remove()});test("Legacy Function Support",function(){menu.popup();var d=menu.get("menuItemViews")[1],e;
d.mouseEntered();clickOn(d,NO,NO);stop();setTimeout(function(){e=menu.get("selectedItem");
equals(1,menu._functionActionCount,"Function should be called if it is set as the action and the menu item is clicked");
menu.remove();start()},250)});test("Custom MenuItemView Class",function(){equals(menu.get("exampleView"),SC.MenuItemView,"SC.MenuPane should generate SC.MenuItemViews by default");
var d=SC.MenuPane.create({exampleView:SC.MenuItemView.extend({classNames:"custom-menu-item".w()}),items:items});
d.popup();ok(d.$(".custom-menu-item").length>0,"SC.MenuPane should generate instances of custom classes if exampleView is changed");
d.remove()});test("Basic Submenus",function(){var g=SC.MenuPane.create({controlSize:SC.SMALL_CONTROL_SIZE,items:items});
var e=g.get("menuItemViews")[8],d;g.popup();e.mouseEntered();SC.RunLoop.begin().end();
ok(e.get("hasSubMenu"),"precond - menu item has a submenu");d=e.get("subMenu");ok(!d.get("isVisibleInWindow"),"submenus should not open immediately");
stop();setTimeout(function(){ok(d.get("isVisibleInWindow"),"submenu should open after 100ms delay");
ok(d.get("isSubMenu"),"isSubMenu should be YES on submenus");ok(d.get("controlSize"),SC.SMALL_CONTROL_SIZE,"submenu should inherit parent's controlSize");
g.remove();ok(!d.get("isVisibleInWindow"),"submenus should close if their parent menu is closed");
start()},150)});test("Menu Item Localization",function(){ok(menu.get("localize"),"menu panes should be localized by default");
var e,d;SC.stringsFor("en",{"Localized.Text":"LOCALIZED TEXT"});d=["Localized.Text"];
e=SC.MenuPane.create({layout:{width:200},items:d,localize:NO});e.popup();equals("Localized.Text",e.$(".sc-menu-item .value").text(),"Menu item titles should not be localized if localize is NO");
e.remove();e=SC.MenuPane.create({items:d,localize:YES});e.popup();equals("LOCALIZED TEXT",e.$(".sc-menu-item .value").text(),"Menu item titles should be localized if localize is YES");
e.remove()});test("Automatic Closing",function(){menu.popup();ok(menu.get("isVisibleInWindow"),"precond - window should be visible");
menu.windowSizeDidChange();ok(!menu.get("isVisibleInWindow"),"menu should close if window resizes");
menu.popup();clickOn(menu);ok(!menu.get("isVisibleInWindow"),"menu should close if anywhere other than a menu item is clicked")
});module("TODO: Test SC.PalettePane Methods");module("SC.PalettePane UI");var pane;
test("verify palette pane content container is visible at correct location with right size",function(){pane=SC.PalettePane.create({layout:{width:400,height:200,right:20,top:0},contentView:SC.View.extend({})});
pane.append();ok(pane.get("isVisibleInWindow"),"pane.isVisibleInWindow should be YES");
ok(pane.$().hasClass("sc-palette"),"pane should have sc-palette class");ok(pane.childViews[0].get("isVisibleInWindow"),"pane.div.isVisibleInWindow should be YES");
ok(pane.childViews[0].$().hasClass("sc-view"),"pane.div should have sc-view class");
var d=pane.layoutStyle();equals(d.top,"0px","pane should be initiated at default position top including shadow");
equals(d.right,"20px","pane should be initiated at default position right including shadow");
equals(d.width,"400px","pane should have width 400px");equals(d.height,"200px","pane should have height 200px")
});module("SC.Pane-SC.Page");test("isVisible changes should update views that are instantiated in a page",function(){var g=SC.Page.design({inspector:SC.PickerPane.design({layout:{width:300,height:300,centerX:0},contentView:SC.View.extend({layout:{top:0,left:0,bottom:0,right:0},childViews:"labelView".w(),labelView:SC.LabelView.extend({layout:{centerY:-10,height:24,left:0,right:0},value:"PrefPane"})})})});
var d=g.get("inspector");d.append();SC.RunLoop.begin().end();d.remove();SC.RunLoop.begin().end();
d.childViews[0].childViews[0].set("isVisible",NO);SC.RunLoop.begin().end();d.append();
SC.RunLoop.begin().end();var e=d.childViews[0].childViews[0].$().hasClass("hidden");
ok(e,"The view (isVisible) has been properly rerendered even though it was part of a page, the pane was detached and the visibility was changed while detached")
});module("TODO: Test SC.PanelPane Methods");module("SC.PanelPane UI");var pane;test("verify panel content container is visible at correct location with right size",function(){pane=SC.PanelPane.create({layout:{width:400,height:200,centerX:0,centerY:0},contentView:SC.View.extend({})});
pane.append();ok(pane.get("isVisibleInWindow"),"pane.isVisibleInWindow should be YES");
ok(pane.$().hasClass("sc-panel"),"pane should have sc-panel class");ok(pane.childViews[0].get("isVisibleInWindow"),"pane.div.isVisibleInWindow should be YES");
ok(pane.childViews[0].$().hasClass("sc-view"),"pane.div should have sc-view class");
var e=pane.layout.width;var g=pane.layout.height;var d=pane.layoutStyle();equals(d.top,"50%","pane should center vertically");
equals(d.left,"50%","pane should center horizontally");equals(d.width,"400px","pane should have width 400px");
equals(d.height,"200px","pane should have height 200px");equals(d.marginLeft,-e/2+"px","pane should shift-left %@ px".fmt(-e/2));
equals(d.marginTop,-g/2+"px","pane should shift-top %@ px".fmt(-g/2));pane.remove()
});module("TODO: Test SC.PickerPane Methods");module("SC.PickerPane UI");htmlbody("<style> .sc-static-layout { border: 1px red dotted; } </style>");
function evaluatePicker(e){ok(e.get("isVisibleInWindow"),"pane.isVisibleInWindow should be YES");
ok(e.$().hasClass("sc-picker"),"pane should have sc-picker class");ok(e.childViews[0].get("isVisibleInWindow"),"pane.div.isVisibleInWindow should be YES");
ok(e.childViews[0].$().hasClass("sc-view"),"pane.div should have sc-view class");
equals(e.$(".sc-view").length,1,"pane should have only one content view");var d=e.layoutStyle();
equals(d.width,"300px","pane should have width 300px");equals(d.height,"200px","pane should have height 200px")
}var anchor=SC.ControlTestPane.design().add("anchor",SC.ButtonView,{title:"Anchor Button"});
anchor.show();var paneDefault;var paneMenu;var paneFixed;var panePointer;test("verify default picker pane content container is visible at correct location with right size",function(){paneDefault=SC.PickerPane.create({layout:{width:300,height:200},contentView:SC.View.extend({layout:{top:0,left:0,bottom:0,right:0}})});
paneDefault.popup(anchor.view("anchor"),SC.PICKER);evaluatePicker(paneDefault)});
test("verify menu picker pane content container is visible at correct location with right size",function(){paneMenu=SC.PickerPane.create({layout:{width:300,height:200},contentView:SC.View.extend({layout:{top:0,left:0,bottom:0,right:0}})});
paneMenu.popup(anchor.view("anchor"),SC.PICKER_MENU);evaluatePicker(paneMenu)});test("verify fixed picker pane content container is visible at correct location with right size",function(){paneFixed=SC.PickerPane.create({layout:{width:300,height:200},contentView:SC.View.extend({layout:{top:0,left:0,bottom:0,right:0}})});
paneFixed.popup(anchor.view("anchor"),SC.PICKER_FIXED);evaluatePicker(paneFixed)});
test("verify pointer picker pane content container is visible at correct location with right size",function(){panePointer=SC.PickerPane.create({layout:{width:300,height:200},contentView:SC.View.extend({layout:{top:0,left:0,bottom:0,right:0}})});
panePointer.popup(anchor.view("anchor"),SC.PICKER_POINTER,[3,0,1,2,2]);evaluatePicker(panePointer)
});var pane,view,view1,view2,view3,view4;module("SC.SelectButtonView",{setup:function(){SC.RunLoop.begin();
var d=NO;pane=SC.MainPane.create({objs:["Around","The","World"],objs2:[{title:"Around",pos:3},{title:"The",pos:1},{title:"World",pos:2},{title:"Again",pos:4}],selectedValue:"World",isDue:YES,childViews:[SC.SelectButtonView.extend({objects:["To","Back","You"],disableSort:NO}),SC.SelectButtonView.extend({objects:["Drop","Down","Menu"]}),SC.SelectButtonView.extend({objectsBinding:"*owner.objs",valueBinding:"*owner.selectedValue",isVisibleBinding:"*owner.isDue"}),SC.SelectButtonView.extend({objectsBinding:"*owner.objs2",valueBinding:"*owner.selectedValue",valueKey:"title",nameKey:"title",sortKey:"pos"}),SC.SelectButtonView.extend({objects:["My","New","List"]}),SC.SelectButtonView.extend({objects:["My","New","List"],customViewClassName:"custom-menu-item",customViewMenuOffsetWidth:46})]});
view1=pane.childViews[0];view2=pane.childViews[1];view3=pane.childViews[2];view4=pane.childViews[3];
view5=pane.childViews[4];view6=pane.childViews[5];pane.append();SC.RunLoop.end()},teardown:function(){pane.remove();
pane=view=null}});test("Check if objectBinding works",function(){var d=view3.objects;
equals("Around",d.get(0),"First item should be");equals("The",d.get(1),"Second item should be");
equals("World",d.get(2),"Last item should be")});test("Check if valueBinding works",function(){equals("World",view4.get("value"),"Value should be")
});test("Check if isVisibleBinding works",function(){var d=pane.isDue;SC.RunLoop.begin();
pane.set("isDue",NO);SC.RunLoop.end();ok(!view3.get("isVisibleInWindow"),"view2.isVisibleInWindow should be NO")
});test("SelectButton with objects",function(){equals(3,view1.objects.length,"The number of options in selectButton Menu should be");
equals(null,view1.nameKey,"the selectButton should not have any name key");equals(null,view1.valueKey,"the selectButton should not have any value key")
});test("sortObjects() sorts the items of the Drop Down component",function(){var d=view1.objects;
view1.objects=view1.sortObjects(d);equals("Back",d.get(0),"First item should be");
equals("To",d.get(1),"Second item should be");equals("You",d.get(2),"Third item should be")
});test("rebuildMenu() populates the Drop Down Menu with new data",function(){var d=["Rebuild","Drop","Down","Menu"];
view2.objects=d;var e=view2.objects;equals("Rebuild",e.get(0),"First item should be");
equals("Drop",e.get(1),"Second item should be");equals("Down",e.get(2),"Third item should be");
equals("Menu",e.get(3),"Fourth item should be")});test("isEnabled=NO should add disabled class",function(){SC.RunLoop.begin();
view1.set("isEnabled",NO);SC.RunLoop.end();ok(view1.$().hasClass("disabled"),"should have disabled class")
});test("objects should change on changing the binding",function(){SC.RunLoop.begin();
var d=["Bound","Objects"];pane.set("objs",d);SC.RunLoop.end();var e=view3.objects;
d=pane.objs;ok(e===d,"Objects should be bound")});test("Check if setting a value actually changes the selection value",function(){SC.RunLoop.begin();
view2.set("value","Menu");SC.RunLoop.end();equals(view2.get("value"),"Menu","value of Drop down should change to")
});test("objects should change on changing the binding",function(){SC.RunLoop.begin();
var d=["Bound","Objects"];pane.set("objs",d);SC.RunLoop.end();var e=view3.objects;
d=pane.objs;ok(e===d,"Objects should be bound")});test("The properties for select button should take default values unless specified",function(){var e=view5.get("customViewClassName");
var d=view5.get("customViewMenuOffsetWidth");equals(e,null,"Custom view class name should be null");
equals(d,0,"Custom view menu off set width should be 0")});test("The properties for select button should take the specified values",function(){var e=view6.get("customViewClassName");
var d=view6.get("customViewMenuOffsetWidth");equals(e,"custom-menu-item","Custom view class name should be custom-menu-item");
equals(d,46,"Custom view menu off set width should be 46")});htmlbody("<style> .sc-static-layout { border: 1px red dotted; } </style>");
var pane=SC.ControlTestPane.design().add("Basic",SC.SelectButtonView,{objects:["None","Low","Medium","High"]}).add("Disabled",SC.SelectButtonView,{isEnabled:NO,objects:["None","Low","Medium","High"]}).add("NotVisible",SC.SelectButtonView,{isVisible:NO,objects:["None","Low","Medium","High"]}).add("SortedObjects",SC.SelectButtonView,{objects:["None","Low","Medium","High"]}).add("UnsortedObjects",SC.SelectButtonView,{objects:["None","Low","Medium","High"],disableSort:YES}).add("redraw",SC.SelectButtonView,{layout:{width:"150",right:"0"}}).add("SelectButtonWithIcon",SC.SelectButtonView,{objects:[{title:"None",icon:"select-button-icon"},{title:"Low",icon:"select-button-icon"},{title:"Medium",icon:"select-button-icon"},{title:"High",icon:"select-button-icon"}],nameKey:"title",iconKey:"icon",checkboxEnabled:YES}).add("SortKey",SC.SelectButtonView,{objects:[{title:"None",pos:3},{title:"Low",pos:1},{title:"Medium",pos:2},{title:"High",pos:4}],nameKey:"title",disableSort:NO,sortKey:"pos",checkboxEnabled:YES}).add("StaticLayout",SC.SelectButtonView,{useStaticLayout:YES,objects:["None","Low","Medium","High"],layout:{width:"150",right:"0"}}).add("DisableItem",SC.SelectButtonView,{objects:[{title:"None",pos:3,isEnabled:YES},{title:"Low",pos:1,isEnabled:NO},{title:"Medium",pos:2,isEnabled:YES},{title:"High",pos:4,isEnabled:NO}],nameKey:"title",disableSort:NO,isEnabledKey:"isEnabled",sortKey:"pos",checkboxEnabled:YES});
pane.show();module("SC.SelectButtonView ui",pane.standardSetup());test("Check the visiblity of the selectButtons",function(){ok(pane.view("Basic").get("isVisibleInWindow"),"Basic.isVisibleInWindow should be YES");
ok(pane.view("Disabled").get("isVisibleInWindow"),"Disabled.isVisibleInWindow should be YES");
ok(!pane.view("NotVisible").get("isVisibleInWindow"),"NotVisible.isVisibleInWindow should be NO");
ok(pane.view("SortedObjects").get("isVisibleInWindow"),"SortedObjects.isVisibleInWindow should be YES");
ok(pane.view("UnsortedObjects").get("isVisibleInWindow"),"UnsortedObjects.isVisibleInWindow should be YES");
ok(pane.view("redraw").get("isVisibleInWindow"),"redraw.isVisibleInWindow should be YES");
ok(pane.view("SelectButtonWithIcon").get("isVisibleInWindow"),"SelectButtonWithIcon.isVisibleInWindow should be YES");
ok(pane.view("StaticLayout").get("isVisibleInWindow"),"StaticLayout.isVisibleInWindow should be YES")
});test("Basic",function(){var d=pane.view("Basic").$();ok(d.hasClass("sc-view"),"hasClass(sc-view) should be YES");
ok(d.hasClass("sc-button-view"),"hasClass(sc-button-view) should be YES");ok(d.hasClass("sc-regular-size"),"hasClass(sc-regular-size) should be YES");
ok(!d.hasClass("icon"),"hasClass(icon) should be NO");ok(!d.hasClass("sel"),"hasClass(sel) should be NO");
ok(!d.hasClass("disabled"),"hasClass(disabled) should be NO");ok(!d.hasClass("def"),"hasClass(def) should be NO")
});test("Disabled",function(){var d=pane.view("Disabled").$();ok(d.hasClass("disabled"),"hasClass(disabled) should be YES");
ok(d.hasClass("sc-view"),"hasClass(sc-view) should be YES");ok(d.hasClass("sc-button-view"),"hasClass(sc-button-view) should be YES");
ok(d.hasClass("sc-regular-size"),"hasClass(sc-regular-size) should be YES");ok(!d.hasClass("icon"),"hasClass(icon) should be NO");
ok(!d.hasClass("sel"),"hasClass(sel) should be NO");ok(!d.hasClass("def"),"hasClass(def) should be NO")
});test("NotVisible",function(){var d=pane.view("NotVisible").$();ok(d.hasClass("sc-view"),"hasClass(sc-view) should be YES");
ok(d.hasClass("sc-button-view"),"hasClass(sc-button-view) should be YES");ok(d.hasClass("sc-regular-size"),"hasClass(sc-regular-size) should be YES");
ok(!d.hasClass("sel"),"hasClass(sel) should be NO");ok(!d.hasClass("disabled"),"hasClass(disabled) should be NO");
ok(!d.hasClass("def"),"hasClass(def) should be NO");ok(!d.hasClass("sel"),"should not have sel class")
});test("SortedObjects",function(){var d=pane.view("SortedObjects");equals(null,d.get("sortKey"),"sortkey not specified");
ok(d.$().hasClass("sc-view"),"hasClass(sc-view) should be YES");ok(d.$().hasClass("sc-button-view"),"hasClass(sc-button-view) should be YES");
ok(d.$().hasClass("sc-regular-size"),"hasClass(sc-regular-size) should be YES");ok(!d.$().hasClass("sel"),"hasClass(sel) should be NO");
ok(!d.$().hasClass("icon"),"hasClass(icon) should be NO");ok(!d.$().hasClass("disabled"),"hasClass(disabled) should be NO");
ok(!d.$().hasClass("def"),"hasClass(def) should be NO")});test("UnsortedObjects",function(){var d=pane.view("UnsortedObjects");
equals(YES,d.get("disableSort"),"Sorting disabled");ok(d.$().hasClass("sc-view"),"hasClass(sc-view) should be YES");
ok(d.$().hasClass("sc-button-view"),"hasClass(sc-button-view) should be YES");ok(d.$().hasClass("sc-regular-size"),"hasClass(sc-regular-size) should be YES");
ok(!d.$().hasClass("sel"),"hasClass(sel) should be NO");ok(!d.$().hasClass("icon"),"hasClass(icon) should be NO");
ok(!d.$().hasClass("disabled"),"hasClass(disabled) should be NO");ok(!d.$().hasClass("def"),"hasClass(def) should be NO")
});test("redraw",function(){var d=pane.view("redraw");ok(d.$().hasClass("sc-view"),"hasClass(sc-view) should be YES");
ok(d.$().hasClass("sc-button-view"),"hasClass(sc-button-view) should be YES");ok(d.$().hasClass("sc-regular-size"),"hasClass(sc-regular-size) should be YES");
ok(!d.$().hasClass("sel"),"hasClass(sel) should be NO");ok(!d.$().hasClass("icon"),"hasClass(icon) should be NO");
ok(!d.$().hasClass("disabled"),"hasClass(disabled) should be NO");ok(!d.$().hasClass("def"),"hasClass(def) should be NO");
ok(d.get("objects").length===0,"Objects should be empty");SC.RunLoop.begin();d.set("objects",["Calendar","Work","Home"]);
SC.RunLoop.end();ok(d.get("objects").length===3,"Objects length should be 3")});test("SelectButtonWithIcon",function(){var d=pane.view("SelectButtonWithIcon").$();
ok(d.hasClass("icon"),"hasClass(Icon) should be YES");ok(d.hasClass("sc-view"),"hasClass(sc-view) should be YES");
ok(d.hasClass("sc-button-view"),"hasClass(sc-button-view) should be YES");ok(d.hasClass("sc-regular-size"),"hasClass(sc-regular-size) should be YES");
ok(!d.hasClass("sel"),"hasClass(sel) should be NO");ok(!d.hasClass("disabled"),"hasClass(disabled) should be NO");
ok(!d.hasClass("def"),"hasClass(def) should be NO")});test("Check if the objects are sorted based on sortKey",function(){var d=pane.view("SortKey");
equals("None",d.get("objects")[2].title,'Third object should be "None" ')});test("StaticLayout",function(){var d=pane.view("StaticLayout");
ok(!d.$().hasClass("disabled"),"should not have disabled class");ok(!d.$().hasClass("sel"),"should not have sel class")
});module("TODO: Test SC.SheetPane Methods");module("SC.SheetPane UI");var slidePane;
test("verify sheet pane slide down works",function(){slidePane=SC.SheetPane.create({layout:{top:60,width:400,height:200,centerX:0},contentView:SC.LabelView.extend({escapeHTML:NO,value:"<h1>Slide Down!</h1>"})});
var h=slidePane.get("layout");var k=h.top;var g=h.left;var e=h.width;var l=h.height;
var d=slidePane.layoutStyle();slidePane.append();var j=function(){SC.RunLoop.begin().end();
equals(slidePane.get("layout").top,0,"pane should be displayed at default position top after animating");
ok(slidePane.get("isVisibleInWindow"),"pane.isVisibleInWindow should be YES");ok(slidePane.$().hasClass("sc-sheet"),"pane should have sc-sheet class");
ok(slidePane.childViews[0].get("isVisibleInWindow"),"pane.div.isVisibleInWindow should be YES");
ok(slidePane.childViews[0].$().hasClass("sc-view"),"pane.div should have sc-view class");
window.start();slidePane.remove()};stop();setTimeout(j,400)});var b,counter;module("SC.ButtonView#actions",{setup:function(){b=SC.ButtonView.create()
}});test("Emulate mouse click to verify if the button activates",function(){b.triggerAction();
equals(b.get("isActive"),YES,"the should be active for 200ms")});test("Test different moused states",function(){b.set("isEnabled",YES);
b.mouseDown();equals(b.get("isActive"),YES,"the button should be active after a mouseDown event");
b.mouseExited();equals(b.get("isActive"),NO,"the button should be active after a mouseDown event");
b.mouseEntered();equals(b.get("isActive"),b._isMouseDown,"the button should be active after a mouseDown event");
b.set("buttonBehavior",SC.TOGGLE_BEHAVIOR);b._action();equals(b.get("value"),b.get("toggleOnValue"),"the value should be the same as the toggle value");
b.set("buttonBehavior",SC.TOGGLE_ON_BEHAVIOR);b._action();equals(b.get("value"),b.get("toggleOnValue"),"the value should be the same as the toggle value");
b.set("buttonBehavior",SC.TOGGLE_OFF_BEHAVIOR);b._action();equals(b.get("value"),b.get("toggleOffValue"),"the value should be the same as the toggle value")
});module("SC.ButtonView#actions - SC.HOLD_BEHAVIOR",{setup:function(){counter=SC.Object.create({value:0,increment:function(){this.set("value",this.get("value")+1)
}});b=SC.ButtonView.create({buttonBehavior:SC.HOLD_BEHAVIOR,holdInterval:5,target:counter,action:"increment",_runAction:function(d){var e=this.get("action"),g=this.get("target")||null;
g[e]()}})}});test("Test triggerAction only happens once",function(){b.triggerAction();
var d=function(){equals(counter.get("value"),1,"should only run action once");start()
};stop();setTimeout(d,10)});test("Test action repeats while active",function(){b.set("isActive",YES);
b._action();var d=function(){ok(counter.get("value")>2,"should have run more than 2 times");
b.set("isActive",NO);start()};stop();setTimeout(d,300)});test("Test action happens on mouseDown",function(){b.mouseDown();
equals(counter.get("value"),1,"should have run once");b.set("isActive",NO)});test("Test action does not happen on mouseUp",function(){b._isMouseDown=YES;
b.mouseUp();equals(counter.get("value"),0,"should not have run")});test("Should stop when inactive",function(){b.set("isActive",YES);
b._action();b.set("isActive",NO);var d=function(){equals(counter.get("value"),1,"should only run action once");
start()};stop();setTimeout(d,10)});htmlbody("<style> .sc-static-layout { border: 1px red dotted; } </style>");
var iconURL="http://www.freeiconsweb.com/Icons/16x16_people_icons/People_046.gif";
(function(){var d=SC.ControlTestPane.design().add("basic",SC.ButtonView,{}).add("title",SC.ButtonView,{title:"Hello World"}).add("icon",SC.ButtonView,{icon:iconURL}).add("title,icon",SC.ButtonView,{title:"Hello World",icon:iconURL}).add("title,icon,disabled",SC.ButtonView,{title:"Hello World",icon:iconURL,isEnabled:NO}).add("title,icon,default",SC.ButtonView,{title:"Hello World",icon:iconURL,isDefault:YES}).add("title,icon,selected",SC.ButtonView,{title:"Hello World",icon:iconURL,isSelected:YES}).add("title,toolTip",SC.ButtonView,{title:"Hello World",toolTip:"Hello World is my tool tip"});
d.show();module("SC.ButtonView ui");test("Check that all button are visible",function(){ok(d.view("basic").get("isVisibleInWindow"),"basic.isVisibleInWindow should be YES");
ok(d.view("title").get("isVisibleInWindow"),"title.isVisibleInWindow should be YES");
ok(d.view("icon").get("isVisibleInWindow"),"icon.isVisibleInWindow should be YES");
ok(d.view("title,icon").get("isVisibleInWindow"),"title,icon.isVisibleInWindow should be YES");
ok(d.view("title,icon,disabled").get("isVisibleInWindow"),"title,icon,disabled.isVisibleInWindow should be YES");
ok(d.view("title,icon,default").get("isVisibleInWindow"),"title,icon,default.isVisibleInWindow should be YES");
ok(d.view("title,icon,selected").get("isVisibleInWindow"),"title.icon,selected.isVisibleInWindow should be YES");
ok(d.view("title,toolTip").get("isVisibleInWindow"),"title,toolTip.isVisibleInWindow should be YES")
});test("Check that all buttons have the right classes set",function(){var e=d.view("basic").$();
ok(e.hasClass("sc-view"),"basic.hasClass(sc-view) should be YES");ok(e.hasClass("sc-button-view"),"basic.hasClass(sc-button-view) should be YES");
ok(e.hasClass("sc-regular-size"),"basic.hasClass(sc-regular-size) should be YES");
ok(!e.hasClass("icon"),"basic.hasClass(icon) should be NO");ok(!e.hasClass("sel"),"basic.hasClass(sel) should be NO");
ok(!e.hasClass("disabled"),"basic.hasClass(disabled) should be NO");ok(!e.hasClass("def"),"basic.hasClass(def) should be NO");
e=d.view("title").$();ok(e.hasClass("sc-view"),"title.hasClass(sc-view) should be YES");
ok(e.hasClass("sc-button-view"),"title.hasClass(sc-button-view) should be YES");ok(e.hasClass("sc-regular-size"),"title.hasClass(sc-regular-size) should be YES");
ok(!e.hasClass("icon"),"title.hasClass(icon) should be NO");ok(!e.hasClass("sel"),"title.hasClass(sel) should be NO");
ok(!e.hasClass("disabled"),"title.hasClass(disabled) should be NO");ok(!e.hasClass("def"),"title.hasClass(def) should be NO");
e=d.view("icon").$();ok(e.hasClass("sc-view"),"icon.hasClass(sc-view) should be YES");
ok(e.hasClass("sc-button-view"),"icon.hasClass(sc-button-view) should be YES");ok(e.hasClass("sc-regular-size"),"icon.hasClass(sc-regular-size) should be YES");
ok(e.hasClass("icon"),"icon.hasClass(icon) should be YES");ok(!e.hasClass("sel"),"icon.hasClass(sel) should be NO");
ok(!e.hasClass("disabled"),"icon.hasClass(disabled) should be NO");ok(!e.hasClass("def"),"icon.hasClass(def) should be NO");
e=d.view("title,icon").$();ok(e.hasClass("sc-view"),"title,icon.hasClass(sc-view) should be YES");
ok(e.hasClass("sc-button-view"),"title,icon.hasClass(sc-button-view) should be YES");
ok(e.hasClass("sc-regular-size"),"title,icon.hasClass(sc-regular-size) should be YES");
ok(e.hasClass("icon"),"title,icon.hasClass(icon) should be YES");ok(!e.hasClass("sel"),"title,icon.hasClass(sel) should be NO");
ok(!e.hasClass("disabled"),"title,icon.hasClass(disabled) should be NO");ok(!e.hasClass("def"),"title,icon.hasClass(def) should be NO");
e=d.view("title,icon,disabled").$();ok(e.hasClass("sc-view"),"title,icon,disabled.hasClass(sc-view) should be YES");
ok(e.hasClass("sc-button-view"),"title,icon,disabled.hasClass(sc-button-view) should be YES");
ok(e.hasClass("sc-regular-size"),"title,icon,disabled.hasClass(sc-regular-size) should be YES");
ok(e.hasClass("icon"),"title,icon,disabled.hasClass(icon) should be YES");ok(!e.hasClass("sel"),"title,icon,disabled.hasClass(sel) should be NO");
ok(e.hasClass("disabled"),"title,icon,disabled.hasClass(disabled) should be YES");
ok(!e.hasClass("def"),"title,icon,disabled.hasClass(def) should be NO");e=d.view("title,icon,default").$();
ok(e.hasClass("sc-view"),"title,icon,default.hasClass(sc-view) should be YES");ok(e.hasClass("sc-button-view"),"title,icon,default.hasClass(sc-button-view) should be YES");
ok(e.hasClass("sc-regular-size"),"title,icon,default.hasClass(sc-regular-size) should be YES");
ok(e.hasClass("icon"),"title,icon,default.hasClass(icon) should be YES");ok(!e.hasClass("sel"),"title,icon,default.hasClass(sel) should be NO");
ok(!e.hasClass("disabled"),"title,icon,default.hasClass(disabled) should be NO");
ok(e.hasClass("def"),"title,icon,default.hasClass(def) should be YES");e=d.view("title,icon,selected").$();
ok(e.hasClass("sc-view"),"title,icon,selected.hasClass(sc-view) should be YES");ok(e.hasClass("sc-button-view"),"title,icon,selected.hasClass(sc-button-view) should be YES");
ok(e.hasClass("sc-regular-size"),"title,icon,selected.hasClass(sc-regular-size) should be YES");
ok(e.hasClass("icon"),"title,icon,selected.hasClass(icon) should be YES");ok(e.hasClass("sel"),"title,icon,selected.hasClass(sel) should be YES");
ok(!e.hasClass("disabled"),"title,icon,selected.hasClass(disabled) should be NO");
ok(!e.hasClass("def"),"title,icon,selected.hasClass(def) should be NO");e=d.view("title,toolTip").$();
ok(e.hasClass("sc-view"),"title,toolTip.hasClass(sc-view) should be YES");ok(e.hasClass("sc-button-view"),"title,toolTip.hasClass(sc-button-view) should be YES");
ok(e.hasClass("sc-regular-size"),"title,toolTip.hasClass(sc-regular-size) should be YES");
ok(!e.hasClass("icon"),"title,toolTip.hasClass(icon) should be NO");ok(!e.hasClass("sel"),"title,toolTip.hasClass(sel) should be NO");
ok(!e.hasClass("disabled"),"title,toolTip.hasClass(disabled) should be NO");ok(!e.hasClass("def"),"title,toolTip.hasClass(def) should be NO")
});test("Check that the title is set or not and if it is in the appropriate element",function(){var e=d.view("basic").$("span");
equals(e.text(),"","should not have a title");e=d.view("basic").$("label");ok(e!==null,"should have a label element even with no title");
e=d.view("title").$("span");equals(e.text(),"Hello World","should not have a title");
e=d.view("title").$("label");ok(e!==null,"should have a label element");e=d.view("icon").$("span.label.img");
ok((e!==null),"should have an image corresponding to an icon")});test("Check if title,toolTip has the tool tip set",function(){var e=d.view("title,toolTip").$("div");
ok(e.defaultClass[0].title=="Hello World is my tool tip","title,toolTip has the expected tool tip set.")
})})();var pane,view;module("SC.Checkbox",{setup:function(){SC.RunLoop.begin();pane=SC.MainPane.create({childViews:[SC.CheckboxView.extend({layout:{right:20,bottom:20,width:100,height:23},title:"First Name",value:YES})]});
pane.append();SC.RunLoop.end();view=pane.childViews[0]},teardown:function(){pane.remove();
pane=view=null}});test("renders an input tag with appropriate attributes",function(){equals(view.get("value"),YES,"precon - value should be YES");
var d=view.$();equals(d.attr("role"),"checkbox","should have type=checkbox");equals(d.attr("aria-checked"),"true","should be checked")
});test("should have span with title inside",function(){var d=Q$("span",view.get("layer"));
ok(view.get("displayTitle").length>0,"precond - display title should not be empty");
equals(d.text(),view.get("displayTitle"),"should have display title")});test("changing the title should update the span",function(){var e=view.get("displayTitle");
SC.RunLoop.begin();view.set("title","Last Name");SC.RunLoop.end();ok(view.get("displayTitle")!==e,"precond - should have changed display title");
var d=Q$("span",view.get("layer"));equals(d.text(),view.get("displayTitle"),"should have display title")
});test("isEnabled=NO should add disabled class",function(){SC.RunLoop.begin();view.set("isEnabled",NO);
SC.RunLoop.end();ok(view.$().hasClass("disabled"),"should have disabled class")});
test("isSelected should alter sel classname and sync with value property",function(){ok(view.get("isSelected"),"isSelected should match value");
ok(view.$().hasClass("sel"),"should have sel class");SC.RunLoop.begin();view.set("value",0);
SC.RunLoop.end();ok(!view.get("isSelected"),"isSelected should now be NO");ok(!view.$().hasClass("sel"),"should no longer have sel class");
equals(view.$().attr("aria-checked"),"false","input should not be checked");SC.RunLoop.begin();
view.set("isSelected",YES);SC.RunLoop.end();ok(view.get("isSelected"),"isSelected should match value");
ok(view.$().hasClass("sel"),"should have sel class");equals(view.$().attr("aria-checked"),"true","input should be checked")
});test("clicking on the checkbox will change toggle the value",function(){ok(view.get("value"),"precond - value should be YES");
view.mouseDown();view.mouseUp();ok(!view.get("value"),"value should now be NO")});
test("pressing mouseDown and then mouseUp anywhere in the checkbox should toggle the selection",function(){var e=view.get("layer"),d=SC.$("input",e);
SC.Event.trigger(e,"mousedown");ok(view.get("isActive"),"view should be active");
ok(view.get("value"),"value should not change yet");SC.Event.trigger(e,"mouseup");
d.attr("checked",NO);SC.Event.trigger(d.get(0),"click");ok(!view.get("isActive"),"view should no longer be active");
ok(!view.get("value"),"value should change to NO");d=e=null});test("isEnabled=NO should add disabled attr to input",function(){SC.RunLoop.begin();
view.set("isEnabled",NO);SC.RunLoop.end();ok(view.get("value"),"precond - value should be true");
view.mouseDown();view.mouseUp();ok(view.get("value"),"value should not change when clicked")
});htmlbody("<style> .sc-static-layout { border: 1px red dotted; } </style>");(function(){var d=SC.ControlTestPane.design().add("basic",SC.CheckboxView,{value:NO,isEnabled:YES,title:"Hello World"}).add("selected",SC.CheckboxView,{value:YES,title:"Hello World"}).add("disabled",SC.CheckboxView,{isEnabled:NO,title:"Hello World"}).add("disabled - selected",SC.CheckboxView,{isEnabled:NO,value:YES,title:"Hello World"}).add("static layout 1",SC.CheckboxView,{useStaticLayout:YES,layout:{width:"auto",right:"auto"},title:"Static Layout"}).add("static layout 2",SC.CheckboxView,{useStaticLayout:YES,layout:{width:"auto",right:"auto"},title:"Different Length Title"});
d.show();module("SC.CheckboxView ui",d.standardSetup());test("basic",function(){var e=d.view("basic");
ok(!e.$().hasClass("disabled"),"should not have disabled class");ok(!e.$().hasClass("sel"),"should not have sel class");
var g=e.$();equals(g.attr("aria-checked"),"false","input should not be checked");
var h=e.$("span.label");equals(h.text(),"Hello World","should have label")});test("selected",function(){var e=d.view("selected");
ok(!e.$().hasClass("disabled"),"should not have disabled class");ok(e.$().hasClass("sel"),"should have sel class");
var g=e.$();equals(g.attr("aria-checked"),"true","input should be checked");var h=e.$("span.label");
equals(h.text(),"Hello World","should have label")});test("disabled",function(){var e=d.view("disabled");
ok(e.$().hasClass("disabled"),"should have disabled class");ok(!e.$().hasClass("sel"),"should not have sel class");
var g=e.$();equals(g.attr("aria-checked"),"false","input should not be checked");
var h=e.$("span.label");equals(h.text(),"Hello World","should have label")});test("disabled - selected",function(){var e=d.view("disabled - selected");
ok(e.$().hasClass("disabled"),"should have disabled class");ok(e.$().hasClass("sel"),"should have sel class");
var g=e.$();equals(g.attr("aria-checked"),"true","input should be checked");var h=e.$("span.label");
equals(h.text(),"Hello World","should have label")})})();var view,content1,content2;
module("SC.CollectionView.content",{setup:function(){view=SC.CollectionView.create({contentPropertyDidChange:CoreTest.stub("contentPropertyDidChange"),computeLayout:CoreTest.stub("computeLayout"),reload:CoreTest.stub("reload",{shouldReloadAll:function(){var e=this.history,g=e.length,d;
while(--g>=0){d=e[g];if(d<=1){return YES}if(d[1]===null){return YES}if(d[0].get("nowShowing").contains(d[1])){return YES
}}return NO},indexes:function(){var g=this.history,h=g.length,e=SC.IndexSet.create(),d;
while(--h>=0){d=g[h];if(d[1]&&d[1].isIndexSet){e.add(d[1])}}return e},action:function(d){var e=this.reload.history;
if(d){e[e.length-1][1]=d.clone()}this.computeLayout();return this},expect:function(d,g){if(d===YES){equals(this.shouldReloadAll(),YES,"reload() should reload all")
}else{if(d!==NO){var e=this.indexes();var h=d.isEqual(e);ok(h,"expected reload(%@), actual: reload(%@)".fmt(d,e))
}}if(g!==undefined){equals(this.callCount,g,"reload() should have been called X times")
}this.reset()}}),expectLength:function(d){equals(view.get("length"),d,"view.length after change");
var g=view.get("nowShowing"),e=SC.IndexSet.create(0,d);ok(e.isEqual(g),"nowShowing expected: %@, actual: %@".fmt(e,g))
},reset:function(){this.reload.reset();this.contentPropertyDidChange.reset();this.computeLayout.reset()
}});content1="a b c d e f".w().map(function(d){return SC.Object.create({title:d})
});content2="d e f x y z".w().map(function(d){return SC.Object.create({title:d})})
}});test("setting content for first time",function(){equals(view.get("content"),null,"precond - view.content should be null");
view.set("content",content1);view.reload.expect(YES,2);view.contentPropertyDidChange.expect(0);
view.computeLayout.expect(YES);view.expectLength(content1.get("length"))});test("changing content with different size",function(){view.set("content","a b".w());
view.reset();view.set("content",content2);view.reload.expect(YES,2);view.contentPropertyDidChange.expect(0);
view.computeLayout.expect(YES);view.expectLength(content2.get("length"))});test("changing content with same size",function(){view.set("content","a b".w());
view.reset();view.set("content",content2);view.reload.expect(YES);view.contentPropertyDidChange.expect(0);
view.computeLayout.expect(YES);view.expectLength(content2.get("length"))});test("changing the content of a single item should reload that item",function(){view.set("content",content1);
view.reset();content1.replace(1,1,["X"]);view.reload.expect(SC.IndexSet.create(1));
view.contentPropertyDidChange.expect(0);view.computeLayout.expect(YES);view.expectLength(content1.get("length"))
});test("changing the content of several items should reload each item",function(){view.set("content",content1);
view.reset();content1.replace(1,1,["X"]);content1.replace(3,1,["X"]);view.reload.expect(SC.IndexSet.create(1).add(3));
view.contentPropertyDidChange.expect(0);view.computeLayout.expect(YES);view.expectLength(content1.get("length"))
});test("adding to end of content should reload new items",function(){view.set("content",content1);
view.reset();content1.pushObject("X");content1.pushObject("Y");view.reload.expect(SC.IndexSet.create(content1.get("length")-2,2));
view.contentPropertyDidChange.expect(0);view.expectLength(content1.get("length"));
view.computeLayout.expect(YES)});test("removing from end of content should reload removed items",function(){view.set("content",content1);
view.reset();content1.popObject();content1.popObject();view.reload.expect(SC.IndexSet.create(content1.get("length"),2));
view.contentPropertyDidChange.expect(0);view.expectLength(content1.get("length"));
view.computeLayout.expect(YES)});test("inserting into middle should reload all following items",function(){view.set("content",content1);
view.reset();content1.insertAt(3,"FOO");view.reload.expect(SC.IndexSet.create(3,content1.get("length")-3));
view.contentPropertyDidChange.expect(0);view.expectLength(content1.get("length"));
view.computeLayout.expect(YES)});test("editing properties",function(){view.set("content",content1);
view.reset();view.contentPropertyDidChange.reset();var d=content1.objectAt(3);ok(d!==null,"precond -has object to edit");
d.set("title","FOO");view.reload.expect(NO,0);view.contentPropertyDidChange.expect(0);
view.computeLayout.expect(NO)});var view,sel,beforeLen,afterLen,content;module("SC.CollectionView.deleteSelection",{setup:function(){content="1 2 3 4 5 6 7 8 9 10".w().map(function(d){return SC.Object.create({title:d})
});sel=SC.SelectionSet.create().add(content,4,2);view=SC.CollectionView.create({content:content,selection:sel,canDeleteContent:YES});
beforeLen=content.get("length");afterLen=beforeLen-sel.get("length")}});test("canDeleteContent",function(){view.set("canDeleteContent",NO);
equals(view.deleteSelection(),NO,"should return NO if not allowed");equals(content.get("length"),beforeLen,"content.length should not change");
equals(view.get("selection").get("length"),2,"should not change selection");view.set("canDeleteContent",YES);
equals(view.deleteSelection(),YES,"should return YES if allowed");equals(content.get("length"),afterLen,"content.length should change");
equals(view.get("selection").indexSetForSource(content).get("min"),3,"should select an adjacent item")
});test("empty selection case",function(){view.select(null);view.set("canDeleteContent",YES);
equals(view.get("selection").get("length"),0,"precond - should have empty selection");
equals(view.deleteSelection(),NO,"should return NO if not allowed");equals(content.get("length"),beforeLen,"content.length should not change")
});test("delegate.collectionViewShouldDeleteIndexes",function(){view.set("canDeleteContent",YES);
view.delegate=SC.Object.create(SC.CollectionViewDelegate,{v:null,collectionViewShouldDeleteIndexes:function(){return this.v
}});equals(view.deleteSelection(),NO,"should return NO if not allowed");equals(content.get("length"),beforeLen,"content.length should not change");
equals(view.get("selection").get("length"),2,"should not change selection");view.delegate.v=SC.IndexSet.create(4,1);
equals(view.get("selectionDelegate"),view.delegate,"selection delegate should be delegate object");
equals(view.deleteSelection(),YES,"should return YES if allowed");equals(content.get("length"),afterLen+1,"content.length should change");
equals(view.get("selection").get("length"),1,"non-deleted parts should remain selected %@".fmt(view.get("selection")))
});var view,sel,content;module("SC.CollectionView.deselect",{setup:function(){content="1 2 3 4 5 6 7 8 9 10".w().map(function(d){return SC.Object.create({title:d})
});sel=SC.SelectionSet.create().add(content,4,4);view=SC.CollectionView.create({content:content,selection:sel})
}});test("deselect(indexes=Number)",function(){var d=SC.SelectionSet.create().add(content,4,4).remove(content,6),e;
SC.run(function(){view.deselect(6)});e=view.get("selection");ok(d.isEqual(e),"selection should remove index (expected: %@ actual: %@)".fmt(d,e))
});test("deselect(indexes=IndexSet)",function(){var e,d=SC.SelectionSet.create().add(content,4,4).remove(content,6,2);
SC.run(function(){view.deselect(SC.IndexSet.create(6,2))});e=view.get("selection");
ok(d.isEqual(e),"selection should remove index (expected: %@ actual: %@)".fmt(d,e))
});test("deselect() with empty selection",function(){var d=SC.SelectionSet.create(),e;
SC.run(function(){view.set("selection",d)});SC.run(function(){view.deselect(SC.IndexSet.create(6,2))
});e=view.get("selection");ok(d.isEqual(e),"deselect should do nothing (expected: %@ actual: %@)".fmt(d,e))
});var del;module("SC.CollectionView.deselect - delegate support",{setup:function(){content="1 2 3 4 5 6 7 8 9 10".w().map(function(d){return SC.Object.create({title:d})
});del=SC.Object.create(SC.CollectionViewDelegate);sel=SC.SelectionSet.create().add(content,4,4);
view=SC.CollectionView.create({delegate:del,selection:sel,content:content})}});test("should call delegate if set",function(){var e=0,d=0;
del.collectionViewShouldDeselectIndexes=function(g,h,j){e++;return h};del.collectionViewSelectionForProposedSelection=function(g,h){d++;
return h};view.deselect(3);equals(e,1,"should invoke collectionViewShouldDeselectIndexes on delegate 1x");
equals(d,1,"should invoke collectionViewSelectionForProposedSelection on delegate 1x if change is allowed")
});test("not calling collectionViewSelectionForProposedSelection if collectionViewShouldDeselectIndexes returns null",function(){var e=0,d=0;
del.collectionViewShouldDeselectIndexes=function(g,h,j){e++;return null};del.collectionViewSelectionForProposedSelection=function(g,h){d++;
return h};view.deselect(3);equals(e,1,"should invoke collectionViewShouldDeselectIndexes on delegate 1x");
equals(d,0,"should NOT invoke collectionViewSelectionForProposedSelection on delegate since no change was allowed")
});test("del.collectionViewShouldDeselectIndexes - replacing selection",function(){del.collectionViewShouldDeselectIndexes=function(g,h,j){return h.without(3)
};view.deselect(SC.IndexSet.create(0,4));var d=sel.copy().remove(content,SC.IndexSet.create(0,4).remove(3)),e=view.get("selection");
ok(d.isEqual(e),"selection should only include those allowed by delegate (i.e. not index 3) (expected: %@ actual: %@)".fmt(d,e))
});test("del.collectionViewShouldDeselectIndexes - returns empty index set",function(){del.collectionViewShouldDeselectIndexes=function(g,h){return h.without(5)
};view.deselect(4);view.deselect(5);var d=sel.copy().remove(content,4),e=view.get("selection");
ok(d.isEqual(e),"selection should deselect only items returned by delegate (expected: %@ actual: %@)".fmt(d,e))
});test("del.collectionViewShouldDeselectIndexes - delegate returns null",function(){del.collectionViewShouldDeselectIndexes=function(g,h,j){return null
};view.deselect(4);var d=sel,e=view.get("selection");ok(d.isEqual(e),"selection should not change if delegate returns null (expected: %@ actual: %@)".fmt(d,e))
});test("del.collectionViewSelectionForProposedSelection - returns indexes",function(){del.collectionViewSelectionForProposedSelection=function(g,h){var j=sel.copy().remove(content,5),k=h;
ok(j.isEqual(k),"should pass proposed selection to delegate (expected: %@ actual: %@)".fmt(j,k));
equals(g,view,"should pass view to delegate");return SC.SelectionSet.create().add(content,10,20)
};view.deselect(5);var d=SC.SelectionSet.create().add(content,10,20),e=view.get("selection");
ok(d.isEqual(e),"should set selection to whatever is returned from delegate (expected: %@ actual: %@)".fmt(d,e))
});test("del.collectionViewSelectionForProposedSelection - returns null",function(){del.collectionViewSelectionForProposedSelection=function(g,h){return null
};view.deselect(5);var d=SC.SelectionSet.create(),e=view.get("selection");ok(d.isEqual(e),"should set selection to empty set if returns null (expected: %@ actual: %@)".fmt(d,e))
});test("deselecting a range should remove individual objects in range also",function(){var e=content.objectAt(1);
var d=SC.SelectionSet.create().add(content,5,3),g;sel.addObject(e);view.deselect(SC.IndexSet.create(0,5));
g=view.get("selection");ok(d.isEqual(g),"should remove content[1] from selection (expected: %@ actual: %@)".fmt(d,g))
});var view;module("SC.CollectionView#displayProperties",{setup:function(){view=SC.CollectionView.create({isVisibleInWindow:YES}).createLayer()
},teardown:function(){view.destroy()}});test("should gain active class if isActive",function(){SC.RunLoop.begin();
view.set("isActive",YES);SC.RunLoop.end();ok(view.$().hasClass("active"),"should have active class");
SC.RunLoop.begin();view.set("isActive",NO);SC.RunLoop.end();ok(!view.$().hasClass("active"),"should remove active class")
});var view,del,content;module("SC.CollectionView.itemViewForContentIndex",{setup:function(){content="a b c".w().map(function(d){return SC.Object.create({title:d})
});del={fixture:{isEnabled:YES,isSelected:YES,outlineLevel:3,disclosureState:SC.LEAF_NODE},contentIndexIsEnabled:function(){return this.fixture.isEnabled
},contentIndexIsSelected:function(){return this.fixture.isSelected},contentIndexOutlineLevel:function(){return this.fixture.outlineLevel
},contentIndexDisclosureState:function(){return this.fixture.disclosureState}};view=SC.CollectionView.create(del,{content:content,layoutForContentIndex:function(d){return this.fixtureLayout
},fixtureLayout:{left:0,right:0,top:0,bottom:0},groupExampleView:SC.View.extend(),exampleView:SC.View.extend(),testAsGroup:NO,contentIndexIsGroup:function(){return this.testAsGroup
},contentGroupIndexes:function(){if(this.testAsGroup){return SC.IndexSet.create(0,this.get("length"))
}else{return null}},fixtureNowShowing:SC.IndexSet.create(0,3),computeNowShowing:function(){return this.fixtureNowShowing
}});del=SC.mixin({},SC.CollectionContent,del)}});function shouldMatchFixture(e,g){var d;
for(d in g){if(!g.hasOwnProperty(d)){continue}equals(e.get(d),g[d],"itemView.%@ should match delegate value".fmt(d))
}}test("creating basic item view",function(){var d=view.itemViewForContentIndex(1);
ok(d,"should return itemView");ok(d.kindOf(view.exampleView),"itemView %@ should be kindOf %@".fmt(d,view.exampleView));
equals(d.get("content"),content.objectAt(1),"itemView.content should be set to content item");
equals(d.get("contentIndex"),1,"itemView.contentIndex should be set");equals(d.get("owner"),view,"itemView.owner should be collection view");
equals(d.get("displayDelegate"),view,"itemView.displayDelegate should be collection view");
equals(d.get("parentView"),view,"itemView.parentView should be collection view");
shouldMatchFixture(d,view.fixture)});test("returning item from cache",function(){var h=view.itemViewForContentIndex(1);
ok(h,"precond - first call returns an item view");var g=view.itemViewForContentIndex(1);
equals(g,h,"retrieving multiple times should same instance");var e=view.itemViewForContentIndex(1,YES);
ok(h!==e,"itemViewForContentIndex(1, YES) should return new item even if it is already cached actual :%@".fmt(e));
var d=view.itemViewForContentIndex(1,NO);equals(d,e,"itemViewForContentIndex(1) [no reload] should return newly cached item after recache")
});test("contentExampleViewKey is set and content has property",function(){var d=SC.View.extend();
var g=content.objectAt(1);g.set("foo",d);view.set("contentExampleViewKey","foo");
var e=view.itemViewForContentIndex(1);ok(e,"should return item view");ok(e.kindOf(d),"itemView should be custom view specified on object. actual: %@".fmt(e))
});test("contentExampleViewKey is set and content is null",function(){var d=SC.View.extend();
view.set("contentExampleViewKey","foo");content.replace(1,1,[null]);var e=view.itemViewForContentIndex(1);
ok(e,"should return item view");equals(e.get("content"),null,"itemView content should be null");
ok(e.kindOf(view.exampleView),"itemView should be exampleView (%@). actual: %@".fmt(view.exampleView,e))
});test("contentExampleViewKey is set and content property is empty",function(){var d=SC.View.extend();
view.set("contentExampleViewKey","foo");var e=view.itemViewForContentIndex(1);ok(e,"should return item view");
equals(e.get("content"),content.objectAt(1),"itemView should have content");ok(e.kindOf(view.exampleView),"itemView should be exampleView (%@). actual: %@".fmt(view.exampleView,e))
});test("delegate says content is group",function(){view.testAsGroup=YES;var d=view.itemViewForContentIndex(1);
ok(d,"should return itemView");ok(d.kindOf(view.groupExampleView),"itemView should be groupExampleView (%@). actual: %@".fmt(view.groupExampleView,d));
ok(d.isGroupView,"itemView.isGroupView should be YES")});test("contentGroupExampleViewKey is set and content has property",function(){view.testAsGroup=YES;
var d=SC.View.extend();var g=content.objectAt(1);g.set("foo",d);view.set("contentGroupExampleViewKey","foo");
var e=view.itemViewForContentIndex(1);ok(e,"should return item view");ok(e.kindOf(d),"itemView should be custom view specified on object. actual: %@".fmt(e));
ok(e.isGroupView,"itemView.isGroupView should be YES")});test("contentGroupExampleViewKey is set and content is null",function(){view.testAsGroup=YES;
var d=SC.View.extend();view.set("contentGroupExampleViewKey","foo");content.replace(1,1,[null]);
var e=view.itemViewForContentIndex(1);ok(e,"should return item view");equals(e.get("content"),null,"itemView content should be null");
ok(e.kindOf(view.groupExampleView),"itemView should be exampleView (%@). actual: %@".fmt(view.groupExampleView,e));
ok(e.isGroupView,"itemView.isGroupView should be YES")});test("contentGroupExampleViewKey is set and content property is empty",function(){view.testAsGroup=YES;
var d=SC.View.extend();view.set("contentGroupExampleViewKey","foo");var e=view.itemViewForContentIndex(1);
ok(e,"should return item view");equals(e.get("content"),content.objectAt(1),"itemView should have content");
ok(e.kindOf(view.groupExampleView),"itemView should be exampleView (%@). actual: %@".fmt(view.groupExampleView,e));
ok(e.isGroupView,"itemView.isGroupView should be YES")});test("consults delegate if set",function(){view.fixture=null;
view.delegate=del;var d=view.itemViewForContentIndex(1);ok(d,"returns item view");
shouldMatchFixture(d,del.fixture)});test("consults content if implements mixin and delegate not set",function(){view.fixture=null;
view.delegate=null;SC.mixin(content,del);var d=view.itemViewForContentIndex(1);ok(d,"returns item view");
shouldMatchFixture(d,content.fixture)});test("prefers delegate over content if both implement mixin",function(){view.fixture=null;
view.delegate=del;SC.mixin(content,del);content.fixture=null;var d=view.itemViewForContentIndex(1);
ok(d,"returns item view");shouldMatchFixture(d,del.fixture)});test("after making an item visible then invisible again",function(){view.isVisibleInWindow=YES;
SC.run(function(){view.set("fixtureNowShowing",SC.IndexSet.create(1));view.notifyPropertyChange("nowShowing")
});equals(view.get("childViews").length,1,"precond - should have a child view");var d=view.itemViewForContentIndex(1);
equals(d.get("parentView"),view,"itemView has parent view");SC.run(function(){view.set("fixtureNowShowing",SC.IndexSet.create());
view.notifyPropertyChange("nowShowing")});equals(view.get("childViews").length,0,"precond - should have no childview");
d=view.itemViewForContentIndex(1);equals(d.get("parentView"),view,"itemView has parent view");
SC.run(function(){view.set("fixtureNowShowing",SC.IndexSet.create(1));view.notifyPropertyChange("nowShowing")
});equals(view.get("childViews").length,1,"precond - should have a child view");d=view.itemViewForContentIndex(1);
equals(d.get("parentView"),view,"itemView has parent view")});var view;module("SC.CollectionView.layerIdFor, contentIndexForLayerId",{setup:function(){view=SC.CollectionView.create()
}});test("0 index",function(){var d=view.layerIdFor(0);ok(d,"should return string");
equals(view.contentIndexForLayerId(d),0,"should parse out idx")});test("10 index",function(){var d=view.layerIdFor(10);
ok(d,"should return string");equals(view.contentIndexForLayerId(d),10,"should parse out idx")
});test("parse null id",function(){equals(view.contentIndexForLayerId(null),null,"should return null")
});test("parse collection view's layerId",function(){equals(view.contentIndexForLayerId(view.get("layerId")),null,"should return null")
});test("parse layerId from other object",function(){var e=SC.CollectionView.create();
var d=e.layerIdFor(20);equals(view.contentIndexForLayerId(d),null,"should return null")
});test("parse short arbitrary id",function(){equals(view.contentIndexForLayerId("sc242"),null,"should return null")
});test("parse long arbitrary id",function(){equals(view.contentIndexForLayerId("sc242-234-2453-sdf3"),null,"should return null")
});test("parse empty string",function(){equals(view.contentIndexForLayerId(""),null,"should return null")
});test("parse garbage",function(){equals(view.contentIndexForLayerId(234),null,"should return null")
});var view,content1,content2;module("SC.CollectionView.length",{setup:function(){view=SC.CollectionView.create({observer:CoreTest.stub("observer(length)").observes("length"),computeLayout:CoreTest.stub("computeLayout"),reset:function(){this.observer.reset();
this.computeLayout.reset()}});content1="a b c".w();content2="d e f g h".w()}});test("no content should have length of 0",function(){equals(view.get("content"),null,"precond - content is null");
equals(view.get("length"),0,"length should be 0")});test("length should be set property on newly inited object with content already set",function(){view=SC.CollectionView.create({content:content1});
equals(view.get("length"),content1.get("length"),"view.length should be content.length")
});test("setting content should update length & notify",function(){view.set("content",content1);
equals(view.get("length"),content1.get("length"),"view.length should equal new length");
view.observer.expect(1)});test("changing the content should update length & notify",function(){view.set("content",content1);
view.reset();ok(content1.get("length")!==content2.get("length"),"precond - content1.length should not equal content2.length");
view.set("content",content2);equals(view.get("length"),content2.get("length"),"view.length should equal new length");
view.observer.expect(1)});test("modifying content to make it shorter should update view length and notify",function(){view.set("content",content1);
view.reset();var d=content1.get("length");content1.removeAt(1);equals(view.get("length"),d-1,"view.length should equal new length");
view.observer.expect(1)});test("modifying content to add length should update view length and notify",function(){view.set("content",content1);
view.reset();var d=content1.get("length");content1.insertAt(1,"foo");equals(view.get("length"),d+1,"view.length should equal new length");
view.observer.expect(1)});test("modifying content so that it does not change the length should NOT change view length OR notify",function(){view.set("content",content1);
view.reset();var d=content1.get("length");content1.replace(1,1,"foo");equals(view.get("length"),d,"view.length should equal new length");
view.observer.expect(0)});var view,content,contentController,pane;module("SC.CollectionView Mouse Events",{setup:function(){SC.RunLoop.begin();
content="1 2 3 4 5 6 7 8 9 10".w().map(function(d){return SC.Object.create({value:d})
});contentController=SC.ArrayController.create({content:content,allowsMultipleSelection:YES});
view=SC.CollectionView.create({content:contentController,layout:{top:0,left:0,width:300,height:500},layoutForContentIndex:function(d){return{left:0,right:0,top:d*50,height:50}
},isVisibleInWindow:YES,acceptsFirstResponder:YES});pane=SC.MainPane.create();pane.appendChild(view);
pane.append();SC.RunLoop.end()},teardown:function(){SC.RunLoop.begin();pane.remove();
SC.RunLoop.end()}});function clickOn(s,m,o,e,l,h){var n=s.itemViewForContentIndex(m),j=n.get("layer"),d={shiftKey:o,ctrlKey:e},g,p,u;
ok(j,"precond - itemView[%@] should have layer".fmt(m));p=SC.Event.simulateEvent(j,"mousedown",d);
SC.Event.trigger(j,"mousedown",[p]);p=SC.Event.simulateEvent(j,"mouseup",d);SC.Event.trigger(j,"mouseup",[p]);
if(l!==undefined){var k=function(){SC.RunLoop.begin();g=s.get("selection");u=[];if(o){u.push("shift")
}if(e){u.push("ctrl")}u=u.length>0?u.join("+"):"no modifiers";ok(l.isEqual(g),"should have selection: %@ after click with %@ on item[%@], actual: %@".fmt(l,u,m,g));
SC.RunLoop.end();if(h){window.start()}};if(h){stop();setTimeout(k,h)}else{k()}}j=n=null
}function selectionFromIndex(e){var d=SC.SelectionSet.create();d.addObject(content.objectAt(e));
return d}function selectionFromIndexSet(e){var d=SC.SelectionSet.create();d.add(content,e);
return d}test("clicking on an item should select it",function(){clickOn(view,3,NO,NO,selectionFromIndex(3))
});test("clicking on a selected item should clear selection after 300ms and reselect it",function(){view.select(SC.IndexSet.create(1,5));
SC.RootResponder.responder._lastMouseUpAt=null;clickOn(view,3,NO,NO,selectionFromIndex(3),500)
});test("clicking on unselected item should clear selection and select it",function(){view.select(SC.IndexSet.create(1,5));
clickOn(view,7,NO,NO,selectionFromIndex(7))});test("first responder",function(){clickOn(view,3);
equals(view.get("isFirstResponder"),YES,"view.isFirstResponder should be YES after mouse down")
});test("ctrl-clicking on unselected item should add to selection",function(){clickOn(view,3,NO,YES,selectionFromIndex(3));
clickOn(view,5,NO,YES,selectionFromIndex(3).addObject(content.objectAt(5)))});test("ctrl-clicking on selected item should remove from selection",function(){clickOn(view,3,NO,YES,selectionFromIndex(3));
clickOn(view,5,NO,YES,selectionFromIndex(3).addObject(content.objectAt(5)));clickOn(view,3,NO,YES,selectionFromIndex(5));
clickOn(view,5,NO,YES,SC.SelectionSet.create())});test("shift-clicking on an item below should extend the selection",function(){clickOn(view,3,NO,NO,selectionFromIndex(3));
clickOn(view,5,YES,NO,selectionFromIndexSet(SC.IndexSet.create(3,3)))});test("shift-clicking on an item above should extend the selection",function(){clickOn(view,3,NO,NO,selectionFromIndex(3));
clickOn(view,1,YES,NO,selectionFromIndexSet(SC.IndexSet.create(1,3)))});test("shift-clicking inside selection first time should reduce selection from top",function(){view.select(SC.IndexSet.create(3,4));
clickOn(view,4,YES,NO,selectionFromIndexSet(SC.IndexSet.create(3,2)))});test("shift-click below to extend selection down then shift-click inside selection should reduce selection",function(){clickOn(view,3,NO,NO,selectionFromIndex(3));
clickOn(view,5,YES,NO,selectionFromIndexSet(SC.IndexSet.create(3,3)));clickOn(view,4,YES,NO,selectionFromIndexSet(SC.IndexSet.create(3,2)))
});test("shift-click above to extend selection down then shift-click inside selection should reduce top of selection",function(){clickOn(view,3,NO,NO,selectionFromIndex(3));
clickOn(view,1,YES,NO,selectionFromIndexSet(SC.IndexSet.create(1,3)));clickOn(view,2,YES,NO,selectionFromIndexSet(SC.IndexSet.create(2,2)))
});test("shift-click below bottom of selection then shift click on top of selection should select only top item",function(){clickOn(view,3,NO,NO,selectionFromIndex(3));
clickOn(view,5,YES,NO,selectionFromIndexSet(SC.IndexSet.create(3,3)));clickOn(view,3,YES,NO,selectionFromIndex(3))
});var view,content1,content2;module("SC.CollectionView.nowShowing",{setup:function(){content1="a b c".w();
view=SC.CollectionView.create({updateContentRangeObserver:CoreTest.stub("updateContentRangeObserver"),reloadCallCount:0,reloadIndexes:"not called",reload:function(d){this.reloadIndexes=d?d.frozenCopy():d;
this.reloadCallCount++},expectReload:function(d,g){if(d!==NO){var e=(d===null)?(this.reloadIndexes===null):d.isEqual(this.reloadIndexes);
if(!e){d.isEqual(this.reloadIndexes)}ok(e,"should have called reload(%@), actual reload(%@)".fmt(d,this.reloadIndexes))
}if(g!==NO){equals(this.reloadCallCount,g,"reload() should be called X times")}},observer:CoreTest.stub("nowShowing observer").observes("nowShowing"),reset:function(){this.updateContentRangeObserver.reset();
this.reloadCallCount=0;this.reloadIndexes="not called";this.observer.reset()},nextNowShowing:SC.IndexSet.create(0,3),computeNowShowing:function(){return this.nextNowShowing
},content:content1});view.reset()}});test("nowShowing should reflect content on create",function(){same(view.get("nowShowing"),view.nextNowShowing,"should have now showing value")
});test("if nowShowing changes but actual value stays the same, should do nothing",function(){view.notifyPropertyChange("nowShowing");
view.observer.expect(1);view.expectReload(NO,0);view.updateContentRangeObserver.expect(0)
});test("nowShowing changes to new index set with some overlap",function(){view.nextNowShowing=SC.IndexSet.create(2,5);
view.notifyPropertyChange("nowShowing");view.observer.expect(1);view.expectReload(SC.IndexSet.create(0,2).add(3,4),1);
view.updateContentRangeObserver.expect(1)});test("nowShowing changes to new index set with no overlap",function(){view.nextNowShowing=SC.IndexSet.create(10,3);
view.notifyPropertyChange("nowShowing");view.observer.expect(1);view.expectReload(SC.IndexSet.create(0,3).add(10,3),1);
view.updateContentRangeObserver.expect(1)});var view,content;module("SC.CollectionView.reload",{setup:function(){content="1 2 3 4 5 6 7 8 9 10".w().map(function(d){return SC.Object.create({value:d})
});view=SC.CollectionView.create({content:content,isVisibleInWindow:YES})}});function verifyItemViews(g,h,l,d){var j=g.get("nowShowing"),k=g.get("childViews");
if(d===undefined){d=""}if(l){ok(j.isEqual(SC.IndexSet.create(0,h.get("length"))),"%@ nowShowing (%@) should equal (0..%@)".fmt(d,j,h.get("length")-1))
}equals(k.get("length"),j.get("length"),"%@ view.childViews.length should match nowShowing.length".fmt(d));
var e=0;j.forEach(function(m){var n=k.objectAt(e),o=h.objectAt(m);ok(n,"childViews[%@] should have itemView".fmt(e));
if(n){equals(n.get("content"),o,"%@ childViews[%@].content should equal content[%@]".fmt(d,e,m))
}e++})}test("should only reload when isVisibleInWindow",function(){view.set("isVisibleInWindow",NO);
var d=view.getPath("childViews.length");SC.run(function(){view.reload()});equals(view.getPath("childViews.length"),d,"view.childViews.length should not change while offscreen");
SC.RunLoop.begin();view.set("isVisibleInWindow",YES);SC.RunLoop.end();equals(view.getPath("childViews.length"),content.get("length"),"view.childViews.length should change when moved onscreen if reload is pending")
});test("should automatically reload if content is set when collection view is first created",function(){ok(view.get("content"),"precond - should have content");
SC.RunLoop.begin();SC.RunLoop.end();verifyItemViews(view,content,YES)});test("reload(null) should generate item views for all items",function(){SC.RunLoop.begin();
view.reload();SC.RunLoop.end();verifyItemViews(view,content,YES)});test("reload(index set) should update item view for items in index only",function(){SC.run(function(){view.reload()
});var e=view.childViews[1],d=view.childViews[3];SC.run(function(){view.reload(SC.IndexSet.create(1).add(3))
});ok(e!==view.childViews[1],"view.childViews[1] should be new instance after view.reload(<1,3>) actual: %@ expected: %@".fmt(view.childViews[1],e));
ok(d!==view.childViews[3],"view.childViews[3] should be new instance after view.reload(<1,3>) actual: %@ expected: %@".fmt(view.childViews[3],d));
verifyItemViews(view,content,YES)});test("adding items to content should reload item views at end",function(){SC.run(function(){content.pushObject(SC.Object.create())
});verifyItemViews(view,content,YES)});test("removing items from content should remove item views",function(){SC.run(function(){content.popObject()
});verifyItemViews(view,content,YES)});test("remove and readd item",function(){var d=content.objectAt(0);
SC.run(function(){content.removeAt(0)});verifyItemViews(view,content,YES,"after content.removeAt(0)");
SC.run(function(){content.insertAt(0,d)});verifyItemViews(view,content,YES,"after content.insertAt(0,item)");
d=SC.Object.create();SC.run(function(){content.pushObject(d)});verifyItemViews(view,content,YES,"after content.pushObject(item)");
SC.run(function(){content.popObject()});verifyItemViews(view,content,YES,"after content.popObject(item)")
});test("reloading should only render nowShowing component",function(){var d=SC.IndexSet.create(0,2).add(6);
view=SC.CollectionView.create({content:content,computeNowShowing:function(){return d
},isVisibleInWindow:YES});SC.RunLoop.begin();view.reload();SC.RunLoop.end();same(view.get("nowShowing"),d,"precond - should have limited now showing");
equals(view.get("childViews").get("length"),d.get("length"),"should only render number of child views in IndexSet")
});var view;var content="1 2 3 4 5 6 7 8 9 10".w().map(function(d){return SC.Object.create({title:d})
});module("SC.CollectionView.select",{setup:function(){view=SC.CollectionView.create({content:content})
}});test("return value",function(){equals(view.select(3),view,"should return receiver")
});test("calling select(indexes=Number)",function(){view.select(3);var d=SC.SelectionSet.create().addObject(content.objectAt(3)),e=view.get("selection");
ok(d.isEqual(e),"selection should have object (expected: %@ actual: %@)".fmt(d,e))
});test("calling select(indexes=Number, extend=YES)",function(){var g=SC.SelectionSet.create().add(content,3,3),d=1,e=g.copy().addObject(content.objectAt(d)),h;
view.select(SC.IndexSet.create(3,3));h=view.get("selection");ok(g.isEqual(h),"precond - should have base selection (expected: %@ actual: %@)".fmt(e,h));
view.select(1,YES);h=view.get("selection");ok(e.isEqual(h),"selection should add set to existing selection (expected: %@ actual: %@)".fmt(e,h))
});test("calling select(indexes=SC.IndexSet)",function(){var d=SC.SelectionSet.create().add(content,3,3),e;
view.select(SC.IndexSet.create(3,3));e=view.get("selection");ok(d.isEqual(e),"selection should have passed index set only (expected: %@ actual: %@)".fmt(d,e))
});test("calling select(indexes=SC.IndexSet, extend=YES)",function(){var h=SC.SelectionSet.create().add(content,3,3),e=SC.SelectionSet.create().add(content,0,2),g=h.copy().add(content,0,2),j;
view.select(SC.IndexSet.create(3,3));j=view.get("selection");ok(h.isEqual(j),"precond - should have base selection (expected: %@ actual: %@)".fmt(h,j));
var d=SC.IndexSet.create(0,2);view.select(d,YES);j=view.get("selection");ok(g.isEqual(j),"selection should add set to existing selection (expected: %@ actual: %@)".fmt(g,j))
});test("calling select(indexes=null)",function(){view.select(SC.IndexSet.create(4,2));
view.select(null);var d=SC.SelectionSet.create(),e=view.get("selection");ok(d.isEqual(e),"selection should be empty (expected: %@ actual: %@)".fmt(d,e))
});var del;module("SC.CollectionView.select - delegate support",{setup:function(){del=SC.Object.create(SC.CollectionViewDelegate);
view=SC.CollectionView.create({delegate:del,content:content})}});test("should call delegate if set",function(){var e=0,d=0;
del.collectionViewShouldSelectIndexes=function(g,h,j){e++;return h};del.collectionViewSelectionForProposedSelection=function(g,h){d++;
return h};view.select(3);equals(e,1,"should invoke collectionViewShouldSelectIndexes on delegate 1x");
equals(d,1,"should invoke collectionViewSelectionForProposedSelection on delegate 1x if change is allowed")
});test("calling collectionViewSelectionForProposedSelection if collectionViewShouldSelectIndexes returns null",function(){var e=0,d=0;
del.collectionViewShouldSelectIndexes=function(g,h,j){e++;return null};del.collectionViewSelectionForProposedSelection=function(g,h){d++;
return h};view.select(3);equals(e,1,"should invoke collectionViewShouldSelectIndexes on delegate 1x");
equals(d,0,"should NOT invoke collectionViewSelectionForProposedSelection on delegate since no change was allowed")
});test("del.collectionViewShouldSelectIndexes - replacing selection",function(){del.collectionViewShouldSelectIndexes=function(g,h,j){return h.without(3)
};view.select(SC.IndexSet.create(0,4));var d=SC.SelectionSet.create().add(content,0,4).remove(content,3),e=view.get("selection");
ok(d.isEqual(e),"selection should only include those allowed by delegate (i.e. not index 3) (expected: %@ actual: %@)".fmt(d,e))
});test("del.collectionViewShouldSelectIndexes - extending selection",function(){del.collectionViewShouldSelectIndexes=function(g,h,j){return h.without(3)
};view.select(SC.IndexSet.create(0,4));view.select(SC.IndexSet.create(3,3),YES);var d=SC.SelectionSet.create().add(content,0,6).remove(content,3),e=view.get("selection");
ok(d.isEqual(e),"selection should extend only those allowed by delegate (i.e. not index 3) (expected: %@ actual: %@)".fmt(d,e))
});test("del.collectionViewShouldSelectIndexes - returns empty index set",function(){del.collectionViewShouldSelectIndexes=function(g,h,j){return h.without(3)
};view.select(2);view.select(3);var d=SC.SelectionSet.create().addObject(content.objectAt(2)),e=view.get("selection");
ok(d.isEqual(e),"selection should not change if delegate does not allow any proposed selected indexes (expected: %@ actual: %@)".fmt(d,e))
});test("del.collectionViewShouldSelectIndexes - delegate returns null",function(){view.select(2);
del.collectionViewShouldSelectIndexes=function(g,h,j){return null};view.select(10);
var d=SC.SelectionSet.create().addObject(content.objectAt(2)),e=view.get("selection");
ok(d.isEqual(e),"selection should not change if delegate returns null (expected: %@ actual: %@)".fmt(d,e))
});test("del.collectionViewSelectionForProposedSelection - returns indexes",function(){del.collectionViewSelectionForProposedSelection=function(g,h){var j=SC.SelectionSet.create().addObject(content.objectAt(10)),k=h;
ok(j.isEqual(k),"should pass proposed selection to delegate (expected: %@ actual: %@)".fmt(j,k));
equals(g,view,"should pass view to delegate");return SC.SelectionSet.create().add(content,10,20)
};view.select(10);var d=SC.SelectionSet.create().add(content,10,20),e=view.get("selection");
ok(d.isEqual(e),"should set selection to whatever is returned from delegate (expected: %@ actual: %@)".fmt(d,e))
});test("del.collectionViewSelectionForProposedSelection - returns null",function(){del.collectionViewSelectionForProposedSelection=function(g,h,j){return null
};view.select(10);var d=SC.SelectionSet.create(),e=view.get("selection");ok(d.isEqual(e),"should set selection to empty set if returns null (expected: %@ actual: %@)".fmt(d,e))
});var view;var content="1 2 3 4 5 6 7 8 9 10".w().map(function(d){return SC.Object.create({title:d})
});module("SC.CollectionView.selection",{setup:function(){view=SC.CollectionView.create({isVisibleInWindow:YES,content:content})
}});function verifySelection(l,d,h){var k=l.get("childViews"),g=k.get("length"),m,j,e,n;
if(!h){h=""}equals(g,l.get("nowShowing").get("length"),"%@ precond - must have childViews for each nowShowing".fmt(h));
for(m=0;m<g;m++){j=k[m];ok(!SC.none(j.contentIndex),"%@ precond - itemView[%@] must have contentIndex".fmt(h,m));
e=d.contains(j.contentIndex);n=j.get("isSelected");equals(n,e,"%@ itemView[%@].isSelected should match selection(%@)".fmt(h,m,d))
}}test("item views should have proper isSelected state on reload",function(){var d=SC.IndexSet.create(3,2).add(8),e=SC.SelectionSet.create().add(view.get("content"),d);
view.set("selection",e);SC.run(function(){view.reload()});verifySelection(view,d)
});test("item views should update isSelected state when selection property changes",function(){var d=SC.IndexSet.create(3,2),e=SC.IndexSet.create(8);
view.set("selection",SC.SelectionSet.create().add(view.content,d));SC.run(function(){view.reload()
});verifySelection(view,d,"before");SC.run(function(){view.set("selection",SC.SelectionSet.create().add(view.content,e))
});verifySelection(view,e,"after")});test("item views should not update isSelected state when old index set selection changes",function(){var d=SC.IndexSet.create(3,2),e=SC.IndexSet.create(8);
view.set("selection",SC.SelectionSet.create().add(view.content,d));SC.run(function(){view.reload()
});SC.run(function(){view.set("selection",SC.SelectionSet.create().add(view.content,e))
});verifySelection(view,e,"before");SC.run(function(){d.add(10).remove(8)});verifySelection(view,e,"after")
});test("item views should update isSelected state when selection index set is modified",function(){var e=SC.IndexSet.create(3,2),d=view.get("content"),g=SC.SelectionSet.create().add(d,e);
view.set("selection",g);SC.run(function(){view.reload()});verifySelection(view,e,"before");
SC.run(function(){g.add(d,8).remove(d,4)});verifySelection(view,SC.IndexSet.create(3).add(8),"after")
});test("reloading some items should still update selection properly",function(){var d=SC.IndexSet.create(3,2),e=SC.IndexSet.create(4,2).add(8);
view.set("selection",SC.SelectionSet.create().add(view.content,d));SC.run(function(){view.reload()
});SC.run(function(){view.reload(SC.IndexSet.create(4).add(8));view.set("selection",SC.SelectionSet.create().add(view.content,e))
});verifySelection(view,e,"after")});test("select() should round trip",function(){var d=SC.IndexSet.create(3,2);
SC.run(function(){view.reload()});SC.run(function(){view.select(d)});verifySelection(view,d)
});var view;var content="1 2 3 4 5 6 7 8 9 10".w().map(function(d){return SC.Object.create({title:d})
});module("SC.CollectionView.selectNextItem",{setup:function(){view=SC.CollectionView.create({content:content})
}});function selectionFromIndex(e){var d=SC.SelectionSet.create();d.addObject(content.objectAt(e));
return d}test("selectNextItem(extend=undefined, numberOfItems=undefined)",function(){var e=selectionFromIndex(4),d=selectionFromIndex(5),g;
view.set("selection",e);view.selectNextItem();g=view.get("selection");ok(d.isEqual(g),"should select next to %@ (expected: %@ actual: %@)".fmt(e,d,g))
});test("selectNextItem(extend=NO, numberOfItems=undefined)",function(){var e=selectionFromIndex(4),d=selectionFromIndex(5),g;
view.set("selection",e);view.selectNextItem(NO);g=view.get("selection");ok(d.isEqual(g),"should select next to %@ (expected: %@ actual: %@)".fmt(e,d,g))
});test("selectNextItem(extend=YES, numberOfItems=undefined)",function(){var e=selectionFromIndex(4),d=SC.SelectionSet.create().add(content,4,2),g;
view.set("selection",e);view.selectNextItem(YES);g=view.get("selection");ok(d.isEqual(g),"should extend to next of %@ (expected: %@ actual: %@)".fmt(e,d,g))
});test("selectNextItem(extend=YES, numberOfItems=2)",function(){var e=selectionFromIndex(4),d=SC.SelectionSet.create().add(content,4,3),g;
view.set("selection",e);view.selectNextItem(YES,2);g=view.get("selection");ok(d.isEqual(g),"should extend to next of %@ (expected: %@ actual: %@)".fmt(e,d,g))
});test("anchor test",function(){var e=SC.SelectionSet.create().add(content,5,3),d,g;
view.set("selection",e);view.selectNextItem(YES);d=SC.SelectionSet.create().add(content,5,4);
g=view.get("selection");ok(d.isEqual(g),"TRY 1: should extend end of selection (sel: %@ expected: %@ actual: %@)".fmt(e,d,g));
e=g;view.selectNextItem(YES);d=SC.SelectionSet.create().add(content,5,5);g=view.get("selection");
ok(d.isEqual(g),"TRY 2: should extend end of selection again (sel: %@ expected: %@ actual: %@)".fmt(e,d,g));
e=g;view.selectNextItem(YES);d=SC.SelectionSet.create().add(content,5,5);g=view.get("selection");
ok(d.isEqual(g),"TRY 3: should do nothing at end of selection (sel: %@ expected: %@ actual: %@)".fmt(e,d,g));
e=g;view.selectNextItem(YES);d=SC.SelectionSet.create().add(content,5,5);g=view.get("selection");
ok(d.isEqual(g),"TRY 4: multiple calls to extend when at end should do nothing (sel: %@ expected: %@ actual: %@)".fmt(e,d,g))
});test("anchor test 2 - anchor at end",function(){var e=SC.SelectionSet.create().add(content,4,4),d,g;
view.set("selection",e);view._selectionAnchor=7;view.selectNextItem(YES);d=SC.SelectionSet.create().add(content,5,3);
g=view.get("selection");ok(d.isEqual(g),"TRY 1: should reduce top of selection (sel: %@ expected: %@ actual: %@)".fmt(e,d,g));
e=g;view.selectNextItem(YES);d=SC.SelectionSet.create().add(content,6,2);g=view.get("selection");
ok(d.isEqual(g),"TRY 2: should further reduce top of selection again (sel: %@ expected: %@ actual: %@)".fmt(e,d,g));
e=g;view.selectNextItem(YES);d=selectionFromIndex(7);g=view.get("selection");ok(d.isEqual(g),"TRY 3: make selection one item long (sel: %@ expected: %@ actual: %@)".fmt(e,d,g));
e=g;view.selectNextItem(YES);d=SC.SelectionSet.create().add(content,7,2);g=view.get("selection");
ok(d.isEqual(g),"TRY 4: extend selection at end (sel: %@ expected: %@ actual: %@)".fmt(e,d,g));
e=g;view.selectNextItem(YES);d=SC.SelectionSet.create().add(content,7,3);g=view.get("selection");
ok(d.isEqual(g),"TRY 5: further extend selection at end (sel: %@ expected: %@ actual: %@)".fmt(e,d,g));
e=g;view.selectNextItem(YES);d=SC.SelectionSet.create().add(content,7,3);g=view.get("selection");
ok(d.isEqual(g),"TRY 6: do nothing because we are at end (sel: %@ expected: %@ actual: %@)".fmt(e,d,g));
e=g});test("selectNextItem() when selection is 9..9",function(){var e=selectionFromIndex(9),d=selectionFromIndex(9),g;
view.set("selection",e);view.selectNextItem();g=view.get("selection");ok(d.isEqual(g),"should should not change from previous of %@ (expected: %@ actual: %@)".fmt(e,d,g))
});test("selectNextItem(YES) when selection is 8..9",function(){var e=SC.SelectionSet.create().add(content,8,2),d=SC.SelectionSet.create().add(content,8,2),g;
view.set("selection",e);view._selectionAnchor=8;view.selectNextItem(YES);g=view.get("selection");
ok(d.isEqual(g),"should should not change from previous of %@ (expected: %@ actual: %@)".fmt(e,d,g))
});var view;var content="1 2 3 4 5 6 7 8 9 10".w().map(function(d){return SC.Object.create({title:d})
});module("SC.CollectionView.selectPreviousItem",{setup:function(){view=SC.CollectionView.create({content:content})
}});function selectionFromIndex(e){var d=SC.SelectionSet.create();d.addObject(content.objectAt(e));
return d}test("selectPreviousItem(extend=undefined, numberOfItems=undefined)",function(){var e=selectionFromIndex(4),d=selectionFromIndex(3),g;
view.set("selection",e);view.selectPreviousItem();g=view.get("selection");ok(d.isEqual(g),"should select previous to %@ (expected: %@ actual: %@)".fmt(e,d,g))
});test("selectPreviousItem(extend=NO, numberOfItems=undefined)",function(){var e=selectionFromIndex(4),d=selectionFromIndex(3),g;
view.set("selection",e);view.selectPreviousItem(NO);g=view.get("selection");ok(d.isEqual(g),"should select previous to %@ (expected: %@ actual: %@)".fmt(e,d,g))
});test("selectPreviousItem(extend=YES, numberOfItems=undefined)",function(){var e=selectionFromIndex(4),d=SC.SelectionSet.create().add(content,3,2),g;
view.set("selection",e);view.selectPreviousItem(YES);g=view.get("selection");ok(d.isEqual(g),"should extend to previous of %@ (expected: %@ actual: %@)".fmt(e,d,g))
});test("selectPreviousItem(extend=YES, numberOfItems=2)",function(){var e=selectionFromIndex(4),d=SC.SelectionSet.create().add(content,2,3),g;
view.set("selection",e);view.selectPreviousItem(YES,2);g=view.get("selection");ok(d.isEqual(g),"should extend to previous of %@ (expected: %@ actual: %@)".fmt(e,d,g))
});test("anchor test",function(){var e=SC.SelectionSet.create().add(content,2,3),d,g;
view.set("selection",e);view.selectPreviousItem(YES);d=SC.SelectionSet.create().add(content,2,2);
g=view.get("selection");ok(d.isEqual(g),"TRY 1: should reduce end of selection (sel: %@ expected: %@ actual: %@)".fmt(e,d,g));
e=g;view.selectPreviousItem(YES);d=selectionFromIndex(2);g=view.get("selection");
ok(d.isEqual(g),"TRY 2: should reduce end of selection again (sel: %@ expected: %@ actual: %@)".fmt(e,d,g));
e=g;view.selectPreviousItem(YES);d=SC.SelectionSet.create().add(content,1,2);g=view.get("selection");
ok(d.isEqual(g),"TRY 3: should extend selection at top (sel: %@ expected: %@ actual: %@)".fmt(e,d,g));
e=g;view.selectPreviousItem(YES);d=SC.SelectionSet.create().add(content,0,3);g=view.get("selection");
ok(d.isEqual(g),"TRY 4: should extend selection at top again (sel: %@ expected: %@ actual: %@)".fmt(e,d,g));
e=g;view.selectPreviousItem(YES);d=SC.SelectionSet.create().add(content,0,3);g=view.get("selection");
ok(d.isEqual(g),"TRY 5: selection it at top, cannot extend further (sel: %@ expected: %@ actual: %@)".fmt(e,d,g));
e=g;view.selectPreviousItem(YES);d=SC.SelectionSet.create().add(content,0,3);g=view.get("selection");
ok(d.isEqual(g),"TRY 6: multiple calls when already at top do nothing (sel: %@ expected: %@ actual: %@)".fmt(e,d,g));
e=g});test("anchor test 2",function(){var e=SC.SelectionSet.create().add(content,4,5),d,g;
view.set("selection",e);view.selectPreviousItem(YES);d=SC.SelectionSet.create().add(content,4,4);
g=view.get("selection");ok(d.isEqual(g),"TRY 1: should reduce end of selection (sel: %@ expected: %@ actual: %@)".fmt(e,d,g));
e=g;view.selectPreviousItem(YES);d=SC.SelectionSet.create().add(content,4,3);g=view.get("selection");
ok(d.isEqual(g),"TRY 2: should reduce end of selection again (sel: %@ expected: %@ actual: %@)".fmt(e,d,g));
e=g;view.selectPreviousItem(NO);d=selectionFromIndex(3);g=view.get("selection");ok(d.isEqual(g),"TRY 3: not extending clears selection and anchor (sel: %@ expected: %@ actual: %@)".fmt(e,d,g));
e=g;view.selectPreviousItem(YES);d=SC.SelectionSet.create().add(content,2,2);g=view.get("selection");
ok(d.isEqual(g),"TRY 4: should expand from top of new selection (sel: %@ expected: %@ actual: %@)".fmt(e,d,g));
e=g;view.selectPreviousItem(YES);d=SC.SelectionSet.create().add(content,1,3);g=view.get("selection");
ok(d.isEqual(g),"TRY 5: should further expand top (sel: %@ expected: %@ actual: %@)".fmt(e,d,g))
});test("selectPreviousItem() when selection is 0..0",function(){var e=selectionFromIndex(0),d=selectionFromIndex(0),g;
view.set("selection",e);view.selectPreviousItem();g=view.get("selection");ok(d.isEqual(g),"should should not change from previous of %@ (expected: %@ actual: %@)".fmt(e,d,g))
});test("selectPreviousItem(YES) when selection is 0..1",function(){var e=SC.SelectionSet.create().add(content,0,2),d=SC.SelectionSet.create().add(content,0,2),g;
view.set("selection",e);view._selectionAnchor=1;view.selectPreviousItem(YES);g=view.get("selection");
ok(d.isEqual(g),"should should not change from previous of %@ (expected: %@ actual: %@)".fmt(e,d,g))
});htmlbody(["<style>",".sc-collection-view { border: 1px black solid; background-color: white; }",".shape.sel { background-color: #f55; color: white; }",".shape { background-color: #ddd; border: 1px black solid; color: black; box-shadow: 3px 3px 5px #888; }",".shape label { position: absolute; left: 0; right: 0; height: 12px; margin-top: -6px; top: 50%; font-size: 11px; text-align: center; }","</style>"].join("\n"));
var ShapeView=SC.View.extend(SC.Control,{content:null,classNames:"shape",DIMENSION_KEYS:"x y width height".w(),contentPropertyDidChange:function(e,d){if(d==="*"){this.recomputeLayout();
this.displayDidChange()}else{if(d==="label"){this.displayDidChange()}else{if(this.DIMENSION_KEYS.indexOf(d)>=0){this.recomputeLayout()
}}}},recomputeLayout:function(){var e=this.get("content"),d;if(e){d={top:e.get("y"),left:e.get("x"),width:e.get("width"),height:e.get("height")}
}else{d={top:0,left:0,height:0,width:0}}this.set("layout",d)},render:function(e,g){var d=this.getPath("content.label");
e.push("<label>",d,"</label>")}});var content=[SC.Object.create({label:"Shape 1",x:10,y:10,width:100,height:50}),SC.Object.create({label:"Shape 2",x:50,y:50,width:65,height:200}),SC.Object.create({label:"Shape 3",x:100,y:80,width:200,height:72})];
var extra=SC.Object.create({label:"Extra Shape",x:70,y:70,width:40,height:50});var ShapeCanvasView=SC.CollectionView.extend({mouseDown:function(e){var d=arguments.callee.base.apply(this,arguments);
if(d){var g={x:e.pageX,y:e.pageY};this.mouseDownInfo.dragAnchor=this.convertFrameFromView(g,null)
}return d},mouseDragged:function(m){var g=this.mouseDownInfo,l=g.dragContent,h=g.dragAnchor,d=g.xpoints,j=g.ypoints,o,e,p,k,n;
if(!l){e=this.get("selection");k=this.get("content");if(k&&e&&e.get("length")>0){d=g.xpoints=[];
j=g.ypoints=[];l=g.dragContent=[];e.forEach(function(s){p=k.objectAt(s);if(!p){return
}l.push(p);d.push(p.get("x"));j.push(p.get("y"))},this);g.shouldReselect=NO}else{h=g.dragAnchor=null
}}if(!h){return arguments.callee.base.apply(this,arguments)}o=this.convertFrameFromView({x:m.pageX,y:m.pageY},null);
o.x-=h.x;o.y-=h.y;n=l.length;while(--n>=0){p=l[n];p.beginPropertyChanges().set("x",d[n]+o.x).set("y",j[n]+o.y).endPropertyChanges()
}return YES}});var pane=SC.ControlTestPane.design().add("basic",ShapeCanvasView,{layout:{top:0,left:0,right:0,height:300},content:content,exampleView:ShapeView,allowDeselectAll:YES});
pane.show();window.pane=pane;module("Basic Tests",pane.standardSetup());var pane,view0,view1,view2;
module("SC.DateFieldView",{setup:function(){SC.RunLoop.begin();pane=SC.MainPane.create({childViews:[SC.DateFieldView.extend({hint:"dd/mm/yyyy",value:SC.DateTime.create({day:1,month:1,year:2010})}),SC.DateFieldView.extend({hint:"dd/mm/yyyy hh:mm AM/PM",value:SC.DateTime.create({day:1,month:1,year:2010,hour:11,minute:20}),showTime:YES,isEnabled:NO}),SC.DateFieldView.extend({hint:"hh:mm AM/PM",value:SC.DateTime.create({hour:11,minute:20}),showDate:NO,showTime:YES})]});
pane.append();SC.RunLoop.end();view0=pane.childViews[0];view1=pane.childViews[1];
view2=pane.childViews[2]},teardown:function(){pane.remove();pane=view0=view1=view2=null
}});test("renders an text field input tag with appropriate attributes",function(){equals(view0.get("fieldValue"),"01/01/2010","Field value should be equal - Date Only");
equals(view1.get("fieldValue"),"01/01/2010 11:20 AM","Field value should be equal - Date & Time");
equals(view2.get("fieldValue"),"11:20 AM","Field value should be equal - Time Only");
equals(view0.get("isEnabled"),YES,"field enabled");equals(view1.get("isEnabled"),NO,"field not enabled");
var d=Q$("input",view0.get("layer"));equals(d.attr("type"),"text","should have type as text");
equals(d.attr("name"),view0.get("layerId"),"should have name as view_layerid")});
test("isEnabled=NO should add disabled class",function(){SC.RunLoop.begin();view0.set("isEnabled",NO);
SC.RunLoop.end();ok(view0.$().hasClass("disabled"),"should have disabled class")});
test("isEnabled and isEditable mapping",function(){var d=SC.DateFieldView.create();
d.set("isEnabled",false);equals(d.get("isEditable"),false);d.set("isEnabled",true);
equals(d.get("isEditable"),true)});(function(){var h=SC.ControlTestPane.design().add("empty",SC.DateFieldView,{hint:"dd/mm/yyyy",value:""}).add("with value",SC.DateFieldView,{hint:"dd/mm/yyyy",value:SC.DateTime.create({day:1,month:1,year:2010})}).add("disabled - empty",SC.DateFieldView,{hint:"dd/mm/yyyy",value:null,isEnabled:NO}).add("disabled - with value",SC.DateFieldView,{hint:"dd/mm/yyyy",value:SC.DateTime.create({day:1,month:1,year:2010}),isEnabled:NO}).add("date & time - empty",SC.DateFieldView,{hint:"dd/mm/yyyy hh:mm AM/PM",value:null,showTime:YES}).add("date & time - with value",SC.DateFieldView,{hint:"dd/mm/yyyy hh:mm AM/PM",value:SC.DateTime.create({day:1,month:1,year:2010,hour:10,minute:20}),showTime:YES}).add("time - disabled - empty",SC.DateFieldView,{hint:"hh:mm AM/PM",value:null,showTime:YES,showDate:NO,isEnabled:NO}).add("time - disabled - with value",SC.DateFieldView,{hint:"hh:mm AM/PM",value:SC.DateTime.create({hour:10,minute:20}),showTime:YES,showDate:NO,isEnabled:NO});
h.show();h.verifyEmpty=function d(j,m){var k=j.$("input");var l=j.$();ok(!l.hasClass("not-empty"),"layer should not have not-empty class");
equals(k.val(),"","input should have empty value");if(m){var n=j.$(".sc-hint");if(n.length===1){n=n.text()
}else{n=j.$("input");n=n.attr("placeholder")}equals(n,m,"hint span should have expected hint")
}};h.verifyNotEmpty=function g(j,l,n){var k=j.$("input");var m=j.$();ok(m.hasClass("not-empty"),"layer should have not-empty class");
equals(k.val(),l,"input should have value");if(n){var o=j.$(".sc-hint");if(o.length===1){o=o.text()
}else{o=j.$("input");o=o.attr("placeholder")}equals(o,n,"hint span should have expected hint")
}};h.verifyDisabled=function e(k,j){var m=k.$();var l=k.$("input");if(j){ok(m.hasClass("disabled"),"layer should have disabled class");
ok(l.attr("disabled"),"input should have disabled attr")}else{ok(!m.hasClass("disabled"),"layer should not have disabled class");
ok(!l.attr("disabled"),"input should not have disabled attr")}};module("SC.DateFieldView ui",h.standardSetup());
test("empty",function(){var j=h.view("empty");h.verifyEmpty(j,"dd/mm/yyyy");h.verifyDisabled(j,NO)
});test("with value",function(){var j=h.view("with value");h.verifyNotEmpty(j,"01/01/2010","dd/mm/yyyy");
h.verifyDisabled(j,NO)});test("disabled - empty",function(){var j=h.view("disabled - empty");
h.verifyEmpty(j,"dd/mm/yyyy");h.verifyDisabled(j,YES)});test("disabled - with value",function(){var j=h.view("disabled - with value");
h.verifyNotEmpty(j,"01/01/2010","dd/mm/yyyy");h.verifyDisabled(j,YES)});test("date & time - empty",function(){var j=h.view("date & time - empty");
h.verifyEmpty(j,"dd/mm/yyyy hh:mm AM/PM");h.verifyDisabled(j,NO)});test("date & time - with value",function(){var j=h.view("date & time - with value");
h.verifyNotEmpty(j,"01/01/2010 10:20 AM","dd/mm/yyyy hh:mm AM/PM");h.verifyDisabled(j,NO)
});test("time - disabled - empty",function(){var j=h.view("time - disabled - empty");
h.verifyEmpty(j,"hh:mm AM/PM");h.verifyDisabled(j,YES)});test("time - disabled - with value",function(){var j=h.view("time - disabled - with value");
h.verifyNotEmpty(j,"10:20 AM","hh:mm AM/PM");h.verifyDisabled(j,YES)});test("changing value from empty -> value",function(){var j=h.view("empty");
SC.RunLoop.begin();j.set("value",SC.DateTime.create({day:1,month:1,year:2010}));SC.RunLoop.end();
h.verifyNotEmpty(j,"01/01/2010","dd/mm/yyyy")});test("disabling view",function(){var j=h.view("empty");
SC.RunLoop.begin();j.set("isEnabled",NO);SC.RunLoop.end();h.verifyDisabled(j,YES)
});test("changing value to null",function(){var j=h.view("with value");SC.RunLoop.begin();
j.set("value",null);SC.RunLoop.end();equals(j.get("fieldValue"),null,"should have empty fieldValue");
h.verifyEmpty(j,"dd/mm/yyyy")});test("enabling disabled view",function(){var j=h.view("disabled - empty");
SC.RunLoop.begin();j.set("isEnabled",YES);SC.RunLoop.end();h.verifyDisabled(j,NO)
});test("Setting the selection to a null value should fail",function(){var j=h.view("with value");
var k=j.$input()[0];k.size=10;var l=null;try{j.set("selection",null)}catch(m){l=m
}ok(l.indexOf!==undefined,"an exception should have been thrown");if(l.indexOf!==undefined){ok(l.indexOf("must specify an SC.TextSelection instance")!==-1,"the exception should be about not specifying an SC.TextSelection instance")
}});test("Setting the selection to a non-SC.TextSelection value should fail",function(){var j=h.view("with value");
var k=j.$input()[0];k.size=10;var l=null;try{j.set("selection",{start:0,end:0})}catch(m){l=m
}ok(l.indexOf!==undefined,"an exception should have been thrown");if(l.indexOf!==undefined){ok(l.indexOf("must specify an SC.TextSelection instance")!==-1,"the exception should be about not specifying an SC.TextSelection instance")
}});test("Setting and then getting back the selection",function(){var k=h.view("with value");
var m=k.$input()[0];m.focus();m.size=10;var j=SC.TextSelection.create({start:2,end:5});
k.set("selection",j);var l=k.get("selection");ok(l.get("start")===2,"the selection should start at index 2");
ok(l.get("end")===5,"the selection should end at index 4");ok(l.get("length")===3,"the selection should have length 3")
});test("Adding left accessory view",function(){var j=h.view("with value");SC.RunLoop.begin();
var l=SC.View.create({layout:{top:1,left:2,width:16,height:16}});j.set("leftAccessoryView",l);
SC.RunLoop.end();ok(j.get("leftAccessoryView")===l,"left accessory view should be set to "+l.toString());
ok(j.get("childViews").length===1,"there should only be one child view");ok(j.get("childViews")[0]===l,"first child view should be set to "+l.toString());
var k=j.$(".padding")[0];ok(k.style.left==="18px","padding element should get 18px left");
SC.RunLoop.begin();j.set("leftAccessoryView",null);SC.RunLoop.end();ok(j.get("childViews").length===0,"after removing the left accessory view there should be no child views left");
ok(!k.style.left,"after removing the left accessory view the padding element should have no left style")
});test("Adding right accessory view",function(){var j=h.view("with value");SC.RunLoop.begin();
var l=SC.View.create({layout:{top:1,right:3,width:17,height:16}});j.set("rightAccessoryView",l);
SC.RunLoop.end();ok(j.get("rightAccessoryView")===l,"right accessory view should be set to "+l.toString());
ok(j.get("childViews").length===1,"there should only be one child view");ok(j.get("childViews")[0]===l,"first child view should be set to "+l.toString());
var k=j.$(".padding")[0];ok(k.style.right==="20px","padding element should get 20px right");
SC.RunLoop.begin();l=SC.View.create({layout:{top:1,left:2,width:16,height:16}});j.set("rightAccessoryView",l);
SC.RunLoop.end();ok(j.get("rightAccessoryView").get("layout").left===null,"right accessory view created with 'left' rather than 'right' in layout should have layout.left set to null");
ok(j.get("rightAccessoryView").get("layout").right===0,"right accessory view created with 'left' rather than 'right' in layout should have layout.right set to 0");
SC.RunLoop.begin();j.set("rightAccessoryView",null);SC.RunLoop.end();ok(j.get("childViews").length===0,"after removing the right accessory view there should be no child views left");
ok(!k.style.right,"after removing the right accessory view the padding element should have no right style")
});test("Adding both left and right accessory views",function(){var k=h.view("with value");
SC.RunLoop.begin();var l=SC.View.create({layout:{top:1,left:2,width:16,height:16}});
k.set("leftAccessoryView",l);var j=SC.View.create({layout:{top:1,right:3,width:17,height:16}});
k.set("rightAccessoryView",j);SC.RunLoop.end();ok(k.get("childViews").length===2,"we should have two child views since we added both a left and a right accessory view");
var m=k.$(".padding")[0];ok(m.style.left==="18px","padding element should get 18px left");
ok(m.style.right==="20px","padding element should get 20px right");SC.RunLoop.begin();
k.set("rightAccessoryView",null);SC.RunLoop.end();ok(k.get("childViews").length===1,"after removing the right accessory view there should be one child view left (the left accessory view)");
ok(!m.style.right,"after removing the right accessory view the padding element should have no right style");
SC.RunLoop.begin();k.set("leftAccessoryView",null);SC.RunLoop.end();ok(k.get("childViews").length===0,"after removing both accessory views there should be no child views left");
ok(!m.style.left,"after removing the left accessory view the padding element should have no left style")
})})();module("TODO: Test SC.DisclosureView Methods");(function(){var d=SC.ControlTestPane.design().add("diclosure",SC.DisclosureView,{value:NO,isEnabled:YES}).add("selected",SC.DisclosureView,{value:YES}).add("disabled",SC.DisclosureView,{isEnabled:NO}).add("selected - disabled",SC.DisclosureView,{value:YES,isEnabled:NO});
d.show();module("TODO: Test SC.DisclosureView UI",d.standardSetup());test("basic",function(){var e=d.view("diclosure");
ok(!e.$().hasClass("disabled"),"should not have disabled class");ok(!e.$().hasClass("sel"),"should not have sel class");
ok(!e.get("value"),"should not be opened")});test("selected",function(){var e=d.view("selected");
ok(!e.$().hasClass("disabled"),"should not have disabled class");ok(e.$().hasClass("sel"),"should have sel class");
ok(e.get("value"),"should be opened")});test("disabled",function(){var e=d.view("disabled");
ok(e.$().hasClass("disabled"),"should have disabled class");ok(!e.$().hasClass("sel"),"should not have sel class");
ok(!e.get("value"),"should not be opened")});test("disabled - selected",function(){var e=d.view("selected - disabled");
ok(e.$().hasClass("disabled"),"should have disabled class");ok(e.$().hasClass("sel"),"should have sel class");
ok(e.get("value"),"should be opened")})})();module("TODO: Test SC.GridView Methods");
module("TODO: Test SC.GridView UI");var view,content,pane;var renderFunc=CoreTest.stub("render",function(){SC.ListItemView.prototype.render.apply(this,arguments)
});module("SC.ListView.render",{setup:function(){SC.RunLoop.begin();content="1 2 3 4 5 6 7 8 9 10".w().map(function(d){return SC.Object.create({value:d})
});view=SC.ListView.create({content:content,layout:{top:0,left:0,width:300,height:500},layoutForContentIndex:function(d){return{left:0,right:0,top:d*50,height:50}
},didReload:CoreTest.stub("didReload"),_cv_isVisibleInWindowDidChange:CoreTest.stub("_cv_isVisibleInWindowDidChange",function(){SC.ListView.prototype._cv_isVisibleInWindowDidChange.apply(this,arguments)
}),_cv_nowShowingDidChange:CoreTest.stub("_cv_nowShowingDidChange",function(){SC.ListView.prototype._cv_nowShowingDidChange.apply(this,arguments)
}),exampleView:SC.ListItemView.extend({render:renderFunc}),reset:function(){this.didReload.reset();
this._cv_isVisibleInWindowDidChange.reset();this._cv_nowShowingDidChange.reset();
renderFunc.reset()}});pane=SC.MainPane.create();pane.appendChild(view);pane.append();
SC.RunLoop.end()},teardown:function(){SC.RunLoop.begin();pane.remove();SC.RunLoop.end();
view.reset()}});test("didReload() should only be called once with a static content array",function(){view.didReload.expect(1)
});test("_cv_isVisibleInWindowDidChange() should only be called once with a static content array",function(){view._cv_isVisibleInWindowDidChange.expect(1)
});test("list item render() should only be called once per item view a static content array",function(){renderFunc.expect(10)
});var view,del,content;module("SC.ListView.rowDelegate",{setup:function(){del=SC.Object.create(SC.CollectionRowDelegate);
content=SC.Object.create(SC.CollectionRowDelegate,SC.Array,SC.Freezable,{isFrozen:YES,length:0,objectAt:function(d){return undefined
}})}});test("no delegate and no content",function(){view=SC.ListView.create();equals(view.get("delegate"),null,"precond - delegate should be null");
equals(view.get("content"),null,"precond - content should be null");equals(view.get("rowDelegate"),view,"default row delegate should view")
});test("with no delegate and content not delegate",function(){var d=[];view=SC.ListView.create({content:d});
equals(view.get("delegate"),null,"precond - delegate should be null");ok(!view.get("content").isCollectionRowDelegate,"precond - content should not be CollectionRowDelegate");
equals(view.get("rowDelegate"),view,"default row delegate should view")});test("with no delegate and content is delegate",function(){view=SC.ListView.create({content:content});
equals(view.get("delegate"),null,"precond - delegate should be null");equals(view.get("content").isCollectionRowDelegate,YES,"precond - content should be CollectionRowDelegate");
equals(view.get("rowDelegate"),content,"row delegate should be content")});test("with delegate and content is delegate",function(){view=SC.ListView.create({delegate:del,content:content});
equals(view.get("delegate").isCollectionRowDelegate,YES,"precond - delegate should be CollectionRowDelegate");
equals(view.get("content").isCollectionRowDelegate,YES,"precond - content should be CollectionRowDelegate");
equals(view.get("rowDelegate"),del,"row delegate should be delegate")});test("modifying delegate and content",function(){var d=0;
view=SC.ListView.create();view.addObserver("rowDelegate",function(){d++});equals(view.get("delegate"),null,"precond - delegate should be null");
equals(view.get("content"),null,"precond - content should be null");equals(view.get("rowDelegate"),view,"default row delegate should view");
d=0;SC.run(function(){view.set("content",content)});ok(d>0,"rowDelegate should change when setting content");
equals(view.get("rowDelegate"),content,"rowDelegate should change after setting content");
d=0;SC.run(function(){view.set("delegate",del)});ok(d>0,"rowDelegate should change when setting delegate");
equals(view.get("rowDelegate"),del,"rowDelegate should change to delegate after setting delegate");
d=0;SC.run(function(){view.set("content",[])});ok(d>0,"rowDelegate should change when setting content");
equals(view.get("rowDelegate"),del,"rowDelegate should stay delegate as long as delegate remains");
d=0;SC.run(function(){view.set("delegate",null)});ok(d>0,"rowDelegate should change when setting delegate");
equals(view.get("rowDelegate"),view,"rowDelegate should go back to view when delegate and content cleared or dont implement")
});test("changing the rowHeight should invalidate all row heights",function(){var d=null;
view=SC.ListView.create({content:"1 2 3 4 5".w(),delegate:del,rowHeightDidChangeForIndexes:function(e){d=e
}});d=null;del.set("rowHeight",30);same(d,SC.IndexSet.create(0,5),"changing row height should call rowHeightDidChangeForIndexes(0..5)");
view.set("delegate",null);d=null;del.set("rowHeight",23);equals(d,null,"once delegate is removed changed rowHeight should not impact anything");
d=null;view.set("rowHeight",14);same(d,SC.IndexSet.create(0,5),"changing row height should call rowHeightDidChangeForIndexes(0..5)")
});test("changing the customRowHeightIndexes should invalidate impacted row heights",function(){var d=null;
view=SC.ListView.create({content:"1 2 3 4 5".w(),delegate:del,rowHeightDidChangeForIndexes:function(h){d=h
}});d=null;var g=SC.IndexSet.create(2,2);del.set("customRowHeightIndexes",g);same(d,g,"setting customRowHeightIndexes for first time should invalidate indexes only");
d=null;g.add(1,3);same(d,g,"modifying index set should invalidate all old and new indexes");
d=null;var e=SC.IndexSet.create(0,1);del.set("customRowHeightIndexes",e);same(d,g.copy().add(e),"setting new indexes should invalidate both old and new indexes");
d=null;del.set("customRowHeightIndexes",null);same(d,e,"setting indexes to null should invalidate old index set");
del.set("customRowHeightIndexes",e);d=null;view.set("delegate",null);same(d,e,"removing delegate should invalidate old index set");
d=null;del.set("customRowHeightIndexes",g);equals(d,null,"modifying delegate once removed should not change view")
});var content,delegate;var Delegate=SC.Object.extend(SC.CollectionRowDelegate,{rowHeight:40,customRowHeightIndexes:SC.IndexSet.create(3).add(5,2),contentIndexRowHeight:function(d,g,e){return this.get("customRowHeightIndexes").contains(e)?d.get("customRowHeight"):this.get("rowHeight")
},expected:function(d){var e=[],g=d.get("content"),h=d.get("length");while(--h>=0){e[h]=this.contentIndexRowHeight(d,g,h)
}return e}});module("SC.ListView.rowHeightForContentIndex",{setup:function(){content="1 2 3 4 5 6 7 8 9 0".w().map(function(d){return SC.Object.create({value:d})
},this);delegate=Delegate.create()}});function verifyRowHeights(d,g,e){var h=d.get("length"),j;
ok(h>0,"content should have some length");equals(d.rowHeightForContentIndex(h+1),g,"content.rowHeightForContentIndex(length+1) should be rowHeight");
while(--h>=0){j=d.rowHeightForContentIndex(h);if(e){equals(j,e[h],"content.rowHeightForContentIndex(%@) should be custom row height".fmt(h))
}else{equals(j,g,"content.rowHeightForContentIndex(%@) should be rowHeight".fmt(h))
}}}test("constant row heights",function(){var d=SC.ListView.create({content:content,rowHeight:40,customRowHeightIndexes:null});
verifyRowHeights(d,40)});test("constant row heights with rowSpacing",function(){var d=SC.ListView.create({content:content,rowHeight:40,rowSpacing:2,customRowHeightIndexes:null});
verifyRowHeights(d,40)});test("custom row heights",function(){var d=SC.ListView.create({content:content,customRowHeight:50,delegate:delegate});
verifyRowHeights(d,40,delegate.expected(d))});test("adding delegate should update calculation",function(){var d=SC.ListView.create({content:content,rowHeight:30,customRowHeight:50});
verifyRowHeights(d,30);d.set("delegate",delegate);verifyRowHeights(d,40,delegate.expected(d))
});test("changing delegate from custom to not custom should update",function(){var d=SC.ListView.create({content:content,rowHeight:30,customRowHeight:50,delegate:delegate});
verifyRowHeights(d,40,delegate.expected(d));delegate.set("customRowHeightIndexes",null);
verifyRowHeights(d,40)});test("computed custom row height indexes",function(){delegate=Delegate.create({indexes:Delegate.prototype.customRowHeightIndexes,useIndexes:NO,customRowHeightIndexes:function(){return this.get("useIndexes")?this.get("indexes"):null
}.property("useIndexes").cacheable()});var d=SC.ListView.create({content:content,rowHeight:15,customRowHeight:50,delegate:delegate});
verifyRowHeights(d,40);delegate.set("useIndexes",YES);verifyRowHeights(d,40,delegate.expected(d))
});var content,delegate;var Delegate=SC.Object.extend(SC.CollectionRowDelegate,{rowHeight:40,customRowHeightIndexes:SC.IndexSet.create(3).add(5,2),contentIndexRowHeight:function(d,g,e){return this.get("customRowHeightIndexes").contains(e)?d.get("customRowHeight"):this.get("rowHeight")
},expected:function(d){var e=[],g=d.get("content"),h=d.get("length");while(--h>=0){e[h]=this.contentIndexRowHeight(d,g,h)
}return e}});module("SC.ListView.rowOffsetForContentIndex",{setup:function(){content="1 2 3 4 5 6 7 8 9 0".w().map(function(d){return SC.Object.create({value:d})
},this);delegate=Delegate.create()}});function verifyRowOffsets(e,h,g){var k=e.get("length"),l,d,j=0;
for(d=0;d<k;d++){l=e.rowOffsetForContentIndex(d);equals(l,j,"content.rowHeightForContentIndex(%@) should be expected offset".fmt(d));
j+=g?g[d]:h}ok(k>0,"content should have some length");equals(e.rowOffsetForContentIndex(k),j,"content.rowHeightForContentIndex(length) should be rowHeight")
}test("constant row heights",function(){var d=SC.ListView.create({content:content,rowHeight:40,customRowHeightIndexes:null});
verifyRowOffsets(d,40)});test("constant row heights with rowSpacing",function(){var d=SC.ListView.create({content:content,rowHeight:40,rowSpacing:2,customRowHeightIndexes:null});
verifyRowOffsets(d,42)});test("custom row heights",function(){var d=SC.ListView.create({content:content,rowHeight:30,customRowHeight:50,delegate:delegate});
verifyRowOffsets(d,40,delegate.expected(d))});test("adding delegate should update calculation",function(){var d=SC.ListView.create({content:content,rowHeight:30,customRowHeight:50});
verifyRowOffsets(d,30);d.set("delegate",delegate);verifyRowOffsets(d,40,delegate.expected(d))
});test("changing delegate from custom to not custom should update",function(){var d=SC.ListView.create({content:content,rowHeight:12,customRowHeight:50,delegate:delegate});
verifyRowOffsets(d,40,delegate.expected(d));delegate.set("customRowHeightIndexes",null);
verifyRowOffsets(d,40)});test("computed custom row height indexes",function(){delegate=Delegate.create({indexes:Delegate.prototype.customRowHeightIndexes,useIndexes:NO,customRowHeightIndexes:function(){return this.get("useIndexes")?this.get("indexes"):null
}.property("useIndexes").cacheable()});var d=SC.ListView.create({content:content,rowHeight:12,customRowHeight:50,delegate:delegate});
verifyRowOffsets(d,40);delegate.set("useIndexes",YES);verifyRowOffsets(d,40,delegate.expected(d))
});module("SC.ListView - alternating rows");var ContentArray=SC.Object.extend(SC.Array,{length:0,objectAt:function(d){if(d>=this.get("length")){return undefined
}var g=this._content,e;if(!g){g=this._content=[]}e=g[d];if(!e){e=g[d]=SC.Object.create({title:"ContentItem %@".fmt(d)})
}return e}});var pane=SC.ControlTestPane.design().add("basic-even",SC.ScrollView.design({layout:{left:0,right:0,top:0,height:180},hasHorizontalScroller:NO,contentView:SC.ListView.design({content:ContentArray.create({length:10}),showAlternatingRows:YES,rowHeight:20})})).add("basic-odd",SC.ScrollView.design({layout:{left:0,right:0,top:0,height:180},hasHorizontalScroller:NO,contentView:SC.ListView.design({content:ContentArray.create({length:11}),showAlternatingRows:YES,rowHeight:20})}));
pane.show();window.pane=pane;function verifyClasses(e){var g=SC.IndexSet.create(0).addEach([2,4,6,8,10]);
var d=SC.IndexSet.create(1).addEach([3,5,7,9]);e.forEach(function(j){var k=j.$();
var h=j.get("contentIndex");if(g.contains(h)){ok(!k.hasClass("odd"),"item %@ doesn't have 'odd' CSS class".fmt(h));
ok(k.hasClass("even"),"item %@ has 'even' CSS class".fmt(h))}else{if(d.contains(h)){ok(k.hasClass("odd"),"item %@ has 'odd' CSS class".fmt(h));
ok(!k.hasClass("even"),"item %@ doesn't have 'even' CSS class".fmt(h))}}})}test("alternating class set on list view",function(){var d=pane.view("basic-even").contentView;
var e=d.$();ok(e.hasClass("alternating"),"ListView instance should have 'alternating' CSS class")
});test("even/odd classes on ListItemView children - even",function(){var d=pane.view("basic-even").contentView.childViews;
verifyClasses(d)});test("even/odd classes on ListItemView children - odd",function(){items=pane.view("basic-odd").contentView.childViews;
verifyClasses(items)});test("even/odd classes with incremental rendering - even",function(){var e=pane.view("basic-even"),d=e.contentView,g=d.childViews;
SC.run(function(){e.scrollTo(0,21)});verifyClasses(items);SC.run(function(){e.scrollTo(0,0)
});verifyClasses(items)});test("even/odd classes with incremental rendering - odd",function(){var e=pane.view("basic-odd"),d=e.contentView,g=d.childViews;
SC.run(function(){e.scrollTo(0,21)});verifyClasses(items);SC.run(function(){e.scrollTo(0,0)
});verifyClasses(items)});module("SC.ListView - outline list");var TreeItem=SC.Object.extend(SC.TreeItemContent,{length:10,title:"TREE ITEM",depth:0,treeItemChildren:function(){var d=[],g=this.get("length"),e=this.get("depth")+1;
if(e>3){g=g*3}while(--g>=0){d[g]=TreeItem.create({parent:this,unread:g,depth:e,treeItemIsExpanded:(e<2)})
}return d}.property().cacheable(),treeItemIsExpanded:YES,treeItemBranchIndexes:function(){return this.depth<3?SC.IndexSet.create(0,this.get("length")):null
}});var root=TreeItem.create({treeItemIsExpanded:YES});var del=SC.Object.create();
var pane=SC.ControlTestPane.design().add("basic",SC.ScrollView.design({layout:{left:0,right:0,top:0,height:300},hasHorizontalScroller:NO,contentView:SC.ListView.design({content:SC.TreeItemObserver.create({item:root,delegate:del}),contentValueKey:"title",contentCheckboxKey:"isDone",contentUnreadCountKey:"unread",rowHeight:20})}));
pane.show();window.pane=pane;var ContentArray=SC.Object.extend(SC.Array,{length:0,objectAt:function(d){if(d>=this.get("length")){return undefined
}var g=this._content,e;if(!g){g=this._content=[]}e=g[d];if(!e){e=g[d]=SC.Object.create({title:"ContentItem %@".fmt(d),isDone:(d%3)===0,unread:(Math.random()>0.5)?Math.floor(Math.random()*100):0})
}return e}});var pane=SC.ControlTestPane.design().add("Custom Row Heights",SC.ScrollView.design({layout:{left:0,right:0,top:0,height:200},hasHorizontalScroller:NO,contentView:SC.ListView.design({content:ContentArray.create({length:100001}),customRowHeightIndexes:SC.IndexSet.create(2,5).add(10000,100),adjustableRows:SC.IndexSet.create(0,5),altRowHeight:10,contentIndexRowHeight:function(d,h,g){var e=this.get("rowHeight");
if(!this.customRowHeightIndexes.contains(g)){return e}return this.adjustableRows.contains(g)?this.get("altRowHeight"):e*2
},contentValueKey:"title",contentCheckboxKey:"isDone",contentUnreadCountKey:"unread",rowHeight:20})}));
var pane2=SC.ControlTestPane.design().add("Custom Row Heights 2",SC.ScrollView.design({layout:{left:0,right:0,top:0,height:200},hasHorizontalScroller:NO,contentView:SC.ListView.design({content:ContentArray.create({length:100}),customRowHeightIndexes:SC.IndexSet.create(0,1000),contentIndexRowHeight:function(d,g,e){if(e%2===0){return 17
}else{return 48}},contentValueKey:"title",contentCheckboxKey:"isDone",contentUnreadCountKey:"unread",rowHeight:48})}));
pane.show();pane2.show();window.pane=pane;function verifyChildViewsMatch(d,g){var e=g.clone();
d.forEach(function(j){var h=j.contentIndex;if(e.contains(h)){ok(YES,"should find childView for contentIndex %@ (nowShowing=%@)".fmt(h,g))
}else{ok(NO,"should NOT find childView for contentIndex %@ (nowShowing=%@)".fmt(h,g))
}e.remove(h)},this);if(e.get("length")===0){ok(YES,"all nowShowing indexes should have matching child views")
}else{ok(NO,"all nowShowing indexes should have matching child views (indexes not found: %@)".fmt(e))
}}module("SC.ListView - ui_row_heights",pane.standardSetup());test("rendering only incremental portion",function(){var d=pane.view("Custom Row Heights").contentView;
same(d.get("nowShowing"),SC.IndexSet.create(0,10),"nowShowing should be smaller IndexSet");
equals(d.get("childViews").length,d.get("nowShowing").get("length"),"should have same number of childViews as nowShowing length")
});test("scrolling by small amount should update incremental rendering",function(){var e=pane.view("Custom Row Heights"),d=e.contentView,g;
same(d.get("nowShowing"),SC.IndexSet.create(0,10),"precond - nowShowing has incremental range");
SC.run(function(){e.scrollTo(0,61)});g=SC.IndexSet.create(4,9);same(d.get("nowShowing"),g,"nowShowing should change to reflect new clippingFrame");
verifyChildViewsMatch(d.childViews,g);SC.run(function(){e.scrollTo(0,83)});g=SC.IndexSet.create(5,9);
same(d.get("nowShowing"),g,"nowShowing should change to reflect new clippingFrame");
verifyChildViewsMatch(d.childViews,g);SC.run(function(){e.scrollTo(0,66)});g=SC.IndexSet.create(4,9);
same(d.get("nowShowing"),g,"nowShowing should change to reflect new clippingFrame");
verifyChildViewsMatch(d.childViews,g)});test("the 'nowShowing' property should be correct when scrolling",function(){var e=pane2.view("Custom Row Heights 2"),d=e.contentView,g=SC.IndexSet.create(1,7);
SC.run(function(){e.scrollTo(0,36)});same(d.get("nowShowing"),g,"nowShowing should %@".fmt(g))
});test("manually calling rowHeightDidChangeForIndexes()",function(){var g=pane.view("Custom Row Heights"),e=g.contentView,h;
same(e.get("nowShowing"),SC.IndexSet.create(0,10),"precond - nowShowing has incremental range");
SC.run(function(){e.set("altRowHeight",80);e.rowHeightDidChangeForIndexes(e.adjustableRows)
});same(e.get("nowShowing"),SC.IndexSet.create(0,4),"visible range should decrease since row heights for some rows doubled");
var d=e.itemViewForContentIndex(3);same(d.get("layout"),{top:120,left:0,right:0,height:80})
});module("SC.ListView - simple list");var ContentArray=SC.Object.extend(SC.Array,{length:0,objectAt:function(d){if(d>=this.get("length")){return undefined
}var g=this._content,e;if(!g){g=this._content=[]}e=g[d];if(!e){e=g[d]=SC.Object.create({title:"ContentItem %@".fmt(d),isDone:(d%3)===0,unread:(Math.random()>0.5)?Math.floor(Math.random()*100):0})
}return e}});var pane=SC.ControlTestPane.design().add("basic",SC.ScrollView.design({layout:{left:0,right:0,top:0,height:300},hasHorizontalScroller:NO,contentView:SC.ListView.design({content:ContentArray.create({length:20001}),contentValueKey:"title",contentCheckboxKey:"isDone",contentUnreadCountKey:"unread",rowHeight:20})}));
pane.show();window.pane=pane;function verifyChildViewsMatch(d,g){var e=g.clone();
d.forEach(function(j){var h=j.contentIndex;if(e.contains(h)){ok(YES,"should find childView for contentIndex %@ (nowShowing=%@)".fmt(h,g))
}else{ok(NO,"should NOT find childView for contentIndex %@ (nowShowing=%@)".fmt(h,g))
}e.remove(h)},this);if(e.get("length")===0){ok(YES,"all nowShowing indexes should have matching child views")
}else{ok(NO,"all nowShowing indexes should have matching child views (indexes not found: %@)".fmt(e))
}}test("rendering only incremental portion",function(){var d=pane.view("basic").contentView;
ok(d.getPath("nowShowing.length")<d.get("length"),"nowShowing should be a subset of content items");
equals(d.get("childViews").length,d.get("nowShowing").get("length"),"should have same number of childViews as nowShowing length")
});test("scrolling by small amount should update incremental rendering",function(){var e=pane.view("basic"),d=e.contentView,g;
ok(d.getPath("nowShowing.length")<d.get("length"),"precond - nowShowing has incremental range");
SC.run(function(){e.scrollTo(0,21)});g=SC.IndexSet.create(1,15);same(d.get("nowShowing"),g,"nowShowing should change to reflect new clippingFrame");
verifyChildViewsMatch(d.childViews,g);SC.run(function(){e.scrollTo(0,42)});g=SC.IndexSet.create(2,16);
same(d.get("nowShowing"),g,"nowShowing should change to reflect new clippingFrame");
verifyChildViewsMatch(d.childViews,g);SC.run(function(){e.scrollTo(0,21)});g=SC.IndexSet.create(1,15);
same(d.get("nowShowing"),g,"nowShowing should change to reflect new clippingFrame");
verifyChildViewsMatch(d.childViews,g)});var pane=SC.ControlTestPane.design({height:32}).add("basic",SC.ListItemView.design({content:"List Item"})).add("full",SC.ListItemView.design({content:SC.Object.create({icon:"sc-icon-folder-16",title:"List Item",checkbox:YES,count:23,branch:YES}),hasContentIcon:YES,hasContentBranch:YES,contentValueKey:"title",contentCheckboxKey:"checkbox",contentIconKey:"icon",contentUnreadCountKey:"count",contentIsBranchKey:"branch"})).add("full - sel",SC.ListItemView.design({content:SC.Object.create({icon:"sc-icon-folder-16",title:"List Item",checkbox:YES,count:23,branch:YES}),isSelected:YES,hasContentIcon:YES,hasContentBranch:YES,contentValueKey:"title",contentLeftActionKey:"checkbox",leftAction:"checkbox",contentRightActionKey:"isLoading",contentCheckboxKey:"checkbox",contentIconKey:"icon",contentUnreadCountKey:"count",contentIsBranchKey:"branch"})).add("icon",SC.ListItemView.design({content:SC.Object.create({title:"List Item",icon:"sc-icon-folder-16"}),contentValueKey:"title",contentIconKey:"icon",hasContentIcon:YES})).add("checkbox - YES",SC.ListItemView.design({content:SC.Object.create({title:"List Item",checkbox:YES}),contentValueKey:"title",contentCheckboxKey:"checkbox"})).add("checkbox - NO",SC.ListItemView.design({content:SC.Object.create({title:"List Item",checkbox:NO}),contentValueKey:"title",contentCheckboxKey:"checkbox"})).add("count - 0",SC.ListItemView.design({content:SC.Object.create({title:"List Item",count:0}),contentValueKey:"title",contentUnreadCountKey:"count"})).add("count - 10",SC.ListItemView.design({content:SC.Object.create({title:"List Item",count:10}),contentValueKey:"title",contentUnreadCountKey:"count"})).add("outline - 1",SC.ListItemView.design({content:SC.Object.create({title:"List Item"}),contentValueKey:"title",contentUnreadCountKey:"count",outlineLevel:1})).add("outline - 2",SC.ListItemView.design({content:SC.Object.create({title:"List Item"}),contentValueKey:"title",contentUnreadCountKey:"count",outlineLevel:2}));
pane.show();window.pane=pane;function basic(g,k,h){var j=g.$();ok(j.hasClass("sc-list-item-view"),"should have sc-list-item-view class");
equals(j.hasClass("sel"),!!k,"expect sel class");equals(j.hasClass("disabled"),!!h,"expect disabled class");
var e=g.get("contentIndex");var d=(e%2==0)?"even":"odd";ok(j.hasClass(d),"should have an %@ class".fmt(d))
}function label(d,e){if(e===null){equals(d.$("label").size(),0,"should not have label")
}else{equals(d.$("label").text(),e,"should have label text")}}function icon(d,e){if(e===null){equals(d.$("img.icon").size(),0,"should not have image")
}else{var g=d.$("img.icon");equals(g.size(),1,"should have icon");ok(g.hasClass(e),"icon should have class name %@".fmt(e))
}}function checkbox(d,g){if(g===null){equals(d.$(".sc-checkbox-view").size(),0,"should not have checkbox")
}else{var e=d.$(".sc-checkbox-view");equals(e.size(),1,"should have checkbox element");
equals(e.hasClass("sel"),g===true,"expects sel class");equals(e.hasClass("mixed"),g===SC.MIXED_STATE,"expects mixed class")
}}function count(d,e){if(e===null){equals(d.$(".count").size(),0,"should not have count")
}else{var g=d.$(".count");equals(g.size(),1,"should have count");equals(g.text(),e.toString(),"should have count")
}}function branch(d,g){if(g===null){equals(d.$(".branch").size(),0,"should not have branch")
}else{var e=d.$(".branch");equals(e.size(),1,"should have branch");equals(e.hasClass("branch-visible"),g,"is visible")
}}module("SC.ListItemView UI",pane.standardSetup());test("basic",function(){var d=pane.view("basic");
basic(d,NO,NO);icon(d,null);label(d,"List Item");checkbox(d,null);count(d,null);branch(d,null)
});test("full",function(){var d=pane.view("full");basic(d,NO,NO);icon(d,"sc-icon-folder-16");
label(d,"List Item");checkbox(d,YES);count(d,23);branch(d,YES)});test("full - sel",function(){var d=pane.view("full - sel");
basic(d,YES,NO);icon(d,"sc-icon-folder-16");label(d,"List Item");checkbox(d,YES);
count(d,23);branch(d,YES)});test("icon",function(){var d=pane.view("icon");icon(d,"sc-icon-folder-16")
});test("checkbox",function(){checkbox(pane.view("checkbox - YES"),YES);checkbox(pane.view("checkbox - NO"),NO)
});test("count",function(){count(pane.view("count - 0"),null);count(pane.view("count - 10"),10)
});test("outline - 1",function(){var e=pane.view("outline - 1"),d=e.get("outlineIndent");
ok(d>0,"precond - outlineIndent property should be > 0 (actual: %@)".fmt(d));equals(e.$(".sc-outline").css("left"),d*1+16+"px","sc-outline div should be offset by outline ammount")
});test("outline - 2",function(){var e=pane.view("outline - 2"),d=e.get("outlineIndent");
ok(d>0,"precond - outlineIndent property should be > 0 (actual: %@)".fmt(d));equals(e.$(".sc-outline").css("left"),d*2+16+"px","sc-outline div should be offset by outline ammount")
});function adjustContent(d,e,h){var g=d.get("content");SC.RunLoop.begin();g.set(e,h);
SC.RunLoop.end()}test("changing label should change display",function(){var d=pane.view("full");
adjustContent(d,"title","FOO");label(d,"FOO")});test("changing checkbox value should update display",function(){var d=pane.view("full");
adjustContent(d,"checkbox",NO);checkbox(d,NO)});test("changing count value should update display",function(){var d=pane.view("full");
adjustContent(d,"count",100);count(d,100);adjustContent(d,"count",0);count(d,null)
});module("TODO: Test SC.MenuItemView Methods");var pane,menu,callCount=0;module("SC.MenuItemView",{setup:function(){pane=SC.MainPane.create({layout:{width:100,height:20,centerX:0,centerY:0},childViews:"button".w(),button:SC.ButtonView.design({menuItemAction:function(){callCount+=1
}})}).append();pane.makeFirstResponder(pane.button);menu=SC.MenuPane.create({items:[{title:"Send Action",action:"menuItemAction"}]});
menu.popup(pane.anchor)},teardown:function(){pane.remove();menu.remove();pane=menu=null
}});test("Sending an action with no target",function(){var d=menu.get("menuItemViews")[0];
d.sendAction();equals(callCount,1,"firstResponder of main pane should be called")
});htmlbody("<style> .sc-static-layout { border: 1px red dotted; } </style>");(function(){var d=SC.ControlTestPane.design().add("progress basic",SC.ProgressView,{layout:{top:0,bottom:0,left:0,width:250},value:25,minimum:0,maximum:100}).add("progress disabled",SC.ProgressView,{layout:{top:0,bottom:0,left:0,width:250},value:25,minimum:0,maximum:100,isEnabled:NO}).add("progress basic value 0",SC.ProgressView,{layout:{top:0,bottom:0,left:0,width:250},value:0,minimum:0,maximum:100}).add("progress basic value 100",SC.ProgressView,{layout:{top:0,bottom:0,left:0,width:250},value:100,minimum:0,maximum:100}).add("progress basic max 50",SC.ProgressView,{layout:{top:0,bottom:0,left:0,width:250},value:25,minimum:0,maximum:50}).add("slider basic",SC.SliderView,{layout:{top:0,bottom:0,left:0,width:250},value:50,minimum:0,maximum:100}).add("slider disabled",SC.SliderView,{layout:{top:0,bottom:0,left:0,width:250},value:50,minimum:0,maximum:100,isEnabled:NO}).add("slider value 100",SC.SliderView,{layout:{top:0,bottom:0,left:0,width:250},value:100,minimum:0,maximum:100}).add("slider basic step 20",SC.SliderView,{layout:{top:0,bottom:0,left:0,width:250},value:50,minimum:0,maximum:100,step:20});
d.show();module("SC.ProgressView UI");test("basic",function(){var e=d.view("progress basic");
ok(!e.$().hasClass("disabled"),"should NOT have disabled class");ok(e.$(".sc-inner"),"should have sc-inner class");
ok(e.$(".sc-outer-head"),"should have sc-outer-head class");ok(e.$(".sc-outer-tail"),"should have sc-outer-tail class");
ok(e.$(".sc-inner-head"),"should have sc-inner-head class");ok(e.$(".sc-inner-tail"),"should have sc-inner-tail class");
equals(e.$(".sc-inner").css("width"),"25%","width should be 25%");var g=(SC.browser.msie||SC.browser.mozilla)?63:62;
equals(e.$(".sc-inner").width(),g,"pixel width ")});test("disabled",function(){var e=d.view("progress disabled");
ok(e.$().hasClass("disabled"),"should have disabled class");ok(e.$(".sc-inner"),"should have sc-inner class");
equals(e.$(".sc-inner").css("width"),"0%","width should be 0%");equals(e.$(".sc-inner").width(),0,"pixel width ")
});test("basic value 0",function(){var e=d.view("progress basic value 0");ok(!e.$().hasClass("disabled"),"should NOT have disabled class");
ok(e.$(".sc-inner"),"should have sc-inner class");equals(e.$(".sc-inner").css("width"),"0%","width should be 0%");
equals(e.$(".sc-inner").width(),0,"pixel width ")});test("basic value 100",function(){var e=d.view("progress basic value 100");
ok(!e.$().hasClass("disabled"),"should NOT have disabled class");ok(e.$(".sc-inner"),"should have sc-inner class");
equals(e.$(".sc-inner").css("width"),"100%","width should be 100%");equals(e.$(".sc-inner").width(),250,"pixel width ")
});test("basic max 50",function(){var e=d.view("progress basic max 50");ok(!e.$().hasClass("disabled"),"should NOT have disabled class");
ok(e.$(".sc-inner"),"should have sc-inner class");equals(e.$(".sc-inner").css("width"),"50%","width should be 50%");
equals(e.$(".sc-inner").width(),125,"pixel width ")});test("changing value from empty -> value",function(){var e=d.view("progress basic value 0");
equals(e.$(".sc-inner").width(),0,"precon - pixel width should be 0");SC.RunLoop.begin();
e.set("value",50);SC.RunLoop.end();equals(e.$(".sc-inner").css("width"),"50%","width should be 50%");
equals(e.$(".sc-inner").width(),125,"pixel width ")});test("changing value from full -> empty",function(){var e=d.view("progress basic value 100");
equals(e.$(".sc-inner").width(),250,"precon - pixel width should be 316");SC.RunLoop.begin();
e.set("value",0);SC.RunLoop.end();equals(e.$(".sc-inner").css("width"),"0%","width should be 0%");
equals(e.$(".sc-inner").width(),0,"pixel width ")});test("changing value from full -> negative number",function(){var e=d.view("progress basic value 100");
SC.RunLoop.begin();e.set("value",100);SC.RunLoop.end();equals(e.$(".sc-inner").width(),250,"precon - pixel width should be 338");
SC.RunLoop.begin();e.set("value",-10);SC.RunLoop.end();equals(e.$(".sc-inner").css("width"),"0%","width should be 0%");
equals(e.$(".sc-inner").width(),0,"pixel width ")});test("changing value to over maximum",function(){var e=d.view("progress basic");
var g=(SC.browser.msie||SC.browser.mozilla)?63:62;equals(e.$(".sc-inner").width(),g,"precon - pixel width should be fixed");
SC.RunLoop.begin();e.set("value",110);SC.RunLoop.end();equals(e.$(".sc-inner").css("width"),"100%","width should be 100%");
equals(e.$(".sc-inner").width(),250,"pixel width ")});test("changing value to a string",function(){var e=d.view("progress basic");
SC.RunLoop.begin();e.set("value",25);SC.RunLoop.end();var g=(SC.browser.msie||SC.browser.mozilla)?63:62;
equals(e.$(".sc-inner").width(),g,"precon - pixel width should be fixed");SC.RunLoop.begin();
e.set("value","aString");SC.RunLoop.end();equals(e.$(".sc-inner").css("width"),"0%","width should be 0%");
equals(e.$(".sc-inner").width(),0,"pixel width ")});module("SC.SliderView UI");test("basic",function(){var e=d.view("slider basic");
ok(!e.$().hasClass("disabled"),"should NOT have disabled class");ok(e.$(".sc-inner"),"should have sc-inner class");
ok(e.$(".sc-handle"),"should have sc-handle class");equals(e.$(".sc-handle").css("left"),"50%","left of sc-handle should be 50%")
});test("disabled",function(){var e=d.view("slider disabled");ok(e.$().hasClass("disabled"),"should have disabled class");
ok(e.$(".sc-inner"),"should have sc-inner class");ok(e.$(".sc-handle"),"should have sc-handle class");
equals(e.$(".sc-handle").css("left"),"50%","left of sc-handle should be 50%")});test("basic value 100",function(){var e=d.view("slider value 100");
ok(!e.$().hasClass("disabled"),"should have disabled class");ok(e.$(".sc-inner"),"should have sc-inner class");
ok(e.$(".sc-handle"),"should have sc-handle class");equals(e.$(".sc-handle").css("left"),"100%","left of sc-handle should be 100%")
});test("basic step 20",function(){var e=d.view("slider basic step 20");ok(!e.$().hasClass("disabled"),"should have disabled class");
ok(e.$(".sc-inner"),"should have sc-inner class");ok(e.$(".sc-handle"),"should have sc-handle class");
equals(e.$(".sc-handle").css("left"),"60%","left of sc-handle should be 60%")})})();
var pane,view;module("SC.RadioView Logic",{setup:function(){SC.RunLoop.begin();pane=SC.MainPane.create({childViews:[SC.RadioView.extend({layout:{right:20,bottom:20,width:100,height:23},items:"Red Green".w(),value:"Red",isEnabled:YES})]});
pane.append();SC.RunLoop.end();view=pane.childViews[0]},teardown:function(){pane.remove();
pane=view=null}});test("renders an input tag with appropriate attributes",function(){equals(view.get("value"),"Red","precon - value should be YES");
var d=view.$();equals(d.attr("role"),"radiogroup","should have role=radio");var e=view.$(".sc-radio-button");
equals(SC.$(e[0]).attr("aria-checked"),"true","should be checked")});test("changing the value should update the group",function(){var d=view.get("value");
SC.RunLoop.begin();view.set("value","Green");SC.RunLoop.end();ok(view.get("value")!==d,"precond - should have changed value");
var e=Q$(".sel > span",view.get("layer"));equals(e.text(),view.get("value"),"label should have new value")
});test("isEnabled should alter group classname and sync with isEnabled property",function(){ok(view.get("isEnabled"),"isEnabled should match value");
ok(!view.$().hasClass("disabled"),"should NOT have disabled class");SC.RunLoop.begin();
view.set("isEnabled",0);SC.RunLoop.end();ok(!view.get("isEnabled"),"isEnabled should now be NO");
ok(view.$().hasClass("disabled"),"should have disabled class");SC.RunLoop.begin();
view.set("isEnabled",YES);SC.RunLoop.end();ok(view.get("isEnabled"),"isEnabled should match value");
ok(!view.$().hasClass("disabled"),"should NOT have disabled class")});test("clicking on a radio button will change toggle the value",function(){equals(view.get("value"),"Red","precond - value should be Red");
var d=view.$(".sc-radio-button");SC.Event.trigger(d[1],"mousedown");SC.Event.trigger(d[1],"mouseup");
equals(view.get("value"),"Green","value should have changed")});test("pressing mouseDown and then mouseUp anywhere in a radio button should toggle the selection",function(){var e=view.get("layer"),d=view.$(".sc-radio-button");
SC.Event.trigger(d[0],"mousedown");equals(view.get("value"),"Red","value should not change yet");
ok(d.first().hasClass("active"),"radio button should be active");SC.Event.trigger(d[0],"mouseup");
SC.Event.trigger(d[1],"mousedown");SC.Event.trigger(d[1],"mouseup");ok(!d.first().hasClass("active"),"radio button should no longer be active");
equals(view.get("value"),"Green","value should be undefined (none checked)");e=null
});test("isEnabled=NO should add disabled attr to input",function(){SC.RunLoop.begin();
view.set("isEnabled",NO);SC.RunLoop.end();ok(view.$().hasClass("disabled"),"should have disabled attr");
ok(view.get("value"),"precond - value should be true");view.mouseDown();view.mouseUp();
ok(view.get("value"),"value should not change when clicked")});htmlbody("<style> .sc-static-layout { border: 1px red dotted; } </style>");
var itemList=[{title:"Red",value:"red",enabled:YES},{title:"Green",value:"green"},{title:"Blue",value:"blue"}];
var pane=SC.ControlTestPane.design().add("basic",SC.RadioView,{value:"",isEnabled:YES,items:itemList,itemTitleKey:"title",itemValueKey:"value",layoutDirection:SC.LAYOUT_HORIZONTAL}).add("checked",SC.RadioView,{value:"red",isEnabled:YES,items:itemList,itemTitleKey:"title",itemValueKey:"value",layoutDirection:SC.LAYOUT_HORIZONTAL}).add("disabled",SC.RadioView,{value:"",isEnabled:NO,items:itemList,itemTitleKey:"title",itemValueKey:"value",layoutDirection:SC.LAYOUT_HORIZONTAL}).add("enabled first",SC.RadioView,{value:"",isEnabled:YES,items:itemList,itemTitleKey:"title",itemValueKey:"value",itemIsEnabledKey:"enabled",layoutDirection:SC.LAYOUT_HORIZONTAL}).add("horizontal",SC.RadioView,{value:"",isEnabled:YES,items:"Yes No".w(),layoutDirection:SC.LAYOUT_HORIZONTAL});
pane.show();module("SC.RadioView UI");test("basic",function(){var e=pane.view("basic");
ok(!e.$().hasClass("disabled"),"should not have disabled class");var h=e.$(".sc-radio-button");
equals(h.length,3,"number of radio buttons should be 3");var g=0;h.forEach(function(n){var m=SC.$(n),k=parseInt(m.attr("index"),0),l=m.attr("value");
equals(k,g,"radio button #%@ should have field value %@".fmt(k,g));equals(m.attr("aria-checked"),"false","radio button #%@ should not be checked".fmt(k));
ok(!m.hasClass("disabled"),"radio button #%@ should not be disabled".fmt(k));g++});
var j=e.$("span.sc-button-label");equals(j.length,3,"number of labels should be 3");
var d=0;j.forEach(function(k){equals(k.innerHTML,itemList[d].title,"radio button #%@ should have original label".fmt(d));
d++})});test("checked",function(){var e=pane.view("checked");ok(!e.$().hasClass("disabled"),"should not have disabled class");
var h=e.$(".sc-radio-button");equals(h.length,3,"number of radio buttons should be 3");
var g=0;h.forEach(function(n){var m=SC.$(n),k=parseInt(m.attr("index"),0),l=m.attr("value");
equals(k,g,"radio button #%@ should have field value %@".fmt(k,g));if(k===0){equals(m.attr("aria-checked"),"true","radio button #%@ should be checked".fmt(k))
}else{equals(m.attr("aria-checked"),"false","radio button #%@ should not be checked".fmt(k))
}ok(!m.hasClass("disabled"),"radio button #%@ should not be disabled".fmt(k));g++
});var j=e.$("span.sc-button-label");equals(j.length,3,"number of labels should be 3");
var d=0;j.forEach(function(k){equals(k.innerHTML,itemList[d].title,"radio button #%@ should have original label".fmt(d));
d++})});test("disabled",function(){var e=pane.view("disabled");ok(e.$().hasClass("disabled"),"should have disabled class");
var h=e.$(".sc-radio-button");equals(h.length,3,"number of radio buttons should be 3");
var g=0;h.forEach(function(n){var m=SC.$(n),k=parseInt(m.attr("index"),0),l=m.attr("value");
equals(k,g,"radio button #%@ should have field value %@".fmt(k,g));equals(m.attr("aria-checked"),"false","radio button #%@ should not be checked".fmt(k));
ok(!m.hasClass("disabled"),"radio button #%@ should be disabled".fmt(k));g++});var j=e.$("span.sc-button-label");
equals(j.length,3,"number of labels should be 3");var d=0;j.forEach(function(k){equals(k.innerHTML,itemList[d].title,"radio button #%@ should have original label".fmt(d));
d++})});test("enabled first",function(){var e=pane.view("enabled first");ok(!e.$().hasClass("disabled"),"should not have disabled class");
var h=e.$(".sc-radio-button");equals(h.length,3,"number of radio buttons should be 3");
SC.RunLoop.begin();e.set("isEnabled",NO);SC.RunLoop.end();var g=0;h.forEach(function(n){var m=SC.$(n),k=parseInt(m.attr("index"),0),l=m.attr("value");
equals(k,g,"radio button #%@ should have field value %@".fmt(k,g));ok(m.attr("aria-checked"),"false","radio button #%@ should not be checked".fmt(k));
g++});ok(e.$().hasClass("disabled"),"should have disabled class");var j=e.$("span.sc-button-label");
equals(j.length,3,"number of labels should be 3");var d=0;j.forEach(function(k){equals(k.innerHTML,itemList[d].title,"radio button #%@ should have original label".fmt(d));
d++})});var pane,view,view2;var appleURL="http://photos4.meetupstatic.com/photos/event/4/6/9/9/600_4518073.jpeg";
module("SC.ScrollView",{setup:function(){SC.RunLoop.begin();pane=SC.MainPane.create({childViews:[SC.ScrollView.extend({contentView:SC.ImageView.design({value:appleURL,layout:{height:4000,width:4000}})}),SC.ScrollView.extend({contentView:SC.ImageView.design({value:appleURL,layout:{height:2000,width:2000}})})],expectedVertLine:function(d){var e=view.get("verticalLineScroll")*d;
var g=view.get("maximumVerticalScrollOffset");e=(e>g)?g:e;return e},expectedHorzLine:function(d){var e=view.get("horizontalLineScroll")*d;
var g=view.get("maximumHorizontalScrollOffset");e=(e>g)?g:e;return e},expectedVertPage:function(e){var d=view.get("verticalPageScroll")*e;
var g=view.get("maximumVerticalScrollOffset");d=(d>g)?g:d;return d},expectedHorzPage:function(e){var d=view.get("horizontalPageScroll")*e;
var g=view.get("maximumHorizontalScrollOffset");d=(d>g)?g:d;return d}});pane.append();
SC.RunLoop.end();view=pane.childViews[0];view.get("containerView").get("frame").height=100;
view.get("containerView").get("frame").width=100;view2=pane.childViews[1];view2.get("containerView").get("frame").height=100;
view2.get("containerView").get("frame").width=100},teardown:function(){pane.remove();
pane=view=null}});test("Scrolling to a certain co-ordinate of the container view",function(){equals(view.get("horizontalScrollOffset"),0,"Initial horizontal offset must be zero");
equals(view.get("verticalScrollOffset"),0,"Initial vertical offset must be zero");
SC.RunLoop.begin();view.scrollTo(100,100);SC.RunLoop.end();equals(view.get("horizontalScrollOffset"),100,"After scrolling to 100, horizontal offset must be");
equals(view.get("verticalScrollOffset"),100,"After scrolling to 100, vertical offset must be");
view.scrollTo(5000,5000);equals(view.get("horizontalScrollOffset"),view.get("maximumHorizontalScrollOffset"),"After scrolling to 400, horizontal offset must be maximum");
equals(view.get("verticalScrollOffset"),view.get("maximumVerticalScrollOffset"),"After scrolling to 400, vertical offset must be maximum")
});test("Scrolling relative to the current possition of the container view",function(){equals(view.get("horizontalScrollOffset"),0,"Initial horizontal offset must be zero");
equals(view.get("verticalScrollOffset"),0,"Initial vertical offset must be zero");
view.scrollBy(100,100);equals(view.get("horizontalScrollOffset"),100,"After scrolling by 100, horizontal offset must be");
equals(view.get("verticalScrollOffset"),100,"After scrolling by 100, vertical offset must be");
view.scrollBy(100,100);equals(view.get("horizontalScrollOffset"),200,"After scrolling by 100, horizontal offset must be");
equals(view.get("verticalScrollOffset"),200,"After scrolling by 100, vertical offset must be");
view.scrollBy(5000,5000);equals(view.get("horizontalScrollOffset"),view.get("maximumHorizontalScrollOffset"),"After scrolling by 400, horizontal offset must be maximum");
equals(view.get("verticalScrollOffset"),view.get("maximumVerticalScrollOffset"),"After scrolling by 400, vertical offset must be maximum")
});test("Scrolling through line by line",function(){var d=3;equals(view.get("horizontalScrollOffset"),0,"Initial horizontal offset must be zero");
equals(view.get("verticalScrollOffset"),0,"Initial vertical offset must be zero");
view.scrollDownLine(d);equals(view.get("horizontalScrollOffset"),0,"After scrolling down by lines, horizontal offset is unchanged");
equals(view.get("verticalScrollOffset"),pane.expectedVertLine(d),"After scrolling down by lines, vertical offset must be");
view.scrollUpLine(d)});test("maximumHorizontalScrollOffset() returns the maximum horizontal scroll dimention",function(){var d=2;
var e=2;view2.set("horizontalScrollOffset",d);view2.set("verticalScrollOffset",e);
view2.scrollBy(5000,0);view2.get("horizontalScrollOffset");equals(view2.get("horizontalScrollOffset"),1900,"maximum y coordinate should be 1900");
view2.set("horizontalScrollOffset",d);view2.set("verticalScrollOffset",e);view2.scrollBy(-5000,0);
equals(view2.get("horizontalScrollOffset"),0,"minimum y coordinate should be 0")});
test("maximumVerticalScrollOffset() returns the maximum vertical scroll dimention",function(){var d=2;
var e=2;view2.set("horizontalScrollOffset",d);view2.set("verticalScrollOffset",e);
view2.scrollBy(0,5000);view2.get("maximumVerticalScrollOffset");equals(view2.get("verticalScrollOffset"),1900,"maximum coordinate should be 1900");
view2.set("horizontalScrollOffset",d);view2.set("verticalScrollOffset",e);view2.scrollBy(0,-5000);
equals(view2.get("verticalScrollOffset"),0,"The minimum y coordinate should be 0")
});(function(){var e="http://photos4.meetupstatic.com/photos/event/4/6/9/9/600_4518073.jpeg";
var d=SC.ImageView.design({value:e,layout:{height:400,width:400}});var g=SC.ControlTestPane.design({height:100}).add("basic",SC.ScrollView,{}).add("basic2",SC.ScrollView,{contentView:d}).add("basic3",SC.ScrollView,{contentView:d,isHorizontalScrollerVisible:NO,autohidesHorizontalScroller:NO,autohidesVerticalScroller:NO}).add("disabled",SC.ScrollView,{isEnabled:NO}).add("verticalScrollerBottom",SC.ScrollView,{contentView:d,hasHorizontalScroller:NO,verticalScrollerBottom:16,isVerticalScrollerVisible:YES,autohidesVerticalScroller:NO});
g.show();module("SC.ScrollView UI",g.standardSetup());test("basic",function(){var h=g.view("basic");
ok(!h.$().hasClass("disabled"),"should not have disabled class");ok(!h.$().hasClass("sel"),"should not have sel class");
equals(h.getPath("childViews.length"),3,"scroll view should have only three child views");
var j=h.get("containerView");ok(j,"scroll views should have a container view");ok(j.kindOf(SC.ContainerView),"default containerView is a kind of SC.ContainerView");
ok(j.get("contentView")===null,"default containerView should have a null contentView itself");
ok(h.get("contentView")===null,"scroll view should have no contentView by default");
equals(j.getPath("childViews.length"),0,"containerView should have no child views");
var l=h.get("horizontalScrollerView");ok(h.get("hasHorizontalScroller"),"default scroll view wants a horizontal scroller");
ok(l,"default scroll view has a horizontal scroller");var k=h.get("verticalScrollerView");
ok(h.get("hasVerticalScroller"),"default scroll view wants a vertical scroller");
ok(k,"default scroll view has a vertical scroller")});test("basic2",function(){var h=g.view("basic2");
ok(h.$().hasClass("sc-scroll-view"),"should have sc-scroll-view class");var m=h.get("horizontalScrollerView");
ok(h.get("hasHorizontalScroller"),"default scroll view wants a horizontal scroller");
ok(m,"default scroll view has a horizontal scroller");ok(m.$().hasClass("sc-horizontal"),"should have sc-horizontal class");
var j=h.maximumHorizontalScrollOffset();ok((j>0),"Max horizontal scroll should be greater than zero");
var l=h.get("verticalScrollerView");ok(h.get("hasVerticalScroller"),"default scroll view wants a vertical scroller");
ok(l,"default scroll view has a vertical scroller");ok(l.$().hasClass("sc-vertical"),"should have sc-vertical class");
var n=h.maximumVerticalScrollOffset();ok((n>0),"Max vertical scroll should be greater than zero");
h.scrollTo(0,100);SC.RunLoop.begin().end();var k=h.get("containerView").$()[0];equals(k.scrollTop,100,"vertical scrolling should adjust scrollTop of container view");
h.scrollTo(50,0);SC.RunLoop.begin().end();k=h.get("containerView").$()[0];equals(k.scrollLeft,50,"horizontal scrolling should adjust scrollLeft of container view")
});test("basic3",function(){var h=g.view("basic3");h.set("isHorizontalScrollerVisible",NO);
ok(!h.get("canScrollHorizontal"),"cannot scroll in horizontal direction");ok(h.$().hasClass("sc-scroll-view"),"should have sc-scroll-view class");
var l=h.get("horizontalScrollerView");ok(h.get("hasHorizontalScroller"),"default scroll view wants a horizontal scroller");
ok(l,"default scroll view has a horizontal scroller");ok(l.$().hasClass("sc-horizontal"),"should have sc-horizontal class");
var j=h.maximumHorizontalScrollOffset();equals(j,0,"Max horizontal scroll should be equal to zero");
h.set("isVerticalScrollerVisible",NO);ok(!h.get("canScrollVertical"),"cannot scroll in vertical direction");
var k=h.get("verticalScrollerView");ok(h.get("hasVerticalScroller"),"default scroll view wants a vertical scroller");
ok(k,"default scroll view has a vertical scroller");ok(k.$().hasClass("sc-vertical"),"should have sc-vertical class");
var m=h.maximumVerticalScrollOffset();equals(m,0,"Max vertical scroll should be equal to zero")
});test("disabled",function(){var h=g.view("disabled");ok(h.$().hasClass("disabled"),"should have disabled class");
ok(!h.$().hasClass("sel"),"should not have sel class")});test("non-zero bottom in vertical scrollbar",function(){var j=g.view("verticalScrollerBottom");
equals(j.get("verticalScrollerBottom"),16,"should have verticalScrollerBottom as ");
var h=j.get("verticalScrollerView");ok(h,"should have vertical scroller view ");equals(h.get("layout").bottom,16,"should have layout.bottom of scroller as ");
equals(h.$()[0].style.bottom,"16px","should have style.bottom of scroller as ")});
test("ScrollView should readjust scrollTop/scrollLeft if layer changes",function(){var j=g.view("basic2"),k=j.get("contentView"),h=j.get("containerView");
j.scrollTo(10,10);SC.RunLoop.begin().end();equals(h.get("layer").scrollLeft,10,"precond - scrollLeft is set to 10");
equals(h.get("layer").scrollTop,10,"precond- scrollTop is set to 10");k.replaceLayer();
SC.RunLoop.begin().end();equals(h.get("layer").scrollLeft,10,"scrollLeft should be readjusted to 10");
equals(h.get("layer").scrollTop,10,"scrollTop should be readjust to 10")})})();var pane,view,view1,view2;
module("SC.ScrollerView",{setup:function(){SC.RunLoop.begin();pane=SC.MainPane.create({childViews:[SC.ScrollerView.extend({}),SC.ScrollerView.extend({minimum:10,maximum:100,isEnabled:NO,layoutDirection:SC.LAYOUT_HORIZONTAL}),SC.ScrollerView.extend({layout:{top:0,bottom:0,right:0,width:20},minimum:0,maximum:100,hasButtons:NO})]});
pane.append();SC.RunLoop.end();view=pane.childViews[0];view1=pane.childViews[1];view2=pane.childViews[2]
},teardown:function(){pane.remove();pane=view=null}});test("value",function(){equals(view1.get("maximum"),100,"precond - view has maximum of 100");
equals(view1.get("minimum"),10,"precond - view has a minimum of 10");view1.set("value",300);
equals(view1.get("value"),view1.get("maximum"),"value is set to maximum if attempting to set higher than maximum");
view1.set("maximum",50);equals(view1.get("value"),view1.get("maximum"),"value should change if maximum changes");
view1.set("value",0);equals(view1.get("value"),view1.get("minimum"),"value is set to minimum if attempt to set lower than minimum");
view1.set("minimum",15);equals(view1.get("value"),view1.get("minimum"),"value should change if minimum changes")
});test("isEnabled",function(){ok(!view.$().hasClass("disabled"),"scrollers should be enabled by default");
view.set("isEnabled",NO);SC.RunLoop.begin().end();ok(view.$().hasClass("disabled"),"scrollers should have disabled class set if isEnabled is set to NO");
var e=view.$(".button-down"),d=SC.Event.simulateEvent(e,"mousedown"),g=view.get("frame").height;
view.set("maximum",g+100);view.set("value",500);SC.Event.trigger(e,"mousedown",[d]);
equals(view.get("value"),500,"scrollers should not respond to mouse events if they are disabled");
view.set("isEnabled",YES);SC.Event.trigger(e,"mousedown",[d]);ok(view.get("value")<(g+100),"scrollers should respond to mouse events if they are not disabled")
});test("layoutDirection",function(){equals(view.get("layoutDirection"),SC.LAYOUT_VERTICAL,"scrollers should default to vertical direction");
ok(view.$().hasClass("sc-vertical"),"scroller with vertical layoutDirection has sc-vertical class name");
equals(view1.get("layoutDirection"),SC.LAYOUT_HORIZONTAL,"precond - view1 has horizontal direction");
ok(view1.$().hasClass("sc-horizontal"),"scroller with horizontal layoutDirection has sc-horizontal class name")
});test("hasButtons",function(){equals(view.get("hasButtons"),YES,"scrollers should default to having buttons");
equals(view.$(".endcap").length,0,"scrollers with buttons should not have an endcap");
equals(view.$(".button-bottom, .button-top").length,2,"scrollers with buttons should have an up and a down button");
equals(view2.$(".endcap").length,1,"scrollers with buttons should have an endcap");
equals(view2.$(".button-bottom, .button-top").length,0,"scrollers with buttons should not have an up or a down button")
});var iconURL="http://www.freeiconsweb.com/Icons/16x16_people_icons/People_046.gif";
var pane,view;module("SC.SegmentedView",{setup:function(){SC.RunLoop.begin();pane=SC.MainPane.create({childViews:[SC.SegmentedView.extend({items:[{value:"Item1",icon:iconURL},{value:"Item2",icon:iconURL},{value:"Item3",icon:iconURL}],itemTitleKey:"value",itemValueKey:"value",itemIconKey:"icon",value:"Item1 Item3".w(),allowsEmptySelection:NO,layout:{height:25}})]});
pane.append();SC.RunLoop.end();view=pane.childViews[0]},teardown:function(){pane.remove();
pane=view=null}});test("Check that properties are mapped correctly",function(){view.triggerItemAtIndex(1);
SC.RunLoop.begin();view.set("isEnabled",YES);SC.RunLoop.end();equals(view.get("value"),"Item2","the second item should be selected.");
var d=view.displayItems();equals(d[0][0],"Item1","Computed properties should match");
equals(d[0][1],"Item1","Computed properties should match");equals(d[0][2],true,"Computed properties should match");
equals(d[0][3],iconURL,"Computed properties should match");equals(d[0][4],null,"Computed properties should match");
equals(d[0][5],null,"Computed properties should match");equals(d[0][6],0,"Computed properties should match");
var e=view.get("layer").childNodes[0];SC.Event.trigger(e,"mousedown");equals(view._isMouseDown,YES,"mousedown");
equals(view.get("activeIndex"),0,"")});test("Check that mouse actions work",function(){view.triggerItemAtIndex(1);
SC.RunLoop.begin();view.set("isEnabled",YES);SC.RunLoop.end();var d=view.get("layer").childNodes[0];
SC.Event.trigger(d,"mousedown");equals(view._isMouseDown,YES,"Mouse down flag on mousedown should be ");
equals(view.get("activeIndex"),0,"The active item is the first segment.");d=view.get("layer").childNodes[1];
SC.Event.trigger(d,"mouseup");equals(view._isMouseDown,NO,"Mouse down flag on mouseup should be ");
equals(view.get("activeIndex"),-1,"Ther shouldnt be any active item");d=view.get("layer").childNodes[2];
SC.Event.trigger(d,"mousedown");SC.Event.trigger(d,"mousemoved");equals(view._isMouseDown,YES,"Mouse down flag on mousemoved should be ");
equals(view.get("activeIndex"),2,"The active item is the third segment.");SC.Event.trigger(d,"mouseover");
equals(view._isMouseDown,YES,"Mouse down flag on mouseover should be ");equals(view.get("activeIndex"),2,"The active item is the third segment.")
});htmlbody("<style> .sc-static-layout { border: 1px red dotted; } </style>");var pane;
(function(){var d="http://www.freeiconsweb.com/Icons/16x16_people_icons/People_046.gif";
pane=SC.ControlTestPane.design().add("3_empty",SC.SegmentedView,{items:["","",""],layout:{height:25}}).add("3_empty,icon",SC.SegmentedView,{items:[{value:"",icon:d},{value:"",icon:d},{value:"",icon:d}],itemTitleKey:"value",itemValueKey:"value",itemIconKey:"icon",layout:{height:25}}).add("3_items,1_sel",SC.SegmentedView,{items:"Item1 Item2 Item3".w(),value:"Item2",layout:{height:25}}).add("2_items,toolTip",SC.SegmentedView,{items:[{value:"title1",toolTip:"this is title1's tip"},{value:"title2",toolTip:"this is title2's tip"}],itemTitleKey:"value",itemValueKey:"value",itemToolTipKey:"toolTip",layout:{height:25}}).add("3_items,1_sel,disabled",SC.SegmentedView,{items:"Item1 Item2 Item3".w(),value:"Item2",isEnabled:NO,layout:{height:25}}).add("3_items,icon,2_sel",SC.SegmentedView,{items:[{value:"Item1",icon:d},{value:"Item2",icon:d},{value:"Item3",icon:d}],itemTitleKey:"value",itemValueKey:"value",itemIconKey:"icon",value:"Item1 Item3".w(),allowsEmptySelection:NO,layout:{height:25}}).add("3_items,2_sel,disabled",SC.SegmentedView,{items:[{value:"Item1",icon:d},{value:"Item2",icon:d},{value:"Item3",icon:d}],itemTitleKey:"value",itemValueKey:"value",itemIconKey:"icon",isEnabled:NO,value:"Item1 Item3".w(),layout:{height:25}}).add("3_items,1_sel,emptySel",SC.SegmentedView,{items:["Item1","Very Long Item","Item 3"],value:"Very Long Item",allowsEmptySelection:YES,layout:{height:25}}).add("3_items,2_sel,emptySel",SC.SegmentedView,{items:["Item1","Very Long Item","Item 3"],value:"Item1 Item3".w(),allowsEmptySelection:YES,layout:{height:25}}).add("3_items,1_sel,multipleSel",SC.SegmentedView,{items:"Item1 Item2 Item3".w(),value:"Item2",allowsMultipleSelection:YES,layout:{height:25}}).add("3_items,2_sel,multipleSel",SC.SegmentedView,{items:"Item1 Item2 Item3".w(),value:"Item1 Item3".w(),allowsMultipleSelection:YES,layout:{height:25}}).add("3_items,1_sel,emptySel,multiSel",SC.SegmentedView,{items:"Item1 Item2 Item3".w(),value:"Item2",allowsEmptySelection:YES,allowsMultipleSelection:YES,layout:{height:25}}).add("3_items,2_sel,emptySel,multiSel",SC.SegmentedView,{items:"Item1 Item2 Item3".w(),value:"Item1 Item3".w(),allowsEmptySelection:YES,allowsMultipleSelection:YES,layout:{height:25}});
pane.show();module("SC.SegmentedView ui",pane.standardSetup());test("Check that all segmentedViews are visible",function(){ok(pane.view("3_empty").get("isVisibleInWindow"),"3_empty.isVisibleInWindow should be YES");
ok(pane.view("3_empty,icon").get("isVisibleInWindow"),"3_empty,icon.isVisibleInWindow should be YES");
ok(pane.view("3_items,1_sel").get("isVisibleInWindow"),"3_items,1_sel.isVisibleInWindow should be YES");
ok(pane.view("2_items,toolTip").get("isVisibleInWindow"),"2_items,toolTip.isVisibleInWindow should be YES");
ok(pane.view("3_items,1_sel,disabled").get("isVisibleInWindow"),"3_items,1_sel,disabled.isVisibleInWindow should be YES");
ok(pane.view("3_items,icon,2_sel").get("isVisibleInWindow"),"3_items,icon,2_sel.isVisibleInWindow should be YES");
ok(pane.view("3_items,2_sel,disabled").get("isVisibleInWindow"),"3_items,2_sel,disabled.isVisibleInWindow should be YES");
ok(pane.view("3_items,1_sel,emptySel").get("isVisibleInWindow"),"3_items,1 sel,emptySel.isVisibleInWindow should be YES");
ok(pane.view("3_items,2_sel,emptySel").get("isVisibleInWindow"),"3_items,2 sel,emptySel.isVisibleInWindow should be YES");
ok(pane.view("3_items,1_sel,multipleSel").get("isVisibleInWindow"),"3_items,1_sel,multipleSel.isVisibleInWindow should be YES");
ok(pane.view("3_items,2_sel,multipleSel").get("isVisibleInWindow"),"3_items,2_sel,multipleSel.isVisibleInWindow should be YES");
ok(pane.view("3_items,1_sel,emptySel,multiSel").get("isVisibleInWindow"),"3_items,1_sel,emptySel,multiSel.isVisibleInWindow should be YES");
ok(pane.view("3_items,2_sel,emptySel,multiSel").get("isVisibleInWindow"),"3_items,2_sel,emptySel,multiSel.isVisibleInWindow should be YES")
});test("Check that all segments have the right classes set",function(){var g=pane.view("3_empty").$();
var h=pane.view("3_empty").$("a");equals(h.length,3,"precond - segmented view should have 3 segments");
ok(g.hasClass("sc-view"),"3_empty.hasClass(sc-view) should be YES");ok(g.hasClass("sc-segmented-view"),"3_empty.hasClass(sc-segmented-view) should be YES");
for(var k=0,j=h.length;k<j;k++){var e=h[k];if(k===0){ok((e.className.indexOf("sc-first-segment")>=0),"first segment has the right classname assigned.")
}if(k==h.length-1){ok((e.className.indexOf("sc-last-segment")>=0),"last segment has the right classname assigned.")
}ok((e.childNodes[0].className.indexOf("sc-button-inner")>=0),"segment "+k+" should have an inner-button.");
ok((e.childNodes[0].childNodes[0].className.indexOf("sc-button-label")>=0),"segment "+k+" should have a label.");
if(k!==0&&k!=h.length-1){ok((e.className.indexOf("sc-middle-segment")>=0),"middle segment has the right classname assigned.")
}g=pane.view("3_items,2_sel,disabled").$();ok(g.hasClass("disabled"),"3_items,2_sel,disabled should have the disabled class set")
}});test("Check that all segments have the right classes set",function(){var g=pane.view("3_empty,icon").$();
var h=pane.view("3_empty,icon").$("a");equals(h.length,3,"precond - segmented view should have 3 segments");
ok(g.hasClass("sc-view"),"3_empty.hasClass(sc-view) should be YES");ok(g.hasClass("sc-segmented-view"),"3_empty.hasClass(sc-segmented-view) should be YES");
for(var k=0,j=h.length;k<j;k++){var e=h[k];if(k===0){ok((e.className.indexOf("sc-first-segment")>=0),"first segment has the right classname assigned.")
}if(k==h.length-1){ok((e.className.indexOf("sc-last-segment")>=0),"last segment has the right classname assigned.")
}ok((e.childNodes[0].className.indexOf("sc-button-inner")>=0),"segment "+k+" should have an inner-button.");
ok((e.childNodes[0].childNodes[0].className.indexOf("sc-button-label")>=0),"segment "+k+" should have a label.");
ok((e.childNodes[0].childNodes[0].childNodes[0].src.length>0),"segment "+k+" should have an icon.");
if(k!==0&&k!=h.length-1){ok((e.className.indexOf("sc-middle-segment")>=0),"middle segment has the right classname assigned.")
}g=pane.view("3_items,2_sel,disabled").$();ok(g.hasClass("disabled"),"3_items,2_sel,disabled should have the disabled class set")
}});test("Check that the selected segments have the right classes assigned.",function(){var g=pane.view("3_empty").$("a");
equals(g.length,3,"precond - segmented view should have 3 segments");for(var j=0,h=g.length;
j<h;j++){var e=g[j];ok((e.className.indexOf("sel")==-1),"this element should not be selected.")
}});test("Check that two items are selected.",function(){var g=pane.view("3_items,icon,2_sel").$("a");
var k=0;equals(g.length,3,"precond - segmented view should have 3 segments");for(var j=0,h=g.length;
j<h;j++){var e=g[j];if(e.className.indexOf("sel")!=-1){k++}}equals(k,2,"3_items,2_sel,disabled should have two segments selected.")
});test("2_items,toolTip has toolTips assigned.",function(){var e=pane.view("2_items,toolTip").$("a");
ok((e[0].title=="this is title1's tip"),"first segment has expected tool tip assigned.");
ok((e[1].title=="this is title2's tip"),"second segment has expected tool tip assigned.")
})})();var pane,view,view1,view2,view3,view4;module("SC.SelectView",{setup:function(){SC.RunLoop.begin();
var d=NO;pane=SC.MainPane.create({objs:["Around","The","World"],objs2:[{title:"Around",pos:3},{title:"The",pos:1},{title:"World",pos:2},{title:"Again",pos:4}],selectedValue:"World",isDue:YES,childViews:[SC.SelectView.extend({items:["To","Back","You"],disableSort:NO}),SC.SelectView.extend({items:["Drop","Down","Menu"]}),SC.SelectView.extend({itemsBinding:"*owner.objs",valueBinding:"*owner.selectedValue",isVisibleBinding:"*owner.isDue"}),SC.SelectView.extend({itemsBinding:"*owner.objs2",valueBinding:"*owner.selectedValue",itemValueKey:"title",itemTitleKey:"title",itemSortKey:"pos"}),SC.SelectView.extend({items:["My","New","List"]}),SC.SelectView.extend({items:["My","New","List"],customViewClassName:"custom-menu-item",customViewMenuOffsetWidth:46})]});
view1=pane.childViews[0];view2=pane.childViews[1];view3=pane.childViews[2];view4=pane.childViews[3];
view5=pane.childViews[4];view6=pane.childViews[5];pane.append();SC.RunLoop.end()},teardown:function(){pane.remove();
pane=view=null}});test("Check if valueBinding works",function(){equals("World",view4.get("value"),"Value should be")
});test("sortObjects() sorts the items of the Drop Down component",function(){var d=view1.get("items");
d=view1.sortObjects(d);equals("Back",d.get(0),"First item should be");equals("To",d.get(1),"Second item should be");
equals("You",d.get(2),"Third item should be")});test("isEnabled=NO should add disabled class",function(){SC.RunLoop.begin();
view1.set("isEnabled",NO);SC.RunLoop.end();ok(view1.$().hasClass("disabled"),"should have disabled class")
});test("Check if setting a value actually changes the selection value",function(){SC.RunLoop.begin();
view2.set("value","Menu");SC.RunLoop.end();equals(view2.get("value"),"Menu","value of Drop down should change to")
});test("The properties for select button should take default values unless specified",function(){var e=view5.get("customViewClassName");
var d=view5.get("customViewMenuOffsetWidth");equals(e,null,"Custom view class name should be null");
equals(d,0,"Custom view menu off set width should be 0")});test("The properties for select button should take the specified values",function(){var e=view6.get("customViewClassName");
var d=view6.get("customViewMenuOffsetWidth");equals(e,"custom-menu-item","Custom view class name should be custom-menu-item");
equals(d,46,"Custom view menu off set width should be 46")});htmlbody("<style> .sc-static-layout { border: 1px red dotted; } </style>");
var pane=SC.ControlTestPane.design().add("Basic",SC.SelectView,{items:["None","Low","Medium","High"]}).add("Disabled",SC.SelectView,{isEnabled:NO,items:["None","Low","Medium","High"]}).add("NotVisible",SC.SelectView,{isVisible:NO,items:["None","Low","Medium","High"]}).add("SortedObjects",SC.SelectView,{items:["None","Low","Medium","High"],disableSort:NO}).add("UnsortedObjects",SC.SelectView,{items:["None","Low","Medium","High"],disableSort:YES}).add("redraw",SC.SelectView,{layout:{width:"150",right:"0"}}).add("SelectButtonWithIcon",SC.SelectView,{items:[{title:"None",icon:"select-button-icon"},{title:"Low",icon:"select-button-icon"},{title:"Medium",icon:"select-button-icon"},{title:"High",icon:"select-button-icon"}],itemTitleKey:"title",itemIconKey:"icon",showCheckbox:YES}).add("SortKey",SC.SelectView,{items:[{title:"None",pos:3},{title:"Low",pos:1},{title:"Medium",pos:2},{title:"High",pos:4}],itemTitleKey:"title",disableSort:NO,itemSortKey:"pos",showCheckbox:YES}).add("StaticLayout",SC.SelectView,{useStaticLayout:YES,items:["None","Low","Medium","High"],layout:{width:"150",right:"0"}}).add("DisableItem",SC.SelectView,{items:[{title:"None",pos:3,isEnabled:YES},{title:"Low",pos:1,isEnabled:NO},{title:"Medium",pos:2,isEnabled:YES},{title:"High",pos:4,isEnabled:NO}],itemTitleKey:"title",disableSort:NO,isEnabledKey:"isEnabled",itemSortKey:"pos",showCheckbox:YES});
pane.show();module("SC.SelectView ui",pane.standardSetup());test("Check the visiblity of the selectButtons",function(){ok(pane.view("Basic").get("isVisibleInWindow"),"Basic.isVisibleInWindow should be YES");
ok(pane.view("Disabled").get("isVisibleInWindow"),"Disabled.isVisibleInWindow should be YES");
ok(!pane.view("NotVisible").get("isVisibleInWindow"),"NotVisible.isVisibleInWindow should be NO");
ok(pane.view("SortedObjects").get("isVisibleInWindow"),"SortedObjects.isVisibleInWindow should be YES");
ok(pane.view("UnsortedObjects").get("isVisibleInWindow"),"UnsortedObjects.isVisibleInWindow should be YES");
ok(pane.view("redraw").get("isVisibleInWindow"),"redraw.isVisibleInWindow should be YES");
ok(pane.view("SelectButtonWithIcon").get("isVisibleInWindow"),"SelectButtonWithIcon.isVisibleInWindow should be YES");
ok(pane.view("StaticLayout").get("isVisibleInWindow"),"StaticLayout.isVisibleInWindow should be YES")
});test("Basic",function(){var d=pane.view("Basic").$();ok(d.hasClass("sc-view"),"hasClass(sc-view) should be YES");
ok(d.hasClass("sc-button-view"),"hasClass(sc-button-view) should be YES");ok(d.hasClass("sc-regular-size"),"hasClass(sc-regular-size) should be YES");
ok(!d.hasClass("icon"),"hasClass(icon) should be NO");ok(!d.hasClass("sel"),"hasClass(sel) should be NO");
ok(!d.hasClass("disabled"),"hasClass(disabled) should be NO");ok(!d.hasClass("def"),"hasClass(def) should be NO")
});test("Disabled",function(){var d=pane.view("Disabled").$();ok(d.hasClass("disabled"),"hasClass(disabled) should be YES");
ok(d.hasClass("sc-view"),"hasClass(sc-view) should be YES");ok(d.hasClass("sc-button-view"),"hasClass(sc-button-view) should be YES");
ok(d.hasClass("sc-regular-size"),"hasClass(sc-regular-size) should be YES");ok(!d.hasClass("icon"),"hasClass(icon) should be NO");
ok(!d.hasClass("sel"),"hasClass(sel) should be NO");ok(!d.hasClass("def"),"hasClass(def) should be NO")
});test("NotVisible",function(){var d=pane.view("NotVisible").$();ok(d.hasClass("sc-view"),"hasClass(sc-view) should be YES");
ok(d.hasClass("sc-button-view"),"hasClass(sc-button-view) should be YES");ok(d.hasClass("sc-regular-size"),"hasClass(sc-regular-size) should be YES");
ok(!d.hasClass("sel"),"hasClass(sel) should be NO");ok(!d.hasClass("disabled"),"hasClass(disabled) should be NO");
ok(!d.hasClass("def"),"hasClass(def) should be NO");ok(!d.hasClass("sel"),"should not have sel class")
});test("SortedObjects",function(){var d=pane.view("SortedObjects");equals(null,d.get("itemSortKey"),"sortkey not specified");
ok(d.$().hasClass("sc-view"),"hasClass(sc-view) should be YES");ok(d.$().hasClass("sc-button-view"),"hasClass(sc-button-view) should be YES");
ok(d.$().hasClass("sc-regular-size"),"hasClass(sc-regular-size) should be YES");ok(!d.$().hasClass("sel"),"hasClass(sel) should be NO");
ok(!d.$().hasClass("icon"),"hasClass(icon) should be NO");ok(!d.$().hasClass("disabled"),"hasClass(disabled) should be NO");
ok(!d.$().hasClass("def"),"hasClass(def) should be NO");equals(d.get("_itemList")[0].title,"High","The first item, when sorted, should be High.")
});test("UnsortedObjects",function(){var d=pane.view("UnsortedObjects");equals(YES,d.get("disableSort"),"Sorting disabled");
ok(d.$().hasClass("sc-view"),"hasClass(sc-view) should be YES");ok(d.$().hasClass("sc-button-view"),"hasClass(sc-button-view) should be YES");
ok(d.$().hasClass("sc-regular-size"),"hasClass(sc-regular-size) should be YES");ok(!d.$().hasClass("sel"),"hasClass(sel) should be NO");
ok(!d.$().hasClass("icon"),"hasClass(icon) should be NO");ok(!d.$().hasClass("disabled"),"hasClass(disabled) should be NO");
ok(!d.$().hasClass("def"),"hasClass(def) should be NO")});test("redraw",function(){var d=pane.view("redraw");
ok(d.$().hasClass("sc-view"),"hasClass(sc-view) should be YES");ok(d.$().hasClass("sc-button-view"),"hasClass(sc-button-view) should be YES");
ok(d.$().hasClass("sc-regular-size"),"hasClass(sc-regular-size) should be YES");ok(!d.$().hasClass("sel"),"hasClass(sel) should be NO");
ok(!d.$().hasClass("icon"),"hasClass(icon) should be NO");ok(!d.$().hasClass("disabled"),"hasClass(disabled) should be NO");
ok(!d.$().hasClass("def"),"hasClass(def) should be NO");ok(d.get("items").length===0,"Items should be empty");
SC.RunLoop.begin();d.set("items",["Calendar","Work","Home"]);SC.RunLoop.end();ok(d.get("items").length===3,"Items length should be 3")
});test("SelectButtonWithIcon",function(){var d=pane.view("SelectButtonWithIcon").$();
ok(d.hasClass("icon"),"hasClass(Icon) should be YES");ok(d.hasClass("sc-view"),"hasClass(sc-view) should be YES");
ok(d.hasClass("sc-button-view"),"hasClass(sc-button-view) should be YES");ok(d.hasClass("sc-regular-size"),"hasClass(sc-regular-size) should be YES");
ok(!d.hasClass("sel"),"hasClass(sel) should be NO");ok(!d.hasClass("disabled"),"hasClass(disabled) should be NO");
ok(!d.hasClass("def"),"hasClass(def) should be NO")});test("Check if the objects are sorted based on sortKey",function(){var d=pane.view("SortKey");
equals("None",d.get("items")[2].title,'Third object should be "None" ')});test("StaticLayout",function(){var d=pane.view("StaticLayout");
ok(!d.$().hasClass("disabled"),"should not have disabled class");ok(!d.$().hasClass("sel"),"should not have sel class")
});var pane,view,view1,view2,view3;module("SC.SelectFieldView",{setup:function(){SC.RunLoop.begin();
pane=SC.MainPane.create({objs:["Apple","Sproutcore 1.0","Development","Charles"],selectedValue:"Apple",childViews:[SC.SelectFieldView.extend({objects:[1,6,11,2,8]}),SC.SelectFieldView.extend({objects:["Apple","Sproutcore 1.0","Development","Charles"]}),SC.SelectFieldView.extend({objectsBinding:"*owner.objs",valueBinding:"*owner.selectedValue"}),SC.SelectFieldView.extend({objectsBinding:"*owner.objs",valueBinding:"*owner.selectedValue",valueKey:"title",nameKey:"title",sortKey:"pos"})]});
pane.append();SC.RunLoop.end();view=pane.childViews[0];view1=pane.childViews[1];view2=pane.childViews[2];
view3=pane.childViews[3]},teardown:function(){pane.remove();pane=view=null}});test("renders a select field input tag with appropriate attributes",function(){equals(view.get("tagName"),"select","should have type as text");
var d=Q$("select",view.get("layer"));equals(view.$().attr("id"),SC.guidFor(view),"should have id as view_guid")
});test("select component with options",function(){equals(5,view.objects.length,"The select component should have 5 options");
equals(null,view.nameKey,"the select should not have any name key");equals(null,view.valueKey,"the select should not have any value key")
});test("sortObjects() sorts the options of the select component",function(){var d=view.objects;
view.objects=view.sortObjects(d);equals(1,d.get(0),"should be the first element");
equals(2,d.get(1),"should be the second element");equals(6,d.get(2),"should be the third element");
equals(8,d.get(3),"should be the forth element");equals(11,d.get(4),"should be the fifth element")
});test("rebuildMenu() populates the select component with new data",function(){var d=["Hai,","how","are","you?"];
view1.objects=d;var e=view1.objects;equals("Hai,",e.get(0),"should be the first element");
equals("how",e.get(1),"should be the second element");equals("are",e.get(2),"should be the third element");
equals("you?",e.get(3),"should be the forth element")});test("isEnabled=NO should add disabled class",function(){SC.RunLoop.begin();
view.set("isEnabled",NO);SC.RunLoop.end();ok(view.$().hasClass("disabled"),"should have disabled class")
});test("objects should change on changing the binding",function(){SC.RunLoop.begin();
var d=["Test1","Test2"];pane.set("objs",d);SC.RunLoop.end();var e=view2.objects;d=pane.objs;
ok(e===d,"the objects should be same")});test("selectedValue shouldn't have st string attached to it",function(){SC.RunLoop.begin();
var d=["Test1","Test2"];pane.set("objs",d);SC.RunLoop.end();SC.RunLoop.begin();pane.set("selectedValue","Test1");
SC.RunLoop.end();var e=view2.getFieldValue();equals(e,"Test1","the new Value is ");
SC.RunLoop.begin();var g=[{pos:1,title:"US/Pacific"},{pos:2,title:"America/Vancouver"},{pos:3,title:"Canada/Mountain"},{pos:4,title:"Other..."}];
pane.set("objs",g);SC.RunLoop.end();SC.RunLoop.begin();pane.set("selectedValue","America/Vancouver");
SC.RunLoop.end();e=view3.getFieldValue();equals(e,"America/Vancouver","the new Value is ")
});htmlbody("<style> .sc-static-layout { border: 1px red dotted; } </style>");var pane=SC.ControlTestPane.design().add("basic",SC.SelectFieldView,{objects:["1","2","3","4","5"]}).add("disabled",SC.SelectFieldView,{isEnabled:NO,objects:["1","2","3","4","5"]}).add("Not Selected",SC.SelectFieldView,{isSelected:NO,objects:["1","2","3","4","5"]}).add("Not Visible",SC.SelectFieldView,{isVisible:NO,objects:["1","2","3","4","5"]}).add("sortedStringOptions",SC.SelectFieldView,{objects:["Apple","Sproutcore 1.0","Development","Charles"],useStaticLayout:YES,layout:{width:"auto",right:"auto"}}).add("unSortedStringOptions",SC.SelectFieldView,{objects:["Apple","Sproutcore 1.0","Development","Charles"],useStaticLayout:YES,disableSort:YES,layout:{width:"auto",right:"auto"}}).add("Width 150 Right 0",SC.SelectFieldView,{objects:[1,6,11,2,8],useStaticLayout:YES,layout:{width:"150",right:"0"}}).add("redraw",SC.SelectFieldView,{useStaticLayout:YES,layout:{width:"150",right:"0"}});
pane.show();module("SC.SelectFieldView ui",pane.standardSetup());test("basic",function(){var d=pane.view("basic");
ok(!d.$().hasClass("disabled"),"should not have disabled class");ok(!d.$().hasClass("sel"),"should not have sel class")
});test("disabled",function(){var d=pane.view("disabled");ok(d.$().hasClass("disabled"),"should have disabled class")
});test("Not Selected",function(){var d=pane.view("Not Selected");ok(!d.$().hasClass("disabled"),"should not have disabled class");
ok(!d.$().hasClass("sel"),"should not have sel class")});test("Not Visible",function(){var d=pane.view("Not Visible");
ok(!d.$().hasClass("disabled"),"should not have disabled class");ok(!d.$().hasClass("sel"),"should not have sel class")
});test("sortedStringOptions",function(){var d=pane.view("sortedStringOptions");equals(null,d.get("sortKey"),"sortkey not specified")
});test("Width 150 Right 0",function(){var d=pane.view("Width 150 Right 0");ok(!d.$().hasClass("disabled"),"should not have disabled class");
ok(!d.$().hasClass("sel"),"should not have sel class")});test("Check that by setting the value the selection actually changes",function(){var d=pane.view("Width 150 Right 0");
SC.RunLoop.begin();d.set("value",2);SC.RunLoop.end();equals(d.getFieldValue(),2,"the field value should change to 2")
});test("redraw",function(){var d=pane.view("redraw");ok(d.get("objects").length===0,"objects should be empty");
SC.RunLoop.begin();d.set("objects",[1,6,11,2,8]);SC.RunLoop.end();ok(d.$("option").length===5,"options length should be 5")
});htmlbody("<style> .sc-static-layout { border: 1px red dotted; } </style>");(function(){var d=SC.ControlTestPane.design().add("horizontal",SC.SeparatorView,{layoutDirection:SC.LAYOUT_HORIZONTAL}).add("vertical",SC.SeparatorView,{layoutDirection:SC.LAYOUT_VERTICAL});
d.show();module("TODO: Test SC.Separator UI",d.standardSetup());test("basic",function(){var e=d.view("horizontal");
ok(!e.$().hasClass("vertical"),"should not be vertically divided");equals(e.get("layoutDirection"),SC.LAYOUT_HORIZONTAL,"the view is divided horizontally");
e=d.view("vertical");ok(!e.$().hasClass("horizontal"),"should not be horizontally divided");
equals(e.get("layoutDirection"),SC.LAYOUT_VERTICAL,"the view is divided vertically")
});test("renders a component with a span tag",function(){var e=d.view("horizontal");
equals(e.get("tagName"),"span","creates a pan tag")})})();module("TODO: Test SC.SourceListView Methods");
module("TODO: Test SC.SourceListView UI");var pane,view;module("SC.SplitView",{setup:function(){SC.RunLoop.begin();
pane=SC.MainPane.create({childViews:[SC.SplitView.extend()]});pane.append();SC.RunLoop.end();
view=pane.childViews[0]},teardown:function(){pane.remove();pane=view=null}});test("the views are collapsible",function(){equals(YES,view.canCollapseView(view.get("topLeftView")),"the top left view is collapsable");
equals(YES,view.canCollapseView(view.get("bottomRightView")),"the bottom right view is collapsable");
equals(YES,view.splitViewCanCollapse(view,view.get("topLeftView")),"should return true");
view.set("canCollapseViews","NO")});test("the thickness of the views",function(){ok(view.thicknessForView(view.get("topLeftView")),"thickness of the topLeftView");
ok(view.thicknessForView(view.get("bottomRightView")),"thickness of the bottomRightView")
});test("Layout direction is Horizontal",function(){view.set("layoutDirection",SC.LAYOUT_HORIZONTAL);
equals(view.getPath("thumbViewCursor.cursorStyle"),"ew-resize","The Cursor is")});
test("Layout direction is Vertical",function(){view.set("layoutDirection",SC.LAYOUT_VERTICAL);
equals(view.getPath("thumbViewCursor.cursorStyle"),"ns-resize","The Cursor is")});
htmlbody("<style> .sc-static-layout { border: 1px red dotted; } </style>");(function(){var d=SC.ControlTestPane.design().add("horizontal",SC.SplitView,{layout:{right:20,bottom:20,width:100,height:23},layoutDirection:SC.LAYOUT_HORIZONTAL,canCollapseViews:NO}).add("vertical",SC.SplitView,{layoutDirection:SC.LAYOUT_VERTICAL,canCollapseViews:NO}).add("collapsable",SC.SplitView,{layoutDirection:SC.LAYOUT_HORIZONTAL,canCollapseViews:YES});
d.show();module("SC.SplitView ui",d.standardSetup());test("Horizontal and Vertical SplitView",function(){var e=d.view("horizontal");
ok(!e.$().hasClass("vertical"),"should not be vertically divided");ok(!e.$().hasClass("collapsable"),"should not be collapsable");
equals(e.get("layoutDirection"),SC.LAYOUT_HORIZONTAL,"the view is divided horizontally");
e=d.view("vertical");ok(!e.$().hasClass("horizontal"),"should not be horizontally divided");
ok(!e.$().hasClass("collapsable"),"should not be collapsable");equals(e.get("layoutDirection"),SC.LAYOUT_VERTICAL,"the view is divided vertically")
});test("can collapse split view",function(){var e=d.view("collapsable");ok(!e.$().hasClass("vertical"),"should not be have vertical class");
equals(e.get("layoutDirection"),SC.LAYOUT_HORIZONTAL);equals(e.get("canCollapseViews"),YES,"the view should be collapsable")
})})();htmlbody(["<style>",".sc-stacked-view { border-bottom: 1px red solid; }",".comment-view.sel { background-color: #ccc; }",".comment-view { margin: 0 10px; padding: 10px 0; border-bottom: 1px #ccc solid; }",".comment-view p { padding-top: 28px; padding-bottom: 32px; }","</style>"].join("\n"));
var CommentView=SC.View.extend(SC.StaticLayout,SC.Control,{useStaticLayout:YES,content:null,classNames:"comment-view",contentPropertyDidChange:function(e,d){if(d==="*"){this.updateFromLabel().updateCommentLabel()
}else{if(d==="from"||d==="date"){this.updateFromLabel()}else{if(d==="comment"){this.updateCommentLabel()
}}}if(this.owner&&this.owner.updateHeight){this.owner.updateHeight()}},updateFromLabel:function(){var e=this.get("content"),h=e?e.get("from"):"Anonymous",d=e?e.get("date"):"some date",g="%@ wrote %@: ".fmt(h,d);
this.fromLabel.set("value",g);return this},updateCommentLabel:function(){var d=this.get("content"),e=d?d.get("comment"):"(No Comment)";
this.commentLabel.set("value",e)},childViews:"fromLabel commentLabel editButton replyButton".w(),fromLabel:SC.LabelView.extend({tagName:"label",layout:{left:0,top:0,right:0,height:18}}),commentLabel:SC.LabelView.extend(SC.StaticLayout,{useStaticLayout:YES,tagName:"p"}),editButton:SC.ButtonView.extend({title:"Edit",titleMinWidth:0,layout:{bottom:4,right:58,height:21,width:50}}),replyButton:SC.ButtonView.extend({title:"Reply",titleMinWidth:0,layout:{bottom:4,right:4,height:21,width:50}})});
var content=[SC.Object.create({from:"Joe",date:"Today",comment:"I think this new class is a great idea!  I've always wanted less control but more flexibility."}),SC.Object.create({from:"Joe",date:"Today",comment:"I think this new class is a great idea!  I've always wanted less control but more flexibility."}),SC.Object.create({from:"Joe",date:"Today",comment:"I think this new class is a great idea!  I've always wanted less control but more flexibility."}),SC.Object.create({from:"Joe",date:"Today",comment:"I think this new class is a great idea!  I've always wanted less control but more flexibility."}),SC.Object.create({from:"Jane",date:"Yesterday",comment:"If only you would rewrite this in Flash.  Then I could get really excited about it.  I like it when Adobe controls my destiny."})];
var extra=SC.Object.create({from:"Charles",date:"Tomorrow",comment:"Hello from the world of  tomorrow!"});
var pane=SC.ControlTestPane.design().add("basic",SC.StackedView,{layout:{top:0,left:0,right:0,height:600},content:content,exampleView:CommentView});
pane.show();window.pane=pane;module("Basic Tests",pane.standardSetup());test("removing an item should delete childView and adjust height",function(){var e=pane.view("basic"),g=content[0];
equals(e.getPath("childViews.length"),content.length,"precond - should have child views equal to current content");
var h=e.get("frame").height;SC.run(function(){content.removeAt(0)});equals(e.getPath("childViews.length"),content.length,"view should remove childView for removed content items");
var d=e.get("frame").height;ok(d<h,"view height should adjust to reflect new content. (old height: %@ current height: %@)".fmt(h,d));
SC.run(function(){content.insertAt(0,g)})});window.content=content;test("inserting an item should add childView and adjust height",function(){var e=pane.view("basic"),g=extra;
equals(e.getPath("childViews.length"),content.length,"precond - should have child views equal to current content");
var h=e.get("frame").height;SC.run(function(){content.pushObject(g)});equals(e.getPath("childViews.length"),content.length,"view should add childView for added content item");
var d=e.get("frame").height;ok(d>h,"view height should adjust to reflect new content. (old height: %@ current height: %@)".fmt(h,d));
SC.run(function(){content.popObject()})});test("editing an item should automatically adjust the height",function(){var h=pane.view("basic"),j=content[0],k=h.childViews[0],g=j.get("comment");
ok(k,"stacked view should have child view");equals(k.get("content"),j,"first childView should own first content item");
var d=h.get("frame").height;SC.run(function(){j.set("comment","This is a new comment")
});equals(k.$().find("p").text(),"This is a new comment","Item view should now contain comment");
var e=h.get("frame").height;ok(e<d,"view height should adjust to reflect new content. (old height: %@ current height: %@)".fmt(d,e));
SC.run(function(){j.set("comment",g)});e=h.get("frame").height;equals(e,d,"view height should restore to old height when content is edited again. (old height: %@ current height: %@)".fmt(d,e))
});test("adding, removing then editing items should still keep height the same",function(){var h=pane.view("basic"),j=content[0],g=j.get("comment"),d=h.get("frame").height;
SC.run(function(){content.removeAt(0)});SC.run(function(){content.insertAt(0,j)});
SC.run(function(){content.pushObject(extra)});SC.run(function(){content.popObject()
});SC.run(function(){j.set("comment","Short comment")});SC.run(function(){j.set("comment",g)
});var e=h.get("frame").height;equals(e,d,"view height should restore to old height when content is edited again. (old height: %@ current height: %@)".fmt(d,e))
});module("SC.StaticContentView - Basic UI");test("Frame Recalculation",function(){var h=0,e,g;
var j=SC.PanelPane.create({layout:{width:500,height:500,centerX:0,centerY:0},contentView:SC.ScrollView.design({layout:{top:10,right:10,bottom:10,left:10}})});
var d=SC.StaticContentView.create({content:'<p style="position: relative; margin-top: 80px; font-size: 3em">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>',frameDidChange:function(){h+=1
}.observes("frame")});j.setPath("contentView.contentView",d);j.append();e=h;ok(h>0,"precond - frame should be called at least once when displayed");
j.adjust("width",499);equals(h,e+1,"frame should recompute after parent resizes");
g="For today, we celebrate the first glorious anniversary of the Information Purification Directives. We have created, for the first time in all history, a garden of pure ideology. Where each worker may bloom secure from the pests of contradictory and confusing truths.Our Unification of Thought is more powerful a weapon than any fleet or army on earth. We are one people. With one will. One resolve. One cause. Our enemies shall talk themselves to death. And we will bury them with their own confusion. We shall prevail!";
d.set("content",g);equals(h,e+2,"frame should recompute after content changes");SC.RunLoop.begin().end();
ok(d.get("layer").textContent.indexOf(g)>-1,"view should rerender when content changes");
d.contentLayoutDidChange();ok(h>e+2,"frame should recompute after calling contentLayoutDidChange()");
j.remove()});var iconURL="http://www.freeiconsweb.com/Icons/16x16_people_icons/People_046.gif";
var pane,view;module("SC.TabView",{setup:function(){SC.RunLoop.begin();pane=SC.MainPane.create({childViews:[SC.TabView.extend({nowShowing:"tab2",items:[{title:"tab1",value:"tab1",icon:iconURL},{title:"tab2",value:"tab2",icon:iconURL},{title:"tab3",value:"tab3",icon:iconURL}],itemTitleKey:"title",itemValueKey:"value",itemIconKey:"icon",layout:{left:12,height:200,right:12,top:12}})]});
pane.append();SC.RunLoop.end();view=pane.childViews[0]},teardown:function(){pane.remove();
pane=view=null}});test("Check that all segmentedViews are visible",function(){ok(true,"hello")
});htmlbody("<style> .sc-static-layout { border: 1px red dotted; } </style>");(function(){var d="http://www.freeiconsweb.com/Icons/16x16_people_icons/People_046.gif";
var e=SC.ControlTestPane.design().add("tabView1",SC.TabView,{nowShowing:"tab2",items:[{title:"tab1",value:"tab1",icon:d},{title:"tab2",value:"tab2",icon:d},{title:"tab3",value:"tab3",icon:d}],itemTitleKey:"title",itemValueKey:"value",itemIconKey:"icon",layout:{left:12,height:200,right:12,top:12}}).add("tabView2",SC.TabView,{nowShowing:"tab3",items:[{title:"tab1",value:"tab1"},{title:"tab2",value:"tab2"},{title:"tab3",value:"tab3"}],itemTitleKey:"title",itemValueKey:"value",layout:{left:12,height:200,right:12,top:12}}).add("tabView3",SC.TabView,{items:[{title:"tab1",value:"tab1"},{title:"tab2",value:"tab2"},{title:"tab3",value:"tab3"}],itemTitleKey:"title",itemValueKey:"value",layout:{left:12,height:200,right:12,top:12}});
e.show();module("SC.TabView ui",e.standardSetup());test("Check that all tabViews are visible",function(){ok(e.view("tabView1").get("isVisibleInWindow"),"tabView1.isVisibleInWindow should be YES");
ok(e.view("tabView2").get("isVisibleInWindow"),"tabView2.isVisibleInWindow should be YES");
ok(e.view("tabView3").get("isVisibleInWindow"),"tabView3.isVisibleInWindow should be YES")
});test("Check that the tabView has the right classes set",function(){var h=e.view("tabView1").$();
var g=e.view("tabView1").$("div");ok(h.hasClass("sc-view"),"tabView1.hasClass(sc-view) should be YES");
ok(h.hasClass("sc-tab-view"),"tabView1.hasClass(sc-tab-view) should be YES");ok(g[1].className.indexOf("sc-segmented-view")>=0,"tabView1 should contain a segmented view");
ok(g[0].className.indexOf("sc-container-view")>=0,"tabView1 should contain a container view");
ok(g[1].childNodes.length==3,"tabView1 should have 3 options")})})();module("TODO: Test SC.WebView Methods");
(function(){var d=SC.ControlTestPane.design().add("basic",SC.WebView,{value:"/clock",layout:{width:250,height:150}}).add("change src/value",SC.WebView,{value:"/clock",layout:{width:250,height:150}}).add("auto resize",SC.WebView,{value:"/static/frameworks/en/0404a27d39b34c46f3df8b0d82ab2e9353e6a24f/desktop/english.lproj/debug/iframe.html",shouldAutoResize:YES,layout:{width:250,height:150}}).add("don't auto resize",SC.WebView,{shouldAutoResize:NO,layout:{width:250,height:150}});
d.show();module("SC.WebView UI");test("attributes tests",function(){var g=d.view("basic");
var h=g.$("iframe");var e=g.$();ok(g,"view should exist");ok(g.get("value"),"should have value property");
equals(g.get("shouldAutoResize"),NO,"should have autoresize off by default, shouldAutoResize");
ok(e.hasClass("sc-view"),"should have sc-view css class");ok(e.hasClass("sc-web-view"),"should have sc-web-view css class");
equals(e.height(),150,"should have height");equals(e.width(),250,"should have width");
ok(h,"should have iframe element");equals(h.attr("src"),"/clock","should have source as /clock");
ok(h[0].contentWindow,"should have content window if src is from the same domain")
});test("change src/value",function(){var e=d.view("change src/value");var g=e.$("iframe");
equals(e.get("value"),"/clock","should have value property in view as '/clock' before changing source");
SC.RunLoop.begin();e.set("value","/store_configurator");SC.RunLoop.end();equals(e.get("value"),"/store_configurator","should have value property in view as '/store_configurator' after changing source");
equals(g.attr("src"),"/store_configurator","should have source in the iframe as '/store_configurator'")
});test("auto resize tests, shouldAutoResize:YES",function(){var e=d.view("auto resize");
e.$()[0].parentNode.style.overflow="auto";equals(e.get("shouldAutoResize"),YES,"should have auto resize flag as true");
stop();SC.Event.add(e.$("iframe")[0],"load",this,function(){ok(e.$().height()>150,"height of view should change based on content");
ok(e.$().width()>200,"width of view should change based on content");start()})});
test("auto resize tests, shouldAutoResize:NO",function(){var e=d.view("don't auto resize");
equals(e.get("shouldAutoResize"),NO,"should have auto resize flag as false");SC.RunLoop.begin();
e.set("value","/static/frameworks/en/0404a27d39b34c46f3df8b0d82ab2e9353e6a24f/desktop/english.lproj/debug/iframe.html");
SC.RunLoop.end();stop();SC.Event.add(e.$("iframe")[0],"load",this,function(){ok(e.$().height()===150,"height of view should not change based on content");
ok(e.$().width()===250,"width of view should not change based on content");start()
})})})();var iconURL="http://www.freeiconsweb.com/Icons/16x16_people_icons/People_046.gif";
var pane,view;module("SC.TabView",{setup:function(){SC.RunLoop.begin();pane=SC.MainPane.create({childViews:[SC.TabView.extend({nowShowing:"tab2",items:[{title:"tab1",value:"tab1",icon:iconURL},{title:"tab2",value:"tab2",icon:iconURL},{title:"tab3",value:"tab3",icon:iconURL}],itemTitleKey:"title",itemValueKey:"value",itemIconKey:"icon",layout:{left:12,height:200,right:12,top:12}})]});
pane.append();SC.RunLoop.end();view=pane.childViews[0]},teardown:function(){pane.remove();
pane=view=null}});test("Check that all segmentedViews are visible",function(){ok(true,"hello")
});SC.TOGGLE_BEHAVIOR="toggle";SC.PUSH_BEHAVIOR="push";SC.TOGGLE_ON_BEHAVIOR="on";
SC.TOGGLE_OFF_BEHAVIOR="off";SC.HOLD_BEHAVIOR="hold";SC.REGULAR_BUTTON_HEIGHT=24;
SC.ButtonView=SC.View.extend(SC.Control,SC.Button,SC.StaticLayout,{tagName:"div",classNames:["sc-button-view"],theme:"square",buttonBehavior:SC.PUSH_BEHAVIOR,holdInterval:100,isDefault:NO,isDefaultBindingDefault:SC.Binding.oneWay().bool(),isCancel:NO,isCancelBindingDefault:SC.Binding.oneWay().bool(),href:"",action:null,target:null,supportFocusRing:NO,triggerAction:function(d){if(!this.get("isEnabled")){return NO
}this.set("isActive",YES);this._action(d,YES);this.didTriggerAction();this.invokeLater("set",200,"isActive",NO);
return true},didTriggerAction:function(){},titleMinWidth:80,init:function(){arguments.callee.base.apply(this,arguments);
if(this.get("keyEquivalent")){this._defaultKeyEquivalent=this.get("keyEquivalent")
}},_TEMPORARY_CLASS_HASH:{},displayProperties:["href","icon","title","value","toolTip"],renderStyle:"renderDefault",render:function(h,k){var d,e,g,j;
if(this.get("tagName")==="a"){d=this.get("href");if(!d||(d.length===0)){d="javascript:;"
}h.attr("href",d)}else{h.attr("role","button")}e=this.get("toolTip");if(SC.typeOf(e)===SC.T_STRING){if(this.get("localize")){e=e.loc()
}h.attr("title",e);h.attr("alt",e)}g=this._TEMPORARY_CLASS_HASH;g.def=this.get("isDefault");
g.cancel=this.get("isCancel");g.icon=!!this.get("icon");h.attr("role","button").setClass(g);
j=this.get("theme");if(j){h.addClass(j)}this[this.get("renderStyle")](h,k)},renderDefault:function(d,e){if(e){d=d.push("<span class='sc-button-inner' style = 'min-width:",this.get("titleMinWidth"),"px'>");
this.renderTitle(d,e);d.push("</span>");if(this.get("supportFocusRing")){d.push('<div class="focus-ring">','<div class="focus-left"></div>','<div class="focus-middle"></div>','<div class="focus-right"></div></div>')
}}else{this.renderTitle(d,e)}},renderImage:function(d,g){var e=this.get("icon");d.addClass("no-min-width");
if(e){d.push("<div class='img "+e+"'></div>")}else{d.push("<div class='img'></div>")
}},_defaultKeyEquivalent:null,_isDefaultOrCancelDidChange:function(){var d=!!this.get("isDefault"),e=!d&&this.get("isCancel");
if(this.didChangeFor("defaultCancelChanged","isDefault","isCancel")){this.displayDidChange();
if(d){this.set("keyEquivalent","return")}else{if(e){this.setIfChanged("keyEquivalent","escape")
}else{this.set("keyEquivalent",this._defaultKeyEquivalent)}}}}.observes("isDefault","isCancel"),isMouseDown:false,mouseDown:function(d){var e=this.get("buttonBehavior");
if(!this.get("isEnabled")){return YES}this.set("isActive",YES);this._isMouseDown=YES;
if(e===SC.HOLD_BEHAVIOR){this._action(d)}else{if(!this._isFocused&&(e!==SC.PUSH_BEHAVIOR)){this._isFocused=YES;
this.becomeFirstResponder();if(this.get("isVisibleInWindow")){this.$()[0].focus()
}}}return YES},mouseExited:function(d){if(this._isMouseDown){this.set("isActive",NO)
}return YES},mouseEntered:function(d){if(this._isMouseDown){this.set("isActive",YES)
}return YES},mouseUp:function(e){if(this._isMouseDown){this.set("isActive",NO)}this._isMouseDown=false;
if(this.get("buttonBehavior")!==SC.HOLD_BEHAVIOR){var d=this.$().within(e.target);
if(d&&this.get("isEnabled")){this._action(e)}}return YES},touchStart:function(d){return this.mouseDown(d)
},touchEnd:function(d){return this.mouseUp(d)},touchEntered:function(d){return this.mouseEntered(d)
},touchExited:function(d){return this.mouseExited(d)},keyDown:function(e){if(e.which===9){var d=e.shiftKey?this.get("previousValidKeyView"):this.get("nextValidKeyView");
if(d){d.becomeFirstResponder()}else{e.allowDefault()}return YES}if(e.which===13){this.triggerAction(e);
return YES}return YES},_action:function(d,g){switch(this.get("buttonBehavior")){case SC.TOGGLE_BEHAVIOR:var e=this.get("isSelected");
if(e){this.set("value",this.get("toggleOffValue"))}else{this.set("value",this.get("toggleOnValue"))
}break;case SC.TOGGLE_ON_BEHAVIOR:this.set("value",this.get("toggleOnValue"));break;
case SC.TOGGLE_OFF_BEHAVIOR:this.set("value",this.get("toggleOffValue"));break;case SC.HOLD_BEHAVIOR:this._runHoldAction(d,g);
break;default:this._runAction(d)}},_runAction:function(d){var e=this.get("action"),g=this.get("target")||null;
if(e){if(this._hasLegacyActionHandler()){this._triggerLegacyActionHandler(d)}else{this.getPath("pane.rootResponder").sendAction(e,g,this,this.get("pane"))
}}},_runHoldAction:function(d,e){if(this.get("isActive")){this._runAction();if(!e){SC.RunLoop.begin();
this.invokeLater("_runHoldAction",this.get("holdInterval"),d);SC.RunLoop.end()}}},_hasLegacyActionHandler:function(){var d=this.get("action");
if(d&&(SC.typeOf(d)===SC.T_FUNCTION)){return true}if(d&&(SC.typeOf(d)===SC.T_STRING)&&(d.indexOf(".")!=-1)){return true
}return false},_triggerLegacyActionHandler:function(evt){if(!this._hasLegacyActionHandler()){return false
}var action=this.get("action");if(SC.typeOf(action)===SC.T_FUNCTION){this.action(evt)
}if(SC.typeOf(action)===SC.T_STRING){eval("this.action = function(e) { return "+action+"(this, e); };");
this.action(evt)}},acceptsFirstResponder:function(){if(!SC.SAFARI_FOCUS_BEHAVIOR){return this.get("isEnabled")
}else{return NO}}.property("isEnabled"),willBecomeKeyResponderFrom:function(d){if(!this._isFocused){this._isFocused=YES;
this.becomeFirstResponder();if(this.get("isVisibleInWindow")){var e=this.$()[0];if(e){e.focus()
}}}},willLoseKeyResponderTo:function(d){if(this._isFocused){this._isFocused=NO}},didAppendToDocument:function(){if(parseInt(SC.browser.msie,0)===7){var g=this.get("layout");
if(this.get("useStaticLayout")&&g.width&&(g.width.indexOf&&g.width.indexOf("auto")!=-1)){var e=this.$();
if(e&&e[0]){var d=e[0].clientWidth;if(d!==0){var h=parseInt(e.css("paddingRight"),0);
this.$(".sc-button-label").css("minWidth",d-(h*2)+"px")}}}}}});SC.CheckboxView=SC.ButtonView.extend(SC.StaticLayout,SC.Button,{classNames:["sc-checkbox-view"],tagName:"label",needsEllipsis:NO,render:function(e,d){var g,h,n=this.get("value"),m=n===SC.MIXED_MODE?"mixed":(n===this.get("toggleOnValue")?"true":"false");
if(d){var k=SC.BLANK_IMAGE_URL,j=this.get("isEnabled")?"":'disabled="disabled"',l=SC.guidFor(this);
e.attr("role","checkbox");g=this._field_currentDisplayTitle=this.get("displayTitle");
if(SC.browser.msie){e.attr("for",l)}e.push('<span class="button" ></span>');if(this.get("needsEllipsis")){e.push('<span class="label ellipsis">',g,"</span>")
}else{e.push('<span class="label">',g,"</span>")}e.attr("name",l)}else{g=this.get("displayTitle");
if(g!==this._field_currentDisplayTitle){this._field_currentDisplayTitle=g;this.$("span.label").text(g)
}}e.attr("aria-checked",m)},acceptsFirstResponder:function(){if(!SC.SAFARI_FOCUS_BEHAVIOR){return this.get("isEnabled")
}else{return NO}}.property("isEnabled"),mouseDown:function(d){if(!this.get("isEnabled")){return YES
}this.set("isActive",YES);this._isMouseDown=YES;if(d){d.allowDefault()}return YES
},mouseUp:function(d){if(!this.get("isEnabled")||(d&&d.target&&!this.$().within(d.target))){return YES
}var e=this.get("value");if(e===this.get("toggleOnValue")){this.$().attr("aria-checked","false");
this.set("value",this.get("toggleOffValue"))}else{this.$().attr("aria-checked","true");
this.set("value",this.get("toggleOnValue"))}this.set("isActive",NO);this._isMouseDown=NO;
return YES},touchStart:function(d){return this.mouseDown(d)},touchEnd:function(d){return this.mouseUp(d)
}});sc_require("mixins/collection_view_delegate");sc_require("views/list_item");SC.DRAG_REORDER=16;
SC.HORIZONTAL_ORIENTATION="horizontal";SC.VERTICAL_ORIENTATION="vertical";SC.BENCHMARK_RELOAD=NO;
SC.CollectionView=SC.View.extend(SC.CollectionViewDelegate,SC.CollectionContent,{classNames:["sc-collection-view"],ACTION_DELAY:200,content:null,contentBindingDefault:SC.Binding.multiple(),length:0,nowShowing:function(){return this.computeNowShowing()
}.property("length","clippingFrame").cacheable(),selection:null,isSelectable:YES,isSelectableBindingDefault:SC.Binding.bool(),isEnabled:YES,isEnabledBindingDefault:SC.Binding.bool(),isEditable:YES,isEditableBindingDefault:SC.Binding.bool(),canReorderContent:NO,canReorderContentBindingDefault:SC.Binding.bool(),canDeleteContent:NO,canDeleteContentBindingDefault:SC.Binding.bool(),canEditContent:NO,canEditContentBindingDefault:SC.Binding.bool(),isDropTarget:NO,useToggleSelection:NO,actOnSelect:NO,selectOnMouseDown:YES,exampleView:SC.ListItemView,contentExampleViewKey:null,groupExampleView:null,contentGroupExampleViewKey:null,action:null,target:null,contentValueKey:null,acceptsFirstResponder:NO,isActive:NO,calculatedHeight:0,calculatedWidth:0,computeLayout:function(){return null
},layoutForContentIndex:function(d){return null},allContentIndexes:function(){return SC.IndexSet.create(0,this.get("length")).freeze()
}.property("length").cacheable(),contentIndexesInRect:function(d){return null},computeNowShowing:function(){var g=this.contentIndexesInRect(this.get("clippingFrame"));
if(!g){g=this.get("allContentIndexes")}else{var e=this.get("length"),d=g.get("max");
if(d>e){g=g.copy().remove(e,d-e).freeze()}}return g},showInsertionPoint:function(d,e){},hideInsertionPoint:function(){},delegate:null,selectionDelegate:function(){var d=this.get("delegate"),e=this.get("content");
return this.delegateFor("isCollectionViewDelegate",d,e)}.property("delegate","content").cacheable(),contentDelegate:function(){var d=this.get("delegate"),e=this.get("content");
return this.delegateFor("isCollectionContent",d,e)}.property("delegate","content").cacheable(),_contentGroupIndexes:function(){return this.get("contentDelegate").contentGroupIndexes(this,this.get("content"))
}.property("contentDelegate","content").cacheable(),contentRangeDidChange:function(h,e,g,d){if(!e&&(g==="[]")){this.reload(d)
}else{this.contentPropertyDidChange(e,g,d)}},contentPropertyDidChange:function(g,e,d){},updateContentRangeObserver:function(){var h=this.get("nowShowing"),d=this._cv_contentRangeObserver,g=this.get("content");
if(!g){return}if(d){g.updateRangeObserver(d,h)}else{var e=this.contentRangeDidChange;
d=g.addRangeObserver(h,this,e,null);this._cv_contentRangeObserver=d}},removeContentRangeObserver:function(){var e=this.get("content"),d=this._cv_contentRangeObserver;
if(d){if(e){e.removeRangeObserver(d)}this._cv_contentRangeObserver=null}},contentLengthDidChange:function(){var d=this.get("content");
this.set("length",d?d.get("length"):0)},_cv_contentDidChange:function(){var e=this.get("content"),d=this.contentLengthDidChange;
if(e===this._content){return}this.removeContentRangeObserver();if(this._content){this._content.removeObserver("length",this,d)
}this._content=e;if(e){e.addObserver("length",this,d)}this.contentLengthDidChange();
this.contentRangeDidChange(e,null,"[]",null)}.observes("content"),_invalidIndexes:NO,reload:function(d){var e=this._invalidIndexes;
if(d&&e!==YES){if(e){e.add(d)}else{e=this._invalidIndexes=d.clone()}}else{this._invalidIndexes=YES
}if(this.get("isVisibleInWindow")){this.invokeOnce(this.reloadIfNeeded)}return this
},reloadIfNeeded:function(){var G=this._invalidIndexes;if(!G||!this.get("isVisibleInWindow")){return this
}this._invalidIndexes=NO;var C=this.get("content"),D,E,u,I=this.computeLayout(),H=SC.BENCHMARK_RELOAD,g=this.get("nowShowing"),J=this._sc_itemViews,x=this.get("containerView")||this,d,F,B,A,p,y,m,z,j,s,o,K,h,e,l,n,k;
if(G.isIndexSet&&G.contains(g)){G=YES}if(this.willReload){this.willReload(G===YES?null:G)
}d=this.get("exampleView");B=d?d.isReusableInCollections:NO;F=this.get("exampleGroupView");
A=F?F.isReusableInCollections:NO;if(G.isIndexSet){if(H){SC.Benchmark.start(H="%@#reloadIfNeeded (Partial)".fmt(this),YES)
}y=[];m=[];z=[];G.forEach(function(L){u=J?J[L]:null;if(g.contains(L)){if(u&&u.parentView===x){m.push(L)
}else{z.push(L)}}else{if(u&&u.parentView===x){y.push(L)}}},this);for(D=0,E=y.length;
D<E;++D){s=y[D];u=J?J[s]:null;delete J[s];l=this.get("contentDelegate");n=this.get("_contentGroupIndexes");
k=n&&n.contains(s);if(k){k=l.contentIndexIsGroup(this,C,s)}p=k?A:B;if(p){e=k?this._GROUP_VIEW_POOL:this._VIEW_POOL;
e.push(u);u.destroyLayer()}x.removeChild(u)}for(D=0,E=m.length;D<E;++D){s=m[D];u=J?J[s]:null;
o=this.itemViewForContentIndex(s,YES);u.destroyLayer();x.replaceChild(o,u)}for(D=0,E=z.length;
D<E;++D){s=z[D];o=this.itemViewForContentIndex(s,YES);x.insertBefore(o,null)}if(H){SC.Benchmark.end(H)
}}else{if(H){SC.Benchmark.start(H="%@#reloadIfNeeded (Full)".fmt(this),YES)}if(J){J.length=0
}j=x.get("childViews");if(j){j=j.copy()}x.beginPropertyChanges();if(this.willRemoveAllChildren){this.willRemoveAllChildren()
}x.destroyLayer().removeAllChildren();if(j){for(D=0,E=j.length;D<E;++D){o=j[D];k=o.get("isGroupView");
p=k?A:B;if(p){e=k?this._GROUP_VIEW_POOL:this._VIEW_POOL;e.push(o);o.destroyLayer()
}}}j=[];g.forEach(function(L){j.push(this.itemViewForContentIndex(L,YES))},this);
x.set("childViews",j);x.replaceLayer();x.endPropertyChanges();if(H){SC.Benchmark.end(H)
}}if(I){this.adjust(I)}if(this.didReload){this.didReload(G===YES?null:G)}return this
},displayProperties:"isFirstResponder isEnabled isActive".w(),render:function(d,e){if(e&&this._needsReload){this.reloadIfNeeded()
}d.setClass("focus",this.get("isFirstResponder"));d.setClass("disabled",!this.get("isEnabled"));
d.setClass("active",this.get("isActive"));return arguments.callee.base.apply(this,arguments)
},_TMP_ATTRS:{},_COLLECTION_CLASS_NAMES:"sc-collection-item".w(),_GROUP_COLLECTION_CLASS_NAMES:"sc-collection-item sc-group-item".w(),_VIEW_POOL:null,_GROUP_VIEW_POOL:null,itemViewForContentIndex:function(s,d){var G;
var F=this._sc_itemViews;if(!F){F=this._sc_itemViews=[]}else{if(!d&&(G=F[s])){return G
}}var x=this.get("content"),z=x.objectAt(s),m=this.get("contentDelegate"),o=this.get("_contentGroupIndexes"),n=NO,H,p,A,k,B,h,e,g,D,l,j,y,C;
n=o&&o.contains(s);if(n){n=m.contentIndexIsGroup(this,x,s)}if(n){H=this.get("contentGroupExampleViewKey");
if(H&&z){p=z.get(H)}if(!p){p=this.get("groupExampleView")||this.get("exampleView")
}B="_GROUP_VIEW_POOL"}else{H=this.get("contentExampleViewKey");if(H&&z){p=z.get(H)
}if(!p){p=this.get("exampleView")}B="_VIEW_POOL"}g=this.get("containerView")||this;
k=this.layerIdFor(s);D=m.contentIndexIsEnabled(this,x,s);l=m.contentIndexIsSelected(this,x,s);
j=m.contentIndexOutlineLevel(this,x,s);y=m.contentIndexDisclosureState(this,x,s);
C=this.isVisibleInWindow;A=this.layoutForContentIndex(s);if(p&&p.isReusableInCollections){h=this[B];
if(!h){h=this[B]=[]}if(h.length>0){G=h.pop();e=G.prepareForReuse;if(e){e.call(G)}G.beginPropertyChanges();
G.set("contentIndex",s);G.set("layerId",k);G.set("isEnabled",D);G.set("isSelected",l);
G.set("outlineLevel",j);G.set("disclosureState",y);G.set("isVisibleInWindow",C);G.set("parentView",g);
SC.View.views[k]=G;if(A){G.set("layout",A)}else{G.set("layout",p.prototype.layout)
}G.set("content",z);G.endPropertyChanges()}}if(!G){var u=this._TMP_ATTRS;u.contentIndex=s;
u.content=z;u.owner=u.displayDelegate=this;u.parentView=g;u.page=this.page;u.layerId=k;
u.isEnabled=D;u.isSelected=l;u.outlineLevel=j;u.disclosureState=y;u.isGroupView=n;
u.isVisibleInWindow=C;if(n){u.classNames=this._GROUP_COLLECTION_CLASS_NAMES}else{u.classNames=this._COLLECTION_CLASS_NAMES
}if(A){u.layout=A}else{delete u.layout}G=this.createItemView(p,s,u)}F[s]=G;return G
},itemViewForContentObject:function(d){return this.itemViewForContentIndex(this.get("content").indexOf(d))
},_TMP_LAYERID:[],createItemView:function(g,d,e){return g.create(e)},layerIdFor:function(d){var e=this._TMP_LAYERID;
e[0]=SC.guidFor(this);e[1]=d;return e.join("-")},contentIndexForLayerId:function(g){if(!g||!(g=g.toString())){return null
}var e=this._baseLayerId;if(!e){e=this._baseLayerId=SC.guidFor(this)+"-"}if((g.length<=e.length)||(g.indexOf(e)!==0)){return null
}var d=Number(g.slice(g.lastIndexOf("-")+1));return isNaN(d)?null:d},itemViewForEvent:function(o){var h=this.getPath("pane.rootResponder");
if(!h){return null}var g=SC.guidFor(this)+"-",d=g.length,j=o.target,l=this.get("layer"),k=null,e,n,m;
while(j&&j!==document&&j!==l){e=j?SC.$(j).attr("id"):null;if(e&&(k=this.contentIndexForLayerId(e))!==null){break
}j=j.parentNode}if(k===null||(j===l)){j=l=null;return null}if(k>=this.get("length")){throw"layout for item view %@ was found when item view does not exist (%@)".fmt(e,this)
}return this.itemViewForContentIndex(k)},expand:function(e){if(!e){return this}var d=this.get("contentDelegate"),g=this.get("content");
e.forEach(function(h){var j=d.contentIndexDisclosureState(this,g,h);if(j===SC.BRANCH_CLOSED){d.contentIndexExpand(this,g,h)
}},this);return this},collapse:function(e){if(!e){return this}var d=this.get("contentDelegate"),g=this.get("content");
e.forEach(function(h){var j=d.contentIndexDisclosureState(this,g,h);if(j===SC.BRANCH_OPEN){d.contentIndexCollapse(this,g,h)
}},this);return this},_cv_selectionDidChange:function(){var g=this.get("selection"),e=this._cv_selection,d=this._cv_selectionContentDidChange;
if(g===e){return}if(e){e.removeObserver("[]",this,d)}if(g){g.addObserver("[]",this,d)
}this._cv_selection=g;this._cv_selectionContentDidChange()}.observes("selection"),_cv_selectionContentDidChange:function(){var g=this.get("selection"),e=this._cv_selindexes,d=this.get("content"),h;
this._cv_selindexes=g?g.frozenCopy():null;if(e){e=e.indexSetForSource(d)}if(g){g=g.indexSetForSource(d)
}if(g&&e){h=g.without(e).add(e.without(g))}else{h=g||e}if(h&&h.get("length")>0){this.reloadSelectionIndexes(h)
}},_invalidSelection:NO,reloadSelectionIndexes:function(d){var e=this._invalidSelection;
if(d&&(e!==YES)){if(e){e.add(d)}else{e=this._invalidSelection=d.copy()}}else{this._invalidSelection=YES
}if(this.get("isVisibleInWindow")){this.invokeOnce(this.reloadSelectionIndexesIfNeeded)
}return this},reloadSelectionIndexesIfNeeded:function(){var j=this._invalidSelection;
if(!j||!this.get("isVisibleInWindow")){return this}var h=this.get("nowShowing"),e=this._invalidIndexes,d=this.get("content"),g=this.get("selection");
this._invalidSelection=NO;if(e===YES||!h){return this}if(j===YES){j=h}if(e&&e.isIndexSet){j=j.without(e)
}j.forEach(function(k){if(!h.contains(k)){return}var l=this.itemViewForContentIndex(k,NO);
if(l){l.set("isSelected",g?g.contains(d,k):NO)}},this);return this},select:function(g,k){var h=this.get("content"),d=this.get("selectionDelegate"),e=this.get("_contentGroupIndexes"),j;
if(!this.get("isSelectable")){return this}if(SC.typeOf(g)===SC.T_NUMBER){g=SC.IndexSet.create(g,1)
}if(g&&g.get("length")>0){if(e&&e.get("length")>0){g=g.copy().remove(e)}g=d.collectionViewShouldSelectIndexes(this,g,k);
if(!g||g.get("length")===0){return this}}else{g=null}if(k&&(j=this.get("selection"))){j=j.copy()
}else{j=SC.SelectionSet.create()}if(g&&g.get("length")>0){if(g.get("length")===1){j.addObject(h.objectAt(g.get("firstObject")))
}else{j.add(h,g)}}j=d.collectionViewSelectionForProposedSelection(this,j);if(!j){j=SC.SelectionSet.create()
}this._selectionAnchor=null;this.set("selection",j.freeze());return this},deselect:function(e){var h=this.get("selection"),g=this.get("content"),d=this.get("selectionDelegate");
if(!this.get("isSelectable")){return this}if(!h||h.get("length")===0){return this
}if(SC.typeOf(e)===SC.T_NUMBER){e=SC.IndexSet.create(e,1)}e=d.collectionViewShouldDeselectIndexes(this,e);
if(!e||e.get("length")===0){return this}h=h.copy().remove(g,e);h=d.collectionViewSelectionForProposedSelection(this,h);
if(!h){h=SC.SelectionSet.create()}this.set("selection",h.freeze());return this},_findNextSelectableItemFromIndex:function(m,d){var g=this.get("length"),h=SC.IndexSet.create(),j=this.get("content"),n=this.get("selectionDelegate"),l=this.get("_contentGroupIndexes"),k,e;
if(!l&&(n.collectionViewShouldSelectIndexes===this.collectionViewShouldSelectIndexes)){return m
}while(m<g){if(!l||!l.contains(m)){h.add(m);k=n.collectionViewShouldSelectIndexes(this,h);
if(k&&k.get("length")>=1){return m}h.remove(m)}m++}if(d===undefined){e=this.get("selection");
d=e?e.get("max"):-1}return d},_findPreviousSelectableItemFromIndex:function(e,m){var g=SC.IndexSet.create(),k=this.get("content"),d=this.get("selectionDelegate"),j=this.get("_contentGroupIndexes"),h;
if(SC.none(e)){e=-1}if(!j&&(d.collectionViewShouldSelectIndexes===this.collectionViewShouldSelectIndexes)){return e
}while(e>=0){if(!j||!j.contains(e)){g.add(e);h=d.collectionViewShouldSelectIndexes(this,g);
if(h&&h.get("length")>=1){return e}g.remove(e)}e--}if(m===undefined){var l=this.get("selection");
m=l?l.get("min"):-1}if(SC.none(m)){m=-1}return m},selectPreviousItem:function(m,e){if(SC.none(e)){e=1
}if(SC.none(m)){m=false}var k=this.get("selection"),j=this.get("content");if(k){k=k.indexSetForSource(j)
}var l=k?k.get("min"):-1,d=k?k.get("max")-1:-1,h=this._selectionAnchor;if(SC.none(h)){h=l
}if(m){if(d>h){d=d-e}else{l=this._findPreviousSelectableItemFromIndex(l-e)}if(SC.none(l)||(l<0)){l=0
}if(d<l){d=l}}else{l=this._findPreviousSelectableItemFromIndex(l-e);if(SC.none(l)||(l<0)){l=0
}d=l;h=null}var g=l;k=SC.IndexSet.create(l,d+1-l);this.scrollToContentIndex(g);this.select(k);
this._selectionAnchor=h;return this},selectNextItem:function(m,n){if(SC.none(n)){n=1
}if(SC.none(m)){m=false}var e=this.get("selection"),l=this.get("content");if(e){e=e.indexSetForSource(l)
}var d=e?e.get("min"):-1,h=e?e.get("max")-1:-1,j=this._selectionAnchor,g=this.get("length");
if(SC.none(j)){j=d}if(m){if(d<j){d=d+n}else{h=this._findNextSelectableItemFromIndex(h+n,h)
}if(h>=g){h=g-1}if(d>h){d=h}}else{h=this._findNextSelectableItemFromIndex(h+n,h);
if(h>=g){h=g-1}d=h;j=null}var k=h;e=SC.IndexSet.create(d,h-d+1);this.scrollToContentIndex(k);
this.select(e);this._selectionAnchor=j;return this},deleteSelection:function(){if(!this.get("canDeleteContent")){return NO
}var h=this.get("selection"),g=this.get("content"),d=this.get("selectionDelegate"),e=h&&g?h.indexSetForSource(g):null;
if(!g||!e||e.get("length")===0){return NO}e=d.collectionViewShouldDeleteIndexes(this,e);
if(!e||e.get("length")===0){return NO}d.collectionViewDeleteContent(this,this.get("content"),e);
return YES},scrollToContentIndex:function(e){var d=this.itemViewForContentIndex(e);
if(d){this.scrollToItemView(d)}return this},scrollToItemView:function(d){if(d){d.scrollToVisible()
}return this},keyDown:function(d){var e=this.interpretKeyEvents(d);return !e?NO:e
},keyUp:function(){return true},insertText:function(e,d){if(e===" "){var g=this.get("selection");
if(g&&g.get("length")>0){this.invokeLater(this._cv_action,0,null,d)}return YES}else{return NO
}},selectAll:function(d){var e=this.get("content"),g=e?SC.IndexSet.create(0,e.get("length")):null;
this.select(g,NO);return YES},deleteBackward:function(d){return this.deleteSelection()
},deleteForward:function(d){return this.deleteSelection()},moveDown:function(e,d){this.selectNextItem(false,this.get("itemsPerRow")||1);
this._cv_performSelectAction(null,d,this.ACTION_DELAY);return true},moveUp:function(e,d){this.selectPreviousItem(false,this.get("itemsPerRow")||1);
this._cv_performSelectAction(null,d,this.ACTION_DELAY);return true},moveLeft:function(k,s){if((this.get("itemsPerRow")||1)>1){this.selectPreviousItem(false,1);
this._cv_performSelectAction(null,s,this.ACTION_DELAY)}else{var g=this.get("selection"),o=this.get("content"),m=g?g.indexSetForSource(o):null;
if(m){var u=undefined,l=false,n=undefined;if(m.get("length")===1){n=m.get("firstObject");
u=this.get("contentDelegate");var e=u.contentIndexDisclosureState(this,o,n);if(e!==SC.BRANCH_OPEN){l=true
}}if(l){var d=u.contentIndexOutlineLevel(this,o,n)-1;if(d>=0){var j=-1;while(j<0){var h=this._findPreviousSelectableItemFromIndex(n-1);
if(h<0){return false}n=h;var p=u.contentIndexOutlineLevel(this,o,n);if(p===d){j=h
}}if(j!==-1){this.select(n)}}}else{this.collapse(m)}}}return true},moveRight:function(g,d){if((this.get("itemsPerRow")||1)>1){this.selectNextItem(false,1);
this._cv_performSelectAction(null,d,this.ACTION_DELAY)}else{var j=this.get("selection"),h=this.get("content"),e=j?j.indexSetForSource(h):null;
if(e){this.expand(e)}}return true},moveDownAndModifySelection:function(e,d){this.selectNextItem(true,this.get("itemsPerRow")||1);
this._cv_performSelectAction(null,d,this.ACTION_DELAY);return true},moveUpAndModifySelection:function(e,d){this.selectPreviousItem(true,this.get("itemsPerRow")||1);
this._cv_performSelectAction(null,d,this.ACTION_DELAY);return true},moveLeftAndModifySelection:function(e,d){if((this.get("itemsPerRow")||1)>1){this.selectPreviousItem(true,1);
this._cv_performSelectAction(null,d,this.ACTION_DELAY)}return true},moveRightAndModifySelection:function(e,d){if((this.get("itemsPerRow")||1)>1){this.selectNextItem(true,1);
this._cv_performSelectAction(null,d,this.ACTION_DELAY)}return true},insertNewline:function(h,g){var e=this.get("isEditable")&&this.get("canEditContent"),l,k,m,d,j;
if(e){l=this.get("selection");k=this.get("content");if(l&&l.get("length")===1){m=l.indexSetForSource(k);
d=m?m.get("min"):-1;e=d>=0}}if(e){j=this.itemViewForContentIndex(d);e=j&&SC.typeOf(j.beginEditing)===SC.T_FUNCTION
}if(e){this.scrollToContentIndex(d);j=this.itemViewForContentIndex(d);j.beginEditing()
}else{this.invokeLater(this._cv_action,0,j,null)}return YES},mouseDown:function(n){if(this.get("useToggleSelection")){return true
}var l=this.itemViewForEvent(n),k=this.get("content"),j=l?l.get("contentIndex"):-1,g,h,m=k.get("allowsMultipleSelection");
g=this.mouseDownInfo={event:n,itemView:l,contentIndex:j,at:Date.now()};this.becomeFirstResponder();
if(!l){if(this.get("allowDeselectAll")){this.select(null,false)}return YES}var e=this.get("selection"),d,o;
if(e){e=e.indexSetForSource(k)}d=e?e.contains(j):NO;g.modifierKeyPressed=o=n.ctrlKey||n.metaKey;
if(o&&d){g.shouldDeselect=j>=0}else{if(n.shiftKey&&e&&e.get("length")>0&&m){e=this._findSelectionExtendedByShift(e,j);
h=this._selectionAnchor;this.select(e);this._selectionAnchor=h}else{if(!o&&d){g.shouldReselect=j>=0
}else{if((n.shiftKey||o)&&!m){this.select(null,false)}if(this.get("selectOnMouseDown")){this.select(j,o)
}else{g.shouldSelect=j>=0}}}}g.previousContentIndex=j;return YES},mouseUp:function(m){var n=this.itemViewForEvent(m),h=this.mouseDownInfo,j,g,d,e,l,k,o;
if(this.get("useToggleSelection")){if(!n){return}g=this.get("selection");j=(n)?n.get("contentIndex"):-1;
d=g&&g.include(j);if(d){this.deselect(j)}else{this.select(j,YES)}}else{if(h){o=h.contentIndex;
j=(n)?n.get("contentIndex"):-1;if(h.shouldSelect){this.select(o,h.modifierKeyPressed)
}if(h.shouldDeselect){this.deselect(o)}if(h.shouldReselect){e=this.get("isEditable")&&this.get("canEditContent");
if(e){g=this.get("selection");e=g&&(g.get("length")===1)}if(e){l=this.itemViewForContentIndex(o);
e=l&&(!l.contentHitTest||l.contentHitTest(m));e=(e&&l.beginEditing)?l.beginEditing():NO
}if(!e){if(this._cv_reselectTimer){this._cv_reselectTimer.invalidate()}this._cv_reselectTimer=this.invokeLater(this.select,300,o,false)
}}this._cleanupMouseDown()}}this._cv_performSelectAction(n,m,0,m.clickCount);return NO
},_cleanupMouseDown:function(){var e=this.mouseDownInfo,d;if(e){for(d in e){if(!e.hasOwnProperty(d)){continue
}delete e[d]}}this.mouseDownInfo=null},mouseMoved:function(g){var d=this.itemViewForEvent(g),e=this._lastHoveredItem;
if(d!==e){if(e&&e.mouseOut){e.mouseOut(g)}if(d&&d.mouseOver){d.mouseOver(g)}}this._lastHoveredItem=d;
if(d&&d.mouseMoved){d.mouseMoved(g)}return YES},mouseOut:function(e){var d=this._lastHoveredItem;
this._lastHoveredItem=null;if(d&&d.mouseOut){d.mouseOut(e)}return YES},touchStart:function(h){if(this.get("useToggleSelection")){return true
}var e=this.itemViewForEvent(h),g=this.get("content"),k=e?e.get("contentIndex"):-1,j,d;
this.becomeFirstResponder();this.select(k,NO);return SC.MIXED_STATE},touchesDragged:function(d){this.select(null,NO);
return SC.MIXED_STATE},touchCancelled:function(d){this.select(null,NO)},_findSelectionExtendedByShift:function(j,m){if(!j||j.get("length")===0){return SC.IndexSet.create(m)
}var h=this.get("content"),l=h.get("length")-1,g=j.get("min"),d=j.get("max")-1,k=this.mouseDownInfo,e=this._selectionAnchor;
if(SC.none(e)){e=-1}if(m<g){g=m;if(e<0){this._selectionAnchor=e=d}}else{if(m>d){d=m;
if(e<0){this._selectionAnchor=e=g}}else{if(m>=g&&m<=d){if(e<0){this._selectionAnchor=e=g
}if(m===e){g=d=m}else{if(m>e){g=e;d=m}else{if(m<e){g=m;d=e}}}}}}return SC.IndexSet.create(g,d-g+1)
},reorderDataType:function(){return"SC.CollectionView.Reorder."+SC.guidFor(this)}.property().cacheable(),dragContent:null,proposedInsertionIndex:null,proposedDropOperation:null,mouseDragged:function(m){var n=this.get("selectionDelegate"),j=this.get("content"),d=this.get("selection"),g=this.mouseDownInfo,k=this.get("_contentGroupIndexes"),h,e,l;
if(!g||g.contentIndex<0){return YES}if((Date.now()-g.at)<123){return YES}if(n.collectionViewShouldBeginDrag(this)){if(!this.get("selectOnMouseDown")){h=SC.IndexSet.create(g.contentIndex)
}else{h=d?d.indexSetForSource(j):null}if(h&&k&&k.get("length")>0){h=h.copy().remove(k);
if(h.get("length")===0){h=null}else{h.freeze()}}if(!h){return YES}else{h=h.frozenCopy()
}h={content:j,indexes:h};this.set("dragContent",h);e=this.get("dragDataTypes");if(e&&e.get("length")>0){l=n.collectionViewDragViewFor(this,h.indexes);
if(!l){l=this._cv_dragViewFor(h.indexes)}l.createLayer();SC.Drag.start({event:g.event,source:this,dragView:l,ghost:NO,ghostActsLikeCursor:n.ghostActsLikeCursor,slideBack:YES,dataSource:this});
this._cleanupMouseDown();this._lastInsertionIndex=null}else{this.set("dragContent",null)
}return YES}},_cv_dragViewFor:function(h){var e=this.get("nowShowing").without(h);
e=this.get("nowShowing").without(e);var g=this.get("layer").cloneNode(false);var d=SC.View.create({layer:g,parentView:this});
SC.$(g).css("backgroundColor","transparent").css("border","none").css("top",0).css("left",0);
e.forEach(function(l){var m=this.itemViewForContentIndex(l),j,k;if(m){j=m.get("isSelected");
m.set("isSelected",NO);m.updateLayerIfNeeded();k=m.get("layer");if(k){k=k.cloneNode(true)
}m.set("isSelected",j);m.updateLayerIfNeeded()}if(k){g.appendChild(k)}k=null},this);
g=null;return d},dragDataTypes:function(){var d=this.get("selectionDelegate"),e=d.collectionViewDragDataTypes(this),g;
if(this.get("canReorderContent")){e=e?e.copy():[];g=this.get("reorderDataType");if(e.indexOf(g)<0){e.push(g)
}}return e?e:[]}.property(),dragDataForType:function(g,e){if(this.get("canReorderContent")){if(e===this.get("reorderDataType")){return this.get("dragContent")
}}var d=this.get("selectionDelegate");return d.collectionViewDragDataForType(this,g,e)
},computeDragOperations:function(g,e){var h=SC.DRAG_NONE,d=this.get("selectionDelegate");
if(this.get("canReorderContent")){if(g.get("dataTypes").indexOf(this.get("reorderDataType"))>=0){h=SC.DRAG_REORDER
}}h=d.collectionViewComputeDragOperations(this,g,h);if(h&SC.DRAG_REORDER){h=SC.DRAG_MOVE
}return h},_computeDropOperationState:function(g,s,j){var l=this.convertFrameFromView(g.get("location"),null),p=SC.DROP_BEFORE,u=this.get("selectionDelegate"),h=this.get("canReorderContent"),x,m,d,n,k,e;
var o=this.insertionIndexForLocation(l,SC.DROP_ON);if(SC.typeOf(o)===SC.T_ARRAY){p=o[1];
o=o[0]}if(p===SC.DROP_ON){this.set("proposedInsertionIndex",o);this.set("proposedDropOperation",p);
e=u.collectionViewValidateDragOperation(this,g,j,o,p);o=this.get("proposedInsertionIndex");
p=this.get("proposedDropOperation");this._dropInsertionIndex=this._dropOperation=null;
if(e!==SC.DRAG_NONE){return[o,p,e]}else{p=SC.DROP_BEFORE;o=this.insertionIndexForLocation(l,SC.DROP_BEFORE);
if(SC.typeOf(o)===SC.T_ARRAY){p=o[1];o=o[0]}}}if((o>=0)&&h&&(p!==SC.DROP_ON)){x=g.dataForType(this.get("reorderDataType"));
if(x){m=this.get("content");if(p===SC.DROP_BEFORE){d=x.indexes.contains(o-1);n=x.indexes.contains(o)
}else{d=x.indexes.contains(o);n=x.indexes.contains(o-1)}if(d&&n){if(SC.none(this._lastInsertionIndex)){if(p===SC.DROP_BEFORE){while((o>=0)&&x.indexes.contains(o)){o--
}}else{k=m?m.get("length"):0;while((o<k)&&x.indexes.contains(o)){o++}}}else{o=this._lastInsertionIndex
}}if(o>=0){j=SC.DRAG_REORDER}}}this.set("proposedInsertionIndex",o);this.set("proposedDropOperation",p);
j=u.collectionViewValidateDragOperation(this,g,j,o,p);o=this.get("proposedInsertionIndex");
p=this.get("proposedDropOperation");this._dropInsertionIndex=this._dropOperation=null;
return[o,p,j]},dragUpdated:function(k,e){var m=k.get("allowedDragOperations"),l=this._computeDropOperationState(k,e,m),d=l[0],g=l[1],j=l[2];
if(j!==SC.DRAG_NONE){if((this._lastInsertionIndex!==d)||(this._lastDropOperation!==g)){var h=this.itemViewForContentIndex(d);
this.showInsertionPoint(h,g)}this._lastInsertionIndex=d;this._lastDropOperation=g
}else{this.hideInsertionPoint();this._lastInsertionIndex=this._lastDropOperation=null
}return(j&SC.DRAG_REORDER)?SC.DRAG_MOVE:j},dragExited:function(){this.hideInsertionPoint();
this._lastInsertionIndex=this._lastDropOperation=null},acceptDragOperation:function(d,e){return YES
},performDragOperation:function(j,l){var d=this._computeDropOperationState(j,null,l),p=d[0],o=d[1],m=d[2],s=this.get("selectionDelegate"),g,u,h,n,e,k;
if(m&SC.DRAG_REORDER){l=(l&SC.DRAG_MOVE)?SC.DRAG_REORDER:SC.DRAG_NONE}else{l=l&m}if(l===SC.DRAG_NONE){return l
}g=s.collectionViewPerformDragOperation(this,j,l,p,o);if((g===SC.DRAG_NONE)&&(l&SC.DRAG_REORDER)){h=j.dataForType(this.get("reorderDataType"));
if(!h){return SC.DRAG_NONE}n=this.get("content");k=h.indexes;if(k.get("length")===1){if(((o===SC.DROP_BEFORE)||(o===SC.DROP_AFTER))&&(k.get("min")===p)){return SC.DRAG_MOVE
}}n.beginPropertyChanges();u=[];e=0;h.indexes.forEach(function(x){u.push(n.objectAt(x-e));
n.removeAt(x-e);e++;if(x<p){p--}},this);if(o===SC.DROP_AFTER){p++}n.replace(p,0,u,o);
this.select(SC.IndexSet.create(p,u.length));n.endPropertyChanges();l=SC.DRAG_MOVE
}return l},collectionViewShouldBeginDrag:function(d){return this.get("canReorderContent")
},insertionIndexForLocation:function(d,e){return -1},_cv_isVisibleInWindowDidChange:function(){if(this.get("isVisibleInWindow")){if(this._invalidIndexes){this.invokeOnce(this.reloadIfNeeded)
}if(this._invalidSelection){this.invokeOnce(this.reloadSelectionIndexesIfNeeded)}}}.observes("isVisibleInWindow"),collectionViewShouldSelectItem:function(d,e){return this.get("isSelectable")
},_TMP_DIFF1:SC.IndexSet.create(),_TMP_DIFF2:SC.IndexSet.create(),_cv_nowShowingDidChange:function(){var e=this.get("nowShowing"),d=this._sccv_lastNowShowing,h,j,g;
if(d!==e){if(d&&e){j=this._TMP_DIFF1.add(d).remove(e);g=this._TMP_DIFF2.add(e).remove(d);
h=j.add(g)}else{h=d||e}}if(h&&h.get("length")>0){this._sccv_lastNowShowing=e?e.frozenCopy():null;
this.updateContentRangeObserver();this.reload(h)}if(j){j.clear()}if(g){g.clear()}}.observes("nowShowing"),init:function(){arguments.callee.base.apply(this,arguments);
if(this.get("canReorderContent")){this._cv_canReorderContentDidChange()}this._sccv_lastNowShowing=this.get("nowShowing").clone();
if(this.content){this._cv_contentDidChange()}if(this.selection){this._cv_selectionDidChange()
}},_cv_canReorderContentDidChange:function(){if(this.get("canReorderContent")){if(!this.get("isDropTarget")){this.set("isDropTarget",YES)
}SC.Drag.addDropTarget(this)}}.observes("canReorderContent"),_cv_performSelectAction:function(e,h,g,d){var j;
if(g===undefined){g=0}if(d===undefined){d=1}if((d>1)||this.get("actOnSelect")){if(this._cv_reselectTimer){this._cv_reselectTimer.invalidate()
}j=this.get("selection");j=j?j.toArray():[];if(this._cv_actionTimer){this._cv_actionTimer.invalidate()
}this._cv_actionTimer=this.invokeLater(this._cv_action,g,e,h,j)}},_cv_action:function(e,d,g){var h=this.get("action");
var j=this.get("target")||null;this._cv_actionTimer=null;if(h){if(SC.typeOf(h)===SC.T_FUNCTION){return this.action(e,d)
}var k=this.get("pane");if(k){k.rootResponder.sendAction(h,j,this,k,g)}}else{if(!e){return
}else{if(SC.typeOf(e._action)==SC.T_FUNCTION){return e._action(d)}else{if(SC.typeOf(e.action)==SC.T_FUNCTION){return e.action(d)
}}}}}});SC.DateFieldView=SC.TextFieldView.extend({value:null,showDate:YES,showTime:NO,formatTime:"%I:%M %p",formatDate:"%d/%m/%Y",formatDateTime:"%d/%m/%Y %I:%M %p",_dtConstants:"%a %b %d %H %I %j %m %M %p %S %U %W %y %Y".w(),_wtConstants:[3,3,2,2,2,3,2,2,2,2,2,2,2,4],activeSelection:0,format:function(){var d=this.get("showTime");
var e=this.get("showDate");if(d===YES&&e===YES){return this.get("formatDateTime")
}if(d===YES){return this.get("formatTime")}return this.get("formatDate")}.property("showTime","showDate").cacheable(),validator:function(){return SC.Validator.DateTime.extend({format:this.get("format")})
}.property("format").cacheable(),tabsSelections:function(){var k=[];var h=this.get("format");
var n=this.get("_dtConstants");var e=this.get("_wtConstants");if(SC.empty(h)){throw"The format string is empty, and must be a valid string."
}var l,o,g,j=0,d=0,m=0;while(j<h.length&&h.indexOf("%",j)!==-1){l=h.indexOf("%",j);
o=h.substring(l,l+2);j=l+2;g=n.indexOf(o);if(g===-1){throw"SC.DateFieldView: The format's key '%@' is not supported.".fmt(o)
}d=d+l-m;k.push(SC.Object.create({key:o,textSelection:SC.TextSelection.create({start:d,end:d+e[g]})}));
d=d+e[g];m=j}l=o=g=null;return k}.property("format").cacheable(),updateTextSelecitonObserver:function(){var d=this.get("activeSelection");
var e=this.get("tabsSelections");if(this.get("isEditing")){this.selection(null,e[d].get("textSelection"))
}}.observes("activeSelection","value"),updateValue:function(e,g){var j=(g===0)?-1:1;
var h=this.get("value"),d;switch(e){case"%a":case"%d":case"%j":this.set("value",h.advance({day:j}));
break;case"%b":case"%m":this.set("value",h.advance({month:j}));break;case"%H":case"%I":this.set("value",h.advance({hour:j}));
break;case"%M":this.set("value",h.advance({minute:j}));break;case"%p":d=h.get("hour")>=12?-12:12;
this.set("value",h.advance({hour:d}));break;case"%S":this.set("value",h.advance({second:j}));
break;case"%U":this.set("value",h.advance({week1:j}));break;case"%W":this.set("value",h.advance({week0:j}));
break;case"%y":case"%Y":this.set("value",h.advance({year:j}));break}},_selectRootElement:function(){},keyDown:function(d){if(this.interpretKeyEvents(d)){d.stop();
return YES}return arguments.callee.base.apply(this,arguments)},ctrl_a:function(){return YES
},moveUp:function(e){var d=this.get("activeSelection");var g=this.get("tabsSelections");
this.updateValue(g[d].get("key"),1);return YES},moveDown:function(e){var d=this.get("activeSelection");
var g=this.get("tabsSelections");this.updateValue(g[d].get("key"),0);return YES},insertText:function(d){return YES
},moveRight:function(d){var g=this.get("tabsSelections");var e=this.get("activeSelection")+1;
if(e===g.length){e=0}this.set("activeSelection",e);return YES},moveLeft:function(d){var g=this.get("tabsSelections");
var e=this.get("activeSelection")-1;if(e===-1){e=g.length-1}this.set("activeSelection",e);
return YES},insertTab:function(d){var g=this.get("tabsSelections");var e=this.get("activeSelection")+1;
if(e<g.length){this.set("activeSelection",e);return YES}return NO},insertBacktab:function(d){var e=this.get("activeSelection")-1;
if(e!==-1){this.set("activeSelection",e);return YES}return NO},mouseUp:function(e){var g=arguments.callee.base.apply(this,arguments);
var j=this.get("selection");if(SC.none(j)){this.set("activeSelection",0)}else{var m=j.get("start");
var l=this.get("tabsSelections");var d=l.length,k;for(var h=0;h<d;h++){k=l[h].get("textSelection");
if(m>=k.get("start")&&m<=k.get("end")){this.set("activeSelection",h)}}}return g},deleteBackward:function(d){return YES
},deleteForward:function(d){return YES}});SC.DisclosureView=SC.ButtonView.extend({classNames:["sc-disclosure-view"],theme:"disclosure",buttonBehavior:SC.TOGGLE_BEHAVIOR,toggleOnValue:YES,toggleOffValue:NO,valueBindingDefault:SC.Binding.bool(),render:function(d,g){var e=this.get("displayTitle");
if(g){d.push('<img src="',SC.BLANK_IMAGE_URL,'" class="button" alt="" />');if(this.get("needsEllipsis")){d.push('<span class="ellipsis sc-button-label">',e,"</span>")
}else{d.push('<span class="sc-button-label">',e,"</span>")}}else{this.$("label").text(e)
}},keyDown:function(d){if(d.which===37||d.which===38){this.set("value",this.get("toggleOffValue"));
return YES}if(d.which===39||d.which===40){this.set("value",this.get("toggleOnValue"));
return YES}arguments.callee.base.apply(this,arguments)}});require("views/list");SC.GridView=SC.ListView.extend({classNames:["sc-grid-view"],layout:{left:0,right:0,top:0,bottom:0},rowHeight:48,columnWidth:64,exampleView:SC.LabelView,insertionOrientation:SC.HORIZONTAL_ORIENTATION,itemsPerRow:function(){var e=this.get("frame"),d=this.get("columnWidth")||0;
return(d<=0)?1:Math.floor(e.width/d)}.property("clippingFrame","columnWidth").cacheable(),contentIndexesInRect:function(j){var h=this.get("rowHeight")||48,e=this.get("itemsPerRow"),g=Math.floor(SC.minY(j)/h)*e,d=Math.ceil(SC.maxY(j)/h)*e;
return SC.IndexSet.create(g,d-g)},layoutForContentIndex:function(l){var h=this.get("rowHeight")||48,d=this.get("clippingFrame").width,e=this.get("itemsPerRow"),j=Math.floor(d/e),k=Math.floor(l/e),g=l-(e*k);
return{left:g*j,top:k*h,height:h,width:j}},computeLayout:function(){var j=this.get("content"),h=(j)?j.get("length"):0,g=this.get("rowHeight")||48,d=this.get("itemsPerRow"),k=Math.ceil(h/d);
var e=this._cachedLayoutHash;if(!e){e=this._cachedLayoutHash={}}e.minHeight=k*g;this.calculatedHeight=e.minHeight;
return e},insertionPointClass:SC.View.extend({classNames:["grid-insertion-point"],render:function(d,e){if(e){d.push('<span class="anchor"></span>')
}}}),showInsertionPoint:function(g,j){if(!g){return}if(j===SC.DROP_ON){if(g!==this._dropOnInsertionPoint){this.hideInsertionPoint();
this._dropOnInsertionPoint=g}}else{if(this._dropOnInsertionPoint){this._dropOnInsertionPoint=null
}if(!this._insertionPointView){this._insertionPointView=this.insertionPointClass.create()
}var e=this._insertionPointView;var d=g.get("frame");var h={height:d.height-6,x:d.x,y:d.y+6,width:0};
if(!SC.rectsEqual(e.get("frame"),h)){e.set("frame",h)}if(e.parentNode!==g.parentNode){g.parentNode.appendChild(e)
}}},hideInsertionPoint:function(){var d=this._insertionPointView;if(d){d.removeFromParent()
}if(this._dropOnInsertionPoint){this._dropOnInsertionPoint=null}},insertionIndexForLocation:function(h,n){var j=this.get("frame"),k=this.get("clippingFrame"),o=this.get("itemsPerRow"),d=Math.floor(j.width/o),s=Math.floor((h.y-j.y-k.y)/this.get("rowHeight"));
var m=SC.DROP_BEFORE,g=(h.x-j.x-k.x),e=Math.floor(g/d),p=(g/d)-e;if(n===SC.DROP_ON){if(p>0.8){e++
}if((p>=0.2)&&(p<=0.8)){m=SC.DROP_ON}}else{if(p>0.45){e++}}var l=(s*o)+e;return[l,m]
},_gv_clippingFrameDidChange:function(){var h=this.get("nowShowing"),g,e,d;this.notifyPropertyChange("itemsPerRow");
d=h.get("length");for(e=0;e<d;e++){g=this.itemViewForContentIndex(e);g.adjust(this.layoutForContentIndex(e))
}}.observes("clippingFrame")});sc_require("views/collection");sc_require("mixins/collection_row_delegate");
SC.ListView=SC.CollectionView.extend(SC.CollectionRowDelegate,{classNames:["sc-list-view"],acceptsFirstResponder:YES,showAlternatingRows:NO,render:function(d,e){d.setClass("alternating",this.get("showAlternatingRows"));
return arguments.callee.base.apply(this,arguments)},rowDelegate:function(){var d=this.delegate,e=this.get("content");
return this.delegateFor("isCollectionRowDelegate",d,e)}.property("delegate","content").cacheable(),_sclv_rowDelegateDidChange:function(){var h=this._sclv_rowDelegate,e=this.get("rowDelegate"),g=this._sclv_rowHeightDidChange,d=this._sclv_customRowHeightIndexesDidChange;
if(h===e){return this}this._sclv_rowDelegate=e;if(h){h.removeObserver("rowHeight",this,g);
h.removeObserver("customRowHeightIndexes",this,d)}if(!e){throw"Internal Inconsistancy: ListView must always have CollectionRowDelegate"
}e.addObserver("rowHeight",this,g);e.addObserver("customRowHeightIndexes",this,d);
this._sclv_rowHeightDidChange()._sclv_customRowHeightIndexesDidChange();return this
}.observes("rowDelegate"),_sclv_rowHeightDidChange:function(){var e=this.get("rowDelegate"),d=e.get("rowHeight"),g;
if(d===this._sclv_rowHeight){return this}this._sclv_rowHeight=d;g=SC.IndexSet.create(0,this.get("length"));
this.rowHeightDidChangeForIndexes(g);return this},_sclv_customRowHeightIndexesDidChange:function(){var d=this.get("rowDelegate"),e=d.get("customRowHeightIndexes"),h=this._sclv_customRowHeightIndexes,g=this._sclv_customRowHeightIndexesContentDidChange;
if((e===h)||(h&&h.isEqual(e))){return this}if(h&&this._sclv_isObservingCustomRowHeightIndexes){h.removeObserver("[]",this,g)
}if(this._sclv_isObservingCustomRowHeightIndexes=e&&!e.get("isFrozen")){e.addObserver("[]",this,g)
}this._sclv_customRowHeightIndexesContentDidChange();return this},_sclv_customRowHeightIndexesContentDidChange:function(){var d=this.get("rowDelegate"),e=d.get("customRowHeightIndexes"),g=this._sclv_customRowHeightIndexes,h;
if(e&&g){h=e.copy().add(g)}else{h=e||g}this._sclv_customRowHeightIndexes=e?e.frozenCopy():null;
this.rowHeightDidChangeForIndexes(h);return this},rowOffsetForContentIndex:function(m){if(m===0){return 0
}var o=this.get("rowDelegate"),d=o.get("rowHeight"),k,j,g,e,n,l,h;j=m*d;k=this.get("rowSpacing");
if(k){j+=m*k}if(o.customRowHeightIndexes&&(g=o.get("customRowHeightIndexes"))){e=this._sclv_offsetCache;
if(!e){e=this._sclv_offsetCache=[];n=l=0;g.forEach(function(p){n+=this.rowHeightForContentIndex(p)-d;
e[p+1]=n;l=p},this);this._sclv_max=l+1}n=e[m];if(n===undefined){n=e[m]=e[m-1];if(n===undefined){l=this._sclv_max;
if(m<l){l=g.indexBefore(m)+1}n=e[m]=e[l]||0}}j+=n}return j},rowHeightForContentIndex:function(d){var e=this.get("rowDelegate"),j,g,k,h;
if(e.customRowHeightIndexes&&(h=e.get("customRowHeightIndexes"))){g=this._sclv_heightCache;
if(!g){g=this._sclv_heightCache=[];k=this.get("content");h.forEach(function(l){g[l]=e.contentIndexRowHeight(this,k,l)
},this)}j=g[d];if(j===undefined){j=e.get("rowHeight")}}else{j=e.get("rowHeight")}return j
},rowHeightDidChangeForIndexes:function(e){var d=this.get("length");this._sclv_heightCache=this._sclv_offsetCache=null;
if(e&&e.isIndexSet){e=e.get("min")}this.reload(SC.IndexSet.create(e,d-e));return this
},computeLayout:function(){var d=this._sclv_layout;if(!d){d=this._sclv_layout={}}d.minHeight=this.rowOffsetForContentIndex(this.get("length"));
this.set("calculatedHeight",d.minHeight);return d},layoutForContentIndex:function(d){return{top:this.rowOffsetForContentIndex(d),height:this.rowHeightForContentIndex(d),left:0,right:0}
},contentIndexesInRect:function(m){var d=this.get("rowDelegate").get("rowHeight"),l=SC.minY(m),e=SC.maxY(m),n=m.height||0,k=this.get("length"),j,g,h;
g=(l-(l%d))/d;j=this.rowOffsetForContentIndex(g);while(g>0&&j>=l){g--;j-=this.rowHeightForContentIndex(g)
}j+=this.rowHeightForContentIndex(g);while(g<k&&j<l){g++;j+=this.rowHeightForContentIndex(g)
}if(g<0){g=0}if(g>=k){g=k}h=g+((n-(n%d))/d);if(h>k){h=k}j=this.rowOffsetForContentIndex(h);
while(h>=g&&j>=e){h--;j-=this.rowHeightForContentIndex(h)}j+=this.rowHeightForContentIndex(h);
while(h<k&&j<=e){h++;j+=this.rowHeightForContentIndex(h)}h++;if(h<g){h=g}if(h>k){h=k
}return SC.IndexSet.create(g,h-g)},insertionPointView:SC.View.extend({classNames:"sc-list-insertion-point",render:function(d,e){if(e){d.push('<div class="anchor"></div>')
}}}),showInsertionPoint:function(l,k){var m=this._insertionPointView;if(!m){m=this._insertionPointView=this.get("insertionPointView").create()
}var h=l.get("contentIndex"),j=this.get("length"),g=SC.clone(l.get("layout")),d=l.get("outlineLevel"),e=l.get("outlineIndent")||0,n;
if((h>=j)&&h>0){n=this.itemViewForContentIndex(j-1);if(n.get("isGroupView")){d=1;
e=n.get("outlineIndent")}}if(SC.none(d)){d=-1}if(k&SC.DROP_ON){this.hideInsertionPoint();
l.set("isSelected",YES);this._lastDropOnView=l}else{if(this._lastDropOnView){this._lastDropOnView.set("isSelected",NO);
this._lastDropOnView=null}if(k&SC.DROP_AFTER){g.top+=g.height}g.height=2;g.right=0;
g.left=((d+1)*e)+12;delete g.width;m.set("layout",g);this.appendChild(m)}},hideInsertionPoint:function(){if(this._lastDropOnView){this._lastDropOnView.set("isSelected",NO);
this._lastDropOnView=null}var d=this._insertionPointView;if(d){d.removeFromParent().destroy()
}this._insertionPointView=null},insertionIndexForLocation:function(k,o){var j=this.contentIndexesInRect(k),l=j.get("min"),m=this.get("length"),e,p,s,h,x,g,u,n,d;
if(SC.none(l)||l<0){if((m===0)||(k.y<=this.rowOffsetForContentIndex(0))){l=0}else{if(k.y>=this.rowOffsetForContentIndex(m)){l=m
}}}e=this.rowOffsetForContentIndex(l);p=e+this.rowHeightForContentIndex(l);if(o==SC.DROP_ON){if(this.get("isEditable")){s=Math.min(Math.floor((p-e)*0.2),5)
}else{s=0}if(k.y>=(e+s)||k.y<=(p+s)){return[l,SC.DROP_ON]}}if((l<m)&&(k.y>=p-10)){l++
}if(l>0){n=this.itemViewForContentIndex(l-1);u=(n?n.get("outlineIndent"):0)||0;g=n?n.get("outlineLevel"):0;
if(l<m){n=this.itemViewForContentIndex(l);h=n?n.get("outlineLevel"):0;x=(n?n.get("outlineIndent"):0)||0;
x*=h}else{h=n.get("isGroupView")?1:0;x=u*h}u*=g;if((h!==g)&&(x!==u)){if(u>x){l--;
o=SC.DROP_AFTER}}}if(o===SC.DROP_BEFORE){n=(l<m)?this.itemViewForContentIndex(l):null;
if(!n||n.get("isGroupView")){if(l>0){n=this.itemViewForContentIndex(l-1);if(!n.get("isGroupView")||(n.get("disclosureState")===SC.BRANCH_OPEN)){l=l-1;
o=SC.DROP_AFTER}else{l=-1}}else{l=-1}}if(l<0){o=SC.DRAG_NONE}}return[l,o]},mouseWheel:function(d){var e=SC.InlineTextFieldView.editor;
if(e&&e.get("isEditing")){if(e.get("delegate").get("displayDelegate")===this){SC.InlineTextFieldView.commitEditing()
}}return NO},init:function(){arguments.callee.base.apply(this,arguments);this._sclv_rowDelegateDidChange()
}});SC.LIST_ITEM_ACTION_CANCEL="sc-list-item-cancel-action";SC.LIST_ITEM_ACTION_REFRESH="sc-list-item-cancel-refresh";
SC.LIST_ITEM_ACTION_EJECT="sc-list-item-cancel-eject";SC.ListItemView=SC.View.extend(SC.StaticLayout,SC.Control,{classNames:["sc-list-item-view"],content:null,hasContentIcon:NO,hasContentRightIcon:NO,hasContentBranch:NO,contentCheckboxKey:null,contentIconKey:null,contentRightIconKey:null,contentValueKey:null,escapeHTML:YES,contentUnreadCountKey:null,contentIsBranchKey:null,isEditing:NO,outlineIndent:16,outlineLevel:0,disclosureState:SC.LEAF_NODE,validator:null,contentPropertyDidChange:function(){if(this.get("contentIsEditable")!==this.contentIsEditable()){this.notifyPropertyChange("contentIsEditable")
}this.displayDidChange()},contentIsEditable:function(){var d=this.get("content");
return d&&(d.get?d.get("isEditable")!==NO:NO)}.property("content").cacheable(),render:function(g,d){var k=this.get("content"),u=this.displayDelegate,e=this.get("outlineLevel"),j=this.get("outlineIndent"),s,o,n,x=[];
x.push((this.get("contentIndex")%2===0)?"even":"odd");g.setClass("disabled",!this.get("isEnabled"));
n=g.begin("div").addClass("sc-outline");if(e>=0&&j>0){n.addStyle("left",j*(e+1))}o=this.get("disclosureState");
if(o!==SC.LEAF_NODE){this.renderDisclosure(n,o);x.push("has-disclosure")}s=this.getDelegateProperty("contentCheckboxKey",u);
if(s){o=k?(k.get?k.get(s):k[s]):NO;this.renderCheckbox(n,o);x.push("has-checkbox")
}if(this.getDelegateProperty("hasContentIcon",u)){s=this.getDelegateProperty("contentIconKey",u);
o=(s&&k)?(k.get?k.get(s):k[s]):null;this.renderIcon(n,o);x.push("has-icon")}s=this.getDelegateProperty("contentValueKey",u);
o=(s&&k)?(k.get?k.get(s):k[s]):k;if(o&&SC.typeOf(o)!==SC.T_STRING){o=o.toString()
}if(this.get("escapeHTML")){o=SC.RenderContext.escapeHTML(o)}this.renderLabel(n,o);
if(this.getDelegateProperty("hasContentRightIcon",u)){s=this.getDelegateProperty("contentRightIconKey",u);
o=(s&&k)?(k.get?k.get(s):k[s]):null;this.renderRightIcon(n,o);x.push("has-right-icon")
}s=this.getDelegateProperty("contentUnreadCountKey",u);o=(s&&k)?(k.get?k.get(s):k[s]):null;
if(!SC.none(o)&&(o!==0)){this.renderCount(n,o);var h=["zero","one","two","three","four","five"];
var p=o.toString().length;var m=h.length;var l=(p<m)?h[p]:h[m-1];x.push("has-count "+l+"-digit")
}s=this.getDelegateProperty("listItemActionProperty",u);o=(s&&k)?(k.get?k.get(s):k[s]):null;
if(o){this.renderAction(n,o);x.push("has-action")}if(this.getDelegateProperty("hasContentBranch",u)){s=this.getDelegateProperty("contentIsBranchKey",u);
o=(s&&k)?(k.get?k.get(s):k[s]):NO;this.renderBranch(n,o);x.push("has-branch")}g.addClass(x);
g=n.end()},renderDisclosure:function(j,k){var h=(k===SC.BRANCH_OPEN)?"open":"closed",d=this._scli_disclosureHtml,g,e;
if(!d){d=this.constructor.prototype._scli_disclosureHtml={}}g=d[h];if(!g){g=d[h]='<img src="'+SC.BLANK_IMAGE_URL+'" class="disclosure button '+h+'" />'
}j.push(g)},renderCheckbox:function(k,m){var j=(m===SC.MIXED_STATE)?"mixed":m?"sel":"nosel",e=this._scli_checkboxHtml,l=this.get("contentIsEditable")&&this.get("isEnabled"),h,g,d=[];
if(!l){j=SC.keyFor("disabled",j)}if(!e){e=this.constructor.prototype._scli_checkboxHtml={}
}h=e[j];if(!h){g=SC.RenderContext("div").attr("role","button").classNames(SC.clone(SC.CheckboxView.prototype.classNames));
if(m===SC.MIXED_STATE){d.push("mixed")}else{if(m){d.push("sel")}}if(!l){d.push("disabled")
}g.addClass(d);g.push('<span class="button"></span>');h=e[j]=g.join()}k.push(h)},renderIcon:function(g,j){var e=null,h=null,d=[];
if(j&&SC.ImageView.valueIsUrl(j)){e=j;h=""}else{h=j;e=SC.BLANK_IMAGE_URL}d.push(h,"icon");
g.begin("img").addClass(d).attr("src",e).end()},renderLabel:function(e,d){e.push("<label>",d||"","</label>")
},$label:function(){return this.$("label")},renderRightIcon:function(g,j){var e=null,h=null,d=[];
if(j&&SC.ImageView.valueIsUrl(j)){e=j;h=""}else{h=j;e=SC.BLANK_IMAGE_URL}d.push("right-icon",h);
g.begin("img").addClass(d).attr("src",e).end()},renderCount:function(d,e){d.push('<span class="count"><span class="inner">',e.toString(),"</span></span>")
},renderAction:function(d,e){d.push('<img src="',SC.BLANK_IMAGE_URL,'" class="action" />')
},renderBranch:function(g,e){var d=[];d.push("branch",e?"branch-visible":"branch-hidden");
g.begin("span").addClass(d).push("&nbsp;").end()},_isInsideElementWithClassName:function(j,d){var g=this.get("layer");
if(!g){return NO}var h=SC.$(d.target);var e=NO,k;while(!e&&h.length>0&&(h[0]!==g)){if(h.hasClass(j)){e=YES
}h=h.parent()}h=g=null;return e},_isInsideCheckbox:function(e){var d=this.displayDelegate;
var g=this.getDelegateProperty("contentCheckboxKey",d);return g&&this._isInsideElementWithClassName("sc-checkbox-view",e)
},_isInsideDisclosure:function(d){if(this.get("disclosureState")===SC.LEAF_NODE){return NO
}return this._isInsideElementWithClassName("disclosure",d)},_isInsideRightIcon:function(g){var e=this.displayDelegate;
var d=this.getDelegateProperty("hasContentRightIcon",e);return d&&this._isInsideElementWithClassName("right-icon",g)
},mouseDown:function(d){if(!this.get("contentIsEditable")){return NO}if(this._isInsideCheckbox(d)){this._addCheckboxActiveState();
this._isMouseDownOnCheckbox=YES;this._isMouseInsideCheckbox=YES;return YES}else{if(this._isInsideDisclosure(d)){this._addDisclosureActiveState();
this._isMouseDownOnDisclosure=YES;this._isMouseInsideDisclosure=YES;return YES}else{if(this._isInsideRightIcon(d)){this._addRightIconActiveState();
this._isMouseDownOnRightIcon=YES;this._isMouseInsideRightIcon=YES;return YES}}}return NO
},mouseUp:function(m){var g=NO,n,h,e,d,l,k;if(this._isMouseDownOnCheckbox){if(this._isInsideCheckbox(m)){n=this.displayDelegate;
h=this.getDelegateProperty("contentCheckboxKey",n);e=this.get("content");if(e&&e.get){var j=e.get(h);
j=(j===SC.MIXED_STATE)?YES:!j;e.set(h,j);this.displayDidChange()}}this._removeCheckboxActiveState();
g=YES}else{if(this._isMouseDownOnDisclosure){if(this._isInsideDisclosure(m)){d=this.get("disclosureState");
l=this.get("contentIndex");k=(!SC.none(l))?SC.IndexSet.create(l):null;n=this.get("displayDelegate");
if(d===SC.BRANCH_OPEN){if(k&&n&&n.collapse){n.collapse(k)}else{this.set("disclosureState",SC.BRANCH_CLOSED)
}this.displayDidChange()}else{if(d===SC.BRANCH_CLOSED){if(k&&n&&n.expand){n.expand(k)
}else{this.set("disclosureState",SC.BRANCH_OPEN)}this.displayDidChange()}}}this._removeDisclosureActiveState();
g=YES}else{if(this._isMouseDownOnRightIcon){this._removeRightIconActiveState();g=YES
}}}this._isMouseInsideCheckbox=this._isMouseDownOnCheckbox=NO;this._isMouseDownOnDisclosure=this._isMouseInsideDisclosure=NO;
this._isMouseInsideRightIcon=this._isMouseDownOnRightIcon=NO;return g},mouseExited:function(d){if(this._isMouseDownOnCheckbox){this._removeCheckboxActiveState();
this._isMouseInsideCheckbox=NO}else{if(this._isMouseDownOnDisclosure){this._removeDisclosureActiveState();
this._isMouseInsideDisclosure=NO}else{if(this._isMouseDownOnRightIcon){this._removeRightIconActiveState();
this._isMouseInsideRightIcon=NO}}}return NO},mouseEntered:function(d){if(this._isMouseDownOnCheckbox){this._addCheckboxActiveState();
this._isMouseInsideCheckbox=YES}else{if(this._isMouseDownOnDisclosure){this._addDisclosureActiveState();
this._isMouseInsideDisclosure=YES}else{if(this._isMouseDownOnRightIcon){this._addRightIconActiveState();
this._isMouseInsideRightIcon=YES}}}return NO},touchStart:function(d){return this.mouseDown(d)
},touchEnd:function(d){return this.mouseUp(d)},touchEntered:function(d){return this.mouseEntered(d)
},touchExited:function(d){return this.mouseExited(d)},_addCheckboxActiveState:function(){var d=this.get("isEnabled");
this.$(".sc-checkbox-view").setClass("active",d)},_removeCheckboxActiveState:function(){this.$(".sc-checkbox-view").removeClass("active")
},_addDisclosureActiveState:function(){var d=this.get("isEnabled");this.$("img.disclosure").setClass("active",d)
},_removeDisclosureActiveState:function(){this.$("img.disclosure").removeClass("active")
},_addRightIconActiveState:function(){this.$("img.right-icon").setClass("active",YES)
},_removeRightIconActiveState:function(){this.$("img.right-icon").removeClass("active")
},contentHitTest:function(e){var d=this.displayDelegate;var g=this.getDelegateProperty("contentValueKey",d);
if(!g){return NO}var j=this.$label()[0];if(!j){return NO}var k=e.target,h=this.get("layer");
while(k&&(k!==h)&&(k!==window)){if(k===j){return YES}k=k.parentNode}return NO},beginEditing:function(){if(this.get("isEditing")){return YES
}return this._beginEditing(YES)},_beginEditing:function(C){var x=this.get("content"),l=this.get("displayDelegate"),k=this.getDelegateProperty("contentValueKey",l),m=this.get("parentView"),B=m?m.get("frame"):null,d=this.$label(),h=this.get("validator"),z,o,j,p,e,u,g,A,y,D;
if(C&&this.scrollToVisible()){var n=this.get("owner"),s=this.get("contentIndex");
this.invokeLast(function(){var E=n.itemViewForContentIndex(s);if(E&&E._beginEditing){E._beginEditing(NO)
}});return YES}if(!m||!d||d.get("length")===0){return NO}o=(k&&x&&x.get)?x.get(k):null;
z=this.computeFrameWithParentFrame(null);j=SC.viewportOffset(d[0]);p=d.css("lineHeight");
e=d.css("fontSize");u=this.$().css("top");if(u){u=parseInt(u.substring(0,u.length-2),0)
}else{u=0}g=p;A=0;if(e&&g){y=e*1.5;if(y<g){d.css({lineHeight:"1.5"});A=(g-y)/2}else{p=null
}}z.x=j.x;z.y=j.y+u+A;z.height=d[0].offsetHeight;z.width=d[0].offsetWidth;D=SC.InlineTextFieldView.beginEditing({frame:z,exampleElement:d,delegate:this,value:o,multiline:NO,isCollection:YES,validator:h});
if(p){d.css({lineHeight:p})}return D},commitEditing:function(){if(!this.get("isEditing")){return YES
}return SC.InlineTextFieldView.commitEditing()},discardEditing:function(){if(!this.get("isEditing")){return YES
}return SC.InlineTextFieldView.discardEditing()},inlineEditorWillBeginEditing:function(d){this.set("isEditing",YES)
},inlineEditorDidBeginEditing:function(e){var d=this.$label();this._oldOpacity=d.css("opacity");
d.css("opacity",0)},inlineEditorShouldEndEditing:function(d,e){return YES},inlineEditorDidEndEditing:function(g,j){this.set("isEditing",NO);
var h=this.get("content");var d=this.displayDelegate;var e=this.getDelegateProperty("contentValueKey",d);
if(e&&h&&h.set){h.set(e,j)}this.displayDidChange()}});sc_require("views/button");
sc_require("views/separator");SC.MenuItemView=SC.View.extend(SC.ContentDisplay,{classNames:["sc-menu-item"],acceptsFirstResponder:YES,content:null,isSeparator:function(){return this.getContentProperty("itemSeparatorKey")===YES
}.property("content").cacheable(),isEnabled:function(){return this.getContentProperty("itemIsEnabledKey")!==NO&&this.getContentProperty("itemSeparatorKey")!==YES
}.property("content.isEnabled").cacheable(),subMenu:function(){var g=this.get("content"),e,d;
if(!g){return null}d=this.get("parentMenu");e=g.get(d.itemSubMenuKey);if(e){if(SC.kindOf(e,SC.MenuPane)){e.set("isModal",NO);
e.set("isSubMenu",YES);e.set("parentMenu",d);return e}else{return SC.MenuPane.create({layout:{width:200},items:e,isModal:NO,isSubMenu:YES,parentMenu:d,controlSize:d.get("controlSize")})
}}return null}.property("content").cacheable(),hasSubMenu:function(){return !!this.get("subMenu")
}.property("subMenu").cacheable(),init:function(){arguments.callee.base.apply(this,arguments);
this.contentDidChange()},render:function(e,m){var g=this.get("content");var d,k;var j=this.get("parentMenu");
var h=this.get("itemWidth")||j.layout.width;var l=this.get("itemHeight")||SC.DEFAULT_MENU_ITEM_HEIGHT;
this.set("itemWidth",h);this.set("itemHeight",l);e=e.begin("a");if(g.get(j.itemSeparatorKey)){e.push('<span class="separator"></span>');
e.addClass("disabled")}else{k=g.get(j.itemIconKey);if(k){this.renderImage(e,k);e.addClass("has-icon")
}k=this.get("title");if(SC.typeOf(k)!==SC.T_STRING){k=k.toString()}this.renderLabel(e,k);
if(this.getContentProperty("itemCheckboxKey")){e.push('<div class="checkbox"></div>')
}if(this.get("hasSubMenu")){this.renderBranch(e)}k=this.getContentProperty("itemShortCutKey");
if(k){this.renderShortcut(e,k)}}e=e.end()},renderImage:function(e,h){var d,g;if(h&&SC.ImageView.valueIsUrl(h)){d=h;
g=""}else{g=h;d=SC.BLANK_IMAGE_URL}e.begin("img").addClass("image").addClass(g).attr("src",d).end()
},renderLabel:function(e,d){if(this.get("escapeHTML")){d=SC.RenderContext.escapeHTML(d)
}e.push("<span class='value ellipsis'>"+d+"</span>")},renderBranch:function(d){d.push('<span class="has-branch"></span>')
},renderShortcut:function(e,d){e.push('<span class = "shortcut">'+d+"</span>")},showSubMenu:function(){var d=this.get("subMenu");
if(d){d.set("mouseHasEntered",NO);d.popup(this,[0,0,0])}this._subMenuTimer=null},title:function(){var e=this.getContentProperty("itemTitleKey"),d=this.getPath("parentMenu.localize");
if(d&&e){e=e.loc()}return e||""}.property("content.title").cacheable(),getContentProperty:function(e){var d=this.get("content"),g=this.get("parentMenu");
if(d){return d.get(g.get(e))}},mouseUp:function(e){var d;d=this.getPath("parentMenu.rootMenu.targetMenuItem");
if(d){d.performAction()}return YES},performAction:function(){if(!this.get("isEnabled")||this.get("hasSubMenu")){return NO
}var d=this.getContentProperty("itemDisableMenuFlashKey");if(d){this.sendAction()
}else{this._flashCounter=0;this.invokeLater(this.flashHighlight,25);this.invokeLater(this.sendAction,200)
}return YES},sendAction:function(){var g=this.getContentProperty("itemActionKey"),h=this.getContentProperty("itemTargetKey"),e=this.getPath("parentMenu.rootMenu"),d;
g=(g===undefined)?e.get("action"):g;h=(h===undefined)?e.get("target"):h;e.set("selectedItem",this.get("content"));
if(SC.typeOf(g)===SC.T_FUNCTION){g.apply(h,[e]);SC.Logger.warn("Support for menu item action functions has been deprecated. Please use target and action.")
}else{d=this.getPath("pane.rootResponder")||SC.RootResponder.responder;if(d){d.sendAction(g,h,this)
}}this.getPath("parentMenu.rootMenu").remove()},flashHighlight:function(){var d=this._flashCounter,e=this.$();
if(d%2===0){e.addClass("focus")}else{e.removeClass("focus")}if(d<=2){this.invokeLater(this.flashHighlight,50);
this._flashCounter++}},mouseDown:function(d){return YES},mouseEntered:function(d){var e=this.get("parentMenu");
e.set("mouseHasEntered",YES);e.set("currentMenuItem",this);if(this.get("isEnabled")){this.becomeFirstResponder()
}if(this.get("hasSubMenu")){this._subMenuTimer=this.invokeLater(this.showSubMenu,100)
}return YES},mouseExited:function(d){var e,g;if(this.get("hasSubMenu")){g=this._subMenuTimer;
if(g){g.invalidate()}else{this.invokeLater(this.checkMouseLocation,100)}}else{e=this.get("parentMenu");
if(e.get("currentMenuItem")===this){e.set("currentMenuItem",null)}}return YES},touchStart:function(d){return YES
},touchEnd:function(d){return this.mouseUp(d)},touchEntered:function(d){return this.mouseEntered(d)
},touchExited:function(d){return this.mouseExited(d)},checkMouseLocation:function(){var e=this.get("subMenu"),g=this.get("parentMenu"),d,h;
if(!e.get("mouseHasEntered")){d=g.get("currentMenuItem");if(d===this||d===null){h=g.get("previousMenuItem");
if(h){h.resignFirstResponder()}this.resignFirstResponder();e.remove()}}},moveUp:function(e,d){var g=this.get("parentMenu");
if(g){g.moveUp(this)}return YES},moveDown:function(e,d){var g=this.get("parentMenu");
if(g){g.moveDown(this)}return YES},moveRight:function(e,d){this.showSubMenu();return YES
},insertText:function(e,d){var g=this.get("parentMenu");if(g){g.insertText(e,d)}},keyDown:function(d){return this.interpretKeyEvents(d)
},keyUp:function(d){return YES},cancel:function(d){this.getPath("parentMenu.rootMenu").remove();
return YES},didBecomeFirstResponder:function(d){if(d!==this){return}var e=this.get("parentMenu");
if(e){e.set("currentSelectedMenuItem",this)}},willLoseFirstResponder:function(d){if(d!==this){return
}var e=this.get("parentMenu");if(e){e.set("currentSelectedMenuItem",null);e.set("previousSelectedMenuItem",this)
}},insertNewline:function(e,d){this.mouseUp(d)},closeParent:function(){this.$().removeClass("focus");
var d=this.get("parentMenu");if(d){d.remove()}},clickInside:function(e,d){return SC.pointInRect({x:d.pageX,y:d.pageY},e)
},contentDidChange:function(){var e=this.get("content"),d=this._content;if(e===d){return
}var g=this.contentPropertyDidChange;if(d&&d.removeObserver){d.removeObserver("*",this,g)
}this._content=e;if(e&&e.addObserver){e.addObserver("*",this,g)}this.contentPropertyDidChange(e,"*")
}.observes("content"),contentPropertyDidChange:function(l,n){var e=this.get("parentMenu");
if(!e){return}var d=SC.MenuItemView._contentPropertyToMenuItemPropertyMapping,m=SC.keys(d),j,k,h,g;
if(n==="*"){for(j=0,k=m.length;j<k;++j){h=m[j];g=d[h];this.notifyPropertyChange(g)
}}else{for(j=0,k=m.length;j<k;++j){h=m[j];if(e.get(h)===n){g=d[h];this.notifyPropertyChange(g)
}}}}});SC.MenuItemView._contentPropertyToMenuItemPropertyMapping={itemTitleKey:"title",itemIsEnabledKey:"isEnabled",itemSeparatorKey:"isSeparator",itemSubMenuKey:"subMenu"};
sc_require("views/scroll");SC.MenuScrollerView=SC.ScrollerView.extend({classNames:["sc-menu-scroller-view"],scrollDown:NO,value:function(d,g){if(g!==undefined){this._value=g
}else{var e=this._value||0;return Math.min(e,this.get("maximum"))}}.property("maximum").cacheable(),maximum:0,isEnabled:YES,layoutDirection:SC.LAYOUT_VERTICAL,verticalLineScroll:20,ownerScrollValueKey:function(){return"verticalScrollOffset"
}.property("layoutDirection").cacheable(),init:function(){switch(this.get("controlSize")){case SC.TINY_CONTROL_SIZE:this.set("scrollerThickness",SC.MenuScrollerView.TINY_SCROLLER_THICKNESS);
break;case SC.SMALL_CONTROL_SIZE:this.set("scrollerThickness",SC.MenuScrollerView.SMALL_SCROLLER_THICKNESS);
break;case SC.REGULAR_CONTROL_SIZE:this.set("scrollerThickness",SC.MenuScrollerView.REGULAR_SCROLLER_THICKNESS);
break;case SC.LARGE_CONTROL_SIZE:this.set("scrollerThickness",SC.MenuScrollerView.LARGE_SCROLLER_THICKNESS);
break;case SC.HUGE_CONTROL_SIZE:this.set("scrollerThickness",SC.MenuScrollerView.HUGE_SCROLLER_THICKNESS);
break}return arguments.callee.base.apply(this,arguments)},render:function(d,g){d.addClass("sc-vertical");
d.addClass(this.get("controlSize"));if(g){var e=this.get("scrollDown")?"arrowDown":"arrowUp";
d.push('<span class="'+e+'">&nbsp;</span>')}d.setClass("disabled",!this.get("isEnabled"))
},didCreateLayer:function(){},willDestroyLayer:function(){var d=this._sc_scroller_scrollDidChange;
SC.Event.remove(this.$(),"scroll",this,d)},mouseEntered:function(d){this.set("isMouseOver",YES);
this._invokeScrollOnMouseOver()},mouseExited:function(d){this.set("isMouseOver",NO)
},_sc_scroller_valueDidChange:function(){}.observes("value"),_sc_scroller_armScrollTimer:function(){if(!this._sc_scrollTimer){SC.RunLoop.begin();
var d=this._sc_scroller_scrollDidChange;this._sc_scrollTimer=this.invokeLater(d,50);
SC.RunLoop.end()}},_sc_scroller_scrollDidChange:function(){var e=Date.now(),h=this._sc_lastScroll,g=this.get("layer"),d=0;
if(h&&(e-h)<50){return this._sc_scroller_armScrollTimer()}this._sc_scrollTimer=null;
this._sc_lastScroll=e;SC.RunLoop.begin();if(!this.get("isEnabled")){return}this._sc_scrollValue=d=g.scrollTop;
this.set("value",d);SC.RunLoop.end()},_scrollMenu:function(){var e=this.get("value"),d;
if(this.get("scrollDown")){d=e+this.verticalLineScroll;if(d<=this.get("maximum")){this.set("value",d)
}}else{d=e-this.verticalLineScroll;if(d>=0){this.set("value",d)}else{if(e<=this.verticalLineScroll&&e>0){this.set("value",0)
}}}return YES},_invokeScrollOnMouseOver:function(){this._scrollMenu();if(this.get("isMouseOver")){this.invokeLater(this._invokeScrollOnMouseOver,100)
}}});SC.MenuScrollerView.REGULAR_SCROLLER_THICKNESS=18;SC.MenuScrollerView.TINY_SCROLLER_THICKNESS=10;
SC.MenuScrollerView.SMALL_SCROLLER_THICKNESS=14;SC.MenuScrollerView.LARGE_SCROLLER_THICKNESS=23;
SC.MenuScrollerView.HUGE_SCROLLER_THICKNESS=26;SC.MenuScrollView=SC.ScrollView.extend({classNames:["sc-menu-scroll-view"],maximumHorizontalScrollOffset:0,hasHorizontalScroller:NO,horizontalScrollerView:SC.MenuScrollerView,isHorizontalScrollerVisible:NO,canScrollHorizontal:NO,autohidesHorizontalScroller:NO,hasVerticalScroller:YES,verticalScrollerView:SC.MenuScrollerView,verticalScrollerView2:SC.MenuScrollerView,isVerticalScrollerVisible:YES,canScrollVertical:YES,autohidesVerticalScroller:YES,verticalScrollerBottom:0,controlSize:SC.REGULAR_CONTROL_SIZE,containerView:SC.ContainerView,tile:function(){var k,B,l,e,z,m,g;
k=this.get("hasVerticalScroller");B=k?this.get("verticalScrollerView"):null;l=k?this.get("verticalScrollerView2"):null;
e=B&&this.get("isVerticalScrollerVisible");z=this.get("containerView");m={left:0,top:0};
if(e){g=0;var d=B.get("scrollerThickness")||l.get("scrollerThickness");var n=this.get("contentView"),x,y=(n)?n.get("frame"):null,o=(y)?y.height:0,A=this.containerView.$()[0],p=this.get("verticalScrollOffset"),j={height:0,top:0,right:0,left:0},u={height:d,top:0,right:0,left:0},h={height:d,bottom:0,right:0,left:0},s={height:0,bottom:0,right:0,left:0};
if(A){g=A.offsetHeight}if(p===0){m.top=0;m.bottom=d;B.set("layout",j);l.set("layout",h)
}else{if(p>=(o-g-d)){m.top=d;m.bottom=0;B.set("layout",u);l.set("layout",s)}else{m.top=d;
m.bottom=d;B.set("layout",u);l.set("layout",h)}}}if(B){B.set("isVisible",e);l.set("isVisible",e)
}z.set("layout",m)},scrollerVisibilityDidChange:function(){this.tile()}.observes("isVerticalScrollerVisible","isHorizontalScrollerVisible","verticalScrollOffset"),createChildViews:function(){var g=[],e,d,h=this.get("controlSize");
if(SC.none(e=this.containerView)){e=SC.ContainerView}g.push(this.containerView=this.createChildView(e,{contentView:this.contentView}));
this.contentView=this.containerView.get("contentView");if((e=this.verticalScrollerView)&&(d=this.verticalScrollerView2)){if(this.get("hasVerticalScroller")){e=this.verticalScrollerView=this.createChildView(e,{layout:{top:0,left:0,right:0},controlSize:h,valueBinding:"*owner.verticalScrollOffset"});
g.push(e);d=this.verticalScrollerView2=this.createChildView(d,{scrollDown:YES,layout:{bottom:0,left:0,right:0},controlSize:h,valueBinding:"*owner.verticalScrollOffset"});
g.push(d)}else{this.verticalScrollerView=null;this.verticalScrollerView2=null}}this.childViews=g;
this.contentViewFrameDidChange();this.tile()},init:function(){arguments.callee.base.apply(this,arguments);
this._scroll_contentView=this.get("contentView");var d=this._scroll_contentView;if(d){d.addObserver("frame",this,this.contentViewFrameDidChange)
}if(this.get("isVisibleInWindow")){this._scsv_registerAutoscroll()}},_scsv_registerAutoscroll:function(){if(this.get("isVisibleInWindow")){SC.Drag.addScrollableView(this)
}else{SC.Drag.removeScrollableView(this)}}.observes("isVisibleInWindow"),contentViewFrameDidChange:function(){var g=this.get("contentView"),e,l=(g)?g.get("frame"):null,j=(l)?l.width:0,d=(l)?l.height:0,m=this.get("frame"),h,k;
this._scroll_contentWidth=j;this._scroll_contentHeight=d;if(this.get("hasVerticalScroller")&&(g=this.get("verticalScrollerView"))&&(e=this.get("verticalScrollerView2"))){d-=1;
if(this.get("autohidesVerticalScroller")){this.set("isVerticalScrollerVisible",d>m.height)
}d-=this.get("verticalScrollerBottom");h=0;k=this.containerView.$()[0];if(k){h=k.offsetHeight
}d=d-h;g.setIfChanged("maximum",d);e.setIfChanged("maximum",d)}},_scroll_horizontalScrollOffsetDidChange:function(){},_scroll_verticalScrollOffsetDidChange:function(){var e=this.get("verticalScrollOffset");
var d=this.get("contentView");if(d){d.adjust("top",0-e)}}.observes("verticalScrollOffset")});
sc_require("views/button");SC.PopupButtonView=SC.ButtonView.extend({classNames:["sc-popup-button"],preferMatrix:null,menu:null,isActiveBinding:"*menu.isVisibleInWindow",action:function(d){var e=this.get("menu");
if(!e){SC.Logger.warn("SC.PopupButton - Unable to show menu because the menu property is set to %@.".fmt(e));
return NO}e.popup(this,this.get("preferMatrix"));return YES},mouseDown:function(d){if(!this.get("isEnabled")){return YES
}this.set("isActive",YES);this._isMouseDown=YES;this._mouseDownTimestamp=d.timeStamp;
this._action();return YES},mouseUp:function(e){var h=this.get("menu"),d,g;if(h){d=h.getPath("rootMenu.targetMenuItem");
if(d){if(!d.performAction()){h.remove()}}else{if(e.timeStamp-this._mouseDownTimestamp>400){h.remove()
}}}this._isMouseDown=NO;arguments.callee.base.apply(this,arguments);return YES},mouseExited:function(d){return YES
},performKeyEquivalent:function(e,d){if(!this.get("isEnabled")){return NO}var g=this.get("menu");
return(!!g&&g.performKeyEquivalent(e,d))},acceptsFirstResponder:function(){if(!SC.SAFARI_FOCUS_BEHAVIOR){return this.get("isEnabled")
}else{return NO}}.property("isEnabled")});SC.ProgressView=SC.View.extend(SC.Control,{value:0.5,valueBindingDefault:SC.Binding.single().notEmpty(),minimum:0,minimumBindingDefault:SC.Binding.single().notEmpty(),contentMinimumKey:null,maximum:1,maximumBindingDefault:SC.Binding.single().notEmpty(),offsetRange:24,contentMaximumKey:null,isIndeterminate:NO,isIndeterminateBindingDefault:SC.Binding.bool(),isRunning:NO,isRunningBindingDefault:SC.Binding.bool(),animatedBackgroundMatrix:[],contentIsIndeterminateKey:null,classNames:"sc-progress-view",_backgroundOffset:0,_currentBackground:1,_nextBackground:1,init:function(){arguments.callee.base.apply(this,arguments);
this.animateProgressBar()},animateProgressBar:function(){if(this.get("isRunning")&&this.get("isVisibleInWindow")){this._animateProgressBar(500)
}}.observes("isRunning","isVisibleInWindow"),_animateProgressBar:function(d){if(d===0){d=1000/30
}if(this.get("isRunning")&&this.get("isVisibleInWindow")){this.displayDidChange();
this.invokeLater(this._animateProgressBar,d,600)}},displayProperties:"value minimum maximum isIndeterminate".w(),render:function(g,e){var x,j,p,h,m,k=this.get("isIndeterminate"),u=this.get("isRunning"),o=this.get("isEnabled"),s=this.get("offsetRange"),l=(k&&u)?(Math.floor(Date.now()/75)%s-s):0;
if(!o){p="0%"}else{if(k){p="120%"}else{p=(this.get("_percentageNumeric")*100)+"%"
}}var d={"sc-indeterminate":k,"sc-empty":(p<=0),"sc-complete":(p>=100)};if(e){var n=this._createClassNameString(d);
g.push('<div class="sc-inner ',n,'" style="width: ',p,";left: ",l,'px;">','<div class="sc-inner-head">',"</div>",'<div class="sc-inner-tail"></div></div>','<div class="sc-outer-head"></div>','<div class="sc-outer-tail"></div>')
}else{g.setClass(d);x=this.$(".sc-inner");j=this.get("animatedBackgroundMatrix");
h="width: "+p+"; ";h=h+"left: "+l+"px; ";if(j.length===3){x.css("backgroundPosition","0px -"+(j[0]+j[1]*this._currentBackground)+"px");
if(this._currentBackground===j[2]-1||this._currentBackground===0){this._nextBackground*=-1
}this._currentBackground+=this._nextBackground;h=h+"backgroundPosition: "+m+"px; ";
x.attr("style",h)}else{x.attr("style",h)}}},contentPropertyDidChange:function(g,d){var e=this.get("content");
this.beginPropertyChanges().updatePropertyFromContent("value",d,"contentValueKey",e).updatePropertyFromContent("minimum",d,"contentMinimumKey",e).updatePropertyFromContent("maximum",d,"contentMaximumKey",e).updatePropertyFromContent("isIndeterminate",d,"contentIsIndeterminateKey",e).endPropertyChanges()
},_percentageNumeric:function(){var e=this.get("minimum")||0,g=this.get("maximum")||1,d=this.get("value")||0;
d=(d-e)/(g-e);if(d>1){d=1}if(isNaN(d)){d=0}if(d<e){d=0}if(d>g){d=1}return d}.property("value").cacheable(),_createClassNameString:function(g){var e=[],d;
for(d in g){if(!g.hasOwnProperty(d)){continue}if(g[d]){e.push(d)}}return e.join(" ")
}});SC.RadioView=SC.View.extend(SC.Control,{classNames:["sc-radio-view"],value:null,layoutDirection:SC.LAYOUT_VERTICAL,escapeHTML:YES,items:[],itemTitleKey:null,itemValueKey:null,itemIsEnabledKey:null,itemIconKey:null,itemsDidChange:function(){if(this._items){this._items.removeObserver("[]",this,this.itemContentDidChange)
}this._items=this.get("items");if(this._items){this._items.addObserver("[]",this,this.itemContentDidChange)
}this.itemContentDidChange()}.observes("items"),itemContentDidChange:function(){this.notifyPropertyChange("_displayItems")
},displayProperties:["value","_displayItems"],render:function(j,d){var z,y,s,g,A,h,p,m,k,l,u,e,o=this.get("_displayItems"),x=this.get("value"),n=SC.isArray(x);
j.addClass(this.get("layoutDirection"));if(n&&x.length<=0){x=x[0];n=NO}if(d){j.attr("role","radiogroup");
g=SC.guidFor(this);A=o.length;for(y=0;y<A;y++){z=o[y];s=z[3];if(s){h=(s.indexOf("/")>=0)?s:SC.BLANK_IMAGE_URL;
p=(h===s)?"":s;s='<img src="'+h+'" class="icon '+p+'" alt="" />'}else{s=""}if(z){k=(n)?(x.indexOf(z[1])>=0):(x===z[1])
}else{k=NO}e=this._getSelectionStateClassNames(z,k,x,n,false);l=this.escapeHTML?SC.RenderContext.escapeHTML(z[0]):z[0];
j.push('<div class="sc-radio-button ',e,'" ','aria-checked="',k?"true":"false",'" ','role="radio"',' index="',y,'">','<span class="button"></span>','<span class="sc-button-label">',s,l,"</span></div>")
}}else{this.$(".sc-radio-button").forEach(function(B){B=this.$(B);y=parseInt(B.attr("index"),0);
z=(y>=0)?o[y]:null;if(z){k=(n)?(x.indexOf(z[1])>=0):(x===z[1])}else{k=NO}u=this._getSelectionStateClassNames(z,k,x,n,true);
B.attr("aria-checked",k?"true":"false");B.setClass(u);y=u=null},this)}},_displayItems:function(){var j=this.get("items"),e=this.get("localize"),y=this.get("itemTitleKey"),x=this.get("itemValueKey"),g=this.get("itemIsEnabledKey"),s=this.get("itemIconKey"),h=[],l=(j)?j.get("length"):0,u,m,p,o,d,n,k;
for(o=0;o<l;o++){u=j.objectAt(o);if(SC.typeOf(u)===SC.T_ARRAY){m=u[0];p=u[1]}else{if(u){if(y){m=u.get?u.get(y):u[y]
}else{m=(u.toString)?u.toString():null}if(x){p=u.get?u.get(x):u[x]}else{p=u}if(g){n=u.get?u.get(g):u[g]
}else{n=YES}if(s){k=u.get?u.get(s):u[s]}else{k=null}}else{m=p=k=null;n=NO}}if(e){m=m.loc()
}h.push([m,p,n,k])}return h}.property("items","itemTitleKey","itemValueKey","itemIsEnabledKey","localize","itemIconKey").cacheable(),_getSelectionStateClassNames:function(h,k,j,d,e){var m,g;
m={sel:(k&&!d),mixed:(k&&d),disabled:(!h[2])};if(e){return m}else{var l=[];for(g in m){if(!m.hasOwnProperty(g)){continue
}if(m[g]){l.push(g)}}return l.join(" ")}},mouseDown:function(d){if(!this.get("isEnabled")){return YES
}var e=d.target;while(e){if(e.className&&e.className.indexOf("sc-radio-button")>-1){break
}e=e.parentNode}if(!e){return NO}e=this.$(e);if(e.hasClass("disabled")){return YES
}e.addClass("active");this._activeRadioButton=e;d.allowDefault();return YES},mouseUp:function(d){if(!this.get("isEnabled")){return YES
}var k=this._activeRadioButton,j=d.target,e=this.get("_displayItems"),g,h;if(k){k.removeClass("active");
this._activeRadioButton=null}else{return YES}while(j){if(j.className&&j.className.indexOf("sc-radio-button")>-1){break
}j=j.parentNode}j=this.$(j);if(j[0]!==k[0]||j.hasClass("disabled")){return YES}g=parseInt(j.attr("index"),0);
h=e[g];this.set("value",h[1])},touchStart:function(d){return this.mouseDown(d)},touchEnd:function(d){return this.mouseUp(d)
}});SC.SceneView=SC.ContainerView.extend({scenes:["master","detail"],nowShowing:null,transitionDuration:200,_state:"NO_VIEW",replaceContent:function(d){if(d&&this._state===this.READY){this.animateScene(d)
}else{this.replaceScene(d)}return this},replaceScene:function(g){var h=this._targetView,j=this.STANDARD_LAYOUT,e=this.get("scenes"),d=e?e.indexOf(this.get("nowShowing")):-1;
this._targetView=g;this._targetIndex=d;if(this._timer){this._timer.invalidate()}this._leftView=this._rightView=this._start=this._end=null;
this._timer=null;this.removeAllChildren();if(h){h.set("layout",j)}if(g){g.set("layout",j)
}if(g){this.appendChild(g)}this._state=g?this.READY:this.NO_VIEW},animateScene:function(e){var g=this._targetView,k=this._targetIndex,d=this.get("scenes"),j=d?d.indexOf(this.get("nowShowing")):-1,h;
if(k<0||j<0||k===j){return this.replaceScene(e)}this._targetView=e;this._targetIndex=j;
if(j>k){this._leftView=g;this._rightView=e;this._target=-1}else{this._leftView=e;
this._rightView=g;this._target=1}this.removeAllChildren();if(g){this.appendChild(g)
}if(e){this.appendChild(e)}this._start=Date.now();this._end=this._start+this.get("transitionDuration");
this._state=this.ANIMATING;this.tick()},tick:function(){this._timer=null;var d=Date.now(),h=(d-this._start)/(this._end-this._start),l=this._target,k=this._leftView,e=this._rightView,g,j;
if(h<0){h=0}if(!this.get("isVisibleInWindow")||(h>=1)){return this.replaceScene(this._targetView)
}g=SC.clone(this.get("frame"));j=Math.floor(g.width*h);if(l>0){g.left=0-(g.width-j);
k.set("layout",g);g=SC.clone(g);g.left=j;e.set("layout",g)}else{g.left=0-j;k.set("layout",g);
g=SC.clone(g);g.left=g.width-j;e.set("layout",g)}this._timer=this.invokeLater(this.tick,20);
return this},NO_VIEW:"NO_VIEW",ANIMATING:"ANIMATING",READY:"READY",STANDARD_LAYOUT:{top:0,left:0,bottom:0,right:0}});
sc_require("views/scroller");sc_require("mixins/border");SC.ScrollView=SC.View.extend(SC.Border,{classNames:["sc-scroll-view"],isScrollable:YES,contentView:null,horizontalAlign:SC.ALIGN_LEFT,verticalAlign:SC.ALIGN_TOP,horizontalScrollOffset:function(e,h){if(h!==undefined){var g=this.minimumHorizontalScrollOffset(),d=this.get("maximumHorizontalScrollOffset");
this._scroll_horizontalScrollOffset=Math.max(g,Math.min(d,h))}return this._scroll_horizontalScrollOffset||0
}.property().cacheable(),verticalScrollOffset:function(e,h){if(h!==undefined){var g=this.get("minimumVerticalScrollOffset"),d=this.get("maximumVerticalScrollOffset");
this._scroll_verticalScrollOffset=Math.max(g,Math.min(d,h))}return this._scroll_verticalScrollOffset||0
}.property().cacheable(),maximumScrollOffset:function(e,d,g){if(e>=d){return e-d}if(g===SC.ALIGN_LEFT||g===SC.ALIGN_TOP){return 0
}else{if(g===SC.ALIGN_MIDDLE||g===SC.ALIGN_CENTER){return 0-Math.round((d-e)/2)}else{return 0-(d-e)
}}},minimumScrollOffset:function(e,d,g){if(e>d){return 0}if(g===SC.ALIGN_LEFT||g===SC.ALIGN_TOP){return 0
}else{if(g===SC.ALIGN_MIDDLE||g===SC.ALIGN_CENTER){return 0-Math.round((d-e)/2)}else{return 0-(d-e)
}}},maximumHorizontalScrollOffset:function(){var g=this.get("contentView"),e=0,d=0;
if(g&&g.get("frame")){e=g.get("frame").width}if(g){d=g.calculatedWidth||0}if(d&&d!==0){e=d
}e*=this._scale;var h=this.get("containerView").get("frame").width;if(!this.get("canScrollHorizontal")){e=Math.min(e,h)
}return this.maximumScrollOffset(e,h,this.get("horizontalAlign"))}.property(),maximumVerticalScrollOffset:function(){var d=this.get("contentView"),g=0,e=0;
if(d&&d.get("frame")){g=d.get("frame").height}if(d){e=d.calculatedHeight||0}if(e&&e!==0){g=e
}g*=this._scale;var h=this.get("containerView").get("frame").height;if(!this.get("canScrollVertical")){g=Math.min(g,h)
}return this.maximumScrollOffset(g,h,this.get("verticalAlign"))}.property(),minimumHorizontalScrollOffset:function(){var e=this.get("contentView");
var d=e?e.get("frame").width:0;if(e.calculatedWidth&&e.calculatedWidth!==0){d=e.calculatedWidth
}d*=this._scale;var g=this.get("containerView").get("frame").width;if(!this.get("canScrollHorizontal")){d=Math.min(d,g)
}return this.minimumScrollOffset(d,g,this.get("horizontalAlign"))}.property(),minimumVerticalScrollOffset:function(){var d=this.get("contentView");
var e=(d&&d.get("frame"))?d.get("frame").height:0;if(d.calculatedHeight&&d.calculatedHeight!==0){e=d.calculatedHeight
}e*=this._scale;var g=this.get("containerView").get("frame").height;if(!this.get("canScrollVertical")){e=Math.min(e,g)
}return this.minimumScrollOffset(e,g,this.get("verticalAlign"))}.property(),verticalLineScroll:20,horizontalLineScroll:20,verticalPageScroll:function(){return this.get("frame").height
}.property("frame"),horizontalPageScroll:function(){return this.get("frame").width
}.property("frame"),hasHorizontalScroller:YES,horizontalScrollerView:SC.ScrollerView,isHorizontalScrollerVisible:YES,canScrollHorizontal:function(){return !!(this.get("hasHorizontalScroller")&&this.get("horizontalScrollerView")&&this.get("isHorizontalScrollerVisible"))
}.property("isHorizontalScrollerVisible").cacheable(),autohidesHorizontalScroller:YES,hasVerticalScroller:YES,verticalScrollerView:SC.ScrollerView,isVerticalScrollerVisible:YES,canScrollVertical:function(){return !!(this.get("hasVerticalScroller")&&this.get("verticalScrollerView")&&this.get("isVerticalScrollerVisible"))
}.property("isVerticalScrollerVisible").cacheable(),autohidesVerticalScroller:YES,verticalScrollerBottom:0,verticalOverlay:NO,horizontalOverlay:NO,verticalScrollerLayout:null,horizontalScrollerLayout:null,containerView:SC.ContainerView.extend({contentClippingFrame:function(){var d=SC.clone(this.get("clippingFrame"));
if(SC.browser.touch){d.x-=d.width;d.width+=d.width*2;d.y-=d.height;d.height+=d.height*2
}return d}.property("clippingFrame")}),scrollTo:function(d,e){if(e===undefined&&SC.typeOf(d)===SC.T_HASH){e=d.y;
d=d.x}if(!SC.none(d)){d=Math.max(this.get("minimumHorizontalScrollOffset"),Math.min(this.get("maximumHorizontalScrollOffset"),d));
this.set("horizontalScrollOffset",d)}if(!SC.none(e)){e=Math.max(this.get("minimumVerticalScrollOffset"),Math.min(this.get("maximumVerticalScrollOffset"),e));
this.set("verticalScrollOffset",e)}return this},scrollBy:function(d,e){if(e===undefined&&SC.typeOf(d)===SC.T_HASH){e=d.y;
d=d.x}d=(d)?this.get("horizontalScrollOffset")+d:null;e=(e)?this.get("verticalScrollOffset")+e:null;
return this.scrollTo(d,e)},scrollToVisible:function(e){if(arguments.length===0){return arguments.callee.base.apply(this,arguments)
}var h=this.get("contentView");if(!h){return NO}var d=e.get("frame");if(!d){return NO
}d=h.convertFrameFromView(d,e.get("parentView"));var g=SC.cloneRect(this.get("containerView").get("frame"));
g.x=this.get("horizontalScrollOffset");g.y=this.get("verticalScrollOffset");var k=g.x,j=g.y;
g.y-=Math.max(0,SC.minY(g)-SC.minY(d));g.x-=Math.max(0,SC.minX(g)-SC.minX(d));g.y+=Math.max(0,SC.maxY(d)-SC.maxY(g));
g.x+=Math.max(0,SC.maxX(d)-SC.maxX(g));if((k!==g.x)||(j!==g.y)){this.scrollTo(g.x,g.y);
return YES}else{return NO}},scrollDownLine:function(d){if(d===undefined){d=1}return this.scrollBy(null,this.get("verticalLineScroll")*d)
},scrollUpLine:function(d){if(d===undefined){d=1}return this.scrollBy(null,0-this.get("verticalLineScroll")*d)
},scrollRightLine:function(d){if(d===undefined){d=1}return this.scrollTo(this.get("horizontalLineScroll")*d,null)
},scrollLeftLine:function(d){if(d===undefined){d=1}return this.scrollTo(0-this.get("horizontalLineScroll")*d,null)
},scrollDownPage:function(d){if(d===undefined){d=1}return this.scrollBy(null,this.get("verticalPageScroll")*d)
},scrollUpPage:function(d){if(d===undefined){d=1}return this.scrollBy(null,0-(this.get("verticalPageScroll")*d))
},scrollRightPage:function(d){if(d===undefined){d=1}return this.scrollBy(this.get("horizontalPageScroll")*d,null)
},scrollLeftPage:function(d){if(d===undefined){d=1}return this.scrollBy(0-(this.get("horizontalPageScroll")*d),null)
},tile:function(){var g=this.get("hasHorizontalScroller")?this.get("horizontalScrollerView"):null;
var m=g&&this.get("isHorizontalScrollerVisible");var o=this.get("hasVerticalScroller")?this.get("verticalScrollerView"):null;
var k=o&&this.get("isVerticalScrollerVisible");if(SC.browser.touch){k=m=NO}var j=this.get("containerView");
var u={left:0,top:0};var s,l,e,x,h,d;var n=((m)?g.get("scrollbarThickness"):0);var p=(k)?o.get("scrollbarThickness"):0;
if(m){d=this.get("horizontalScrollerLayout");l={left:(d?d.left:0),bottom:(d?d.bottom:0),right:(d?d.right+p-1:p-1),height:n};
g.set("layout",l);x=this.get("horizontalOverlay");u.bottom=x?0:(l.bottom+n)}else{u.bottom=0
}if(g){g.set("isVisible",m)}if(k){n=n+this.get("verticalScrollerBottom");h=this.get("verticalScrollerLayout");
l={top:(h?h.top:0),bottom:(h?h.bottom+n:n),right:(h?h.right:0),width:p};o.set("layout",l);
e=this.get("verticalOverlay");u.right=e?0:(l.right+p)}else{u.right=0}if(o){o.set("isVisible",k)
}j.set("layout",u)},scrollerVisibilityDidChange:function(){this.tile()}.observes("isVerticalScrollerVisible","isHorizontalScrollerVisible"),_scroll_wheelDeltaX:0,_scroll_wheelDeltaY:0,mouseWheel:function(d){this._scroll_wheelDeltaX+=d.wheelDeltaX;
this._scroll_wheelDeltaY+=d.wheelDeltaY;this.invokeLater(this._scroll_mouseWheel,10);
return this.get("canScrollHorizontal")||this.get("canScrollVertical")},_scroll_mouseWheel:function(){this.scrollBy(this._scroll_wheelDeltaX,this._scroll_wheelDeltaY);
if(SC.WHEEL_MOMENTUM&&this._scroll_wheelDeltaY>0){this._scroll_wheelDeltaY=Math.floor(this._scroll_wheelDeltaY*0.95);
this._scroll_wheelDeltaY=Math.max(this._scroll_wheelDeltaY,0);this.invokeLater(this._scroll_mouseWheel,10)
}else{if(SC.WHEEL_MOMENTUM&&this._scroll_wheelDeltaY<0){this._scroll_wheelDeltaY=Math.ceil(this._scroll_wheelDeltaY*0.95);
this._scroll_wheelDeltaY=Math.min(this._scroll_wheelDeltaY,0);this.invokeLater(this._scroll_mouseWheel,10)
}else{this._scroll_wheelDeltaY=0;this._scroll_wheelDeltaX=0}}},canScale:NO,_scale:1,scale:function(d,e){if(e!==undefined){this._scale=Math.min(Math.max(this.get("minimumScale"),e),this.get("maximumScale"))
}return this._scale}.property().cacheable(),minimumScale:0.25,maximumScale:2,autoScaleRange:NO,_scale_css:"",updateScale:function(d){if(this.get("contentView").isScalable){this.get("contentView").applyScale(d);
this._scale_css=""}else{this._scale_css="scale3d("+d+", "+d+", 1)"}},acceptsMultitouch:YES,_applyCSSTransforms:function(e){var d="";
this.updateScale(this._scale);d+="translate3d("+-this._scroll_horizontalScrollOffset+"px, "+-this._scroll_verticalScrollOffset+"px,0) ";
d+=this._scale_css;e.style.webkitTransform=d;e.style.webkitTransformOrigin="top left"
},captureTouch:function(d){return YES},touchGeneration:0,touchStart:function(e){if(!this.tracking){var d=++this.touchGeneration;
this.invokeLater(this.beginTouchesInContent,150,d)}this.beginTouchTracking(e,YES)
},beginTouchesInContent:function(e){if(e!==this.touchGeneration){return}var g=this.touch,d;
if(g&&this.tracking&&!this.dragging){g.touch.captureTouch(this,YES)}},beginTouchTracking:function(h,p){var k=h.averagedTouchesForView(this,p);
var e=this._scroll_verticalScrollOffset||0,g=this._scroll_horizontalScrollOffset||0;
if(this.touch&&this.touch.timeout){clearTimeout(this.touch.timeout);this.touch.timeout=null
}var l=this.get("contentView");var d=l?l.get("frame").width:0,n=l?l.get("frame").height:0;
if(l.calculatedWidth&&l.calculatedWidth!==0){d=l.calculatedWidth}if(l.calculatedHeight&&l.calculatedHeight!==0){n=l.calculatedHeight
}var m=this.get("containerView").get("frame").width,u=this.get("containerView").get("frame").height;
var j=this.convertFrameToView(this.get("frame"),null),s=(g+(k.x-j.x))/this._scale,o=(e+(k.y-j.y))/this._scale;
this.touch={startTime:h.timeStamp,notCalculated:YES,enableScrolling:{x:d*this._scale>m,y:n*this._scale>u},scrolling:{x:NO,y:NO},lastScrollOffset:{x:g,y:e},startTouchOffset:{x:k.x,y:k.y},scrollVelocity:{x:0,y:0},startTouchOffsetInContent:{x:s,y:o},containerSize:{width:m,height:u},contentSize:{width:d,height:n},startScale:this._scale,startDistance:k.d,canScale:this.get("canScale"),minimumScale:this.get("minimumScale"),maximumScale:this.get("maximumScale"),globalFrame:j,layer:this.get("contentView").get("layer"),resistanceCoefficient:0.998,resistanceAsymptote:320,decelerationFromEdge:0.05,accelerationToEdge:0.1,scrollTolerance:{x:5,y:5},scaleTolerance:5,secondaryScrollTolerance:20,scrollLock:100,lastEventTime:h.timeStamp,touch:h};
if(!this.tracking){this.tracking=YES;this.dragging=NO}},_adjustForEdgeResistance:function(k,h,e,g,d){var j;
if(k<h){j=k-h}else{if(k>e){j=e-k}else{return k}}j=Math.pow(g,Math.abs(j))*d;if(k<h){j=j-d
}else{j=-j+d}return Math.min(Math.max(h,k),e)+j},touchesDragged:function(d,g){var e=d.averagedTouchesForView(this);
this.updateTouchScroll(e.x,e.y,e.d,d.timeStamp)},updateTouchScroll:function(n,m,h,l){var k=this.touch,d=n-k.globalFrame.x,o=m-k.globalFrame.y,B,p,C,s,I,G;
var g=((this._scroll_horizontalScrollOffset||0)+d)/this._scale,e=((this._scroll_verticalScrollOffset||0)+o)/this._scale;
var F=g-k.startTouchOffset.x,E=e-k.startTouchOffset.y;if(!k.scrolling.x&&Math.abs(F)>k.scrollTolerance.x&&k.enableScrolling.x){this.dragging=YES;
k.scrolling.x=YES;k.scrollTolerance.y=k.secondaryScrollTolerance;k.startTouchOffset.x=n;
F=0}if(!k.scrolling.y&&Math.abs(E)>k.scrollTolerance.y&&k.enableScrolling.y){this.dragging=YES;
k.scrolling.y=YES;k.scrollTolerance.x=k.secondaryScrollTolerance;k.startTouchOffset.y=m;
E=0}if(!k.scrolling.x&&!k.scrolling.y&&!k.canScale){return}if(k.scrolling.x&&!k.scrolling.y){if(F>k.scrollLock&&!k.scrolling.y){k.enableScrolling.y=NO
}}if(k.scrolling.y&&!k.scrolling.x){if(E>k.scrollLock&&!k.scrolling.x){k.enableScrolling.x=NO
}}if(k.canScale){var x=k.startDistance,D=h-x;if(Math.abs(D)>k.scaleTolerance){k.scrolling.y=YES;
k.scrolling.x=YES;var H=k.startScale*(1+(D/200));var y=this._adjustForEdgeResistance(H,k.minimumScale,k.maximumScale,k.resistanceCoefficient,k.resistanceAsymptote);
this.dragging=YES;this._scale=y;var A=g*this._scale,z=e*this._scale}}I=this.minimumScrollOffset(k.contentSize.width*this._scale,k.containerSize.width,this.get("horizontalAlign"));
G=this.minimumScrollOffset(k.contentSize.height*this._scale,k.containerSize.height,this.get("verticalAlign"));
s=this.maximumScrollOffset(k.contentSize.width*this._scale,k.containerSize.width,this.get("horizontalAlign"));
p=this.maximumScrollOffset(k.contentSize.height*this._scale,k.containerSize.height,this.get("verticalAlign"));
C=k.startTouchOffsetInContent.x*this._scale-d;B=k.startTouchOffsetInContent.y*this._scale-o;
C=this._adjustForEdgeResistance(C,I,s,k.resistanceCoefficient,k.resistanceAsymptote);
B=this._adjustForEdgeResistance(B,G,p,k.resistanceCoefficient,k.resistanceAsymptote);
if(k.scrolling.x){this._scroll_horizontalScrollOffset=C}if(k.scrolling.y){this._scroll_verticalScrollOffset=B
}this._applyCSSTransforms(k.layer);if(l-k.lastEventTime>=1||k.notCalculated){k.notCalculated=NO;
var j=this._scroll_horizontalScrollOffset;var u=this._scroll_verticalScrollOffset;
k.scrollVelocity.x=((j-k.lastScrollOffset.x)/Math.max(1,l-k.lastEventTime));k.scrollVelocity.y=((u-k.lastScrollOffset.y)/Math.max(1,l-k.lastEventTime));
k.lastScrollOffset.x=j;k.lastScrollOffset.y=u;k.lastEventTime=l}},touchEnd:function(g){var d=this.touch,e=g.averagedTouchesForView(this);
if(e.touchCount>0){this.beginTouchTracking(g,NO)}else{if(this.dragging){d.dragging=NO;
d.lastEventTime=g.timeStamp;this.startDecelerationAnimation()}else{g.captureTouch(this);
if(g.touchResponder&&g.touchResponder!==this){g.touchResponder.tryToPerform("touchEnd",g)
}}this.tracking=NO;this.dragging=NO}},touchCancelled:function(d){this.tracking=NO;
this.dragging=NO;this.touch=null},startDecelerationAnimation:function(d){var e=this.touch;
e.decelerationVelocity={x:e.scrollVelocity.x*10,y:e.scrollVelocity.y*10};this.decelerateAnimation()
},bouncyBounce:function(g,j,h,k,l,e,d){if(j<h){if(g<0){g=g+((h-j)*l)}else{g=Math.min((h-j)*e+d,h-j-0.01)
}}else{if(j>k){if(g>0){g=g-((j-k)*l)}else{g=-Math.min((j-k)*e+d,j-k-0.01)}}}return g
},decelerateAnimation:function(){var e=this.touch,C=this._scale,B=this.minimumScrollOffset(e.contentSize.width*this._scale,e.containerSize.width,this.get("horizontalAlign")),A=this.minimumScrollOffset(e.contentSize.height*this._scale,e.containerSize.height,this.get("verticalAlign")),m=this.maximumScrollOffset(e.contentSize.width*this._scale,e.containerSize.width,this.get("horizontalAlign")),l=this.maximumScrollOffset(e.contentSize.height*this._scale,e.containerSize.height,this.get("verticalAlign")),u=this._scroll_horizontalScrollOffset+e.decelerationVelocity.x,o=this._scroll_verticalScrollOffset+e.decelerationVelocity.y,d=Date.now(),j=Math.max(d-e.lastEventTime,1);
var s=e.decelerationFromEdge,x=e.accelerationToEdge;var h=u>=B&&u<=m;var y=o>=A&&o<=l;
u/=this._scale;o/=this._scale;var n=0;n=this.bouncyBounce(n,C,e.minimumScale,e.maximumScale,s,x,0);
this._scale=C=C+n;u*=this._scale;o*=this._scale;B=this.minimumScrollOffset(e.contentSize.width*this._scale,e.containerSize.width,this.get("horizontalAlign"));
A=this.minimumScrollOffset(e.contentSize.height*this._scale,e.containerSize.height,this.get("verticalAlign"));
m=this.maximumScrollOffset(e.contentSize.width*this._scale,e.containerSize.width,this.get("horizontalAlign"));
l=this.maximumScrollOffset(e.contentSize.height*this._scale,e.containerSize.height,this.get("verticalAlign"));
if(h&&(u<B||u>m)){u=Math.max(B,Math.min(u,m))}if(y&&(o<A||o>l)){o=Math.max(A,Math.min(o,l))
}this._scroll_horizontalScrollOffset=u;this._scroll_verticalScrollOffset=o;this._applyCSSTransforms(e.layer);
var z=0.95;e.decelerationVelocity.y*=Math.pow(z,(j/10));e.decelerationVelocity.x*=Math.pow(z,(j/10));
e.decelerationVelocity.x=this.bouncyBounce(e.decelerationVelocity.x,u,B,m,s,x,0.3);
e.decelerationVelocity.y=this.bouncyBounce(e.decelerationVelocity.y,o,A,l,s,x,0.3);
var p=Math.abs(e.decelerationVelocity.x);var g=Math.abs(e.decelerationVelocity.y);
if(g<0.01&&p<0.01&&Math.abs(n)<0.01){e.timeout=null;SC.RunLoop.begin();this.set("scale",this._scale);
this.set("verticalScrollOffset",this._scroll_verticalScrollOffset);this.set("horizontalScrollOffset",this._scroll_horizontalScrollOffset);
SC.RunLoop.end();return}var k=this;e.lastEventTime=Date.now();this.touch.timeout=setTimeout(function(){k.decelerateAnimation()
},10)},createChildViews:function(){var e=[],d;if(SC.none(d=this.containerView)){d=SC.ContainerView
}e.push(this.containerView=this.createChildView(d,{contentView:this.contentView,isScrollContainer:YES}));
this.contentView=this.containerView.get("contentView");d=this.horizontalScrollerView;
if(d){if(this.get("hasHorizontalScroller")){d=this.horizontalScrollerView=this.createChildView(d,{layoutDirection:SC.LAYOUT_HORIZONTAL,valueBinding:"*owner.horizontalScrollOffset"});
e.push(d)}else{this.horizontalScrollerView=null}}d=this.verticalScrollerView;if(d){if(this.get("hasVerticalScroller")){d=this.verticalScrollerView=this.createChildView(d,{layoutDirection:SC.LAYOUT_VERTICAL,valueBinding:"*owner.verticalScrollOffset"});
e.push(d)}else{this.verticalScrollerView=null}}this.childViews=e;this.contentViewDidChange();
this.tile()},init:function(){arguments.callee.base.apply(this,arguments);this._scroll_contentView=this.get("contentView");
var d=this._scroll_contentView;if(d){d.addObserver("frame",this,this.contentViewFrameDidChange)
}if(this.get("isVisibleInWindow")){this._scsv_registerAutoscroll()}},_scsv_registerAutoscroll:function(){if(this.get("isVisibleInWindow")){SC.Drag.addScrollableView(this)
}else{SC.Drag.removeScrollableView(this)}}.observes("isVisibleInWindow"),contentViewDidChange:function(){var h=this.get("contentView"),d=this._scroll_contentView,e=this.contentViewFrameDidChange,g=this.contentViewLayerDidChange;
if(h!==d){if(d){d.removeObserver("frame",this,e);d.removeObserver("layer",this,g)
}this._scroll_contentView=h;if(h){h.addObserver("frame",this,e);h.addObserver("layer",this,g)
}this.containerView.set("contentView",h);this.contentViewFrameDidChange()}}.observes("contentView"),render:function(d,e){this.invokeLast(this.adjustElementScroll);
if(e){d.push('<div class="corner"></div>')}return arguments.callee.base.apply(this,arguments)
},oldMaxHOffset:0,oldMaxVOffset:0,contentViewFrameDidChange:function(){var o=this.get("contentView"),n=(o)?o.get("frame"):null,e=(n)?n.width*this._scale:0,s=(n)?n.height*this._scale:0,l=this.get("frame"),k=this.get("frame");
this._scroll_contentWidth=e;this._scroll_contentHeight=s;if(this.get("hasHorizontalScroller")&&(o=this.get("horizontalScrollerView"))){if(this.get("autohidesHorizontalScroller")){this.set("isHorizontalScrollerVisible",e>l.width)
}o.setIfChanged("maximum",e-l.width);o.setIfChanged("proportion",l.width/e)}if(this.get("hasVerticalScroller")&&(o=this.get("verticalScrollerView"))){if(this.get("autohidesVerticalScroller")){this.set("isVerticalScrollerVisible",s>l.height)
}s-=this.get("verticalScrollerBottom");o.setIfChanged("maximum",s-l.height);o.setIfChanged("proportion",l.height/s)
}if(!this.get("isVerticalScrollerVisible")&&(this.get("verticalScrollOffset")!==0)&&this.get("autohidesVerticalScroller")){this.set("verticalScrollOffset",0)
}if(!this.get("isHorizontalScrollerVisible")&&(this.get("horizontalScrollOffset")!==0)&&this.get("autohidesHorizontalScroller")){this.set("horizontalScrollOffset",0)
}var p=this.get("maximumVerticalScrollOffset"),m=this.get("verticalScrollOffset"),j=this.get("maximumHorizontalScrollOffset"),d=this.get("horizontalScrollOffset");
var h=p<m;var g=j<d;if(h||g){this.forceDimensionsRecalculation(g,h,m,d)}},contentViewLayerDidChange:function(){if(this._verticalScrollOffset!==0){this._verticalScrollOffset=-1
}if(this._horizontalScrollOffset!==0){this._horizontalScrollOffset=-1}this.invokeLast(this.adjustElementScroll)
},_scroll_horizontalScrollOffsetDidChange:function(){this.invokeLast(this.adjustElementScroll)
}.observes("horizontalScrollOffset"),_scroll_verticalScrollOffsetDidChange:function(){this.invokeLast(this.adjustElementScroll)
}.observes("verticalScrollOffset"),adjustElementScroll:function(){var d=this.get("containerView"),h=this.get("contentView"),g=this.get("verticalScrollOffset"),e=this.get("horizontalScrollOffset");
if(h){SC.RunLoop.begin();h.notifyPropertyChange("frame");SC.RunLoop.end();if(SC.browser.touch){this._applyCSSTransforms(h.get("layer"))
}}if(d&&!SC.browser.touch){d=d.$()[0];if(d){if(g!==this._verticalScrollOffset){d.scrollTop=g;
this._verticalScrollOffset=g}if(e!==this._horizontalScrollOffset){d.scrollLeft=e;
this._horizontalScrollOffset=e}}}},forceDimensionsRecalculation:function(e,g,j,d){var k=d;
var h=j;this.scrollTo(0,0);if(e&&g){this.scrollTo(this.get("maximumHorizontalScrollOffset"),this.get("maximumVerticalScrollOffset"))
}if(e&&!g){this.scrollTo(this.get("maximumHorizontalScrollOffset"),h)}if(!e&&g){this.scrollTo(k,this.get("maximumVerticalScrollOffset"))
}},_scroll_verticalScrollOffset:0,_scroll_horizontalScrollOffset:0});SC.ScrollerView=SC.View.extend({classNames:["sc-scroller-view"],value:function(d,g){var e=this.get("minimum");
if(g!==undefined){this._scs_value=g}g=this._scs_value||e;return Math.max(Math.min(g,this.get("maximum")),e)
}.property("maximum","minimum").cacheable(),proportion:0,maximum:100,minimum:0,isEnabled:YES,layoutDirection:SC.LAYOUT_VERTICAL,hasButtons:YES,scrollbarThickness:14,capLength:18,capOverlap:14,buttonLength:41,buttonOverlap:11,displayProperties:"thumbPosition thumbLength isEnabled controlsHidden".w(),render:function(g,d){var e=[],n="",j,p,l,k,s,o,m,h,u;
switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:e.push("sc-vertical");
break;case SC.LAYOUT_HORIZONTAL:e.push("sc-horizontal");break}if(!this.get("isEnabled")){e.push("disabled")
}if(this.get("controlsHidden")){e.push("controls-hidden")}g.addClass(e);p=this.get("thumbLength");
j=this.get("thumbPosition");if(d){if(this.get("hasButtons")){n='<div class="button-bottom"></div><div class="button-top"></div>'
}else{n='<div class="endcap"></div>'}switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:g.push('<div class="track"></div>','<div class="cap"></div>',n,'<div class="thumb" style="height: '+p+'px;">','<div class="thumb-center"></div>','<div class="thumb-top"></div>','<div class="thumb-bottom"></div></div>');
break;case SC.LAYOUT_HORIZONTAL:g.push('<div class="track"></div>','<div class="cap"></div>',n,'<div class="thumb" style="width: '+p+'px;">','<div class="thumb-center"></div>','<div class="thumb-top"></div>','<div class="thumb-bottom"></div></div>')
}}else{if(this.get("controlsHidden")){return}k=this.$(".thumb");this.adjustThumbSize(k,p);
this.adjustThumbPosition(k,j)}},adjustThumbPosition:function(e,d){if(this._thumbPosition===d){return
}switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:e.css("top",d);break;
case SC.LAYOUT_HORIZONTAL:e.css("left",d);break}this._thumbPosition=d},adjustThumbSize:function(d,e){if(this._thumbSize===e){return
}switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:d.css("height",Math.max(e,20));
break;case SC.LAYOUT_HORIZONTAL:d.css("width",Math.max(e,20));break}this._thumbSize=e
},trackLength:function(){var d=this.get("scrollerLength");d-=this.capLength-this.capOverlap;
d-=this.buttonLength-this.buttonOverlap;return d}.property("scrollerLength").cacheable(),scrollerLength:function(){switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:return this.get("frame").height;
case SC.LAYOUT_HORIZONTAL:return this.get("frame").width}return 0}.property("frame").cacheable(),thumbLength:function(){return Math.max(Math.floor(this.get("trackLength")*this.get("proportion")),20)
}.property("trackLength","proportion").cacheable(),thumbPosition:function(){var l=this.get("value"),g=this.get("maximum"),e=this.get("trackLength"),h=this.get("thumbLength"),k=this.get("capLength"),j=this.get("capOverlap"),d;
d=(l/g)*(e-h);d+=k-j;return Math.floor(isNaN(d)?0:d)}.property("value","maximum","trackLength","thumbLength").cacheable(),controlsHidden:function(){return this.get("proportion")>=1
}.property("proportion").cacheable(),mouseDown:function(m){if(!this.get("isEnabled")){return NO
}var h=m.target,e=this.get("thumbPosition"),l,g,k;if(h.className.indexOf("thumb")>=0){g=this.convertFrameFromView({x:m.pageX,y:m.pageY});
g.x-=e;g.y-=e;this._thumbDragging=YES;this._thumbOffset=g;this._mouseDownLocation={x:m.pageX,y:m.pageY};
this._thumbPositionAtDragStart=this.get("thumbPosition")}else{if(h.className.indexOf("button-top")>=0){this.decrementProperty("value",30);
this.makeButtonActive(".button-top");this.startMouseDownTimer("scrollUp")}else{if(h.className.indexOf("button-bottom")>=0){this.incrementProperty("value",30);
this.makeButtonActive(".button-bottom");this.startMouseDownTimer("scrollDown")}else{var j=this.get("scrollerLength"),d=this.convertFrameFromView({x:m.pageX,y:m.pageY}),n;
switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:this._mouseDownLocation=n=d.y;
break;case SC.LAYOUT_HORIZONTAL:this._mouseDownLocation=n=d.x;break}if(n<e){this.decrementProperty("value",j);
this.startMouseDownTimer("pageUp")}else{this.incrementProperty("value",j);this.startMouseDownTimer("pageDown")
}}}}return YES},mouseUp:function(d){var g=this._scs_buttonActive,e=NO,h;if(g){g.removeClass("active");
e=YES}h=this._mouseDownTimer;if(h){h.invalidate();this._mouseDownTimer=null}this._thumbDragging=NO;
return e},mouseDragged:function(d){var h,g,k,e,j=this._thumbPositionAtDragStart;if(!this._thumbDragging){return NO
}switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:k=(d.pageY-this._mouseDownLocation.y);
break;case SC.LAYOUT_HORIZONTAL:k=(d.pageX-this._mouseDownLocation.x);break}e=j+k;
g=this.get("trackLength")-this.get("thumbLength");this.set("value",Math.round((e/g)*this.get("maximum")));
return YES},touchStart:function(d){return this.mouseDown(d)},touchEnd:function(d){return this.mouseUp(d)
},touchesDragged:function(d){return this.mouseDragged(d)},startMouseDownTimer:function(d){var e;
this._mouseDownTimerAction=d;this._mouseDownTimer=SC.Timer.schedule({target:this,action:this.mouseDownTimerDidFire,interval:300})
},mouseDownTimerDidFire:function(){var g=this.get("scrollerLength"),d=this._mouseDownLocation,e;
switch(this._mouseDownTimerAction){case"scrollDown":this.incrementProperty("value",30);
break;case"scrollUp":this.decrementProperty("value",30);break;case"pageDown":e=this._scs_thumbPosition+this._scs_thumbSize;
if(d<e){return}this.incrementProperty("value",g);break;case"pageUp":e=this._scs_thumbPosition;
if(d>e){return}this.decrementProperty("value",g);break}this._mouseDownTimer=SC.Timer.schedule({target:this,action:this.mouseDownTimerDidFire,interval:50})
},makeButtonActive:function(d){this._scs_buttonActive=this.$(d).addClass("active")
}});SC.SegmentedView=SC.View.extend(SC.Control,{classNames:["sc-segmented-view"],theme:"square",value:null,isEnabled:YES,allowsEmptySelection:NO,allowsMultipleSelection:NO,localize:YES,align:SC.ALIGN_CENTER,layoutDirection:SC.LAYOUT_HORIZONTAL,items:[],itemTitleKey:null,itemValueKey:null,itemIsEnabledKey:null,itemIconKey:null,itemWidthKey:null,itemActionKey:null,itemTargetKey:null,itemKeyEquivalentKey:null,itemKeys:"itemTitleKey itemValueKey itemIsEnabledKey itemIconKey itemWidthKey itemToolTipKey".w(),displayItems:function(){var k=this.get("items"),g=this.get("localize"),p=null,h,n,j=[],l=k.get("length"),m,o,e=SC._segmented_fetchKeys,d=SC._segmented_fetchItem;
for(m=0;m<l;m++){o=k.objectAt(m);if(SC.none(o)){continue}h=SC.typeOf(o);if(h===SC.T_STRING){n=[o.humanize().titleize(),o,YES,null,null,null,m]
}else{if(h!==SC.T_ARRAY){if(p===null){p=this.itemKeys.map(e,this)}n=p.map(d,o);n[n.length]=m;
if(!p[0]&&o.toString){n[0]=o.toString()}if(!p[1]){n[1]=o}if(!p[2]){n[2]=YES}}}if(g&&n[0]){n[0]=n[0].loc()
}if(g&&n[5]&&SC.typeOf(n[5])===SC.T_STRING){n[5]=n[5].loc()}j[j.length]=n}return j
}.property("items","itemTitleKey","itemValueKey","itemIsEnabledKey","localize","itemIconKey","itemWidthKey","itemToolTipKey"),itemsDidChange:function(){if(this._items){this._items.removeObserver("[]",this,this.itemContentDidChange)
}this._items=this.get("items");if(this._items){this._items.addObserver("[]",this,this.itemContentDidChange)
}this.itemContentDidChange()}.observes("items"),itemContentDidChange:function(){this.set("renderLikeFirstTime",YES);
this.notifyPropertyChange("displayItems")},init:function(){arguments.callee.base.apply(this,arguments);
this.itemsDidChange()},displayProperties:["displayItems","value","activeIndex"],render:function(e,d){var l=this.get("displayItems");
var g=this.get("theme");if(g){e.addClass(g)}if(d||this.get("renderLikeFirstTime")){this._seg_displayItems=l;
this.renderDisplayItems(e,l);e.addStyle("text-align",this.get("align"));this.set("renderLikeFirstTime",NO)
}else{var p=this.get("activeIndex"),n=this.get("value"),h=SC.isArray(n);if(h&&n.get("length")===1){n=n.objectAt(0);
h=NO}var m={},j=l.length,k=this.$(".sc-segment"),o;while(--j>=0){o=l[j];m.sel=h?(n.indexOf(o[1])>=0):(o[1]===n);
m.active=(p===j);m.disabled=!o[2];SC.$(k[j]).setClass(m)}m=l=n=l=null}},renderDisplayItems:function(h,p){var x=this.get("value"),m=SC.isArray(x),A=this.get("activeIndex"),n=p.length,u,s,e,o,k,z,d,g,l,j,y;
for(l=0;l<n;l++){k=h.begin("a").attr("role","button");z=p[l];u=z[0];s=z[3];d=z[5];
j={};y=[];if(this.get("layoutDirection")==SC.LAYOUT_HORIZONTAL){j.display="inline-block"
}y.push("sc-segment");if(!z[2]){y.push("disabled")}if(l===0){y.push("sc-first-segment")
}if(l===(n-1)){y.push("sc-last-segment")}if(l!==0&&l!==(n-1)){y.push("sc-middle-segment")
}if(m?(x.indexOf(z[1])>=0):(z[1]===x)){y.push("sel")}if(A===l){y.push("active")}if(z[4]){g=z[4];
j.width=g+"px"}k.addClass(y);k.addStyle(j);if(d){k.attr("title",d)}if(s){e=(s.indexOf("/")>=0)?s:SC.BLANK_IMAGE_URL;
o=(e===s)?"":s;s='<img src="'+e+'" alt="" class="icon '+o+'" />'}else{s=""}k.push('<span class="sc-button-inner"><label class="sc-button-label">',s+u,"</label></span>");
k.end()}},displayItemIndexForEvent:function(e){var h=SC.$(e.target);if(!h||h===document){return -1
}var d=this.$(),g=null;while(!g&&(h.length>0)&&(h[0]!==d[0])){if(h.hasClass("sc-segment")){g=h
}else{h=h.parent()}}h=d=null;return(g)?this.$(".sc-segment").index(g):-1},keyDown:function(h){var k,l,j,d,m,g;
if(h.which===9){var e=h.shiftKey?this.get("previousValidKeyView"):this.get("nextValidKeyView");
if(e){e.becomeFirstResponder()}else{h.allowDefault()}return YES}if(!this.get("allowsMultipleSelection")&&!this.get("allowsEmptySelection")){j=this.get("displayItems");
d=j.length;m=this.get("value");g=SC.isArray(m);if(h.which===39||h.which===40){for(k=0;
k<d-1;k++){l=j[k];if(g?(m.indexOf(l[1])>=0):(l[1]===m)){this.triggerItemAtIndex(k+1)
}}return YES}else{if(h.which===37||h.which===38){for(k=1;k<d;k++){l=j[k];if(g?(m.indexOf(l[1])>=0):(l[1]===m)){this.triggerItemAtIndex(k-1)
}}return YES}}}return YES},mouseDown:function(e){if(!this.get("isEnabled")){return YES
}var d=this.displayItemIndexForEvent(e);if(d>=0){this._isMouseDown=YES;this.set("activeIndex",d)
}return YES},mouseUp:function(e){var d=this.displayItemIndexForEvent(e);if(this._isMouseDown&&(d>=0)){this.triggerItemAtIndex(d)
}this._isMouseDown=NO;this.set("activeIndex",-1);return YES},mouseMoved:function(e){if(this._isMouseDown){var d=this.displayItemIndexForEvent(e);
this.set("activeIndex",d)}return YES},mouseExited:function(e){if(this._isMouseDown){var d=this.displayItemIndexForEvent(e);
this.set("activeIndex",d)}return YES},mouseEntered:function(e){if(this._isMouseDown){var d=this.displayItemIndexForEvent(e);
this.set("activeIndex",-1)}return YES},touchStart:function(d){return this.mouseDown(d)
},touchEnd:function(d){return this.mouseUp(d)},touchMoved:function(d){return this.mouseMoved(d)
},touchEntered:function(d){return this.mouseEntered(d)},touchExited:function(d){return this.mouseExited(d)
},triggerItemAtIndex:function(p){var n=this.get("displayItems"),s=n.objectAt(p),e,o,g,l,k;
if(!s[2]){return this}l=this.get("allowsEmptySelection");k=this.get("allowsMultipleSelection");
e=s[1];o=g=this.get("value");if(!SC.isArray(o)){o=[o]}if(!k){if(l&&(o.get("length")===1)&&(o.objectAt(0)===e)){o=[]
}else{o=[e]}}else{if(o.indexOf(e)>=0){if(o.get("length")>1||(o.objectAt(0)!==e)||l){o=o.without(e)
}}else{o=o.concat([e])}}switch(o.get("length")){case 0:o=null;break;case 1:o=o.objectAt(0);
break;default:break}var u=this.get("itemActionKey"),d=this.get("itemTargetKey"),j,m=null,h=this.getPath("pane.rootResponder");
if(u&&(s=this.get("items").objectAt(s[6]))){j=s.get?s.get(u):s[u];if(d){m=s.get?s.get(d):s[d]
}if(h){h.sendAction(j,m,this,this.get("pane"))}}if(!j&&g!==undefined){this.set("value",o)
}j=this.get("action");if(j&&h){h.sendAction(j,this.get("target"),this,this.get("pane"))
}},acceptsFirstResponder:function(){if(!SC.SAFARI_FOCUS_BEHAVIOR){return this.get("isEnabled")
}else{return NO}}.property("isEnabled"),willBecomeKeyResponderFrom:function(d){if(!this._isFocused){this._isFocused=YES;
this.becomeFirstResponder();if(this.get("isVisibleInWindow")){this.$()[0].focus()
}}},willLoseKeyResponderTo:function(d){if(this._isFocused){this._isFocused=NO}}});
SC._segmented_fetchKeys=function(d){return this.get(d)};SC._segmented_fetchItem=function(d){if(!d){return null
}return this.get?this.get(d):this[d]};sc_require("views/button");SC.SelectView=SC.ButtonView.extend({items:[],itemsBindingDefault:SC.Binding.multiple(),itemTitleKey:null,itemSortKey:null,itemValueKey:null,itemIconKey:null,itemSeparatorKey:"separator",localize:YES,disableSort:YES,classNames:["sc-select-view"],_itemList:[],_currentSelItem:null,_itemIdx:null,value:null,showCheckbox:YES,_defaultVal:null,_defaultTitle:null,_defaultIcon:null,theme:"popup",displayProperties:["icon","value","controlSize","items"],preferMatrix:null,CUSTOM_MENU_ITEM_HEIGHT:20,isSelectedBinding:"*menu.isVisibleInWindow",positionMenuBelow:NO,lastMenuWidth:null,exampleView:null,customViewMenuOffsetWidth:0,needsEllipsis:YES,menuPaneHeightPadding:0,menuItemPadding:35,leftAlign:function(){var e=0,d=this.get("controlSize");
if(d===SC.SMALL_CONTROL_SIZE){e=-14}if(d===SC.REGULAR_CONTROL_SIZE){e=-16}return e
}.property("controlSize"),sortObjects:function(e){if(!this.get("disableSort")){var d=this.get("itemSortKey")||this.get("itemTitleKey");
e=e.sort(function(h,g){if(d){h=h.get?h.get(d):h[d];g=g.get?g.get(d):g[d]}return(h<g)?-1:((h>g)?1:0)
})}return e},render:function(e,k){arguments.callee.base.apply(this,arguments);var g,o,x,z,C,l,j,B,m,s,d,p,h,n,D,y,u,A;
o=this.get("items");o=this.sortObjects(o);x=o.length;z=this.get("itemTitleKey");C=this.get("itemIconKey");
l=this.get("itemValueKey");j=this.get("itemSeparatorKey");B=this.get("showCheckbox");
m=this.get("value");s=this.get("localize");p=[];h=YES;n=0;o.forEach(function(E){if(E){D=z?(E.get?E.get(z):E[z]):E.toString();
D=s?D.loc():D;y=C?(E.get?E.get(C):E[C]):null;if(SC.none(E[C])){y=null}u=(l)?(E.get?E.get(l):E[l]):E;
if(!SC.none(m)&&!SC.none(u)){if(m===u){this.set("title",D);this.set("icon",y)}}if(u===this.get("value")){this.set("_itemIdx",n);
h=!B?NO:YES}else{h=NO}d=j?(E.get?E.get(j):E[j]):NO;if(n===0){this._defaultVal=u;this._defaultTitle=D;
this._defaultIcon=y}var F=SC.Object.create({separator:d,title:D,icon:y,value:u,isEnabled:YES,checkbox:h,action:this.displaySelectedItem});
p.push(F)}n+=1;this.set("_itemList",p)},this);if(k){this.invokeLast(function(){var E=this.get("value");
if(SC.none(E)){this.set("value",this._defaultVal);this.set("title",this._defaultTitle);
this.set("icon",this._defaultIcon)}})}this.changeSelectButtonPreferMatrix(this._itemIdx)
},_action:function(s){var m,d,n,o,A,x,H,j,G,g,u,C,y,E,k,l,p,e,F;m=this.$(".sc-button-label")[0];
d=this.get("layer").offsetWidth;n=m.scrollWidth;o=this.get("lastMenuWidth");if(n){A=m.offsetWidth;
if(n&&A){d=d+n-A}}if(!o||(d>o)){o=d}x=this.get("_itemList");var B=this.get("customViewClassName");
var z=this.get("customViewMenuOffsetWidth");var h="sc-view sc-pane sc-panel sc-palette sc-picker sc-menu select-button sc-scroll-view sc-menu-scroll-view sc-container-view menuContainer sc-button-view sc-menu-item sc-regular-size";
h=B?(h+" "+B):h;SC.prepareStringMeasurement("",h);for(u=0,F=x.length;u<F;++u){G=x.objectAt(u);
H=SC.measureString(G.title).width;if(!j||(H>j)){j=H}}SC.teardownStringMeasurement();
o=(j+this.menuItemPadding>o)?j+this.menuItemPadding:o;var D=SC.RootResponder.responder.get("currentWindowSize").width;
if(o>D){o=(D-25)}this.set("lastMenuWidth",o);C=this.get("_currentSelItem");y=this.get("_itemList");
E=this.get("controlSize");k=this.get("menuPaneHeightPadding");l=this.get("exampleView");
p=l?l:SC.MenuItemView;e=SC.MenuPane.create({classNames:["select-button"],items:y,exampleView:p,isEnabled:YES,menuHeightPadding:k,preferType:SC.PICKER_MENU,itemHeightKey:"height",layout:{width:o},controlSize:E,itemWidth:o,contentView:SC.View.extend({})});
if(!e){return NO}e.popup(this,this.preferMatrix);e.set("currentSelectedMenuItem",C);
return YES},displaySelectedItem:function(){var o,e,k,n,g,d=0,l,j,m,p=null,h;o=this.parentMenu();
e=o.get("currentSelectedMenuItem");k=o.menuItemViews;if(e&&k){d=k.indexOf(e)}l=o.get("anchor");
j=o.get("items");m=j.length;while(!p&&(--m>=0)){h=j[m];n=!SC.none(h.title)?h.title:j.toString();
g=!SC.none(h.value)?h.value:n;if(n===this.get("value")&&(d===m)){p=j;l.set("value",g);
l.set("title",n)}}l.set("icon",this.get("icon")).set("_currentSelItem",e).set("_itemIdx",d)
},changeSelectButtonPreferMatrix:function(){var h=0,e=this.get("_itemIdx"),d=this.get("leftAlign"),j,g;
if(this.get("positionMenuBelow")){j=[d,4,3];this.set("preferMatrix",j)}else{if(e){h=e*this.CUSTOM_MENU_ITEM_HEIGHT
}g=[d,-h,2];this.set("preferMatrix",g)}},mouseDown:function(d){if(!this.get("isEnabled")){return YES
}this.set("isActive",YES);this._isMouseDown=YES;this.becomeFirstResponder();this._action();
return YES},keyDown:function(d){if(this.interpretKeyEvents(d)){return YES}else{arguments.callee.base.apply(this,arguments)
}},interpretKeyEvents:function(d){if(d){if((d.keyCode===38||d.keyCode===40)){this._action()
}else{if(d.keyCode===27){this.resignFirstResponder()}}}return arguments.callee.base.apply(this,arguments)
}});SC.SelectFieldView=SC.FieldView.extend({tagName:"select",classNames:["sc-select-field-view"],objects:[],objectsBindingDefault:SC.Binding.multiple(),nameKey:null,sortKey:null,valueKey:null,emptyName:null,localize:false,cpDidChange:YES,disableSort:NO,validateMenuItem:function(e,d){return true
},sortObjects:function(e){if(!this.get("disableSort")){var d=this.get("sortKey")||this.get("nameKey");
e=e.sort(function(h,g){if(d){h=h.get?h.get(d):h[d];g=g.get?g.get(d):g[d]}return(h<g)?-1:((h>g)?1:0)
})}return e},render:function(g,d){if(this.get("cpDidChange")){this.set("cpDidChange",NO);
var k=this.get("nameKey");var o=this.get("valueKey");var n=this.get("objects");var e=this.get("value");
var h,l;var m=this.get("localize");if(!o&&e){e=SC.guidFor(e)}if((e===null)||(e==="")){e="***"
}if(n){n=this.sortObjects(n);if(!d){l=this.$input()[0];l.innerHTML=""}var j=this.get("emptyName");
if(j){if(m){j=j.loc()}if(d){g.push('<option value="***">'+j+"</option>",'<option disabled="disabled"></option>')
}else{h=document.createElement("option");h.value="***";h.innerHTML=j;l.appendChild(h);
h=document.createElement("option");h.disabled="disabled";l.appendChild(h)}}n.forEach(function(u){if(u){var s=k?(u.get?u.get(k):u[k]):u.toString();
if(m){s=s.loc()}var x=(o)?(u.get?u.get(o):u[o]):u;if(x){x=(SC.guidFor(x))?SC.guidFor(x):x.toString()
}var p=(this.validateMenuItem&&this.validateMenuItem(x,s))?"":'disabled="disabled" ';
if(d){g.push("<option "+p+'value="'+x+'">'+s+"</option>")}else{h=document.createElement("option");
h.value=x;h.innerHTML=s;if(p.length>0){h.disable="disabled"}l.appendChild(h)}}else{if(d){g.push('<option disabled="disabled"></option>')
}else{h=document.createElement("option");h.disabled="disabled";l.appendChild(h)}}},this);
this.setFieldValue(e)}else{this.set("value",null)}}},displayProperties:["objects","nameKey","valueKey"],_objectsObserver:function(){this.set("cpDidChange",YES)
}.observes("objects"),_nameKeyObserver:function(){this.set("cpDidChange",YES)}.observes("nameKey"),_valueKeyObserver:function(){this.set("cpDidChange",YES)
}.observes("valueKey"),$input:function(){return this.$()},mouseDown:function(d){if(!this.get("isEnabled")){d.stop();
return YES}else{return arguments.callee.base.apply(this,arguments)}},getFieldValue:function(){var k=arguments.callee.base.apply(this,arguments);
var g=this.get("valueKey");var j=this.get("objects");var h,d;if(k=="***"){k=null}else{if(k&&j){var l=(SC.typeOf(j.length)===SC.T_FUNCTION)?j.length():j.length;
h=null;while(!h&&(--l>=0)){d=j.objectAt?j.objectAt(l):j[l];if(g){d=(d.get)?d.get(g):d[g]
}var e=(d)?(SC.guidFor(d)?SC.guidFor(d):d.toString()):null;if(k==e){h=d}}}}return(g||h)?h:k
},setFieldValue:function(d){if(SC.none(d)){d=""}else{d=((d)?(SC.guidFor(d)?SC.guidFor(d):d.toString()):null)
}this.$input().val(d);return this},fieldDidFocus:function(){var d=this.get("isFocused");
if(!d){this.set("isFocused",true)}},fieldDidBlur:function(){var d=this.get("isFocused");
if(d){this.set("isFocused",false)}},_isFocusedObserver:function(){this.$().setClass("focus",this.get("isFocused"))
}.observes("isFocused"),didCreateLayer:function(){var d=this.$input();if(this.get("isEnabled")===false){this.$()[0].disabled=true
}SC.Event.add(d,"blur",this,this.fieldDidBlur);SC.Event.add(d,"focus",this,this.fieldDidFocus);
return arguments.callee.base.apply(this,arguments)},willDestroyLayer:function(){var d=this.$input();
SC.Event.remove(d,"focus",this,this.fieldDidFocus);SC.Event.remove(d,"blur",this,this.fieldDidBlur);
return arguments.callee.base.apply(this,arguments)}});SC.SeparatorView=SC.View.extend({classNames:["sc-separator-view"],tagName:"span",layoutDirection:SC.LAYOUT_HORIZONTAL,render:function(d,e){if(e){d.push("<span></span>")
}d.addClass(this.get("layoutDirection"))}});SC.SliderView=SC.View.extend(SC.Control,{classNames:"sc-slider-view",handleSelector:"img.sc-handle",value:0.5,valueBindingDefault:SC.Binding.single().notEmpty(),minimum:0,minimumBindingDefault:SC.Binding.single().notEmpty(),contentMinimumKey:null,maximum:1,maximumBindingDefault:SC.Binding.single().notEmpty(),contentMaximumKey:null,step:0.1,displayProperties:"value minimum maximum".w(),render:function(h,l){arguments.callee.base.apply(this,arguments);
var g=this.get("minimum"),d=this.get("maximum"),k=this.get("value"),j=this.get("step");
k=Math.min(Math.max(k,g),d);if(!SC.none(j)&&j!==0){k=Math.round(k/j)*j}if(k!==0){k=Math.floor((k-g)/(d-g)*100)
}if(l){var e=SC.BLANK_IMAGE_URL;h.push('<span class="sc-inner">','<span class="sc-leftcap"></span>','<span class="sc-rightcap"></span>','<img src="',e,'" class="sc-handle" style="left: ',k,'%" />',"</span>")
}else{this.$(this.get("handleSelector")).css("left",k+"%")}},_isMouseDown:NO,mouseDown:function(d){if(!this.get("isEnabled")){return YES
}this.set("isActive",YES);this._isMouseDown=YES;return this._triggerHandle(d)},mouseDragged:function(d){return this._isMouseDown?this._triggerHandle(d):YES
},mouseUp:function(d){if(this._isMouseDown){this.set("isActive",NO)}var e=this._isMouseDown?this._triggerHandle(d):YES;
this._isMouseDown=NO;return e},mouseWheel:function(e){if(!this.get("isEnabled")){return YES
}var h=this.get("minimum"),d=this.get("maximum"),g=this.get("value")+((e.wheelDeltaX+e.wheelDeltaY)*0.01),j=this.get("step"),k=Math.round(g/j)*j;
if(g<h){this.setIfChanged("value",h)}else{if(g>d){this.setIfChanged("value",d)}else{this.setIfChanged("value",g)
}}return YES},touchStart:function(d){return this.mouseDown(d)},touchEnd:function(d){return this.mouseUp(d)
},touchesDragged:function(d){return this.mouseDragged(d)},_triggerHandle:function(e){var j=this.get("frame").width,h=this.get("minimum"),d=this.get("maximum"),k=this.get("step"),g=this.get("value"),l;
l=this.convertFrameFromView({x:e.pageX}).x;l=Math.max(Math.min(l,j-8),8)-8;j-=16;
l=l/j;l=h+((d-h)*l);if(k!==0){l=Math.round(l/k)*k}if(Math.abs(g-l)>=0.01){this.set("value",l)
}return YES},acceptsFirstResponder:function(){if(!SC.SAFARI_FOCUS_BEHAVIOR){return this.get("isEnabled")
}else{return NO}}.property("isEnabled"),willBecomeKeyResponderFrom:function(d){if(!this._isFocused){this._isFocused=YES;
this.becomeFirstResponder();if(this.get("isVisibleInWindow")){this.$()[0].focus()
}}},willLoseKeyResponderTo:function(d){if(this._isFocused){this._isFocused=NO}},keyDown:function(g){if(g.which===9){var e=g.shiftKey?this.get("previousValidKeyView"):this.get("nextValidKeyView");
if(e){e.becomeFirstResponder()}else{g.allowDefault()}return YES}if(g.which===37||g.which===38||g.which===39||g.which===40){var j=this.get("minimum"),d=this.get("maximum"),k=this.get("step"),h=d-j,m=0,l;
if(g.which===37||g.which===38){if(k===0){if(h<100){m=this.get("value")-1}else{l=Math.abs(h/100);
if(l<2){l=2}m=this.get("value")-Math.abs(h/100)}}else{m=this.get("value")-k}}if(g.which===39||g.which===40){if(k===0){if(h<100){m=this.get("value")+2
}else{l=Math.abs(h/100);if(l<2){l=2}m=this.get("value")+l}}else{m=this.get("value")+k
}}if(m>=j&&m<=d){this.set("value",m)}}SC.RunLoop.begin().end();return YES},contentPropertyDidChange:function(g,d){var e=this.get("content");
this.beginPropertyChanges().updatePropertyFromContent("value",d,"contentValueKey",e).updatePropertyFromContent("minimum",d,"contentMinimumKey",e).updatePropertyFromContent("maximum",d,"contentMaximumKey",e).updatePropertyFromContent("isIndeterminate",d,"contentIsIndeterminateKey",e).endPropertyChanges()
}});sc_require("views/list");sc_require("views/source_list_group");SC.BENCHMARK_SOURCE_LIST_VIEW=YES;
SC.SourceListView=SC.ListView.extend({classNames:["sc-source-list"],rowHeight:32,selectOnMouseDown:NO,actOnSelect:YES});
sc_require("mixins/collection_group");sc_require("views/disclosure");SC.SourceListGroupView=SC.View.extend(SC.Control,SC.CollectionGroup,{classNames:["sc-source-list-group"],content:null,isGroupVisible:YES,hasGroupTitle:YES,groupTitleKey:null,groupVisibleKey:null,render:function(d,e){d.push('<div role="button" class="sc-source-list-label sc-disclosure-view sc-button-view button disclosure no-disclosure">','<img src="'+SC.BLANK_IMAGE_URL+'" class="button" />','<span class="label"></span></div>')
},createChildViews:function(){},contentPropertyDidChange:function(k,g){var j=this.get("content");
var m=this.outlet("labelView");if(j===null){m.setIfChanged("isVisible",NO);this.setIfChanged("hasGroupTitle",NO);
return}else{m.setIfChanged("isVisible",YES);this.setIfChanged("hasGroupTitle",YES)
}var e=this.getDelegateProperty("groupTitleKey",this.displayDelegate);if((g=="*")||(e&&(g==e))){var l=(j&&j.get&&e)?j.get(e):j;
if(l!=this._title){this._title=l;if(l){l=l.capitalize()}m.set("title",l)}}var h=this.getDelegateProperty("groupVisibleKey",this.displayDelegate);
if((g=="*")||(h&&(g==h))){if(h){m.removeClassName("no-disclosure");var d=(j&&j.get)?!!j.get(h):YES;
if(d!=this.get("isGroupVisible")){this.set("isGroupVisible",d);m.set("value",d)}}else{m.addClassName("no-disclosure")
}}},disclosureValueDidChange:function(g){if(g==this.get("isGroupVisible")){return
}var e=this.get("content");var d=this.getDelegateProperty("groupVisibleKey",this.displayDelegate);
if(e&&e.set&&d){e.set(d,g)}this.set("isGroupVisible",g);if(this.owner&&this.owner.updateChildren){this.owner.updateChildren(true)
}},labelView:SC.DisclosureView.extend({value:YES,_valueObserver:function(){if(this.owner){this.owner.disclosureValueDidChange(this.get("value"))
}}.observes("value")})});sc_require("views/split_divider");SC.RESIZE_BOTH="resize-both";
SC.RESIZE_TOP_LEFT="resize-top-left";SC.RESIZE_BOTTOM_RIGHT="resize-bottom-right";
SC.SplitView=SC.View.extend({classNames:["sc-split-view"],displayProperties:["layoutDirection"],delegate:null,layoutDirection:SC.LAYOUT_HORIZONTAL,canCollapseViews:YES,autoresizeBehavior:SC.RESIZE_BOTTOM_RIGHT,defaultThickness:0.5,isSplitView:YES,topLeftView:SC.View,dividerView:SC.SplitDividerView,bottomRightView:SC.View,topLeftThickness:function(){var d=this.get("topLeftView");
return d?this.thicknessForView(d):0}.property("topLeftView").cacheable(),bottomRightThickness:function(){var d=this.get("bottomRightView");
return d?this.thicknessForView(d):0}.property("bottomRightView").cacheable(),thumbViewCursor:null,canCollapseView:function(d){return this.invokeDelegateMethod(this.delegate,"splitViewCanCollapse",this,d)
},thicknessForView:function(d){var g=this.get("layoutDirection"),e=d.get("frame");
return(g===SC.LAYOUT_HORIZONTAL)?e.width:e.height},createChildViews:function(){var j=[],h=["topLeftView","dividerView","bottomRightView"],g,e,d;
for(e=0,d=h.length;e<d;++e){if(g=this.get(h[e])){g=this[h[e]]=this.createChildView(g,{layoutView:this,rootElementPath:[e]});
j.push(g)}}this.set("childViews",j);return this},updateChildLayout:function(){var d=this.get("topLeftView"),e=this.get("bottomRightView"),m=this.get("dividerView"),n=this.get("layoutDirection"),h=this._desiredTopLeftThickness;
var o=this.get("dividerThickness");o=(!SC.none(o))?o:7;var l=(n===SC.LAYOUT_HORIZONTAL)?this.get("frame").width:this.get("frame").height,p=l-o-h,g=this.get("autoresizeBehavior"),k,j;
j=d.get("isCollapsed")||NO;d.setIfChanged("isVisible",!j);k=SC.clone(d.get("layout"));
if(n===SC.LAYOUT_HORIZONTAL){k.top=0;k.left=0;k.bottom=0;switch(g){case SC.RESIZE_BOTH:throw"SC.RESIZE_BOTH is currently unsupported.";
case SC.RESIZE_TOP_LEFT:k.right=p+o;delete k.width;break;case SC.RESIZE_BOTTOM_RIGHT:delete k.right;
delete k.height;k.width=h;break}}else{k.top=0;k.left=0;k.right=0;switch(g){case SC.RESIZE_BOTH:throw"SC.RESIZE_BOTH is currently unsupported.";
case SC.RESIZE_TOP_LEFT:k.bottom=p+o;delete k.height;break;case SC.RESIZE_BOTTOM_RIGHT:delete k.bottom;
delete k.width;k.height=h;break}}d.set("layout",k);if(m){k=SC.clone(m.get("layout"));
if(n===SC.LAYOUT_HORIZONTAL){k.width=o;delete k.height;k.top=0;k.bottom=0;switch(g){case SC.RESIZE_BOTH:throw"SC.RESIZE_BOTH is currently unsupported.";
case SC.RESIZE_TOP_LEFT:delete k.left;k.right=p;delete k.centerX;delete k.centerY;
break;case SC.RESIZE_BOTTOM_RIGHT:k.left=h;delete k.right;delete k.centerX;delete k.centerY;
break}}else{delete k.width;k.height=o;k.left=0;k.right=0;switch(g){case SC.RESIZE_BOTH:throw"SC.RESIZE_BOTH is currently unsupported.";
case SC.RESIZE_TOP_LEFT:delete k.top;k.bottom=p;delete k.centerX;delete k.centerY;
break;case SC.RESIZE_BOTTOM_RIGHT:k.top=h;delete k.bottom;delete k.centerX;delete k.centerY;
break}}m.set("layout",k)}j=e.get("isCollapsed")||NO;e.setIfChanged("isVisible",!j);
k=SC.clone(e.get("layout"));if(n===SC.LAYOUT_HORIZONTAL){k.top=0;k.bottom=0;k.right=0;
switch(g){case SC.RESIZE_BOTH:throw"SC.RESIZE_BOTH is currently unsupported.";case SC.RESIZE_BOTTOM_RIGHT:k.left=h+o;
delete k.width;break;case SC.RESIZE_TOP_LEFT:delete k.left;k.width=p;break}}else{k.left=0;
k.right=0;k.bottom=0;switch(g){case SC.RESIZE_BOTH:throw"SC.RESIZE_BOTH is currently unsupported.";
case SC.RESIZE_BOTTOM_RIGHT:k.top=h+o;delete k.height;break;case SC.RESIZE_TOP_LEFT:delete k.top;
k.height=p;break}}e.set("layout",k);this.notifyPropertyChange("topLeftThickness").notifyPropertyChange("bottomRightThickness")
},renderLayout:function(e,d){if(d||this._recalculateDivider){if(!this.get("thumbViewCursor")){this.set("thumbViewCursor",SC.Cursor.create())
}var h=this.get("layoutDirection"),k=this.get("frame"),j,n=this.$(),m=this.get("defaultThickness"),g=this.get("autoresizeBehavior");
var l=this.get("dividerThickness");l=(!SC.none(l))?l:7;if(this._recalculateDivider===undefined&&m<1){this._recalculateDivider=YES
}else{if(this._recalculateDivider){this._recalculateDivider=NO}}if(n[0]){j=(h===SC.LAYOUT_HORIZONTAL)?n[0].offsetWidth:n[0].offsetHeight
}else{j=(h===SC.LAYOUT_HORIZONTAL)?k.width:k.height}if(SC.none(m)||(m>0&&m<1)){m=Math.floor((j-(l))*(m||0.5))
}if(g===SC.RESIZE_BOTTOM_RIGHT){this._desiredTopLeftThickness=m}else{this._desiredTopLeftThickness=j-l-m
}this._topLeftView=this.get("topLeftView");this._bottomRightView=this.get("bottomRightView");
this._topLeftViewThickness=this.thicknessForView(this.get("topLeftView"));this._bottomRightThickness=this.thicknessForView(this.get("bottomRightView"));
this._dividerThickness=this.get("dividerThickness");this._layoutDirection=this.get("layoutDirection");
this._updateTopLeftThickness(0);this._setCursorStyle();this.updateChildLayout()}arguments.callee.base.apply(this,arguments)
},render:function(e,g){arguments.callee.base.apply(this,arguments);if(this._inLiveResize){this._setCursorStyle()
}var d=this.get("layoutDirection");if(d===SC.LAYOUT_HORIZONTAL){e.addClass("sc-horizontal")
}else{e.addClass("sc-vertical")}},mouseDownInThumbView:function(d,g){var e=this.getPath("pane.rootResponder");
if(!e){return NO}e.dragDidStart(this);this._mouseDownX=d.pageX;this._mouseDownY=d.pageY;
this._thumbView=g;this._topLeftView=this.get("topLeftView");this._bottomRightView=this.get("bottomRightView");
this._topLeftViewThickness=this.thicknessForView(this.get("topLeftView"));this._bottomRightThickness=this.thicknessForView(this.get("bottomRightView"));
this._dividerThickness=this.get("dividerThickness");this._layoutDirection=this.get("layoutDirection");
this.beginLiveResize();this._inLiveResize=YES;return YES},mouseDragged:function(d){var e=(this._layoutDirection===SC.LAYOUT_HORIZONTAL)?d.pageX-this._mouseDownX:d.pageY-this._mouseDownY;
this._updateTopLeftThickness(e);return YES},mouseUp:function(d){if(this._inLiveResize===YES){this._thumbView=null;
this._inLiveResize=NO;this.endLiveResize();return YES}return NO},touchesDragged:function(d){return this.mouseDragged(d)
},touchEnd:function(d){return this.mouseUp(d)},doubleClickInThumbView:function(e,h){var d=this._topLeftView,g=d.get("isCollapsed")||NO;
if(!g&&!this.canCollapseView(d)){d=this._bottomRightView;g=d.get("isCollapsed")||NO;
if(!g&&!this.canCollapseView(d)){return NO}}if(!g){this._uncollapsedThickness=this.thicknessForView(d);
if(d===this._topLeftView){this._updateTopLeftThickness(this.topLeftThickness()*-1)
}else{this._updateBottomRightThickness(this.bottomRightThickness()*-1)}if(!d.get("isCollapsed")){this._uncollapsedThickness=null
}}else{if(d===this._topLeftView){this._updateTopLeftThickness(this._uncollapsedThickness)
}else{this._updateBottomRightThickness(this._uncollapsedThickness)}d._uncollapsedThickness=null
}this._setCursorStyle();return true},_updateTopLeftThickness:function(j){var d=this._topLeftView,g=this._bottomRightView,k=this.thicknessForView(d),l=this.thicknessForView(g),o=this._dividerThickness,n=0,e=this._topLeftViewThickness+j,u=this._layoutDirection,y=this.canCollapseView(g),s=e,p=this.get("topLeftMaxThickness"),h=this.get("topLeftMinThickness"),x,m,z;
if(!d.get("isCollapsed")){n+=k}if(!g.get("isCollapsed")){n+=l}if(!SC.none(p)){s=Math.min(p,s)
}if(!SC.none(h)){s=Math.max(h,s)}p=this.get("bottomRightMaxThickness");h=this.get("bottomRightMinThickness");
x=n-s;if(!SC.none(p)){x=Math.min(p,x)}if(!SC.none(h)){x=Math.max(h,x)}s=n-x;s=this.invokeDelegateMethod(this.delegate,"splitViewConstrainThickness",this,d,s);
s=Math.min(s,n);s=Math.max(0,s);m=d.get("collapseAtThickness");if(!m){m=0}z=g.get("collapseAtThickness");
z=SC.none(z)?n:(n-z);if((e<=m)&&this.canCollapseView(d)){p=g.get("maxThickness");
if(!p||(o+n)<=p){s=0}}else{if(e>=z&&this.canCollapseView(g)){p=d.get("maxThickness");
if(!p||(o+n)<=p){s=n}}}if(s!=this.thicknessForView(d)){this._desiredTopLeftThickness=s;
d.set("isCollapsed",s===0);g.set("isCollapsed",s>=n);this.updateChildLayout();this.displayDidChange()
}},_updateBottomRightThickness:function(j){var d=this._topLeftView,g=this._bottomRightView,k=this.thicknessForView(d),l=this.thicknessForView(g),o=this._dividerThickness,n=0,e=this._topLeftViewThickness+j,u=this._layoutDirection,y=this.canCollapseView(g),s=e,p=this.get("topLeftMaxThickness"),h=this.get("topLeftMinThickness"),x,m,z;
if(!d.get("isCollapsed")){n+=k}if(!g.get("isCollapsed")){n+=l}if(!SC.none(p)){s=Math.min(p,s)
}if(!SC.none(h)){s=Math.max(h,s)}p=this.get("bottomRightMaxThickness");h=this.get("bottomRightMinThickness");
x=n-s;if(!SC.none(p)){x=Math.min(p,x)}if(!SC.none(h)){x=Math.max(h,x)}s=n-x;s=this.invokeDelegateMethod(this.delegate,"splitViewConstrainThickness",this,d,s);
s=Math.min(s,n);s=Math.max(0,s);m=d.get("collapseAtThickness");if(!m){m=0}z=g.get("collapseAtThickness");
z=SC.none(z)?n:(n-z);if((e<=m)&&this.canCollapseView(d)){p=g.get("maxThickness");
if(!p||(o+n)<=p){s=0}}else{if(e>=z&&this.canCollapseView(g)){p=d.get("maxThickness");
if(!p||(o+n)<=p){s=n}}}if(s!=this.thicknessForView(d)){this._desiredTopLeftThickness=s;
d.set("isCollapsed",s===0);g.set("isCollapsed",s>=n);this.updateChildLayout();this.displayDidChange()
}},_setCursorStyle:function(){var h=this._topLeftView,j=this._bottomRightView,d=this.get("thumbViewCursor"),e=this.thicknessForView(h),g=this.thicknessForView(j);
this._layoutDirection=this.get("layoutDirection");if(h.get("isCollapsed")||e===this.get("topLeftMinThickness")||g==this.get("bottomRightMaxThickness")){d.set("cursorStyle",this._layoutDirection===SC.LAYOUT_HORIZONTAL?"e-resize":"s-resize")
}else{if(j.get("isCollapsed")||e===this.get("topLeftMaxThickness")||g==this.get("bottomRightMinThickness")){d.set("cursorStyle",this._layoutDirection===SC.LAYOUT_HORIZONTAL?"w-resize":"n-resize")
}else{if(SC.browser.msie){d.set("cursorStyle",this._layoutDirection===SC.LAYOUT_HORIZONTAL?"e-resize":"n-resize")
}else{d.set("cursorStyle",this._layoutDirection===SC.LAYOUT_HORIZONTAL?"ew-resize":"ns-resize")
}}}}.observes("layoutDirection"),splitViewCanCollapse:function(e,d){if(e.get("canCollapseViews")===NO){return NO
}if(d.get("canCollapse")===NO){return NO}return YES},splitViewConstrainThickness:function(g,d,e){return e
},_forceSplitCalculation:function(){this.updateLayout()}.observes("*pane.isPaneAttached"),viewDidResize:function(){arguments.callee.base.apply(this,arguments);
this.notifyPropertyChange("topLeftThickness").notifyPropertyChange("bottomRightThickness")
}.observes("layout")});sc_require("views/split");SC.SplitDividerView=SC.View.extend({classNames:["sc-split-divider-view"],prepareContext:function(d,g){var e=this.get("splitView");
if(e){this.set("cursor",e.get("thumbViewCursor"))}return arguments.callee.base.apply(this,arguments)
},mouseDown:function(d){var e=this.get("splitView");return(e)?e.mouseDownInThumbView(d,this):arguments.callee.base.apply(this,arguments)
},doubleClick:function(d){var e=this.get("splitView");return(e)?e.doubleClickInThumbView(d,this):arguments.callee.base.apply(this,arguments)
},touchStart:function(d){return this.mouseDown(d)}});sc_require("views/collection");
SC.StackedView=SC.CollectionView.extend({classNames:["sc-stacked-view"],layout:{top:0,left:0,right:0,height:1},computeNowShowing:function(d){return this.get("allContentIndexes")
},updateHeight:function(d){if(d){this._updateHeight()}else{this.invokeLast(this._updateHeight)
}return this},_updateHeight:function(){var j=this.get("childViews"),e=j.get("length"),g,h,d;
if(e===0){d=1}else{g=j.objectAt(e-1);h=g?g.get("layer"):null;d=h?(h.offsetTop+h.offsetHeight):1;
h=null}this.adjust("height",d)},didReload:function(d){return this.updateHeight()},didCreateLayer:function(){return this.updateHeight()
}});SC.StaticContentView=SC.View.extend(SC.StaticLayout,{classNames:["sc-static-content-view"],displayProperties:["content"],content:null,contentLayoutDidChange:function(){this.notifyPropertyChange("frame")
},useStaticLayout:YES,frame:function(){var d=this.get("layer"),e;if(!d){return{x:0,y:0,width:0,height:0}
}if(d.getBoundingClientRect){e=d.getBoundingClientRect();return{x:0,y:0,width:e.width,height:e.height}
}else{return{x:0,y:0,width:d.clientWidth,height:d.clientHeight}}}.property("content").cacheable(),parentViewDidResize:function(){this.contentLayoutDidChange()
},didCreateLayer:function(){this.contentLayoutDidChange()},render:function(d,g){var e=this.get("content");
if(e){d.push(e||"")}}});sc_require("views/segmented");SC.TOP_LOCATION="top";SC.TOP_TOOLBAR_LOCATION="top-toolbar";
SC.BOTTOM_LOCATION="bottom";SC.TabView=SC.View.extend({classNames:["sc-tab-view"],displayProperties:["nowShowing"],nowShowing:null,items:[],isEnabled:YES,itemTitleKey:null,itemValueKey:null,itemIsEnabledKey:null,itemIconKey:null,itemWidthKey:null,itemToolTipKey:null,tabHeight:SC.REGULAR_BUTTON_HEIGHT,tabLocation:SC.TOP_LOCATION,userDefaultKey:null,_tab_nowShowingDidChange:function(){var d=this.get("nowShowing");
this.get("containerView").set("nowShowing",d);this.get("segmentedView").set("value",d);
return this}.observes("nowShowing"),_tab_saveUserDefault:function(){var d=this.get("nowShowing");
var e=this.get("userDefaultKey");if(e){SC.userDefaults.set([e,"nowShowing"].join(":"),d)
}}.observes("nowShowing"),_tab_itemsDidChange:function(){this.get("segmentedView").set("items",this.get("items"));
return this}.observes("items"),init:function(){arguments.callee.base.apply(this,arguments);
this._tab_nowShowingDidChange()._tab_itemsDidChange()},awake:function(){arguments.callee.base.apply(this,arguments);
var d=this.get("userDefaultKey");if(d){d=[d,"nowShowing"].join(":");var e=SC.userDefaults.get(d);
if(!SC.none(e)){this.set("nowShowing",e)}}},createChildViews:function(){var k=[],d,j,h,g=this.get("tabLocation"),e=this.get("tabHeight");
h=(g===SC.TOP_LOCATION)?{top:e/2+1,left:0,right:0,bottom:0}:(g===SC.TOP_TOOLBAR_LOCATION)?{top:e+1,left:0,right:0,bottom:0}:{top:0,left:0,right:0,bottom:e-1};
j=this.containerView.extend(SC.Border,{layout:h,borderStyle:SC.BORDER_BLACK});d=this.containerView=this.createChildView(j);
k.push(d);h=(g===SC.TOP_LOCATION||g===SC.TOP_TOOLBAR_LOCATION)?{height:e,left:0,right:0,top:0}:{height:e,left:0,right:0,bottom:0};
this.segmentedView=this.get("segmentedView").extend({layout:h,_sc_tab_segmented_valueDidChange:function(){var l=this.get("parentView");
if(l){l.set("nowShowing",this.get("value"))}this.set("layerNeedsUpdate",YES);this.invokeOnce(this.updateLayerIfNeeded)
}.observes("value"),init:function(){var l=this.get("parentView");if(l){SC._TAB_ITEM_KEYS.forEach(function(m){this[m]=l.get(m)
},this)}return arguments.callee.base.apply(this,arguments)}});d=this.segmentedView=this.createChildView(this.segmentedView);
k.push(d);this.set("childViews",k);return this},containerView:SC.ContainerView,segmentedView:SC.SegmentedView});
SC._TAB_ITEM_KEYS="itemTitleKey itemValueKey itemIsEnabledKey itemIconKey itemWidthKey itemToolTipKey".w();
SC.ThumbView=SC.View.extend({classNames:["sc-thumb-view"],isEnabled:YES,isEnabledBindingDefault:SC.Binding.bool(),prepareContext:function(d,g){var e=this.get("splitView");
if(e){this.set("cursor",e.get("thumbViewCursor"))}return arguments.callee.base.apply(this,arguments)
},mouseDown:function(d){if(!this.get("isEnabled")){return NO}var e=this.get("splitView");
return(e)?e.mouseDownInThumbView(d,this):arguments.callee.base.apply(this,arguments)
},touchStart:function(d){return this.mouseDown(d)}});SC.ToolbarView=SC.View.extend({classNames:["sc-toolbar-view"],anchorLocation:null,layout:{left:0,height:32,right:0},init:function(){if(this.anchorLocation){this.layout=SC.merge(this.layout,this.anchorLocation)
}arguments.callee.base.apply(this,arguments)}});SC.WebView=SC.View.extend(SC.Control,{classNames:"sc-web-view",displayProperties:["value","shouldAutoResize"],shouldAutoResize:NO,render:function(d,h){var g=this.get("value");
if(h){d.push('<iframe src="'+g+'" style="position: absolute; width: 100%; height: 100%; border: 0px; margin: 0px; padding: 0p;"></iframe>')
}else{var e=this.$("iframe");e.attr("src","javascript:;");e.attr("src",g)}},didCreateLayer:function(){var d=this.$("iframe");
SC.Event.add(d,"load",this,this.iframeDidLoad)},iframeDidLoad:function(){if(this.get("shouldAutoResize")===YES){var d;
var g=this.$("iframe")[0];if(g&&g.contentWindow){d=g.contentWindow;if(d&&d.document&&d.document.documentElement){var e=d.document.documentElement;
if(!SC.browser.isIE){this.$().width(e.scrollWidth);this.$().height(e.scrollHeight)
}else{this.$().width(e.scrollWidth+12);this.$().height(e.scrollHeight+5)}}}}}});SC.WELL_CONTAINER_PADDING=15;
SC.WellView=SC.ContainerView.extend({classNames:"sc-well-view",contentLayout:{top:SC.WELL_CONTAINER_PADDING,bottom:SC.WELL_CONTAINER_PADDING,left:SC.WELL_CONTAINER_PADDING,right:SC.WELL_CONTAINER_PADDING},createChildViews:function(){var d=this.get("contentView");
if(d){d=this.contentView=this.createChildView(d);d.set("layout",this.contentLayout);
this.childViews=[d]}},render:function(d,e){if(e){d.push("<div class='top-left-edge'></div>","<div class='top-edge'></div>","<div class='top-right-edge'></div>","<div class='right-edge'></div>","<div class='bottom-right-edge'></div>","<div class='bottom-edge'></div>","<div class='bottom-left-edge'></div>","<div class='left-edge'></div>","<div class='content-background'></div>")
}arguments.callee.base.apply(this,arguments)},contentViewDidChange:function(){var d=this.get("contentView");
d.set("layout",this.contentLayout);this.replaceContent(d)}.observes("contentView")});
sc_require("controllers/controller");sc_require("mixins/selection_support");SC.ArrayController=SC.Controller.extend(SC.Array,SC.SelectionSupport,{content:null,isEditable:YES,orderBy:null,allowsSingleContent:YES,destroyOnRemoval:NO,arrangedObjects:function(){return this
}.property().cacheable(),canRemoveContent:function(){var e=this.get("content"),d;
d=!!e&&this.get("isEditable")&&this.get("hasContent");if(d){return !e.isEnumerable||(SC.typeOf(e.removeObject)===SC.T_FUNCTION)
}else{return NO}}.property("content","isEditable","hasContent"),canReorderContent:function(){var e=this.get("content"),d;
d=!!e&&this.get("isEditable")&&!this.get("orderBy");return d&&!!e.isSCArray}.property("content","isEditable","orderBy"),canAddContent:function(){var e=this.get("content"),d;
d=e&&this.get("isEditable")&&e.isEnumerable;if(d){return(SC.typeOf(e.addObject)===SC.T_FUNCTION)||(SC.typeOf(e.pushObject)===SC.T_FUNCTION)
}else{return NO}}.property("content","isEditable"),hasContent:function(){var d=this.get("content");
return !!d&&(!!d.isEnumerable||!!this.get("allowsSingleContent"))}.property("content","allowSingleContent"),status:function(){var e=this.get("content"),d=e?e.get("status"):null;
return d?d:SC.Record.READY}.property().cacheable(),addObject:function(d){if(!this.get("canAddContent")){throw"%@ cannot add content".fmt(this)
}var e=this.get("content");if(e.isSCArray){e.pushObject(d)}else{if(e.addObject){e.addObject(d)
}else{throw"%@.content does not support addObject".fmt(this)}}return this},removeObject:function(d){if(!this.get("canRemoveContent")){throw"%@ cannot remove content".fmt(this)
}var e=this.get("content");if(e.isEnumerable){e.removeObject(d)}else{this.set("content",null)
}if(this.get("destroyOnRemoval")&&d.destroy){d.destroy()}return this},length:function(){var d=this._scac_observableContent();
return d?d.get("length"):0}.property().cacheable(),objectAt:function(d){var e=this._scac_observableContent();
return e?e.objectAt(d):undefined},replace:function(l,k,h){if(!h||h.get("length")===0){if(!this.get("canRemoveContent")){throw"%@ cannot remove objects from the current content".fmt(this)
}}else{if(!this.get("canReorderContent")){throw"%@ cannot add or reorder the current content".fmt(this)
}}var g=this.get("content");var e=[],d,j;if(this.get("destroyOnRemoval")){for(d=0;
d<k;d++){e.push(g.objectAt(d+l))}}if(g){g.replace(l,k,h)}for(d=0,j=e.length;d<j;d++){e[d].destroy()
}e=null;return this},indexOf:function(e,d){var g=this._scac_observableContent();return g?g.indexOf(e,d):-1
},init:function(){arguments.callee.base.apply(this,arguments);this._scac_contentDidChange()
},_scac_cached:NO,_scac_observableContent:function(){var e=this._scac_cached;if(e!==NO){return e
}var j=this.get("content"),k,h,g,d;if(SC.none(j)){return this._scac_cached=[]}if(!j.isEnumerable){e=this.get("allowsSingleContent")?[j]:[];
return(this._scac_cached=e)}k=this.get("orderBy");if(!k){if(j.isSCArray){return(this._scac_cached=j)
}else{throw"%@.orderBy is required for unordered content".fmt(this)}}switch(SC.typeOf(k)){case SC.T_STRING:k=[k];
break;case SC.T_FUNCTION:h=k;break;case SC.T_ARRAY:break;default:throw"%@.orderBy must be Array, String, or Function".fmt(this)
}if(!h){d=k.get("length");h=function(o,m){var l=0,n=0,p,u,s,x;for(l=0;(l<d)&&(n===0);
l++){p=k.objectAt(l);x=NO;if(p.indexOf("ASC")>-1){p=p.split("ASC ")[1]}else{if(p.indexOf("DESC")>-1){p=p.split("DESC ")[1];
x=YES}}if(!o){u=o}else{if(o.isObservable){u=o.get(p)}else{u=o[p]}}if(!m){s=m}else{if(m.isObservable){s=m.get(p)
}else{s=m[p]}}n=SC.compare(u,s);if(x){n=(-1)*n}}return n}}e=[];j.forEach(function(l){e.push(l)
});e.sort(h);h=null;return(this._scac_cached=e)},_scac_contentDidChange:function(){this._scac_cached=NO;
var m=this.get("content"),h=!!this.get("orderBy"),n=this._scac_content,d=this._scac_length||0,l=this._scac_rangeObserver,e=this._scac_rangeDidChange,k=this._scac_enumerableDidChange,g=this._scac_contentStatusDidChange,j;
if(n===m){return this}if(n){if(l&&n.isSCArray){n.removeRangeObserver(l)}else{if(n.isEnumerable){n.removeObserver("[]",this,k)
}}n.removeObserver("status",this,g)}l=null;this._scac_cached=NO;this._scac_content=m;
if(m){if(!h&&m.isSCArray){l=m.addRangeObserver(null,this,e)}else{if(m.isEnumerable){m.addObserver("[]",this,k)
}}j=m.isEnumerable?m.get("length"):1;m.addObserver("status",this,g)}else{j=SC.none(m)?0:1
}this._scac_rangeObserver=l;this._scac_length=j;this._scac_contentStatusDidChange();
this.enumerableContentDidChange(0,j,j-d);this.updateSelectionAfterContentChange()
}.observes("content"),_scac_enumerableDidChange:function(){var d=this.get("content"),g=d?d.get("length"):0,e=this._scac_length;
this._scac_length=g;this.beginPropertyChanges();this._scac_cached=NO;this.enumerableContentDidChange(0,g,g-e);
this.endPropertyChanges();this.updateSelectionAfterContentChange()}.observes("orderBy"),_scac_rangeDidChange:function(j,h,e,d){if(e!=="[]"){return
}var g=this.get("content");this._scac_length=g.get("length");this._scac_cached=NO;
if(d){this.beginPropertyChanges();d.forEachRange(function(l,k){this.enumerableContentDidChange(l,k,0)
},this);this.endPropertyChanges();this.updateSelectionAfterContentChange()}},_scac_contentStatusDidChange:function(){this.notifyPropertyChange("status")
}});SC.Controller=SC.Object.extend({isEditable:YES});require("controllers/controller");
SC.ObjectController=SC.Controller.extend({content:null,allowsMultipleContent:NO,hasContent:function(){return !SC.none(this.get("observableContent"))
}.property("observableContent"),isEditable:YES,observableContent:function(){var e=this.get("content"),d,g;
if(e&&e.isEnumerable){d=e.get("length");g=this.get("allowsMultipleContent");if(d===1){e=e.firstObject()
}else{if(d===0||!g){e=null}}if(e&&!g&&e.isEnumerable){e=null}}return e}.property("content","allowsMultipleContent").cacheable(),destroy:function(){var d=this.get("observableContent");
if(d&&SC.typeOf(d.destroy)===SC.T_FUNCTION){d.destroy()}this.set("content",null);
return this},contentPropertyDidChange:function(e,d){if(d==="*"){this.allPropertiesDidChange()
}else{this.notifyPropertyChange(d)}},unknownProperty:function(e,h){if(e==="content"){if(h!==undefined){this.content=h
}return this.content}var g=this.get("observableContent"),k,j,d;if(g===null||g===undefined){return undefined
}if(h===undefined){if(g.isEnumerable){h=g.getEach(e);k=h.get("length");if(k>0){d=YES;
j=h.objectAt(0);while((--k>0)&&d){if(j!==h.objectAt(k)){d=NO}}if(d){h=j}}else{h=undefined
}}else{h=(g.isObservable)?g.get(e):g[e]}}else{if(!this.get("isEditable")){throw"%@.%@ is not editable".fmt(this,e)
}if(g.isEnumerable){g.setEach(e,h)}else{if(g.isObservable){g.set(e,h)}else{g[e]=h
}}}return h},init:function(){arguments.callee.base.apply(this,arguments);if(this.get("content")){this._scoc_contentDidChange()
}if(this.get("observableContent")){this._scoc_observableContentDidChange()}},_scoc_contentDidChange:function(){var e=this._scoc_content,g=this.get("content");
if(e!==g){this._scoc_content=g;var d=this._scoc_enumerableContentDidChange;if(e&&e.isEnumerable){e.removeObserver("[]",this,d)
}if(g&&g.isEnumerable){g.addObserver("[]",this,d)}}}.observes("content"),_scoc_observableContentDidChange:function(){var e=this._scoc_observableContent,h=this.get("observableContent"),d=this.contentPropertyDidChange,g=this._scoc_enumerableContentDidChange;
if(e===h){return this}this._scoc_observableContent=h;if(e){if(e.isEnumerable){e.removeObserver("[]",this,g)
}else{if(e.isObservable){e.removeObserver("*",this,d)}}}if(h){if(h.isEnumerable){h.addObserver("[]",this,g)
}else{if(h.isObservable){h.addObserver("*",this,d)}}}if((e&&e.isEnumerable)||(h&&h.isEnumerable)){this._scoc_enumerableContentDidChange()
}else{this.contentPropertyDidChange(h,"*")}}.observes("observableContent"),_scoc_enumerableContentDidChange:function(){var e=this.get("observableContent"),g=this._scoc_observableContentItems,d=this.contentPropertyDidChange;
if(g){g.forEach(function(h){if(h.isObservable){h.removeObserver("*",this,d)}},this);
g.clear()}if(e&&e.isEnumerable){if(!g){g=SC.Set.create()}e.forEach(function(h){if(g.contains(h)){return
}g.add(h);if(h.isObservable){h.addObserver("*",this,d)}},this)}else{g=null}this._scoc_observableContentItems=g;
this.contentPropertyDidChange(e,"*");return this}});sc_require("controllers/object");
sc_require("mixins/selection_support");sc_require("private/tree_item_observer");SC.TreeController=SC.ObjectController.extend(SC.SelectionSupport,{treeItemIsGrouped:NO,treeItemIsExpandedKey:"treeItemIsExpanded",treeItemChildrenKey:"treeItemChildren",arrangedObjects:function(){var d,e=this.get("content");
if(e){d=SC.TreeItemObserver.create({item:e,delegate:this})}else{d=null}this._sctc_arrangedObjects=d;
return d}.property().cacheable(),_sctc_invalidateArrangedObjects:function(){this.propertyWillChange("arrangedObjects");
var d=this._sctc_arrangedObjects;if(d){d.destroy()}this._sctc_arrangedObjects=null;
this.propertyDidChange("arrangedObjects")}.observes("content","treeItemIsExpandedKey","treeItemChildrenKey","treeItemIsGrouped"),_sctc_arrangedObjectsContentDidChange:function(){this.updateSelectionAfterContentChange()
}.observes("*arrangedObjects.[]"),firstSelectableObject:function(){var h=this.get("arrangedObjects"),g,e,d=0;
if(!h){return null}g=h.contentGroupIndexes(null,h);e=h.get("length");while(g.contains(d)&&(d<e)){d++
}return d>=e?null:h.objectAt(d)}.property()});SC.DROP_ON=1;SC.DROP_BEFORE=2;SC.DROP_AFTER=4;
SC.DROP_ANY=7;SC.SAFARI_FOCUS_BEHAVIOR=YES;SC.mixin({data:function(g,e,h){g=(g===window)?"@window":g;
var j=SC.hashFor(g);var d=SC._data_cache;if(!d){SC._data_cache=d={}}var k=d[j];if(e&&!k){d[j]=k={}
}if(k&&(h!==undefined)){k[e]=h}return(e)?k[e]:k},removeData:function(h,g){h=(h===window)?"@window":h;
var j=SC.hashFor(h);var d=SC._data_cache;if(!d){return undefined}var k=d[j];if(!k){return undefined
}var e=(g)?k[g]:k;if(g){delete k[g]}else{delete d[j]}return e}});SC.mixin(Function.prototype,{invokeLater:function(k,d){if(d===undefined){d=1
}var j=this;if(arguments.length>2){var e=SC.$A(arguments).slice(2,arguments.length);
e.unshift(k);var h=this,g=j;j=function(){return g.apply(h,e.slice(1))}}return SC.Timer.schedule({target:k,action:j,interval:d})
}});sc_require("panes/pane");SC.ControlTestPane=SC.Pane.extend({classNames:["sc-control-test-pane"],layout:{right:20,width:350,top:65,bottom:5},top:0,height:20,padding:4,view:function(e){var d=this._views[e];
if(!d){throw"SC.ControlTestPane does not have a view named %@".fmt(e)}return this.childViews[d].childViews[0]
},init:function(){arguments.callee.base.apply(this,arguments);if(!this._views){this._views={}
}this.append();var e=this.get("layout"),d=e.right+e.width;setTimeout(function(){if(!Q$){return
}Q$(".core-test > .detail").css("marginRight",d)},100)}});SC.ControlTestPane.add=function(m,k,o){if(o===undefined){o={}
}if(!k.isDesign){k=k.design(o)}var l=this.prototype.padding,s=this.prototype.height;
var j=this.prototype.top+l*2,h;var g=14;if(j===l*2){j=l}if(k.prototype.layout&&(typeof k.prototype.layout.height===SC.T_NUMBER)){s=k.prototype.layout.height
}this.prototype.top=j+s+g+(l*2);h={left:l,width:150,top:j,height:20};var e=SC.LabelView.design({value:m+":",layout:{left:0,right:0,top:0,height:g},fontWeight:SC.BOLD_WEIGHT});
e=SC.View.design().layout(h).childView(e);this.childView(e);var d=SC.View.design({classNames:["wrapper"],layout:{left:l,top:j+g+l,right:l,height:s},childViews:[k]});
var n=this.prototype.childViews.length;this.childView(d);var p=this.prototype._views;
if(!p){p=this.prototype._views={}}p[m]=n;return this};SC.ControlTestPane.standardSetup=function(){var d=this;
return{setup:function(){SC.RunLoop.begin();d._pane=d.create();SC.RunLoop.end()},teardown:function(){SC.RunLoop.begin();
if(d._pane){d._pane.remove()}SC.RunLoop.end();d._pane=null}}};SC.ControlTestPane.view=function(d){var e=this._pane||this._showPane;
if(!e){throw"view() cannot be called on a class"}return e.view(d)};SC.ControlTestPane.show=function(){var d=this;
test("show control test pane",function(){SC.RunLoop.begin();d._showPane=d.create();
SC.RunLoop.end()})};sc_require("system/locale");SC.stringsFor("English",{"_SC.DateTime.dayNames":"Sunday Monday Tuesday Wednesday Thursday Friday Saturday","_SC.DateTime.abbreviatedDayNames":"Sun Mon Tue Wed Thu Fri Sat","_SC.DateTime.monthNames":"January February March April May June July August September October November December","_SC.DateTime.abbreviatedMonthNames":"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec"});
SC.mixin(SC.Object.prototype,{invokeLater:function(e,d){if(d===undefined){d=1}var j=e,g,h;
if(arguments.length>2){g=SC.$A(arguments).slice(2);if(SC.typeOf(j)===SC.T_STRING){j=this[e]
}h=j;j=function(){return h.apply(this,g)}}return SC.Timer.schedule({target:this,action:j,interval:d})
},invokeWith:function(e,g,h){if(h===undefined){h=g;g=this}if(!g){g=this}if(SC.typeOf(h)===SC.T_STRING){h=g[h]
}var d=this.getPath(e);h.call(g,d,this);return this}});SC.RunLoop=SC.RunLoop.extend({startTime:function(){if(!this._start){this._start=Date.now()
}return this._start}.property(),endRunLoop:function(){this.fireExpiredTimers();var d=arguments.callee.base.apply(this,arguments);
this.scheduleNextTimeout();return d},scheduleTimer:function(e,d){this._timerQueue=e.removeFromTimerQueue(this._timerQueue);
this._timerQueue=e.scheduleInTimerQueue(this._timerQueue,d);return this},cancelTimer:function(d){this._timerQueue=d.removeFromTimerQueue(this._timerQueue);
return this},TIMER_ARRAY:[],fireExpiredTimers:function(){if(!this._timerQueue||this._firing){return NO
}var h=this.get("startTime"),j=this.TIMER_ARRAY,g,e,d;this._firing=YES;this._timerQueue=this._timerQueue.collectExpiredTimers(j,h);
e=j.length;for(g=0;g<e;g++){j[g].fire()}d=j.length>0;j.length=0;this._firing=NO;return d
},scheduleNextTimeout:function(){var h=this._timerQueue;var e=NO;if(!h){if(this._timeout){clearTimeout(this._timeout)
}}else{var g=h._timerQueueRunTime;if(this._timeoutAt!==g){if(this._timeout){clearTimeout(this._timeout)
}var d=Math.max(0,g-Date.now());this._timeout=setTimeout(this._timeoutDidFire,d);
this._timeoutAt=g}e=YES}return e},_timeoutDidFire:function(){var d=SC.RunLoop.currentRunLoop;
d._timeout=d._timeoutAt=null;SC.RunLoop.begin().end()}});SC.RunLoop.currentRunLoop=SC.RunLoop.create();
/* @license

Portions of this software are copyright Yahoo, Inc, used under the following license:

Software License Agreement (BSD License)
Copyright (c) 2009, Yahoo! Inc.
All rights reserved.
Redistribution and use of this software in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this list of conditions and the
following disclaimer.
Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
Neither the name of Yahoo! Inc. nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission of Yahoo! Inc.
THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

Sources of Intellectual Property Included in the YUI Library
Where not otherwise indicated, all YUI content is authored by Yahoo! engineers and consists of Yahoo!-owned intellectual property. YUI is issued by Yahoo! under the BSD license above. In some specific instances, YUI will incorporate work done by developers outside of Yahoo! with their express permission.

*/
SC.Button={value:null,toggleOnValue:YES,toggleOffValue:NO,localize:NO,localizeBindingDefault:SC.Binding.bool(),title:"",contentTitleKey:null,icon:null,contentIconKey:null,needsEllipsis:YES,displayTitle:function(){var d=this.get("title");
return(d&&this.get("localize"))?d.loc():(d||"")}.property("title","localize").cacheable(),keyEquivalent:null,renderTitle:function(e,d){var l=this.get("icon"),h="",m=this.get("displayTitle"),n=(!SC.none(m)&&m.length>0),g,o,j;
if(this.get("escapeHTML")){m=SC.RenderContext.escapeHTML(m)}if(l){var k=SC.BLANK_IMAGE_URL;
if(l.indexOf("/")>=0){h='<img src="'+l+'" alt="" class="icon" />'}else{h='<img src="'+k+'" alt="" class="'+l+'" />'
}n=YES}j=h+m;if(d){if(this.get("needsEllipsis")){e.push('<label class="sc-button-label ellipsis">'+j+"</label>")
}else{e.push('<label class="sc-button-label">'+j+"</label>")}this._ImageTitleCached=j
}else{g=this.$("label");if((o=g[0])){if(n){if(this.get("needsEllipsis")){g.addClass("ellipsis");
if(this._ImageTitleCached!==j){this._ImageTitleCached=j;o.innerHTML=j}}else{g.removeClass("ellipsis");
if(this._ImageTitleCached!==j){this._ImageTitleCached=j;o.innerHTML=j}}}else{o.innerHTML=""
}}}return e},contentPropertyDidChange:function(m,g){var e=this.get("displayDelegate"),j=this.get("content"),l;
var h=this.getDelegateProperty("contentValueKey",e);if(h&&(g===h||g==="*")){this.set("value",j?j.get(h):null)
}var d=this.getDelegateProperty("contentTitleKey",e);if(d&&(g===d||g==="*")){this.set("title",j?j.get(d):null)
}var k=this.getDelegateProperty("contentIconKey",e);if(k&&(g===k||g==="*")){this.set("icon",j?j.get(k):null)
}return this},_button_displayObserver:function(){this.displayDidChange()}.observes("title","icon","value"),performKeyEquivalent:function(g,e){if(!this.get("isEnabled")){return NO
}var d=this.get("keyEquivalent");if(d){if(d===g){return this.triggerAction(e)}}else{if((this.get("isDefault")&&(g==="return"))||(this.get("isCancel")&&(g==="escape"))){return this.triggerAction(e)
}}return NO},triggerAction:function(d){throw"SC.Button.triggerAction() is not defined in %@".fmt(this)
},computeIsSelectedForValue:function(h){var e=this.get("toggleOnValue"),g,d;if(SC.typeOf(h)===SC.T_ARRAY){if(h.length===1){g=(h[0]==e)
}else{g=null;h.find(function(j){d=(j==e);if(g===null){g=d}else{if(d!==g){g=SC.MIXED_STATE
}}return g===SC.MIXED_STATE})}}else{if(h===SC.MIXED_STATE){g=SC.MIXED_STATE}else{g=(h==e)
}}return g},initMixin:function(){if(!SC.none(this.get("value"))){this._button_valueDidChange()
}},_button_valueDidChange:function(){var e=this.get("value"),d=this.computeIsSelectedForValue(e);
this.set("isSelected",d)}.observes("value"),_button_isSelectedDidChange:function(){var g=this.get("isSelected"),e=this.computeIsSelectedForValue(this.get("value"));
if((g!==SC.MIXED_STATE)&&(e!==g)){var d=(g)?"toggleOnValue":"toggleOffValue";this.set("value",this.get(d))
}}.observes("isSelected")};SC.BRANCH_OPEN=17;SC.BRANCH_CLOSED=18;SC.LEAF_NODE=32;
SC.CollectionContent={isCollectionContent:YES,contentIndexIsSelected:function(e,g,d){var h=e.get("selection");
return h?h.contains(g,d):NO},contentIndexIsEnabled:function(e,g,d){return e.get("isEnabled")
},contentGroupIndexes:function(d,e){return null},contentIndexIsGroup:function(e,g,d){return NO
},contentIndexOutlineLevel:function(e,g,d){return -1},contentIndexDisclosureState:function(e,g,d){return SC.LEAF_NODE
},contentIndexExpand:function(e,g,d){console.log("contentIndexExpand(%@, %@, %@)".fmt(e,g,d))
},contentIndexCollapse:function(e,g,d){console.log("contentIndexCollapse(%@, %@, %@)".fmt(e,g,d))
}};SC.ContentDisplay={concatenatedProperties:"contentDisplayProperties",displayProperties:["content"],contentDisplayProperties:[],_display_contentDidChange:function(j,d,h){if((h=this.get("content"))!=this._display_content){var g=this._display_contentPropertyDidChange;
var e=this._display_content;if(e){if(SC.isArray(e)){e.invoke("removeObserver","*",this,g)
}else{if(e.removeObserver){e.removeObserver("*",this,g)}}}e=this._display_content=h;
if(e){if(SC.isArray(e)){e.invoke("addObserver","*",this,g)}else{if(e.addObserver){e.addObserver("*",this,g)
}}}this.allPropertiesDidChange();this.endPropertyChanges()}}.observes("content","contentDisplayProperties"),_display_contentPropertyDidChange:function(j,g,h,e){if(g==="*"){this.displayDidChange()
}else{var d=this.get("contentDisplayProperties");if(d&&d.indexOf(g)>=0){this.displayDidChange()
}}}};sc_require("mixins/string");SC.MIXED_STATE="__MIXED__";SC.HUGE_CONTROL_SIZE="sc-huge-size";
SC.LARGE_CONTROL_SIZE="sc-large-size";SC.REGULAR_CONTROL_SIZE="sc-regular-size";SC.SMALL_CONTROL_SIZE="sc-small-size";
SC.TINY_CONTROL_SIZE="sc-tiny-size";SC.Control={initMixin:function(){this._control_contentDidChange()
},isSelected:NO,isSelectedBindingDefault:SC.Binding.oneWay().bool(),isActive:NO,isActiveBindingDefault:SC.Binding.oneWay().bool(),value:null,content:null,contentValueKey:null,contentPropertyDidChange:function(e,d){return this.updatePropertyFromContent("value",d,"contentValueKey")
},updatePropertyFromContent:function(k,e,j,h){var g=e==="*";if(j===undefined){j="content"+k.capitalize()+"Key"
}if(h===undefined){h=this.get("content")}j=this[j]?this.get(j):this.getDelegateProperty(j,this.displayDelegate);
if(j&&(g||e===j)){var d=(h)?(h.get?h.get(j):h[j]):null;this.set(k,d)}return this},updateContentWithValueObserver:function(){var d=this.contentValueKey?this.get("contentValueKey"):this.getDelegateProperty("contentValueKey",this.displayDelegate),e=this.get("content");
if(!d||!e){return}var g=this.get("value");if(typeof e.setIfChanged===SC.T_FUNCTION){e.setIfChanged(d,g)
}else{if(e[d]!==g){e[d]=g}}}.observes("value"),fieldKey:null,fieldLabel:null,errorLabel:function(){var d,g,e;
if(d=this.get("fieldLabel")){return d}g=this.get("fieldKey")||this.constructor.toString();
e=(g||"").humanize().capitalize();return"ErrorLabel."+g.locWithDefault(("FieldKey."+g).locWithDefault(e))
}.property("fieldLabel","fieldKey").cacheable(),controlSize:SC.REGULAR_CONTROL_SIZE,displayProperties:"isEnabled isSelected isActive controlSize".w(),_CONTROL_TMP_CLASSNAMES:{},renderMixin:function(d,j){var g=this.get("isSelected"),e=!this.get("isEnabled"),h=this._CONTROL_TMP_CLASSNAMES;
h.mixed=g===SC.MIXED_STATE;h.sel=g&&(g!==SC.MIXED_STATE);h.active=this.get("isActive");
d.setClass(h).addClass(this.get("controlSize"))},_control_content:null,_control_contentDidChange:function(){var e=this.get("content");
if(this._control_content===e){return}var g=this.contentPropertyDidChange,d=this._control_content;
if(d&&d.removeObserver){d.removeObserver("*",this,g)}this._control_content=e;if(e&&e.addObserver){e.addObserver("*",this,g)
}this.contentPropertyDidChange(e,"*")}.observes("content")};SC.Editable={isEditable:NO,isEditing:NO,beginEditing:function(){if(!this.get("isEditable")){return NO
}if(this.get("isEditing")){return YES}this.beginPropertyChanges();this.set("isEditing",YES);
this.becomeFirstResponder();this.endPropertyChanges();return YES},discardEditing:function(){return !this.get("isEditing")
},commitEditing:function(){if(!this.get("isEditing")){return YES}this.set("isEditing",NO);
this.resignFirstResponder();return YES}};sc_require("views/text_field");SC.InlineTextFieldView=SC.TextFieldView.extend(SC.DelegateSupport,{_topOffsetForFirefoxCursorFix:0,beginEditing:function(e){if(!e){throw"InlineTextFiedl.beginEditing() requires options"
}if(this.get("isEditing")){return NO}var h={},k,g,j,d;d=this._delegate=e.delegate;
this.set("delegate",this._delegate);if(!this.invokeDelegateMethod(d,"inlineEditorShouldBeginEditing",this)){return NO
}this.beginPropertyChanges();this.set("isEditing",YES);this._optframe=e.frame;this._optIsCollection=e.isCollection;
this._exampleElement=e.exampleElement;if(!this._optframe||!this._delegate){throw"At least frame and delegate options are required for inline editor"
}this._originalValue=e.value||"";this._multiline=(e.multiline!==undefined)?e.multiline:NO;
if(this._multiline){this.set("isTextArea",YES)}else{this.set("isTextArea",NO)}this._commitOnBlur=(e.commitOnBlur!==undefined)?e.commitOnBlur:YES;
this.set("validator",e.validator);this.set("value",this._originalValue);k=this._delegate.pane();
h.height=this._optframe.height;h.width=this._optframe.width;g=this._delegate.get("layout");
j=k.$()[0];if(this._optIsCollection&&g.left){h.left=this._optframe.x-g.left-j.offsetLeft-1;
if(SC.browser.msie==7){h.left--}}else{h.left=this._optframe.x-j.offsetLeft-1;if(SC.browser.msie==7){h.left--
}}if(this._optIsCollection&&g.top){h.top=this._optframe.y-g.top-j.offsetTop;if(SC.browser.msie==7){h.top=h.top-2
}}else{h.top=this._optframe.y-j.offsetTop;if(SC.browser.msie==7){h.top=h.top-2}}this.set("layout",h);
this.set("parentNode",k);k.appendChild(this);d=this._delegate;this._className=this.getDelegateProperty(d,"inlineEditorClassName");
if(this._className&&!this.hasClassName(this._className)){this.setClassName(this._className,true)
}this.invokeDelegateMethod(d,"inlineEditorWillBeginEditing",this);this._previousFirstResponder=k?k.get("firstResponder"):null;
this.becomeFirstResponder();this.endPropertyChanges();this.invokeLast(function(){this.invokeDelegateMethod(d,"inlineEditorDidBeginEditing",this)
})},commitEditing:function(d){if(!SC.$ok(this.validateSubmit())){return NO}return this._endEditing(this.get("value"),d)
},discardEditing:function(){return this._endEditing(this._originalValue)},blurEditor:function(d){if(!this.get("isEditing")){return YES
}return this._commitOnBlur?this.commitEditing(d):this.discardEditing(d)},_endEditing:function(g,e){if(!this.get("isEditing")){return YES
}var d=this._delegate;if(!this.invokeDelegateMethod(d,"inlineEditorShouldEndEditing",this,g,e)){return NO
}this.invokeDelegateMethod(d,"inlineEditorDidEndEditing",this,g,e);if(this._className){this.setClassName(this._className,false)
}this._originalValue=this._delegate=this._exampleElement=this._optframe=this._className=null;
this.set("isEditing",NO);if(this.get("isFirstResponder")){var h=this.get("pane");
if(h&&this._previousFirstResponder){h.makeFirstResponder(this._previousFirstResponder)
}else{this.resignFirstResponder()}}this._previousFirstResponder=null;if(this.get("parentNode")){this.removeFromParent()
}return YES},isEditing:NO,mouseDown:function(d){arguments.callee.base.call(this,d);
return this.get("isEditing")},touchStart:function(d){this.mouseDown(d)},keyDown:function(d){var e=this.interpretKeyEvents(d);
this.fieldValueDidChange(true);return !e?NO:e},insertText:null,_scitf_blurInput:function(){var d=this.$input()[0];
if(d){d.blur()}d=null},willRemoveFromParent:function(){return this._scitf_blurInput()
},willLoseFirstResponder:function(e,d){if(e!==this){return}this._previousFirstResponder=null;
this._origEvent=d;this._scitf_blurInput();return this.blurEditor(d)},cancel:function(){this.discardEditing();
return YES},fieldValueDidChange:function(d){arguments.callee.base.call(this,d)},insertNewline:function(d){if(this._multiline){d.allowDefault();
return arguments.callee.base.call(this,d)}else{if(this.get("value")!=this.$input().val()){this.set("value",this.$input().val())
}this.commitEditing();return YES}},insertTab:function(d){this.resignFirstResponder();
this.commitEditing();if(this._delegate){var e=this._delegate.nextValidKeyView();if(e&&e.beginEditing){e.beginEditing()
}}return YES},insertBacktab:function(d){this.commitEditing();if(this._delegate){var e=this._delegate.previousValidKeyView();
if(e){e.beginEditing()}}return YES},deleteForward:function(d){d.allowDefault();return YES
},deleteBackward:function(d){d.allowDefault();return YES}});SC.InlineTextFieldView.mixin({beginEditing:function(e){this._exampleElement=e.exampleElement;
var d=e.exampleInlineTextFieldView?e.exampleInlineTextFieldView:this,k=e.delegate.get("layout"),j=this.updateViewStyle(),l=this.updateViewPaddingStyle();
var m=".inline-editor input{"+j+"} ";m=m+".inline-editor textarea{"+j+"} .inline-editor .padding{"+l+"}";
var h=document.getElementsByTagName("head")[0],g=document.createElement("style");
g.type="text/css";g.media="screen";if(g.styleSheet){g.styleSheet.cssText=m}else{g.appendChild(document.createTextNode(m))
}h.appendChild(g);this.editor=d.create({classNames:"inline-editor",layout:k});return this.editor.beginEditing(e)
},commitEditing:function(){return this.editor?this.editor.commitEditing():YES},discardEditing:function(){return this.editor?this.editor.discardEditing():YES
},updateViewStyle:function(){var e=this._exampleElement[0],g="",d=SC.getStyle(e,"font-size");
if(d&&d.length>0){g=g+"font-size: "+d+" !important; "}d=SC.getStyle(e,"font-family");
if(d&&d.length>0){g=g+"font-family: "+d+" !important; "}d=SC.getStyle(e,"font-weight");
if(d&&d.length>0){g=g+"font-weight: "+d+" !important; "}d=SC.getStyle(e,"z-index");
if(d&&d.length>0){g=g+"z-index: "+d+" !important; "}d=SC.getStyle(e,"line-height");
if(d&&d.length>0){g=g+"line-height: "+d+" !important; "}d=SC.getStyle(e,"text-align");
if(d&&d.length>0){g=g+"text-align: "+d+" !important; "}d=SC.getStyle(e,"top-margin");
if(d&&d.length>0){g=g+"top-margin: "+d+" !important; "}d=SC.getStyle(e,"bottom-margin");
if(d&&d.length>0){g=g+"bottom-margin: "+d+" !important; "}d=SC.getStyle(e,"left-margin");
if(d&&d.length>0){g=g+"left-margin: "+d+" !important; "}d=SC.getStyle(e,"right-margin");
if(d&&d.length>0){g=g+"right-margin: "+d+" !important; "}return g},updateViewPaddingStyle:function(){var e=this._exampleElement[0];
var g="";var d=SC.getStyle(e,"padding-top");if(d&&d.length>0){g=g+"top: "+d+" !important; "
}d=SC.getStyle(e,"padding-bottom");if(d&&d.length>0){g=g+"bottom: "+d+" !important; "
}d=SC.getStyle(e,"padding-left");if(d&&d.length>0){g=g+"left: "+d+" !important; "
}d=SC.getStyle(e,"padding-right");if(d&&d.length>0){g=g+"right: "+d+" !important; "
}return g},editor:null});sc_require("system/responder");SC.ResponderContext={isResponderContext:YES,trace:NO,defaultResponder:null,nextResponder:function(){return this.get("defaultResponder")
}.property("defaultResponder").cacheable(),firstResponder:null,nextResponderFor:function(d){var e=d.get("nextResponder");
if(typeof e===SC.T_STRING){e=SC.objectForPropertyPath(e,this)}else{if(!e&&(d!==this)){e=this
}}return e},responderNameFor:function(d){if(!d){return"(No Responder)"}else{if(d._scrc_name){return d._scrc_name
}}var e=this.NAMESPACE;this._findResponderNamesFor(this,3,e?[this.NAMESPACE]:[]);
return d._scrc_name||d.toString()},_findResponderNamesFor:function(d,j,h){var e,g;
for(e in d){if(e==="nextResponder"){continue}g=d[e];if(g&&g.isResponder){if(g._scrc_name){continue
}h.push(e);g._scrc_name=h.join(".");if(j>0){this._findResponderNamesFor(g,j-1,h)}h.pop()
}}},makeFirstResponder:function(e,d){var k=this.get("firstResponder"),h=this.get("nextResponder"),j=this.get("trace"),g;
if(this._locked){if(j){console.log("%@: AFTER ACTION: makeFirstResponder => %@".fmt(this,this.responderNameFor(e)))
}this._pendingResponder=e;return}if(j){console.log("%@: makeFirstResponder => %@".fmt(this,this.responderNameFor(e)))
}e.set("becomingFirstResponder",YES);this._locked=YES;this._pendingResponder=null;
g=e?e:null;while(g){if(g.get("hasFirstResponder")){break}g=(g===h)?null:this.nextResponderFor(g)
}if(!g){g=h}this._notifyWillLoseFirstResponder(k,k,g,d);if(k){k.set("isFirstResponder",NO)
}this.beginPropertyChanges();this.set("firstResponder",e);if(e){e.set("isFirstResponder",YES)
}this._notifyDidBecomeFirstResponder(e,e,g);this.endPropertyChanges();this._locked=NO;
if(this._pendingResponder){this.makeFirstResponder(this._pendingResponder);this._pendingResponder=null
}e.set("becomingFirstResponder",NO);return this},_notifyWillLoseFirstResponder:function(g,j,e,d){if(j===e){return
}j.willLoseFirstResponder(g,d);j.set("hasFirstResponder",NO);var h=this.nextResponderFor(j);
if(h){this._notifyWillLoseFirstResponder(g,h,e)}},_notifyDidBecomeFirstResponder:function(e,h,d){if(h===d){return
}var g=this.nextResponderFor(h);if(g){this._notifyDidBecomeFirstResponder(e,g,d)}h.set("hasFirstResponder",YES);
h.didBecomeFirstResponder(e)},sendAction:function(l,h,g){var d=this.get("firstResponder"),j=this.get("nextResponder"),k=this.get("trace"),m=NO,e;
this._locked=YES;if(k){console.log("%@: begin action '%@' (%@, %@)".fmt(this,l,h,g))
}if(!m&&!d&&this.tryToPerform){m=this.tryToPerform(l,h,g)}while(!m&&d){if(d.tryToPerform){m=d.tryToPerform(l,h,g)
}if(!m){d=(d===j)?null:this.nextResponderFor(d)}}if(k){if(!m){console.log("%@:  action '%@' NOT HANDLED".fmt(this,l))
}else{console.log("%@: action '%@' handled by %@".fmt(this,l,this.responderNameFor(d)))
}}this._locked=NO;if(e=this._pendingResponder){this._pendingResponder=null;this.makeFirstResponder(e)
}return d}};SC.SelectionSupport={hasSelectionSupport:YES,allowsSelection:YES,allowsMultipleSelection:YES,allowsEmptySelection:YES,firstSelectableObject:function(){return this.get("firstObject")
}.property(),selection:function(g,k){var e=this._scsel_selection,l=e?e.get("length"):0,h,j,d;
if((k===undefined)||!this.get("allowsSelection")){k=e}d=(k&&k.isEnumerable)?k.get("length"):0;
if((d>1)&&!this.get("allowsMultipleSelection")){if(l>1){k=SC.SelectionSet.create().addObject(e.get("firstObject")).freeze();
d=1}else{k=e;d=l}}if((d===0)&&!this.get("allowsEmptySelection")){if(l===0){k=this.get("firstSelectableObject");
if(k){k=SC.SelectionSet.create().addObject(k).freeze()}else{k=SC.SelectionSet.EMPTY
}d=k.get("length")}else{k=e;d=l}}if(d===0){k=SC.SelectionSet.EMPTY}k=k.frozenCopy();
this._scsel_selection=k;return k}.property("arrangedObjects","allowsEmptySelection","allowsMultipleSelection","allowsSelection").cacheable(),hasSelection:function(){var d=this.get("selection");
return !!d&&(d.get("length")>0)}.property("selection").cacheable(),selectObjects:function(e,g){if(!e||e.get("length")===0){if(!g){this.set("selection",SC.SelectionSet.EMPTY)
}return this}var d=this.get("selection");if(g&&d){d=d.copy()}else{d=SC.SelectionSet.create()
}d.addObjects(e).freeze();this.set("selection",d);return this},selectObject:function(d,e){if(d===null){if(!e){this.set("selection",null)
}return this}else{return this.selectObjects([d],e)}},deselectObjects:function(e){if(!e||e.get("length")===0){return this
}var d=this.get("selection");if(!d||d.get("length")===0){return this}d=d.copy().removeObjects(e).freeze();
this.set("selection",d.freeze());return this},deselectObject:function(d){if(!d){return this
}else{return this.deselectObjects([d])}},updateSelectionAfterContentChange:function(){var j=this.get("arrangedObjects"),k=this.get("selection"),h=k,g,e,d;
if(h&&j&&h.get("sources").indexOf(j)>=0){g=h.indexSetForSource(j);e=j.get("length");
d=g?g.get("max"):0;if(d>e){h=h.copy().remove(j,e,d-e).freeze();this.set("selection",h)
}}if(h===k){e=k?k.get("length"):0;d=j?j.get("length"):0;if((e===0)&&!this.get("allowsEmptySelection")&&d>0){this.notifyPropertyChange("selection")
}}return this}};SC.StaticLayout={hasStaticLayout:YES};sc_require("system/locale");
SC.STRING_TITLEIZE_REGEXP=(/([\s|\-|\_|\n])([^\s|\-|\_|\n]?)/g);SC.STRING_DECAMELIZE_REGEXP=(/([a-z])([A-Z])/g);
SC.STRING_DASHERIZE_REGEXP=(/[ _]/g);SC.STRING_HUMANIZE_REGEXP=(/[\-_]/g);SC.STRING_TRIM_REGEXP=(/^\s+|\s+$/g);
SC.STRING_TRIM_LEFT_REGEXP=(/^\s+/g);SC.STRING_TRIM_RIGHT_REGEXP=(/\s+$/g);SC.STRING_REGEXP_ESCAPED_REGEXP=(/([\\\.\+\*\?\[\^\]\$\(\)\{\}\=\!\<\>\|\:])/g);
SC.String={loc:function(){if(!SC.Locale.currentLocale){SC.Locale.createCurrentLocale()
}var d=SC.Locale.currentLocale.locWithDefault(this)||this;return d.fmt.apply(d,arguments)
},locWithDefault:function(e){if(!SC.Locale.currentLocale){SC.Locale.createCurrentLocale()
}var g=SC.Locale.currentLocale.locWithDefault(e)||this;var d=SC.$A(arguments);d.shift();
return g.fmt.apply(g,d)},capitalize:function(){return this.charAt(0).toUpperCase()+this.slice(1)
},capitalizeEach:function(){return this.replace(SC.STRING_TITLEIZE_REGEXP,function(g,d,e){return(e)?(d+e.toUpperCase()):d
}).capitalize()},titleize:function(){var d=this.replace(SC.STRING_DECAMELIZE_REGEXP,"$1_$2");
return d.replace(SC.STRING_TITLEIZE_REGEXP,function(g,h,e){return(e)?(" "+e.toUpperCase()):" "
}).capitalize()},camelize:function(){var e=this.replace(SC.STRING_TITLEIZE_REGEXP,function(j,k,h){return(h)?h.toUpperCase():""
});var g=e.charAt(0),d=g.toLowerCase();return(g!==d)?(d+e.slice(1)):e},classify:function(){var d=this.replace(SC.STRING_TITLEIZE_REGEXP,function(j,k,h){return(h)?h.toUpperCase():""
});var g=d.charAt(0),e=g.toUpperCase();return(g!==e)?(e+d.slice(1)):d},decamelize:function(){return this.replace(SC.STRING_DECAMELIZE_REGEXP,"$1_$2").toLowerCase()
},dasherize:function(){return this.decamelize().replace(SC.STRING_DASHERIZE_REGEXP,"-")
},humanize:function(){return this.decamelize().replace(SC.STRING_HUMANIZE_REGEXP," ")
},escapeForRegExp:function(){return this.replace(SC.STRING_REGEXP_ESCAPED_REGEXP,"\\$1")
},removeDiacritics:function(){var d=SC.diacriticMappingTable;if(!d){SC.diacriticMappingTable={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","Ā":"A","Ă":"A","Ą":"A","Ǎ":"A","Ǟ":"A","Ǡ":"A","Ǻ":"A","Ȁ":"A","Ȃ":"A","Ȧ":"A","Ḁ":"A","Ạ":"A","Ả":"A","Ấ":"A","Ầ":"A","Ẩ":"A","Ẫ":"A","Ậ":"A","Ắ":"A","Ằ":"A","Ẳ":"A","Ẵ":"A","Ặ":"A","Å":"A","Ḃ":"B","Ḅ":"B","Ḇ":"B","Ç":"C","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","Ḉ":"C","Ď":"D","Ḋ":"D","Ḍ":"D","Ḏ":"D","Ḑ":"D","Ḓ":"D","È":"E","É":"E","Ê":"E","Ë":"E","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","Ȅ":"E","Ȇ":"E","Ȩ":"E","Ḕ":"E","Ḗ":"E","Ḙ":"E","Ḛ":"E","Ḝ":"E","Ẹ":"E","Ẻ":"E","Ẽ":"E","Ế":"E","Ề":"E","Ể":"E","Ễ":"E","Ệ":"E","Ḟ":"F","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","Ǧ":"G","Ǵ":"G","Ḡ":"G","Ĥ":"H","Ȟ":"H","Ḣ":"H","Ḥ":"H","Ḧ":"H","Ḩ":"H","Ḫ":"H","Ì":"I","Í":"I","Î":"I","Ï":"I","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","Ǐ":"I","Ȉ":"I","Ȋ":"I","Ḭ":"I","Ḯ":"I","Ỉ":"I","Ị":"I","Ĵ":"J","Ķ":"K","Ǩ":"K","Ḱ":"K","Ḳ":"K","Ḵ":"K","Ĺ":"L","Ļ":"L","Ľ":"L","Ḷ":"L","Ḹ":"L","Ḻ":"L","Ḽ":"L","Ḿ":"M","Ṁ":"M","Ṃ":"M","Ñ":"N","Ń":"N","Ņ":"N","Ň":"N","Ǹ":"N","Ṅ":"N","Ṇ":"N","Ṉ":"N","Ṋ":"N","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ō":"O","Ŏ":"O","Ő":"O","Ơ":"O","Ǒ":"O","Ǫ":"O","Ǭ":"O","Ȍ":"O","Ȏ":"O","Ȫ":"O","Ȭ":"O","Ȯ":"O","Ȱ":"O","Ṍ":"O","Ṏ":"O","Ṑ":"O","Ṓ":"O","Ọ":"O","Ỏ":"O","Ố":"O","Ồ":"O","Ổ":"O","Ỗ":"O","Ộ":"O","Ớ":"O","Ờ":"O","Ở":"O","Ỡ":"O","Ợ":"O","Ṕ":"P","Ṗ":"P","Ŕ":"R","Ŗ":"R","Ř":"R","Ȑ":"R","Ȓ":"R","Ṙ":"R","Ṛ":"R","Ṝ":"R","Ṟ":"R","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","Ș":"S","Ṡ":"S","Ṣ":"S","Ṥ":"S","Ṧ":"S","Ṩ":"S","Ţ":"T","Ť":"T","Ț":"T","Ṫ":"T","Ṭ":"T","Ṯ":"T","Ṱ":"T","Ù":"U","Ú":"U","Û":"U","Ü":"U","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","Ư":"U","Ǔ":"U","Ǖ":"U","Ǘ":"U","Ǚ":"U","Ǜ":"U","Ȕ":"U","Ȗ":"U","Ṳ":"U","Ṵ":"U","Ṷ":"U","Ṹ":"U","Ṻ":"U","Ụ":"U","Ủ":"U","Ứ":"U","Ừ":"U","Ử":"U","Ữ":"U","Ự":"U","Ṽ":"V","Ṿ":"V","Ŵ":"W","Ẁ":"W","Ẃ":"W","Ẅ":"W","Ẇ":"W","Ẉ":"W","Ẋ":"X","Ẍ":"X","Ý":"Y","Ŷ":"Y","Ÿ":"Y","Ȳ":"Y","Ẏ":"Y","Ỳ":"Y","Ỵ":"Y","Ỷ":"Y","Ỹ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","Ẑ":"Z","Ẓ":"Z","Ẕ":"Z","`":"`","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","ā":"a","ă":"a","ą":"a","ǎ":"a","ǟ":"a","ǡ":"a","ǻ":"a","ȁ":"a","ȃ":"a","ȧ":"a","ḁ":"a","ạ":"a","ả":"a","ấ":"a","ầ":"a","ẩ":"a","ẫ":"a","ậ":"a","ắ":"a","ằ":"a","ẳ":"a","ẵ":"a","ặ":"a","ḃ":"b","ḅ":"b","ḇ":"b","ç":"c","ć":"c","ĉ":"c","ċ":"c","č":"c","ḉ":"c","ď":"d","ḋ":"d","ḍ":"d","ḏ":"d","ḑ":"d","ḓ":"d","è":"e","é":"e","ê":"e","ë":"e","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","ȅ":"e","ȇ":"e","ȩ":"e","ḕ":"e","ḗ":"e","ḙ":"e","ḛ":"e","ḝ":"e","ẹ":"e","ẻ":"e","ẽ":"e","ế":"e","ề":"e","ể":"e","ễ":"e","ệ":"e","ḟ":"f","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","ǧ":"g","ǵ":"g","ḡ":"g","ĥ":"h","ȟ":"h","ḣ":"h","ḥ":"h","ḧ":"h","ḩ":"h","ḫ":"h","ẖ":"h","ì":"i","í":"i","î":"i","ï":"i","ĩ":"i","ī":"i","ĭ":"i","į":"i","ǐ":"i","ȉ":"i","ȋ":"i","ḭ":"i","ḯ":"i","ỉ":"i","ị":"i","ĵ":"j","ǰ":"j","ķ":"k","ǩ":"k","ḱ":"k","ḳ":"k","ḵ":"k","ĺ":"l","ļ":"l","ľ":"l","ḷ":"l","ḹ":"l","ḻ":"l","ḽ":"l","ḿ":"m","ṁ":"m","ṃ":"m","ñ":"n","ń":"n","ņ":"n","ň":"n","ǹ":"n","ṅ":"n","ṇ":"n","ṉ":"n","ṋ":"n","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ō":"o","ŏ":"o","ő":"o","ơ":"o","ǒ":"o","ǫ":"o","ǭ":"o","ȍ":"o","ȏ":"o","ȫ":"o","ȭ":"o","ȯ":"o","ȱ":"o","ṍ":"o","ṏ":"o","ṑ":"o","ṓ":"o","ọ":"o","ỏ":"o","ố":"o","ồ":"o","ổ":"o","ỗ":"o","ộ":"o","ớ":"o","ờ":"o","ở":"o","ỡ":"o","ợ":"o","ṕ":"p","ṗ":"p","ŕ":"r","ŗ":"r","ř":"r","ȑ":"r","ȓ":"r","ṙ":"r","ṛ":"r","ṝ":"r","ṟ":"r","ś":"s","ŝ":"s","ş":"s","š":"s","ș":"s","ṡ":"s","ṣ":"s","ṥ":"s","ṧ":"s","ṩ":"s","ţ":"t","ť":"t","ț":"t","ṫ":"t","ṭ":"t","ṯ":"t","ṱ":"t","ẗ":"t","ù":"u","ú":"u","û":"u","ü":"u","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","ư":"u","ǔ":"u","ǖ":"u","ǘ":"u","ǚ":"u","ǜ":"u","ȕ":"u","ȗ":"u","ṳ":"u","ṵ":"u","ṷ":"u","ṹ":"u","ṻ":"u","ụ":"u","ủ":"u","ứ":"u","ừ":"u","ử":"u","ữ":"u","ự":"u","ṽ":"v","ṿ":"v","ŵ":"w","ẁ":"w","ẃ":"w","ẅ":"w","ẇ":"w","ẉ":"w","ẘ":"w","ẋ":"x","ẍ":"x","ý":"y","ÿ":"y","ŷ":"y","ȳ":"y","ẏ":"y","ẙ":"y","ỳ":"y","ỵ":"y","ỷ":"y","ỹ":"y","ź":"z","ż":"z","ž":"z","ẑ":"z","ẓ":"z","ẕ":"z"};
d=SC.diacriticMappingTable}var h,j,e="",k=this.length;for(var g=0;g<=k;++g){h=this.charAt(g);
j=d[h];if(j){e+=j}else{e+=h}}return e},trim:function(){return this.replace(SC.STRING_TRIM_REGEXP,"")
},trimLeft:function(){return this.replace(SC.STRING_TRIM_LEFT_REGEXP,"")},trimRight:function(){return this.replace(SC.STRING_TRIM_RIGHT_REGEXP,"")
}};SC.String.strip=SC.String.trim;SC.supplement(String.prototype,SC.String);String.prototype.loc=SC.String.loc;
SC.String.fmt=String.prototype.fmt;SC.TreeItemContent={isTreeItemContent:YES,treeItemChildren:null,treeItemIsExpanded:YES,treeItemIsGrouped:NO,treeItemDisclosureState:function(e,d){return this.get("treeItemIsExpanded")?SC.BRANCH_OPEN:SC.BRANCH_CLOSED
},treeItemCollapse:function(e,d){this.setIfChanged("treeItemIsExpanded",NO)},treeItemExpand:function(e,d){this.setIfChanged("treeItemIsExpanded",YES)
},treeItemBranchIndexes:function(j,g){var h=this.get("treeItemChildren"),e,l,d,k;
if(!h){return null}e=SC.IndexSet.create();l=h.get("length");for(d=0;d<l;d++){if(!(k=h.objectAt(d))){continue
}if(!k.get("treeItemChildren")){continue}if(k.treeItemDisclosureState(this,d)!==SC.LEAF_NODE){e.add(d)
}}return e.get("length")>0?e:null}};SC.Validatable={initMixin:function(){this._validatable_validatorDidChange()
},validator:null,errorLabel:null,isValid:function(){return SC.typeOf(this.get("value"))!==SC.T_ERROR
}.property("value"),ownerForm:null,performValidate:function(g){var d=SC.VALIDATE_OK;
if(this._validator){var e=this.get("ownerForm");if(g){d=this._validator.validatePartial(e,this);
if((d==SC.VALIDATE_NO_CHANGE)&&(this._validator.validateChange(e,this)==SC.VALIDATE_OK)){d=SC.VALIDATE_OK
}}else{d=this._validator.validateChange(e,this)}}return d},performValidateSubmit:function(){return this._validator?this._validator.validateSubmit(this.get("ownerForm"),this):SC.VALIDATE_OK
},performValidateKeyDown:function(d){var e=d.getCharString();if(!e){return YES}return this._validator?this._validator.validateKeyDown(this.get("ownerForm"),this,e):YES
},validatorObject:function(){return this._validator}.property(),validateSubmit:function(){return this.performValidateSubmit()
},objectForFieldValue:function(e,d){return this._validator?this._validator.objectForFieldValue(e,this.get("ownerForm"),this):e
},fieldValueForObject:function(d){return this._validator?this._validator.fieldValueForObject(d,this.get("ownerForm"),this):d
},_validatable_displayObserver:function(){this.displayDidChange()}.observes("isValid"),renderMixin:function(d){d.setClass("invalid",!this.get("isValid"))
},_validatable_validatorDidChange:function(){var d=this.get("ownerForm");var e=SC.Validator.findFor(d,this,this.get("validator"));
if(e!=this._validator){this.propertyWillChange("validatorObject");if(this._validator){this._validator.detachFrom(d,this)
}this._validator=e;if(this._validator){this._validator.attachTo(d,this)}this.propertyDidChange("validatorObject")
}}.observes("validator","ownerForm")};sc_require("views/view");sc_require("mixins/responder_context");
SC.Pane=SC.View.extend(SC.ResponderContext,{isPane:YES,page:null,rootResponder:null,currentWindowSize:null,computeParentDimensions:function(g){if(this.get("designer")&&SC.suppressMain){return arguments.callee.base.apply(this,arguments)
}var e=this.get("currentWindowSize");var h={x:0,y:0,width:1000,height:1000};if(e){h.width=e.width;
h.height=e.height}else{if(SC.RootResponder.responder){var d=SC.RootResponder.responder.get("currentWindowSize");
if(d){h.width=d.width;h.height=d.height}}else{if(window.innerHeight){h.width=window.innerWidth;
h.height=window.innerHeight}else{if(document.documentElement&&document.documentElement.clientHeight){h.width=document.documentElement.clientWidth;
h.height=document.documentElement.clientHeight}else{if(document.body){h.width=document.body.clientWidth;
h.height=document.body.clientHeight}}}this.windowSizeDidChange(null,h)}}return h},frame:function(){if(this.get("designer")&&SC.suppressMain){return arguments.callee.base.apply(this,arguments)
}return this.computeFrameWithParentFrame(null)}.property(),windowSizeDidChange:function(e,d){this.set("currentWindowSize",d);
this.parentViewDidResize();return this},paneLayoutDidChange:function(){this.invokeOnce(this.updateLayout)
}.observes("layout"),sendEvent:function(g,d,h){var e;if(!h){h=this.get("firstResponder")
}while(h&&!h.tryToPerform(g,d)){h=(h===this)?null:h.get("nextResponder")}if(!h&&(h=this.get("defaultResponder"))){if(typeof h===SC.T_STRING){h=SC.objectForPropertyPath(h)
}if(!h){h=null}else{if(h.isResponderContext){h=h.sendAction(g,this,d)}else{h=h.tryToPerform(g,d)?h:null
}}}return d.mouseHandler||h},performKeyEquivalent:function(g,d){var e=arguments.callee.base.apply(this,arguments);
if(!e){var h=this.get("defaultResponder");if(h){if(h.performKeyEquivalent){e=h.performKeyEquivalent(g,d)
}if(!e&&h.tryToPerform){e=h.tryToPerform(g,d)}}}return e},nextResponder:function(){return null
}.property().cacheable(),firstResponder:null,acceptsKeyPane:YES,isKeyPane:NO,becomeKeyPane:function(){if(this.get("isKeyPane")){return this
}if(this.rootResponder){this.rootResponder.makeKeyPane(this)}return this},resignKeyPane:function(){if(!this.get("isKeyPane")){return this
}if(this.rootResponder){this.rootResponder.makeKeyPane(null)}return this},makeFirstResponder:function(e,d){var h=this.get("firstResponder"),g=this.get("isKeyPane");
if(h===e){return this}if(h){h.willLoseFirstResponder(h,d)}if(g){if(h){h.willLoseKeyResponderTo(e)
}if(e){e.willBecomeKeyResponderFrom(h)}}if(h){h.beginPropertyChanges().set("isFirstResponder",NO).set("isKeyResponder",NO).endPropertyChanges()
}this.set("firstResponder",e);if(e){e.beginPropertyChanges().set("isFirstResponder",YES).set("isKeyResponder",g).endPropertyChanges()
}if(g){if(e){e.didBecomeKeyResponderFrom(h)}if(h){h.didLoseKeyResponderTo(e)}}if(e){e.didBecomeFirstResponder(e)
}return this},_forwardKeyChange:function(h,e,l,k){var g,d,j;if(h&&(d=this.get("firstResponder"))){j=(l)?l.get("firstResponder"):null;
g=this.get("firstResponder");if(g){g[e](j)}if((k!==undefined)&&d){d.set("isKeyResponder",k)
}}},willLoseKeyPaneTo:function(d){this._forwardKeyChange(this.get("isKeyPane"),"willLoseKeyResponderTo",d,NO);
return this},willBecomeKeyPaneFrom:function(d){this._forwardKeyChange(!this.get("isKeyPane"),"willBecomeKeyResponderFrom",d,YES);
return this},didLoseKeyPaneTo:function(e){var d=this.get("isKeyPane");this.set("isKeyPane",NO);
this._forwardKeyChange(d,"didLoseKeyResponderTo",e);return this},didBecomeKeyPaneFrom:function(e){var d=this.get("isKeyPane");
this.set("isKeyPane",YES);this._forwardKeyChange(!d,"didBecomeKeyResponderFrom",e,YES);
return this},isMainPane:NO,focusFrom:function(d){},blurTo:function(d){},blurMainTo:function(d){this.set("isMainPane",NO)
},focusMainFrom:function(d){this.set("isMainPane",YES)},append:function(){return this.appendTo(document.body)
},remove:function(){if(!this.get("isVisibleInWindow")){return this}if(!this.get("isPaneAttached")){return this
}this.set("isVisibleInWindow",NO);var e=this.get("layer");if(e.parentNode){e.parentNode.removeChild(e)
}e=null;this.resignKeyPane();var d=this.rootResponder;if(this.get("isMainPane")){d.makeMainPane(null)
}d.panes.remove(this);this.rootResponder=null;this.set("isPaneAttached",NO);return this
},appendTo:function(e){var d=this.get("layer");if(!d){d=this.createLayer().get("layer")
}if(this.get("isPaneAttached")&&(d.parentNode===e)){return this}e.insertBefore(d,null);
e=d=null;return this.paneDidAttach()},prependTo:function(e){if(this.get("isPaneAttached")){return this
}var d=this.get("layer");if(!d){d=this.createLayer().get("layer")}if(this.get("isPaneAttached")&&(d.parentNode===e)){return this
}e.insertBefore(d,e.firstChild);e=d=null;return this.paneDidAttach()},before:function(g){if(this.get("isPaneAttached")){return this
}var d=this.get("layer");if(!d){d=this.createLayer().get("layer")}var e=g.parentNode;
if(this.get("isPaneAttached")&&(d.parentNode===e)){return this}e.insertBefore(d,g);
e=g=d=null;return this.paneDidAttach()},after:function(g){var d=this.get("layer");
if(!d){d=this.createLayer().get("layer")}var e=g.parentNode;if(this.get("isPaneAttached")&&(d.parentNode===e)){return this
}e.insertBefore(d,g.nextSibling);e=g=d=null;return this.paneDidAttach()},removeFromParent:function(){},paneDidAttach:function(){var d=(this.rootResponder=SC.RootResponder.responder);
d.panes.add(this);this.set("currentWindowSize",d.computeWindowSize());this.set("isPaneAttached",YES);
this.parentViewDidChange();this._notifyDidAppendToDocument();return this},isPaneAttached:NO,recomputeIsVisibleInWindow:function(g){if(this.get("designer")&&SC.suppressMain){return arguments.callee.base.apply(this,arguments)
}var h=this.get("isVisibleInWindow"),k=this.get("isVisible");this.set("isVisibleInWindow",k);
this._needsVisibiltyChange=YES;if(k&&this.get("layerNeedsUpdate")){this.updateLayerIfNeeded()
}if(k&&this.get("childViewsNeedLayout")){this.layoutChildViewsIfNeeded()}var j=this.get("childViews"),e=j.length,d;
for(d=0;d<e;d++){j[d].recomputeIsVisibleInWindow(k)}if(!k&&this.get("isFirstResponder")){this.resignFirstResponder()
}if(k){if(this.parentViewDidResize){this.parentViewDidResize()}if(this.get("childViewsNeedLayout")){this.invokeOnce(this.layoutChildViewsIfNeeded)
}}return this},updateLayerLocation:function(){if(this.get("designer")&&SC.suppressMain){return arguments.callee.base.apply(this,arguments)
}return this},init:function(){var d=!!this.get("layer");arguments.callee.base.apply(this,arguments);
if(d){this.paneDidAttach()}},classNames:"sc-pane".w()});sc_require("mixins/tree_item_content");
sc_require("mixins/collection_content");SC.TreeItemObserver=SC.Object.extend(SC.Array,SC.CollectionContent,{item:null,delegate:null,parentObserver:null,parentItem:function(){var d=this.get("parentObserver");
return d?d.get("item"):null}.property("parentObserver").cacheable(),index:null,outlineLevel:0,children:null,disclosureState:SC.BRANCH_OPEN,branchIndexes:function(){var j=this.get("item"),e,k,d,h,g;
if(!j){return SC.IndexSet.EMPTY}else{if(j.isTreeItemContent){k=this.get("parentItem");
d=this.get("index");return j.treeItemBranchIndexes(k,d)}else{h=this.get("children");
if(!h){return null}g=SC.IndexSet.create();e=h.get("length");k=j;for(d=0;d<e;d++){if(!(j=h.objectAt(d))){continue
}if(!this._computeChildren(j,k,d)){continue}if(this._computeDisclosureState(j,k,d)!==SC.LEAF_NODE){g.add(d)
}}return g.get("length")>0?g:null}}}.property("children").cacheable(),isHeaderVisible:function(){return !!this.get("parentObserver")
}.property("parentObserver").cacheable(),length:0,objectAt:function(h){var d=this.get("length"),k=this.get("item"),e=this._objectAtCache,m=h,l=0,g,j;
if(h>=d){return undefined}if(this.get("isHeaderVisible")){if(h===0){return k}else{m--
}}k=null;if(!e){e=this._objectAtCache=[]}if((k=e[h])!==undefined){return k}j=this.get("children");
if(!j){return undefined}if(g=this.get("branchIndexes")){g.forEach(function(p){if(k||(p>m)){return
}var o=this.branchObserverAt(p),n;if(!o){return}n=o.get("length");if(p+n>m){k=o.objectAt(m-p);
m=-1}else{m-=n-1}},this)}if(m>=0){k=j.objectAt(m)}e[h]=k;return k},replace:function(d,e,o,h){var n=d,l=null,j,k,m;
if(h===undefined){h=SC.DROP_BEFORE}if(this.get("isHeaderVisible")){n--}if(n<0){throw"Tree Item cannot replace itself"
}if(j=this.get("branchIndexes")){j.forEach(function(p){if(l||(p>=n)){return}if(!(l=this.branchObserverAt(p))){return
}k=l.get("length");if((p+k===n)&&h===SC.DROP_AFTER){n-=p}else{if(p+k>n){n-=p}else{n-=k-1;
l=null}}},this)}if(l){l.replace(n,e,o,h);return this}m=n+e;if(e>1&&j){j.forEachIn(n,j.get("max")-n,function(p){if(p>m){return
}if(!(l=this.branchObserverAt(p))){return}k=l.get("length");m-=k-1},this)}e=m-n;var g=this.get("children");
if(!g){throw"cannot replace() tree item with no children"}if((e<0)||(m>g.get("length"))){throw"replace() range must lie within a single tree item"
}g.replace(n,e,o,h);return this},observerContentDidChange:function(l,k,j){this.invalidateBranchObserversAt(l);
this._objectAtCache=this._outlineLevelCache=null;this._disclosureStateCache=null;
this._contentGroupIndexes=NO;this.notifyPropertyChange("branchIndexes");var e=this.get("length"),g=this._computeLength(),d=this.get("parentObserver"),h;
if(e!==g){this.set("length",g)}if(!this._notifyParent){return this}if(d){h=SC.IndexSet.create(this.get("index"));
d._childrenRangeDidChange(d.get("children"),null,"[]",h)}else{if(e===g){k=this.expandChildIndex(l+k);
l=this.expandChildIndex(l);k=k-l;j=0}else{l=this.expandChildIndex(l);k=g-l;j=g-e}this.enumerableContentDidChange(l,k,j)
}},expandChildIndex:function(g){var e=g;if(this.get("isHeaderVisible")){g++}var d=this.get("branchIndexes");
if(!d||d.get("length")===0){return e}d.forEachIn(0,g,function(h){e+=this.branchObserverAt(h).get("length")-1
},this);return e},_contentGroupIndexes:NO,contentGroupIndexes:function(l,j){if(j!==this){return null
}var k=this._contentGroupIndexes;if(k!==NO){return k}if(this.get("parentObserver")){return null
}var o=this.get("item"),n,e,h,m,g,d;if(o&&o.isTreeItemContent){n=o.get("treeItemIsGrouped")
}else{n=!!this.delegate.get("treeItemIsGrouped")}if(n){k=SC.IndexSet.create();e=this.get("branchIndexes");
d=this.get("children");h=d?d.get("length"):0;m=g=0;if(e){e.forEach(function(s){k.add(m,(s+1)-g);
m+=(s+1)-g;g=s+1;var p=this.branchObserverAt(s);if(p){m+=p.get("length")-1}},this)
}if(g<h){k.add(m,h-g)}}else{k=null}this._contentGroupIndexes=k;return k},contentIndexIsGroup:function(e,h,d){var g=this.contentGroupIndexes(e,h);
return g?g.contains(d):NO},contentIndexOutlineLevel:function(o,l,j){if(l!==this){return -1
}var d=this._outlineLevelCache;if(d&&(d[j]!==undefined)){return d[j]}if(!d){d=this._outlineLevelCache=[]
}var k=this.get("length"),p=j,h=0,m=null,g,e,n;if(j>=k){return -1}if(this.get("isHeaderVisible")){if(j===0){return d[0]=this.get("outlineLevel")-1
}else{p--}}if(g=this.get("branchIndexes")){g.forEach(function(x){if((m!==null)||(x>p)){return
}var u=this.branchObserverAt(x),s;if(!u){return}s=u.get("length");if(x+s>p){m=u.contentIndexOutlineLevel(o,u,p-x);
p=-1}else{p-=s-1}},this)}if(p>=0){m=this.get("outlineLevel")}d[j]=m;return m},contentIndexDisclosureState:function(o,l,j){if(l!==this){return -1
}var d=this._disclosureStateCache;if(d&&(d[j]!==undefined)){return d[j]}if(!d){d=this._disclosureStateCache=[]
}var k=this.get("length"),p=j,h=0,m=null,g,e,n;if(j>=k){return SC.LEAF_NODE}if(this.get("isHeaderVisible")){if(j===0){return d[0]=this.get("disclosureState")
}else{p--}}if(g=this.get("branchIndexes")){g.forEach(function(x){if((m!==null)||(x>p)){return
}var u=this.branchObserverAt(x),s;if(!u){return}s=u.get("length");if(x+s>p){m=u.contentIndexDisclosureState(o,u,p-x);
p=-1}else{p-=s-1}},this)}if(p>=0){m=SC.LEAF_NODE}d[j]=m;return m},contentIndexExpand:function(e,k,d){var g,l=d,h,j;
if(k!==this){return}if(this.get("isHeaderVisible")){if(d===0){this._expand(this.get("item"));
return}else{l--}}if(g=this.get("branchIndexes")){g.forEach(function(o){if(o>=l){return
}var n=this.branchObserverAt(o),m;if(!n){return}m=n.get("length");if(o+m>l){n.contentIndexExpand(e,n,l-o);
l=-1}else{l-=m-1}},this)}if(l>=0){h=this.get("children");j=h?h.objectAt(l):null;if(j){this._expand(j,this.get("item"),l)
}}},contentIndexCollapse:function(e,k,d){var g,h,j,l=d;if(k!==this){return}if(this.get("isHeaderVisible")){if(d===0){this._collapse(this.get("item"));
return}else{l--}}if(g=this.get("branchIndexes")){g.forEach(function(o){if(o>=l){return
}var n=this.branchObserverAt(o),m;if(!n){return}m=n.get("length");if(o+m>l){n.contentIndexCollapse(e,n,l-o);
l=-1}else{l-=m-1}},this)}if(l>=0){h=this.get("children");j=h?h.objectAt(l):null;if(j){this._collapse(j,this.get("item"),l)
}}},branchObserverAt:function(h){var l=this._branchObserversByIndex,g=this._branchObserverIndexes,j,m,e,o,d,k,n;
if(!l){l=this._branchObserversByIndex=[]}if(!g){g=this._branchObserverIndexes=SC.IndexSet.create()
}if(j=l[h]){return j}d=this.get("children");o=d?d.objectAt(h):null;if(!o){return null
}l[h]=j=SC.TreeItemObserver.create({item:o,delegate:this.get("delegate"),parentObserver:this,index:h,outlineLevel:this.get("outlineLevel")+1});
g.add(h);return j},invalidateBranchObserversAt:function(g){var e=this._branchObserversByIndex,d=this._branchObserverIndexes;
if(!e||e.length<=g){return this}if(g<0){g=0}d.forEachIn(g,d.get("max")-g,function(j){var h=e[j];
if(h){h.destroy()}},this);e.length=g;return this},init:function(){arguments.callee.base.apply(this,arguments);
var d=this.get("item");if(!d){throw"SC.TreeItemObserver.item cannot be null"}d.addObserver("*",this,this._itemPropertyDidChange);
this._itemPropertyDidChange(d,"*");this._notifyParent=YES},destroy:function(){this.invalidateBranchObserversAt(0);
this._objectAtCache=null;var g=this.get("item");if(g){g.removeObserver("*",this,this._itemPropertyDidChange)
}var d=this._children,e=this._childrenRangeObserver;if(d&&e){d.removeRangeObserver(e)
}arguments.callee.base.apply(this,arguments)},_itemPropertyDidChange:function(k,e){var d=this.get("children"),j=this.get("disclosureState"),h=this.get("item"),g;
this.beginPropertyChanges();g=this._computeDisclosureState(h);if(j!==g){this.set("disclosureState",g)
}g=this._computeChildren(h);if(d!==g){this.set("children",g)}this.endPropertyChanges()
},_childrenDidChange:function(){var g=this.get("disclosureState"),h=g===SC.BRANCH_OPEN?this.get("children"):null,e=this._children,d=this._childrenRangeObserver;
if(e===h){return this}if(d){e.removeRangeObserver(d)}if(h){this._childrenRangeObserver=h.addRangeObserver(null,this,this._childrenRangeDidChange)
}else{this._childrenRangeObserver=null}this._children=h;this._childrenRangeDidChange(h,null,"[]",null)
}.observes("children","disclosureState"),_childrenRangeDidChange:function(k,n,m,h){var d=this.get("children"),j=d?d.get("length"):0,g=h?h.get("min"):0,l=h?h.get("max"):j,e=this._childrenLen||0;
this._childrenLen=j;this.observerContentDidChange(g,l-g,j-e)},_computeDisclosureState:function(h,j,e){var g,d;
if(!h||!this._computeChildren(h)){return SC.LEAF_NODE}else{if(h.isTreeItemContent){if(j===undefined){j=this.get("parentItem")
}if(e===undefined){e=this.get("index")}return h.treeItemDisclosureState(j,e)}else{g=this._treeItemIsExpandedKey;
if(!g){d=this.get("delegate");g=d?d.get("treeItemIsExpandedKey"):"treeItemIsExpanded";
this._treeItemIsExpandedKey=g}return h.get(g)?SC.BRANCH_OPEN:SC.BRANCH_CLOSED}}},_collapse:function(h,j,e){var g,d;
if(!h||!this._computeChildren(h)){return this}else{if(h.isTreeItemContent){if(j===undefined){j=this.get("parentItem")
}if(e===undefined){e=this.get("index")}h.treeItemCollapse(j,e)}else{g=this._treeItemIsExpandedKey;
if(!g){d=this.get("delegate");g=d?d.get("treeItemIsExpandedKey"):"treeItemIsExpanded";
this._treeItemIsExpandedKey=g}h.setIfChanged(g,NO)}}return this},_expand:function(h,j,e){var g,d;
if(!h||!this._computeChildren(h)){return this}else{if(h.isTreeItemContent){if(j===undefined){j=this.get("parentItem")
}if(e===undefined){e=this.get("index")}h.treeItemExpand(j,e)}else{g=this._treeItemIsExpandedKey;
if(!g){d=this.get("delegate");g=d?d.get("treeItemIsExpandedKey"):"treeItemIsExpanded";
this._treeItemIsExpandedKey=g}h.setIfChanged(g,YES)}}return this},_computeChildren:function(g){var d,e;
if(!g){return null}else{if(g.isTreeItemContent){return g.get("treeItemChildren")}else{e=this._treeItemChildrenKey;
if(!e){d=this.get("delegate");e=d?d.get("treeItemChildrenKey"):"treeItemChildren";
this._treeItemChildrenKey=e}return g.get(e)}}},_computeLength:function(){var e=this.get("isHeaderVisible")?1:0,h=this.get("disclosureState"),g=this.get("children"),d;
if((h===SC.BRANCH_OPEN)&&g){e+=g.get("length");if(d=this.get("branchIndexes")){d.forEach(function(j){var k=this.branchObserverAt(j);
e+=k.get("length")-1},this)}}return e}});SC.InlineEditorDelegate={inlineEditorClassName:"",inlineEditorWillBeginEditing:function(d){},inlineEditorDidBeginEditing:function(d){},inlineEditorShouldEndEditing:function(d,e){return YES
},inlineEditorDidEndEditing:function(d,e){}};sc_require("mixins/responder_context");
SC.Application=SC.Responder.extend(SC.ResponderContext,{});sc_require("core");SC.Benchmark={verbose:NO,enabled:YES,stats:{},globalStartTime:null,start:function(e,d,j,h){if(!this.enabled){return
}var k=(j||Date.now()),g;if(d){g=this._subStatFor(e,d)}else{g=this._statFor(e)}if(h&&g._starts.length>0){g._starts.push("ignore")
}else{g._starts.push(k)}g._times.push({start:k,_subStats:{}});return e},end:function(g,e,k){var j;
if(!this.enabled){return}if(e){j=this._subStatFor(g,e)}else{j=this._statFor(g)}var l=j._starts.pop();
if(!l){console.log('SC.Benchmark "%@" ended without a matching start.  No information was saved.'.fmt(g));
return}if(l=="ignore"){return}var d=(k||Date.now());var h=d-l;j._times[j._times.length-1].end=d;
j._times[j._times.length-1].dur=h;j.amt+=h;j.runs++;if(this.verbose){this.log(g)}},setGlobalStartTime:function(d){this.globalStartTime=d
},bench:function(j,h,d){if(!h){h="bench%@".fmt(this._benchCount++)}if(!d){d=1}var e;
while(--d>=0){var g=SC.Benchmark.start(h);e=j();SC.Benchmark.end(g)}return e},install:function(d,h,e){d["b__"+h]=d[h];
var g=d["b__"+h];d[h]=function(){var k="%@(%@)".fmt(h,$A(arguments).join(", "));SC.Benchmark.start(k,e);
var j=g.apply(this,arguments);SC.Benchmark.end(k);return j}},restore:function(d,e){d[e]=d["b__"+e]
},report:function(g){if(g){return this._genReport(g)}var e=[];for(var d in this.stats){if(!this.stats.hasOwnProperty(d)){continue
}e.push(this._genReport(d))}return e.join("\n")},timelineReport:function(d){d=(d)?"SproutCore Application":d;
var e=[d,"User-Agent: %@".fmt(navigator.userAgent),"Report Generated: %@ (%@)".fmt(new Date().toString(),Date.now()),""];
var h=this._compileChartData(true);for(var g=0;g<h.length;g++){if(h[g][4]){e.push(this._timelineGenSubReport(h[g]))
}else{e.push(this._timelineGenReport(h[g]))}}return e.join("\n")},timelineChart:function(B){var x=0;
this.hideChart();var s=this._compileChartData(false);var n=s.length;if(n===0){return
}var e=this.globalStartTime?this.globalStartTime:s[0][1];var h=s[n-1][2]-e;var u=50+n*30;
var y=Math.ceil(h/200)+1;var A=y*50;var g=document.createElement("div");g.className="sc-benchmark-graph";
document.body.appendChild(g);var C=document.createElement("div");C.innerHTML=((B)?B:"SproutCore Application")+(" - Total Captured Time: "+h+" ms - Points Captured: "+n)+' [<a href="javascript:SC.Benchmark.hideChart();">Hide Chart</a>]';
C.className="sc-benchmark-title";g.appendChild(C);var k=document.createElement("div");
k.className="sc-benchmark-top";k.style.width=A+"px";g.appendChild(k);for(x=0;x<y;
x++){var z=document.createElement("div");z.className="sc-benchmark-tick";z.style.left=(x*50)+"px";
z.style.height=u+"px";var j=document.createElement("div");j.className="sc-benchmark-tick-label";
j.style.left=(x*50)+"px";j.innerHTML=x*200+" ms";g.appendChild(z);g.appendChild(j)
}for(x=0;x<n;x++){var o=document.createElement("div");o.style.top=(75+(x*30))+"px";
o.style.width=A+"px";o.className=(x%2===0)?"sc-benchmark-row even":"sc-benchmark-row";
g.appendChild(o);var p=document.createElement("div");var m=s[x][1];var l=s[x][2];
var d=s[x][3];p.innerHTML="&nbsp;"+(s[x][0]+" <span class='sc-benchmark-emphasis'>"+d+"ms</span>");
p.className="sc-benchmark-bar";p.style.cssText="left:"+(((m-e)/4))+"px; width: "+((d/4))+"px; top: "+(53+(x*30))+"px;";
p.title="start: "+(m-e)+" ms, end: "+(l-e)+" ms, duration: "+d+" ms";g.appendChild(p)
}this._graph=g},hideChart:function(){if(this._graph){try{document.body.removeChild(this._graph)
}catch(d){}}},log:function(d){console.log(this.report(d))},startProfile:function(d){if(!this.enabled){return
}if(console&&console.profile){console.profile(d)}},endProfile:function(d){if(!this.enabled){return
}if(console&&console.profileEnd){console.profileEnd(d)}},_compileChartData:function(n){var p=[],d;
for(var u in this.stats){var l=this.stats[u];for(var m=0;m<l._times.length;m++){var x=l._times[m];
d=(l._times.length>1)?(m+1)+" - "+u:u;p.push([d,x.start,x.end,x.dur,false]);if(n){var e=x._subStats;
for(var g in e){var o=e[g];for(var h=0;h<o._times.length;h++){var y=o._times[h];d=(o._times.length>1)?(h+1)+" - "+g:g;
p.push([d,y.start,y.end,y.dur,true])}}}}}p.sort(function(k,j){if(k[1]<j[1]){return -1
}else{if(k[1]==j[1]){if(k[3]&&!j[3]){return -1}if(!k[3]&&j[3]){return 1}return 0}}return 1
});return p},_genReport:function(d){var e=this._statFor(d);var g=(e.runs>0)?(Math.floor(e.amt*1000/e.runs)/1000):0;
return"BENCH %@ msec: %@ (%@x)".fmt(g,(e.name||d),e.runs)},_timelineGenReport:function(d){if(this.globalStartTime){return"BENCH start: %@ msec, duration: %@ msec,  %@".fmt((d[1]-this.globalStartTime),d[3],d[0])
}else{return"BENCH duration: %@ msec, %@".fmt(d[3],d[0])}},_timelineGenSubReport:function(d){if(this.globalStartTime){return"   CHECKPOINT BENCH start: %@ msec, duration: %@ msec,  %@".fmt((d[1]-this.globalStartTime),d[3],d[0])
}else{return"   CHECKPOINT BENCH duration: %@ msec, %@".fmt(d[3],d[0])}},_subStatFor:function(h,g){var j=this.stats[g]._times.length;
if(j===0){return}var d=this.stats[g]._times[this.stats[g]._times.length-1]._subStats;
var e=d[h];if(!e){d[h]={runs:0,amt:0,name:h,_starts:[],_times:[]};e=d[h]}return e
},_statFor:function(e){var d=this.stats[e];if(!d){d=this.stats[e]={runs:0,amt:0,name:e,_starts:[],_times:[]};
d=this.stats[e]}return d},reset:function(){this.stats={}},_bench:function(e,d){SC.Benchmark.bench(e,d,1)
},_benchCount:1};SC.Benchmark=SC.Benchmark;SC.browser=(function(){var g=navigator.userAgent.toLowerCase();
var d=(g.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1];var e={version:d,safari:(/webkit/).test(g)?d:0,opera:(/opera/).test(g)?d:0,msie:(/msie/).test(g)&&!(/opera/).test(g)?d:0,mozilla:(/mozilla/).test(g)&&!(/(compatible|webkit)/).test(g)?d:0,mobileSafari:(/apple.*mobile.*safari/).test(g)?d:0,windows:!!(/(windows)/).test(g),mac:!!((/(macintosh)/).test(g)||(/(mac os x)/).test(g)),language:(navigator.language||navigator.browserLanguage).split("-",1)[0],touch:("createTouch" in document)};
SC.extend(e,{isOpera:!!e.opera,isIe:!!e.msie,isIE:!!e.msie,isSafari:!!e.safari,isMobileSafari:!!e.mobileSafari,isMozilla:!!e.mozilla,isWindows:!!e.windows,isMac:!!e.mac,current:e.msie?"msie":e.mozilla?"mozilla":e.safari?"safari":e.opera?"opera":"unknown",compareVersion:function(){if(this._versionSplit===undefined){function l(m){return Number(m.match(/^[0-9]+/))
}this._versionSplit=SC.A(this.version.split(".")).map(l)}var k=SC.A(arguments).map(Number);
for(var j=0;j<k.length;j++){var h=this._versionSplit[j]-k[j];if(isNaN(h)){return 0
}if(h!==0){return h}}return 0}});return e})();SC.Builder=function(d){return SC.Builder.create(d)
};SC.Builder.create=function create(g){var e=SC.mixin(SC.beget(this.fn),g||{});if(g.hasOwnProperty("toString")){e.toString=g.toString
}var d=function(){var h=SC.beget(e);h.defaultClass=this;h.constructor=d;return h.init.apply(h,arguments)
};d.fn=d.prototype=e;d.extend=SC.Builder.create;d.mixin=SC.Builder.mixin;return d
};SC.Builder.mixin=function(){var e=arguments.length,d;for(d=0;d<e;d++){SC.mixin(this,arguments[d])
}return this};SC.Builder.fn={init:function(d){if(d!==undefined){if(SC.typeOf(d)===SC.T_ARRAY){var e=d.length;
while(--e>=0){this[e]=d.objectAt?d.objectAt(e):d[e]}this.length=d.length}else{this[0]=d;
this.length=1}}return this},size:function(){return this.length},pushStack:function(){var d=this.constructor.apply(this,arguments);
d.prevObject=this;return d},end:function(){return this.prevObject||this.constructor()
},toString:function(){return"%@$(%@)".fmt(this.defaultClass.toString(),SC.A(this).invoke("toString").join(","))
},mixin:SC.Builder.mixin};(function(){var d=SC.Enumerable,g=SC.Builder.fn,e,h;for(e in d){if(!d.hasOwnProperty(e)){continue
}h=Array.prototype[e]||d[e];g[e]=h}})();SC.mixin({logBundleLoading:NO,bundleIsLoaded:function(d){var e=SC.BUNDLE_INFO[d];
return e?!!e.loaded:NO},_scb_bundleDidLoad:function(g,n,d,o){var j=d,u=n;if(SC.typeOf(n)===SC.T_STRING){u=SC.objectForPropertyPath(n)
}if(SC.typeOf(d)===SC.T_STRING){j=SC.objectForPropertyPath(d,u)}if(!j){if(SC.LAZY_INSTANTIATION[g]){var s=SC.LAZY_INSTANTIATION[g];
if(SC.logBundleLoading){console.log("SC.loadBundle(): Bundle '%@' is marked for lazy instantiation, instantiating it now…".fmt(g))
}for(var k=0,h=s.length;k<h;k++){try{s[k]()}catch(l){console.log("SC.loadBundle(): Failted to lazily instatiate entry for  '%@'".fmt(g))
}}delete SC.LAZY_INSTANTIATION[g];if(SC.typeOf(n)===SC.T_STRING){u=SC.objectForPropertyPath(n)
}if(SC.typeOf(d)===SC.T_STRING){j=SC.objectForPropertyPath(d,u)}if(!d){throw"SC.loadBundle(): could not find callback for lazily instantiated bundle '%@'".fmt(g)
}}else{throw"SC.loadBundle(): could not find callback for '%@'".fmt(g)}}if(!o){o=[]
}o.push(g);var p=!!SC.RunLoop.currentRunLoop;if(p){SC.RunLoop.begin()}j.apply(u,o);
if(p){SC.RunLoop.end()}},tryToLoadBundle:function(h,j,k,e){var d,g;if(SC.typeOf(j)===SC.T_STRING){g=SC.objectForPropertyPath(j)
}if(SC.typeOf(k)===SC.T_STRING){d=SC.objectForPropertyPath(k,g)}if(d||SC.LAZY_INSTANTIATION[h]){if(SC.logBundleLoading){console.log("SC.loadBundle(): Bundle '%@' found through other means, will attempt to load…".fmt(h))
}SC.BUNDLE_INFO[h]={loaded:YES};return SC.BUNDLE_INFO[h]}return NO},loadBundle:function(B,F,h){var z,C;
if(h===undefined&&SC.typeOf(F)===SC.T_FUNCTION){h=F;F=null}var u=SC.BUNDLE_INFO[B],E,D;
var g=SC.A(arguments).slice(3);if(SC.logBundleLoading){console.log("SC.loadBundle(): Attempting to load '%@'".fmt(B))
}if(!u){if(SC.logBundleLoading){console.log("SC.loadBundle(): Attemping to load %@ without SC.BUNDLE_INFO entry… could be loaded through other means.".fmt(B))
}u=this.tryToLoadBundle(B,F,h,g)}if(!u){throw"SC.loadBundle(): could not find bundle '%@'".fmt(B)
}else{if(u.loaded){if(SC.logBundleLoading){console.log("SC.loadBundle(): Bundle '%@' already loaded, skipping.".fmt(B))
}if(h){if(SC.isReady){SC._scb_bundleDidLoad(B,F,h,g)}else{SC.ready(SC,function(){SC._scb_bundleDidLoad(B,F,h,g)
})}}}else{if(SC.logBundleLoading){console.log("SC.loadBundle(): Bundle '%@' is not loaded, loading now.".fmt(B))
}E=u.callbacks||[];if(h){E.push(function(){SC._scb_bundleDidLoad(B,F,h,g)});u.callbacks=E
}if(!u.loading){var e=u.requires||[];var k=YES;for(z=0,C=e.length;z<C;++z){var x=e[z];
var o=SC.BUNDLE_INFO[x];if(!o){throw"SC.loadBundle(): could not find required bundle '%@' for bundle '%@'".fmt(x,B)
}else{if(o.loading){k=NO;break}else{if(o.loaded){continue}else{k=NO;var y=o.dependents;
if(!y){o.dependents=y=[]}y.push(B);if(SC.logBundleLoading){console.log("SC.loadBundle(): '%@' depends on '%@', loading dependency…".fmt(B,x))
}SC.loadBundle(x);break}}}}if(k){var p,j,l,d,m,s;m=document.getElementsByTagName("head")[0];
if(!m){m=document.documentElement}p=u.styles||[];for(z=0,C=p.length;z<C;++z){l=p[z];
if(l.length>0){d=document.createElement("link");d.setAttribute("href",l);d.setAttribute("rel","stylesheet");
d.setAttribute("type","text/css");m.appendChild(d)}}var n=this._jsBundleLoadQueue;
if(!n){this._jsBundleLoadQueue=n={}}n[B]=[];var A=n[B];j=u.scripts||[];for(z=0,C=j.length;
z<C;++z){l=j[z];if(l.length>0){A.push(l)}}u.loading=YES;this.scriptDidLoad(B)}}}}},scriptDidLoad:function(g){var d=this._jsBundleLoadQueue;
if(d){var j=d[g];if(j){var e=j.shift();if(SC.logBundleLoading){console.log("SC.scriptDidLoad(): Loading next file in '%@' -> '%@'".fmt(g,e))
}var h=document.createElement("script");h.setAttribute("type","text/javascript");
h.setAttribute("src",e);document.body.appendChild(h)}}},bundleDidLoad:function(h){var k=SC.BUNDLE_INFO[h],j,g;
if(!k){k=SC.BUNDLE_INFO[h]={loaded:YES};return}if(k.loaded&&SC.logBundleLoading){console.log("SC.bundleDidLoad() called more than once for bundle '%@'. Skipping.".fmt(h));
return}delete k.loading;k.loaded=YES;if(SC.isReady){SC._invokeCallbacksForBundle(h)
}else{SC.ready(SC,function(){SC._invokeCallbacksForBundle(h)})}var l=k.dependents||[];
for(var e=0,d=l.length;e<d;++e){if(SC.logBundleLoading){console.log("SC.loadBundle(): Bundle '%@' has completed loading, loading '%@' that depended on it.".fmt(h,l[e]))
}SC.loadBundle(l[e])}},_invokeCallbacksForBundle:function(g){var j=SC.BUNDLE_INFO[g],h;
if(!j){return}if(SC.logBundleLoading){console.log("SC.loadBundle(): Bundle '%@' has completed loading, invoking callbacks.".fmt(g))
}h=j.callbacks||[];SC.RunLoop.begin();for(var e=0,d=h.length;e<d;++e){h[e]()}SC.RunLoop.end()
}});require("system/builder");SC.CoreQuery=(function(){var N=/^[^<]*(<(.|\s)+>)[^>]*$|^#([\w-]+)$/,n=/^.[^:#\[\.]*$/;
var F=/ CQ\d+="(?:\d+|null)"/g,j=/(<(\w+)[^>]*?)\/>/g,z=/^(abbr|br|col|img|input|link|meta|param|hr|area|embed)$/i,e=/\s+/,k=/^\s+/,m=/^body|html$/i,L=/href|src|style/,o=/(button|input|object|select|textarea)/i,G=/alpha\([^)]*\)/,B=/opacity=([^)]*)/;
var K=SC.browser.msie?"styleFloat":"cssFloat";var C=(SC.browser.safari&&parseInt(SC.browser.version,0)<417)?"(?:[\\w*_-]|\\\\.)":"(?:[\\w\u0128-\uFFFF*_-]|\\\\.)";
var H=new RegExp("^("+C+"+)(#)("+C+"+)");var x=new RegExp("^([#.]?)("+C+"*)");var l=new RegExp("([#.]?)("+C+"*)","g");
var u=["Left","Right"];var h=["Top","Bottom"];var y={position:"absolute",visibility:"hidden",display:"block"};
var J=function J(Q,P,V){var U=P==="width"?Q.offsetWidth:Q.offsetHeight;var S=0,O=0,T=V.length,R;
while(--T>=0){R=V[T];S+=parseFloat(g.curCSS(Q,"padding"+R,true))||0;O+=parseFloat(g.curCSS(Q,"border"+R+"Width",true))||0
}U-=Math.round(S+O);return U};var p=SC.guidKey,I=0,M={},d=/z-?index|font-?weight|opacity|zoom|line-?height/i,D=document.defaultView||{};
var A=function A(P){if(!SC.browser.safari){return false}var O=D.getComputedStyle(P,null);
return !O||O.getPropertyValue("color")===""};function s(O,P){return O[0]&&parseInt(g.curCSS(O[0],P,true),10)||0
}var E,g;g=E=SC.Builder.create({jquery:"SC.CoreQuery",init:function(O,Q){O=O||document;
if(O.nodeType){this[0]=O;this.length=1;return this}else{if(typeof O==="string"){var P=N.exec(O);
if(P&&(P[1]||!Q)){if(P[1]){O=g.clean([P[1]],Q)}else{var R=document.getElementById(P[3]);
if(R){if(R.id!=P[3]){return g().find(O)}return g(R)}O=[]}}else{return g(Q).find(O)
}}else{if(SC.typeOf(O)===SC.T_FUNCTION){return SC.ready(O)}}}return this.setArray(g.makeArray(O))
},size:function(){return this.length},get:function(O){return O===undefined?g.makeArray(this):this[O]
},find:function(O){var P=g.map(this,function(Q){return g.find(O,Q)});return this.pushStack(P)
},filter:function(O){return this.pushStack((SC.typeOf(O)===SC.T_FUNCTION)&&g.grep(this,function(Q,P){return O.call(Q,P)
})||g.multiFilter(O,this))},not:function(O){if(typeof O==="string"){if(n.test(O)){return this.pushStack(g.multiFilter(O,this,true))
}else{O=g.multiFilter(O,this)}}var P=O.length&&O[O.length-1]!==undefined&&!O.nodeType;
return this.filter(function(){return P?g.inArray(this,O)<0:this!=O})},setArray:function(O){this.length=0;
Array.prototype.push.apply(this,O);return this},map:function(O){return this.pushStack(g.map(this,function(Q,P){return O.call(Q,P,Q)
}))},each:function(P,O){return g.each(this,P,O)},index:function(O){if(O&&O.jquery){O=O[0]
}return Array.prototype.indexOf.call(this,O)},eq:function(O){return this.slice(O,+O+1)
},slice:function(){return this.pushStack(Array.prototype.slice.apply(this,arguments))
},add:function(O){return this.pushStack(g.merge(this.get(),typeof O==="string"?g(O):g.makeArray(O)).uniq())
},attr:function(P,R,Q){var O=P;if(typeof P==="string"){if(R===undefined){return this[0]&&g[Q||"attr"](this[0],P)
}else{O={};O[P]=R}}return this.each(function(S){for(P in O){g.attr((Q)?this.style:this,P,g.prop(this,O[P],Q,S,P))
}})},html:function(O){return O===undefined?(this[0]?this[0].innerHTML.replace(F,""):null):this.empty().append(O)
},andSelf:function(){return this.add(this.prevObject)},is:function(O){return !!O&&g.multiFilter(O,this).length>0
},hasClass:function(O){return Array.prototype.every.call(this,function(P){return(P.nodeType===1)&&g.className.has(P,O)
})},val:function(U){if(U===undefined){var O=this[0];if(O){if(g.nodeName(O,"option")){return(O.attributes.value||{}).specified?O.value:O.text
}if(g.nodeName(O,"select")){var S=O.selectedIndex,V=[],W=O.options,R=O.type==="select-one",Q;
if(S<0){return null}var P,T=R?S+1:W.length;for(P=R?S:0;P<T;P++){Q=W[P];if(Q.selected){U=g(Q).val();
if(R){return U}V.push(U)}}return V}return(O.value||"").replace(/\r/g,"")}return undefined
}else{if(typeof U==="number"){U+=""}this.each(function(){if(this.nodeType!==1){return
}if(SC.typeOf(U)===SC.T_ARRAY&&(/radio|checkbox/).test(this.type)){this.checked=(g.inArray(this.value,U)>=0||g.inArray(this.name,U)>=0)
}else{if(g.nodeName(this,"select")){var X=g.makeArray(U);g("option",this).each(function(){this.selected=(g.inArray(this.value,X)>=0||g.inArray(this.text,X)>=0)
});if(!X.length){this.selectedIndex=-1}}else{this.value=U}}})}return this},clone:function(){var O=this.map(function(){if(SC.browser.msie&&!g.isXMLDoc(this)){var R=this.cloneNode(true),Q=document.createElement("div");
Q.appendChild(R);return g.clean([Q.innerHTML])[0]}else{return this.cloneNode(true)
}});var P=O.find("*").andSelf().each(function(){if(this[SC.guidKey]!==undefined){this[SC.guidKey]=null
}});return O},css:function(O,P){if((O==="width"||O==="height")&&parseFloat(P,0)<0){P=undefined
}return this.attr(O,P,"curCSS")},text:function(P){if(P!==undefined&&typeof P!=="object"&&P!=null){return this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(P))
}var O="";g.each(P||this,function(){g.each(this.childNodes,function(){if(this.nodeType!==8){O+=this.nodeType!==1?this.nodeValue:g.fn.text([this])
}})});return O},show:function(){var O=SC.$.isVisible;this.each(function(){if(!O(this)){this.style.display=this.oldblock||"";
if(g.css(this,"display")==="none"){var P=g("<"+this.tagName+"/>");g("body").append(P);
this.style.display=P.css("display");if(this.style.display==="none"){this.style.display="block"
}P.remove();P=null}}});return this},hide:function(){var O=SC.$.isVisible;this.each(function(){if(O(this)){this.oldblock=this.oldblock||g.css(this,"display");
this.style.display="none"}});return this},domManip:function(Q,R,P,T){var S=this.length>1,O;
return this.each(function(){if(!O){O=g.clean(Q,this.ownerDocument);if(P){O.reverse()
}}var U=this;if(R&&g.nodeName(this,"table")&&g.nodeName(O[0],"tr")){U=this.getElementsByTagName("tbody")[0]||this.appendChild(this.ownerDocument.createElement("tbody"))
}g.each(O,function(){var V=S?g(this).clone(true)[0]:this;T.call(U,V)})})},append:function(){return this.domManip(arguments,true,false,function(O){if(this.nodeType===1){this.appendChild(O)
}})},prepend:function(){return this.domManip(arguments,true,true,function(O){if(this.nodeType===1){this.insertBefore(O,this.firstChild)
}})},before:function(){return this.domManip(arguments,false,false,function(O){this.parentNode.insertBefore(O,this)
})},after:function(){return this.domManip(arguments,false,true,function(O){this.parentNode.insertBefore(O,this.nextSibling)
})},replaceWith:function(O){return this.after(O).remove()},removeData:function(O){return this.each(function(){SC.removeData(this,O)
})}});E.mixin({nodeName:function(P,O){return P.nodeName&&P.nodeName.toUpperCase()===O.toUpperCase()
},map:function(O,T){var P=[],S,Q,R;for(Q=0,R=O.length;Q<R;Q++){S=T(O[Q],Q);if(S!=null){P[P.length]=S
}}return P.concat.apply([],P)},each:function(Q,U,P){var O,R=0,S=Q.length;if(P){if(S===undefined){for(O in Q){if(U.apply(Q[O],P)===false){break
}}}else{for(;R<S;){if(U.apply(Q[R++],P)===false){break}}}}else{if(S===undefined){for(O in Q){if(U.call(Q[O],O,Q[O])===false){break
}}}else{for(var T=Q[0];R<S&&U.call(T,R,T)!==false;T=Q[++R]){}}}return Q},isXMLDoc:function(O){return O.documentElement&&!O.body||O.tagName&&O.ownerDocument&&!O.ownerDocument.body
},clean:function(O,Q){var P=[];Q=Q||document;if(typeof Q.createElement=="undefined"){Q=Q.ownerDocument||Q[0]&&Q[0].ownerDocument||document
}g.each(O,function(U,W){if(typeof W==="number"){W+=""}if(!W){return}if(typeof W==="string"){W=W.replace(j,function(Z,ab,Y){return Y.match(z)?Z:ab+"></"+Y+">"
});var T=W.replace(k,"").substring(0,10).toLowerCase(),X=Q.createElement("div");var V=!T.indexOf("<opt")&&[1,"<select multiple='multiple'>","</select>"]||!T.indexOf("<leg")&&[1,"<fieldset>","</fieldset>"]||T.match(/^<(thead|tbody|tfoot|colg|cap)/)&&[1,"<table>","</table>"]||!T.indexOf("<tr")&&[2,"<table><tbody>","</tbody></table>"]||(!T.indexOf("<td")||!T.indexOf("<th"))&&[3,"<table><tbody><tr>","</tr></tbody></table>"]||!T.indexOf("<col")&&[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"]||SC.browser.msie&&[1,"div<div>","</div>"]||[0,"",""];
X.innerHTML=V[1]+W+V[2];while(V[0]--){X=X.lastChild}if(SC.browser.msie){var S=!T.indexOf("<table")&&T.indexOf("<tbody")<0?X.firstChild&&X.firstChild.childNodes:V[1]==="<table>"&&T.indexOf("<tbody")<0?X.childNodes:[];
for(var R=S.length-1;R>=0;--R){if(g.nodeName(S[R],"tbody")&&!S[R].childNodes.length){S[R].parentNode.removeChild(S[R])
}}if(/^\s/.test(W)){X.insertBefore(Q.createTextNode(W.match(/^\s*/)[0]),X.firstChild)
}}W=g.makeArray(X.childNodes)}if(W.length===0&&(!g.nodeName(W,"form")&&!g.nodeName(W,"select"))){return
}if(W[0]===undefined||g.nodeName(W,"form")||W.options){P.push(W)}else{P=g.merge(P,W)
}});return P},find:function(ac,P){var W;if(typeof ac!=="string"){return[ac]}if(ac.indexOf(",")>=0){W=ac.split(",").map(function(ae){return g.find(ae,P)
});return W.concat.apply([],W).uniq()}if(P&&P.nodeType!==1&&P.nodeType!==9){return[]
}P=P||document;W=[P];var Y,O=YES,S=ac.match(l),V=S.length,R;for(var Z=0;Z<V;Z++){ac=S[Z];
if(ac===" "||ac===""){O=YES}else{if(O){R=x.exec(ac);if((R[1]==="")&&(Z<(V-1))&&(S[Z+1].charAt(0)==="#")){ac=S[Z+1];
S[Z+1]=S[Z];R=x.exec(ac)}var U=[],T=W.length,X,ab,Q=R[2],ad;for(X=0;X<T;X++){ab=W[X];
switch(R[1]){case"":if(!Q){Q="*"}if(Q==="*"&&ab.nodeName.toLowerCase()==="object"){Q="param"
}U=g.merge(U,ab.getElementsByTagName(Q));break;case"#":if(ab===document){ad=document.getElementById(Q);
if(SC.browser.msie&&ad&&ad.getAttribute("id")!==Q){ad=NO}else{if(ad){U.push(ad)}ad=YES
}}else{ad=NO}if(!ad){ad=ab.getElementsByTagName("*");ad=Array.prototype.find.call(ad,function(ae){return ae.getAttribute&&(ae.getAttribute("id")===Q)
});if(ad){U.push(ad)}}break;case".":if(ab.getElementsByClassName){U=g.merge(U,ab.getElementsByClassName(Q))
}else{U=g.merge(U,g.classFilter(ab.getElementsByTagName("*"),Q))}break;default:}}delete W;
W=U;O=NO}else{W=g.filter(ac,W)}}}if(W&&W[0]==P){W.shift()}return W.uniq()},classFilter:function(T,O,S){O=" "+O+" ";
var Q=[],R;for(var P=0;T[P];P++){R=(" "+T[P].className+" ").indexOf(O)>=0;if(!S&&R||S&&!R){Q.push(T[P])
}}return Q},filter:function(P,T,S){var O=x.exec(P),U=O[2],R=O[1],Q;if(R==="."){return g.classFilter(g.makeArray(T),U,S)
}else{if(R==="#"){Q=function(W){var V=W&&W.getAttribute&&(W.getAttribute("id")===U);
return(S)?!V:V}}else{Q=function(W){var V=g.nodeName(W,U);return(S)?!V:V}}return Array.prototype.filter.call(g.makeArray(T),Q)
}},multiFilter:function(R,O,Q){R=R.indexOf(",")?R.split(","):[R];var T=R.length,S,P=[];
while(--T>=0){S=g.filter(R[T].trim(),O,Q);P=Q?O=S:g.merge(S,P)}return P},merge:function(R,O){var P=0,Q,S=R.length;
if(SC.browser.msie){while(Q=O[P++]){if(Q.nodeType!==8){R[S++]=Q}}}else{while(Q=O[P++]){R[S++]=Q
}}return R},makeArray:function(Q){var O=[];if(Q!==undefined||Q!=null){var P=Q.length;
if(P==null||typeof Q==="string"||Q.setInterval){O[0]=Q}else{while(P){O[--P]=Q[P]}}}return O
},inArray:function(O,P){return P.indexOf?P.indexOf(O):Array.prototype.indexOf.call(P,O)
},boxModel:!SC.browser.msie||document.compatMode==="CSS1Compat",props:{"for":"htmlFor","class":"className","float":K,cssFloat:K,styleFloat:K,readonly:"readOnly",maxlength:"maxLength",cellspacing:"cellSpacing",rowspan:"rowSpan"},prop:function(R,S,Q,P,O){if(SC.typeOf(S)===SC.T_FUNCTION){S=S.call(R,P)
}return S&&(typeof S==="number")&&Q==="curCSS"&&!d.test(O)?S+"px":S},grep:function(P,T,O){var Q=[];
for(var R=0,S=P.length;R<S;R++){if(!O!=!T(P[R],R)){Q.push(P[R])}}return Q},className:{add:function(P,Q){var O=g.className.has;
g.each((Q||"").split(e),function(R,S){if(P.nodeType===1&&!O(P.className,S)){P.className+=(P.className?" ":"")+S
}})},remove:function(O,P){if(O.nodeType===1){O.className=P!==undefined?g.grep(O.className.split(e),function(Q){return !g.className.has(P,Q)
}).join(" "):""}},has:function(P,O){return P&&g.inArray(O,(P.className||P).toString().split(e))>-1
}},swap:function(T,S,V,U,O){var P={},R;for(R in S){P[R]=T.style[R];T.style[R]=S[R]
}var Q=V(T,U,O);for(R in S){T.style[R]=P[R]}return Q},css:function(Q,O,R){if(O==="width"||O==="height"){var T,S=(O==="width")?u:h,P=y;
T=SC.$.isVisible(Q)?J(Q,O,S):g.swap(Q,P,J,O,S);return Math.max(0,T)}return g.curCSS(Q,O,R)
},curCSS:function(U,P,Q){var Z,O=U.style;if(P==="opacity"&&SC.browser.msie){Z=g.attr(O,"opacity");
return Z===""?"1":Z}if(SC.browser.opera&&P==="display"){var ab=O.outline;O.outline="0 solid black";
O.outline=ab}var R=P.match(/float/i);if(R){P=K}if(!Q&&O&&O[P]){Z=O[P]}else{if(D.getComputedStyle){if(R){P="float"
}P=P.replace(/([A-Z])/g,"-$1").toLowerCase();var ac=D.getComputedStyle(U,null);if(ac&&!A(U,D)){Z=ac.getPropertyValue(P)
}else{var T=[],ad=[],ae=U,W=0,Y,V;for(;ae&&A(ae);ae=ae.parentNode){ad.unshift(ae)
}for(V=ad.length;W<V;W++){if(A(ad[W])){T[W]=ad[W].style.display;ad[W].style.display="block"
}}Z=(P==="display"&&T[ad.length-1]!==null)?"none":(ac&&ac.getPropertyValue(P))||"";
for(W=0,Y=T.length;W<Y;W++){if(T[W]!==null){ad[W].style.display=T[W]}}}if(P==="opacity"&&Z===""){Z="1"
}}else{if(U.currentStyle){Z=U.currentStyle[P]||U.currentStyle[P.camelize()];if(!(/^\d+(px)?$/i).test(Z)&&(/^\d/).test(Z)){var S=O.left,X=U.runtimeStyle.left;
U.runtimeStyle.left=U.currentStyle.left;O.left=Z||0;Z=O.pixelLeft+"px";O.left=S;U.runtimeStyle.left=X
}}}}return Z},dir:function(Q,P){var O=[],R=Q[P];while(R&&R!=document){if(R.nodeType===1){O.push(R)
}R=R[P]}return O},nth:function(S,O,Q,R){O=O||1;var P=0;for(;S;S=S[Q]){if(S.nodeType===1&&++P==O){break
}}return S},sibling:function(Q,P){var O=[];for(;Q;Q=Q.nextSibling){if(Q.nodeType===1&&Q!=P){O.push(Q)
}}return O},attr:function(P,O,V){if(!P||P.nodeType===3||P.nodeType===8){return undefined
}var Q=!g.isXMLDoc(P),U=V!==undefined,S=SC.browser.msie;O=Q&&g.props[O]||O;if(P.tagName){var T=L.test(O);
if(O==="selected"&&P.parentNode){P.parentNode.selectedIndex}if(O in P&&Q&&!T){if(U){if(O==="type"&&g.nodeName(P,"input")&&P.parentNode){throw"type property can't be changed"
}P[O]=V}if(g.nodeName(P,"form")&&P.getAttributeNode(O)){return P.getAttributeNode(O).nodeValue
}if(O==="tabIndex"){var W=P.getAttributeNode("tabIndex");return W&&W.specified?W.value:P.nodeName.match(o)?0:P.nodeName.match(/^(a|area)$/i)&&P.href?0:undefined
}return P[O]}if(S&&Q&&O==="style"){return g.attr(P.style,"cssText",V)}if(U){P.setAttribute(O,""+V)
}var R=(S&&Q&&T)?P.getAttribute(O,2):P.getAttribute(O);return R===null?undefined:R
}if(S&&O==="opacity"){if(U){P.zoom=1;P.filter=(P.filter||"").replace(G,"")+(parseInt(V,0)+""=="NaN"?"":"alpha(opacity="+V*100+")")
}return P.filter&&P.filter.indexOf("opacity=")>=0?(parseFloat(P.filter.match(B)[1])/100)+"":""
}O=O.camelize();if(U){P[O]=V}return P[O]}});g.fn.init.prototype=g.fn;g.each({parent:function(O){return O.parentNode
},parents:function(O){return g.dir(O,"parentNode")},next:function(O){return g.nth(O,2,"nextSibling")
},prev:function(O){return g.nth(O,2,"previousSibling")},nextAll:function(O){return g.dir(O,"nextSibling")
},prevAll:function(O){return g.dir(O,"previousSibling")},siblings:function(O){return g.sibling(O.parentNode.firstChild,O)
},children:function(O){return g.sibling(O.firstChild)},contents:function(O){return g.nodeName(O,"iframe")?O.contentDocument||O.contentWindow.document:g.makeArray(O.childNodes)
}},function(O,P){g.fn[O]=function(Q){var R=g.map(this,P);if(Q&&typeof Q==="string"){R=g.multiFilter(Q,R)
}return this.pushStack(R.uniq())}});g.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(O,P){g.fn[O]=function(){var Q=arguments;
return this.each(function(){for(var R=0,S=Q.length;R<S;R++){g(Q[R])[P](this)}})}});
g.each({removeAttr:function(O){g.attr(this,O,"");if(this.nodeType===1){this.removeAttribute(O)
}},addClass:function(O){g.className.add(this,O)},removeClass:function(O){g.className.remove(this,O)
},toggleClass:function(O){g.className[g.className.has(this,O)?"remove":"add"](this,O)
},remove:function(O){if(!O||g.filter(O,[this]).length){if(this.parentNode){this.parentNode.removeChild(this)
}}},empty:function(){while(this.firstChild){this.removeChild(this.firstChild)}}},function(O,P){g.fn[O]=function(){return this.each(P,arguments)
}});g.each(["Height","Width"],function(S,Q){var T=Q.toLowerCase(),P;g.fn[T]=function(U){if(this[0]===window){if(SC.browser.opera){P=document.body["client"+Q]
}else{if(SC.browser.safari){P=window["inner"+Q]}else{if(document.compatMode){P=documentElement["client"+Q]
}else{P=document.body["client"+Q]}}}}else{if(this[0]===document){P=Math.max(Math.max(document.body["scroll"+Q],document.documentElement["scroll"+Q]),Math.max(document.body["offset"+Q],document.documentElement["offset"+Q]))
}else{if(U===undefined){return this.length?g.css(this[0],T):null}else{return this.css(T,(typeof U==="string")?U:U+"px")
}}}return P};var O=S?"Left":"Top",R=S?"Right":"Bottom";g.fn["inner"+Q]=function(){return this[Q.toLowerCase()]()+s(this,"padding"+O)+s(this,"padding"+R)
};g.fn["outer"+Q]=function(U){return this["inner"+Q]()+s(this,"border"+O+"Width")+s(this,"border"+R+"Width")+(U?s(this,"margin"+O)+s(this,"margin"+R):0)
}});E.fn.offset=function(){var P=0,X=0,Q=this[0],ad=SC.browser,T;if(!Q){return undefined
}function S(ae){ac(g.curCSS(ae,"borderLeftWidth",true),g.curCSS(ae,"borderTopWidth",true))
}function ac(ae,af){P+=parseInt(ae,10)||0;X+=parseInt(af,10)||0}var Z=Q.parentNode,W=Q,O=Q.offsetParent,Y=Q.ownerDocument,ab=ad.safari&&parseInt(ad.version,0)<522&&!(/adobeair/i).test(ad.userAgent),V=g.curCSS,R=g.css(Q,"position")==="fixed";
if(!(ad.mozilla&&Q==document.body)&&Q.getBoundingClientRect){var U=Q.getBoundingClientRect();
ac(U.left+Math.max(Y.documentElement.scrollLeft,Y.body.scrollLeft),U.top+Math.max(Y.documentElement.scrollTop,Y.body.scrollTop));
ac(-Y.documentElement.clientLeft,-Y.documentElement.clientTop)}else{ac(Q.offsetLeft,Q.offsetTop);
while(O){ac(O.offsetLeft,O.offsetTop);if(ad.mozilla&&!(/^t(able|d|h)$/i).test(O.tagName)||ad.safari&&!ab){S(O)
}if(!R&&V(O,"position")==="fixed"){R=true}W=(/^body$/i).test(O.tagName)?W:O;O=O.offsetParent
}while(Z&&Z.tagName&&!(m).test(Z.tagName)){if(!(/^inline|table.*$/i).test(V(Z,"display"))){ac(-Z.scrollLeft,-Z.scrollTop)
}if(ad.mozilla&&V(Z,"overflow")!=="visible"){S(Z)}Z=Z.parentNode}if((ab&&(R||V(W,"position")==="absolute"))||(ad.mozilla&&V(W,"position")!=="absolute")){ac(-Y.body.offsetLeft,-Y.body.offsetTop)
}if(R){ac(Math.max(Y.documentElement.scrollLeft,Y.body.scrollLeft),Math.max(Y.documentElement.scrollTop,Y.body.scrollTop))
}}T={top:X,left:P};return T};E.fn.mixin({position:function(){var S=0,R=0,P;if(this[0]){var Q=this.offsetParent(),T=this.offset(),O=m.test(Q[0].tagName)?{top:0,left:0}:Q.offset();
T.top-=s(this,"marginTop");T.left-=s(this,"marginLeft");O.top+=s(Q,"borderTopWidth");
O.left+=s(Q,"borderLeftWidth");P={top:T.top-O.top,left:T.left-O.left}}return P},offsetParent:function(){var O=this[0].offsetParent||document.body;
while(O&&(!(m).test(O.tagName)&&g.css(O,"position")==="static")){O=O.offsetParent
}return g(O)}});g.each(["Left","Top"],function(P,O){var Q="scroll"+O;g.fn[Q]=function(R){if(!this[0]){return
}return R!==undefined?this.each(function(){this==window||this==document?window.scrollTo(!P?R:g(window).scrollLeft(),P?R:g(window).scrollTop()):this[Q]=R
}):this[0]==window||this[0]==document?self[P?"pageYOffset":"pageXOffset"]||g.boxModel&&document.documentElement[Q]||document.body[Q]:this[0][Q]
}});return E}());SC.$=(typeof jQuery=="undefined")?SC.CoreQuery:jQuery;SC.mixin(SC.$.fn,{isCoreQuery:YES,toString:function(){var g=[],e=this.length,d=0;
for(d=0;d<e;d++){g[d]="%@: %@".fmt(d,this[d]?this[d].toString():"(null)")}return"<$:%@>(%@)".fmt(SC.guidFor(this),g.join(" , "))
},isVisible:function(){return Array.prototype.every.call(this,function(d){return SC.$.isVisible(d)
})},first:function(){return this.pushStack([this[0]])},last:function(){return this.pushStack([this[this.length-1]])
},view:function(){return this.map(function(){var e=null,d=SC.viewKey,h=this,g;while(!e&&h&&(h!==document)){if(h.nodeType===1&&(g=h.getAttribute("id"))){e=SC.View.views[g]
}h=h.parentNode}h=null;return e})},setClass:function(h,g){if(SC.none(h)){return this
}var j=SC.typeOf(h)!==SC.T_STRING,d=this._fixupClass,e;this.each(function(){if(this.nodeType!==1){return
}var m=this.className.split(/\s+/),l=NO;if(j){for(var k in h){if(!h.hasOwnProperty(k)){continue
}l=d(m,k,h[k])||l}}else{l=d(m,h,g)}if(l){this.className=m.join(" ")}});return this
},_fixupClass:function(h,d,g){var e=h.indexOf(d);if(g){if(e<0){h.push(d);return YES
}}else{if(e>=0){h[e]=null;return YES}}return NO},within:function(j){j=SC.$(j);var h,g,l,e,d=j.length,k=this.length;
while(!h&&(--k>=0)){l=this[k];for(e=0;!h&&(e<d);e++){g=j[e];while(g&&(g!==l)){g=g.parentNode
}h=g===l}}l=g=null;return h}});(function(){var g={},k={find:function(n,m){return(m!==undefined)?SC.Enumerable.find.call(this,n,m):g.find.call(this,n)
},filter:function(n,m){return(m!==undefined)?this.pushStack(SC.Enumerable.filter.call(this,n,m)):g.filter.call(this,n)
},filterProperty:function(m,n){return this.pushStack(SC.Enumerable.filterProperty.call(this,m,n))
},indexOf:SC.$.index,map:function(n,m){return(m!==undefined)?SC.Enumerable.map.call(this,n,m):g.map.call(this,n)
}};var l=SC.$.jquery==="SC.CoreQuery",h=SC.$.fn,d=l?k:SC.Enumerable,j;for(var e in d){if(!d.hasOwnProperty(e)){continue
}j=d[e];if(e in k){g[e]=h[e];j=k[e]}h[e]=j}})();SC.mixin(SC.$,{isVisible:function(d){var e=SC.$;
return("hidden"!=d.type)&&(e.css(d,"display")!="none")&&(e.css(d,"visibility")!="hidden")
}});SC.SYSTEM_CURSOR="default";SC.AUTO_CURSOR=SC.DEFAULT_CURSOR="auto";SC.CROSSHAIR_CURSOR="crosshair";
SC.HAND_CURSOR=SC.POINTER_CURSOR="pointer";SC.MOVE_CURSOR="move";SC.E_RESIZE_CURSOR="e-resize";
SC.NE_RESIZE_CURSOR="ne-resize";SC.NW_RESIZE_CURSOR="nw-resize";SC.N_RESIZE_CURSOR="n-resize";
SC.SE_RESIZE_CURSOR="se-resize";SC.SW_RESIZE_CURSOR="sw-resize";SC.S_RESIZE_CURSOR="s-resize";
SC.W_RESIZE_CURSOR="w-resize";SC.IBEAM_CURSOR=SC.TEXT_CURSOR="text";SC.WAIT_CURSOR="wait";
SC.HELP_CURSOR="help";SC.Cursor=SC.Object.extend({init:function(){arguments.callee.base.apply(this,arguments);
var d=this.get("cursorStyle")||SC.DEFAULT_CURSOR,g=this.constructor.sharedStyleSheet(),e=SC.guidFor(this);
if(g.insertRule){g.insertRule("."+e+" {cursor: "+d+";}",g.cssRules?g.cssRules.length:0)
}else{if(g.addRule){g.addRule("."+e,"cursor: "+d)}}this.cursorStyle=d;this.className=e;
return this},className:null,cursorStyle:SC.DEFAULT_CURSOR,cursorStyleDidChange:function(){var h,k,g,j,l,e,d;
h=this.get("cursorStyle")||SC.DEFAULT_CURSOR;k=this._rule;if(k){k.style.cursor=h;
return}g="."+this.get("className");j=this.constructor.sharedStyleSheet();l=(j.cssRules?j.cssRules:j.rules)||[];
for(e=0,d=l.length;e<d;++e){k=l[e];if(k.selectorText===g){this._rule=k;k.style.cursor=h;
break}}}.observes("cursorStyle")});SC.Cursor.sharedStyleSheet=function(){var e,d=this._styleSheet;
if(!d){d=document.createElement("style");d.type="text/css";e=document.getElementsByTagName("head")[0];
if(!e){e=document.documentElement}e.appendChild(d);d=document.styleSheets[document.styleSheets.length-1];
this._styleSheet=d}return d};SC.SCANNER_OUT_OF_BOUNDS_ERROR=new Error("Out of bounds.");
SC.SCANNER_INT_ERROR=new Error("Not an int.");SC.SCANNER_SKIP_ERROR=new Error("Did not find the string to skip.");
SC.SCANNER_SCAN_ARRAY_ERROR=new Error("Did not find any string of the given array to scan.");
SC.DATETIME_COMPAREDATE_TIMEZONE_ERROR=new Error("Can't compare the dates of two DateTimes that don't have the same timezone.");
SC.DATETIME_ISO8601="%Y-%m-%dT%H:%M:%S%Z";SC.Scanner=SC.Object.extend({string:null,scanLocation:0,scan:function(d){if(this.scanLocation+d>this.length){throw SC.SCANNER_OUT_OF_BOUNDS_ERROR
}var e=this.string.substr(this.scanLocation,d);this.scanLocation+=d;return e},scanInt:function(d){var g=this.scan(d);
var e=new RegExp("\\d{"+d+"}");if(!g.match(e)){throw SC.SCANNER_INT_ERROR}return parseInt(g,10)
},skipString:function(d){if(this.scan(d.length)!==d){throw SC.SCANNER_SKIP_ERROR}return YES
},scanArray:function(g){for(var e=0,d=g.length;e<d;e++){if(this.scan(g[e].length)===g[e]){return e
}this.scanLocation-=g[e].length}throw SC.SCANNER_SCAN_ARRAY_ERROR}});SC.DateTime=SC.Object.extend(SC.Freezable,SC.Copyable,{_ms:0,timezone:0,isFrozen:YES,adjust:function(e,d){var g;
e=e?SC.clone(e):{};g=(e.timezone!==undefined)?e.timezone:(this.timezone!==undefined)?this.timezone:0;
return this.constructor._adjust(e,this._ms,g,d)._createFromCurrentState()},advance:function(d){return this.constructor._advance(d,this._ms,this.timezone)._createFromCurrentState()
},unknownProperty:function(d){return this.constructor._get(d,this._ms,this.timezone)
},toFormattedString:function(d){return this.constructor._toFormattedString(d,this._ms,this.timezone)
},toISO8601:function(){return this.constructor._toFormattedString(SC.DATETIME_ISO8601,this._ms,this.timezone)
},toString:function(){return"UTC: "+new Date(this._ms).toUTCString()+", timezone: "+this.timezone
},isEqual:function(d){return SC.DateTime.compare(this,d)===0},copy:function(){return this
},toTimezone:function(d){if(d===undefined){d=0}return this.advance({timezone:d-this.timezone})
}});SC.DateTime.mixin(SC.Comparable,{recordFormat:SC.DATETIME_ISO8601,dayNames:"_SC.DateTime.dayNames".loc().w(),_englishDayNames:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".w(),abbreviatedDayNames:"_SC.DateTime.abbreviatedDayNames".loc().w(),monthNames:"_SC.DateTime.monthNames".loc().w(),abbreviatedMonthNames:"_SC.DateTime.abbreviatedMonthNames".loc().w(),_date:new Date(),_tz:0,timezone:new Date().getTimezoneOffset(),_dt_cache:{},_dt_cache_index:-1,_DT_CACHE_MAX_LENGTH:1000,_setCalcState:function(d,g){var e={milliseconds:this._date.getTime(),timezone:this._tz};
if(d!==undefined){this._date.setTime(d)}if(g!==undefined){this._tz=g}return e},_setCalcStateFromHash:function(g,e){var h=(e!==undefined)?e:this._tz;
var d=this._toMilliseconds(g,this._ms,h);return this._setCalcState(d,h)},_get:function(F,g,x){var u,D,n,z,j,p,s,k,A,e;
var h,o;var C=this._date;var B,l=null;B=this._setCalcState(g,x);if(F==="milliseconds"){l=C.getTime()
}else{if(F==="timezone"){l=this._tz}}if(l===null){A=F.slice(0,4);e=F.slice(4);if(A==="last"||A==="next"){h=this._get("dayOfWeek");
o=this._englishDayNames.indexOf(e);if(o>=0){var E=o-h;if(A==="last"&&E>=0){E-=7}if(A==="next"&&E<0){E+=7
}this._advance({day:E},g,x);l=this._createFromCurrentState()}}}if(l===null){if(x!==undefined){this._setCalcState(C.getTime()-(x*60000),0)
}switch(F){case"year":l=C.getUTCFullYear();break;case"month":l=C.getUTCMonth()+1;
break;case"day":l=C.getUTCDate();break;case"dayOfWeek":l=C.getUTCDay();break;case"hour":l=C.getUTCHours();
break;case"minute":l=C.getUTCMinutes();break;case"second":l=C.getUTCSeconds();break;
case"millisecond":l=C.getUTCMilliseconds();break}if((l===null)&&(F==="isLeapYear")){j=this._get("year");
l=(j%4===0&&j%100!==0)||j%400===0}if((l===null)&&(F==="daysInMonth")){switch(this._get("month")){case 4:case 6:case 9:case 11:l=30;
break;case 2:l=this._get("isLeapYear")?29:28;break;default:l=31;break}}if((l===null)&&(F==="dayOfYear")){u=C.getTime();
n=this._get("day");this._setCalcStateFromHash({day:1});for(z=this._get("month")-1;
z>0;z--){this._setCalcStateFromHash({month:z});n+=this._get("daysInMonth")}C.setTime(u);
l=n}if((l===null)&&(F.slice(0,4)==="week")){p=F.length===4?1:parseInt(F.slice("4"),10);
s=this._get("dayOfWeek");k=this._get("dayOfYear")-1;if(p===0){l=parseInt((k-s+7)/7,10)
}else{l=parseInt((k-(s-1+7)%7+7)/7,10)}}}this._setCalcState(B.milliseconds,B.timezone);
return l},_adjust:function(g,k,j,d){var h=g?SC.clone(g):{};var e=this._toMilliseconds(g,k,j,d);
this._setCalcState(e,j);return this},_advance:function(d,k,h){var g=d?SC.clone(d):{};
var j;for(var e in g){g[e]+=this._get(e,k,h)}j=(g.timezone!==undefined)?g.timezone:h;
return this._adjust(g,k,j,NO)},_toMilliseconds:function(o,h,m,k){var e=o?SC.clone(o):{};
var n=this._date;var l=n.getTime();var g,j;if(!SC.none(h)){n.setTime(h)}j=(m!==undefined)?m:(this.timezone!==undefined)?this.timezone:0;
n.setTime(n.getTime()-(j*60000));if(k===undefined||k===YES){if(!SC.none(e.hour)&&SC.none(e.minute)){e.minute=0
}if(!(SC.none(e.hour)&&SC.none(e.minute))&&SC.none(e.second)){e.second=0}if(!(SC.none(e.hour)&&SC.none(e.minute)&&SC.none(e.second))&&SC.none(e.millisecond)){e.millisecond=0
}}if(SC.none(e.year)){e.year=n.getUTCFullYear()}if(SC.none(e.month)){e.month=n.getUTCMonth()+1
}if(SC.none(e.day)){e.day=n.getUTCDate()}if(SC.none(e.hour)){e.hour=n.getUTCHours()
}if(SC.none(e.minute)){e.minute=n.getUTCMinutes()}if(SC.none(e.second)){e.second=n.getUTCSeconds()
}if(SC.none(e.millisecond)){e.millisecond=n.getUTCMilliseconds()}g=Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,e.second,e.millisecond);
n.setTime(g+(j*60000));g=n.getTime();n.setTime(l);return g},create:function(){var n=arguments.length===0?{}:arguments[0];
var h;if(SC.typeOf(n)===SC.T_NUMBER){n={milliseconds:n}}h=(n.timezone!==undefined)?n.timezone:this.timezone;
if(h===undefined){h=0}if(!SC.none(n.milliseconds)){var m="nu"+n.milliseconds+h,d=this._dt_cache;
var j=d[m];if(!j){var k,l=this._dt_cache_index,e=this;j=d[m]=new e([{_ms:n.milliseconds,timezone:h}]);
l=this._dt_cache_index=(l+1)%this._DT_CACHE_MAX_LENGTH;k=d[l];if(k!==undefined&&d[k]){delete d[k]
}d[l]=m}return j}else{var g=new Date();return this.create({milliseconds:this._toMilliseconds(n,g.getTime(),h,n.resetCascadingly),timezone:h})
}},_createFromCurrentState:function(){return this.create({milliseconds:this._date.getTime(),timezone:this._tz})
},parse:function(y,k){var z=/(?:\%([aAbBcdHIjmMpSUWwxXyYZ\%])|(.))/g;var x,p,g={},j={},o=SC.Scanner.create({string:y});
try{while((p=z.exec(k))!==null){switch(p[1]){case"a":j.dayOfWeek=o.scanArray(this.abbreviatedDayNames);
break;case"A":j.dayOfWeek=o.scanArray(this.dayNames);break;case"b":g.month=o.scanArray(this.abbreviatedMonthNames)+1;
break;case"B":g.month=o.scanArray(this.monthNames)+1;break;case"c":throw"%c is not implemented";
case"d":g.day=o.scanInt(2);break;case"H":g.hour=o.scanInt(2);break;case"I":g.hour=o.scanInt(2);
break;case"j":throw"%j is not implemented";case"m":g.month=o.scanInt(2);break;case"M":g.minute=o.scanInt(2);
break;case"p":g.meridian=o.scanArray(["AM","PM"]);break;case"S":g.second=o.scanInt(2);
break;case"U":throw"%U is not implemented";case"W":throw"%W is not implemented";case"w":throw"%w is not implemented";
case"x":throw"%x is not implemented";case"X":throw"%X is not implemented";case"y":g.year=o.scanInt(2);
g.year+=(g.year>70?1900:2000);break;case"Y":g.year=o.scanInt(4);break;case"Z":var n=o.scan(1);
if(n==="Z"){g.timezone=0}else{if(n==="+"||n==="-"){var s=o.scanInt(2);if(o.scan(1)!==":"){o.scan(-1)
}var l=o.scanInt(2);g.timezone=(n==="+"?-1:1)*(s*60+l)}}break;case"%":o.skipString("%");
break;default:o.skipString(p[0]);break}}}catch(u){console.log("SC.DateTime.createFromString "+u.toString());
return null}if(!SC.none(g.meridian)&&!SC.none(g.hour)){if(g.meridian===1){g.hour=(g.hour+12)%24
}delete g.meridian}x=SC.DateTime.create(g);if(!SC.none(j.dayOfWeek)&&x.get("dayOfWeek")!==j.dayOfWeek){return null
}return x},_pad:function(e,d){var g=""+e;if(d===undefined){d=2}while(g.length<d){g="0"+g
}return g},__toFormattedString:function(e,j,g){var d,h;switch(e[1]){case"a":return this.abbreviatedDayNames[this._get("dayOfWeek")];
case"A":return this.dayNames[this._get("dayOfWeek")];case"b":return this.abbreviatedMonthNames[this._get("month")-1];
case"B":return this.monthNames[this._get("month")-1];case"c":return this._date.toString();
case"d":return this._pad(this._get("day"));case"D":return this._get("day");case"h":return this._get("hour");
case"H":return this._pad(this._get("hour"));case"i":d=this._get("hour");return(d===12||d===0)?12:(d+12)%12;
case"I":d=this._get("hour");return this._pad((d===12||d===0)?12:(d+12)%12);case"j":return this._pad(this._get("dayOfYear"),3);
case"m":return this._pad(this._get("month"));case"M":return this._pad(this._get("minute"));
case"p":return this._get("hour")>11?"PM":"AM";case"S":return this._pad(this._get("second"));
case"u":return this._pad(this._get("utc"));case"U":return this._pad(this._get("week0"));
case"W":return this._pad(this._get("week1"));case"w":return this._get("dayOfWeek");
case"x":return this._date.toDateString();case"X":return this._date.toTimeString();
case"y":return this._pad(this._get("year")%100);case"Y":return this._get("year");
case"Z":h=-1*g;return(h>=0?"+":"-")+this._pad(parseInt(Math.abs(h)/60,10))+":"+this._pad(Math.abs(h)%60);
case"%":return"%"}},_toFormattedString:function(g,j,e){var d=this;var h=(e!==undefined)?e:(this.timezone!==undefined)?this.timezone:0;
this._setCalcState(j-(e*60000),0);return g.replace(/\%([aAbBcdDHiIjmMpSUWwxXyYZ\%])/g,function(){var k=d.__toFormattedString.call(d,arguments,j,e);
return k})},compare:function(e,d){var h=e.get("milliseconds");var g=d.get("milliseconds");
return h<g?-1:h===g?0:1},compareDate:function(e,d){if(e.get("timezone")!==d.get("timezone")){throw SC.DATETIME_COMPAREDATE_TIMEZONE_ERROR
}var h=e.adjust({hour:0}).get("milliseconds");var g=d.adjust({hour:0}).get("milliseconds");
return h<g?-1:h===g?0:1}});SC.Binding.dateTime=function(d){return this.transform(function(e,g){return e?e.toFormattedString(d):null
})};if(SC.RecordAttribute&&!SC.RecordAttribute.transforms[SC.guidFor(SC.DateTime)]){SC.RecordAttribute.registerTransform(SC.DateTime,{to:function(g,d){if(SC.none(g)||SC.instanceOf(g,SC.DateTime)){return g
}var e=d.get("format");return SC.DateTime.parse(g,e?e:SC.DateTime.recordFormat)},from:function(e,d){if(SC.none(e)){return e
}var g=d.get("format");return e.toFormattedString(g?g:SC.DateTime.recordFormat)}})
}sc_require("system/core_query");SC.Event=function(h){if(h){this.originalEvent=h;
var l=SC.Event._props,g=l.length,e=g,j;while(--e>=0){j=l[e];this[j]=h[j]}}this.timeStamp=this.timeStamp||Date.now();
if(!this.target){this.target=this.srcElement||document}if(this.target.nodeType===3){this.target=this.target.parentNode
}if(!this.relatedTarget&&this.fromElement){this.relatedTarget=(this.fromElement===this.target)?this.toElement:this.fromElement
}if(SC.none(this.pageX)&&!SC.none(this.clientX)){var m=document.documentElement,d=document.body;
this.pageX=this.clientX+(m&&m.scrollLeft||d&&d.scrollLeft||0)-(m.clientLeft||0);this.pageY=this.clientY+(m&&m.scrollTop||d&&d.scrollTop||0)-(m.clientTop||0)
}if(!this.which&&((this.charCode||h.charCode===0)?this.charCode:this.keyCode)){this.which=this.charCode||this.keyCode
}if(!this.metaKey&&this.ctrlKey){this.metaKey=this.ctrlKey}if(!this.which&&this.button){this.which=((this.button&1)?1:((this.button&2)?3:((this.button&4)?2:0)))
}if(SC.browser.safari&&h.wheelDelta!==undefined){this.wheelDelta=0-(h.wheelDeltaY||h.wheelDeltaX);
this.wheelDeltaY=0-(h.wheelDeltaY||0);this.wheelDeltaX=0-(h.wheelDeltaX||0)}else{if(!SC.none(h.detail)){var k=Math.floor(h.detail*40);
if(h.axis&&(h.axis===h.HORIZONTAL_AXIS)){this.wheelDeltaX=k;this.wheelDeltaY=this.wheelDelta=0
}else{this.wheelDeltaY=this.wheelDelta=k;this.wheelDeltaX=0}}else{this.wheelDelta=this.wheelDeltaY=SC.browser.msie?0-h.wheelDelta:h.wheelDelta;
this.wheelDeltaX=0}}return this};SC.mixin(SC.Event,{create:function(d){return new SC.Event(d)
},add:function(j,h,k,l,g){if(j&&j.isCoreQuery){if(j.length>0){j.forEach(function(m){this.add(m,h,k,l,g)
},this);return this}else{j=j[0]}}if(!j){return this}if(j.nodeType===3||j.nodeType===8){return SC.Event
}if(SC.browser.msie&&j.setInterval){j=window}if(SC.typeOf(k)===SC.T_FUNCTION){g=l;
l=k;k=null}else{if(k&&SC.typeOf(l)===SC.T_STRING){l=k[l]}}var e=SC.data(j,"events")||SC.data(j,"events",{}),d=e[h];
if(!d){d=e[h]={};this._addEventListener(j,h)}d[SC.guidFor(l)]=[k,l,g];SC.Event._global[h]=YES;
j=e=d=null;return this},remove:function(k,j,l,m){if(k&&k.isCoreQuery){if(k.length>0){k.forEach(function(n){this.remove(n,j,l,m)
},this);return this}else{k=k[0]}}if(!k){return this}if(k.nodeType===3||k.nodeType===8){return SC.Event
}if(SC.browser.msie&&k.setInterval){k=window}var d,h,g=SC.data(k,"events");if(!g){return this
}if(j===undefined){for(j in g){this.remove(k,j)}}else{if(d=g[j]){var e=NO;if(l||m){if(SC.typeOf(l)===SC.T_FUNCTION){m=l;
l=null}else{if(SC.typeOf(m)===SC.T_STRING){m=l[m]}}delete d[SC.guidFor(m)];h=null;
for(h in d){break}if(h===null){e=YES}}else{e=YES}if(e){delete g[j];this._removeEventListener(k,j)
}h=null;for(h in g){break}if(!h){SC.removeData(k,"events");delete this._elements[SC.guidFor(k)]
}}}k=g=d=null;return this},NO_BUBBLE:["blur","focus","change"],simulateEvent:function(h,g,e){var d=SC.Event.create({type:g,target:h,preventDefault:function(){this.cancelled=YES
},stopPropagation:function(){this.bubbles=NO},allowDefault:function(){this.hasCustomEventHandling=YES
},timeStamp:Date.now(),bubbles:(this.NO_BUBBLE.indexOf(g)<0),cancelled:NO,normalized:YES});
if(e){SC.mixin(d,e)}return d},trigger:function(h,g,n,o){if(h&&h.isCoreQuery){if(h.length>0){h.forEach(function(u){this.trigger(u,g,n,o)
},this);return this}else{h=h[0]}}if(!h){return this}if(h.nodeType===3||h.nodeType===8){return undefined
}n=SC.A(n);var m,p=SC.typeOf(h[g]||null)===SC.T_FUNCTION,d,l,j,s;d=n[0];if(!d||!d.preventDefault){d=this.simulateEvent(h,g);
n.unshift(d)}d.type=g;l=h;do{m=SC.Event.handle.apply(l,n);l=(l===document)?null:(l.parentNode||document)
}while(!m&&d.bubbles&&l);l=null;j=h["on"+g];s=SC.CoreQuery.nodeName(h,"a")&&g==="click";
if((!p||s)&&j&&j.apply(h,n)===NO){m=NO}if(p&&o!==NO&&m!==NO&&!s){this.triggered=YES;
try{h[g]()}catch(k){}}this.triggered=NO;return m},handle:function(e){if((typeof SC==="undefined")||SC.Event.triggered){return YES
}var g,l,j,n,h,m,o,p,d,k;m=SC.A(arguments);m[0]=e=SC.Event.normalizeEvent(e||window.event);
h=(SC.data(this,"events")||{})[e.type];if(!h){return NO}for(o in h){p=h[o];d=p[1];
e.handler=d;e.data=e.context=p[2];k=p[0]||this;l=d.apply(k,m);if(g!==NO){g=l}if(l===NO){e.preventDefault();
e.stopPropagation()}}return g},unload:function(){var d,e=this._elements;for(d in e){this.remove(e[d])
}for(d in e){delete e[d]}delete this._elements},special:{ready:{setup:function(){SC._bindReady();
return},teardown:function(){return}},mouseenter:{setup:function(){if(SC.browser.msie){return NO
}SC.Event.add(this,"mouseover",SC.Event.special.mouseover.handler);return YES},teardown:function(){if(SC.browser.msie){return NO
}SC.Event.remove(this,"mouseover",SC.Event.special.mouseover.handler);return YES},handler:function(d){if(SC.Event._withinElement(d,this)){return YES
}d.type="mouseenter";return SC.Event.handle.apply(this,arguments)}},mouseleave:{setup:function(){if(SC.browser.msie){return NO
}SC.Event.add(this,"mouseout",SC.Event.special.mouseleave.handler);return YES},teardown:function(){if(SC.browser.msie){return NO
}SC.Event.remove(this,"mouseout",SC.Event.special.mouseleave.handler);return YES},handler:function(d){if(SC.Event._withinElement(d,this)){return YES
}d.type="mouseleave";return SC.Event.handle.apply(this,arguments)}}},KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,_withinElement:function(h,g){var e=h.relatedTarget;
while(e&&e!=g){try{e=e.parentNode}catch(d){e=g}}return e===g},_addEventListener:function(h,g){var j,e=this.special[g];
if(!e||e.setup.call(h)===NO){var d=SC.guidFor(h);this._elements[d]=h;j=SC.data(h,"listener")||SC.data(h,"listener",function(){return SC.Event.handle.apply(SC.Event._elements[d],arguments)
});if(h.addEventListener){h.addEventListener(g,j,NO)}else{if(h.attachEvent){h.attachEvent("on"+g,j)
}}}h=e=j=null},_removeEventListener:function(g,e){var h,d=SC.Event.special[e];if(!d||(d.teardown.call(g)===NO)){h=SC.data(g,"listener");
if(h){if(g.removeEventListener){g.removeEventListener(e,h,NO)}else{if(g.detachEvent){g.detachEvent("on"+e,h)
}}}}g=d=h=null},_elements:{},normalizeEvent:function(d){if(d===window.event){return SC.Event.create(d)
}else{return d.normalized?d:SC.Event.create(d)}},_global:{},_props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode metaKey newValue originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target timeStamp toElement type view which touches targetTouches changedTouches".split(" ")});
SC.Event.prototype={hasCustomEventHandling:NO,touchesForView:function(d){if(this.touchContext){return this.touchContext.touchesForView(d)
}},averagedTouchesForView:function(d){if(this.touchContext){return this.touchContext.averagedTouchesForView(d)
}return null},allowDefault:function(){this.hasCustomEventHandling=YES;return this
},preventDefault:function(){var d=this.originalEvent;if(d){if(d.preventDefault){d.preventDefault()
}d.returnValue=NO}this.hasCustomEventHandling=YES;return this},stopPropagation:function(){var d=this.originalEvent;
if(d){if(d.stopPropagation){d.stopPropagation()}d.cancelBubble=YES}this.hasCustomEventHandling=YES;
return this},stop:function(){return this.preventDefault().stopPropagation()},normalized:YES,getCharString:function(){if(SC.browser.msie){if(this.keyCode==8||this.keyCode==9||(this.keyCode>=37&&this.keyCode<=40)){return String.fromCharCode(0)
}else{return(this.keyCode>0)?String.fromCharCode(this.keyCode):null}}else{return(this.charCode>0)?String.fromCharCode(this.charCode):null
}},commandCodes:function(){var j=this.keyCode,e=null,g=null,d="",h;if(j){e=SC.FUNCTION_KEYS[j];
if(!e&&(this.altKey||this.ctrlKey||this.metaKey)){e=SC.PRINTABLE_KEYS[j]}if(e){if(this.altKey){d+="alt_"
}if(this.ctrlKey||this.metaKey){d+="ctrl_"}if(this.shiftKey){d+="shift_"}}}if(!e){j=this.which;
g=e=String.fromCharCode(j);h=e.toLowerCase();if(this.metaKey){d="meta_";e=h}else{e=null
}}if(e){e=d+e}return[e,g]}};SC.Event.observe=SC.Event.add;SC.Event.stopObserving=SC.Event.remove;
SC.Event.fire=SC.Event.trigger;SC.Event.add(window,"unload",SC.Event.prototype,SC.Event.unload);
SC.MODIFIER_KEYS={16:"shift",17:"ctrl",18:"alt"};SC.FUNCTION_KEYS={8:"backspace",9:"tab",13:"return",19:"pause",27:"escape",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",44:"printscreen",45:"insert",46:"delete",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock"};
SC.PRINTABLE_KEYS={32:" ",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",107:"+",109:"-",110:".",188:",",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:'"'};
sc_require("system/locale");SC.IMAGE_ABORTED_ERROR=SC.$error("SC.Image.AbortedError","Image",-100);
SC.IMAGE_FAILED_ERROR=SC.$error("SC.Image.FailedError","Image",-101);SC.imageCache=SC.Object.create({loadLimit:4,activeRequests:0,loadImage:function(d,j,k,h){var e=SC.typeOf(j);
if(SC.none(k)&&SC.typeOf(j)===SC.T_FUNCTION){j=null;k=j}if(SC.typeOf(k)===SC.T_STRING){k=j[k]
}if(SC.none(h)){h=SC.none(j)&&SC.none(k)}var g=this._imageEntryFor(d);if(g.status===this.IMAGE_LOADED){if(k){k.call(j||g.image,g.url,g.image)
}}else{if(j||k){this._addCallback(g,j,k)}g.retainCount++;this._scheduleImageEntry(g,h)
}},releaseImage:function(d,h,j){var g=this._imageEntryFor(d,NO);if(!g){return this
}if(--g.retainCount<=0){this._deleteEntry(g)}else{if(h||j){var e=SC.typeOf(h);if(SC.none(j)&&SC.typeOf(h)===SC.T_FUNCTION){h=null;
j=h}if(SC.typeOf(j)===SC.T_STRING){j=h[j]}this._removeCallback(g,h,j)}}},reloadImage:function(d){var e=this._imageEntryFor(d,NO);
if(e&&e.status===this.IMAGE_LOADED){e.status=this.IMAGE_WAITING}},loadNextImage:function(){var g=null,d;
if(this.get("activeRequests")>=this.get("loadLimit")){return}d=this._foregroundQueue;
while(d.length>0&&!g){g=d.shift()}if(!g){d=this._backgroundQueue;while(d.length>0&&!g){g=d.shift()
}}this.set("isLoading",!!g);if(g){var e=g.image;e.onabort=this._imageDidAbort;e.onerror=this._imageDidError;
e.onload=this._imageDidLoad;e.src=g.url;this._loading.push(g);this.incrementProperty("activeRequests");
this.loadNextImage()}},_imageEntryFor:function(g,d){if(d===undefined){d=YES}var h=this._images[g];
if(!h&&d){var e=new Image();h=this._images[g]={url:g,status:this.IMAGE_WAITING,callbacks:[],retainCount:0,image:e};
e.entry=h}return h},_deleteEntry:function(d){this._unscheduleImageEntry(d);delete this._images[d.url]
},_addCallback:function(g,h,j){var e=g.callbacks;var d=e.find(function(k){return k[0]===h&&k[1]===j
},this);if(!d){e.push([h,j])}e=null;return this},_removeCallback:function(e,g,h){var d=e.callbacks;
d.forEach(function(k,j){if(k[0]===g&&k[1]===h){d[j]=null}},this);d=null;return this
},_scheduleImageEntry:function(h,g){var e=this._backgroundQueue;var j=this._foregroundQueue;
if(h.status===this.IMAGE_LOADED){return this}if((h.status===this.IMAGE_QUEUED)&&!g&&h.isBackground){e[e.indexOf(h)]=null;
h.status=this.IMAGE_WAITING}if(h.status!==this.IMAGE_QUEUED){var d=(g)?e:j;d.push(h);
h.status=this.IMAGE_QUEUED;h.isBackground=g}if(!this.isLoading){this.invokeLater(this.loadNextImage,100)
}this.set("isLoading",YES);return this},_unscheduleImageEntry:function(e){if(e.status!==this.IMAGE_QUEUED){return this
}var d=e.isBackground?this._backgroundQueue:this._foregroundQueue;d[d.indexOf(e)]=null;
if(this._loading.indexOf(e)>=0){d.image.abort();this.imageStatusDidChange(e,this.ABORTED)
}return this},_imageDidAbort:function(){SC.RunLoop.begin();SC.imageCache.imageStatusDidChange(this.entry,SC.imageCache.ABORTED);
SC.RunLoop.end()},_imageDidError:function(){SC.RunLoop.begin();SC.imageCache.imageStatusDidChange(this.entry,SC.imageCache.ERROR);
SC.RunLoop.end()},_imageDidLoad:function(){SC.RunLoop.begin();SC.imageCache.imageStatusDidChange(this.entry,SC.imageCache.LOADED);
SC.RunLoop.end()},imageStatusDidChange:function(g,d){if(!g){return}var e=g.url;var h;
switch(d){case this.LOADED:h=g.image;break;case this.ABORTED:h=SC.IMAGE_ABORTED_ERROR;
break;case this.ERROR:h=SC.IMAGE_FAILED_ERROR;break;default:h=SC.IMAGE_FAILED_ERROR;
break}g.callbacks.forEach(function(k){var l=k[0],m=k[1];m.call(l,e,h)},this);g.callbacks=[];
g.status=(d===this.LOADED)?this.IMAGE_LOADED:this.IMAGE_WAITING;var j=g.image;if(j){j.onload=j.onerror=j.onabort=null;
if(d!==this.LOADED){g.image=null}}this._loading[this._loading.indexOf(g)]=null;if(this._loading.length>this.loadLimit*2){this._loading=this._loading.compact()
}this.decrementProperty("activeRequests");this.loadNextImage()},init:function(){arguments.callee.base.apply(this,arguments);
this._images={};this._loading=[];this._foregroundQueue=[];this._backgroundQueue=[]
},IMAGE_LOADED:"loaded",IMAGE_QUEUED:"queued",IMAGE_WAITING:"waiting",ABORTED:"aborted",ERROR:"error",LOADED:"loaded"});
SC.json={encode:function(d){return JSON.stringify(d)},decode:function(d){return JSON.parse(d)
}};if(!this.JSON){this.JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null
};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()
}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;
function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];
return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)
})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];
if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)
}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);
case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);
case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;
for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";
gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;
i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)
}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)
}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";
gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;
gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space
}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")
}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;
function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);
if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)
}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)
})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");
return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")
}}}());SC.Locale=SC.Object.extend({init:function(){if(!this.language){SC.Locale._assignLocales()
}if(!this.hasStrings){var g=this._deprecatedLanguageCodes||[];g.push(this.language);
var e=g.length;var d=null;while(!d&&--e>=0){d=String[g[e]]}if(d){this.hasStrings=YES;
this.strings=d}}},hasStrings:NO,strings:{},toString:function(){if(!this.language){SC.Locale._assignLocales()
}return"SC.Locale["+this.language+"]"+SC.guidFor(this)},locWithDefault:function(d,e){return this.strings[d]||e||d
}});SC.Locale.mixin({useAutodetectedLanguage:NO,preferredLanguage:null,createCurrentLocale:function(){var g=(String.useAutodetectedLanguage!==undefined)?String.useAutodetectedLanguage:this.useAutodetectedLanguage;
var e=(String.preferredLanguage!==undefined)?String.preferredLanguage:this.preferredLanguage;
var h=((g)?SC.browser.language:null)||e||SC.browser.language||"en";h=SC.Locale.normalizeLanguage(h);
var d=this.localeClassFor(h);if(h!=this.currentLanguage){this.currentLanguage=h;this.currentLocale=d.create()
}return this.currentLocale},localeClassFor:function(g){g=SC.Locale.normalizeLanguage(g);
var e,d=this.locales[g];if(!d&&((e=g.split("-")[0])!==g)&&(d=this.locales[e])){d=this.locales[g]=d.extend()
}if(!d){d=this.locales[g]=this.locales.en.extend()}return d},define:function(e,g){var d;
if(g===undefined&&(SC.typeOf(e)!==SC.T_STRING)){d=this;g=e}else{d=SC.Locale.localeClassFor(e)
}SC.mixin(d.prototype,g);return d},options:function(){return this.prototype},addStrings:function(e){var d=this.prototype.strings;
if(d){if(!this.prototype.hasOwnProperty("strings")){this.prototype.strings=SC.clone(d)
}}else{d=this.prototype.strings={}}if(e){this.prototype.strings=SC.mixin(d,e)}this.prototype.hasStrings=YES;
return this},_map:{english:"en",french:"fr",german:"de",japanese:"ja",jp:"ja",spanish:"es"},normalizeLanguage:function(d){if(!d){return"en"
}return SC.Locale._map[d.toLowerCase()]||d},_assignLocales:function(){for(var d in this.locales){this.locales[d].prototype.language=d
}},toString:function(){if(!this.prototype.language){SC.Locale._assignLocales()}return"SC.Locale["+this.prototype.language+"]"
},extend:function(){var d=SC.Object.extend.apply(this,arguments);d.addStrings=SC.Locale.addStrings;
d.define=SC.Locale.define;d.options=SC.Locale.options;d.toString=SC.Locale.toString;
return d}});SC.Locale.locales={en:SC.Locale.extend({_deprecatedLanguageCodes:["English"]}),fr:SC.Locale.extend({_deprecatedLanguageCodes:["French"]}),de:SC.Locale.extend({_deprecatedLanguageCodes:["German"]}),ja:SC.Locale.extend({_deprecatedLanguageCodes:["Japanese","jp"]}),es:SC.Locale.extend({_deprecatedLanguageCodes:["Spanish"]})};
SC.stringsFor=function(g,e){var d=SC.Locale.localeClassFor(g);d.addStrings(e);return this
};SC.Math=SC.Object.create({near:function(g,e,d){if(!d){d=0.00001}return Math.abs(g-e)<=d
},round:function(h,d){if(!d){d=0}var e=Math.pow(10,d);if(d<0){var g=e.toString();
e=g.substring(0,g.indexOf("1")+1)}h=h.valueOf();return Math.round(h*e)/e}});SC.Page=SC.Object.extend({owner:null,get:function(d){var e=this[d];
if(e&&e.isClass){this[d]=e=e.create({page:this});if(!this.get("inDesignMode")){e.awake()
}return e}else{return arguments.callee.base.apply(this,arguments)}},awake:function(){var e,d;
for(d in this){if(!this.hasOwnProperty(d)){continue}e=this[d];if(e&&e.isViewClass){this[d]=e=e.create({page:this})
}}return this},getIfConfigured:function(e){var d=this[e];return(d&&d.isViewClass)?null:this.get(e)
},loc:function(g){var d,e;for(e in g){if(!g.hasOwnProperty(e)){continue}d=this[e];
if(!d||!d.isViewClass){continue}d.loc(g[e])}return this}});SC.Page.design=SC.Page.create;
SC.Page.localization=function(d){return d};SC.platform={touch:("createTouch" in document),input:{placeholder:(function(){return"placeholder" in document.createElement("input")
})()}};sc_require("system/event");SC.mixin({_isReadyBound:NO,_bindReady:function(){if(this._isReadyBound){return
}this._isReadyBound=YES;if(document.addEventListener&&!SC.browser.opera){document.addEventListener("DOMContentLoaded",SC._didBecomeReady,NO)
}if(SC.browser.msie&&(window===top)){(function(){if(SC.isReady){return}try{document.documentElement.doScroll("left")
}catch(d){setTimeout(arguments.callee,0);return}SC._didBecomeReady()})()}if(SC.browser.opera){document.addEventListener("DOMContentLoaded",function(){if(SC.isReady){return
}for(var d=0;d<document.styleSheets.length;d++){if(document.styleSheets[d].disabled){setTimeout(arguments.callee,0);
return}}SC._didBecomeReady()},NO)}if(SC.browser.safari&&SC.browser.safari<530){console.error("ready() is not yet supported on Safari 3.1 and earlier")
}SC.Event.add(window,"load",SC._didBecomeReady)},_readyQueue:[],_afterReadyQueue:[],isReady:NO,_didBecomeReady:function(){if(SC.isReady){return
}if(typeof SC.mapDisplayNames===SC.T_FUNCTION){SC.mapDisplayNames()}if(typeof SC.addInvokeOnceLastDebuggingInfo===SC.T_FUNCTION){SC.addInvokeOnceLastDebuggingInfo()
}SC.Locale.createCurrentLocale();if(document&&document.getElementsByTagName){var h=document.getElementsByTagName("body")[0];
if(h){var l=h.className;var g=SC.Locale.currentLanguage.toLowerCase();h.className=(l&&l.length>0)?[l,g].join(" "):g
}}SC.Benchmark.start("ready");SC.RunLoop.begin();var n,e,m,j;do{e=SC._readyQueue;
SC._readyQueue=[];for(m=0,j=e.length;m<j;m++){n=e[m];var k=n[0]||document;var d=n[1];
if(d){d.call(k)}}}while(SC._readyQueue.length>0);SC.isReady=YES;SC._readyQueue=null;
SC.Event.trigger("ready",null,document,NO);if(SC.removeLoading){SC.$("#loading").remove()
}if(SC.userDefaults.get("ready")){if((SC.mode===SC.APP_MODE)&&(typeof main!="undefined")&&(main instanceof Function)&&!SC.suppressMain){main()
}}else{SC.userDefaults.readyCallback(window,main)}SC.RunLoop.end();SC.Benchmark.end("ready");
SC.Benchmark.log()},ready:function(e,g){var d=this._readyQueue;if(g===undefined){g=e;
e=null}else{if(SC.typeOf(g)===SC.T_STRING){g=e[g]}}if(!g){return this}if(this.isReady){return g.call(e||document)
}d.push([e,g]);return this}});SC._bindReady();SC.removeLoading=YES;SC.APP_MODE="APP_MODE";
SC.TEST_MODE="TEST_MODE";SC.mode=SC.APP_MODE;sc_require("system/builder");SC.MODE_REPLACE="replace";
SC.MODE_APPEND="append";SC.MODE_PREPEND="prepend";SC.RenderContext=SC.Builder.create({SELF_CLOSING:SC.CoreSet.create().addEach("area base basefront br hr input img link meta".w()),init:function(e,d){if(e===undefined){e="div"
}if(d){this.prevObject=d;this.strings=d.strings;this.offset=d.length+d.offset}if(!this.strings){this.strings=[]
}this.needsContent=YES;if(SC.typeOf(e)===SC.T_STRING){this._tagName=e.toLowerCase();
this._needsTag=YES;var g=this;while(g){g.length++;g=g.prevObject}this.strings.push(null);
this._selfClosing=this.SELF_CLOSING.contains(this._tagName)}else{this._elem=e;this._needsTag=NO;
this.length=0;this.needsContent=NO}return this},strings:null,offset:0,length:0,updateMode:SC.MODE_REPLACE,needsContent:NO,get:function(e){var d=this.strings||[];
return(e===undefined)?d.slice(this.offset,this.length):d[e+this.offset]},push:function(g){var e=this.strings,d=arguments.length;
if(!e){this.strings=e=[]}if(d>1){e.push.apply(e,arguments)}else{e.push(g)}var h=this;
while(h){h.length+=d;h=h.prevObject}this.needsContent=YES;return this},text:function(g){var e=arguments.length,d=0;
for(d=0;d<e;d++){this.push(SC.RenderContext.escapeHTML(arguments[d]))}return this
},join:function(e){if(this._needsTag){this.end()}var d=this.strings;return d?d.join(e||""):""
},begin:function(d){return SC.RenderContext(d,this)},element:function(){if(this._elem){return this._elem
}var d,e;if(!SC.RenderContext.factory){SC.RenderContext.factory=document.createElement("div")
}SC.RenderContext.factory.innerHTML=this.join();if(SC.RenderContext.factory.innerHTML.length>0){e=SC.RenderContext.factory.firstChild.cloneNode(true);
SC.RenderContext.factory.innerHTML=""}else{e=null}return e},remove:function(d){if(!d){return
}var e,g=this._elem;if(!g||!g.removeChild){return}e=document.getElementById(d);if(e){e=g.removeChild(e);
e=null}},update:function(){var d=this._elem,j=this.updateMode,n,l,p,g,m,h,k;this._innerHTMLReplaced=NO;
if(!d){return}if(this.length>0){this._innerHTMLReplaced=YES;if(j===SC.MODE_REPLACE){d.innerHTML=this.join()
}else{g=d.cloneNode(false);g.innerHTML=this.join();k=(j===SC.MODE_APPEND)?null:d.firstChild;
m=g.firstChild;while(m){h=m.nextSibling;d.insertBefore(m,h);m=h}m=h=g=k=null}}if(this._attrsDidChange&&(l=this._attrs)){for(n in l){if(!l.hasOwnProperty(n)){continue
}if(l[n]===null){d.removeAttribute(n)}else{SC.$(d).attr(n,l[n])}}}if(this._classNamesDidChange&&(l=this._classNames)){SC.$(d).attr("class",l.join(" "))
}if(this._idDidChange&&(l=this._id)){SC.$(d).attr("id",l)}if(this._stylesDidChange&&(p=this._styles)){var e=this._STYLE_PAIR_ARRAY,o=this._JOIN_ARRAY;
for(n in p){if(!p.hasOwnProperty(n)){continue}l=p[n];if(l===null){continue}if(typeof l===SC.T_NUMBER){l=l.toString()+"px"
}e[0]=n.dasherize();e[1]=l;o.push(e.join(": "))}SC.$(d).attr("style",o.join("; "));
o.length=0}d=this._elem=null;return this.prevObject||this},_DEFAULT_ATTRS:{},_TAG_ARRAY:[],_JOIN_ARRAY:[],_STYLE_PAIR_ARRAY:[],end:function(){var p=this._TAG_ARRAY,e,n,l,m=this._attrs,g=this._classNames,d=this._id,o=this._styles;
p[0]="<";p[1]=this._tagName;if(m||g||o||d){if(!m){m=this._DEFAULT_ATTRS}if(d){m.id=d
}if(g){m["class"]=g.join(" ")}if(o){n=this._JOIN_ARRAY;e=this._STYLE_PAIR_ARRAY;for(l in o){if(!o.hasOwnProperty(l)){continue
}e[0]=l.dasherize();e[1]=o[l];if(e[1]===null){continue}if(typeof e[1]===SC.T_NUMBER){e[1]=e[1]+"px"
}n.push(e.join(": "))}m.style=n.join("; ");n.length=0}p.push(" ");for(l in m){if(!m.hasOwnProperty(l)){continue
}if(m[l]===null){continue}p.push(l,'="',m[l],'" ')}if(m===this._DEFAULT_ATTRS){delete m.style;
delete m["class"];delete m.id}}var k=this.strings;var j=(this._selfClosing===NO)?NO:(this.length===1);
p.push(j?" />":">");k[this.offset]=p.join("");p.length=0;if(!j){p[0]="</";p[1]=this._tagName;
p[2]=">";k.push(p.join(""));var h=this;while(h){h.length++;h=h.prevObject}p.length=0
}this._elem=null;return this.prevObject||this},tag:function(d,e){return this.begin(d,e).end()
},tagName:function(d){if(d===undefined){if(!this._tagName&&this._elem){this._tagName=this._elem.tagName
}return this._tagName}else{this._tagName=d;this._tagNameDidChange=YES;return this
}},id:function(d){if(d===undefined){if(!this._id&&this._elem){this._id=this._elem.id
}return this._id}else{this._id=d;this._idDidChange=YES;return this}},classNames:function(e,d){if(e===undefined){if(!this._classNames&&this._elem){this._classNames=(SC.$(this._elem).attr("class")||"").split(" ")
}if(this._cloneClassNames){this._classNames=(this._classNames||[]).slice();this._cloneClassNames=NO
}if(!this._classNames){this._classNames=[]}return this._classNames}else{this._classNames=e;
this._cloneClassNames=d||NO;this._classNamesDidChange=YES;return this}},hasClass:function(d){return this.classNames().indexOf(d)>=0
},addClass:function(h){if(h===undefined||h===null){console.warn("You are adding an undefined or empty class"+this.toString());
return this}var j=this.classNames();if(SC.typeOf(h)===SC.T_STRING){if(j.indexOf(h)<0){j.push(h);
this._classNamesDidChange=YES}}else{for(var g=0,d=h.length;g<d;g++){var e=h[g];if(j.indexOf(e)<0){j.push(e);
this._classNamesDidChange=YES}}}return this},removeClass:function(e){var g=this._classNames,d;
if(!g&&this._elem){g=this._classNames=(SC.$(this._elem).attr("class")||"").split(" ")
}if(g&&(d=g.indexOf(e))>=0){if(this._cloneClassNames){g=this._classNames=g.slice();
this._cloneClassNames=NO}g[d]=null;this._classNamesDidChange=YES}return this},resetClassNames:function(){this._classNames=[];
this._classNamesDidChange=YES;return this},setClass:function(h,g){var k,d,e,j;if(g!==undefined){return g?this.addClass(h):this.removeClass(h)
}else{k=this._classNames;if(!k&&this._elem){k=this._classNames=(SC.$(this._elem).attr("class")||"").split(" ")
}if(!k){k=this._classNames=[]}if(this._cloneClassNames){k=this._classNames=k.slice();
this._cloneClassNames=NO}j=NO;for(e in h){if(!h.hasOwnProperty(e)){continue}d=k.indexOf(e);
if(h[e]){if(d<0){k.push(e);j=YES}}else{if(d>=0){k[d]=null;j=YES}}}if(j){this._classNamesDidChange=YES
}}return this},_STYLE_REGEX:/\s*([^:\s]+)\s*:\s*([^;]+)\s*;?/g,styles:function(h,j){var d,g,e;
if(h===undefined){if(!this._styles&&this._elem){d=SC.$(this._elem).attr("style");
if(d&&(d=d.toString()).length>0){if(SC.browser.msie){d=d.toLowerCase()}h={};g=this._STYLE_REGEX;
g.lastIndex=0;while(e=g.exec(d)){h[e[1].camelize()]=e[2]}this._styles=h;this._cloneStyles=NO
}else{this._styles={}}}else{if(!this._styles){this._styles={}}else{if(this._cloneStyles){this._styles=SC.beget(this._styles);
this._cloneStyles=NO}}}return this._styles}else{this._styles=h;this._cloneStyles=j||NO;
this._stylesDidChange=YES;return this}},addStyle:function(d,j){var e,h=NO,g=this.styles();
if(typeof d===SC.T_STRING){if(j===undefined){return g[d]}else{if(g[d]!==j){g[d]=j;
this._stylesDidChange=YES}}}else{for(e in d){if(!d.hasOwnProperty(e)){continue}j=d[e];
if(g[e]!==j){g[e]=j;h=YES}}if(h){this._stylesDidChange=YES}}return this},removeStyle:function(d){if(!this._styles&&!this._elem){return this
}var e=this.styles();if(e[d]){e[d]=null;this._stylesDidChange=YES}},attr:function(d,j){var g,e=this._attrs,h=NO;
if(!e){this._attrs=e={}}if(typeof d===SC.T_STRING){if(j===undefined){return e[d]}else{if(e[d]!==j){e[d]=j;
this._attrsDidChange=YES}}}else{for(g in d){if(!d.hasOwnProperty(g)){continue}j=d[g];
if(e[g]!==j){e[g]=j;h=YES}}if(h){this._attrsDidChange=YES}}return this}});SC.RenderContext.fn.html=SC.RenderContext.fn.push;
SC.RenderContext.fn.css=SC.RenderContext.fn.addStyle;if(!SC.browser.isSafari||parseInt(SC.browser.version,10)<526){SC.RenderContext._safari3=YES
}SC.RenderContext.escapeHTML=function(h){var g,e,d;if(SC.none(h)){return h}g=this.escapeHTMLElement;
if(!g){g=this.escapeHTMLElement=document.createElement("div")}e=this.escapeTextNode;
if(!e){e=this.escapeTextNode=document.createTextNode("");g.appendChild(e)}e.data=h;
d=g.innerHTML;if(SC.RenderContext._safari3){d=d.replace(/>/g,"&gt;")}e=g=null;return d
};sc_require("system/response");SC.Request=SC.Object.extend(SC.Copyable,SC.Freezable,{isAsynchronous:YES,isJSON:NO,isXML:NO,init:function(){arguments.callee.base.apply(this,arguments);
this.header("X-Requested-With","XMLHttpRequest");this.header("X-SproutCore-Version","1.0")
},headers:function(){var d=this._headers;if(!d){d=this._headers={}}return d}.property().cacheable(),responseClass:SC.XHRResponse,source:null,address:null,type:"GET",timeout:null,body:null,encodedBody:function(){var d=this.get("body");
if(d&&this.get("isJSON")){d=SC.json.encode(d)}return d}.property("isJSON","isXML","body").cacheable(),willSend:function(e,d){},didSend:function(e,d){},willReceive:function(e,d){},didReceive:function(e,d){},didTimeout:function(e,d){},COPY_KEYS:"isAsynchronous isJSON isXML address type timeout body responseClass willSend didSend willReceive didReceive".w(),copy:function(){var d={},h=this.COPY_KEYS,k=h.length,e,g,j;
while(--k>=0){e=h[k];if(this.hasOwnProperty(e)){d[e]=this.get(e)}}if(this.hasOwnProperty("listeners")){d.listeners=SC.copy(this.get("listeners"))
}if(this.hasOwnProperty("_headers")){d._headers=SC.copy(this._headers)}d.source=this.get("source")||this;
return this.constructor.create(d)},header:function(d,e){var g;if(SC.typeOf(d)===SC.T_STRING){g=this._headers;
if(arguments.length===1){return g?g[d]:null}else{this.propertyWillChange("headers");
if(!g){g=this._headers={}}g[d]=e;this.propertyDidChange("headers");return this}}else{if(e===undefined){g=d;
this.beginPropertyChanges();for(d in g){if(!g.hasOwnProperty(d)){continue}this.header(d,g[d])
}this.endPropertyChanges();return this}}return this},async:function(d){if(d===undefined){d=YES
}return this.set("isAsynchronous",d)},json:function(d){if(d===undefined){d=YES}if(d){this.set("isXML",NO)
}return this.set("isJSON",d)},xml:function(d){if(d===undefined){d=YES}if(d){this.set("isJSON",NO)
}return this.set("isXML",d)},_prep:function(){var d=!!this.header("Content-Type");
if(this.get("isJSON")&&!d){this.header("Content-Type","application/json")}else{if(this.get("isXML")&&!d){this.header("Content-Type","text/xml")
}}return this},send:function(d){var e=this.get("timeout");if(e){if(!this.get("isAsynchronous")){throw"Timeout values cannot be used with synchronous requests"
}}else{if(e===0){throw"The timeout value must either not be specified or must be greater than 0"
}}if(d){this.set("body",d)}return SC.Request.manager.sendRequest(this.copy()._prep())
},resend:function(){var d=this.get("source")?this:this.copy()._prep();return SC.Request.manager.sendRequest(d)
},notify:function(d,j,h,k){var g=YES;if(SC.typeOf(d)!==SC.T_NUMBER){k=SC.A(arguments).slice(2);
h=j;j=d;d=0;g=NO}else{k=SC.A(arguments).slice(3)}var e=this.get("listeners");if(!e){this.set("listeners",e={})
}e[d]={target:j,action:h,params:k};return this}});SC.Request.mixin({getUrl:function(d){return this.create().set("address",d).set("type","GET")
},postUrl:function(e,d){var g=this.create().set("address",e).set("type","POST");if(d){g.set("body",d)
}return g},deleteUrl:function(d){return this.create().set("address",d).set("type","DELETE")
},putUrl:function(e,d){var g=this.create().set("address",e).set("type","PUT");if(d){g.set("body",d)
}return g}});SC.Request.manager=SC.Object.create(SC.DelegateSupport,{maxRequests:6,inflight:[],pending:[],sendRequest:function(e){if(!e){return null
}var d=e.get("responseClass").create({request:e});this.get("pending").pushObject(d);
this.fireRequestIfNeeded();return d},cancel:function(e){var h=this.get("pending"),g=this.get("inflight"),d;
if(h.indexOf(e)>=0){this.propertyWillChange("pending");h.removeObject(e);this.propertyDidChange("pending");
return YES}else{if(g.indexOf(e)>=0){e.cancel();g.removeObject(e);this.fireRequestIfNeeded();
return YES}else{return NO}}},cancelAll:function(){if(this.get("pending").length||this.get("inflight").length){this.set("pending",[]);
this.get("inflight").forEach(function(d){d.cancel()});this.set("inflight",[]);return YES
}else{return NO}},fireRequestIfNeeded:function(){var h=this.get("pending"),g=this.get("inflight"),d=this.get("maxRequests"),e;
if((h.length>0)&&(g.length<d)){e=h.shiftObject();g.pushObject(e);e.fire()}},transportDidClose:function(d){this.get("inflight").removeObject(d);
this.fireRequestIfNeeded()}});SC.Responder=SC.Object.extend({isResponder:YES,pane:null,responderContext:null,nextResponder:null,isFirstResponder:NO,hasFirstResponder:NO,acceptsFirstResponder:YES,becomingFirstResponder:NO,becomeFirstResponder:function(){var d=this.get("pane")||this.get("responderContext")||this.pane();
if(d&&this.get("acceptsFirstResponder")){if(d.get("firstResponder")!==this){d.makeFirstResponder(this)
}}return this},resignFirstResponder:function(d){var e=this.get("pane")||this.get("responderContext");
if(e&&(e.get("firstResponder")===this)){e.makeFirstResponder(null,d)}return YES},willLoseFirstResponder:function(d){},didBecomeFirstResponder:function(d){}});
SC.Response=SC.Object.extend({isError:NO,errorValue:function(){return this}.property().cacheable(),errorObject:null,request:null,originalRequest:function(){var d=this.get("request");
while(d.get("source")){d=d.get("source")}return d}.property("request").cacheable(),type:function(){return this.getPath("request.type")
}.property("request").cacheable(),address:function(){return this.getPath("request.address")
}.property("request").cacheable(),isJSON:function(){return this.getPath("request.isJSON")||NO
}.property("request").cacheable(),isXML:function(){return this.getPath("request.isXML")||NO
}.property("request").cacheable(),listeners:function(){return this.getPath("request.listeners")
}.property("request").cacheable(),status:-100,headers:null,encodedBody:null,body:function(){var d=this.get("encodedBody");
if(d&&this.get("isJSON")){try{d=SC.json.decode(d)}catch(g){return SC.Error.create({message:g.name+": "+g.message,label:"Response",errorValue:this})
}}return d}.property("encodedBody").cacheable(),response:function(){return this.get("body")
}.property("body").cacheable(),isCancelled:NO,timedOut:null,timeoutTimer:null,fire:function(){var d=this.get("request"),g=d?d.get("source"):null;
if(g&&g.willSend){g.willSend(d,this)}d.freeze();if(!this.get("isCancelled")){this.invokeTransport()
}var e=d.get("timeout");if(e){var h=SC.Timer.schedule({target:this,action:"timeoutReached",interval:e,repeats:NO});
this.set("timeoutTimer",h)}if(!this.get("isCancelled")&&g&&g.didSend){g.didSend(d,this)
}},invokeTransport:function(){this.receive(function(d){this.set("status",200)},this)
},receive:function(j,d){if(!this.get("timedOut")){var h=this.get("timeoutTimer");
if(h){h.invalidate()}this.set("timedOut",NO);var e=this.get("request");var g=e?e.get("source"):null;
SC.RunLoop.begin();if(g&&g.willReceive){g.willReceive(e,this)}j.call(d,!this.get("isCancelled"));
if(!this.get("isCancelled")&&g&&g.didReceive){g.didReceive(e,this)}if(!this.get("isCancelled")){this.notify()
}SC.RunLoop.end()}SC.Request.manager.transportDidClose(this);return this},cancel:function(){if(!this.get("isCancelled")){this.set("isCancelled",YES);
this.cancelTransport();SC.Request.manager.transportDidClose(this)}},timeoutReached:function(){if(this.get("timedOut")===null){this.set("timedOut",YES);
this.cancelTransport();SC.Request.manager.transportDidClose(this);var d=SC.$error("HTTP Request timed out","Request",408);
d.set("errorValue",this);this.set("isError",YES);this.set("errorObject",d);var e=this.get("request");
var g=e?e.get("source"):null;if(!this.get("isCancelled")&&g&&g.didTimeout){g.didTimeout(e,this)
}}},cancelTransport:function(){},_notifyListener:function(e,d){var j=e[d],k,h,g;if(!j){return NO
}k=(j.params||[]).copy();k.unshift(this);h=j.target;g=j.action;if(SC.typeOf(g)===SC.T_STRING){g=h[g]
}return g.apply(h,k)},notify:function(){var e=this.get("listeners"),d=this.get("status"),g=Math.floor(d/100)*100,h=NO;
if(!e){return this}h=this._notifyListener(e,d);if(!h){h=this._notifyListener(e,g)
}if(!h){h=this._notifyListener(e,0)}return this},toString:function(){var d=arguments.callee.base.apply(this,arguments);
return"%@<%@ %@, status=%@".fmt(d,this.get("type"),this.get("address"),this.get("status"))
}});SC.XHRResponse=SC.Response.extend({headers:function(){var g=this.get("rawRequest"),e=g?g.getAllResponseHeaders():null,d={};
if(!e){return d}e.split("\n").forEach(function(l){var h=l.indexOf(":"),j,k;if(h>=0){j=l.slice(0,h);
k=l.slice(h+1).trim();d[j]=k}},this);return d}.property("status").cacheable(),header:function(d){var e=this.get("rawRequest");
return e?e.getResponseHeader(d):null},encodedBody:function(){var e=this.get("rawRequest"),d;
if(!e){d=null}else{if(this.get("isXML")){d=e.responseXML}else{d=e.responseText}}return d
}.property("status").cacheable(),cancelTransport:function(){var d=this.get("rawRequest");
if(d){d.abort()}this.set("rawRequest",null)},invokeTransport:function(){var h,l,e,g,k;
function j(){for(var m=0;m<arguments.length;m++){try{var n=arguments[m]();return n
}catch(o){}}return NO}h=j(function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Msxml2.XMLHTTP")
},function(){return new ActiveXObject("Microsoft.XMLHTTP")});this.set("rawRequest",h);
g=!!this.getPath("request.isAsynchronous");if(g){if(!SC.browser.msie){SC.Event.add(h,"readystatechange",this,this.finishRequest,h)
}else{l=this;e=function(){if(!l){return null}var m=l.finishRequest();if(m){l=null
}return m};h.onreadystatechange=e}}h.open(this.get("type"),this.get("address"),g);
k=this.getPath("request.headers");for(var d in k){h.setRequestHeader(d,k[d])}h.send(this.getPath("request.encodedBody"));
if(!g){this.finishRequest()}return h},finishRequest:function(g){var j=this.get("rawRequest"),d=j.readyState,h,e,k;
if(d===4){this.receive(function(l){if(!l){return}e=-1;try{e=j.status||0}catch(n){}if((e<200)||(e>=300)){try{k=j.statusText||""
}catch(m){k=""}h=SC.$error(k||"HTTP Request failed","Request",e);h.set("errorValue",this);
this.set("isError",YES);this.set("errorObject",h)}this.set("status",e)},this);j.onreadystatechange=function(){};
return YES}return NO}});require("system/ready");SC.CAPTURE_BACKSPACE_KEY=NO;SC.RootResponder=SC.Object.extend({panes:null,init:function(){arguments.callee.base.apply(this,arguments);
this.panes=SC.Set.create()},mainPane:null,makeMainPane:function(e){var d=this.get("mainPane");
if(d===e){return this}this.beginPropertyChanges();if(this.get("keyPane")===d){this.makeKeyPane(e)
}this.set("mainPane",e);if(d){d.blurMainTo(e)}if(e){e.focusMainFrom(d)}this.endPropertyChanges();
return this},menuPane:null,makeMenuPane:function(e){if(e&&!e.get("acceptsMenuPane")){return this
}else{var d=this.get("menuPane");if(d===e){return this}this.set("menuPane",e)}return this
},keyPane:null,previousKeyPanes:[],makeKeyPane:function(k){var j,d,h;if(k){if(!k.get("acceptsKeyPane")){return this
}else{d=this.get("keyPane");if(d===k){return this}else{if(d){h=this.get("previousKeyPanes");
h.push(d)}j=k}}}else{d=this.get("keyPane");h=this.get("previousKeyPanes");j=null;
while(h.length>0){var g=h.pop();if(g.get("isPaneAttached")&&g.get("acceptsKeyPane")){j=g;
break}}}if(!j){var e=this.get("mainPane");if(e&&e.get("acceptsKeyPane")){j=e}}if(d){d.willLoseKeyPaneTo(j)
}if(j){j.willBecomeKeyPaneFrom(d)}this.set("keyPane",j);if(j){j.didBecomeKeyPaneFrom(d)
}if(d){d.didLoseKeyPaneTo(j)}return this},currentWindowSize:null,computeWindowSize:function(){var d;
if(window.innerHeight){d={width:window.innerWidth,height:window.innerHeight}}else{if(document.documentElement&&document.documentElement.clientHeight){d={width:document.documentElement.clientWidth,height:document.documentElement.clientHeight}
}else{if(document.body){d={width:document.body.clientWidth,height:document.body.clientHeight}
}}}return d},resize:function(){this._resize();return YES},_resize:function(){var d=this.computeWindowSize(),e=this.get("currentWindowSize");
this.set("currentWindowSize",d);if(!SC.rectsEqual(d,e)){if(this.panes){SC.RunLoop.begin();
this.panes.invoke("windowSizeDidChange",e,d);SC.RunLoop.end()}}},hasFocus:NO,focus:function(){if(!this.get("hasFocus")){SC.$("body").addClass("sc-focus").removeClass("sc-blur");
SC.RunLoop.begin();this.set("hasFocus",YES);SC.RunLoop.end()}return YES},blur:function(){if(this.get("hasFocus")){SC.$("body").addClass("sc-blur").removeClass("sc-focus");
SC.RunLoop.begin();this.set("hasFocus",NO);SC.RunLoop.end()}return YES},dragDidStart:function(d){this._mouseDownView=d;
this._drag=d},defaultResponder:null,sendAction:function(g,h,e,j,d){h=this.targetForAction(g,h,e,j);
if(h&&h.isResponderContext){return !!h.sendAction(g,e,d)}else{return h&&h.tryToPerform(g,e)
}},_responderFor:function(g,d){var e=g?g.get("defaultResponder"):null;if(g){g=g.get("firstResponder")||g;
do{if(g.respondsTo(d)){return g}}while((g=g.get("nextResponder")))}if(typeof e===SC.T_STRING){e=SC.objectForPropertyPath(e)
}if(!e){return null}else{if(e.isResponderContext){return e}else{if(e.respondsTo(d)){return e
}else{return null}}}},targetForAction:function(e,j,h,k){if(!e||(SC.typeOf(e)!==SC.T_STRING)){return null
}if(j){if(SC.typeOf(j)===SC.T_STRING){j=SC.objectForPropertyPath(j)}if(j){if(j.respondsTo&&!j.respondsTo(e)){j=null
}else{if(SC.typeOf(j[e])!==SC.T_FUNCTION){j=null}}}return j}if(k){return this._responderFor(k,e)
}var d=this.get("keyPane"),g=this.get("mainPane");if(d&&(d!==k)){j=this._responderFor(d,e)
}if(!j&&g&&(g!==d)){j=this._responderFor(g,e)}if(!j&&(j=this.get("defaultResponder"))){if(SC.typeOf(j)===SC.T_STRING){j=SC.objectForPropertyPath(j);
if(j){this.set("defaultResponder",j)}}if(j){if(j.respondsTo&&!j.respondsTo(e)){j=null
}else{if(SC.typeOf(j[e])!==SC.T_FUNCTION){j=null}}}}return j},targetViewForEvent:function(d){return d.target?SC.$(d.target).view()[0]:null
},sendEvent:function(g,d,h){var j,e;SC.RunLoop.begin();if(h){j=h.get("pane")}else{j=this.get("menuPane")||this.get("keyPane")||this.get("mainPane")
}e=(j)?j.sendEvent(g,d,h):null;SC.RunLoop.end();return e},listenFor:function(e,d){e.forEach(function(g){var h=this[g];
if(h){SC.Event.add(d,g,this,h)}},this);d=null;return this},setup:function(){this.listenFor("touchstart touchmove touchend touchcancel".w(),document);
this.listenFor("keydown keyup beforedeactivate mousedown mouseup click dblclick mouseout mouseover mousemove selectstart contextmenu".w(),document).listenFor("resize focus blur".w(),window);
if(this.keypress){if(SC.CAPTURE_BACKSPACE_KEY&&SC.browser.mozilla){var e=this;document.onkeypress=function(j){j=SC.Event.normalizeEvent(j);
return e.keypress.call(e,j)};SC.Event.add(window,"unload",this,function(){document.onkeypress=null
})}else{SC.Event.add(document,"keypress",this,this.keypress)}}"drag selectstart".w().forEach(function(k){var l=this[k];
if(l){if(SC.browser.msie){var j=this;document.body["on"+k]=function(m){return l.call(j,SC.Event.normalizeEvent(event||window.event))
};SC.Event.add(window,"unload",this,function(){document.body["on"+k]=null})}else{SC.Event.add(document,k,this,l)
}}},this);var d=SC.browser.mozilla?"DOMMouseScroll":"mousewheel";SC.Event.add(document,d,this,this.mousewheel);
this.set("currentWindowSize",this.computeWindowSize());this.focus();var g=SC.RunLoop.prototype.endRunLoop,h;
h=function(){if(g){g.apply(this,arguments)}var m=SC.RootResponder.responder._touches,n,j,l,k=NO;
if(m){for(n in m){l=j=m[n].target;while(j&&(j=j.parentElement)&&!k){k=(j===document.body)
}if(!k&&l){if(l.nodeType===3){l=l.parentElement}l.style.display="none";document.body.appendChild(l)
}}}};SC.RunLoop.prototype.endRunLoop=h},_touchedViews:{},_touches:{},touchesForView:function(d){if(this._touchedViews[SC.guidFor(d)]){return this._touchedViews[SC.guidFor(d)].touches
}},averagedTouchesForView:function(k,j){var o=this.touchesForView(k);if((!o||o.length===0)&&!j){return{x:0,y:0,d:0,touchCount:0}
}var g;if(o){g=o.toArray()}else{g=[]}if(j){g.push(j)}var l,h=g.length,e,d=0,s=0,p,n,m=0;
for(l=0;l<h;l++){e=g[l];d+=e.pageX;s+=e.pageY}d/=h;s/=h;for(l=0;l<h;l++){e=g[l];p=Math.abs(e.pageX-d);
n=Math.abs(e.pageY-s);m+=Math.pow(p*p+n*n,0.5)}m/=h;return{x:d,y:s,d:m,touchCount:h}
},assignTouch:function(e,d){if(!this._touchedViews[SC.guidFor(d)]){this._touchedViews[SC.guidFor(d)]={view:d,touches:SC.CoreSet.create([]),touchCount:0};
d.set("hasTouch",YES)}e.view=d;this._touchedViews[SC.guidFor(d)].touches.add(e);this._touchedViews[SC.guidFor(d)].touchCount++
},unassignTouch:function(g){var d,e;if(!g.view){return}d=g.view;e=this._touchedViews[SC.guidFor(d)];
e.touches.remove(g);e.touchCount--;if(e.touchCount<1){d.set("hasTouch",NO);e.view=null;
delete this._touchedViews[SC.guidFor(d)]}g.view=undefined},makeTouchResponder:function(m,h,l){var e=m.touchResponders,g;
if(m.touchResponder===h){return}var k;if(h){k=h.get("pane")}else{k=this.get("keyPane")||this.get("mainPane")
}h=(k)?k.sendEvent("touchStart",m,h):null;if(m.touchResponder===h){return}this.unassignTouch(m);
if(!l||(e.indexOf(h)>-1&&e[e.length-1]!==h)){var d=e.length-1,j=e[d];while(j&&j!==h){g=this.touchesForView(j);
if(j.get("acceptsMultitouch")||!g){j.tryToPerform("touchCancelled",m)}d--;j=e[d];
e.pop();m.touchResponder=e[d];m.nextTouchResponder=e[d-1]}}if(h){this.assignTouch(m,h);
if(h!==m.touchResponder){e.push(h);m.touchResponder=h;m.nextTouchResponder=e[e.length-2]
}}},captureTouch:function(m,j,l){if(!j){j=this}var k=m.targetView,g=k,h=[],e,d;if(SC.LOG_TOUCH_EVENTS){SC.Logger.info("  -- Received one touch on %@".fmt(k.toString()))
}while(g&&(g!==j)){h.unshift(g);g=g.get("nextResponder")}for(d=h.length,e=0;e<d;e++){g=h[e];
if(SC.LOG_TOUCH_EVENTS){SC.Logger.info("  -- Checking %@ for captureTouch response…".fmt(g.toString()))
}if(g.tryToPerform("captureTouch",m)){if(SC.LOG_TOUCH_EVENTS){SC.Logger.info("   -- Making %@ touch responder because it returns YES to captureTouch".fmt(g.toString()))
}this.makeTouchResponder(m,g,l);return}}this.makeTouchResponder(m,k,l)},touchstart:function(n){SC.RunLoop.begin();
try{var m,g=n.changedTouches,h=g.length,k,l,d,o;n.touchContext=this;for(m=0;m<h;m++){d=g[m];
o=SC.Touch.create(d,this);o.timeStamp=n.timeStamp;this._touches[d.identifier]=o;d.event=n;
this.captureTouch(o,this);d.event=null}}catch(j){SC.Logger.warn("Exception during touchStart: %@".fmt(j));
SC.RunLoop.end();return NO}SC.RunLoop.end();return NO},touchmove:function(p){SC.RunLoop.begin();
try{var g=p.changedTouches,d,u,o,h=g.length,n,m,l,s,k={};for(o=0;o<h;o++){d=g[o];
u=this._touches[d.identifier];if(!u){console.log("Received a touchmove for a touch we don't know about. This is bad.");
continue}u.pageX=d.pageX;u.pageY=d.pageY;u.timeStamp=p.timeStamp;u.event=p;if(u.touchResponder){n=u.touchResponder;
if(!k[SC.guidFor(n)]){k[SC.guidFor(n)]={view:n,touches:[]}}k[SC.guidFor(n)].touches.push(u)
}}for(o in k){n=k[o].view;m=k[o].touches;p.viewChangedTouches=m;l=this.touchesForView(n);
s=l.firstObject();p.pageX=s.pageX;p.pageY=s.pageY;p.touchContext=this;n.tryToPerform("touchesDragged",p,l)
}g=p.changedTouches;h=g.length;for(o=0;o<h;o++){u.event=null}}catch(j){SC.Logger.warn("Exception during touchMove: %@".fmt(j))
}SC.RunLoop.end();return NO},touchend:function(s){SC.RunLoop.begin();try{var k=s.changedTouches,j,x,p,l=k.length,n,h=s.isCancel?"touchCancelled":"touchEnd",o,u,d,g;
for(p=0;p<l;p++){j=k[p];x=this._touches[j.identifier];x.timeStamp=s.timeStamp;x.pageX=j.pageX;
x.pageY=j.pageY;this.unassignTouch(x);if(x.touchResponder){d=x.touchResponders;u=d.length-1;
g=d[u];o=h;while(g){g.tryToPerform(o,x,s);u--;g=d[u];o="touchCancelled"}}x.touchResponders=null;
x.touchResponder=null;x.nextTouchResponder=null;delete this._touches[x.identifier]
}}catch(m){SC.Logger.warn("Exception during touchEnd: %@".fmt(m));SC.RunLoop.end();
return NO}SC.RunLoop.end();return NO},touchcancel:function(d){d.isCancel=YES;this.touchend(d)
},attemptKeyEquivalent:function(e){var h=null;var g=e.commandCodes()[0];if(!g){return NO
}var d=this.get("keyPane"),j=this.get("mainPane");if(d){h=d.performKeyEquivalent(g,e);
if(h||d.get("isModal")){return h}}if(!h&&j&&(j!==d)){h=j.performKeyEquivalent(g,e);
if(h||j.get("isModal")){return h}}return h},_lastModifiers:null,_handleModifierChanges:function(e){var d;
d=this._lastModifiers=(this._lastModifiers||{alt:false,ctrl:false,shift:false});var g=false;
if(e.altKey!==d.alt){d.alt=e.altKey;g=true}if(e.ctrlKey!==d.ctrl){d.ctrl=e.ctrlKey;
g=true}if(e.shiftKey!==d.shift){d.shift=e.shiftKey;g=true}e.modifiers=d;return(g)?(this.sendEvent("flagsChanged",e)?e.hasCustomEventHandling:YES):YES
},_isFunctionOrNonPrintableKey:function(d){return !!(d.altKey||d.ctrlKey||d.metaKey||((d.charCode!==d.which)&&SC.FUNCTION_KEYS[d.which]))
},_isModifierKey:function(d){return !!SC.MODIFIER_KEYS[d.charCode]},keydown:function(d){if(SC.none(d)){return YES
}if(d.keyCode===229){this._IMEInputON=YES;return YES}if(SC.browser.mozilla&&(d.which===8)){return true
}var e=this._handleModifierChanges(d),h=d.target||d.srcElement,g=(d.which===8)&&!SC.allowsBackspaceToPreviousPage&&(h===document.body);
if(this._isModifierKey(d)){return(g?NO:e)}e=YES;if(this._isFunctionOrNonPrintableKey(d)){if(d.keyCode>=37&&d.keyCode<=40&&SC.browser.mozilla){return YES
}e=this.sendEvent("keyDown",d);if(!e){e=!this.attemptKeyEquivalent(d)}else{e=d.hasCustomEventHandling;
if(e){g=NO}}}return g?NO:e},keypress:function(e){var g,j=e.keyCode,k=!!SC.browser.mozilla;
if(k&&(e.which===8)){e.which=j;g=this.sendEvent("keyDown",e);return g?(SC.allowsBackspaceToPreviousPage||e.hasCustomEventHandling):YES
}else{var h=(j>=37&&j<=40&&k),d=e.charCode;if((d!==undefined&&d===0)&&!h){return YES
}if(h){e.which=j}return this.sendEvent("keyDown",e)?e.hasCustomEventHandling:YES}},keyup:function(d){if(this._ffevt){this._ffevt=null
}var e=this._handleModifierChanges(d);if(this._isModifierKey(d)){return e}if(this._IMEInputON&&d.keyCode===13){d.isIMEInput=YES;
this.sendEvent("keyDown",d);this._IMEInputON=NO}return this.sendEvent("keyUp",d)?d.hasCustomEventHandling:YES
},beforedeactivate:function(g){var e=g.toElement;if(e&&e.tagName&&e.tagName!=="IFRAME"){var d=SC.$(e).view()[0];
if(d&&!d.get("acceptsKeyPane")&&!d.get("acceptsFirstResponder")){return NO}}return YES
},mousedown:function(k){try{if(!SC.browser.msie){window.focus()}else{if(k.target&&k.target.focus){k.target.focus()
}}this._clickCount+=1;if(!this._lastMouseUpAt||((Date.now()-this._lastMouseUpAt)>200)){this._clickCount=1
}else{var j=this._lastMouseDownX-k.clientX,d=this._lastMouseDownY-k.clientY,m=Math.sqrt(j*j+d*d);
if(m>8){this._clickCount=1}}k.clickCount=this._clickCount;this._lastMouseDownX=k.clientX;
this._lastMouseDownY=k.clientY;var h,g=this.targetViewForEvent(k);if(g){h=g.getPath("pane.firstResponder")
}if(h&&h.kindOf(SC.InlineTextFieldView)&&h!==g){h.resignFirstResponder()}g=this._mouseDownView=this.sendEvent("mouseDown",k,g);
if(g&&g.respondsTo("mouseDragged")){this._mouseCanDrag=YES}}catch(l){console.warn("Exception during mousedown: %@".fmt(l));
this._mouseDownView=null;this._mouseCanDrag=NO;throw l}return g?k.hasCustomEventHandling:YES
},mouseup:function(g){this.targetViewForEvent(g);try{if(this._drag){this._drag.tryToPerform("mouseUp",g);
this._drag=null}var j=null,d=this._mouseDownView,h=this.targetViewForEvent(g);this._lastMouseUpAt=Date.now();
g.clickCount=this._clickCount;if(d){j=this.sendEvent("mouseUp",g,d);if(!j&&(this._clickCount===2)){j=this.sendEvent("doubleClick",g,d)
}if(!j){j=this.sendEvent("click",g,d)}}if(!j){if(this._clickCount===2){j=this.sendEvent("doubleClick",g,h)
}if(!j){j=this.sendEvent("click",g,h)}}this._mouseCanDrag=NO;this._mouseDownView=null
}catch(k){this._drag=null;this._mouseCanDrag=NO;this._mouseDownView=null;throw k}return(j)?g.hasCustomEventHandling:YES
},dblclick:function(d){if(SC.browser.isIE){this._clickCount=2;this.mouseup(d)}},mousewheel:function(g){try{var d=this.targetViewForEvent(g),h=this.sendEvent("mouseWheel",g,d)
}catch(j){throw j}return(h)?g.hasCustomEventHandling:YES},_lastHovered:null,mousemove:function(j){if(SC.browser.msie){if(this._lastMoveX===j.clientX&&this._lastMoveY===j.clientY){return
}}this._lastMoveX=j.clientX;this._lastMoveY=j.clientY;SC.RunLoop.begin();try{this.focus();
if(this._drag){if(SC.browser.msie){if(this._lastMouseDownX!==j.clientX||this._lastMouseDownY!==j.clientY){this._drag.tryToPerform("mouseDragged",j)
}}else{this._drag.tryToPerform("mouseDragged",j)}}else{var h=this._lastHovered||[],k=[],n,m,d,g=this.targetViewForEvent(j);
while(g&&(g!==this)){if(h.indexOf(g)!==-1){g.tryToPerform("mouseMoved",j);k.push(g)
}else{g.tryToPerform("mouseEntered",j);k.push(g)}g=g.get("nextResponder")}for(m=0,d=h.length;
m<d;m++){g=h[m];n=g.respondsTo("mouseExited");if(n&&!(k.indexOf(g)!==-1)){g.tryToPerform("mouseExited",j)
}}this._lastHovered=k;if(this._mouseDownView){if(SC.browser.msie){if(this._lastMouseDownX!==j.clientX&&this._lastMouseDownY!==j.clientY){this._mouseDownView.tryToPerform("mouseDragged",j)
}}else{this._mouseDownView.tryToPerform("mouseDragged",j)}}}}catch(l){throw l}SC.RunLoop.end()
},_mouseCanDrag:YES,selectstart:function(e){var g=this.targetViewForEvent(e),d=this.sendEvent("selectStart",e,g);
if(g&&g.respondsTo("mouseDragged")){return(d!==null?YES:NO)&&!this._mouseCanDrag}else{return(d!==null?YES:NO)
}},drag:function(){return false},contextmenu:function(e){var d=this.targetViewForEvent(e);
return this.sendEvent("contextMenu",e,d)}});SC.Touch=function(e,d){this.touchContext=d;
this.identifier=e.identifier;this.targetView=e.target?SC.$(e.target).view()[0]:null;
this.target=e.target;this.view=undefined;this.touchResponder=this.nextTouchResponder=undefined;
this.touchResponders=[];this.startX=this.pageX=e.pageX;this.startY=this.pageY=e.pageY
};SC.Touch.prototype={allowDefault:function(){this.hasCustomEventHandling=YES},preventDefault:function(){if(this.event){this.event.preventDefault()
}},stopPropagation:function(){if(this.event){this.event.stopPropagation()}},stop:function(){if(this.event){this.event.stop()
}},makeTouchResponder:function(d,e){this.touchContext.makeTouchResponder(this,d,e)
},captureTouch:function(d,e){this.touchContext.captureTouch(this,d,e)},touchesForView:function(d){return this.touchContext.touchesForView(d)
},averagedTouchesForView:function(d,e){return this.touchContext.averagedTouchesForView(d,(e?this:null))
}};SC.mixin(SC.Touch,{create:function(e,d){return new SC.Touch(e,d)}});SC.ready(SC.RootResponder,SC.RootResponder.ready=function(){var d;
d=SC.RootResponder.responder=SC.RootResponder.create();d.setup()});SC.routes=SC.Object.create({_didSetup:NO,_location:null,_firstRoute:null,_extractParametersAndRoute:function(g){var d={},m=g.route||"",j,e,h,l,k,n;
j=(m.indexOf("?")<0&&m.indexOf("&")>=0)?"&":"?";e=m.split(j);m=e[0];if(e.length===1){e=[]
}else{if(e.length===2){e=e[1].split("&")}else{if(e.length>2){e.shift()}}}l=e.length;
for(h=0;h<l;++h){k=e[h].split("=");d[k[0]]=k[1]}for(n in g){if(g.hasOwnProperty(n)&&n!=="route"){d[n]=""+g[n]
}}e=[];for(n in d){e.push([n,d[n]].join("="))}d.params=j+e.join("&");d.route=m;return d
},location:function(e,g){var d;if(g!==undefined){if(g===null){g=""}if(typeof(g)==="object"){d=this._extractParametersAndRoute(g);
g=d.route+d.params}this._location=g;window.location.hash=g===""?"#":encodeURI(g);
return this}return this._location}.property(),ping:function(){var d;if(!this._didSetup){this._didSetup=YES;
if(this.get("supportsOnHashChange")){this.hashChange();SC.Event.add(window,"hashchange",this,this.hashChange)
}else{d=this;this._invokeHashChange=function(){d.hashChange();setTimeout(d._invokeHashChange,100)
};this._invokeHashChange()}}},supportsOnHashChange:function(){return SC.browser.isSafari&&SC.browser.compareVersion(532,1)>=0||SC.browser.isMozilla&&SC.browser.compareVersion(1,9,2)>=0||SC.browser.isIE&&document.documentMode>=8
}.property().cacheable(),hashChange:function(d){var e=window.location.hash;e=(e&&e.length>0)?e.slice(1,e.length):"";
if(!SC.browser.isMozilla){e=decodeURI(e)}if(this.get("location")!==e){SC.RunLoop.begin();
this.set("location",e);SC.RunLoop.end()}},add:function(d,e,g){if(!this._didSetup){this.invokeLast(this.ping)
}if(g===undefined&&SC.typeOf(e)===SC.T_FUNCTION){g=e;e=null}else{if(SC.typeOf(g)===SC.T_STRING){g=e[g]
}}if(!this._firstRoute){this._firstRoute=this._Route.create()}this._firstRoute.add(d.split("/"),e,g);
return this},locationDidChange:function(){var d=this._firstRoute,e=this.get("location"),h,g;
if(d){h=this._extractParametersAndRoute({route:e});e=h.route;delete h.route;delete h.params;
g=d.routeForParts(e.split("/"),h);if(g&&g.target&&g.method){g.method.call(g.target,h)
}}}.observes("location"),_Route:SC.Object.extend({target:null,method:null,staticRoutes:null,dynamicRoutes:null,wildcardRoutes:null,add:function(g,e,j){var d,h;
g=SC.clone(g);if(!g||g.length===0){this.target=e;this.method=j}else{d=g.shift();switch(d.slice(0,1)){case":":d=d.slice(1,d.length);
if(!this.dynamicRoutes){this.dynamicRoutes={}}if(!this.dynamicRoutes[d]){this.dynamicRoutes[d]=this.constructor.create()
}h=this.dynamicRoutes[d];break;case"*":d=d.slice(1,d.length);if(!this.wildcardRoutes){this.wildcardRoutes={}
}h=this.wildcardRoutes[d]=this.constructor.create();break;default:if(!this.staticRoutes){this.staticRoutes={}
}if(!this.staticRoutes[d]){this.staticRoutes[d]=this.constructor.create()}h=this.staticRoutes[d]
}if(h){h.add(g,e,j)}}},routeForParts:function(h,j){var e,g,d;h=SC.clone(h);if(!h||h.length===0){return this.method?this:null
}else{e=h.shift();if(this.staticRoutes&&this.staticRoutes[e]){return this.staticRoutes[e].routeForParts(h,j)
}else{for(g in this.dynamicRoutes){d=this.dynamicRoutes[g].routeForParts(h,j);if(d){j[g]=e;
return d}}for(g in this.wildcardRoutes){h.unshift(e);j[g]=h.join("/");return this.wildcardRoutes[g].routeForParts(null,j)
}return null}}}})});SC.TextSelection=SC.Object.extend(SC.Copyable,SC.Freezable,{start:-1,end:-1,length:function(){var e=this.get("start");
var d=this.get("end");if((e)===-1||(d===-1)){return -1}else{return d-e}}.property("start","end").cacheable(),init:function(){arguments.callee.base.apply(this,arguments);
this.freeze()},copy:function(){return SC.TextSelection.create({start:this.get("start"),end:this.get("end")})
},toString:function(){var d=this.get("length");if(d&&d>0){if(d===1){return"[%@ character selected: {%@, %@}]".fmt(d,this.get("start"),this.get("end"))
}else{return"[%@ characters selected: {%@, %@}]".fmt(d,this.get("start"),this.get("end"))
}}else{return"[no text selected; caret at %@]".fmt(this.get("start"))}}});SC.time=function(d){var e=SC.beget(fn);
e.value=timeOffset;return e};(function(){var d=new Date();SC.mixin(SC.time,{month:function(g,e){d.setTime(g);
if(e===undefined){return d.getMonth()}d.setMonth(e);return d.getTime()},utc:function(e){d.setTime(e);
return e+(d.getTimezoneOffset()*60*1000)},local:function(e){d.setTime(e);return e-(d.getTimezoneOffset()*60*1000)
},parse:function(e){},format:function(e){}})})();SC.time.fmt=SC.time.format;SC.time.fn={done:function(){return this.value
}};"month day year".split(" ").forEach(function(d){SC.time.fn[d]=function(e){if(e===undefined){return SC.time[d](this.value)
}else{this.value=SC.time[d](this.value,e);return this}}});var MONTH_NAMES=new Array("January","February","March","April","May","June","July","August","September","October","November","December","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec");
var DAY_NAMES=new Array("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sun","Mon","Tue","Wed","Thu","Fri","Sat");
function LZ(d){return(d<0||d>9?"":"0")+d}SC.Locale.define("en",{longMonthNames:"January February March April May".split(" "),shortMonthNames:[],shortDateFormat:"dd/mm/yy",longDateFormat:""});
SC.mixin(Date,{now:function(){return new Date().getTime()},isDate:function(g,e){var d=Date.getDateFromFormat(g,e);
if(d==0){return false}return true},compareDates:function(j,k,g,h){var e=Date.getDateFromFormat(j,k);
var d=Date.getDateFromFormat(g,h);if(e==0||d==0){return -1}else{if(e>d){return 1}}return 0
},getDateFromFormat:function(H,A){H=H+"";A=A+"";var G=0;var o=0;var C="";var j="";
var F="";var l,k;var e=new Date();var m=e.getFullYear();var E=e.getMonth()+1;var D=1;
var g=e.getHours();var B=e.getMinutes();var s=e.getSeconds();var n="";var u=SC.Locale.currentLocale;
while(o<A.length){C=A.charAt(o);j="";while((A.charAt(o)==C)&&(o<A.length)){j+=A.charAt(o++)
}if(j=="yyyy"||j=="yy"||j=="y"){if(j=="yyyy"){l=4;k=4}if(j=="yy"){l=2;k=2}if(j=="y"){l=2;
k=4}m=Date._getInt(H,G,l,k);if(m==null){return 0}G+=m.length;if(m.length==2){if(m>70){m=1900+(m-0)
}else{m=2000+(m-0)}}}else{if(j=="MMM"||j=="NNN"){E=0;for(var z=0;z<MONTH_NAMES.length;
z++){var h=MONTH_NAMES[z];if(H.substring(G,G+h.length).toLowerCase()==h.toLowerCase()){if(j=="MMM"||(j=="NNN"&&z>11)){E=z+1;
if(E>12){E-=12}G+=h.length;break}}}if((E<1)||(E>12)){return 0}}else{if(j=="EE"||j=="E"){for(var z=0;
z<DAY_NAMES.length;z++){var p=DAY_NAMES[z];if(H.substring(G,G+p.length).toLowerCase()==p.toLowerCase()){G+=p.length;
break}}}else{if(j=="MM"||j=="M"){E=Date._getInt(H,G,j.length,2);if(E==null||(E<1)||(E>12)){return 0
}G+=E.length}else{if(j=="dd"||j=="d"){D=Date._getInt(H,G,j.length,2);if(D==null||(D<1)||(D>31)){return 0
}G+=D.length}else{if(j=="hh"||j=="h"){g=Date._getInt(H,G,j.length,2);if(g==null||(g<1)||(g>12)){return 0
}G+=g.length}else{if(j=="HH"||j=="H"){g=Date._getInt(H,G,j.length,2);if(g==null||(g<0)||(g>23)){return 0
}G+=g.length}else{if(j=="KK"||j=="K"){g=Date._getInt(H,G,j.length,2);if(g==null||(g<0)||(g>11)){return 0
}G+=g.length}else{if(j=="kk"||j=="k"){g=Date._getInt(H,G,j.length,2);if(g==null||(g<1)||(g>24)){return 0
}G+=g.length;g--}else{if(j=="mm"||j=="m"){B=Date._getInt(H,G,j.length,2);if(B==null||(B<0)||(B>59)){return 0
}G+=B.length}else{if(j=="ss"||j=="s"){s=Date._getInt(H,G,j.length,2);if(s==null||(s<0)||(s>59)){return 0
}G+=s.length}else{if(j=="a"){if(H.substring(G,G+2).toLowerCase()=="am"){n="AM"}else{if(H.substring(G,G+2).toLowerCase()=="pm"){n="PM"
}else{return 0}}G+=2}else{if(H.substring(G,G+j.length)!=j){return 0}else{G+=j.length
}}}}}}}}}}}}}}if(G!=H.length){return 0}if(E==2){if(((m%4==0)&&(m%100!=0))||(m%400==0)){if(D>29){return 0
}}else{if(D>28){return 0}}}if((E==4)||(E==6)||(E==9)||(E==11)){if(D>30){return 0}}if(g<12&&n=="PM"){g=g-0+12
}else{if(g>11&&n=="AM"){g-=12}}var d=new Date(m,E-1,D,g,B,s);return d.getTime()},parseDate:function(p){var n=(arguments.length==2)?arguments[1]:false;
generalFormats=new Array("E NNN dd HH:mm:ss UTC yyyy","y-M-d","y-M-d","MMM d, y","MMM d,y","y-MMM-d","d-MMM-y","MMM d","d MMM y","d.MMM.y","y MMM d","y.MMM.d");
monthFirst=new Array("M/d/y","M-d-y","M.d.y","MMM-d","M/d","M-d");dateFirst=new Array("d/M/y","d-M-y","d.M.y","d-MMM","d/M","d-M");
var g=new Array("generalFormats",n?"dateFirst":"monthFirst",n?"monthFirst":"dateFirst");
var o=null;o=0;var k=new Date().getTime();switch(p.toLowerCase()){case"yesterday".loc():o=k-(24*60*60*1000);
break;case"today".loc():case"now".loc():o=k;break;case"tomorrow".loc():o=k+(24*60*60*1000);
break}if(o>0){return new Date(o)}for(var m=0;m<g.length;m++){var e=window[g[m]];for(var h=0;
h<e.length;h++){o=Date.getDateFromFormat(p,e[h]);if(o==0){o=Date.getDateFromFormat(p,e[h]+" H:m:s")
}if(o==0){o=Date.getDateFromFormat(p,e[h]+" h:m:s a")}if(o!=0){return new Date(o)
}}}return null},_isInteger:function(g){var e="1234567890";for(var d=0;d<g.length;
d++){if(e.indexOf(g.charAt(d))==-1){return false}}return true},_getInt:function(k,h,j,g){for(var d=g;
d>=j;d--){var e=k.substring(h,h+d);if(e.length<j){return null}if(Date._isInteger(e)){return e
}}return null}});SC.mixin(Date.prototype,{format:function(Q){Q=Q+"";var T=this;var u="";
var G=0;var S="";var l="";var p=T.getFullYear()+"";var n=T.getMonth()+1;var R=T.getDate();
var z=T.getDay();var x=T.getHours();var J=T.getMinutes();var B=T.getSeconds();var D,F,g,C,U,j,P,O,L,A,W,x,V,o,e,N;
var I=new Object();if(p.length<4){p=""+(p-0+1900)}I.y=""+p;I.yyyy=p;I.yy=p.substring(2,4);
I.M=n;I.MM=LZ(n);I.MMM=MONTH_NAMES[n-1];I.NNN=MONTH_NAMES[n+11];I.d=R;I.dd=LZ(R);
I.E=DAY_NAMES[z+7];I.EE=DAY_NAMES[z];I.H=x;I.HH=LZ(x);if(x==0){I.h=12}else{if(x>12){I.h=x-12
}else{I.h=x}}I.hh=LZ(I.h);if(x>11){I.K=x-12}else{I.K=x}I.k=x+1;I.KK=LZ(I.K);I.kk=LZ(I.k);
if(x>11){I.a="PM"}else{I.a="AM"}I.m=J;I.mm=LZ(J);I.s=B;I.ss=LZ(B);while(G<Q.length){S=Q.charAt(G);
l="";while((Q.charAt(G)==S)&&(G<Q.length)){l+=Q.charAt(G++)}if(I[l]!=null){u=u+I[l]
}else{u=u+l}}return u},utcFormat:function(){return(new Date(this.getTime()+(this.getTimezoneOffset()*60*1000))).format("E NNN dd HH:mm:ss UTC yyyy")
}});SC.Timer=SC.Object.extend({target:null,action:null,isPooled:NO,interval:0,startTime:null,repeats:NO,until:null,isPaused:NO,isScheduled:NO,isValid:YES,lastFireTime:0,fireTime:function(){if(!this.get("isValid")){return -1
}var j=this.get("startTime");if(!j||j===0){return -1}var d=this.get("interval"),g=this.get("lastFireTime");
if(g<j){g=j}var e;if(this.get("repeats")){if(d===0){e=g}else{e=j+(Math.floor((g-j)/d)+1)*d
}}else{e=j+d}var h=this.get("until");if(h&&h>0&&e>h){e=h}return e}.property("interval","startTime","repeats","until","isValid","lastFireTime").cacheable(),schedule:function(){if(!this.get("isValid")){return this
}this.beginPropertyChanges();if(!this.startTime){this.set("startTime",SC.RunLoop.currentRunLoop.get("startTime"))
}var d=this.get("fireTime"),e=this.get("lastFireTime");if(d>=e){this.set("isScheduled",YES);
SC.RunLoop.currentRunLoop.scheduleTimer(this,d)}this.endPropertyChanges();return this
},invalidate:function(){this.beginPropertyChanges();this.set("isValid",NO);SC.RunLoop.currentRunLoop.cancelTimer(this);
this.action=this.target=null;this.endPropertyChanges();if(this.get("isPooled")){SC.Timer.returnTimerToPool(this)
}return this},fire:function(){var e=Date.now();this.set("lastFireTime",e);var d=this.get("fireTime");
if(!this.get("isPaused")){this.performAction()}if(d>e){this.schedule()}else{this.invalidate()
}},performAction:function(){var d=SC.typeOf(this.action);if(d==SC.T_FUNCTION){this.action.call((this.target||this),this)
}else{if(d===SC.T_STRING){if(this.action.indexOf(".")>=0){var j=this.action.split(".");
var g=j.pop();var h=SC.objectForPropertyPath(j,window);var e=h.get?h.get(g):h[g];
if(e&&SC.typeOf(e)==SC.T_FUNCTION){e.call(h,this)}else{throw"%@: Timer could not find a function at %@".fmt(this,this.action)
}}else{SC.RootResponder.responder.sendAction(this.action,this.target,this)}}}},init:function(){arguments.callee.base.apply(this,arguments);
if(this.startTime instanceof Date){this.startTime=this.startTime.getTime()}if(this.until instanceof Date){this.until=this.until.getTime()
}},RESET_DEFAULTS:{target:null,action:null,isPooled:NO,isPaused:NO,isScheduled:NO,isValid:YES,interval:0,repeats:NO,until:null,startTime:null,lastFireTime:0},reset:function(e){if(!e){e=SC.EMPTY_HASH
}this.propertyWillChange("fireTime");var g=this.RESET_DEFAULTS;for(var d in g){if(!g.hasOwnProperty(d)){continue
}this[d]=SC.none(e[d])?g[d]:e[d]}this.propertyDidChange("fireTime");return this},removeFromTimerQueue:function(g){var e=this._timerQueuePrevious,d=this._timerQueueNext;
if(!e&&!d&&g!==this){return g}if(e){e._timerQueueNext=d}if(d){d._timerQueuePrevious=e
}this._timerQueuePrevious=this._timerQueueNext=null;return(g===this)?d:g},scheduleInTimerQueue:function(g,e){this._timerQueueRunTime=e;
var d=g;var h=null;while(d&&d._timerQueueRunTime<e){h=d;d=d._timerQueueNext}if(h){h._timerQueueNext=this;
this._timerQueuePrevious=h}if(d){d._timerQueuePrevious=this;this._timerQueueNext=d
}return(d===g)?this:g},collectExpiredTimers:function(g,d){if(this._timerQueueRunTime>d){return this
}g.push(this);var e=this._timerQueueNext;this._timerQueueNext=null;if(e){e._timerQueuePrevious=null
}return e?e.collectExpiredTimers(g,d):null}});SC.Timer.schedule=function(d){var e;
if(!d||SC.none(d.isPooled)||d.isPooled){e=this.timerFromPool(d)}else{e=this.create(d)
}return e.schedule()};SC.Timer.timerFromPool=function(d){var e=this._timerPool;if(!e){e=this._timerPool=[]
}var g=e.pop();if(!g){g=this.create()}return g.reset(d)};SC.Timer.returnTimerToPool=function(d){if(!this._timerPool){this._timerPool=[]
}this._timerPool.push(d);return this};SC.UserDefaults=SC.Object.extend({ready:NO,userDomain:null,appDomain:null,_defaults:null,_safari3DB:null,defaults:function(d){this._defaults=d;
this.allPropertiesDidChange()},readDefault:function(m){var h=undefined,d,n,l,o,k;
m=this._normalizeKeyName(m);d=this._userKeyName(m);if(this._written){h=this._written[d]
}if(SC.browser.msie=="7.0"){n=document.body;try{n.load("SC.UserDefaults")}catch(g){console.err("Couldn't load userDefaults in IE7: "+g.description)
}}else{if(this.HTML5DB_noLocalStorage){k=this._safari3DB}else{n=window.localStorage;
if(!n&&window.globalStorage){n=window.globalStorage[window.location.hostname]}}}if(n||k){l=["SC.UserDefaults",d].join("-at-");
if(SC.browser.msie=="7.0"){h=n.getAttribute(l.replace(/\W/gi,""))}else{if(k){h=this.dataHash[l]
}else{h=n[l]}}if(!SC.none(h)){try{h=SC.json.decode(h)}catch(j){h=undefined}}else{h=undefined
}}o=this.delegate;if(o&&o.userDefaultsNeedsDefault){h=o.userDefaultsNeedsDefault(this,m,d)
}if((h===undefined)&&this._defaults){h=this._defaults[d]||this._defaults[m]}return h
},writeDefault:function(o,m){var j,g,p,n,s,l;o=this._normalizeKeyName(o);j=this._userKeyName(o);
g=this._written;if(!g){g=this._written={}}g[j]=m;if(SC.browser.msie=="7.0"){p=document.body
}else{if(this.HTML5DB_noLocalStorage){l=this._safari3DB}else{p=window.localStorage;
if(!p&&window.globalStorage){p=window.globalStorage[window.location.hostname]}}}n=["SC.UserDefaults",j].join("-at-");
if(p||l){var d=SC.json.encode(m);if(SC.browser.msie=="7.0"){p.setAttribute(n.replace(/\W/gi,""),d);
p.save("SC.UserDefaults")}else{if(l){var h=this;l.transaction(function(e){e.executeSql("delete from SCLocalStorage where key = ?",[n],function(){e.executeSql("insert into SCLocalStorage(key, value) VALUES ('"+n+"', '"+d+"');",[],h._nullDataHandler,h.killTransaction)
})});this.dataHash[n]=d}else{try{p[n]=d}catch(k){console.error("Failed using localStorage. "+k)
}}}}s=this.delegate;if(s&&s.userDefaultsDidChange){s.userDefaultsDidChange(this,o,m,j)
}return this},resetDefault:function(l){var k,d,e,h,j,g;k=this._normalizeKeyName(l);
d=this._userKeyName(k);this.propertyWillChange(l);this.propertyWillChange(k);e=this._written;
if(e){delete e[d]}if(SC.browser.msie=="7.0"){h=document.body}else{if(this.HTML5DB_noLocalStorage){g=this._safari3DB
}else{h=window.localStorage;if(!h&&window.globalStorage){h=window.globalStorage[window.location.hostname]
}}}j=["SC.UserDefaults",d].join("-at-");if(h){if(SC.browser.msie=="7.0"){h.setAttribute(j.replace(/\W/gi,""),null);
h.save("SC.UserDefaults")}else{if(g){var m=this;g.transaction(function(n){n.executeSql("delete from SCLocalStorage where key = ?",[j],null)
});delete this.dataHash[j]}else{delete h[j]}}}this.propertyDidChange(l);this.propertyDidChange(k);
return this},unknownProperty:function(d,e){if(e===undefined){return this.readDefault(d)
}else{this.writeDefault(d,e);return e}},_normalizeKeyName:function(d){if(d.indexOf(":")<0){var e=this.get("appDomain")||"app";
d=[e,d].join(":")}return d},_userKeyName:function(e){var d=this.get("userDomain")||"(anonymous)";
return[d,e].join("-at-")},_domainDidChange:function(){var d=NO;if(this.get("userDomain")!==this._scud_userDomain){this._scud_userDomain=this.get("userDomain");
d=YES}if(this.get("appDomain")!==this._scud_appDomain){this._scud_appDomain=this.get("appDomain");
d=YES}if(d){this.allPropertiesDidChange()}}.observes("userDomain","appDomain"),init:function(){arguments.callee.base.apply(this,arguments);
if(SC.userDefaults&&SC.userDefaults.get("dataHash")){var k=SC.userDefaults.get("dataHash");
if(k){this.dataHash=SC.userDefaults.get("dataHash")}}this._scud_userDomain=this.get("userDomain");
this._scud_appDomain=this.get("appDomain");if(SC.browser.msie=="7.0"){document.body.addBehavior("#default#userData")
}this.HTML5DB_noLocalStorage=((parseInt(SC.browser.safari,0)>523)&&(parseInt(SC.browser.safari,0)<528));
if(this.HTML5DB_noLocalStorage){var j;try{if(!window.openDatabase){console.error("Trying to load a database with safari version 3.1 to get SC.UserDefaults to work. You are either in a previous version or there is a problem with your browser.");
return}else{var d="scdb",h="1.0",g="SproutCore database",n=65536;j=openDatabase(d,h,g,n)
}}catch(m){console.error("Trying to load a database with safari version 3.1 to get SC.UserDefaults to work. You are either in a previous version or there is a problem with your browser.");
return}if(j){var l=this;j.transaction(function(e){e.executeSql("CREATE TABLE IF NOT EXISTS SCLocalStorage(key TEXT NOT NULL PRIMARY KEY, value TEXT NOT NULL);",[],l._nullDataHandler,l.killTransaction)
});j.transaction(function(e){e.parent=l;e.executeSql("SELECT * from SCLocalStorage;",[],function(y,s){var u={},x;
for(var p=0,o=s.rows.length;p<o;p++){x=s.rows.item(p);u[x.key]=x.value}y.parent.dataHash=u;
SC.run(function(){SC.userDefaults.set("ready",YES)})},l.killTransaction)});this._safari3DB=j
}}else{this.set("ready",YES)}},_killTransaction:function(e,d){return true},_nullDataHandler:function(e,d){},readyCallback:function(d,e){this.func=e;
this.ob=d},readyChanged:function(){if(this.ready===YES){var d=this.func;if(d){d.apply(this.ob)
}}}.observes("ready")});SC.userDefaults=SC.UserDefaults.create();sc_require("system/browser");
SC.mixin({_downloadFrames:0,_copy_computed_props:["maxWidth","maxHeight","paddingLeft","paddingRight","paddingTop","paddingBottom","fontFamily","fontSize","fontStyle","fontWeight","fontVariant","lineHeight","whiteSpace"],download:function(j){var d=document.createElement("iframe");
var h="DownloadFrame_"+this._downloadFrames;SC.$(d).attr("id",h);d.style.border="10px";
d.style.width="0px";d.style.height="0px";d.style.position="absolute";d.style.top="-10000px";
d.style.left="-10000px";if(!SC.browser.isSafari){SC.$(d).attr("src",j)}document.getElementsByTagName("body")[0].appendChild(d);
if(SC.browser.isSafari){SC.$(d).attr("src",j)}this._downloadFrames=this._downloadFrames+1;
if(!SC.browser.isSafari){var g=function(){document.body.removeChild(document.getElementById(h));
h=null};var e=g.invokeLater(null,2000)}d=null},normalizeURL:function(d){if(d.slice(0,1)=="/"){d=window.location.protocol+"//"+window.location.host+d
}else{if((d.slice(0,5)=="http:")||(d.slice(0,6)=="https:")){}else{d=window.location.href+"/"+d
}}return d},isPercentage:function(d){return(d<1&&d>0)},minX:function(d){return d.x||0
},maxX:function(d){return(d.x||0)+(d.width||0)},midX:function(d){return(d.x||0)+((d.width||0)/2)
},minY:function(d){return d.y||0},maxY:function(d){return(d.y||0)+(d.height||0)},midY:function(d){return(d.y||0)+((d.height||0)/2)
},centerX:function(e,d){return(d.width-e.width)/2},centerY:function(e,d){return(d.height-e.height)/2
},pointInRect:function(d,e){return(d.x>=SC.minX(e))&&(d.y>=SC.minY(e))&&(d.x<=SC.maxX(e))&&(d.y<=SC.maxY(e))
},rectsEqual:function(e,d,g){if(!e||!d){return(e==d)}if(!g&&g!==0){g=0.1}if((e.y!=d.y)&&(Math.abs(e.y-d.y)>g)){return NO
}if((e.x!=d.x)&&(Math.abs(e.x-d.x)>g)){return NO}if((e.width!=d.width)&&(Math.abs(e.width-d.width)>g)){return NO
}if((e.height!=d.height)&&(Math.abs(e.height-d.height)>g)){return NO}return YES},intersectRects:function(e,d){var g={x:Math.max(SC.minX(e),SC.minX(d)),y:Math.max(SC.minY(e),SC.minY(d)),width:Math.min(SC.maxX(e),SC.maxX(d)),height:Math.min(SC.maxY(e),SC.maxY(d))};
g.width=Math.max(0,g.width-g.x);g.height=Math.max(0,g.height-g.y);return g},unionRects:function(e,d){var g={x:Math.min(SC.minX(e),SC.minX(d)),y:Math.min(SC.minY(e),SC.minY(d)),width:Math.max(SC.maxX(e),SC.maxX(d)),height:Math.max(SC.maxY(e),SC.maxY(d))};
g.width=Math.max(0,g.width-g.x);g.height=Math.max(0,g.height-g.y);return g},cloneRect:function(d){return{x:d.x,y:d.y,width:d.width,height:d.height}
},stringFromRect:function(d){return"{x:"+d.x+", y:"+d.y+", width:"+d.width+", height:"+d.height+"}"
},stringFromLayout:function(j){var h=["maxHeight","maxWidth","minHeight","minWidth","centerY","centerX","width","height","bottom","right","top","left"];
var d=[];var g=h.length;while(--g>=0){var e=h[g];if(j.hasOwnProperty(e)){d.push(e+":"+j[e])
}}return"{"+d.join(", ")+"}"},heightForString:function(l,h,g,k){var j=this._heightCalcElement,e,d;
e=(k&&SC.typeOf(k)===SC.T_ARRAY)?k.join(" "):"";if(!h){h=100}if(!j){j=this._heightCalcElement=document.createElement("div");
document.body.insertBefore(j,null)}g=g+"; width: "+h+"px; left: "+(-1*h)+"px; position: absolute";
SC.$(j).attr("style",g);if(e!==""){SC.$(j).attr("class",e)}j.innerHTML=l;d=j.clientHeight;
j=null;return d},prepareStringMeasurement:function(s,d){var n=this._metricsCalculationElement,l,u,g;
l=SC.A(d).join(" ");if(!n){n=this._metricsCalculationElement=document.createElement("div");
document.body.insertBefore(n,null)}if(SC.typeOf(s)!=SC.T_STRING){var k=null;if(document.defaultView&&document.defaultView.getComputedStyle){k=document.defaultView.getComputedStyle(s,null)
}else{k=s.currentStyle}g=k.cssText;if(!g||g.trim()===""){var p=this._copy_computed_props;
for(var m=0;m<p.length;m++){var e=p[m],j=k[e];n.style[e]=j}var o=n.style;if(o.font===""){var h="";
if(o.fontStyle){h+=o.fontStyle+" "}if(o.fontVariant){h+=o.fontVariant+" "}if(o.fontWeight){h+=o.fontWeight+" "
}if(o.fontSize){h+=o.fontSize}else{h+="10px"}if(o.lineHeight){h+="/"+o.lineHeight
}h+=" ";if(o.fontFamily){h+=o.fontFamily}else{o+="sans-serif"}n.style.font=h}SC.mixin(n.style,{left:"0px",top:"0px",position:"absolute",bottom:"auto",right:"auto",width:"auto",height:"auto"})
}else{n.setAttribute("style",g+"; position:absolute; left: 0px; top: 0px; bottom: auto; right: auto; width: auto; height: auto;")
}k=null}else{g=s;n.setAttribute("style",g+"; position:absolute; left: 0px; top: 0px; bottom: auto; right: auto; width: auto; height: auto;")
}n.className=l;n=null},teardownStringMeasurement:function(){var d=this._metricsCalculationElement;
d.innerHTML="";d.className="";d.setAttribute("style","");d=null},measureString:function(e){var g=this._metricsCalculationElement;
if(!g){throw"measureString requires a string measurement environment to be set up. Did you mean metricsForString?"
}if(typeof g.innerText!="undefined"){g.innerText=e}else{g.textContent=e}var d={width:g.clientWidth,height:g.clientHeight};
g=null;return d},metricsForString:function(e,g,h){SC.prepareStringMeasurement(g,h);
var d=SC.measureString(e);SC.teardownStringMeasurement();return d},viewportOffset:function(g){if(g.getBoundingClientRect){var h=g.getBoundingClientRect();
return{x:h.left,y:h.top}}var n=0;var j=0;var m=g;var e=SC.browser.mozilla>=3;while(m){j+=(m.offsetTop||0);
if(!e||(m!==g)){j+=(m.clientTop||0)}n+=(m.offsetLeft||0);if(!e||(m!==g)){n+=(m.clientLeft||0)
}if(SC.browser.mozilla){var l=SC.$(m).attr("overflow");if(l!=="visible"){var k=parseInt(SC.$(m).attr("borderLeftWidth"),0)||0;
var o=parseInt(SC.$(m).attr("borderTopWidth"),0)||0;if(g!==m){k*=2;o*=2}n+=k;j+=o
}var d=m.offsetParent;if(SC.browser.mozilla.match(/1[.]9/)&&d){j-=d.clientTop;n-=d.clientLeft
}}if(m.offsetParent==document.body&&SC.$(m).attr("position")=="absolute"){break}m=m.offsetParent
}m=g;while(m){if(!SC.browser.isOpera||m.tagName=="BODY"){j-=m.scrollTop||0;n-=m.scrollLeft||0
}m=m.parentNode}return{x:n,y:j}},ZERO_POINT:{x:0,y:0},ZERO_RANGE:{start:0,length:0},RANGE_NOT_FOUND:{start:0,length:-1},valueInRange:function(e,d){return(e>=0)&&(e>=d.start)&&(e<(d.start+d.length))
},minRange:function(d){return d.start},maxRange:function(d){return(d.length<0)?-1:(d.start+d.length)
},unionRanges:function(g,e){if((g==null)||(g.length<0)){return e}if((e==null)||(e.length<0)){return g
}var h=Math.min(g.start,e.start);var d=Math.max(SC.maxRange(g),SC.maxRange(e));return{start:h,length:d-h}
},intersectRanges:function(g,e){if((g==null)||(e==null)){return SC.RANGE_NOT_FOUND
}if((g.length<0)||(e.length<0)){return SC.RANGE_NOT_FOUND}var h=Math.max(SC.minRange(g),SC.minRange(e));
var d=Math.min(SC.maxRange(g),SC.maxRange(e));if(d<h){return SC.RANGE_NOT_FOUND}return{start:h,length:d-h}
},subtractRanges:function(g,e){if((g==null)||(e==null)){return SC.RANGE_NOT_FOUND
}if((g.length<0)||(e.length<0)){return SC.RANGE_NOT_FOUND}var d=Math.max(SC.minRange(g),SC.minRange(e));
var h=Math.min(SC.maxRange(g),SC.maxRange(e));if(d<h){return SC.RANGE_NOT_FOUND}return{start:h,length:d-h}
},cloneRange:function(d){return{start:d.start,length:d.length}},rangesEqual:function(e,d){if(e===d){return true
}if(e==null){return d.length<0}if(d==null){return e.length<0}return(e.start==d.start)&&(e.length==d.length)
},convertHsvToHex:function(l,z,x){var d=0;var m=0;var u=0;if(x>0){var k=(l==1)?0:Math.floor(l*6);
var n=(l==1)?0:(l*6)-k;var j=x*(1-z);var e=x*(1-(z*n));var y=x*(1-(z*(1-n)));var o=[[x,y,j],[e,x,j],[j,x,y],[j,e,x],[y,j,x],[x,j,e]];
d=Math.round(255*o[k][0]);m=Math.round(255*o[k][1]);u=Math.round(255*o[k][2])}return this.parseColor("rgb("+d+","+m+","+u+")")
},convertHexToHsv:function(m){var g=this.expandColor(m);var d=Math.max(Math.max(g[0],g[1]),g[2]);
var j=Math.min(Math.min(g[0],g[1]),g[2]);var l=(d==j)?0:((d==g[0])?((g[1]-g[2])/(d-j)/6):((d==g[1])?((g[2]-g[0])/(d-j)/6+1/3):((g[0]-g[1])/(d-j)/6+2/3)));
l=(l<0)?(l+1):((l>1)?(l-1):l);var k=(d==0)?0:(1-j/d);var e=d/255;return[l,k,e]},PARSE_COLOR_RGBRE:/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i,PARSE_COLOR_HEXRE:/^\#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/,expandColor:function(e){var g,j,h,d;
g=this.parseColor(e);if(g){j=parseInt(g.slice(1,3),16);h=parseInt(g.slice(3,5),16);
d=parseInt(g.slice(5,7),16);return[j,h,d]}},parseColor:function(h){var j=0,d="#",g;
if(g=this.PARSE_COLOR_RGBRE.exec(h)){var e;for(j=1;j<=3;j++){e=Math.max(0,Math.min(255,parseInt(g[j],0)));
d+=this.toColorPart(e)}return d}if(g=this.PARSE_COLOR_HEXRE.exec(h)){if(g[1].length==3){for(j=0;
j<3;j++){d+=g[1].charAt(j)+g[1].charAt(j)}return d}return"#"+g[1]}return false},toColorPart:function(d){if(d>255){d=255
}var e=d.toString(16);if(d<16){return"0"+e}return e},getStyle:function(d,e){var g="";
if(document.defaultView&&document.defaultView.getComputedStyle){g=document.defaultView.getComputedStyle(d,"").getPropertyValue(e)
}else{if(d.currentStyle){e=e.replace(/\-(\w)/g,function(h,j){return j.toUpperCase()
});g=d.currentStyle[e]}}return g}});var content,controller,extra;var TestObject=SC.Object.extend({title:"test",toString:function(){return"TestObject(%@)".fmt(this.get("title"))
}});module("SC.ArrayController - array_case - EMPTY",{setup:function(){content=[];
controller=SC.ArrayController.create({content:content});extra=TestObject.create({title:"FOO"})
},teardown:function(){controller.destroy()}});test("state properties",function(){equals(controller.get("hasContent"),YES,"c.hasContent");
equals(controller.get("canRemoveContent"),YES,"c.canRemoveContent");equals(controller.get("canReorderContent"),YES,"c.canReorderContent");
equals(controller.get("canAddContent"),YES,"c.canAddContent")});test("addObject",function(){var d=0;
controller.addObserver("[]",function(){d++});SC.run(function(){controller.addObject(extra)
});same(content,[extra],"addObject(extra) should work");equals(d,1,"should notify observer that content has changed");
equals(content.get("length"),1,"should update length of controller")});test("removeObject",function(){var d=0;
controller.addObserver("[]",function(){d++});SC.run(function(){controller.removeObject(extra)
});same(content,[],"removeObject(extra) should have no effect");equals(d,0,"should not notify observer since content did not change")
});test("basic array READ operations",function(){equals(controller.get("length"),0,"length should be empty");
equals(controller.objectAt(0),undefined,"objectAt() should return undefined")});test("basic array WRITE operations",function(){var d=0;
controller.addObserver("[]",function(){d++});controller.replace(0,1,[extra]);same(content,[extra],"should modify content");
equals(d,1,"should notify observer that content has changed");equals(content.get("length"),1,"should update length of controller")
});test("arrangedObjects",function(){equals(controller.get("arrangedObjects"),controller,"c.arrangedObjects should return receiver")
});module("SC.ArrayController - array_case - NON-EMPTY",{setup:function(){content="1 2 3 4 5".w().map(function(d){return TestObject.create({title:d})
});controller=SC.ArrayController.create({content:content});extra=TestObject.create({title:"FOO"})
},teardown:function(){controller.destroy()}});test("state properties",function(){equals(controller.get("hasContent"),YES,"c.hasContent");
equals(controller.get("canRemoveContent"),YES,"c.canRemoveContent");equals(controller.get("canReorderContent"),YES,"c.canReorderContent");
equals(controller.get("canAddContent"),YES,"c.canAddContent")});test("addObject",function(){var d=content.slice();
d.push(extra);var e=0;controller.addObserver("[]",function(){e++});SC.run(function(){controller.addObject(extra)
});same(content,d,"addObject(extra) should work");equals(e,1,"should notify observer that content has changed");
equals(content.get("length"),d.length,"should update length of controller")});test("removeObject",function(){var d=content.slice(),g=d[3];
d.removeObject(g);var e=0;controller.addObserver("[]",function(){e++});SC.run(function(){controller.removeObject(g)
});same(content,d,"removeObject(extra) should remove object");equals(e,1,"should notify observer that content has changed");
equals(content.get("length"),d.length,"should update length of controller")});test("basic array READ operations",function(){equals(controller.get("length"),content.length,"length should be empty");
var d=content.length+1;while(--d>=0){equals(controller.objectAt(d),content[d],"objectAt(%@) should return same value at content[%@]".fmt(d,d))
}});test("basic array WRITE operations",function(){var d=content.slice();d.replace(3,1,[extra]);
var e=0;controller.addObserver("[]",function(){e++});controller.replace(3,1,[extra]);
same(content,d,"should modify content");equals(e,1,"should notify observer that content has changed");
equals(content.get("length"),d.length,"should update length of controller")});test("arrangedObjects",function(){equals(controller.get("arrangedObjects"),controller,"c.arrangedObjects should return receiver")
});test("array orderBy using function",function(){var d=function(j,h){if(j.get("title")>h.get("title")){return -1
}else{if(j.get("title")==h.get("title")){return 0}else{return 1}}};var g=content.slice();
g.sort(d);var e=SC.ArrayController.create({content:content,orderBy:d});same(e.get("arrangedObjects").toArray(),g,"arrangedObjects should be sortable by a custom function")
});test("verify rangeObserver fires when content is deleted",function(){content="1 2 3 4 5".w().map(function(g){return TestObject.create({title:g})
});controller=SC.ArrayController.create({content:content});var e=0,d=SC.Object.create({method:function(){e++
}});controller.addRangeObserver(SC.IndexSet.create(0,2),d,d.method);SC.RunLoop.begin();
content.length=0;content.enumerableContentDidChange();SC.RunLoop.end();equals(e,1,"range observer should have fired once")
});var content,controller,extra;var TestObject=SC.Object.extend({title:"test",xFactor:"THETA",toString:function(){return"TestObject(%@)".fmt(this.get("title"))
}});module("SC.ArrayController - enum_case - EMPTY SET",{setup:function(){content=SC.Set.create();
controller=SC.ArrayController.create({content:content,orderBy:"title"});extra=TestObject.create({title:"FOO",xFactor:"ZED"})
},teardown:function(){controller.destroy()}});test("state properties",function(){equals(controller.get("hasContent"),YES,"c.hasContent");
equals(controller.get("canRemoveContent"),YES,"c.canRemoveContent");equals(controller.get("canReorderContent"),NO,"c.canReorderContent");
equals(controller.get("canAddContent"),YES,"c.canAddContent")});test("addObject",function(){var e=0;
controller.addObserver("[]",function(){e++});SC.run(function(){controller.addObject(extra)
});var d=SC.Set.create().add(extra);same(content,d,"addObject(extra) should work");
equals(e,1,"should notify observer that content has changed");equals(content.get("length"),1,"should update length of controller")
});test("removeObject",function(){var d=0;controller.addObserver("[]",function(){d++
});SC.run(function(){controller.removeObject(extra)});same(content,SC.Set.create(),"removeObject(extra) should have no effect");
equals(d,0,"should not notify observer since content did not change")});test("basic array READ operations",function(){equals(controller.get("length"),0,"length should be empty");
equals(controller.objectAt(0),undefined,"objectAt() should return undefined")});test("basic array WRITE operations",function(){var d=0;
controller.addObserver("[]",function(){d++});should_throw(function(){controller.replace(0,1,[extra])
},Error,"calling replace on an enumerable should throw")});test("arrangedObjects",function(){equals(controller.get("arrangedObjects"),controller,"c.arrangedObjects should return receiver")
});module("SC.ArrayController - enum_case - NON-EMPTY SET",{setup:function(){content=SC.Set.create();
"1 2 3 4 5".w().forEach(function(d){content.add(TestObject.create({title:d,xFactor:(5-d)}))
});controller=SC.ArrayController.create({content:content,orderBy:"title"});extra=TestObject.create({title:"FOO",xFactor:0})
},teardown:function(){controller.destroy()}});test("state properties",function(){equals(controller.get("hasContent"),YES,"c.hasContent");
equals(controller.get("canRemoveContent"),YES,"c.canRemoveContent");equals(controller.get("canReorderContent"),NO,"c.canReorderContent");
equals(controller.get("canAddContent"),YES,"c.canAddContent")});test("addObject",function(){var g=content.copy();
g.add(extra);var h=0;controller.addObserver("[]",function(){h++});SC.run(function(){controller.addObject(extra)
});same(content,g,"addObject(extra) should work");equals(h,1,"should notify observer that content has changed");
equals(content.get("length"),g.length,"should update length of controller");var e,d=controller.get("length");
g=SC.A(g).sort(function(k,j){return SC.compare(k.get("title"),j.get("title"))});for(e=0;
e<d;e++){equals(controller.objectAt(e),g[e],"controller.objectAt(%@) should be match ordered array %@".fmt(e,e))
}});test("removeObject",function(){var g=content.copy(),j=g.pop();var h=0;controller.addObserver("[]",function(){h++
});equals(controller.get("length"),content.get("length"),"precond - controller should have same length as content to start");
SC.run(function(){controller.removeObject(j)});same(content,g,"removeObject(extra) should remove object");
equals(h,1,"should notify observer that content has changed");equals(content.get("length"),g.length,"should update length of content");
equals(controller.get("length"),g.length,"should update length of controller as well");
var e,d=controller.get("length");g=SC.A(g).sort(function(l,k){return SC.compare(l.get("title"),k.get("title"))
});for(e=0;e<d;e++){equals(controller.objectAt(e),g[e],"controller.objectAt(%@) should be match ordered array %@".fmt(e,e))
}});test("basic array READ operations",function(){equals(controller.get("length"),content.length,"length should be empty");
var d=SC.A(content).sort(function(h,g){return SC.compare(h.get("title"),g.get("title"))
});var e=d.length+1;while(--e>=0){equals(controller.objectAt(e),d[e],"objectAt(%@) should return same value at content[%@]".fmt(e,e))
}});test("basic array WRITE operations",function(){var d=0;controller.addObserver("[]",function(){d++
});should_throw(function(){controller.replace(0,1,[extra])},Error,"calling replace on an enumerable should throw")
});test("arrangedObjects",function(){equals(controller.get("arrangedObjects"),controller,"c.arrangedObjects should return receiver")
});test("modifying orderBy should build order",function(){var d=0;controller.addObserver("[]",this,function(){d++
});same(controller.getEach("title"),"1 2 3 4 5".w(),"initially should be ordered by title");
d=0;controller.set("orderBy","xFactor");equals(d,1,"should have fired observer on enumerable");
same(controller.getEach("title"),"5 4 3 2 1".w(),"should be ordered reverse")});var content,controller,extra;
var TestObject=SC.Object.extend({title:"test",toString:function(){return"TestObject(%@)".fmt(this.get("title"))
}});module("SC.ArrayController - null_case",{setup:function(){content=null;controller=SC.ArrayController.create({content:content});
extra=TestObject.create({title:"FOO"})},teardown:function(){controller.destroy()}});
test("state properties",function(){equals(controller.get("hasContent"),NO,"c.hasContent");
equals(controller.get("canRemoveContent"),NO,"c.canRemoveContent");equals(controller.get("canReorderContent"),NO,"c.canReorderContent");
equals(controller.get("canAddContent"),NO,"c.canAddContent")});test("addObject",function(){should_throw(function(){controller.addObject(extra)
},Error,"controller.addObject should throw exception")});test("removeObject",function(){should_throw(function(){controller.removeObject(extra)
},Error,"controller.addObject should throw exception")});test("basic array operations",function(){equals(controller.get("length"),0,"length should be empty");
equals(controller.objectAt(0),undefined,"objectAt() should return undefined");should_throw(function(){controller.replace(0,1,[extra])
},Error,"replace() should throw an error since it is not editable")});test("arrangedObjects",function(){equals(controller.get("arrangedObjects"),controller,"c.arrangedObjects should return receiver")
});var content,controller,extra;var TestObject=SC.Object.extend({title:"test",toString:function(){return"TestObject(%@)".fmt(this.get("title"))
}});module("SC.ArrayController - single_case - SINGLE",{setup:function(){content=TestObject.create({title:"FOO"});
controller=SC.ArrayController.create({content:content,allowsSingleContent:YES})},teardown:function(){controller.destroy()
}});test("state properties",function(){equals(controller.get("hasContent"),YES,"c.hasContent");
equals(controller.get("canRemoveContent"),YES,"c.canRemoveContent");equals(controller.get("canReorderContent"),NO,"c.canReorderContent");
equals(controller.get("canAddContent"),NO,"c.canAddContent")});test("addObject",function(){should_throw(function(){controller.addObject(extra)
},Error,"controller.addObject should throw exception")});test("removeObject - no destroyOnRemoval",function(){var d=0;
controller.set("destroyOnRemoval",NO);controller.addObserver("[]",function(){d++});
controller.removeObject(content);equals(controller.get("content"),null,"removeObject(content) should set content to null");
equals(d,1,"should notify observer since content did not change");equals(controller.get("length"),0,"should now have length of 0");
equals(content.isDestroyed,NO,"content.isDestroyed should be destroyed")});test("removeObject - destroyOnRemoval",function(){controller.set("destroyOnRemoval",YES);
SC.run(function(){controller.removeObject(content)});equals(content.isDestroyed,YES,"content.isDestroyed should be destroyed")
});test("basic array READ operations",function(){equals(controller.get("length"),1,"length should be 1");
equals(controller.objectAt(0),content,"objectAt(0) should return content")});test("basic array WRITE operations",function(){should_throw(function(){controller.replace(0,1,[extra])
},Error,"calling replace on an enumerable should throw")});test("arrangedObjects",function(){equals(controller.get("arrangedObjects"),controller,"c.arrangedObjects should return receiver")
});module("SC.ArrayController - single_case - allowsSingleContent=NO",{setup:function(){content=TestObject.create({title:"FOO"});
controller=SC.ArrayController.create({content:content,allowsSingleContent:NO})},teardown:function(){controller.destroy()
}});test("state properties",function(){equals(controller.get("hasContent"),NO,"c.hasContent");
equals(controller.get("canRemoveContent"),NO,"c.canRemoveContent");equals(controller.get("canReorderContent"),NO,"c.canReorderContent");
equals(controller.get("canAddContent"),NO,"c.canAddContent")});test("addObject",function(){should_throw(function(){controller.addObject(extra)
},Error,"controller.addObject should throw exception")});test("removeObject",function(){should_throw(function(){controller.removeObject(extra)
},Error,"controller.removeObject should throw exception")});test("basic array READ operations",function(){equals(controller.get("length"),0,"length should be empty");
equals(controller.objectAt(0),undefined,"objectAt() should return undefined")});test("basic array WRITE operations",function(){should_throw(function(){controller.replace(0,1,[extra])
},Error,"calling replace on an enumerable should throw")});test("arrangedObjects",function(){equals(controller.get("arrangedObjects"),controller,"c.arrangedObjects should return receiver")
});var content,controller;module("SC.ObjectController - empty_case - NULL",{setup:function(){content=null;
controller=SC.ObjectController.create({content:content})},teardown:function(){controller.destroy()
}});test("getting any value should return undefined",function(){equals(controller.get("foo"),undefined,"controller.get(foo)");
equals(controller.get("bar"),undefined,"controller.get(bar)")});test("setting any unknown value should have no effect",function(){equals(controller.set("foo","FOO"),controller,"controller.set(foo, FOO) should return self");
equals(controller.set("bar","BAR"),controller,"controller.set(bar, BAR) should return self");
equals(controller.get("foo"),undefined,"controller.get(foo)");equals(controller.get("bar"),undefined,"controller.get(bar)")
});test("hasContent",function(){equals(controller.get("hasContent"),NO,"hasContent should be NO")
});module("SC.ObjectController - empty_case - EMPTY ARRAY",{setup:function(){content=null;
controller=SC.ObjectController.create({content:content})},teardown:function(){controller.destroy()
}});test("getting any value should return undefined",function(){equals(controller.get("foo"),undefined,"controller.get(foo)");
equals(controller.get("bar"),undefined,"controller.get(bar)")});test("setting any unknown value should have no effect",function(){equals(controller.set("foo","FOO"),controller,"controller.set(foo, FOO) should return self");
equals(controller.set("bar","BAR"),controller,"controller.set(bar, BAR) should return self");
equals(controller.get("foo"),undefined,"controller.get(foo)");equals(controller.get("bar"),undefined,"controller.get(bar)")
});test("hasContent",function(){equals(controller.get("hasContent"),NO,"hasContent should be NO")
});test("allowsMultipleContent should have no effect",function(){controller=SC.ObjectController.create({content:content,allowsMultipleContent:YES});
equals(controller.get("length"),undefined,"controller.get(length)");equals(controller.get("hasContent"),NO,"controller.hasContent")
});var src,src2,content,controller;module("SC.ObjectController - multiple_case - ALLOWSMULTIPLE = NO",{setup:function(){src=SC.Object.create({foo:"foo1",bar:"bar1"});
src2=SC.Object.create({foo:"foo2",bar:"bar1"});content=[src,src2];controller=SC.ObjectController.create({content:content,allowsMultipleContent:NO})
},teardown:function(){controller.destroy()}});test("hasContent",function(){equals(controller.get("hasContent"),NO,"hasContent should be NO")
});test("getting any value should return undefined",function(){equals(controller.get("foo"),undefined,"controller.get(foo)");
equals(controller.get("bar"),undefined,"controller.get(bar)")});test("setting any unknown value should have no effect",function(){equals(controller.set("foo","FOO"),controller,"controller.set(foo, FOO) should return self");
equals(controller.set("bar","BAR"),controller,"controller.set(bar, BAR) should return self");
equals(src.get("foo"),"foo1","src.get(foo)");equals(src.get("bar"),"bar1","src.get(bar)")
});module("SC.ObjectController - multiple_case - ALLOWSMULTIPLE = YES",{setup:function(){src=SC.Object.create({foo:"foo1",bar:"bar1"});
src2=SC.Object.create({foo:"foo2",bar:"bar1"});content=[src,src2];controller=SC.ObjectController.create({content:content,allowsMultipleContent:YES})
},teardown:function(){controller.destroy()}});test("getting any unknown value",function(){same(controller.get("foo"),["foo1","foo2"],"controller.get(foo) should return array with all items");
same(controller.get("bar"),"bar1","controller.get(bar) should return single property since all items match")
});test("setting any unknown value should pass through",function(){equals(controller.set("foo","EDIT"),controller,"controller.set(foo, EDIT) should return self");
equals(controller.set("bar","EDIT"),controller,"controller.set(bar, EDIT) should return self");
equals(controller.set("baz","EDIT"),controller,"controller.set(baz, EDIT) should return self");
equals(src.get("foo"),"EDIT","src.get(foo)");equals(src.get("bar"),"EDIT","src.get(bar)");
equals(src.get("baz"),"EDIT","src.get(bar)");equals(src2.get("foo"),"EDIT","src2.get(foo)");
equals(src2.get("bar"),"EDIT","src2.get(bar)");equals(src2.get("baz"),"EDIT","src2.get(bar)")
});test("changing a property on a content object",function(){var d=0;controller.addObserver("bar",function(){d++
});equals(controller.get("bar"),"bar1","controller.get(bar) before edit should have original value");
src.set("bar","EDIT");same(controller.get("bar"),["EDIT","bar1"],"controller.get(bar) after edit should have updated value");
equals(d,1,"observer on controller should have fired")});test("hasContent",function(){equals(controller.get("hasContent"),YES,"should have content");
var d=0;controller.addObserver("hasContent",function(){d++});controller.set("content",null);
equals(controller.get("hasContent"),NO,"hasContent should == NO after setting to null");
ok(d>0,"hasContent observer should fire when setting to null");d=0;controller.set("content",content);
equals(controller.get("hasContent"),YES,"hasContent should == YES after setting back to content");
ok(d>0,"hasContent observer should fire")});var content,controller;module("SC.ObjectController - single_case - OBSERVABLE OBJECT",{setup:function(){content=SC.Object.create({foo:"foo1",bar:"bar1"});
controller=SC.ObjectController.create({content:content})},teardown:function(){controller.destroy()
}});test("getting any unknown value should pass through to object",function(){equals(controller.get("foo"),"foo1","controller.get(foo)");
equals(controller.get("bar"),"bar1","controller.get(bar)")});test("setting any unknown value should pass through",function(){equals(controller.set("foo","EDIT"),controller,"controller.set(foo, EDIT) should return self");
equals(controller.set("bar","EDIT"),controller,"controller.set(bar, EDIT) should return self");
equals(controller.set("baz","EDIT"),controller,"controller.set(baz, EDIT) should return self");
equals(content.get("foo"),"EDIT","controller.get(foo)");equals(content.get("bar"),"EDIT","controller.get(bar)");
equals(content.get("baz"),"EDIT","controller.get(bar)")});test("changing a property on the content",function(){var d=0;
controller.addObserver("foo",function(){d++});equals(controller.get("foo"),"foo1","controller.get(foo) before edit should have original value");
content.set("foo","EDIT");equals(controller.get("foo"),"EDIT","controller.get(foo) after edit should have updated value");
equals(d,1,"observer on controller should have fired")});test("changing the content from one to another",function(){var e=0;
var d=SC.Object.create({foo:"foo2",bar:"bar2"});controller.addObserver("foo",function(){e++
});equals(controller.get("foo"),"foo1","controller.get(foo) before edit should have original value");
controller.set("content",d);equals(controller.get("foo"),"foo2","controller.get(foo) after content should contain new content");
equals(e,1,"observer on controller should have fired");e=0;d.set("foo","EDIT");equals(controller.get("foo"),"EDIT","controller.get(foo) after edit should have updated value");
equals(e,1,"observer on controller should have fired");e=0;content.set("foo","BAR");
equals(controller.get("foo"),"EDIT","controller.get(foo) after edit of non-content object should not change value");
equals(e,0,"observer on controller should NOT have fired")});test("changing the content from one single to null and back",function(){var d=0;
controller.addObserver("foo",function(){d++});equals(controller.get("foo"),"foo1","controller.get(foo) before edit should have original value");
controller.set("content",null);equals(controller.get("foo"),undefined,"controller.get(foo) after content change should be empty");
equals(d,1,"observer on controller should have fired");d=0;content.set("foo","BAR");
equals(controller.get("foo"),undefined,"controller.get(foo) after edit of non-content object should not change value");
equals(d,0,"observer on controller should NOT have fired");d=0;controller.set("content",content);
equals(d,1,"observer on controller should have fired");d=0;content.set("foo","EDIT");
equals(controller.get("foo"),"EDIT","controller.get(foo) after edit should have updated value");
equals(d,1,"observer on controller should have fired")});test("hasContent",function(){equals(controller.get("hasContent"),YES,"should have content");
var d=0;controller.addObserver("hasContent",function(){d++});controller.set("content",null);
equals(controller.get("hasContent"),NO,"hasContent should == NO after setting to null");
ok(d>0,"hasContent observer should fire when setting to null");d=0;controller.set("content",content);
equals(controller.get("hasContent"),YES,"hasContent should == YES after setting back to content");
ok(d>0,"hasContent observer should fire")});module("SC.ObjectController - single_case - NON-OBSERVABLE OBJECT",{setup:function(){content={foo:"foo1",bar:"bar1"};
controller=SC.ObjectController.create({content:content})},teardown:function(){controller.destroy()
}});test("getting any unknown value should pass through to object",function(){equals(controller.get("foo"),"foo1","controller.get(foo)");
equals(controller.get("bar"),"bar1","controller.get(bar)")});test("setting any unknown value should pass through",function(){equals(controller.set("foo","EDIT"),controller,"controller.set(foo, EDIT) should return self");
equals(controller.set("bar","EDIT"),controller,"controller.set(bar, EDIT) should return self");
equals(controller.set("baz","EDIT"),controller,"controller.set(baz, EDIT) should return self");
equals(content.foo,"EDIT","content.foo");equals(content.bar,"EDIT","content.bar");
equals(content.baz,"EDIT","content.baz")});test("changing a property on the content",function(){var d=0;
controller.addObserver("foo",function(){d++});equals(controller.get("foo"),"foo1","controller.get(foo) before edit should have original value");
content.foo="EDIT";equals(controller.get("foo"),"EDIT","controller.get(foo) after edit should have updated value");
equals(d,0,"observer on controller should not fire because this is not observable")
});test("changing the content from one to another",function(){var e=0;var d={foo:"foo2",bar:"bar2"};
controller.addObserver("foo",function(){e++});equals(controller.get("foo"),"foo1","controller.get(foo) before edit should have original value");
controller.set("content",d);equals(controller.get("foo"),"foo2","controller.get(foo) after content should contain new content");
equals(e,1,"observer on controller should have fired");d.foo="EDIT";equals(controller.get("foo"),"EDIT","controller.get(foo) after edit should have updated value");
content.foo="BAR";equals(controller.get("foo"),"EDIT","controller.get(foo) after edit of non-content object should not change value")
});test("hasContent",function(){equals(controller.get("hasContent"),YES,"should have content");
var d=0;controller.addObserver("hasContent",function(){d++});controller.set("content",null);
equals(controller.get("hasContent"),NO,"hasContent should == NO after setting to null");
ok(d>0,"hasContent observer should fire when setting to null");d=0;controller.set("content",content);
equals(controller.get("hasContent"),YES,"hasContent should == YES after setting back to content");
ok(d>0,"hasContent observer should fire")});var src,content,controller;module("SC.ObjectController - single_enumerable_case - OBSERVABLE OBJECT",{setup:function(){src=SC.Object.create({foo:"foo1",bar:"bar1"});
content=SC.Set.create().add(src);controller=SC.ObjectController.create({content:content,allowsMultipleContent:NO})
},teardown:function(){controller.destroy()}});test("getting any unknown value should pass through to object",function(){equals(controller.get("foo"),"foo1","controller.get(foo)");
equals(controller.get("bar"),"bar1","controller.get(bar)")});test("setting any unknown value should pass through",function(){equals(controller.set("foo","EDIT"),controller,"controller.set(foo, EDIT) should return self");
equals(controller.set("bar","EDIT"),controller,"controller.set(bar, EDIT) should return self");
equals(controller.set("baz","EDIT"),controller,"controller.set(baz, EDIT) should return self");
equals(src.get("foo"),"EDIT","src.get(foo)");equals(src.get("bar"),"EDIT","src.get(bar)");
equals(src.get("baz"),"EDIT","src.get(bar)")});test("changing a property on the content",function(){var d=0;
controller.addObserver("foo",function(){d++});equals(controller.get("foo"),"foo1","controller.get(foo) before edit should have original value");
src.set("foo","EDIT");equals(controller.get("foo"),"EDIT","controller.get(foo) after edit should have updated value");
equals(d,1,"observer on controller should have fired")});test("changing the content from one to another",function(){var g=0;
var e=SC.Object.create({foo:"foo2",bar:"bar2"});var d=[e];controller.addObserver("foo",function(){g++
});equals(controller.get("foo"),"foo1","controller.get(foo) before edit should have original value");
controller.set("content",d);equals(controller.get("foo"),"foo2","controller.get(foo) after content should contain new content");
equals(g,1,"observer on controller should have fired");g=0;e.set("foo","EDIT");equals(controller.get("foo"),"EDIT","controller.get(foo) after edit should have updated value");
equals(g,1,"observer on controller should have fired");g=0;content.set("foo","BAR");
equals(controller.get("foo"),"EDIT","controller.get(foo) after edit of non-content object should not change value");
equals(g,0,"observer on controller should NOT have fired")});test("hasContent",function(){equals(controller.get("hasContent"),YES,"should have content");
var d=0;controller.addObserver("hasContent",function(){d++});controller.set("content",null);
equals(controller.get("hasContent"),NO,"hasContent should == NO after setting to null");
ok(d>0,"hasContent observer should fire when setting to null");d=0;controller.set("content",content);
equals(controller.get("hasContent"),YES,"hasContent should == YES after setting back to content");
ok(d>0,"hasContent observer should fire")});module("SC.ObjectController - single_enumerable_case - ALLOWS MULTIPLE",{setup:function(){src=SC.Object.create({foo:"foo1",bar:"bar1"});
content=SC.Set.create().add(src);controller=SC.ObjectController.create({content:content,allowsMultipleContent:YES})
},teardown:function(){controller.destroy()}});test("getting any unknown value should pass through to object",function(){equals(controller.get("foo"),"foo1","controller.get(foo)");
equals(controller.get("bar"),"bar1","controller.get(bar)")});test("setting any unknown value should pass through",function(){equals(controller.set("foo","EDIT"),controller,"controller.set(foo, EDIT) should return self");
equals(controller.set("bar","EDIT"),controller,"controller.set(bar, EDIT) should return self");
equals(controller.set("baz","EDIT"),controller,"controller.set(baz, EDIT) should return self");
equals(src.get("foo"),"EDIT","src.get(foo)");equals(src.get("bar"),"EDIT","src.get(bar)");
equals(src.get("baz"),"EDIT","src.get(bar)")});test("changing a property on the content",function(){var d=0;
controller.addObserver("foo",function(){d++});equals(controller.get("foo"),"foo1","controller.get(foo) before edit should have original value");
src.set("foo","EDIT");equals(controller.get("foo"),"EDIT","controller.get(foo) after edit should have updated value");
equals(d,1,"observer on controller should have fired")});test("changing the content from one to another",function(){var g=0;
var e=SC.Object.create({foo:"foo2",bar:"bar2"});var d=[e];controller.addObserver("foo",function(){g++
});equals(controller.get("foo"),"foo1","controller.get(foo) before edit should have original value");
controller.set("content",d);equals(controller.get("foo"),"foo2","controller.get(foo) after content should contain new content");
equals(g,1,"observer on controller should have fired");g=0;e.set("foo","EDIT");equals(controller.get("foo"),"EDIT","controller.get(foo) after edit should have updated value");
equals(g,1,"observer on controller should have fired");g=0;content.set("foo","BAR");
equals(controller.get("foo"),"EDIT","controller.get(foo) after edit of non-content object should not change value");
equals(g,0,"observer on controller should NOT have fired")});test("hasContent",function(){equals(controller.get("hasContent"),YES,"should have content");
var d=0;controller.addObserver("hasContent",function(){d++});controller.set("content",null);
equals(controller.get("hasContent"),NO,"hasContent should == NO after setting to null");
ok(d>0,"hasContent observer should fire when setting to null");d=0;controller.set("content",content);
equals(controller.get("hasContent"),YES,"hasContent should == YES after setting back to content");
ok(d>0,"hasContent observer should fire")});module("SC.ObjectController - single_enumerable_case - ALLOWS MULTIPLE",{setup:function(){src=SC.Object.create({foo:"foo1",bar:"bar1"});
content=SC.Set.create();controller=SC.ObjectController.create({content:content,allowsMultipleContent:YES});
content.add(src)},teardown:function(){controller.destroy()}});test("getting any unknown value should pass through to object",function(){equals(controller.get("foo"),"foo1","controller.get(foo)");
equals(controller.get("bar"),"bar1","controller.get(bar)")});test("setting any unknown value should pass through",function(){equals(controller.set("foo","EDIT"),controller,"controller.set(foo, EDIT) should return self");
equals(controller.set("bar","EDIT"),controller,"controller.set(bar, EDIT) should return self");
equals(controller.set("baz","EDIT"),controller,"controller.set(baz, EDIT) should return self");
equals(src.get("foo"),"EDIT","src.get(foo)");equals(src.get("bar"),"EDIT","src.get(bar)");
equals(src.get("baz"),"EDIT","src.get(bar)")});test("changing a property on the content",function(){var d=0;
controller.addObserver("foo",function(){d++});equals(controller.get("foo"),"foo1","controller.get(foo) before edit should have original value");
src.set("foo","EDIT");equals(controller.get("foo"),"EDIT","controller.get(foo) after edit should have updated value");
equals(d,1,"observer on controller should have fired")});test("changing the content from one to another",function(){var g=0;
var e=SC.Object.create({foo:"foo2",bar:"bar2"});var d=[e];controller.addObserver("foo",function(){g++
});equals(controller.get("foo"),"foo1","controller.get(foo) before edit should have original value");
controller.set("content",d);equals(controller.get("foo"),"foo2","controller.get(foo) after content should contain new content");
equals(g,1,"observer on controller should have fired");g=0;e.set("foo","EDIT");equals(controller.get("foo"),"EDIT","controller.get(foo) after edit should have updated value");
equals(g,1,"observer on controller should have fired");g=0;content.set("foo","BAR");
equals(controller.get("foo"),"EDIT","controller.get(foo) after edit of non-content object should not change value");
equals(g,0,"observer on controller should NOT have fired")});test("hasContent",function(){equals(controller.get("hasContent"),YES,"should have content");
var d=0;controller.addObserver("hasContent",function(){d++});controller.set("content",null);
equals(controller.get("hasContent"),NO,"hasContent should == NO after setting to null");
ok(d>0,"hasContent observer should fire when setting to null");d=0;controller.set("content",content);
equals(controller.get("hasContent"),YES,"hasContent should == YES after setting back to content");
ok(d>0,"hasContent observer should fire")});var root,content,controller,extra,flattened;
var TestObject=SC.Object.extend({toString:function(){return"TestObject(%@)".fmt(this.get("title"))
}});module("SC.TreeController - tree_case",{setup:function(){content=[TestObject.create({title:"A",isExpanded:YES,outline:0,children:[TestObject.create({title:"A.i",outline:1}),TestObject.create({title:"A.ii",outline:1,isExpanded:NO,children:[TestObject.create({title:"A.ii.1",outline:2}),TestObject.create({title:"A.ii.2",outline:2}),TestObject.create({title:"A.ii.3",outline:2})]}),TestObject.create({title:"A.iii",outline:1})]}),TestObject.create({title:"B",isExpanded:YES,outline:0,children:[TestObject.create({title:"B.i",isExpanded:YES,outline:1,children:[TestObject.create({title:"B.i.1",outline:2}),TestObject.create({title:"B.i.2",outline:2}),TestObject.create({title:"B.i.3",outline:2})]}),TestObject.create({title:"B.ii",outline:1}),TestObject.create({title:"B.iii",outline:1})]}),TestObject.create({outline:0,title:"C"})];
root=TestObject.create({title:"ROOT",children:content,isExpanded:YES});flattened=[content[0],content[0].children[0],content[0].children[1],content[0].children[2],content[1],content[1].children[0],content[1].children[0].children[0],content[1].children[0].children[1],content[1].children[0].children[2],content[1].children[1],content[1].children[2],content[2]];
controller=SC.TreeController.create({content:root,treeItemChildrenKey:"children",treeItemIsExpandedKey:"isExpanded",treeItemIsGrouped:YES})
},teardown:function(){controller.destroy()}});test("arrangedObjects",function(){ok(controller.get("arangedObjects")!==controller,"should have its own arrangedObjects");
var g=controller.get("arrangedObjects");equals(g.get("length"),flattened.get("length"),"arrangedObjects should have expected length");
var e,d=flattened.get("length");for(e=0;e<d;e++){equals(g.objectAt(e),flattened[e],"arrangedObjects.objectAt(%@) should be expected object in flattened[%@]".fmt(e,e))
}});module("TODO: Test SC.ControlTestPane Methods");(function(){module("SC.ControlTestPane UI");
test("showing/removing a pane",function(){var d=SC.ControlTestPane.design();d=d.create();
ok(d.$().hasClass("sc-control-test-pane"),"should have class sc-control-test-pane");
ok(d.get("isVisible"),"control test pane should be visible after we create it");ok(d.get("isVisibleInWindow"),"control tast pane should be visible in the window after we create it");
d.remove();ok(d.get("isVisible"),"control test pane still should be visible after we remove it");
ok(!d.get("isVisibleInWindow"),"control tast pane should NOT be visible in the window after we remove it")
});test("adding named children to the pane",function(){var e=SC.ControlTestPane.design();
e.add("first",SC.View);e.add("second",SC.View);e.add("third",SC.View);equals(e.prototype.childViews.length,6,"control test pane has correct number of children before create");
e=e.create();equals(e.getPath("childViews.length"),6,"control test pane has correct number of children after create");
var m=e.get("childViews");var h=m[0];equals(h.$().text(),"first:","first label should be correct");
var g=m[2];equals(g.$().text(),"second:","second label should be correct");var o=m[4];
equals(o.$().text(),"third:","third label should be correct");var d=e.get("layer");
for(var n=0,k=6;n<k;++n){var l=m[n];var j=l.get("layer");equals(j.parentNode,d,"control test pane childView has layer with correct parentNode")
}e.remove()})})();module("Create a pane with some custom views and adding it to the window");
htmlbody("<style>.sc-view { border: 1px red solid; z-index: -1; position: absolute; }</style>");
test("layer creation and management",function(){var d=SC.View.extend({cv:0,displayProperties:"cv".w(),render:function(l,m){this.renderChildViews(l,YES);
l.begin().push("View %@".fmt(this.get("cv"))).end()}});var k=SC.Pane.design().layout({bottom:10,right:20,top:20,left:20}).childView(d.design({cv:1}).classNames("view-1").layout({top:50}).childView(d.design({cv:2}).classNames("view-2").layout({bottom:10,right:20,width:100,height:23})));
k=k.create();var j=k.childViews[0],h=j.childViews[0];equals(j.cv,1,"has childView 1");
equals(h.cv,2,"has childView 2");ok(!k.get("layer"),"pane has no layer");ok(!j.get("layer"),"cv1 has no layer");
ok(!h.get("layer"),"cv2 has no layer");var g=0;h.updateLayer=function(){g++};SC.RunLoop.begin();
h.set("displayNeedsUpdate",YES);SC.RunLoop.end();equals(g,0,"cv2.updateLayer did not run");
delete h.updateLayer;ok(!k.get("isVisibleInWindow"),"pane.isVisibleInWindow should be NO");
ok(!j.get("isVisibleInWindow"),"cv1.isVisibleInWindow should be NO");ok(!h.get("isVisibleInWindow"),"cv2.isVisibleInWindow should be NO");
SC.RunLoop.begin();k.append();SC.RunLoop.end();ok(k.get("isVisibleInWindow"),"pane.isVisibleInWindow should be YES");
ok(j.get("isVisibleInWindow"),"cv1.isVisibleInWindow should be YES");ok(h.get("isVisibleInWindow"),"cv2.isVisibleInWindow should be YES");
ok(k.get("layer"),"pane has layer");ok(!j._view_pane,"cv1 has not found its layer yet");
ok(!h._view_pane,"cv2 has not found its layer yet");var e=k.get("layer");equals(e.firstChild.id,j.get("layerId"),"has cv1 elem");
equals(e.firstChild.firstChild.id,h.get("layerId"),"has cv2 elem");e=null;ok(j.get("layer"),"cv1 can find its layer");
ok(h.get("layer"),"cv2 can find its layer");equals(k.get("layer").parentNode,document.body,"panes layer is in document body");
SC.RunLoop.begin();h.set("cv","foo");SC.RunLoop.end();e=h.get("layer");ok(e.innerHTML.toString().match(/View foo/),"does not have new label!")
});var view,content;module("SC.Button#contentPropertyDidChange",{setup:function(){content=SC.Object.create();
view=SC.View.create(SC.Control,SC.Button);view.set("title","hello world")},teardown:function(){content=null;
view.destroy()}});test("invoked with key = * whenever content changes",function(){view.contentPropertyDidChange=function(e,d){ok(e===content,"should pass content object as target target=%@".fmt(e));
equals(d,"*","should pass * as key")};view.set("content",content)});test("invoked with key = foo whenever a propery on content is changed",function(){var d=NO,e;
view.contentPropertyDidChange=function(h,g){if(!d){return}ok(h===content,"should pass content object as target");
equals(g,e,"should pass * as key")};view.set("content",content);d=YES;e="foo";content.set("foo","foo");
e="bar";content.set("bar","bar")});test("should no longer be invoked when a key is changed on a former content object",function(){var d=NO;
view.contentPropertyDidChange=function(g,e){if(!d){return}ok(NO,"should not invoke contentPropertyDidChange after content is removed")
};view.set("content",content);content.set("foo","foo");view.set("content",null);d=YES;
content.set("bar","bar")});test("should fire even on a content object set when the object is created",function(){var e=0;
var d=SC.View.create(SC.Control,{contentPropertyDidChange:function(){e++},content:content});
equals(e,1,"should call contentPropertyDidChange on init to do initial setup");content.set("foo","foo");
equals(e,2,"should call contentPropertyDidChange when changing content.foo")});module("SC.Button#titleRendering",{setup:function(){content=SC.Object.create();
view=SC.View.create(SC.Control,SC.Button);view.set("title","hello world")},teardown:function(){content=null;
view.destroy()}});test("should return the title localized or not",function(){equals(view.displayTitle(),"hello world","should return an empty string as the title is not localized")
});test("should return the button view context with the title set",function(){context=SC.RenderContext();
ok((view.renderTitle(context,true).length>0),"title string were added to the context")
});module("SC.Button#updatePropertyFromContent()",{setup:function(){content=SC.Object.create({foo:"foo",bar:"bar"});
view=SC.View.create(SC.Control,SC.Button,{content:content})},teardown:function(){content=null;
view.destroy()}});test("copies value of content[key] to this[prop] if changed key.  Gets key from contentKey property",function(){view.contentValueKey="foo";
view.updatePropertyFromContent("value","foo","contentValueKey");equals(view.get("value"),"foo","should copy foo from content.foo to value")
});test("does nothing of changed key does not match contentKey value",function(){view.value="foo";
view.contentValueKey="foo";view.updatePropertyFromContent("value","bar","contentValueKey");
equals(view.get("value"),"foo",'should not have changed "value"')});test("if contentKey is not passed, assume contentPROPKey",function(){view.contentValueKey="foo";
view.updatePropertyFromContent("value","foo");equals(view.get("value"),"foo","should have looked at foo since contentValueKey is set to foo")
});test("if contentFooKey is not set on receiver, ask displayDelegate",function(){view.displayDelegate=SC.Object.create({contentValueKey:"foo"});
view.updatePropertyFromContent("value","foo","contentValueKey");equals(view.get("value"),"foo","should have looked at foo since contentValueKey is set to foo")
});test("should be able to get value from a content object that is not SC.Object",function(){view.content={foo:"foo"};
view.contentValueKey="foo";view.updatePropertyFromContent("value","foo","contentValueKey");
equals(view.get("value"),"foo","should have looked at foo since contentValueKey is set to foo")
});module("SC.Button#updatePropertyFromContent()",{setup:function(){content=SC.Object.create({foo:"foo",bar:"bar"});
view=SC.View.create(SC.Control,SC.Button,{value:"bar",content:content,contentValueKey:"bar",displayDelegate:SC.Object.create({contentValueKey:"foo"})})
},teardown:function(){content=null;view.destroy()}});test("if contentValueKey is set, changing value will be pushed to content",function(){view.set("value","baz");
equals(content.get("bar"),"baz","should copy from view.value to content")});test("if contentValueKey is undefined, asks display delegate instead",function(){delete view.contentValueKey;
view.set("value","baz");equals(content.get("foo"),"baz","should copy from view.value to content")
});test("if contentValueKey is not set & displayDelegate not set, does nothing",function(){delete view.contentValueKey;
delete view.displayDelegate;view.set("value","baz");equals(content.get("foo"),"foo","should not change")
});var view;module("SC.Button#displayProperties",{setup:function(){view=SC.View.create(SC.Control,SC.Button,{isVisibleInWindow:YES}).createLayer()
},teardown:function(){view.destroy()}});test("setting isSelected to YES adds sel class name",function(){SC.RunLoop.begin();
view.set("isSelected",YES);SC.RunLoop.end();ok(view.$().hasClass("sel"),"should have css class sel")
});test("setting isSelected to SC.MIXED_STATE add mixed class name, and removes sel class name",function(){SC.RunLoop.begin();
view.set("isSelected",SC.MIXED_STATE);SC.RunLoop.end();ok(view.$().hasClass("mixed"),"should have css class mixed");
ok(!view.$().hasClass("sel"),"should NOT have css class sel")});test("setting isSelected to ON removes sel class name",function(){SC.RunLoop.begin();
view.set("isSelected",YES);SC.RunLoop.end();ok(view.$().hasClass("sel"),"precond - should have sel class");
SC.RunLoop.begin();view.set("isSelected",NO);SC.RunLoop.end();ok(!view.$().hasClass("sel"),"should no longer have sel class")
});test("setting isEnabled to NO adds disabled class",function(){SC.RunLoop.begin();
view.set("isEnabled",NO);SC.RunLoop.end();ok(view.$().hasClass("disabled"),"should have disabled class");
SC.RunLoop.begin();view.set("isEnabled",YES);SC.RunLoop.end();ok(!view.$().hasClass("disabled"),"should remove disabled class")
});test("should gain focus class if isFirstResponder",function(){SC.RunLoop.begin();
view.set("isFirstResponder",YES);SC.RunLoop.end();ok(view.$().hasClass("focus"),"should have focus class");
SC.RunLoop.begin();view.set("isFirstResponder",NO);SC.RunLoop.end();ok(!view.$().hasClass("focus"),"should remove focus class")
});test("should gain active class if isActive",function(){SC.RunLoop.begin();view.set("isActive",YES);
SC.RunLoop.end();ok(view.$().hasClass("active"),"should have active class");SC.RunLoop.begin();
view.set("isActive",NO);SC.RunLoop.end();ok(!view.$().hasClass("active"),"should remove active class")
});test("should get controlSize class on init",function(){ok(view.$().hasClass(SC.REGULAR_CONTROL_SIZE),"should have regular control size class")
});var view;module("SC.Button#performKeyEquivalent",{setup:function(){view=SC.View.create(SC.Button,{triggerAction:function(){return YES
}});view.set("title","hello world");view.set("keyEquivalent","return")},teardown:function(){view.destroy();
view=null}});test("handles matching key equivalent 'return'",function(){view.triggerAction=function(d){return YES
};ok(view.performKeyEquivalent("return"),"should return truthy value indicating it handled the key equivalent 'return'")
});test("ignores non-matching key equivalent 'wrong_key'",function(){view.triggerAction=function(d){return YES
};ok(!view.performKeyEquivalent("wrong_key"),"should return falsy value indicating it ignored the non-matching key equivalent 'wrong_key'")
});test("triggers on return if isDefault is set and no keyEquivalent is set",function(){view.set("isDefault",YES);
view.set("keyEquivalent",null);ok(view.performKeyEquivalent("return"),"should be handled");
view.set("keyEquivalent","a");ok(!view.performKeyEquivalent("return"),"should NOT be handled")
});test("triggers on escape if isCancel is set and no keyEquivalent is set",function(){view.set("isCancel",YES);
view.set("keyEquivalent",null);ok(view.performKeyEquivalent("escape"),"should be handled");
view.set("keyEquivalent","a");ok(!view.performKeyEquivalent("escape"),"should NOT be handled")
});htmlbody("<style> .sc-static-layout { border: 1px red dotted; } </style>");var pane=SC.ControlTestPane.design().add("basic",SC.View.extend(SC.Control,SC.Button,{localize:YES,displayProperties:["title"],render:function(d,e){this.renderTitle(d,e)
},title:"Hello World"}));pane.show();module("SC.Button ui",{setup:function(){var d=pane.view("basic")
}});test("should set the innerHTML to the title",function(){var d=pane.view("basic");
ok(d.$("label"),"button has no label");var e=d.$("label");ok(e[0],"label has no html node");
var g=e[0];equals(g.innerHTML,"Hello World","innerHTML should be set to title")});
test("should modify the innerHTML if the title changes",function(){var d=pane.view("basic");
SC.RunLoop.begin();d.set("title","Goodbye World");SC.RunLoop.end();var e=d.$("label");
var g=e[0];equals(g.innerHTML,"Goodbye World","innerHTML should be modified when title changes")
});test("should still modify the innerHTML if the title changes and then changes back to previous value",function(){var d=pane.view("basic");
SC.RunLoop.begin();d.set("title","Hello World");SC.RunLoop.end();var e=d.$("label");
var g=e[0];equals(g.innerHTML,"Hello World","innerHTML should be modified when title changes and then changes back to original value")
});var view,content;module("SC.Control#contentPropertyDidChange",{setup:function(){content=SC.Object.create();
view=SC.View.create(SC.Control)},teardown:function(){content=null;view.destroy()}});
test("invoked with key = * whenever content changes",function(){view.contentPropertyDidChange=function(e,d){ok(e===content,"should pass content object as target target=%@".fmt(e));
equals(d,"*","should pass * as key")};view.set("content",content)});test("invoked with key = foo whenever a propery on content is changed",function(){var d=NO,e;
view.contentPropertyDidChange=function(h,g){if(!d){return}ok(h===content,"should pass content object as target");
equals(g,e,"should pass * as key")};view.set("content",content);d=YES;e="foo";content.set("foo","foo");
e="bar";content.set("bar","bar")});test("should no longer be invoked when a key is changed on a former content object",function(){var d=NO;
view.contentPropertyDidChange=function(g,e){if(!d){return}ok(NO,"should not invoke contentPropertyDidChange after content is removed")
};view.set("content",content);content.set("foo","foo");view.set("content",null);d=YES;
content.set("bar","bar")});test("should fire even on a content object set when the object is created",function(){var e=0;
var d=SC.View.create(SC.Control,{contentPropertyDidChange:function(){e++},content:content});
equals(e,1,"should call contentPropertyDidChange on init to do initial setup");content.set("foo","foo");
equals(e,2,"should call contentPropertyDidChange when changing content.foo")});module("SC.Control#updatePropertyFromContent()",{setup:function(){content=SC.Object.create({foo:"foo",bar:"bar"});
view=SC.View.create(SC.Control,{content:content})},teardown:function(){content=null;
view.destroy()}});test("copies value of content[key] to this[prop] if changed key.  Gets key from contentKey property",function(){view.contentValueKey="foo";
view.updatePropertyFromContent("value","foo","contentValueKey");equals(view.get("value"),"foo","should copy foo from content.foo to value")
});test("does nothing of changed key does not match contentKey value",function(){view.value="foo";
view.contentValueKey="foo";view.updatePropertyFromContent("value","bar","contentValueKey");
equals(view.get("value"),"foo",'should not have changed "value"')});test("if contentKey is not passed, assume contentPROPKey",function(){view.contentValueKey="foo";
view.updatePropertyFromContent("value","foo");equals(view.get("value"),"foo","should have looked at foo since contentValueKey is set to foo")
});test("if contentFooKey is not set on receiver, ask displayDelegate",function(){view.displayDelegate=SC.Object.create({contentValueKey:"foo"});
view.updatePropertyFromContent("value","foo","contentValueKey");equals(view.get("value"),"foo","should have looked at foo since contentValueKey is set to foo")
});test("should be able to get value from a content object that is not SC.Object",function(){view.content={foo:"foo"};
view.contentValueKey="foo";view.updatePropertyFromContent("value","foo","contentValueKey");
equals(view.get("value"),"foo","should have looked at foo since contentValueKey is set to foo")
});module("SC.Control#updatePropertyFromContent()",{setup:function(){content=SC.Object.create({foo:"foo",bar:"bar"});
view=SC.View.create(SC.Control,{value:"bar",content:content,contentValueKey:"bar",displayDelegate:SC.Object.create({contentValueKey:"foo"})})
},teardown:function(){content=null;view.destroy()}});test("if contentValueKey is set, changing value will be pushed to content",function(){view.set("value","baz");
equals(content.get("bar"),"baz","should copy from view.value to content")});test("does nothing if content is null",function(){view.set("content",null);
view.set("value","baz");equals(content.get("bar"),"bar","should not change");equals(content.get("foo"),"foo","should not change")
});test("if contentValueKey is undefined, asks display delegate instead",function(){delete view.contentValueKey;
view.set("value","baz");equals(content.get("foo"),"baz","should copy from view.value to content")
});test("if contentValueKey is not set & displayDelegate not set, does nothing",function(){delete view.contentValueKey;
delete view.displayDelegate;view.set("value","baz");equals(content.get("bar"),"bar","should not change");
equals(content.get("foo"),"foo","should not change")});var view;module("SC.Control#displayProperties",{setup:function(){view=SC.View.create(SC.Control,{isVisibleInWindow:YES}).createLayer()
},teardown:function(){view.destroy()}});test("setting isSelected to YES adds sel class name",function(){SC.RunLoop.begin();
view.set("isSelected",YES);SC.RunLoop.end();ok(view.$().hasClass("sel"),"should have css class sel")
});test("setting isSelected to SC.MIXED_STATE add mixed class name, and removes sel class name",function(){SC.RunLoop.begin();
view.set("isSelected",SC.MIXED_STATE);SC.RunLoop.end();ok(view.$().hasClass("mixed"),"should have css class mixed");
ok(!view.$().hasClass("sel"),"should NOT have css class sel")});test("setting isSelected to ON removes sel class name",function(){SC.RunLoop.begin();
view.set("isSelected",YES);SC.RunLoop.end();ok(view.$().hasClass("sel"),"precond - should have sel class");
SC.RunLoop.begin();view.set("isSelected",NO);SC.RunLoop.end();ok(!view.$().hasClass("sel"),"should no longer have sel class")
});test("setting isEnabled to NO adds disabled class",function(){SC.RunLoop.begin();
view.set("isEnabled",NO);SC.RunLoop.end();ok(view.$().hasClass("disabled"),"should have disabled class");
SC.RunLoop.begin();view.set("isEnabled",YES);SC.RunLoop.end();ok(!view.$().hasClass("disabled"),"should remove disabled class")
});test("should gain focus class if isFirstResponder",function(){SC.RunLoop.begin();
view.set("isFirstResponder",YES);SC.RunLoop.end();ok(view.$().hasClass("focus"),"should have focus class");
SC.RunLoop.begin();view.set("isFirstResponder",NO);SC.RunLoop.end();ok(!view.$().hasClass("focus"),"should remove focus class")
});test("should gain active class if isActive",function(){SC.RunLoop.begin();view.set("isActive",YES);
SC.RunLoop.end();ok(view.$().hasClass("active"),"should have active class");SC.RunLoop.begin();
view.set("isActive",NO);SC.RunLoop.end();ok(!view.$().hasClass("active"),"should remove active class")
});test("should get controlSize class on init",function(){ok(view.$().hasClass(SC.REGULAR_CONTROL_SIZE),"should have regular control size class")
});var field;module("Test the public functions and properties of SC.InlineTextFieldView",{setup:function(){field=SC.InlineTextFieldView.create({})
},teardown:function(){field=null}});test("contains all public class functions",function(){ok(SC.typeOf(SC.InlineTextFieldView.beginEditing)===SC.T_FUNCTION,"should respond to beginEditing()");
ok(SC.typeOf(SC.InlineTextFieldView.commitEditing)===SC.T_FUNCTION,"should respond to commitEditing()");
ok(SC.typeOf(SC.InlineTextFieldView.discardEditing)===SC.T_FUNCTION,"should respond to discardEditing()")
});test("contains all public functions",function(){ok(field.respondsTo("beginEditing"),"should respond to beginEditing()");
ok(field.respondsTo("commitEditing"),"should respond to commitEditing()");ok(field.respondsTo("discardEditing"),"should respond to discardEditing()");
ok(field.respondsTo("blurEditor"),"should respond to blurEditor()");ok(field.respondsTo("cancel"),"should respond to cancel()")
});test("contains all public properties",function(){ok(field.get("isEditing")!==undefined,"should have isEditing property")
});var pane,optionsForLabel1,optionsForLabel2,delegate;pane=SC.ControlTestPane.design().add("label1",SC.LabelView,{value:"Some Text",notifiedWillBegin:NO,notifiedDidBegin:NO,inlineEditorShouldBeginEditing:function(d){return YES
},inlineEditorWillBeginEditing:function(e){this.set("notifiedWillBegin",YES);var g=pane._pane.childViews.length,d=pane._pane.childViews[g-1];
ok(!d.get("isFirstResponder"),"should not be first responder yet")},inlineEditorDidBeginEditing:function(e){this.set("notifiedDidBegin",YES);
var g=pane._pane.childViews.length,d=pane._pane.childViews[g-1];ok(d.get("isFirstResponder"),"should be first responder now")
}}).add("label2",SC.LabelView,{value:"Can't Touch This",inlineEditorShouldBeginEditing:function(d){console.log("inlineEditorShouldBeginEditing");
return NO}});pane.resetView=function(d){d.set("notifiedWillBegin",NO);d.set("notifiedDidBegin",NO)
};module("Test the beginEditing() function of SC.InlineTextFieldView",{setup:function(){pane.standardSetup().setup();
var g=pane.view("label1"),e=pane.view("label2");pane.resetView(g);var h=g.$(),j=SC.viewportOffset(h[0]),d=g.convertFrameFromView(g.get("frame"),null);
j.width=d.width;j.height=d.height;optionsForLabel1={frame:j,delegate:g,exampleElement:g.$(),value:g.get("value"),multiline:g.get("isInlineEditorMultiline"),isCollection:NO,validator:g.get("validator"),exampleInlineTextFieldView:g.get("exampleInlineTextFieldView")};
h=e.$();j=SC.viewportOffset(h[0]);d=e.convertFrameFromView(e.get("frame"),null);j.width=d.width;
j.height=d.height;optionsForLabel2={frame:j,delegate:e,exampleElement:e.$(),value:e.get("value"),multiline:e.get("isInlineEditorMultiline"),isCollection:NO,validator:e.get("validator"),exampleInlineTextFieldView:e.get("exampleInlineTextFieldView")}
},teardown:function(){optionsForLabel1=optionsForLabel2=null;SC.InlineTextFieldView.discardEditing();
pane.standardSetup().teardown()}});test("fails when options missing",function(){try{SC.InlineTextFieldView.beginEditing();
ok(NO,"should fail if parameters missing")}catch(d){ok(YES,"should fail if parameters missing")
}});test("fails when required options are missing",function(){try{optionsForLabel1.frame=null;
SC.InlineTextFieldView.beginEditing(optionsForLabel1);ok(NO,"should fail if frame missing")
}catch(g){ok(YES,"should fail if frame missing: %@".fmt(g))}try{optionsForLabel1.delegate=null;
SC.InlineTextFieldView.beginEditing(optionsForLabel1);ok(NO,"should fail if delegate missing")
}catch(e){ok(YES,"should fail if delegate missing: %@".fmt(e))}try{optionsForLabel1.exampleElement=null;
SC.InlineTextFieldView.beginEditing(optionsForLabel1);ok(NO,"should fail if exampleElement missing")
}catch(d){ok(YES,"should fail if exampleElement missing: %@".fmt(d))}});test("value of inline editor same as label",function(){SC.RunLoop.begin();
SC.InlineTextFieldView.beginEditing(optionsForLabel1);SC.RunLoop.end();var g=pane._pane.childViews.length,e=pane._pane.childViews[g-1],d=pane.view("label1");
equals(e.get("value"),d.get("value"),"editor should have the same initial value as its label")
});test("use input element when options.multiline is set to NO",function(){SC.RunLoop.begin();
SC.InlineTextFieldView.beginEditing(optionsForLabel1);SC.RunLoop.end();var e=pane._pane.childViews.length,d=pane._pane.childViews[e-1];
ok(d.$("input").length>0,"should be using an input element")});test("use textarea element when options.multiline is set to YES",function(){optionsForLabel1.multiline=YES;
SC.RunLoop.begin();SC.InlineTextFieldView.beginEditing(optionsForLabel1);SC.RunLoop.end();
var e=pane._pane.childViews.length,d=pane._pane.childViews[e-1];ok(d.$("textarea").length>0,"should be using a textarea element")
});test("inline editor aborts if delegate returns NO to inlineEditorShouldBeginEditing()",function(){SC.InlineTextFieldView.beginEditing(optionsForLabel2);
var e=pane._pane.childViews.length,d=pane._pane.childViews[e-1];ok(!d.get("isEditing"),"editor should have isEditing set to NO")
});test("inline editor notifies delegate with inlineEditorWillBeginEditing() before becoming responder",function(){var d=pane.view("label1");
SC.RunLoop.begin();ok(!d.get("notifiedWillBegin"),"the delegate should not have been notified of begin editing at this point");
SC.InlineTextFieldView.beginEditing(optionsForLabel1);ok(d.get("notifiedWillBegin"),"the delegate should have been notified of begin editing at this point");
SC.RunLoop.end()});test("inline editor notifies delegate with inlineEditorDidBeginEditing() after becoming responder",function(){var d=pane.view("label1");
SC.RunLoop.begin();ok(!d.get("notifiedDidBegin"),"the delegate should not have been notified of begin editing at this point");
SC.InlineTextFieldView.beginEditing(optionsForLabel1);SC.RunLoop.end();ok(d.get("notifiedDidBegin"),"the delegate should have been notified of begin editing at this point")
});var parent,child;function performLayoutTest(j,h,e,d,k){var g="width height top bottom marginLeft marginTop left right zIndex minWidth maxWidth minHeight maxHeight".w();
g.forEach(function(l){if(e[l]===undefined){e[l]=null}if(k[l]===undefined){k[l]=null
}if(typeof e[l]==="number"){e[l]=e[l].toString()+"px"}if(typeof k[l]==="number"){k[l]=e[l].toString()+"px"
}});child.set("layout",j);g.forEach(function(l){equals(child.get("layoutStyle")[l],e[l],"STYLE NO PARENT %@".fmt(l))
});SC.RunLoop.begin();parent.appendChild(child);SC.RunLoop.end();g.forEach(function(l){equals(child.get("layoutStyle")[l],k[l],"STYLE NO PARENT %@".fmt(l))
})}var commonSetup={setup:function(){parent=SC.View.create({layout:{top:0,left:0,width:200,height:200}});
child=SC.View.create()},teardown:function(){parent=child=null}};module("SC.StaticLayout",commonSetup);
test("Test that auto as a value for width height is set correctly when setting the element style",function(){child=SC.View.create({useStaticLayout:YES,render:function(k){k.push('<div style="padding: 10px"></div>')
}});parent.createLayer();var e=parent.get("layer");document.body.appendChild(e);var j={top:0,left:0,width:"auto",height:"auto"};
var h={x:0,y:0,width:0,height:0};var d={x:0,y:0,width:20,height:20};var g={top:0,left:0,width:"auto",height:"auto"};
performLayoutTest(j,h,g,d,g);e.parentNode.removeChild(e)});test("Test that an exception is thrown when calling adjust and setting to auto",function(){var d=null;
parent.adjust("width","auto").adjust("height","auto");try{parent.get("layoutStyle")
}catch(g){d=g}equals(SC.T_ERROR,SC.typeOf(d),"Layout style functions should throw an error if width/height are set to auto but staticLayout is not enabled"+d)
});test("Test SC.StaticLayout frame support",function(){child=SC.View.create({useStaticLayout:YES});
equals(child.get("frame"),null,"View's frame property will be null when useStaticLayout is YES and layer is not attached to DOM.");
parent.createLayer();var d=parent.get("layer");document.body.appendChild(d);SC.RunLoop.begin();
parent.appendChild(child);SC.RunLoop.end();ok(SC.typeOf(child.get("frame"))===SC.T_HASH,"View's frame property will be an object when useStaticLayout is YES and layer is attached to DOM.")
});module("String.prototype.w()");test("'one two three'.w() => ['one','two','three']",function(){same("one two three".w(),["one","two","three"],"should be equal")
});test("'one    two    three'.w() with extra spaces between words => ['one','two','three']",function(){same("one    two    three".w(),["one","two","three"],"should be equal")
});test("Trim ' spaces on both sides '",function(){same(" spaces on both sides ".trim(),"spaces on both sides","should be equal")
});test("Trim ' spaces on both sides ' on left only",function(){same(" spaces on both sides ".trimLeft(),"spaces on both sides ","should be equal")
});test("Trim ' spaces on both sides ' on right only",function(){same(" spaces on both sides ".trimRight()," spaces on both sides","should be equal")
});test("Regular expression escaping a string",function(){same(".+*?[^]$(){}=!<>|:".escapeForRegExp(),"\\.\\+\\*\\?\\[\\^\\]\\$\\(\\)\\{\\}\\=\\!\\<\\>\\|\\:","should be escaped")
});(function(){var d=SC.ControlTestPane.design().add("with valid value",SC.View.extend(SC.Validatable),{value:SC.Object.create({data:"here is some data"})}).add("with error value",SC.View.extend(SC.Validatable),{value:SC.Error.create({errorValue:"bad data",message:"Input is bad"})});
d.show();d.verifyInvalid=function(g,e){var h=g.$();if(e){ok(h.hasClass("invalid"),"layer should have invalid class")
}else{ok(!h.hasClass("invalid"),"layer should not have invalid class")}};module("SC.Validatable ui",d.standardSetup());
test("with valid value",function(){var e=d.view("with valid value");d.verifyInvalid(e,NO)
});test("with invalid value",function(){var e=d.view("with error value");d.verifyInvalid(e,YES)
});test("changing from invalid to valid",function(){var e=d.view("with error value");
SC.RunLoop.begin();e.set("value","not an SC.Error instance");SC.RunLoop.end();d.verifyInvalid(e,NO)
});test("changing from valid to invalid",function(){var e=d.view("with valid value");
SC.RunLoop.begin();e.set("value",SC.Error.create());SC.RunLoop.end();d.verifyInvalid(e,YES)
})})();var root,content,flattened,delegate,obs,length,extra;var Delegate=SC.Object.extend(SC.TreeItemContent,{treeItemChildrenKey:"children",treeItemIsExpandedKey:"isExpanded",rangeIndexes:null,rangeCallCount:0,rangeDidChange:function(h,g,e,d){this.rangeCallCount++;
this.rangeIndexes=d.frozenCopy()}});var TestObject=SC.Object.extend({toString:function(){return"TestObject(%@)".fmt(this.get("title"))
}});function verifyObjectAt(l,g,j,h){var e,d=g.get("length"),k;if(h===undefined){h=j;
j=undefined}equals(l.get("length"),d,"%@ - length should match".fmt(h));for(e=0;e<d;
e++){k=l.objectAt(e);equals(k,g[e],"%@ - observer.objectAt(%@) should match expected".fmt(h,e))
}if(j!==undefined){if(j){ok(delegate.rangeCallCount>0,"range observer should be called (actual callCount=%@)".fmt(delegate.rangeCallCount))
}else{ok(delegate.rangeCallCount===0,"range observer should NOT be called (actual callCount=%@)".fmt(delegate.rangeCallCount))
}same(delegate.rangeIndexes,j,"range observer should be called with expected indexes")
}}module("SC.TreeItemObserver - Flat Array Use Case",{setup:function(){content="1 2 3 4 5".w().map(function(d){return TestObject.create({title:d})
});root=TestObject.create({title:"ROOT",children:content,isExpanded:YES});flattened=content.slice();
delegate=Delegate.create();extra=TestObject.create({title:"EXTRA"});obs=SC.TreeItemObserver.create({delegate:delegate,item:root});
obs.addRangeObserver(null,delegate,delegate.rangeDidChange)},teardown:function(){if(obs){obs.destroy()
}content=delegate=obs=null}});test("length on create",function(){equals(obs.get("length"),5,"should have length of array on create")
});test("length after replace",function(){equals(obs.get("length"),5,"precond - should have length of array on create");
SC.run(function(){content.replace(2,1,[extra])});equals(obs.get("length"),5,"length should not change")
});test("length after insert",function(){equals(obs.get("length"),5,"precond - should have length of array on create");
SC.run(function(){content.insertAt(2,extra)});equals(obs.get("length"),6,"length should change")
});test("length after remove",function(){equals(obs.get("length"),5,"precond - should have length of array on create");
SC.run(function(){content.removeAt(2)});equals(obs.get("length"),4,"length should change")
});test("objectAt on create",function(){verifyObjectAt(obs,flattened,"on create")
});test("objectAt after replace",function(){verifyObjectAt(obs,flattened,"PRECOND");
SC.run(function(){content.replace(2,1,[extra])});flattened[2]=extra;var d=SC.IndexSet.create(2);
verifyObjectAt(obs,flattened,d,"on create")});test("objectAt after insert",function(){verifyObjectAt(obs,flattened,"PRECOND");
SC.run(function(){content.insertAt(2,extra)});flattened.insertAt(2,extra);var d=SC.IndexSet.create(2,flattened.length-2);
verifyObjectAt(obs,flattened,d,"after insert")});test("objectAt after remove",function(){verifyObjectAt(obs,flattened,"PRECOND");
SC.run(function(){content.removeAt(2)});flattened.removeAt(2);var d=SC.IndexSet.create(2,flattened.length-1);
verifyObjectAt(obs,flattened,d,"after remove")});test("adding an object to end",function(){var d=content.slice();
SC.run(function(){obs.pushObject(extra)});flattened.pushObject(extra);d.pushObject(extra);
var e=SC.IndexSet.create(flattened.length-1,1);verifyObjectAt(obs,flattened,e,"after pushing object");
same(content,d,"content should have new extra item")});test("removing object at end",function(){var d=content.slice();
SC.run(function(){obs.popObject()});flattened.popObject();d.popObject();var e=SC.IndexSet.create(flattened.length,1);
verifyObjectAt(obs,flattened,e,"after removing object");same(content,d,"content should have new extra item")
});test("adding an object to start",function(){var d=content.slice();SC.run(function(){obs.insertAt(0,extra)
});flattened.insertAt(0,extra);d.insertAt(0,extra);var e=SC.IndexSet.create(0,flattened.length);
verifyObjectAt(obs,flattened,e,"after pushing object");same(content,d,"content should have new extra item")
});test("remove an object to start",function(){var d=content.slice();SC.run(function(){obs.removeAt(0)
});flattened.removeAt(0);d.removeAt(0);var e=SC.IndexSet.create(0,flattened.length+1);
verifyObjectAt(obs,flattened,e,"after removing object");same(content,d,"content should have new extra item")
});test("adding object in middle",function(){var d=content.slice();SC.run(function(){obs.insertAt(2,extra)
});flattened.insertAt(2,extra);d.insertAt(2,extra);var e=SC.IndexSet.create(2,flattened.length-2);
verifyObjectAt(obs,flattened,e,"after adding object");same(content,d,"content should have new extra item")
});test("removing object in middle",function(){var d=content.slice();SC.run(function(){obs.removeAt(2)
});flattened.removeAt(2);d.removeAt(2);var e=SC.IndexSet.create(2,flattened.length-1);
verifyObjectAt(obs,flattened,e,"after removing object");same(content,d,"content should have new extra item")
});test("replace object in middle",function(){var d=content.slice();SC.run(function(){obs.replace(2,1,[extra])
});flattened.replace(2,1,[extra]);d.replace(2,1,[extra]);var e=SC.IndexSet.create(2,1);
verifyObjectAt(obs,flattened,e,"after replacing object");same(content,d,"content should have new extra item")
});test("contentGroupIndexes - not grouped",function(){equals(delegate.get("treeItemIsGrouped"),NO,"precond - delegate.treeItemIsGrouped == NO");
equals(obs.contentGroupIndexes(null,obs),null,"contentGroupIndexes should be null");
var e,d=obs.get("length");for(e=0;e<d;e++){equals(obs.contentIndexIsGroup(null,obs,e),NO,"obs.contentIndexIsGroup(null, obs, %@) should be NO".fmt(e))
}});test("contentGroupIndexes - grouped",function(){delegate.set("treeItemIsGrouped",YES);
equals(delegate.get("treeItemIsGrouped"),YES,"precond - delegate.treeItemIsGrouped == YES");
same(obs.contentGroupIndexes(null,obs),SC.IndexSet.create(0,obs.get("length")),"contentGroupIndexes should cover entire set");
var e,d=obs.get("length");for(e=0;e<d;e++){equals(obs.contentIndexIsGroup(null,obs,e),YES,"obs.contentIndexIsGroup(null, obs, %@) should be YES".fmt(e))
}});test("contentIndexOutlineLevel",function(){var e,d=obs.get("length");for(e=0;
e<d;e++){equals(obs.contentIndexOutlineLevel(null,obs,e),0,"obs.contentIndexOutlineLevel(null, obs, %@)".fmt(e))
}});test("contentIndexDisclosureState",function(){var e,d=obs.get("length");for(e=0;
e<d;e++){equals(obs.contentIndexDisclosureState(null,obs,e),SC.LEAF_NODE,"obs.contentIndexDisclosureState(null, obs, %@) should eql SC.LEAF_NODE".fmt(e))
}});var content,delegate,flattened,obs,extra,extrachild,root;var Delegate=SC.Object.extend(SC.TreeItemContent,{treeItemChildrenKey:"children",treeItemIsExpandedKey:"isExpanded",rangeIndexes:null,rangeCallCount:0,rangeDidChange:function(h,g,e,d){this.rangeCallCount++;
this.rangeIndexes=d.frozenCopy()}});var TestObject=SC.Object.extend({toString:function(){return"TestObject(%@)".fmt(this.get("title"))
}});function verifyObjectAt(l,g,j,h){var e,d=g.get("length"),k;if(h===undefined){h=j;
j=undefined}equals(l.get("length"),d,"%@ - length should match".fmt(h));for(e=0;e<d;
e++){k=l.objectAt(e);equals(k,g[e],"%@ - observer.objectAt(%@) should match expected".fmt(h,e))
}if(j!==undefined){if(j){ok(delegate.rangeCallCount>0,"range observer should be called (actual callCount=%@)".fmt(delegate.rangeCallCount))
}else{ok(delegate.rangeCallCount===0,"range observer should NOT be called (actual callCount=%@)".fmt(delegate.rangeCallCount))
}same(delegate.rangeIndexes,j,"range observer should be called with expected indexes")
}}module("SC.TreeItemObserver - Group Use Case",{setup:function(){content=[TestObject.create({isGroup:YES,title:"A",isExpanded:YES,outline:0,children:"0 1 2 3 4".w().map(function(d){return TestObject.create({title:"A.%@".fmt(d),outline:1})
})}),TestObject.create({isGroup:YES,title:"B",isExpanded:YES,outline:0,children:"0 1 2 3 4".w().map(function(d){return TestObject.create({title:"B.%@".fmt(d),outline:1})
})}),TestObject.create({isGroup:YES,title:"C",isExpanded:NO,outline:0,children:"0 1 2 3 4".w().map(function(d){return TestObject.create({title:"C.%@".fmt(d),outline:1})
})})];root=TestObject.create({title:"ROOT",children:content,isExpanded:YES});extra=TestObject.create({title:"EXTRA"});
extrachild=TestObject.create({title:"EXTRA",isExpanded:YES,children:"0 1 2".w().map(function(d){return TestObject.create({title:"EXTRA.%@".fmt(d)})
})});flattened=[content[0],content[0].children[0],content[0].children[1],content[0].children[2],content[0].children[3],content[0].children[4],content[1],content[1].children[0],content[1].children[1],content[1].children[2],content[1].children[3],content[1].children[4],content[2]];
delegate=Delegate.create();obs=SC.TreeItemObserver.create({delegate:delegate,item:root});
obs.addRangeObserver(null,delegate,delegate.rangeDidChange)},teardown:function(){if(obs){obs.destroy()
}content=delegate=obs=null}});test("length on create",function(){equals(obs.get("length"),flattened.length,"should have length of array on create")
});test("objectAt on create",function(){verifyObjectAt(obs,flattened,null,"on create")
});test("pushing object to top level with no children",function(){SC.run(function(){content.pushObject(extra)
});flattened.pushObject(extra);var d=SC.IndexSet.create(flattened.length-1);verifyObjectAt(obs,flattened,d,"after pushing top level object")
});test("popping object to top level with no children",function(){SC.run(function(){content.popObject()
});flattened.popObject();var d=SC.IndexSet.create(flattened.length);verifyObjectAt(obs,flattened,d,"after popping top level object")
});test("inserting object in middle of top level with no children",function(){SC.run(function(){content.insertAt(2,extra)
});flattened.insertAt(12,extra);var d=SC.IndexSet.create(12,flattened.length-12);
verifyObjectAt(obs,flattened,d,"after pushing top level object")});test("replacing object at top level with no children",function(){SC.run(function(){content.replace(2,1,[extra])
});flattened.replace(12,1,[extra]);var d=SC.IndexSet.create(12);verifyObjectAt(obs,flattened,d,"after pushing top level object")
});test("removing object at top level with no children",function(){SC.run(function(){content.removeAt(2)
});flattened.removeAt(12);var d=SC.IndexSet.create(12,flattened.length-11);verifyObjectAt(obs,flattened,d,"after pushing top level object")
});test("pushing object to group",function(){var d=content[1].children;SC.run(function(){d.pushObject(extra)
});flattened.insertAt(12,extra);var e=SC.IndexSet.create(6,flattened.length-6);verifyObjectAt(obs,flattened,e,"after pushing")
});test("popping object from group",function(){var d=content[1].children;SC.run(function(){d.popObject()
});flattened.removeAt(11);var e=SC.IndexSet.create(6,flattened.length-5);verifyObjectAt(obs,flattened,e,"after popping")
});test("inserting object in middle of group",function(){var d=content[1].children;
SC.run(function(){d.insertAt(2,extra)});flattened.insertAt(9,extra);var e=SC.IndexSet.create(6,flattened.length-6);
verifyObjectAt(obs,flattened,e,"after insert")});test("replacing object in group",function(){var d=content[1].children;
SC.run(function(){d.replace(2,1,[extra])});flattened.replace(9,1,[extra]);var e=SC.IndexSet.create(6,flattened.length-7);
verifyObjectAt(obs,flattened,e,"after replacing")});test("removing object in gorup",function(){var d=content[1].children;
SC.run(function(){d.removeAt(2)});flattened.removeAt(9);var e=SC.IndexSet.create(6,flattened.length-5);
verifyObjectAt(obs,flattened,e,"after removing")});test("replacing group children array",function(){var d=extrachild.children;
SC.run(function(){content[1].set("children",d)});flattened.replace(7,5,d);var e=SC.IndexSet.create(6,flattened.length-4);
verifyObjectAt(obs,flattened,e,"after removing")});test("changing expansion property on group",function(){SC.run(function(){content[1].set("isExpanded",NO)
});flattened.removeAt(7,5);var d=SC.IndexSet.create(6,flattened.length-1);verifyObjectAt(obs,flattened,d,"after removing")
});test("pushing object to top level with children, not expanded",function(){extrachild.set("isExpanded",NO);
SC.run(function(){content.pushObject(extrachild)});flattened.pushObject(extrachild);
verifyObjectAt(obs,flattened,"after pushing top level object")});test("inserting object in middle of top level with children, not expanded",function(){extrachild.set("isExpanded",NO);
SC.run(function(){content.insertAt(2,extrachild)});flattened.insertAt(12,extrachild);
verifyObjectAt(obs,flattened,"after pushing top level object")});test("pushing object to top level with children",function(){SC.run(function(){content.pushObject(extrachild)
});flattened.replace(flattened.length,0,[extrachild]);flattened.replace(flattened.length,0,extrachild.children);
verifyObjectAt(obs,flattened,"after pushing top level object")});test("popping object at top level with children",function(){SC.run(function(){content.popObject();
content.popObject()});flattened.length=6;verifyObjectAt(obs,flattened,"after popping top level object")
});test("inserting object in middle of top level with children",function(){SC.run(function(){content.insertAt(2,extrachild)
});flattened.replace(12,0,[extrachild]);flattened.replace(13,0,extrachild.children);
verifyObjectAt(obs,flattened,"after pushing top level object")});test("inserting object in middle of top level between items with children",function(){SC.run(function(){content.insertAt(1,extrachild)
});flattened.replace(6,0,[extrachild]);flattened.replace(7,0,extrachild.children);
verifyObjectAt(obs,flattened,"after pushing top level object")});test("replacing object at top level with no children => children",function(){SC.run(function(){content.replace(2,1,[extrachild])
});flattened.replace(12,1,[extrachild]);flattened.replace(13,0,extrachild.children);
verifyObjectAt(obs,flattened,"after inserting top level object")});test("replacing object at top level with children => children",function(){SC.run(function(){content.replace(1,1,[extrachild])
});flattened.replace(6,6,[extrachild]);flattened.replace(7,0,extrachild.children);
verifyObjectAt(obs,flattened,"after replacing top level object")});test("removing object at top level with children",function(){SC.run(function(){content.removeAt(1)
});flattened.replace(6,6,null);verifyObjectAt(obs,flattened,"after removing top level object")
});test("adding an group to end",function(){var d=content.slice();SC.run(function(){obs.pushObject(extrachild)
});flattened.pushObject(extrachild);flattened.replace(flattened.length,0,extrachild.children);
d.pushObject(extrachild);var e=SC.IndexSet.create(flattened.length-4,4);verifyObjectAt(obs,flattened,e,"after pushing object - should have item and its children");
same(content,d,"content should have new extra item")});test("adding regular item to end",function(){var d=content.slice();
SC.run(function(){obs.pushObject(extra)});flattened.pushObject(extra);d.pushObject(extra);
var e=SC.IndexSet.create(flattened.length-1,1);verifyObjectAt(obs,flattened,e,"after pushing object");
same(content,d,"content should have new extra item")});test("adding an group to beginning",function(){var d=content.slice();
SC.run(function(){obs.insertAt(0,extrachild)});flattened.insertAt(0,extrachild);flattened.replace(1,0,extrachild.children);
d.insertAt(0,extrachild);var e=SC.IndexSet.create(0,flattened.length);verifyObjectAt(obs,flattened,e,"after pushing object - should have item and its children");
same(content,d,"content should have new extra item")});test("adding regular item to beginning",function(){var d=content.slice();
SC.run(function(){obs.insertAt(0,extra)});flattened.insertAt(0,extra);d.insertAt(0,extra);
var e=SC.IndexSet.create(0,flattened.length);verifyObjectAt(obs,flattened,e,"after pushing object");
same(content,d,"content should have new extra item")});test("adding an group to middle",function(){var d=content.slice();
SC.run(function(){obs.replace(6,0,extrachild)});flattened.insertAt(6,extrachild);
flattened.replace(7,0,extrachild.children);d.insertAt(1,extrachild);var e=SC.IndexSet.create(6,flattened.length-6);
verifyObjectAt(obs,flattened,e,"after pushing object - should have item and its children");
same(content,d,"content should have new extra item")});test("adding regular item to middle",function(){var d=content.slice();
SC.run(function(){obs.insertAt(6,extra)});flattened.insertAt(6,extra);d.insertAt(1,extra);
var e=SC.IndexSet.create(6,flattened.length-6);verifyObjectAt(obs,flattened,e,"after pushing object");
same(content,d,"content should have new extra item")});test("removing a group item",function(){var d=content.slice();
SC.run(function(){obs.removeAt(6)});flattened.removeAt(6,6);d.removeAt(1);var e=SC.IndexSet.create(6,flattened.length);
verifyObjectAt(obs,flattened,e,"after removing object - should remove children");
same(content,d,"content should have removed item")});test("removing entire group",function(){var d=content.slice();
SC.run(function(){obs.removeAt(6,6)});flattened.removeAt(6,6);d.removeAt(1);var e=SC.IndexSet.create(6,flattened.length);
verifyObjectAt(obs,flattened,e,"after removing object - should remove children");
same(content,d,"content should have removed item")});test("removing partial group",function(){var d=content.slice();
should_throw(function(){obs.removeAt(3,6)},Error,"should throw error when trying to remove uneven boundaries");
var e=null;verifyObjectAt(obs,flattened,e,"after removing object - should remove children");
same(content,d,"content should have removed item")});test("removing group header and some of the children",function(){var d=content.slice();
should_throw(function(){obs.removeAt(6,3)},Error,"should throw error when trying to remove uneven boundaries");
var e=null;verifyObjectAt(obs,flattened,e,"after removing object - should remove children");
same(content,d,"content should have removed item")});test("adding regular item to end of group",function(){var d=content[0].children.slice();
SC.run(function(){obs.replace(6,0,[extra],SC.DROP_AFTER)});flattened.replace(6,0,[extra]);
d.pushObject(extra);var e=SC.IndexSet.create(0,flattened.length);verifyObjectAt(obs,flattened,e,"after pushing object");
same(content[0].children,d,"content.children should change")});test("removing regular item to end of group",function(){var e=content[0].children,d=e.slice();
SC.run(function(){obs.removeAt(5)});flattened.removeAt(5);d.popObject();var g=SC.IndexSet.create(0,flattened.length+1);
verifyObjectAt(obs,flattened,g,"after removing object");same(e,d,"content.children should change")
});test("adding regular item to beginning",function(){var e=content[0].children,d=e.slice();
SC.run(function(){obs.insertAt(1,extra)});flattened.insertAt(1,extra);d.insertAt(0,extra);
var g=SC.IndexSet.create(0,flattened.length);verifyObjectAt(obs,flattened,g,"after pushing object - should have item");
same(e,d,"content should have new extra item")});test("removing regular item to beginning",function(){var e=content[0].children,d=e.slice();
SC.run(function(){obs.removeAt(1)});flattened.removeAt(1);d.removeAt(0);var g=SC.IndexSet.create(0,flattened.length+1);
verifyObjectAt(obs,flattened,g,"after pushing object - should have item");same(e,d,"content should have new extra item")
});test("adding regular item to middle",function(){var e=content[0].children,d=e.slice();
SC.run(function(){obs.insertAt(3,extra)});flattened.insertAt(3,extra);d.insertAt(2,extra);
var g=SC.IndexSet.create(0,flattened.length);verifyObjectAt(obs,flattened,g,"after adding object");
same(e,d,"content should have new extra item")});test("removing regular item to middle",function(){var e=content[0].children,d=e.slice();
SC.run(function(){obs.removeAt(3)});flattened.removeAt(3);d.removeAt(2);var g=SC.IndexSet.create(0,flattened.length+1);
verifyObjectAt(obs,flattened,g,"after adding object");same(e,d,"content should have new extra item")
});test("replacing regular items in middle",function(){var e=content[0].children,d=e.slice();
SC.run(function(){obs.replace(3,3,[extra])});flattened.replace(3,3,[extra]);d.replace(2,3,[extra]);
var g=SC.IndexSet.create(0,flattened.length+2);verifyObjectAt(obs,flattened,g,"after replacing object");
same(e,d,"content should have new extra item")});test("contentGroupIndexes - not grouped",function(){equals(delegate.get("treeItemIsGrouped"),NO,"precond - delegate.treeItemIsGrouped == NO");
equals(obs.contentGroupIndexes(null,obs),null,"contentGroupIndexes should be null");
var e,d=obs.get("length");for(e=0;e<d;e++){equals(obs.contentIndexIsGroup(null,obs,e),NO,"obs.contentIndexIsGroup(null, obs, %@) should be NO".fmt(e))
}});test("contentGroupIndexes - grouped",function(){delegate.set("treeItemIsGrouped",YES);
equals(delegate.get("treeItemIsGrouped"),YES,"precond - delegate.treeItemIsGrouped == YES");
var g=SC.IndexSet.create(0).add(6).add(12);same(obs.contentGroupIndexes(null,obs),g,"contentGroupIndexes should cover just top leve items");
var e,d=obs.get("length");for(e=0;e<d;e++){equals(obs.contentIndexIsGroup(null,obs,e),g.contains(e),"obs.contentIndexIsGroup(null, obs, %@)".fmt(e))
}});test("contentIndexOutlineLevel",function(){var e,d=obs.get("length");for(e=0;
e<d;e++){var g=flattened[e].outline;equals(obs.contentIndexOutlineLevel(null,obs,e),g,"obs.contentIndexOutlineLevel(null, obs, %@)".fmt(e))
}});test("contentIndexDisclosureState",function(){var e,d=obs.get("length");for(e=0;
e<d;e++){var g=flattened[e].isExpanded;g=(g===NO)?SC.BRANCH_CLOSED:(g?SC.BRANCH_OPEN:SC.LEAF_NODE);
var h;switch(g){case SC.BRANCH_CLOSED:h="SC.BRANCH_CLOSED";break;case SC.BRANCH_OPEN:h="SC.BRANCH_OPEN";
break;default:h="SC.LEAF_NODE";break}equals(obs.contentIndexDisclosureState(null,obs,e),g,"obs.contentIndexDisclosureState(null, obs, %@) should eql %@".fmt(e,h))
}});var content,delegate,obs,flattened,extra,extrachild,extranested,root;var Delegate=SC.Object.extend(SC.TreeItemContent,{treeItemChildrenKey:"children",treeItemIsExpandedKey:"isExpanded",rangeIndexes:null,rangeCallCount:0,rangeDidChange:function(h,g,e,d){this.rangeCallCount++;
this.rangeIndexes=d.frozenCopy()}});var TestObject=SC.Object.extend({toString:function(){return"TestObject(%@)".fmt(this.get("title"))
}});function verifyObjectAt(l,g,j,h){var e,d=g.get("length"),k;if(h===undefined){h=j;
j=undefined}equals(l.get("length"),d,"%@ - length should match".fmt(h));for(e=0;e<d;
e++){k=l.objectAt(e);equals(k,g[e],"%@ - observer.objectAt(%@) should match expected".fmt(h,e))
}if(j!==undefined){if(j){ok(delegate.rangeCallCount>0,"range observer should be called (actual callCount=%@)".fmt(delegate.rangeCallCount))
}else{ok(delegate.rangeCallCount===0,"range observer should NOT be called (actual callCount=%@)".fmt(delegate.rangeCallCount))
}same(delegate.rangeIndexes,j,"range observer should be called with expected indexes")
}}module("SC.TreeItemObserver - Outline Use Case",{setup:function(){content=[TestObject.create({title:"A",isExpanded:YES,outline:0,children:[TestObject.create({title:"A.i",outline:1}),TestObject.create({title:"A.ii",outline:1,isExpanded:NO,children:[TestObject.create({title:"A.ii.1",outline:2}),TestObject.create({title:"A.ii.2",outline:2}),TestObject.create({title:"A.ii.3",outline:2})]}),TestObject.create({title:"A.iii",outline:1})]}),TestObject.create({title:"B",isExpanded:YES,outline:0,children:[TestObject.create({title:"B.i",isExpanded:YES,outline:1,children:[TestObject.create({title:"B.i.1",outline:2}),TestObject.create({title:"B.i.2",outline:2}),TestObject.create({title:"B.i.3",outline:2})]}),TestObject.create({title:"B.ii",outline:1}),TestObject.create({title:"B.iii",outline:1})]}),TestObject.create({outline:0,title:"C"})];
root=TestObject.create({title:"ROOT",children:content,isExpanded:YES});extra=TestObject.create({title:"EXTRA"});
extrachild=TestObject.create({title:"EXTRA",isExpanded:YES,children:"0 1".w().map(function(d){return TestObject.create({title:"EXTRA.%@".fmt(d)})
})});extranested=TestObject.create({title:"EXTRA",isExpanded:YES,children:[TestObject.create({title:"EXTRA.i"}),TestObject.create({title:"EXTRA.ii",isExpanded:YES,children:"0 1 2".w().map(function(d){return TestObject.create({title:"EXTRA.ii.%@".fmt(d)})
})}),TestObject.create({title:"EXTRA.ii"})]});flattened=[content[0],content[0].children[0],content[0].children[1],content[0].children[2],content[1],content[1].children[0],content[1].children[0].children[0],content[1].children[0].children[1],content[1].children[0].children[2],content[1].children[1],content[1].children[2],content[2]];
delegate=Delegate.create();obs=SC.TreeItemObserver.create({delegate:delegate,item:root});
obs.addRangeObserver(null,delegate,delegate.rangeDidChange)},teardown:function(){if(obs){obs.destroy()
}content=delegate=obs=null}});test("length on create",function(){equals(obs.get("length"),flattened.length,"should have length of array on create")
});test("objectAt on create",function(){verifyObjectAt(obs,flattened,null,"on create")
});test("pushing object to group",function(){var d=content[1].children[0].children;
SC.run(function(){d.pushObject(extra)});flattened.insertAt(9,extra);var e=SC.IndexSet.create(4,flattened.length-4);
verifyObjectAt(obs,flattened,e,"after pushing")});test("popping object from nested",function(){var d=content[1].children[0].children;
SC.run(function(){d.popObject()});flattened.removeAt(8);var e=SC.IndexSet.create(4,flattened.length-3);
verifyObjectAt(obs,flattened,e,"after popping")});test("inserting object in middle of nested",function(){var d=content[1].children[0].children;
SC.run(function(){d.insertAt(1,extra)});flattened.insertAt(7,extra);var e=SC.IndexSet.create(4,flattened.length-4);
verifyObjectAt(obs,flattened,e,"after insert")});test("replacing object in nested",function(){var d=content[1].children[0].children;
SC.run(function(){d.replace(1,1,[extra])});flattened.replace(7,1,[extra]);var e=SC.IndexSet.create(4,flattened.length-5);
verifyObjectAt(obs,flattened,e,"after replacing")});test("removing object in gorup",function(){var d=content[1].children[0].children;
SC.run(function(){d.removeAt(1)});flattened.removeAt(7);var e=SC.IndexSet.create(4,flattened.length-3);
verifyObjectAt(obs,flattened,e,"after removing")});test("replacing nested children array",function(){var d=extrachild.children;
var e=content[1].children[0];SC.run(function(){e.set("children",d)});flattened.replace(6,3,d);
var g=SC.IndexSet.create(4,flattened.length-3);verifyObjectAt(obs,flattened,g,"after replace children array")
});test("changing expansion property on nested",function(){var d=content[1].children[0];
SC.run(function(){d.set("isExpanded",NO)});flattened.removeAt(6,3);var e=SC.IndexSet.create(4,flattened.length-1);
verifyObjectAt(obs,flattened,e,"after removing")});test("changing expansion property on top level",function(){var d=content[1];
SC.run(function(){d.set("isExpanded",NO)});flattened.removeAt(5,6);var e=SC.IndexSet.create(4,8);
verifyObjectAt(obs,flattened,e,"after removing")});test("adding regular item to end of nested group",function(){var e=content[1].children[0].children,d=e.slice();
SC.run(function(){obs.replace(9,0,[extra],SC.DROP_AFTER)});flattened.replace(9,0,[extra]);
d.pushObject(extra);var g=SC.IndexSet.create(4,flattened.length-4);verifyObjectAt(obs,flattened,g,"after pushing object");
same(e,d,"content.children should change")});test("adding regular item after nested group",function(){var e=content[1].children,d=e.slice();
SC.run(function(){obs.replace(9,0,[extra],SC.DROP_BEFORE)});flattened.replace(9,0,[extra]);
d.insertAt(1,extra);var g=SC.IndexSet.create(4,flattened.length-4);verifyObjectAt(obs,flattened,g,"after pushing object");
same(e,d,"content.children should change")});test("removing regular item to end of nested",function(){var e=content[1].children[0].children,d=e.slice();
SC.run(function(){obs.removeAt(8)});flattened.removeAt(8);d.popObject();var g=SC.IndexSet.create(4,flattened.length-3);
verifyObjectAt(obs,flattened,g,"after removing object");same(e,d,"content.children should change")
});test("adding regular item to beginning of nested",function(){var e=content[1].children[0].children,d=e.slice();
SC.run(function(){obs.insertAt(6,extra)});flattened.insertAt(6,extra);d.insertAt(0,extra);
var g=SC.IndexSet.create(4,flattened.length-4);verifyObjectAt(obs,flattened,g,"after pushing object - should have item");
same(e,d,"content should have new extra item")});test("removing regular item to beginning",function(){var e=content[1].children[0].children,d=e.slice();
SC.run(function(){obs.removeAt(6)});flattened.removeAt(6);d.removeAt(0);var g=SC.IndexSet.create(4,flattened.length-3);
verifyObjectAt(obs,flattened,g,"after pushing object - should have item");same(e,d,"content should have new extra item")
});test("adding regular item to middle",function(){var e=content[1].children[0].children,d=e.slice();
SC.run(function(){obs.insertAt(7,extra)});flattened.insertAt(7,extra);d.insertAt(1,extra);
var g=SC.IndexSet.create(4,flattened.length-4);verifyObjectAt(obs,flattened,g,"after adding object");
same(e,d,"content should have new extra item")});test("removing regular item to middle",function(){var e=content[1].children[0].children,d=e.slice();
SC.run(function(){obs.removeAt(7)});flattened.removeAt(7);d.removeAt(1);var g=SC.IndexSet.create(4,flattened.length-3);
verifyObjectAt(obs,flattened,g,"after adding object");same(e,d,"content should have new extra item")
});test("contentGroupIndexes - not grouped",function(){equals(delegate.get("treeItemIsGrouped"),NO,"precond - delegate.treeItemIsGrouped == NO");
equals(obs.contentGroupIndexes(null,obs),null,"contentGroupIndexes should be null");
var e,d=obs.get("length");for(e=0;e<d;e++){equals(obs.contentIndexIsGroup(null,obs,e),NO,"obs.contentIndexIsGroup(null, obs, %@) should be NO".fmt(e))
}});test("contentGroupIndexes - grouped",function(){delegate.set("treeItemIsGrouped",YES);
equals(delegate.get("treeItemIsGrouped"),YES,"precond - delegate.treeItemIsGrouped == YES");
var g=SC.IndexSet.create(0).add(4).add(11);same(obs.contentGroupIndexes(null,obs),g,"contentGroupIndexes should cover just top leve items");
var e,d=obs.get("length");for(e=0;e<d;e++){equals(obs.contentIndexIsGroup(null,obs,e),g.contains(e),"obs.contentIndexIsGroup(null, obs, %@) (%@)".fmt(e,flattened[e]))
}});test("contentIndexOutlineLevel",function(){var e,d=obs.get("length");for(e=0;
e<d;e++){var g=flattened[e].outline;equals(obs.contentIndexOutlineLevel(null,obs,e),g,"obs.contentIndexOutlineLevel(null, obs, %@) (%@)".fmt(e,flattened[e]))
}});test("contentIndexDisclosureState",function(){var e,d=obs.get("length");for(e=0;
e<d;e++){var g=flattened[e].isExpanded;g=(g===NO)?SC.BRANCH_CLOSED:(g?SC.BRANCH_OPEN:SC.LEAF_NODE);
var h;switch(g){case SC.BRANCH_CLOSED:h="SC.BRANCH_CLOSED";break;case SC.BRANCH_OPEN:h="SC.BRANCH_OPEN";
break;default:h="SC.LEAF_NODE";break}equals(obs.contentIndexDisclosureState(null,obs,e),g,"obs.contentIndexDisclosureState(null, obs, %@) (%@) should eql %@".fmt(e,flattened[e],h))
}});test("moving nested item from one parent to another",function(){var e=content[1].children[0].children;
var d=content[0].children;var g=e[1];SC.run(function(){e.removeObject(g);d.insertAt(0,g)
});flattened.removeObject(g);flattened.insertAt(flattened.indexOf(content[0])+1,g);
var h=SC.IndexSet.create(0,flattened.length);verifyObjectAt(obs,flattened,h,"after moving")
});var obj;module("Builder",{setup:function(){obj=[1,2,3,4]}});test("To check if the set of array elements are pushed into stack",function(){var g=SC.Builder.fn.pushStack(obj);
equals(4,obj.length=g.length,"No Of elements in the stack");equals(YES,obj[0]==g[0],"First element");
equals(YES,obj[1]==g[1],"Second element");equals(YES,obj[2]==g[2],"Third element");
equals(YES,obj[3]==g[3],"Fourth element");var e=SC.Builder.fn.end();equals(YES,SC.typeOf(e)==SC.T_HASH,"Previous item returned")
});test("create a new builder subclass with any passed properties copied to the builder's 'fn' property",function(){obj=SC.Builder.create({name:"Charles"});
var d=obj.fn.name;equals(d,"Charles","name should match")});test("instantiate the builder, any passed args will be forwarded onto an internal init() method",function(){obj=new SC.Builder({name:"Charles",age:23,sex:"M"});
var d=obj.fn.init();equals(d.name,obj.fn.name);equals(d.age,obj.fn.age);equals(d.sex,obj.fn.sex)
});htmlbody('<!-- Test Styles --><style>body, div, h1 { font-family: "trebuchet ms", verdana, arial; margin: 0; padding: 0 }body {font-size: 10pt; }h1 { padding: 15px; font-size: large; background-color: #06b; color: white; }h1 a { color: white; }h2 { padding: 10px; background-color: #eee; color: black; margin: 0; font-size: small; font-weight: normal }.pass { color: green; } .fail { color: red; } p.result { margin-left: 1em; }#banner { height: 2em; border-bottom: 1px solid white; }h2.pass { background-color: green; }h2.fail { background-color: red; }div.testrunner-toolbar { background: #eee; border-top: 1px solid black; padding: 10px; }ol#tests > li > strong { cursor:pointer; }div#fx-tests h4 {	background: red;}div#fx-tests h4.pass {	background: green;}div#fx-tests div.box {	background: red url(data/cow.jpg) no-repeat;	overflow: hidden;	border: 2px solid #000;}div#fx-tests div.overflow {	overflow: visible;}div.inline {	display: inline;}div.autoheight {	height: auto;}div.autowidth {	width: auto;}div.autoopacity {	opacity: auto;}div.largewidth {	width: 100px;}div.largeheight {	height: 100px;}div.largeopacity {	filter: progid:DXImageTransform.Microsoft.Alpha(opacity=100);}div.medwidth {	width: 50px;}div.medheight {	height: 50px;}div.medopacity {	opacity: 0.5;	filter: progid:DXImageTransform.Microsoft.Alpha(opacity=50);}div.nowidth {	width: 0px;}div.noheight {	height: 0px;}div.noopacity {	opacity: 0;	filter: progid:DXImageTransform.Microsoft.Alpha(opacity=0);}div.hidden {	display: none;}div#fx-tests div.widewidth {	background-repeat: repeat-x;}div#fx-tests div.wideheight {	background-repeat: repeat-y;}div#fx-tests div.widewidth.wideheight {	background-repeat: repeat;}div#fx-tests div.noback {	background-image: none;}div.chain, div.chain div { width: 100px; height: 20px; position: relative; float: left; }div.chain div { position: absolute; top: 0px; left: 0px; }div.chain.test { background: red; }div.chain.test div { background: green; }div.chain.out { background: green; }div.chain.out div { background: red; display: none; }div#show-tests * { display: none; }</style><!-- Test HTML --><div id="nothiddendiv" style="height:1px;background:white;">	<div id="nothiddendivchild"></div></div><!-- this iframe is outside the #main so it won\'t reload constantly wasting time, but it means the tests must be "safe" and clean up after themselves --><iframe id="loadediframe" name="loadediframe" style="display:none;" src="data/iframe.html"></iframe><dl id="dl" style="display:none;"><div id="main" style="display: none;">	<p id="firstp">See <a id="simon1" href="http://simon.incutio.com/archive/2003/03/25/#getElementsBySelector" rel="bookmark">this blog entry</a> for more information.</p>	<p id="ap">		Here are some links in a normal paragraph: <a id="google" href="http://www.google.com/" title="Google!">Google</a>, 		<a id="groups" href="http://groups.google.com/">Google Groups</a>. 		This link has <code><a href="http://smin" id="anchor1">class="blog"</a></code>: 		<a href="http://diveintomark.org/" class="blog" hreflang="en" id="mark">diveintomark</a>	</p>	<div id="foo">		<p id="sndp">Everything inside the red border is inside a div with <code>id="foo"</code>.</p>		<p lang="en" id="en">This is a normal link: <a id="yahoo" href="http://www.yahoo.com/" class="blogTest">Yahoo</a></p>		<p id="sap">This link has <code><a href="#2" id="anchor2">class="blog"</a></code>: <a href="http://simon.incutio.com/" class="blog link" id="simon">Simon Willison\'s Weblog</a></p>	</div>	<p id="first">Try them out:</p>	<ul id="firstUL"></ul>	<ol id="empty"></ol>	<form id="form" action="formaction">		<input type="text" name="action" value="Test" id="text1" maxlength="30"/>		<input type="text" name="text2" value="Test" id="text2" disabled="disabled"/>		<input type="radio" name="radio1" id="radio1" value="on"/>		<input type="radio" name="radio2" id="radio2" checked="checked"/>		<input type="checkbox" name="check" id="check1" checked="checked"/>		<input type="checkbox" id="check2" value="on"/>		<input type="hidden" name="hidden" id="hidden1"/>		<input type="text" style="display:none;" name="foo[bar]" id="hidden2"/>				<input type="text" id="name" name="name" value="name" />				<button id="button" name="button">Button</button>				<textarea id="area1" maxlength="30">foobar</textarea>				<select name="select1" id="select1">			<option id="option1a" class="emptyopt" value="">Nothing</option>			<option id="option1b" value="1">1</option>			<option id="option1c" value="2">2</option>			<option id="option1d" value="3">3</option>		</select>		<select name="select2" id="select2">			<option id="option2a" class="emptyopt" value="">Nothing</option>			<option id="option2b" value="1">1</option>			<option id="option2c" value="2">2</option>			<option id="option2d" selected="selected" value="3">3</option>		</select>		<select name="select3" id="select3" multiple="multiple">			<option id="option3a" class="emptyopt" value="">Nothing</option>			<option id="option3b" selected="selected" value="1">1</option>			<option id="option3c" selected="selected" value="2">2</option>			<option id="option3d" value="3">3</option>			<option id="option3e">no value</option>		</select>				<object id="object1" codebase="stupid">			<param name="p1" value="x1" />			<param name="p2" value="x2" />		</object>				<span id="台北Táiběi"></span>		<span id="台北" lang="中文"></span>		<span id="utf8class1" class="台北Táiběi 台北"></span>		<span id="utf8class2" class="台北"></span>		<span id="foo:bar" class="foo:bar"></span>		<span id="test.foo[5]bar" class="test.foo[5]bar"></span>				<foo_bar id="foobar">test element</foo_bar>	</form>	<b id="floatTest">Float test.</b>	<iframe id="iframe" name="iframe"></iframe>	<form id="lengthtest">		<input type="text" id="idTest" name="id"/>	</form>	<table id="table"></table>		<div id="fx-queue">		<div id="fadein" class="chain test">fadeIn<div>fadeIn</div></div>		<div id="fadeout" class="chain test out">fadeOut<div>fadeOut</div></div>				<div id="show" class="chain test">show<div>show</div></div>		<div id="hide" class="chain test out">hide<div>hide</div></div>				<div id="togglein" class="chain test">togglein<div>togglein</div></div>		<div id="toggleout" class="chain test out">toggleout<div>toggleout</div> </div>					<div id="slideup" class="chain test">slideUp<div>slideUp</div></div>		<div id="slidedown" class="chain test out">slideDown<div>slideDown</div></div>				<div id="slidetogglein" class="chain test">slideToggleIn<div>slideToggleIn</div></div>		<div id="slidetoggleout" class="chain test out">slideToggleOut<div>slideToggleOut</div></div>	</div>		<div id="fx-tests"></div>	<form id="testForm" action="#" method="get">		<textarea name="T3" rows="2" cols="15">?Z</textarea>		<input type="hidden" name="H1" value="x" />		<input type="hidden" name="H2" />		<input name="PWD" type="password" value="" />		<input name="T1" type="text" />		<input name="T2" type="text" value="YES" readonly="readonly" />		<input type="checkbox" name="C1" value="1" />		<input type="checkbox" name="C2" />		<input type="radio" name="R1" value="1" />		<input type="radio" name="R1" value="2" />		<input type="text" name="My Name" value="me" />		<input type="reset" name="reset" value="NO" />		<select name="S1">			<option value="abc">ABC</option>			<option value="abc">ABC</option>			<option value="abc">ABC</option>		</select>		<select name="S2" multiple="multiple" size="3">			<option value="abc">ABC</option>			<option value="abc">ABC</option>			<option value="abc">ABC</option>		</select>		<select name="S3">			<option selected="selected">YES</option>		</select>		<select name="S4">			<option value="" selected="selected">NO</option>		</select>		<input type="submit" name="sub1" value="NO" />		<input type="submit" name="sub2" value="NO" />		<input type="image" name="sub3" value="NO" />		<button name="sub4" type="submit" value="NO">NO</button>		<input name="D1" type="text" value="NO" disabled="disabled" />		<input type="checkbox" checked="checked" disabled="disabled" name="D2" value="NO" />		<input type="radio" name="D3" value="NO" checked="checked" disabled="disabled" />		<select name="D4" disabled="disabled">			<option selected="selected" value="NO">NO</option>		</select>	</form>	<div id="moretests">		<form>			<div id="checkedtest" style="display:none;">				<input type="radio" class="radio" name="checkedtestradios" checked="checked"/>				<input type="radio" class="radio" name="checkedtestradios" value="on"/>				<input type="checkbox" class="checkbox" name="checkedtestcheckboxes" checked="checked"/>				<input type="checkbox" class="checkbox" name="checkedtestcheckboxes" />			</div>		</form>		<div id="nonnodes"><span>hi</span> there <!-- mon ami --></div>		<div id="t2037">			<div><div class="hidden">hidden</div></div>		</div>	</div></div></dl>');
module("CQ core");test("Basic requirements",function(){expect(7);ok(Array.prototype.push,"Array.push()");
ok(Function.prototype.apply,"Function.apply()");ok(document.getElementById,"getElementById");
ok(document.getElementsByTagName,"getElementsByTagName");ok(RegExp,"RegExp");ok(SC.CoreQuery,"SC.CoreQuery");
ok(SC.$,"SC.$")});test("SC.CoreQuery()",function(){expect(8);var d=SC.$("#main");
same(SC.$("div p",d).get(),q("sndp","en","sap"),"Basic selector with SC.$ object as context");
var g=SC.$("<code/>");equals(g.length,1,"Correct number of elements generated for code");
var e=SC.$("<img/>");equals(e.length,1,"Correct number of elements generated for img");
var h=SC.$("<div/><hr/><code/><b/>");equals(h.length,4,"Correct number of elements generated for div hr code b");
equals(SC.$(window).length,1,"Correct number of elements generated for window");equals(SC.$(document).length,1,"Correct number of elements generated for document");
equals(SC.$([1,2,3]).get(1),2,"Test passing an array to the factory");equals(SC.$(document.body).get(0),SC.$("body").get(0),"Test passing an html node to the factory")
});test("SC.$('html')",function(){expect(3);reset();ok(SC.$("<link rel='stylesheet'/>")[0],"Creating a link");
reset();var d=SC.$("<span>hi</span> there <!-- mon ami -->");ok(d.length>=2,"Check node,textnode,comment creation (some browsers delete comments)");
ok(!SC.$("<option>test</option>")[0].selected,"Make sure that options are auto-selected #2050")
});test("SC.$('html', context)",function(){expect(1);var e=SC.$("<div/>");var d=SC.$("<span/>",e);
equals(d.length,1,"Verify a span created with a div context works, #1763")});test("length",function(){expect(1);
equals(SC.$("p").length,6,"Get Number of Elements Found")});test("size()",function(){expect(1);
equals(SC.$("p").size(),6,"Get Number of Elements Found")});test("get()",function(){expect(1);
same(SC.$("p").get(),q("firstp","ap","sndp","en","sap","first"),"Get All Elements")
});test("get(Number)",function(){expect(1);equals(SC.$("p").get(0),document.getElementById("firstp"),"Get A Single Element")
});test("add(String|Element|Array|undefined)",function(){expect(12);same(SC.$("#sndp").add("#en").add("#sap").get(),q("sndp","en","sap"),"Check elements from document");
same(SC.$("#sndp").add(SC.$("#en")[0]).add(SC.$("#sap")).get(),q("sndp","en","sap"),"Check elements from document");
ok(SC.$([]).add(SC.$("#form")[0].elements).length>=13,"Check elements from array");
var e=SC.$([]).add(SC.$("<p id='x1'>xxx</p>")).add(SC.$("<p id='x2'>xxx</p>"));equals(e[0].id,"x1","Check on-the-fly element1");
equals(e[1].id,"x2","Check on-the-fly element2");var e=SC.$([]).add("<p id='x1'>xxx</p>").add("<p id='x2'>xxx</p>");
equals(e[0].id,"x1","Check on-the-fly element1");equals(e[1].id,"x2","Check on-the-fly element2");
var d;equals(SC.$([]).add(d).length,0,"Check that undefined adds nothing");equals(SC.$([]).add([window,document,document.body,document]).length,3,"Pass an array");
equals(SC.$(document).add(document).length,1,"Check duplicated elements");equals(SC.$(window).add(window).length,1,"Check duplicated elements using the window");
ok(SC.$([]).add(document.getElementById("form")).length>=13,"Add a form (adds the elements)")
});test("each(Function)",function(){expect(1);var g=SC.$("div");g.each(function(){this.foo="zoo"
});var e=true;for(var d=0;d<g.size();d++){if(g.get(d).foo!="zoo"){e=false}}ok(e,"Execute a function, Relative")
});test("index(Object)",function(){expect(10);var e=SC.$([window,document]),d=SC.$("#radio1,#radio2,#check1,#check2");
equals(e.index(window),0,"Check for index of elements");equals(e.index(document),1,"Check for index of elements");
equals(d.index(document.getElementById("radio1")),0,"Check for index of elements");
equals(d.index(document.getElementById("radio2")),1,"Check for index of elements");
equals(d.index(document.getElementById("check1")),2,"Check for index of elements");
equals(d.index(document.getElementById("check2")),3,"Check for index of elements");
equals(d.index(window),-1,"Check for not found index");equals(d.index(document),-1,"Check for not found index");
equals(e.index(e),0,"Pass in a SC.$ object");equals(e.index(e.eq(1)),1,"Pass in a SC.$ object")
});test("attr(String)",function(){expect(26);equals(SC.$("#text1").attr("value"),"Test","Check for value attribute");
equals(SC.$("#text1").attr("value","Test2").attr("defaultValue"),"Test","Check for defaultValue attribute");
equals(SC.$("#text1").attr("type"),"text","Check for type attribute");equals(SC.$("#radio1").attr("type"),"radio","Check for type attribute");
equals(SC.$("#check1").attr("type"),"checkbox","Check for type attribute");equals(SC.$("#simon1").attr("rel"),"bookmark","Check for rel attribute");
equals(SC.$("#google").attr("title"),"Google!","Check for title attribute");equals(SC.$("#mark").attr("hreflang"),"en","Check for hreflang attribute");
equals(SC.$("#en").attr("lang"),"en","Check for lang attribute");equals(SC.$("#simon").attr("class"),"blog link","Check for class attribute");
equals(SC.$("#name").attr("name"),"name","Check for name attribute");equals(SC.$("#text1").attr("name"),"action","Check for name attribute");
ok(SC.$("#form").attr("action").indexOf("formaction")>=0,"Check for action attribute");
equals(SC.$("#text1").attr("maxlength"),"30","Check for maxlength attribute");equals(SC.$("#text1").attr("maxLength"),"30","Check for maxLength attribute");
equals(SC.$("#area1").attr("maxLength"),"30","Check for maxLength attribute");equals(SC.$("#select2").attr("selectedIndex"),3,"Check for selectedIndex attribute");
equals(SC.$("#foo").attr("nodeName"),"DIV","Check for nodeName attribute");equals(SC.$("#foo").attr("tagName"),"DIV","Check for tagName attribute");
SC.$("#main").append(SC.$('<a id="tAnchor5"></a>').attr("href","#5"));equals(SC.$("#tAnchor5").attr("href"),"#5","Check for non-absolute href (an anchor)");
var d=document.body,g=SC.$(d);ok(g.attr("foo")===undefined,"Make sure that a non existent attribute returns undefined");
var e=g.attr("nextSibling");ok(((g.attr("nextSibling")===null)||(e.id=="_firebugConsole")),"Make sure a null expando returns null");
g.attr("foo","baz");equals(g.attr("foo"),"baz","Make sure the dom attribute is retrieved when no expando is found");
d.foo="bar";equals(g.attr("foo"),"bar","Make sure the expando is preferred over the dom attribute");
g.attr("foo","cool");equals(g.attr("foo"),"cool","Make sure that setting works well when both expando and dom attribute are available");
d.foo=undefined;ok(g.attr("foo")===undefined,"Make sure the expando is preferred over the dom attribute, even if undefined");
d.removeAttribute("foo")});test("attr(String, Function)",function(){expect(2);equals(SC.$("#text1").attr("value",function(){return this.id
})[0].value,"text1","Set value from id");equals(SC.$("#text1").attr("title",function(d){return d
}).attr("title"),"0","Set value with an index")});test("attr(Hash)",function(){expect(1);
var d=true;SC.$("div").attr({foo:"baz",zoo:"ping"}).each(function(){if(this.getAttribute("foo")!="baz"&&this.getAttribute("zoo")!="ping"){d=false
}});ok(d,"Set Multiple Attributes")});test("attr(String, Object)",function(){expect(17);
var n=SC.$("div").attr("foo","bar");fail=false;for(var h=0;h<n.size();h++){if(n.get(h).getAttribute("foo")!="bar"){fail=h;
break}}equals(fail,false,"Set Attribute, the #"+fail+" element didn't get the attribute 'foo'");
ok(SC.$("#foo").attr({width:null}),"Try to set an attribute to nothing");SC.$("#name").attr("name","something");
equals(SC.$("#name").attr("name"),"something","Set name attribute");SC.$("#check2").attr("checked",true);
equals(document.getElementById("check2").checked,true,"Set checked attribute");SC.$("#check2").attr("checked",false);
equals(document.getElementById("check2").checked,false,"Set checked attribute");SC.$("#text1").attr("readonly",true);
equals(document.getElementById("text1").readOnly,true,"Set readonly attribute");SC.$("#text1").attr("readonly",false);
equals(document.getElementById("text1").readOnly,false,"Set readonly attribute");
SC.$("#name").attr("maxlength","5");equals(document.getElementById("name").maxLength,"5","Set maxlength attribute");
SC.$("#name").attr("maxLength","10");equals(document.getElementById("name").maxLength,"10","Set maxlength attribute");
SC.$("#name").attr("someAttr","0");equals(SC.$("#name").attr("someAttr"),"0",'Set attribute to a string of "0"');
SC.$("#name").attr("someAttr",0);equals(SC.$("#name").attr("someAttr"),0,"Set attribute to the number 0");
SC.$("#name").attr("someAttr",1);equals(SC.$("#name").attr("someAttr"),1,"Set attribute to the number 1");
var g=SC.$("#nonnodes").contents();g.attr("name","attrvalue");equals(g.attr("name"),"attrvalue","Check node,textnode,comment for attr");
g.removeAttr("name");reset();var l=SC.$("#check2").attr("type");var k=false;try{SC.$("#check2").attr("type","hidden")
}catch(m){k=true}ok(k,"Exception thrown when trying to change type property");equals(l,SC.$("#check2").attr("type"),"Verify that you can't change the type of an input element");
var d=document.createElement("input");var k=true;try{SC.$(d).attr("type","checkbox")
}catch(m){k=false}ok(k,"Exception thrown when trying to change type property");equals("checkbox",SC.$(d).attr("type"),"Verify that you can change the type of an input element that isn't in the DOM")
});test("css(String|Hash)",function(){expect(19);equals(SC.$("#main").css("display"),"none",'Check for css property "display"');
ok(SC.$("#foo").isVisible(),"Modifying CSS display: Assert element is visible");SC.$("#foo").css({display:"none"});
ok(!SC.$("#foo").isVisible(),"Modified CSS display: Assert element is hidden");SC.$("#foo").css({display:"block"});
ok(SC.$("#foo").isVisible(),"Modified CSS display: Assert element is visible");SC.$("#floatTest").css({styleFloat:"right"});
equals(SC.$("#floatTest").css("styleFloat"),"right",'Modified CSS float using "styleFloat": Assert float is right');
SC.$("#floatTest").css({cssFloat:"left"});equals(SC.$("#floatTest").css("cssFloat"),"left",'Modified CSS float using "cssFloat": Assert float is left');
SC.$("#floatTest").css({"float":"right"});equals(SC.$("#floatTest").css("float"),"right",'Modified CSS float using "float": Assert float is right');
SC.$("#floatTest").css({"font-size":"30px"});equals(SC.$("#floatTest").css("font-size"),"30px","Modified CSS font-size: Assert font-size is 30px");
SC.$.each("0,0.25,0.5,0.75,1".split(","),function(d,e){SC.$("#foo").css({opacity:e});
equals(SC.$("#foo").css("opacity"),parseFloat(e),"Assert opacity is "+parseFloat(e)+" as a String");
SC.$("#foo").css({opacity:parseFloat(e)});equals(SC.$("#foo").css("opacity"),parseFloat(e),"Assert opacity is "+parseFloat(e)+" as a Number")
});SC.$("#foo").css({opacity:""});equals(SC.$("#foo").css("opacity"),"1","Assert opacity is 1 when set to an empty String")
});test("css(String, Object)",function(){expect(21);ok(SC.$("#foo").isVisible(),"Modifying CSS display: Assert element is visible");
SC.$("#foo").css("display","none");ok(!SC.$("#foo").isVisible(),"Modified CSS display: Assert element is hidden");
SC.$("#foo").css("display","block");ok(SC.$("#foo").isVisible(),"Modified CSS display: Assert element is visible");
SC.$("#floatTest").css("styleFloat","left");equals(SC.$("#floatTest").css("styleFloat"),"left",'Modified CSS float using "styleFloat": Assert float is left');
SC.$("#floatTest").css("cssFloat","right");equals(SC.$("#floatTest").css("cssFloat"),"right",'Modified CSS float using "cssFloat": Assert float is right');
SC.$("#floatTest").css("float","left");equals(SC.$("#floatTest").css("float"),"left",'Modified CSS float using "float": Assert float is left');
SC.$("#floatTest").css("font-size","20px");equals(SC.$("#floatTest").css("font-size"),"20px","Modified CSS font-size: Assert font-size is 20px");
SC.$.each("0,0.25,0.5,0.75,1".split(","),function(e,g){SC.$("#foo").css("opacity",g);
equals(SC.$("#foo").css("opacity"),parseFloat(g),"Assert opacity is "+parseFloat(g)+" as a String");
SC.$("#foo").css("opacity",parseFloat(g));equals(SC.$("#foo").css("opacity"),parseFloat(g),"Assert opacity is "+parseFloat(g)+" as a Number")
});SC.$("#foo").css("opacity","");equals(SC.$("#foo").css("opacity"),"1","Assert opacity is 1 when set to an empty String");
if(SC.browser.msie){SC.$("#foo").css("filter","progid:DXImageTransform.Microsoft.Chroma(color='red');")
}equals(SC.$("#foo").css("opacity"),"1","Assert opacity is 1 when a different filter is set in IE, #1438");
var d=SC.$("#nonnodes").contents();d.css("padding-left","1px");equals(d.css("padding-left"),"1px","Check node,textnode,comment css works");
SC.$("#t2037")[0].innerHTML=SC.$("#t2037")[0].innerHTML;equals(SC.$("#t2037 .hidden").css("display"),"none","Make sure browser thinks it is hidden")
});test("SC.$.css(elem, 'height') doesn't clear radio buttons (bug #1095)",function(){expect(4);
var e=SC.$("#checkedtest");SC.$.css(e[0],"height");var d=SC.$("input.radio",e);ok(!!SC.$(d[0]).attr("checked"),"Check first radio still checked.");
ok(!SC.$(d[d.length]).attr("checked"),"Check last radio still NOT checked.");var d=SC.$("input.checkbox",e);
ok(!!SC.$(d[0]).attr("checked"),"Check first checkbox still checked.");ok(!SC.$(d[d.length]).attr("checked"),"Check last checkbox still NOT checked.")
});test("width()",function(){expect(9);var d=SC.$("#nothiddendiv");d.width(30);equals(d.width(),30,"Test set to 30 correctly");
d.width(-1);equals(d.width(),30,"Test negative width ignored");d.css("padding","20px");
equals(d.width(),30,"Test padding specified with pixels");d.css("border","2px solid #fff");
equals(d.width(),30,"Test border specified with pixels");d.css("padding","2em");var g=SC.browser.msie==8?29:30;
equals(d.width(),g,"Test padding specified with ems");d.css("border","1em solid #fff");
equals(d.width(),30,"Test border specified with ems");d.css("padding","2%");equals(d.width(),30,"Test padding specified with percent");
d.hide();equals(d.width(),30,"Test hidden div");d.css({display:"",border:"",padding:""});
SC.$("#nothiddendivchild").css({padding:"3px",border:"2px solid #fff"});equals(SC.$("#nothiddendivchild").width(),20,"Test child width with border and padding");
SC.$("#nothiddendiv, #nothiddendivchild").css({border:"",padding:"",width:""})});
test("height()",function(){expect(8);var d=SC.$("#nothiddendiv");d.height(30);equals(d.height(),30,"Test set to 30 correctly");
d.height(-1);equals(d.height(),30,"Test negative height ignored");d.css("padding","20px");
equals(d.height(),30,"Test padding specified with pixels");d.css("border","2px solid #fff");
equals(d.height(),30,"Test border specified with pixels");d.css("padding","2em");
var g=SC.browser.msie==8?29:30;equals(d.height(),g,"Test padding specified with ems");
d.css("border","1em solid #fff");equals(d.height(),30,"Test border specified with ems");
d.css("padding","2%");equals(d.height(),30,"Test padding specified with percent");
d.hide();equals(d.height(),30,"Test hidden div");d.css({display:"",border:"",padding:"",height:"1px"})
});test("text()",function(){expect(1);var d='This link has class="blog": Simon Willison\'s Weblog';
equals(SC.$("#sap").text(),d,"Check for merged text of more then one element.")});
test("append(String|Element|Array&lt;Element&gt;|SC.$)",function(){expect(21);var k="Try them out:";
var g=SC.$("#first").append("<b>buga</b>");equals(g.text(),k+"buga","Check if text appending works");
var n=SC.$("#select3").append('<option value="appendTest">Append Test</option>').find("option");
equals(SC.$(n[n.length-1]).attr("value"),"appendTest","Appending html options to select element");
reset();var m='This link has class="blog": Simon Willison\'s WeblogTry them out:';
SC.$("#sap").append(document.getElementById("first"));equals(SC.$("#sap").text(),m,"Check for appending of element");
reset();m='This link has class="blog": Simon Willison\'s WeblogTry them out:Yahoo';
SC.$("#sap").append([document.getElementById("first"),document.getElementById("yahoo")]);
equals(SC.$("#sap").text(),m,"Check for appending of array of elements");reset();
m='This link has class="blog": Simon Willison\'s WeblogTry them out:Yahoo';SC.$("#sap").append(SC.$("#first, #yahoo"));
equals(m,SC.$("#sap").text(),"Check for appending of SC.$ object");reset();SC.$("#sap").append(5);
ok(SC.$("#sap")[0].innerHTML.match(/5$/),"Check for appending a number");reset();
SC.$("#sap").append(" text with spaces ");ok(SC.$("#sap")[0].innerHTML.match(/ text with spaces $/),"Check for appending text with spaces");
reset();ok(SC.$("#sap").append([]),"Check for appending an empty array.");ok(SC.$("#sap").append(""),"Check for appending an empty string.");
ok(SC.$("#sap").append(document.getElementsByTagName("foo")),"Check for appending an empty nodelist.");
reset();SC.$("#sap").append(document.getElementById("form"));equals(SC.$("#sap>form").size(),1,"Check for appending a form");
reset();var l=true;try{SC.$(SC.$("#iframe")[0].contentWindow.document.body).append("<div>test</div>")
}catch(o){l=false}ok(l,"Test for appending a DOM node to the contents of an IFrame");
reset();SC.$("<fieldset/>").appendTo("#form").append('<legend id="legend">test</legend>');
t("Append legend","#legend",["legend"]);reset();SC.$("#select1").append("<OPTION>Test</OPTION>");
equals(SC.$("#select1 option").last().text(),"Test","Appending <OPTION>; (all caps)");
SC.$("#table").append("<colgroup></colgroup>");ok(SC.$("#table colgroup").length,"Append colgroup");
SC.$("#table colgroup").append("<col/>");ok(SC.$("#table colgroup col").length,"Append col");
reset();SC.$("#table").append("<caption></caption>");ok(SC.$("#table caption").length,"Append caption");
reset();SC.$("form").last().append('<select id="appendSelect1"></select>').append('<select id="appendSelect2"><option>Test</option></select>');
t("Append Select","#appendSelect1, #appendSelect2",["appendSelect1","appendSelect2"]);
var h=SC.$("#nonnodes").contents();var p=SC.$("<div/>").appendTo("#nonnodes").append(h);
equals(SC.$("#nonnodes").length,1,"Check node,textnode,comment append moved leaving just the div");
ok(p.contents().length>=2,"Check node,textnode,comment append works");p.contents().appendTo("#nonnodes");
p.remove();ok(SC.$("#nonnodes").contents().length>=2,"Check node,textnode,comment append cleanup worked")
});test("prepend(String|Element|Array&lt;Element&gt;|SC.$)",function(){expect(5);
var e="Try them out:";var d=SC.$("#first").prepend("<b>buga</b>");equals(d.text(),"buga"+e,"Check if text prepending works");
equals(SC.$("#select3").prepend('<option value="prependTest">Prepend Test</option>').find("option").first().attr("value"),"prependTest","Prepending html options to select element");
reset();var g='Try them out:This link has class="blog": Simon Willison\'s Weblog';
SC.$("#sap").prepend(document.getElementById("first"));equals(g,SC.$("#sap").text(),"Check for prepending of element");
reset();g='Try them out:YahooThis link has class="blog": Simon Willison\'s Weblog';
SC.$("#sap").prepend([document.getElementById("first"),document.getElementById("yahoo")]);
equals(g,SC.$("#sap").text(),"Check for prepending of array of elements");reset();
g='Try them out:YahooThis link has class="blog": Simon Willison\'s Weblog';SC.$("#sap").prepend(SC.$("#first, #yahoo"));
equals(g,SC.$("#sap").text(),"Check for prepending of SC.$ object")});test("before(String|Element|Array&lt;Element&gt;|SC.$)",function(){expect(4);
var d="This is a normal link: bugaYahoo";SC.$("#yahoo").before("<b>buga</b>");equals(d,SC.$("#en").text(),"Insert String before");
reset();d="This is a normal link: Try them out:Yahoo";SC.$("#yahoo").before(document.getElementById("first"));
equals(d,SC.$("#en").text(),"Insert element before");reset();d="This is a normal link: Try them out:diveintomarkYahoo";
SC.$("#yahoo").before([document.getElementById("first"),document.getElementById("mark")]);
equals(d,SC.$("#en").text(),"Insert array of elements before");reset();d="This is a normal link: Try them out:diveintomarkYahoo";
SC.$("#yahoo").before(SC.$("#first, #mark"));equals(d,SC.$("#en").text(),"Insert SC.$ before")
});test("after(String|Element|Array&lt;Element&gt;|SC.$)",function(){expect(4);var d="This is a normal link: Yahoobuga";
SC.$("#yahoo").after("<b>buga</b>");equals(d,SC.$("#en").text(),"Insert String after");
reset();d="This is a normal link: YahooTry them out:";SC.$("#yahoo").after(document.getElementById("first"));
equals(d,SC.$("#en").text(),"Insert element after");reset();d="This is a normal link: YahooTry them out:diveintomark";
SC.$("#yahoo").after([document.getElementById("first"),document.getElementById("mark")]);
equals(d,SC.$("#en").text(),"Insert array of elements after");reset();d="This is a normal link: YahooTry them out:diveintomark";
SC.$("#yahoo").after(SC.$("#first, #mark"));equals(d,SC.$("#en").text(),"Insert SC.$ after")
});test("replaceWith(String|Element|Array&lt;Element&gt;|SC.$)",function(){expect(10);
SC.$("#yahoo").replaceWith('<b id="replace">buga</b>');ok(SC.$("#replace")[0],"Replace element with string");
ok(!SC.$("#yahoo")[0],"Verify that original element is gone, after string");reset();
SC.$("#yahoo").replaceWith(document.getElementById("first"));ok(SC.$("#first")[0],"Replace element with element");
ok(!SC.$("#yahoo")[0],"Verify that original element is gone, after element");reset();
SC.$("#yahoo").replaceWith([document.getElementById("first"),document.getElementById("mark")]);
ok(SC.$("#first")[0],"Replace element with array of elements");ok(SC.$("#mark")[0],"Replace element with array of elements");
ok(!SC.$("#yahoo")[0],"Verify that original element is gone, after array of elements");
reset();SC.$("#yahoo").replaceWith(SC.$("#first, #mark"));ok(SC.$("#first")[0],"Replace element with set of elements");
ok(SC.$("#mark")[0],"Replace element with set of elements");ok(!SC.$("#yahoo")[0],"Verify that original element is gone, after set of elements")
});test("end()",function(){expect(3);equals("Yahoo",SC.$("#yahoo").parent().end().text(),"Check for end");
ok(SC.$("#yahoo").end(),"Check for end with nothing to end");var d=SC.$("#yahoo");
d.parent();equals("Yahoo",SC.$("#yahoo").text(),"Check for non-destructive behaviour")
});test("find(String)",function(){expect(2);equals("Yahoo",SC.$("#foo").find(".blogTest").text(),"Check for find");
var d=SC.$("#nonnodes").contents();equals(d.find("div").length,0,"Check node,textnode,comment to find zero divs")
});test("clone()",function(){expect(20);equals("This is a normal link: Yahoo",SC.$("#en").text(),"Assert text for #en");
var k=SC.$("#yahoo").clone();equals("Try them out:Yahoo",SC.$("#first").append(k).text(),"Check for clone");
equals("This is a normal link: Yahoo",SC.$("#en").text(),"Reassert text for #en");
var h=["<table/>","<tr/>","<td/>","<div/>","<button/>","<ul/>","<ol/>","<li/>","<input type='checkbox' />","<select/>","<option/>","<textarea/>","<tbody/>","<thead/>","<tfoot/>","<iframe/>"];
for(var g=0;g<h.length;g++){var e=SC.$(h[g]);equals(e[0].tagName,e.clone()[0].tagName,"Clone a &lt;"+h[g].substring(1))
}var d=SC.$("#nonnodes").contents().clone();ok(d.length>=2,"Check node,textnode,comment clone works (some browsers delete comments on clone)")
});test("is(String)",function(){expect(10);ok(SC.$("#form").is("form"),"Check for element: A form must be a form");
ok(!SC.$("#form").is("div"),"Check for element: A form is not a div");ok(SC.$("#mark").is(".blog"),'Check for class: Expected class "blog"');
ok(!SC.$("#mark").is(".link"),'Check for class: Did not expect class "link"');ok(SC.$("#simon").is(".blog.link"),'Check for multiple classes: Expected classes "blog" and "link"');
ok(!SC.$("#simon").is(".blogTest"),'Check for multiple classes: Expected classes "blog" and "link", but not "blogTest"');
ok(!SC.$("#foo").is(0),"Expected false for an invalid expression - 0");ok(!SC.$("#foo").is(null),"Expected false for an invalid expression - null");
ok(!SC.$("#foo").is(""),'Expected false for an invalid expression - ""');ok(!SC.$("#foo").is(undefined),"Expected false for an invalid expression - undefined")
});test("val()",function(){expect(8);equals(SC.$("#text1").val(),"Test","Check for value of input element");
equals(SC.$("#first").val(),"","Check a paragraph element to see if it has a value");
ok(SC.$([]).val()===undefined,"Check an empty SC.$ object will return undefined from val");
equals(SC.$("#select2").val(),"3",'Call val() on a single="single" select');same(SC.$("#select3").val(),["1","2"],'Call val() on a multiple="multiple" select');
equals(SC.$("#option3c").val(),"2","Call val() on a option element with value");equals(SC.$("#option3a").val(),"","Call val() on a option element with empty value");
equals(SC.$("#option3e").val(),"no value","Call val() on a option element with no value attribute")
});test("val(String/Number)",function(){expect(6);document.getElementById("text1").value="bla";
equals(SC.$("#text1").val(),"bla","Check for modified value of input element");SC.$("#text1").val("test");
equals(document.getElementById("text1").value,"test","Check for modified (via val(String)) value of input element");
SC.$("#text1").val(67);equals(document.getElementById("text1").value,"67","Check for modified (via val(Number)) value of input element");
SC.$("#select1").val("3");equals(SC.$("#select1").val(),"3","Check for modified (via val(String)) value of select element");
SC.$("#select1").val(2);equals(SC.$("#select1").val(),"2","Check for modified (via val(Number)) value of select element");
var d=SC.$("#nonnodes").contents();d.val("asdf");equals(d.val(),"asdf","Check node,textnode,comment with val()");
d.removeAttr("value")});var scriptorder=0;test("html(String)",function(){expect(5);
var k=SC.$("#main > div");k.html("<b>test</b>");var h=true;for(var g=0;g<k.size();
g++){if(k.get(g).childNodes.length!=1){h=false}}ok(h,"Set HTML");reset();var e=SC.$("#nonnodes").contents();
e.html("<b>bold</b>");e.find("b").removeData();ok((e.html().toLowerCase().match(/<b(\w*|\s*\=*|\"*)*>bold<\/b>/).length>0),"Check node,textnode,comment with html()");
SC.$("#main").html("<select/>");SC.$("#main select").html("<option>O1</option><option selected='selected'>O2</option><option>O3</option>");
equals(SC.$("#main select").val(),"O2","Selected option correct");var d=SC.$("<div />");
equals(d.html(5).html(),"5","Setting a number as html");equals(d.html(0).html(),"0","Setting a zero as html")
});test("filter()",function(){expect(5);same(SC.$("p").filter("#ap, #sndp").get(),q("ap","sndp"),"filter('String, String')");
same(SC.$("p").filter("#ap,#sndp").get(),q("ap","sndp"),"filter('String,String')");
same(SC.$("p").filter(function(){return !SC.$("a",this).length}).get(),q("sndp","first"),"filter(Function)");
var d=SC.$("#nonnodes").contents();equals(d.filter("span").length,1,"Check node,textnode,comment to filter the one span");
equals(d.filter("[name]").length,0,"Check node,textnode,comment to filter the one span")
});test("not()",function(){expect(8);equals(SC.$("#main p#ap a").length,4,"base before not should return A");
equals(SC.$("#main p#ap a").not("#google").length,3,"not('selector')");equals(SC.$("#main p#ap a").not(document.getElementById("google")).length,3,"not(DOMElement)");
same(SC.$("p").not(".result").get(),q("firstp","ap","sndp","en","sap","first"),"not('.class')");
same(SC.$("p").not("#ap, #sndp, .result").get(),q("firstp","en","sap","first"),"not('selector, selector')");
same(SC.$("p").not(SC.$("#ap, #sndp, .result")).get(),q("firstp","en","sap","first"),"not(SC.$)");
equals(SC.$("p").not(document.getElementsByTagName("p")).length,0,"not(Array-like DOM collection)");
var d=SC.$("#form select");isSet(d.not(d[1]),q("select1","select3"),"filter out DOM element")
});test("andSelf()",function(){expect(4);same(SC.$("#en").siblings().andSelf().get(),q("sndp","sap","en"),"Check for siblings and self");
same(SC.$("#foo").children().andSelf().get(),q("sndp","en","sap","foo"),"Check for children and self");
same(SC.$("#en, #sndp").parent().andSelf().get(),q("foo","en","sndp"),"Check for parent and self");
same(SC.$("#groups").parents("p, div").andSelf().get(),q("ap","main","groups"),"Check for parents and self")
});test("siblings([String])",function(){expect(3);same(SC.$("#en").siblings().get(),q("sndp","sap"),"Check for siblings");
same(SC.$("#foo").siblings("form, b").get(),q("form","lengthtest","testForm","floatTest"),"Check for multiple filters");
same(SC.$("#en, #sndp").siblings().get(),q("sndp","sap","en"),"Check for unique results from siblings")
});test("children([String])",function(){expect(2);same(SC.$("#foo").children().get(),q("sndp","en","sap"),"Check for children");
same(SC.$("#foo").children("#en, #sap").get(),q("en","sap"),"Check for multiple filters")
});test("parent([String])",function(){expect(5);equals(SC.$("#groups").parent()[0].id,"ap","Simple parent check");
equals(SC.$("#groups").parent("p")[0].id,"ap","Filtered parent check");equals(SC.$("#groups").parent("div").length,0,"Filtered parent check, no match");
equals(SC.$("#groups").parent("div, p")[0].id,"ap","Check for multiple filters");
same(SC.$("#en, #sndp").parent().get(),q("foo"),"Check for unique results from parent")
});test("parents([String])",function(){expect(4);equals(SC.$("#groups").parents()[0].id,"ap","Simple parents check");
equals(SC.$("#groups").parents("p")[0].id,"ap","Filtered parents check");equals(SC.$("#groups").parents("div")[0].id,"main","Filtered parents check2");
same(SC.$("#groups").parents("p, div").get(),q("ap","main"),"Check for multiple filters")
});test("next([String])",function(){expect(4);equals(SC.$("#ap").next()[0].id,"foo","Simple next check");
equals(SC.$("#ap").next("div")[0].id,"foo","Filtered next check");equals(SC.$("#ap").next("p").length,0,"Filtered next check, no match");
equals(SC.$("#ap").next("div, p")[0].id,"foo","Multiple filters")});test("prev([String])",function(){expect(4);
equals(SC.$("#foo").prev()[0].id,"ap","Simple prev check");equals(SC.$("#foo").prev("p")[0].id,"ap","Filtered prev check");
equals(SC.$("#foo").prev("div").length,0,"Filtered prev check, no match");equals(SC.$("#foo").prev("p, div")[0].id,"ap","Multiple filters")
});test("addClass(String)",function(){expect(1);var g=SC.$("div");g.addClass("test");
var e=true;for(var d=0;d<g.size();d++){if(g.get(d).className.indexOf("test")==-1){e=false
}}ok(e,"Add Class")});test("removeClass(String) - simple",function(){expect(4);var h=SC.$("div",SC.$("#main")).addClass("test").removeClass("test"),g=true;
for(var e=0;e<h.size();e++){if(h.get(e).className.indexOf("test")!=-1){g=false}}ok(g,"Remove Class");
reset();var h=SC.$("div",SC.$("#main")).addClass("test").addClass("foo").addClass("bar");
h.removeClass("test").removeClass("bar").removeClass("foo");var g=true;for(var e=0;
e<h.size();e++){if(h.get(e).className.match(/test|bar|foo/)){g=false}}ok(g,"Remove multiple classes");
reset();var h=SC.$("div").first().addClass("test").removeClass("");ok(h.is(".test"),"Empty string passed to removeClass");
var d=SC.$("#nonnodes").contents();d.removeClass("asdf");ok(!d.hasClass("asdf"),"Check node,textnode,comment for removeClass")
});test("toggleClass(String)",function(){expect(3);var d=SC.$("#firstp");ok(!d.is(".test"),"Assert class not present");
d.toggleClass("test");ok(d.is(".test"),"Assert class present");d.toggleClass("test");
ok(!d.is(".test"),"Assert class not present")});test("removeAttr(String",function(){expect(1);
equals(SC.$("#mark").removeAttr("class")[0].className,"","remove class")});test("text(String)",function(){expect(4);
equals(SC.$("#foo").text("<div><b>Hello</b> cruel world!</div>")[0].innerHTML,"&lt;div&gt;&lt;b&gt;Hello&lt;/b&gt; cruel world!&lt;/div&gt;","Check escaped text");
var d=SC.$("#nonnodes").contents();d.text("hi!");equals(SC.$(d[0]).text(),"hi!","Check node,textnode,comment with text()");
equals(d[1].nodeValue," there ","Check node,textnode,comment with text()");equals(d[2].nodeType,8,"Check node,textnode,comment with text()")
});test("remove()",function(){expect(6);SC.$("#ap").children().remove();ok(SC.$("#ap").text().length>10,"Check text is not removed");
equals(SC.$("#ap").children().length,0,"Check remove");reset();SC.$("#ap").children().remove("a");
ok(SC.$("#ap").text().length>10,"Check text is not removed");equals(SC.$("#ap").children().length,1,"Check filtered remove");
equals(SC.$("#nonnodes").contents().length,3,"Check node,textnode,comment remove works");
SC.$("#nonnodes").contents().remove();equals(SC.$("#nonnodes").contents().length,0,"Check node,textnode,comment remove works")
});test("empty()",function(){expect(3);equals(SC.$("#ap").children().empty().text().length,0,"Check text is removed");
equals(SC.$("#ap").children().length,4,"Check elements are not removed");var d=SC.$("#nonnodes").contents();
d.empty();equals(d.html(),"","Check node,textnode,comment empty works")});test("slice()",function(){expect(6);
var d=SC.$("#ap a");isSet(d.slice(1,2),q("groups"),"slice(1,2)");isSet(d.slice(1),q("groups","anchor1","mark"),"slice(1)");
isSet(d.slice(0,3),q("google","groups","anchor1"),"slice(0,3)");isSet(d.slice(-1),q("mark"),"slice(-1)");
isSet(d.eq(1),q("groups"),"eq(1)");isSet(d.eq("2"),q("anchor1"),"eq('2')")});test("SC.$.makeArray",function(){expect(14);
equals(SC.$.makeArray(SC.$("html>*"))[0].nodeName,"HEAD","Pass makeArray a SC.$ object");
equals(SC.$.makeArray(document.getElementsByName("PWD")).slice(0,1)[0].name,"PWD","Pass makeArray a nodelist");
equals((function(){return SC.$.makeArray(arguments)})(1,2).join(""),"12","Pass makeArray an arguments array");
equals(SC.$.makeArray([1,2,3]).join(""),"123","Pass makeArray a real array");equals(SC.$.makeArray().length,0,"Pass nothing to makeArray and expect an empty array");
equals(SC.$.makeArray(0)[0],0,"Pass makeArray a number");equals(SC.$.makeArray("foo")[0],"foo","Pass makeArray a string");
equals(SC.$.makeArray(true)[0].constructor,Boolean,"Pass makeArray a boolean");equals(SC.$.makeArray(document.createElement("div"))[0].nodeName,"DIV","Pass makeArray a single node");
equals(SC.$.makeArray({length:2,0:"a",1:"b"}).join(""),"ab","Pass makeArray an array like map (with length)");
ok(!!SC.$.makeArray(document.documentElement.childNodes).slice(0,1)[0].nodeName,"Pass makeArray a childNodes array");
equals(SC.$.makeArray(window)[0],window,"Pass makeArray the window");equals(SC.$.makeArray(/a/)[0].constructor,RegExp,"Pass makeArray a regex");
ok(SC.$.makeArray(document.getElementById("form")).length>=13,"Pass makeArray a form (treat as elements)")
});module("CoreQuery.map()");test("should return value of function",function(){var e=[1,2,3,4];
var g=e.map(function(h){return{value:h}});var d=SC.CoreQuery.map(g,function(h){return h.value
});same(d,e,"return values of result")});test("should exclude null values",function(){var e=[1,null,3,null];
var g=e.map(function(h){return{value:h}});var d=SC.CoreQuery.map(g,function(h){return h.value
});same(d.length,2,"number of results");same(d,[1,3],"return values of result")});
htmlbody('<!-- Test Styles --><style>body, div, h1 { font-family: "trebuchet ms", verdana, arial; margin: 0; padding: 0 }body {font-size: 10pt; }h1 { padding: 15px; font-size: large; background-color: #06b; color: white; }h1 a { color: white; }h2 { padding: 10px; background-color: #eee; color: black; margin: 0; font-size: small; font-weight: normal }.pass { color: green; } .fail { color: red; } p.result { margin-left: 1em; }#banner { height: 2em; border-bottom: 1px solid white; }h2.pass { background-color: green; }h2.fail { background-color: red; }div.testrunner-toolbar { background: #eee; border-top: 1px solid black; padding: 10px; }ol#tests > li > strong { cursor:pointer; }div#fx-tests h4 {	background: red;}div#fx-tests h4.pass {	background: green;}div#fx-tests div.box {	background: red url(data/cow.jpg) no-repeat;	overflow: hidden;	border: 2px solid #000;}div#fx-tests div.overflow {	overflow: visible;}div.inline {	display: inline;}div.autoheight {	height: auto;}div.autowidth {	width: auto;}div.autoopacity {	opacity: auto;}div.largewidth {	width: 100px;}div.largeheight {	height: 100px;}div.largeopacity {	filter: progid:DXImageTransform.Microsoft.Alpha(opacity=100);}div.medwidth {	width: 50px;}div.medheight {	height: 50px;}div.medopacity {	opacity: 0.5;	filter: progid:DXImageTransform.Microsoft.Alpha(opacity=50);}div.nowidth {	width: 0px;}div.noheight {	height: 0px;}div.noopacity {	opacity: 0;	filter: progid:DXImageTransform.Microsoft.Alpha(opacity=0);}div.hidden {	display: none;}div#fx-tests div.widewidth {	background-repeat: repeat-x;}div#fx-tests div.wideheight {	background-repeat: repeat-y;}div#fx-tests div.widewidth.wideheight {	background-repeat: repeat;}div#fx-tests div.noback {	background-image: none;}div.chain, div.chain div { width: 100px; height: 20px; position: relative; float: left; }div.chain div { position: absolute; top: 0px; left: 0px; }div.chain.test { background: red; }div.chain.test div { background: green; }div.chain.out { background: green; }div.chain.out div { background: red; display: none; }div#show-tests * { display: none; }</style><!-- Test HTML --><div id="nothiddendiv" style="height:1px;background:white;">	<div id="nothiddendivchild"></div></div><!-- this iframe is outside the #main so it won\'t reload constantly wasting time, but it means the tests must be "safe" and clean up after themselves --><iframe id="loadediframe" name="loadediframe" style="display:none;" src="data/iframe.html"></iframe><dl id="dl" style="display:none;"><div id="main" style="display: none;">	<p id="firstp">See <a id="simon1" href="http://simon.incutio.com/archive/2003/03/25/#getElementsBySelector" rel="bookmark">this blog entry</a> for more information.</p>	<p id="ap">		Here are some links in a normal paragraph: <a id="google" href="http://www.google.com/" title="Google!">Google</a>, 		<a id="groups" href="http://groups.google.com/">Google Groups</a>. 		This link has <code><a href="http://smin" id="anchor1">class="blog"</a></code>: 		<a href="http://diveintomark.org/" class="blog" hreflang="en" id="mark">diveintomark</a>	</p>	<div id="foo">		<p id="sndp">Everything inside the red border is inside a div with <code>id="foo"</code>.</p>		<p lang="en" id="en">This is a normal link: <a id="yahoo" href="http://www.yahoo.com/" class="blogTest">Yahoo</a></p>		<p id="sap">This link has <code><a href="#2" id="anchor2">class="blog"</a></code>: <a href="http://simon.incutio.com/" class="blog link" id="simon">Simon Willison\'s Weblog</a></p>	</div>	<p id="first">Try them out:</p>	<ul id="firstUL"></ul>	<ol id="empty"></ol>	<form id="form" action="formaction">		<input type="text" name="action" value="Test" id="text1" maxlength="30"/>		<input type="text" name="text2" value="Test" id="text2" disabled="disabled"/>		<input type="radio" name="radio1" id="radio1" value="on"/>		<input type="radio" name="radio2" id="radio2" checked="checked"/>		<input type="checkbox" name="check" id="check1" checked="checked"/>		<input type="checkbox" id="check2" value="on"/>		<input type="hidden" name="hidden" id="hidden1"/>		<input type="text" style="display:none;" name="foo[bar]" id="hidden2"/>				<input type="text" id="name" name="name" value="name" />				<button id="button" name="button">Button</button>				<textarea id="area1" maxlength="30">foobar</textarea>				<select name="select1" id="select1">			<option id="option1a" class="emptyopt" value="">Nothing</option>			<option id="option1b" value="1">1</option>			<option id="option1c" value="2">2</option>			<option id="option1d" value="3">3</option>		</select>		<select name="select2" id="select2">			<option id="option2a" class="emptyopt" value="">Nothing</option>			<option id="option2b" value="1">1</option>			<option id="option2c" value="2">2</option>			<option id="option2d" selected="selected" value="3">3</option>		</select>		<select name="select3" id="select3" multiple="multiple">			<option id="option3a" class="emptyopt" value="">Nothing</option>			<option id="option3b" selected="selected" value="1">1</option>			<option id="option3c" selected="selected" value="2">2</option>			<option id="option3d" value="3">3</option>			<option id="option3e">no value</option>		</select>				<object id="object1" codebase="stupid">			<param name="p1" value="x1" />			<param name="p2" value="x2" />		</object>				<span id="台北Táiběi"></span>		<span id="台北" lang="中文"></span>		<span id="utf8class1" class="台北Táiběi 台北"></span>		<span id="utf8class2" class="台北"></span>		<span id="foo:bar" class="foo:bar"></span>		<span id="test.foo[5]bar" class="test.foo[5]bar"></span>				<foo_bar id="foobar">test element</foo_bar>	</form>	<b id="floatTest">Float test.</b>	<iframe id="iframe" name="iframe"></iframe>	<form id="lengthtest">		<input type="text" id="length" name="test"/>		<input type="text" id="idTest" name="id"/>	</form>	<table id="table"></table>		<div id="fx-queue">		<div id="fadein" class="chain test">fadeIn<div>fadeIn</div></div>		<div id="fadeout" class="chain test out">fadeOut<div>fadeOut</div></div>				<div id="show" class="chain test">show<div>show</div></div>		<div id="hide" class="chain test out">hide<div>hide</div></div>				<div id="togglein" class="chain test">togglein<div>togglein</div></div>		<div id="toggleout" class="chain test out">toggleout<div>toggleout</div> </div>					<div id="slideup" class="chain test">slideUp<div>slideUp</div></div>		<div id="slidedown" class="chain test out">slideDown<div>slideDown</div></div>				<div id="slidetogglein" class="chain test">slideToggleIn<div>slideToggleIn</div></div>		<div id="slidetoggleout" class="chain test out">slideToggleOut<div>slideToggleOut</div></div>	</div>		<div id="fx-tests"></div>	<form id="testForm" action="#" method="get">		<textarea name="T3" rows="2" cols="15">?Z</textarea>		<input type="hidden" name="H1" value="x" />		<input type="hidden" name="H2" />		<input name="PWD" type="password" value="" />		<input name="T1" type="text" />		<input name="T2" type="text" value="YES" readonly="readonly" />		<input type="checkbox" name="C1" value="1" />		<input type="checkbox" name="C2" />		<input type="radio" name="R1" value="1" />		<input type="radio" name="R1" value="2" />		<input type="text" name="My Name" value="me" />		<input type="reset" name="reset" value="NO" />		<select name="S1">			<option value="abc">ABC</option>			<option value="abc">ABC</option>			<option value="abc">ABC</option>		</select>		<select name="S2" multiple="multiple" size="3">			<option value="abc">ABC</option>			<option value="abc">ABC</option>			<option value="abc">ABC</option>		</select>		<select name="S3">			<option selected="selected">YES</option>		</select>		<select name="S4">			<option value="" selected="selected">NO</option>		</select>		<input type="submit" name="sub1" value="NO" />		<input type="submit" name="sub2" value="NO" />		<input type="image" name="sub3" value="NO" />		<button name="sub4" type="submit" value="NO">NO</button>		<input name="D1" type="text" value="NO" disabled="disabled" />		<input type="checkbox" checked="checked" disabled="disabled" name="D2" value="NO" />		<input type="radio" name="D3" value="NO" checked="checked" disabled="disabled" />		<select name="D4" disabled="disabled">			<option selected="selected" value="NO">NO</option>		</select>	</form>	<div id="moretests">		<form>			<div id="checkedtest" style="display:none;">				<input type="radio" class="radio" name="checkedtestradios" checked="checked"/>				<input type="radio" class="radio" name="checkedtestradios" value="on"/>				<input type="checkbox" class="checkbox" name="checkedtestcheckboxes" checked="checked"/>				<input type="checkbox" class="checkbox" name="checkedtestcheckboxes" />			</div>		</form>		<div id="nonnodes"><span>hi</span> there <!-- mon ami --></div>		<div id="t2037">			<div><div class="hidden">hidden</div></div>		</div>	</div></div></dl>');
module("dimensions");test("innerWidth()",function(){expect(3);var d=SC.$("#nothiddendiv");
d.css({margin:10,border:"2px solid #fff",width:30});equals(d.innerWidth(),30,"Test with margin and border");
d.css("padding","20px");equals(d.innerWidth(),70,"Test with margin, border and padding");
d.hide();equals(d.innerWidth(),70,"Test hidden div");d.css({display:"",border:"",padding:"",width:"",height:""})
});test("innerHeight()",function(){expect(3);var d=SC.$("#nothiddendiv");d.css({margin:10,border:"2px solid #fff",height:30});
equals(d.innerHeight(),30,"Test with margin and border");d.css("padding","20px");
equals(d.innerHeight(),70,"Test with margin, border and padding");d.hide();equals(d.innerHeight(),70,"Test hidden div");
d.css({display:"",border:"",padding:"",width:"",height:""})});test("outerWidth()",function(){expect(6);
var d=SC.$("#nothiddendiv");d.css("width",30);equals(d.outerWidth(),30,"Test with only width set");
d.css("padding","20px");equals(d.outerWidth(),70,"Test with padding");d.css("border","2px solid #fff");
equals(d.outerWidth(),74,"Test with padding and border");d.css("margin","10px");equals(d.outerWidth(),74,"Test with padding, border and margin without margin option");
d.css("position","absolute");equals(d.outerWidth(true),94,"Test with padding, border and margin with margin option");
d.hide();equals(d.outerWidth(true),94,"Test hidden div with padding, border and margin with margin option");
d.css({position:"",display:"",border:"",padding:"",width:"",height:""})});test("outerHeight()",function(){expect(6);
var d=SC.$("#nothiddendiv");d.css("height",30);equals(d.outerHeight(),30,"Test with only width set");
d.css("padding","20px");equals(d.outerHeight(),70,"Test with padding");d.css("border","2px solid #fff");
equals(d.outerHeight(),74,"Test with padding and border");d.css("margin","10px");
equals(d.outerHeight(),74,"Test with padding, border and margin without margin option");
equals(d.outerHeight(true),94,"Test with padding, border and margin with margin option");
d.hide();equals(d.outerHeight(true),94,"Test hidden div with padding, border and margin with margin option");
d.css({display:"",border:"",padding:"",width:"",height:""})});htmlbody('<!-- Test Styles --><style>body, div, h1 { font-family: "trebuchet ms", verdana, arial; margin: 0; padding: 0 }body {font-size: 10pt; }h1 { padding: 15px; font-size: large; background-color: #06b; color: white; }h1 a { color: white; }h2 { padding: 10px; background-color: #eee; color: black; margin: 0; font-size: small; font-weight: normal }.pass { color: green; } .fail { color: red; } p.result { margin-left: 1em; }#banner { height: 2em; border-bottom: 1px solid white; }h2.pass { background-color: green; }h2.fail { background-color: red; }div.testrunner-toolbar { background: #eee; border-top: 1px solid black; padding: 10px; }ol#tests > li > strong { cursor:pointer; }div#fx-tests h4 {	background: red;}div#fx-tests h4.pass {	background: green;}div#fx-tests div.box {	background: red url(data/cow.jpg) no-repeat;	overflow: hidden;	border: 2px solid #000;}div#fx-tests div.overflow {	overflow: visible;}div.inline {	display: inline;}div.autoheight {	height: auto;}div.autowidth {	width: auto;}div.autoopacity {	opacity: auto;}div.largewidth {	width: 100px;}div.largeheight {	height: 100px;}div.largeopacity {	filter: progid:DXImageTransform.Microsoft.Alpha(opacity=100);}div.medwidth {	width: 50px;}div.medheight {	height: 50px;}div.medopacity {	opacity: 0.5;	filter: progid:DXImageTransform.Microsoft.Alpha(opacity=50);}div.nowidth {	width: 0px;}div.noheight {	height: 0px;}div.noopacity {	opacity: 0;	filter: progid:DXImageTransform.Microsoft.Alpha(opacity=0);}div.hidden {	display: none;}div#fx-tests div.widewidth {	background-repeat: repeat-x;}div#fx-tests div.wideheight {	background-repeat: repeat-y;}div#fx-tests div.widewidth.wideheight {	background-repeat: repeat;}div#fx-tests div.noback {	background-image: none;}div.chain, div.chain div { width: 100px; height: 20px; position: relative; float: left; }div.chain div { position: absolute; top: 0px; left: 0px; }div.chain.test { background: red; }div.chain.test div { background: green; }div.chain.out { background: green; }div.chain.out div { background: red; display: none; }div#show-tests * { display: none; }</style><!-- Test HTML --><div id="nothiddendiv" style="height:1px;background:white;">	<div id="nothiddendivchild"></div></div><!-- this iframe is outside the #main so it won\'t reload constantly wasting time, but it means the tests must be "safe" and clean up after themselves --><iframe id="loadediframe" name="loadediframe" style="display:none;" src="data/iframe.html"></iframe><dl id="dl" style="display:none;"><div id="main" style="display: none;">	<p id="firstp">See <a id="simon1" href="http://simon.incutio.com/archive/2003/03/25/#getElementsBySelector" rel="bookmark">this blog entry</a> for more information.</p>	<p id="ap">		Here are some links in a normal paragraph: <a id="google" href="http://www.google.com/" title="Google!">Google</a>, 		<a id="groups" href="http://groups.google.com/">Google Groups</a>. 		This link has <code><a href="http://smin" id="anchor1">class="blog"</a></code>: 		<a href="http://diveintomark.org/" class="blog" hreflang="en" id="mark">diveintomark</a>	</p>	<div id="foo">		<p id="sndp">Everything inside the red border is inside a div with <code>id="foo"</code>.</p>		<p lang="en" id="en">This is a normal link: <a id="yahoo" href="http://www.yahoo.com/" class="blogTest">Yahoo</a></p>		<p id="sap">This link has <code><a href="#2" id="anchor2">class="blog"</a></code>: <a href="http://simon.incutio.com/" class="blog link" id="simon">Simon Willison\'s Weblog</a></p>	</div>	<p id="first">Try them out:</p>	<ul id="firstUL"></ul>	<ol id="empty"></ol>	<form id="form" action="formaction">		<input type="text" name="action" value="Test" id="text1" maxlength="30"/>		<input type="text" name="text2" value="Test" id="text2" disabled="disabled"/>		<input type="radio" name="radio1" id="radio1" value="on"/>		<input type="radio" name="radio2" id="radio2" checked="checked"/>		<input type="checkbox" name="check" id="check1" checked="checked"/>		<input type="checkbox" id="check2" value="on"/>		<input type="hidden" name="hidden" id="hidden1"/>		<input type="text" style="display:none;" name="foo[bar]" id="hidden2"/>				<input type="text" id="name" name="name" value="name" />				<button id="button" name="button">Button</button>				<textarea id="area1" maxlength="30">foobar</textarea>				<select name="select1" id="select1">			<option id="option1a" class="emptyopt" value="">Nothing</option>			<option id="option1b" value="1">1</option>			<option id="option1c" value="2">2</option>			<option id="option1d" value="3">3</option>		</select>		<select name="select2" id="select2">			<option id="option2a" class="emptyopt" value="">Nothing</option>			<option id="option2b" value="1">1</option>			<option id="option2c" value="2">2</option>			<option id="option2d" selected="selected" value="3">3</option>		</select>		<select name="select3" id="select3" multiple="multiple">			<option id="option3a" class="emptyopt" value="">Nothing</option>			<option id="option3b" selected="selected" value="1">1</option>			<option id="option3c" selected="selected" value="2">2</option>			<option id="option3d" value="3">3</option>			<option id="option3e">no value</option>		</select>				<object id="object1" codebase="stupid">			<param name="p1" value="x1" />			<param name="p2" value="x2" />		</object>				<span id="台北Táiběi"></span>		<span id="台北" lang="中文"></span>		<span id="utf8class1" class="台北Táiběi 台北"></span>		<span id="utf8class2" class="台北"></span>		<span id="foo:bar" class="foo:bar"></span>		<span id="test.foo[5]bar" class="test.foo[5]bar"></span>				<foo_bar id="foobar">test element</foo_bar>	</form>	<b id="floatTest">Float test.</b>	<iframe id="iframe" name="iframe"></iframe>	<form id="lengthtest">		<input type="text" id="length" name="test"/>		<input type="text" id="idTest" name="id"/>	</form>	<table id="table"></table>		<div id="fx-queue">		<div id="fadein" class="chain test">fadeIn<div>fadeIn</div></div>		<div id="fadeout" class="chain test out">fadeOut<div>fadeOut</div></div>				<div id="show" class="chain test">show<div>show</div></div>		<div id="hide" class="chain test out">hide<div>hide</div></div>				<div id="togglein" class="chain test">togglein<div>togglein</div></div>		<div id="toggleout" class="chain test out">toggleout<div>toggleout</div> </div>					<div id="slideup" class="chain test">slideUp<div>slideUp</div></div>		<div id="slidedown" class="chain test out">slideDown<div>slideDown</div></div>				<div id="slidetogglein" class="chain test">slideToggleIn<div>slideToggleIn</div></div>		<div id="slidetoggleout" class="chain test out">slideToggleOut<div>slideToggleOut</div></div>	</div>		<div id="fx-tests"></div>	<form id="testForm" action="#" method="get">		<textarea name="T3" rows="2" cols="15">?Z</textarea>		<input type="hidden" name="H1" value="x" />		<input type="hidden" name="H2" />		<input name="PWD" type="password" value="" />		<input name="T1" type="text" />		<input name="T2" type="text" value="YES" readonly="readonly" />		<input type="checkbox" name="C1" value="1" />		<input type="checkbox" name="C2" />		<input type="radio" name="R1" value="1" />		<input type="radio" name="R1" value="2" />		<input type="text" name="My Name" value="me" />		<input type="reset" name="reset" value="NO" />		<select name="S1">			<option value="abc">ABC</option>			<option value="abc">ABC</option>			<option value="abc">ABC</option>		</select>		<select name="S2" multiple="multiple" size="3">			<option value="abc">ABC</option>			<option value="abc">ABC</option>			<option value="abc">ABC</option>		</select>		<select name="S3">			<option selected="selected">YES</option>		</select>		<select name="S4">			<option value="" selected="selected">NO</option>		</select>		<input type="submit" name="sub1" value="NO" />		<input type="submit" name="sub2" value="NO" />		<input type="image" name="sub3" value="NO" />		<button name="sub4" type="submit" value="NO">NO</button>		<input name="D1" type="text" value="NO" disabled="disabled" />		<input type="checkbox" checked="checked" disabled="disabled" name="D2" value="NO" />		<input type="radio" name="D3" value="NO" checked="checked" disabled="disabled" />		<select name="D4" disabled="disabled">			<option selected="selected" value="NO">NO</option>		</select>	</form>	<div id="moretests">		<form>			<div id="checkedtest" style="display:none;">				<input type="radio" class="radio" name="checkedtestradios" checked="checked"/>				<input type="radio" class="radio" name="checkedtestradios" value="on"/>				<input type="checkbox" class="checkbox" name="checkedtestcheckboxes" checked="checked"/>				<input type="checkbox" class="checkbox" name="checkedtestcheckboxes" />			</div>		</form>		<div id="nonnodes"><span>hi</span> there <!-- mon ami --></div>		<div id="t2037">			<div><div class="hidden">hidden</div></div>		</div>	</div></div></dl>');
module("selector");test("element",function(){expect(7);ok(SC.$("*").size()>=30,"Select all");
var e=SC.$("*"),g=true;for(var d=0;d<e.length;d++){if(e[d].nodeType==8){g=false}}ok(g,"Select all elements, no comment nodes");
t("Element Selector","p",["firstp","ap","sndp","en","sap","first"]);t("Parent Element","div p",["firstp","ap","sndp","en","sap","first"]);
equals(SC.$("param","#object1").length,2,"Object/param as context");ok(SC.$("#length").length,'&lt;input name="length"&gt; cannot be found under IE, see #945');
ok(SC.$("#lengthtest input").length,'&lt;input name="length"&gt; cannot be found under IE, see #945')
});test("broken",function(){expect(7);t("Broken Selector","[",[]);t("Broken Selector","(",[]);
t("Broken Selector","{",[]);t("Broken Selector","<",[]);t("Broken Selector","()",[]);
t("Broken Selector","<>",[]);t("Broken Selector","{}",[])});test("id",function(){expect(13);
t("ID Selector w/ Element","ul#first",[]);t("ID selector with existing ID descendant","#firstp #simon1",["simon1"]);
t("ID selector with non-existant descendant","#firstp #foobar",[]);t("ID selector using UTF8","#台北Táiběi",["台北Táiběi"]);
t("Multiple ID selectors using UTF8","#台北Táiběi, #台北",["台北Táiběi","台北"]);t("Descendant ID selector using UTF8","div #台北",["台北"]);
t("Child ID selector using UTF8","form > #台北",["台北"]);t("ID Selector, not an ancestor ID","#form #first",[]);
var d=SC.$('<a name="tName1">tName1 A</a><a name="tName2">tName2 A</a><div id="tName1">tName1 Div</div>');
d.appendTo("#main");equals(SC.$("#tName1")[0].id,"tName1","ID selector with same value for a name attribute");
equals(SC.$("#tName2").length,0,"ID selector non-existing but name attribute on an A tag");
t("ID Selector on Form with an input that has a name of 'id'","#lengthtest",["lengthtest"]);
t("ID selector with non-existant ancestor","#asdfasdf #foobar",[]);same(SC.$("body").find("div#form").length,0,"ID selector within the context of another element")
});test("class",function(){expect(9);t("Class Selector",".blog",["mark","simon"]);
t("Class Selector",".blog.link",["simon"]);t("Class Selector w/ Element","a.blog",["mark","simon"]);
t("Parent Class Selector","p .blog",["mark","simon"]);t("Class selector using UTF8",".台北Táiběi",["utf8class1"]);
t("Class selector using UTF8",".台北",["utf8class1","utf8class2"]);t("Class selector using UTF8",".台北Táiběi.台北",["utf8class1"]);
t("Class selector using UTF8",".台北Táiběi, .台北",["utf8class1","utf8class2"]);t("Descendant class selector using UTF8","div .台北Táiběi",["utf8class1"])
});test("multiple",function(){expect(4);t("Comma Support","a.blog, p",["mark","simon","firstp","ap","sndp","en","sap","first"]);
t("Comma Support","a.blog , p",["mark","simon","firstp","ap","sndp","en","sap","first"]);
t("Comma Support","a.blog ,p",["mark","simon","firstp","ap","sndp","en","sap","first"]);
t("Comma Support","a.blog,p",["mark","simon","firstp","ap","sndp","en","sap","first"])
});module("CoreQuery.setClass()");test("setClass(existing, NO) should remove the class",function(){var d=SC.$('<div class="existing"></div>');
equals(d.hasClass("existing"),YES,"cq has existing");d.setClass("existing",NO);equals(d.hasClass("existing"),NO,"cq should not have existing")
});test("setClass(existing, YES) should do nothing",function(){var d=SC.$('<div class="existing"></div>');
equals(d.hasClass("existing"),YES,"cq has existing");d.setClass("existing",YES);equals(d.hasClass("existing"),YES,"cq should have existing")
});test("setClass(new, YES) should add the class",function(){var d=SC.$('<div class="existing"></div>');
equals(d.hasClass("new"),NO,"cq does not have new");d.setClass("new",YES);equals(d.hasClass("new"),YES,"cq should have new")
});test("setClass(new, NO) should do nothing",function(){var d=SC.$('<div class="existing"></div>');
equals(d.hasClass("new"),NO,"cq does not have new");d.setClass("new",NO);equals(d.hasClass("new"),NO,"cq does not have new")
});test("setClass(mixed, YES) should work across multiple",function(){var d=SC.$('<div class="root">    <div class="mixed match"></div>    <div class="match"></div>  </div>').find(".match");
equals(d.length,2,"should have two items");equals(d.hasClass("mixed"),NO,"should not all have mixed class");
d.setClass("mixed",YES);equals(d.hasClass("mixed"),YES,"now all should have mixed class")
});module("CoreQuery.within() && within()");test("should return if passed RAW element that is child",function(){var d=SC.$('<div class="root">    <div class="middle">      <div class="child1"></div>      <div class="child2"></div>    </div>  </div>');
var g=d.find(".child1");equals(d.within(g.get(0)),YES,"cq.within(DOMElement) = YES");
var e=SC.$('<div class="not-child"></div>');equals(d.within(e.get(0)),NO,"cq.hadChild(DOMElement) = NO");
g=e=d=null});test("should return if passed CQ with element that is child",function(){var d=SC.$('<div class="root">    <div class="middle">      <div class="child1"></div>      <div class="child2"></div>    </div>  </div>');
var g=d.find(".child1");equals(d.within(g),YES,"cq.within(DOMElement) = YES");var e=SC.$('<div class="not-child"></div>');
equals(d.within(e),NO,"cq.hadChild(DOMElement) = NO");g=e=d=null});test("should work if matched set has multiple element",function(){var d=SC.$('<div class="wrapper">    <div class="root"></div>    <div class="root"></div>    <div class="root">      <div class="middle">        <div class="child1"></div>        <div class="child2"></div>      </div>    </div>  </div>').find(".root");
equals(d.length,3,"should have three element in matched set");var g=d.find(".child1");
equals(d.within(g),YES,"cq.within(DOMElement) = YES");var e=SC.$('<div class="not-child"></div>');
equals(d.within(e),NO,"cq.hadChild(DOMElement) = NO");g=e=d=null});test("should return YES if matching self",function(){var d=SC.$("<div></div>");
equals(d.within(d),YES,"should not match")});module("Time");var dt,options,ms,timezone,startTime,timezones;
module("SC.DateTime",{setup:function(){ms=487054822032;options={year:1985,month:6,day:8,hour:4,minute:0,second:22,millisecond:32,timezone:60};
dt=SC.DateTime.create(options);timezones=[480,420,0,-60,-120,-330]},teardown:function(){dt=options=ms=timezone=startTime=null
}});function timeShouldBeEqualToHash(d,e){if(e===undefined){e=options}if(e.timezone===undefined){e.timezone=SC.DateTime.timezone
}equals(d.get("year"),e.year,"year");equals(d.get("month"),e.month,"month");equals(d.get("day"),e.day,"day");
equals(d.get("hour"),e.hour,"hour");equals(d.get("minute"),e.minute,"minute");equals(d.get("second"),e.second,"second");
equals(d.get("millisecond"),e.millisecond,"millisecond");equals(d.get("timezone"),e.timezone,"timezone")
}function formatTimezone(h){var d=h<0?"+":"-";h=Math.abs(h);var g=h%60;var e=(h-g)/60;
return d+SC.DateTime._pad(e)+":"+SC.DateTime._pad(g)}test("_toMilliseconds()",function(){var d=options.timezone;
var e=options.hour;dt=SC.DateTime;timezone=300;startTime=1264958583000;equals(dt._toMilliseconds(null,ms,timezone),ms,"Should equal start milliseconds when no options hash provided");
equals(dt._toMilliseconds({},ms,timezone),ms,"Should equal start milliseconds when empty options hash provided");
equals(dt._toMilliseconds(options,null,options.timezone),ms,"Milliseconds should express the parsed options hash");
options.hour=e-1;equals(dt._toMilliseconds(options,startTime,options.timezone+60),ms,"Should get same milliseconds when expressing time in westerly time zone");
options.hour=e+1;equals(dt._toMilliseconds(options,startTime,options.timezone-60),ms,"Should get same milliseconds when expressing time in easterly time zone");
options={hour:e-1};equals(dt._toMilliseconds(options,ms,d+60,NO),ms,"Should get same result modifying only the hour as expressed in westerly time zone");
options={hour:e+1};equals(dt._toMilliseconds(options,ms,d-60,NO),ms,"Should get same result modifying only the hour as expressed in westerly time zone")
});test("create with a hash",function(){timeShouldBeEqualToHash(dt,options)});test("create with local time milliseconds",function(){var g=new Date();
var e={year:g.getFullYear(),month:g.getMonth()+1,day:g.getDate(),hour:g.getHours(),minute:g.getMinutes(),second:g.getSeconds(),millisecond:g.getMilliseconds(),timezone:g.getTimezoneOffset()};
dt=SC.DateTime.create(g.getTime());timeShouldBeEqualToHash(dt,e);equals(SC.DateTime.create(0).get("milliseconds"),0,"Can create with 0 milliseconds")
});test("create with default time zone",function(){var e=new Date();timezone=e.getTimezoneOffset();
dt=SC.DateTime.create();equals(dt.get("timezone"),timezone,"Default time zone should be local")
});test("create with a hash containing milliseconds and a specified time zone",function(){dt=SC.DateTime.create({milliseconds:ms,timezone:options.timezone});
timeShouldBeEqualToHash(dt,options)});test("create with hashes expressed in various time zones",function(){timezones.forEach(function(d){options.timezone=d;
dt=SC.DateTime.create(options);timeShouldBeEqualToHash(dt,options)})});test("create with default time zone",function(){var e=new Date();
timezone=e.getTimezoneOffset();dt=SC.DateTime.create();equals(dt.get("timezone"),timezone,"Default time zone should be local")
});test("create with a hash containing milliseconds and a specified time zone",function(){dt=SC.DateTime.create({milliseconds:ms,timezone:options.timezone});
timeShouldBeEqualToHash(dt,options)});test("Adjust with hashes expressed in various time zones",function(){timezones.forEach(function(d){var e;
options.timezone=d;dt=SC.DateTime.create(options);timeShouldBeEqualToHash(dt.adjust({year:2005,month:9,day:30}),{year:2005,month:9,day:30,hour:options.hour,minute:options.minute,second:options.second,millisecond:options.millisecond,timezone:d});
timeShouldBeEqualToHash(dt.adjust({hour:3}),{year:options.year,month:options.month,day:options.day,hour:3,minute:0,second:0,millisecond:0,timezone:d});
timeShouldBeEqualToHash(dt.adjust({minute:1}),{year:options.year,month:options.month,day:options.day,hour:options.hour,minute:1,second:0,millisecond:0,timezone:d});
timeShouldBeEqualToHash(dt.adjust({second:12}),{year:options.year,month:options.month,day:options.day,hour:options.hour,minute:options.minute,second:12,millisecond:0,timezone:d});
timeShouldBeEqualToHash(dt.adjust({millisecond:18}),{year:options.year,month:options.month,day:options.day,hour:options.hour,minute:options.minute,second:options.second,millisecond:18,timezone:d});
e=Math.floor((options.hour+48+(d/60))%24);equals(dt.adjust({timezone:0}).get("hour"),e)
})});test("advance",function(){var g=options;timeShouldBeEqualToHash(dt.advance({year:1,month:1,day:1,hour:1,minute:1,second:1,millisecond:1}),{year:g.year+1,month:g.month+1,day:g.day+1,hour:g.hour+1,minute:g.minute+1,second:g.second+1,millisecond:g.millisecond+1,timezone:g.timezone});
timeShouldBeEqualToHash(dt.advance({year:1}),{year:g.year+1,month:g.month,day:g.day,hour:g.hour,minute:g.minute,second:g.second,millisecond:g.millisecond,timezone:g.timezone});
timeShouldBeEqualToHash(dt.advance({month:1}),{year:g.year,month:g.month+1,day:g.day,hour:g.hour,minute:g.minute,second:g.second,millisecond:g.millisecond,timezone:g.timezone});
timeShouldBeEqualToHash(dt.advance({day:1}),{year:g.year,month:g.month,day:g.day+1,hour:g.hour,minute:g.minute,second:g.second,millisecond:g.millisecond,timezone:g.timezone});
timeShouldBeEqualToHash(dt.advance({hour:1}),{year:g.year,month:g.month,day:g.day,hour:g.hour+1,minute:g.minute,second:g.second,millisecond:g.millisecond,timezone:g.timezone});
timeShouldBeEqualToHash(dt.advance({minute:1}),{year:g.year,month:g.month,day:g.day,hour:g.hour,minute:g.minute+1,second:g.second,millisecond:g.millisecond,timezone:g.timezone});
timeShouldBeEqualToHash(dt.advance({second:1}),{year:g.year,month:g.month,day:g.day,hour:g.hour,minute:g.minute,second:g.second+1,millisecond:g.millisecond,timezone:g.timezone});
timeShouldBeEqualToHash(dt.advance({millisecond:1}),{year:g.year,month:g.month,day:g.day,hour:g.hour,minute:g.minute,second:g.second,millisecond:g.millisecond+1,timezone:g.timezone});
var e={year:1985,month:5,day:8,hour:1,minute:0,second:22,millisecond:925,timezone:-120};
var d=SC.DateTime.create(e);timeShouldBeEqualToHash(d,e);timeShouldBeEqualToHash(d.advance({timezone:120}),{year:1985,month:5,day:7,hour:23,minute:0,second:22,millisecond:925,timezone:0});
timeShouldBeEqualToHash(d.advance({timezone:120}).advance({timezone:-330}),{year:1985,month:5,day:8,hour:4,minute:30,second:22,millisecond:925,timezone:-330});
equals(SC.DateTime.compare(d.advance({timezone:120}).advance({timezone:-330}),d.advance({timezone:-210})),0)
});test("compare",function(){var d=null;equals(SC.DateTime.isComparable,YES,"SC.DateTime is comparable");
equals(SC.compare(dt,dt),0,"A DateTime instance is equal to itself via compare()");
equals(dt.isEqual(dt),YES,"A DateTime instance is equal to itself via isEqual()");
equals(dt.advance({hour:1}).isEqual(dt),NO);equals(SC.compare(dt,dt.advance({hour:1})),-1);
equals(SC.compare(dt.advance({hour:1}),dt),1);equals(SC.DateTime.compareDate(dt,dt.advance({hour:1})),0);
equals(SC.DateTime.compareDate(dt,dt.adjust({hour:0}).advance({day:1,second:-1})),0);
equals(SC.DateTime.compareDate(dt,dt.adjust({hour:0}).advance({day:1})),-1);equals(SC.DateTime.compareDate(dt,dt.advance({day:1})),-1);
equals(SC.compare(SC.DateTime.create({year:1985,month:5,day:7,hour:23,minute:0,second:22,millisecond:925,timezone:0}),SC.DateTime.create({year:1985,month:5,day:8,hour:1,minute:0,second:22,millisecond:925,timezone:-120})),0,"The expressions of the same date in two different time zones are considered equal");
try{equals(SC.DateTime.compareDate(SC.DateTime.create({year:1985,month:5,day:7,hour:23,minute:0,second:22,millisecond:925,timezone:0}),SC.DateTime.create({year:1985,month:5,day:8,hour:1,minute:0,second:22,millisecond:925,timezone:-120})),0)
}catch(g){d=g}finally{ok(!SC.none(d),"Comparing two dates with a different timezone via compareDate() should throw an exception.")
}});test("Format",function(){equals(dt.toFormattedString("%a %A %b %B %d %H %I %j %m %M %p %S %w %y %Y %%a"),"Sat Saturday Jun June 08 04 04 159 06 00 AM 22 6 85 1985 %a");
equals(dt.toFormattedString("%Z"),formatTimezone(dt.get("timezone")));equals(dt.adjust({timezone:0}).toFormattedString("%Y-%m-%d %H:%M:%S %Z"),"1985-06-08 05:00:22 +00:00");
equals(dt.adjust({timezone:-120}).toFormattedString("%Y-%m-%d %H:%M:%S %Z"),"1985-06-08 07:00:22 +02:00");
equals(dt.adjust({timezone:420}).toFormattedString("%Y-%m-%d %H:%M:%S %Z"),"1985-06-07 22:00:22 -07:00")
});test("fancy getters",function(){equals(dt.get("isLeapYear"),NO);equals(SC.DateTime.create({year:1900,month:1,day:1}).get("isLeapYear"),NO);
equals(SC.DateTime.create({year:2000,month:1,day:1}).get("isLeapYear"),YES);equals(SC.DateTime.create({year:2004,month:1,day:1}).get("isLeapYear"),YES);
equals(dt.get("daysInMonth"),30);equals(SC.DateTime.create({year:2000,month:2,day:1}).get("daysInMonth"),29);
equals(SC.DateTime.create({year:2001,month:2,day:1}).get("daysInMonth"),28);equals(dt.get("dayOfYear"),159);
equals(SC.DateTime.create({year:2000,month:12,day:31}).get("dayOfYear"),366);equals(SC.DateTime.create({year:2001,month:12,day:31}).get("dayOfYear"),365);
equals(dt.get("week"),22);equals(SC.DateTime.create({year:2006,month:1,day:1}).get("week0"),1);
equals(SC.DateTime.create({year:2006,month:1,day:1}).get("week1"),0);equals(SC.DateTime.create({year:2006,month:1,day:8}).get("week0"),2);
equals(SC.DateTime.create({year:2006,month:1,day:8}).get("week1"),1);equals(SC.DateTime.create({year:2006,month:12,day:31}).get("week0"),53);
equals(SC.DateTime.create({year:2006,month:12,day:31}).get("week1"),52);equals(dt.get("lastMonday"),dt.advance({day:-5}),"dt.advance(day: -5)");
equals(dt.get("nextFriday"),dt.advance({day:6}),"dt.advance(day: 6)");equals(dt.get("lastWednesday"),dt.advance({day:-3}),"dt.advance(day: -3)")
});test("parse",function(){timeShouldBeEqualToHash(SC.DateTime.parse("08/05/1985 01:00:22 %a","%d/%m/%Y %H:%M:%S %%a"),{year:1985,month:5,day:8,hour:1,minute:0,second:22,millisecond:0});
timeShouldBeEqualToHash(SC.DateTime.parse("08/05/1985 01:00:22 PM","%d/%m/%Y %H:%M:%S %p"),{year:1985,month:5,day:8,hour:13,minute:0,second:22,millisecond:0});
timeShouldBeEqualToHash(SC.DateTime.parse("Wed 08 May 1985 01:00:22 AM","%a %d %b %Y %H:%M:%S %p"),{year:1985,month:5,day:8,hour:1,minute:0,second:22,millisecond:0});
ok(SC.DateTime.parse("Tue 08 May 1985 01:00:22 AM","%a %d %b %Y %H:%M:%S %p")===null,"1985-05-08 is not a tuesday");
timeShouldBeEqualToHash(SC.DateTime.parse("70-01-01 00:00:00","%y-%m-%d %H:%M:%S"),{year:2070,month:1,day:1,hour:0,minute:0,second:0,millisecond:0});
timeShouldBeEqualToHash(SC.DateTime.parse("71-01-01 00:00:00","%y-%m-%d %H:%M:%S"),{year:1971,month:1,day:1,hour:0,minute:0,second:0,millisecond:0})
});test("parse with time zones",function(){equals(SC.DateTime.parse("08/05/1985 01:00:22 %a -0700","%d/%m/%Y %H:%M:%S %%a %Z").toISO8601(),"1985-05-08T01:00:22-07:00");
equals(SC.DateTime.parse("08/05/1985 01:00:22 %a +02:00","%d/%m/%Y %H:%M:%S %%a %Z").toISO8601(),"1985-05-08T01:00:22+02:00");
equals(SC.DateTime.parse("07/01/2020 18:33:22 %a Z","%d/%m/%Y %H:%M:%S %%a %Z").toISO8601(),"2020-01-07T18:33:22+00:00")
});test("binding",function(){var g=SC.Object.create({value:dt});var e=SC.Object.create({value:""});
var d="%Y-%m-%d %H:%M:%S";var h=SC.Binding.dateTime(d).from("value",g).to("value",e).connect();
SC.Binding.flushPendingChanges();equals(e.get("value"),dt.toFormattedString(d))});
test("cache",function(){SC.DateTime.create(options);var e=SC.keys(SC.DateTime._dt_cache).length;
SC.DateTime.create(options);var d=SC.keys(SC.DateTime._dt_cache).length;equals(e,d,"Creating twice the same datetime should not modify the cache's length");
var h=[];for(var g=0;g<3*SC.DateTime._DT_CACHE_MAX_LENGTH;g++){h[g]=SC.DateTime.create(g)
}ok(SC.keys(SC.DateTime._dt_cache).length<=2*SC.DateTime._DT_CACHE_MAX_LENGTH,"Creating a lot of datetimes should not make a cache larger than the maximum allowed size")
});test("timezones",function(){var d=options;options.timezone=0;timeShouldBeEqualToHash(SC.DateTime.create(options),options);
options.timezone=-120;timeShouldBeEqualToHash(SC.DateTime.create(options),options);
options.timezone=330;timeShouldBeEqualToHash(SC.DateTime.create(options),options);
options.timezone=0;dt=SC.DateTime.create(options);timeShouldBeEqualToHash(dt,{year:d.year,month:d.month,day:d.day,hour:d.hour,minute:d.minute,second:d.second,millisecond:d.millisecond,timezone:d.timezone});
timeShouldBeEqualToHash(dt.toTimezone(480),{year:d.year,month:d.month,day:d.day-1,hour:20,minute:d.minute,second:d.second,millisecond:d.millisecond,timezone:480});
timeShouldBeEqualToHash(dt.toTimezone(420),{year:d.year,month:d.month,day:d.day-1,hour:21,minute:d.minute,second:d.second,millisecond:d.millisecond,timezone:420});
timeShouldBeEqualToHash(dt.toTimezone(),{year:d.year,month:d.month,day:d.day,hour:d.hour,minute:d.minute,second:d.second,millisecond:d.millisecond,timezone:0});
timeShouldBeEqualToHash(dt.toTimezone(-60),{year:d.year,month:d.month,day:d.day,hour:5,minute:d.minute,second:d.second,millisecond:d.millisecond,timezone:-60});
timeShouldBeEqualToHash(dt.toTimezone(-120),{year:d.year,month:d.month,day:d.day,hour:6,minute:d.minute,second:d.second,millisecond:d.millisecond,timezone:-120});
timeShouldBeEqualToHash(dt.toTimezone(-330),{year:d.year,month:d.month,day:d.day,hour:9,minute:30,second:d.second,millisecond:d.millisecond,timezone:-330})
});module("Json Module");test("Encoding and decoding object graphs",function(){var e={foo:[1,2,3],bar:{a:"a",b:"b"}};
var g=SC.json.encode(e);var d=SC.json.decode(g);same(d,e,"round trips")});var LocaleObject;
module("object.SC.Locale()",{setup:function(){LocaleObject=SC.Locale.create({init:function(){arguments.callee.base.apply(this,arguments);
var d={deflang:"dl"};SC.Locale.addStrings(d)}})}});test("Locale.init() : Should return a flag if the language has been set during the locale initialization",function(){equals(LocaleObject.hasStrings,true);
equals(LocaleObject.strings.deflang,"dl")});test("Locale.locWithDefault() : localized version of the string or the string if no match was found",function(){equals(LocaleObject.locWithDefault("en"),"en");
equals(LocaleObject.locWithDefault("jp","Japanese"),"Japanese");equals(LocaleObject.locWithDefault("deflang"),"dl")
});test("Locale.addStrings() : Should be able to add the passed hash of strings to the locale's strings table",function(){equals(false,SC.Locale.options().strings.chinese==="zh"&&SC.Locale.options().strings.dutch==="nl");
var d={chinese:"zh",czech:"cs",dutch:"nl"};SC.Locale.addStrings(d);equals(true,SC.Locale.options().strings.chinese==="zh"&&SC.Locale.options().strings.dutch==="nl")
});test("Locale.options() : Should provide the registered locales that have not been instantiated",function(){var d={jamican:"ji",korean:"ko"};
SC.Locale.addStrings(d);equals(SC.Locale.options().hasStrings,true);equals(true,SC.Locale.options().strings.jamican==="ji"&&SC.Locale.options().strings.korean==="ko")
});test("Locale.normalizeLanguage() : Should provide the two character language code for the passed locale",function(){equals(SC.Locale.normalizeLanguage(),"en");
equals(SC.Locale.normalizeLanguage("English"),"en");equals(SC.Locale.normalizeLanguage("ab"),"ab")
});test("Locale.toString() : Should retrun the current language set with the guid value",function(){SC.Locale.locales.mx=SC.Locale.extend({_deprecatedLanguageCodes:["mexican"]});
equals(SC.Locale.locales.mx.currentLocale.isObject,true)});test("Locale.createCurrentLocale() : Should create the Lacale Object for the language selected",function(){equals(true,SC.Locale.createCurrentLocale().language===SC.browser.language);
SC.browser.language="kn";equals(false,SC.Locale.createCurrentLocale().language===SC.browser.language)
});test("Locale.localeClassFor() : Should find the locale class for the names language code or creates on based on its most likely parent",function(){equals(false,SC.Locale.localeClassFor("nl").create().language==="nl");
SC.Locale.locales.nl=SC.Locale.extend({_deprecatedLanguageCodes:["Dutch"]});equals(true,SC.Locale.localeClassFor("nl").create().language==="nl")
});test("Locale.define() : Should be able to define a particular type of locale",function(){SC.Locale.define("xy",{longNames:"Charles John Romonoski Gregory William".split(" "),shortNames:["C","A","Y","N"]});
equals(SC.Locale.locales.xy.isClass,true)});test("Locale.extend() : Should make sure important properties of Locale object are copied to a new class",function(){SC.Locale.locales.mn=SC.Locale.extend({_deprecatedLanguageCodes:["newlang"]});
var d={test:"te",newtest:"nt"};SC.Locale.locales.mn.addStrings(d);equals(SC.Locale.locales.mn.options().strings.test,"te")
});module("SC.Math");test("0.12 rounded default decimal place",function(){equals(SC.Math.round(0.12),0)
});test("1.23456789 rounded into decimals",function(){equals(SC.Math.round(1.23456789),1,"0 decimal places");
equals(SC.Math.round(1.23456789,1),1.2,"1 decimal place");equals(SC.Math.round(1.23456789,2),1.23,"2 decimal places");
equals(SC.Math.round(1.23456789,3),1.235,"3 decimal places");equals(SC.Math.round(1.23456789,4),1.2346,"4 decimal places");
equals(SC.Math.round(1.23456789,7),1.2345679,"7 decimal places")});test("123456.7890 rounded into wholes",function(){equals(SC.Math.round(123456.789),123457,"0 places");
equals(SC.Math.round(123456.789,-1),123460,"1 place");equals(SC.Math.round(123456.789,-2),123500,"2 places");
equals(SC.Math.round(123456.789,-3),123000,"3 places");equals(SC.Math.round(123456.789,-4),120000,"4 places")
});test("near",function(){ok(SC.Math.near(1,1),"Equal numbers should be considered near -- obviously");
ok(!SC.Math.near(2,1),"Unequal whole numbers should not be near");ok(SC.Math.near(1.00000001,1),"Numbers inside lambda range should be considered near")
});test("near - custom lambda",function(){ok(SC.Math.near(2,1,1),"Lambda should define an inclusive range -- ie. 2 with lambda 1 is considered near 1")
});var context=null;module("SC.RenderContext#begin",{setup:function(){context=SC.RenderContext()
}});test("should return a new context with parent context as prevObject",function(){var d=context.begin();
ok(d!==context,"new context");equals(d.prevObject,context,"previous context")});test("should set offset for new context equal to length of previous context",function(){context.push("line1");
var e=context.length;var d=context.begin();equals(d.offset,e,"offset")});test("should copy same strings array to new child context",function(){context.push("line1");
var d=context.begin();equals(d.strings,context.strings)});test("should start new context with length of 1 (reserving a space for opening tag)",function(){context.push("line1");
var d=context.begin();equals(d.length,1,"has empty line");equals(d.strings.length,3,"parent empty line + parent line + empty line")
});test("should assign passed tag name to new context",function(){var d=context.begin("foo");
equals(d.tagName(),"foo","tag name")});var context=null;module("SC.RenderContext#element",{setup:function(){context=SC.RenderContext()
},teardown:function(){context=null}});test("converts context to a DOM element and returns root element if there is one",function(){context.id("foo");
var d=context.element();ok(d,"elem not null");equals(d.tagName.toString().toLowerCase(),"div","is div");
equals(d.id.toString(),"foo","is id=foo");d=null});test("returns null if context does not generate valid element",function(){context=SC.RenderContext(null);
var d=context.element();equals(d,null,"should be null");d=null});test("returns first element if context renders multiple element",function(){context.tag("div").tag("span");
var d=context.element();ok(d,"elem not null");equals(d.tagName.toString().toLowerCase(),"div","is div");
d=null});var context=null;module("SC.RenderContext#end",{setup:function(){context=SC.RenderContext()
}});test("should replace opening tag with string and add closing tag, leaving middle content in place",function(){context.push("line1").end();
equals(context.get(0),"<div>","opening tag");equals(context.get(1),"line1","opening tag");
equals(context.get(2),"</div>","closing tag")});test("should emit any CSS class names included in the tag opts.classNames array",function(){context.classNames("foo bar".w()).end();
ok(context.get(0).match(/class=\"foo bar\"/),"<div> has class attr")});test("should emit id in tag opts.id",function(){context.id("foo").end();
ok(context.get(0).match(/id=\"foo\"/),"<div> has id attr")});test("should emit style in tag if opts.styles is defined",function(){context.styles({alpha:"beta",foo:"bar"}).end();
ok(context.get(0).match(/style=\"alpha: beta; foo: bar\"/),'<div> has style="alpha: beta; foo: bar"')
});test("should write arbitrary attrs has in opts",function(){context.attr({foo:"bar",bar:"baz"}).end();
ok(context.get(0).match(/foo=\"bar\"/),'has foo="bar"');ok(context.get(0).match(/bar=\"baz\"/),'has bar="baz"')
});test("classNames should override attrs.class",function(){context.classNames("foo".w()).attr({"class":"bar"}).end();
ok(context.get(0).match(/class=\"foo\"/),'has class="foo"')});test("opts.id should override opts.attrs.id",function(){context.id("foo").attr({id:"bar"}).end();
ok(context.get(0).match(/id=\"foo\"/),'has id="foo"')});test("opts.styles should override opts.attrs.style",function(){context.styles({foo:"foo"}).attr({style:"bar: bar"}).end();
ok(context.get(0).match(/style=\"foo: foo\"/),'has style="foo: foo"')});test("should return receiver if receiver has no prevObject",function(){ok(!context.prevObject,"precondition - prevObject is null");
equals(context.end(),context,"ends as self")});test("should return prevObject if receiver has prevObject",function(){var d=context.begin();
equals(d.end(),context,"should return prevObject")});test("emits self closing tag if tag has no content and c._selfClosing !== NO",function(){var d=context.begin("input");
d.end();equals(d.get(0),"<input />")});test("emits two tags even if tag has no content if opts.selfClosing == NO",function(){context._selfClosing=NO;
context.end();equals(context.length,2,"has two lines");equals(context.get(0),"<div>","has opening tag");
equals(context.get(1),"</div>","has closing tag")});test("does NOT emit self closing tag if it has content, even if opts.selfClosing == YES (because that would yield invalid HTML)",function(){context._selfClosing=YES;
context.push("line").end();equals(context.length,3,"has 3 lines");equals(context.get(2),"</div>","has closing tag")
});test("it should make sure to clear reused temporary attributes object",function(){context.begin("input").id("foo").styles({foo:"bar"}).classNames("foo bar".w()).push("line").end();
context.begin("input").id("bar").end();var d=context.get(context.length-1);equals(d,'<input id="bar"  />')
});test("it should work when nested more than one level deep",function(){context.begin().id("foo").begin().id("bar").end().end();
var d=context.join("");ok(d.match(/id="foo"/),"has foo");ok(d.match(/id="bar"/),"has bar")
});var context=null;module("SC.RenderContext#get",{setup:function(){context=SC.RenderContext()
},teardown:function(){context=null}});test("it should return strings array with space for top tag if no params passed and no strings pushed yet",function(){same(context.get(),[null])
});test("it should return full strings array if no params passed and no strings pushed yet",function(){context.push("line1");
same(context.get(),[null,"line1"])});test("it should return individual string if index passed that is within current length",function(){context.push("line1");
equals(context.get(1),"line1")});test("it should return undefined if index passed that is outside of current range",function(){context.push("line1");
equals(context.get(3),undefined)});test("it should return undefined if index passed and no strings set yet",function(){equals(context.get(2),undefined)
});test("it should return the value based on an index from the context offset of the context is chained",function(){context.push("line1","line2");
var d=context.begin();d.push("NEXT");equals(d.get(1),"NEXT","gets child line")});
var context=null;module("SC.RenderContext#attr",{setup:function(){context=SC.RenderContext().attr({foo:"foo"})
}});test("should add passed name to value",function(){context.attr("bar","bar");equals(context._attrs.bar,"bar","verify attr name")
});test("should replace passed name  value in attrs",function(){context.attr("foo","bar");
equals(context._attrs.foo,"bar","verify attr name")});test("should return receiver",function(){equals(context,context.attr("foo","bar"))
});test("should create attrs hash if needed",function(){context=SC.RenderContext().begin();
equals(context._attrs,null,"precondition - has no attrs");context.attr("foo","bar");
equals(context._attrs.foo,"bar","has styles")});test("should assign all attrs if a hash is passed",function(){context.attr({foo:"bar",bar:"bar"});
same(context._attrs,{foo:"bar",bar:"bar"},"has same styles")});var context=null;module("SC.RenderContext#id",{setup:function(){context=SC.RenderContext().id("foo")
}});test("id() returns the current id for the tag",function(){equals(context.id(),"foo","get id")
});test("id(bar) alters the current id",function(){equals(context.id("bar"),context,"Returns receiver");
equals(context.id(),"bar","changed to bar")});var context=null;module("SC.RenderContext#classNames",{setup:function(){context=SC.RenderContext()
}});test("returns empty array if no current class names",function(){same(context.classNames(),[],"classNames")
});test("classNames(array) updates class names",function(){var d="bar baz".w();equals(context.classNames(d),context,"returns receiver");
same(context.classNames(),d,"class names")});test("returns classNames if set",function(){context.classNames("bar".w());
same(context.classNames(),["bar"],"classNames")});test("clone on next retrieval if classNames(foo) set with cloneOnModify=YES",function(){var e="foo bar".w();
context.classNames(e,YES);var d=context.classNames();ok(d!==e,"class name is NOT same instance");
same(d,e,"but arrays are equivalent");equals(d,context.classNames(),"2nd retrieval is same instance")
});test("extracts class names from element on first retrieval",function(){var e=document.createElement("div");
SC.$(e).attr("class","foo bar");context=SC.RenderContext(e);var d=context.classNames();
same(d,["foo","bar"],"extracted class names");equals(context.classNames(),d,"should reuse same instance thereafter")
});module("SC.RenderContext#hasClass",{setup:function(){context=SC.RenderContext().classNames("foo bar".w())
}});test("should return true if context classNames has class name",function(){equals(YES,context.hasClass("foo"),"should have foo")
});test("should return false if context classNames does not have class name",function(){equals(NO,context.hasClass("imaginary"),"should not have imaginary")
});test("should return false if context has no classNames",function(){context=context.begin("div");
ok(context.classNames().length===0,"precondition - context has no classNames");equals(NO,context.hasClass("foo"),"should not have foo")
});module("SC.RenderContext#addClass",{setup:function(){context=SC.RenderContext().classNames(["foo"])
}});test("shoudl return receiver",function(){equals(context.addClass("foo"),context,"receiver")
});test("should add class name to existing classNames array on currentTag",function(){context.addClass("bar");
same(context.classNames(),["foo","bar"],"has classes");equals(context._classNamesDidChange,YES,"note did change")
});test("should only add class name once - does nothing if name already in array",function(){same(context.classNames(),["foo"],"precondition - has foo classname");
context._classNamesDidChange=NO;context.addClass("foo");same(context.classNames(),["foo"],"no change");
equals(context._classNamesDidChange,NO,"note did not change")});module("SC.RenderContext#removeClass",{setup:function(){context=SC.RenderContext().classNames(["foo","bar"])
}});test("should remove class if already in classNames array",function(){ok(context.classNames().indexOf("foo")>=0,"precondition - has foo");
context.removeClass("foo");ok(context.classNames().indexOf("foo")<0,"does not have foo")
});test("should return receiver",function(){equals(context.removeClass("foo"),context,"receiver")
});test("should do nothing if class name not in array",function(){context._classNamesDidChange=NO;
context.removeClass("imaginary");same(context.classNames(),"foo bar".w(),"did not change");
equals(context._classNamesDidChange,NO,"note did not change")});test("should do nothing if there are no class names",function(){context=context.begin();
same(context.classNames(),[],"precondition - no class names");context._classNamesDidChange=NO;
context.removeClass("foo");same(context.classNames(),[],"still no class names -- and no errors");
equals(context._classNamesDidChange,NO,"note did not change")});module("SC.RenderContext#setClass",{setup:function(){context=SC.RenderContext().addClass("foo")
}});test("should add named class if shouldAdd is YES",function(){ok(!context.hasClass("bar"),"precondition - does not have class bar");
context.setClass("bar",YES);ok(context.hasClass("bar"),"now has bar")});test("should remove named class if shouldAdd is NO",function(){ok(context.hasClass("foo"),"precondition - has class foo");
context.setClass("foo",NO);ok(!context.hasClass("foo"),"should not have foo ")});
test("should return receiver",function(){equals(context,context.setClass("bar",YES),"returns receiver")
});test("should add/remove all classes if a hash of class names is passed",function(){ok(context.hasClass("foo"),"precondition - has class foo");
ok(!context.hasClass("bar"),"precondition - does not have class bar");context.setClass({foo:NO,bar:YES});
ok(context.hasClass("bar"),"now has bar");ok(!context.hasClass("foo"),"should not have foo ")
});var context=null;module("SC.RenderContext#styles",{setup:function(){context=SC.RenderContext()
}});test("returns empty hash if no current styles",function(){same(context.styles(),{},"styles")
});test("styles(hash) replaces styles",function(){var d={foo:"bar"};equals(context.styles(d),context,"returns receiver");
same(context.styles(),d,"Styles")});test("returns styles if set",function(){var d={foo:"bar"};
context.styles(d);equals(context.styles(),d,"styles")});test("clone on next retrieval if styles(foo) set with cloneOnModify=YES",function(){var e={foo:"bar"};
context.styles(e,YES);var d=context.styles();ok(d!==e,"styles is NOT same instance");
same(d,e,"but styles are equivalent");equals(d,context.styles(),"2nd retrieval is same instance")
});test("extracts styles from element on first retrieval",function(){var e=document.createElement("div");
SC.$(e).attr("style","color: black; height: 20px; border-top: 1px solid hotpink; ");
context=SC.RenderContext(e);var d=context.styles();same(d,{color:"black",height:"20px",borderTop:"1px solid hotpink"},"extracted style. This is failing in IE8 because it return styles like cOLOR.");
equals(context.styles(),d,"should reuse same instance thereafter")});module("SC.RenderContext#addStyle",{setup:function(){context=SC.RenderContext().styles({foo:"foo"})
}});test("should add passed style name to value",function(){context.addStyle("bar","bar");
equals("bar",context.styles().bar,"verify style name")});test("should replace passed style name  value",function(){context.addStyle("foo","bar");
equals("bar",context.styles().foo,"verify style name")});test("should return receiver",function(){equals(context,context.addStyle("foo","bar"))
});test("should create styles hash if needed",function(){context=SC.RenderContext();
equals(context._styles,null,"precondition - has no styles");context.addStyle("foo","bar");
equals("bar",context.styles().foo,"has styles")});test("should assign all styles if a hash is passed",function(){context.addStyle({foo:"bar",bar:"bar"});
same(context.styles(),{foo:"bar",bar:"bar"},"has same styles")});test("css() should be an alias for addStyle()",function(){equals(SC.RenderContext.fn.css,SC.RenderContext.fn.addStyle,"methods")
});var context=null;module("SC.RenderContext#init");test("it should return a new context object with the passed tag name",function(){equals(SC.RenderContext("foo").tagName(),"foo","tag name")
});test("it should use a default tag name of div if not passed",function(){equals(SC.RenderContext().tagName(),"div","tag name")
});test("it should lowercase any tag name passed in",function(){equals(SC.RenderContext("DIV").tagName(),"div","lowercase tag name")
});test("it should have a length of 1 with a null value for the first time, saving space for the opening tag",function(){var d=SC.RenderContext();
equals(d.length,1,"context length");equals(d.get(0),null,"first item")});test("if script tag is passed, should mark context._selfClosing as NO",function(){var d=SC.RenderContext("script");
ok(d._selfClosing===NO,"selfClosing MUST be no");d=SC.RenderContext("SCRIPT");ok(d._selfClosing===NO,"selfClosing MUST be no 2")
});test("if element is passed, it should save element and not reserve space for string output",function(){var e=document.createElement("div");
var d=SC.RenderContext(e);equals(d.length,0,"no length");equals(d._elem,e,"element");
e=d._elem=null});test("offset should should use offset + length of parent for self",function(){var d=SC.RenderContext("div");
d.offset=2;d.length=3;var e=SC.RenderContext("div",d);equals(e.offset,5,"has proper offset")
});var context=null;module("SC.RenderContext#join",{setup:function(){context=SC.RenderContext().push("line1","line2")
},teardown:function(){context=null}});test("it should return joined lines with no separator string by default",function(){equals(context.join(),"<div>line1line2</div>")
});test("it should return joined lines with separator string if passed",function(){equals(context.join(","),"<div>,line1,line2,</div>")
});var context=null;module("SC.RenderContext#push",{setup:function(){context=SC.RenderContext()
},teardown:function(){context=null}});test("it should add the line to the strings and increase the length",function(){equals(context.length,1,"precondition - length=");
context.push("sample line");equals(context.length,2,"length should increase");equals(context.get(1),"sample line","line should be in strings array")
});test("it should accept multiple parameters, pushing each one into strings",function(){equals(context.length,1,"precondition - length=");
context.push("line1","line2","line3");equals(context.length,4,"should add 3 lines to strings");
equals(context.get(1),"line1","1st item");equals(context.get(2),"line2","2nd item");
equals(context.get(3),"line3","3rd item")});test("it should return receiver",function(){equals(context.push("line1"),context,"return value")
});test("pushing a line onto a subcontext, should update the length in the parent context as well",function(){context.push("line1","line2");
var d=context.length;var e=context.begin().push("line3");ok(context.length>d,"length should have increased")
});module("SC.RenderContext#text",{setup:function(){context=SC.RenderContext()},teardown:function(){context=null
}});test("should escape passed HTML before pushing",function(){context.text("<b>test me!</b>");
equals(context.get(1),"&lt;b&gt;test me!&lt;/b&gt;","escaped")});var context=null;
module("SC.RenderContext#tag",{setup:function(){context=SC.RenderContext()}});test("should emit a self closing tag.  like calling begin().end()",function(){context.tag("input");
equals(SC.RenderContext.escapeHTML(context.get(1)),SC.RenderContext.escapeHTML("<input />"))
});test("should respect passed opts when emitting",function(){context.tag("foo");
equals(context.length,3);equals(SC.RenderContext.escapeHTML(context.get(1)),SC.RenderContext.escapeHTML("<foo>"));
equals(SC.RenderContext.escapeHTML(context.get(2)),SC.RenderContext.escapeHTML("</foo>"))
});test("should NOT emit self closing tag if tag is script",function(){context.tag("script");
equals(SC.RenderContext.escapeHTML(context.get(1)),SC.RenderContext.escapeHTML("<script>"));
equals(SC.RenderContext.escapeHTML(context.get(2)),SC.RenderContext.escapeHTML("<\/script>"))
});test("should NOT emit self closing tag if tag is div",function(){context.tag("div");
equals(SC.RenderContext.escapeHTML(context.get(1)),SC.RenderContext.escapeHTML("<div>"));
equals(SC.RenderContext.escapeHTML(context.get(2)),SC.RenderContext.escapeHTML("</div>"))
});test("should NOT emit self closing tag if no tag is passed",function(){context.tag();
equals(SC.RenderContext.escapeHTML(context.get(1)),SC.RenderContext.escapeHTML("<div>"));
equals(SC.RenderContext.escapeHTML(context.get(2)),SC.RenderContext.escapeHTML("</div>"))
});var context=null,elem=null;module("SC.RenderContext#update",{setup:function(){elem=document.createElement("div");
context=SC.RenderContext(elem)},teardown:function(){elem=context=null}});test("should replace innerHTML of DIV if strings were pushed",function(){elem.innerHTML="initial";
context.push("changed").update();equals(elem.innerHTML,"changed","innerHTML did change")
});test("should NOT replace innerHTML of DIV if no strings were pushed",function(){elem.innerHTML="initial";
context.update();equals(elem.innerHTML,"initial","innerHTML did NOT change")});test("returns receiver if no prevObject",function(){equals(context.update(),context,"return value")
});test("returns previous context if there is one",function(){var d=context.begin(elem);
equals(d.update(),context,"returns prev context")});test("clears internal _elem to avoid memory leaks on update",function(){ok(!!context._elem,"precondition - has element");
context.update();ok(!context._elem,"no longer an element")});module("SC.RenderContext#update - attrs",{setup:function(){elem=document.createElement("div");
SC.$(elem).attr("foo","initial");context=SC.RenderContext(elem)},teardown:function(){elem=context=null
}});test("does not change attributes if attrs were not actually changed",function(){context.update();
equals(elem.getAttribute("foo"),"initial","attribute")});test("updates attribute if attrs changed",function(){context.attr("foo","changed");
context.update();equals(elem.getAttribute("foo"),"changed","attribute")});test("adds attribute if new",function(){context.attr("bar","baz");
context.update();equals(elem.getAttribute("bar"),"baz","attribute")});test("removes attribute if value is null",function(){context.attr("foo",null);
context.update();equals(elem.getAttribute("foo"),null,"attribute")});module("SC.RenderContext#update - id",{setup:function(){elem=document.createElement("div");
SC.$(elem).attr("id","foo");context=SC.RenderContext(elem)},teardown:function(){elem=context=null
}});test("does not change id if retrieved but not edited",function(){context.id();
context.update();equals(elem.getAttribute("id"),"foo","id")});test("replaces id if edited",function(){context.id("bar");
context.update();equals(elem.getAttribute("id"),"bar","id")});test("set id overrides attr",function(){context.attr("id","bar");
context.id("baz");context.update();equals(elem.getAttribute("id"),"baz","should use id")
});module("SC.RenderContext#update - className",{setup:function(){elem=document.createElement("div");
SC.$(elem).attr("class","foo bar");context=SC.RenderContext(elem)},teardown:function(){elem=context=null
}});test("does not change class names if retrieved but not edited",function(){context.classNames();
context.update();equals(SC.$(elem).attr("class"),"foo bar","class")});test("replaces class name if classNames edited",function(){context.classNames("bar baz".w());
context.update();equals(SC.$(elem).attr("class"),"bar baz","attribute")});test("set class names override class attr",function(){context.attr("class","bar");
context.classNames("baz".w());context.update();equals(SC.$(elem).attr("class"),"baz","should use classNames")
});module("SC.RenderContext#update - style",{setup:function(){elem=document.createElement("div");
SC.$(elem).attr("style","color: red;");context=SC.RenderContext(elem)},teardown:function(){elem=context=null
}});test("does not change styles if retrieved but not edited",function(){context.styles();
context.update();var d=SC.$(elem).attr("style");if(!d.match(/;$/)){d+=";"}equals(d.toLowerCase(),"color: red;","style")
});test("replaces style name if styles edited",function(){context.styles({color:"black"});
context.update();var d=SC.$(elem).attr("style");if(!d.match(/;$/)){d+=";"}equals(d.toLowerCase(),"color: black;","attribute")
});test("set styles override style attr",function(){context.attr("style","color: green");
context.styles({color:"black"});context.update();var d=SC.$(elem).attr("style");if(!d.match(/;$/)){d+=";"
}equals(d.toLowerCase(),"color: black;","attribute")});var url,request,contents;module("SC.Request",{setup:function(){url="";
request=SC.Request.getUrl(url);contents=null},teardown:function(){url=request=contents
}});test("Basic Requirements",function(){ok(SC.Request,"SC.Request is defined");ok(""!==url,"url variable is not empty");
ok(request!==null,"request object is not null");ok(contents===null,"contents is null")
});test("Test Asynchronous GET Request",function(){var d,e;e=setTimeout(function(){ok(false,"response did not invoke notify() within 2sec");
window.start()},2000);request.notify(this,function(g){ok(SC.ok(g),"response should not be an error");
equals(g.get("body"),'{"message": "Yay!"}',"should match retrieved message");clearTimeout(e);
window.start()});d=request.send();ok(d!==null,"request.send() should return a response object");
ok(d.get("status")<0,"response should still not have a return code since this should be async");
stop()});test("Test Synchronous GET Request",function(){request.set("isAsynchronous",NO);
var d=request.send();ok(d!==null,"send() should return response");ok(SC.$ok(d),"contents should not be an error ");
equals(d.get("body"),'{"message": "Yay!"}',"should match retrieved message")});test("Test Asynchronous GET Request, auto-deserializing JSON",function(){request.set("isJSON",YES);
var d;d=setTimeout(function(){ok(false,"response did not invoke notify()");window.start()
},1000);request.notify(this,function(e){ok(SC.ok(e),"response should not be error");
same(e.get("body"),{message:"Yay!"},"repsonse.body");clearTimeout(d);window.start()
});request.send();stop()});test("Test auto-deserializing malformed JSON",function(){request=SC.Request.getUrl("").set("isJSON",YES);
var d=setTimeout(function(){ok(false,"response did not invoke notify()");window.start()
},1000);request.notify(this,function(h){ok(SC.ok(h),"response should not be error");
try{var g=h.get("body");ok(!SC.ok(g),"body should be an error")}catch(j){ok(false,"getting the body should not throw an exception")
}clearTimeout(d);window.start()});request.send();stop()});test("Test Synchronous GET Request, auto-deserializing JSON",function(){request.set("isAsynchronous",false);
request.set("isJSON",true);var d=request.send();ok(d!==null,"response should not be null");
ok(SC.ok(d),"contents should not be an error");same(d.get("body"),{message:"Yay!"},"contents should have message")
});test("Test if Request body is being auto-serializing to JSON",function(){var e={content:"garbage"};
request.set("isJSON",true).set("body",e);var d=request.get("encodedBody");equals(d,'{"content":"garbage"}',"The json object passed in send should be encoded and set as the body")
});test("Test Multiple Asynchronous GET Request - two immediate, and two in serial",function(){var g=3;
var h=0;var d=0;var e=function(j){h++;if(d<=2){d++;SC.Request.getUrl(url).notify(this,e).send();
g++}};SC.Request.getUrl(url).notify(this,e).send();SC.Request.getUrl(url).notify(this,e).send();
SC.Request.getUrl(url).notify(this,e).send();stop();setTimeout(function(){equals(g,6,"requestCount should be 6");
equals(h,6,"responseCount should be 6");window.start()},2000)});test("Test timeouts",function(){var k;
try{SC.Request.getUrl(url).set("timeout",0).send()}catch(m){k=m}ok(k&&k.indexOf("The timeout value must either not be specified or must be greater than 0")!==-1,"An error should be thrown when the timeout value is 0 ms");
try{SC.Request.getUrl(url).set("isAsynchronous",NO).set("timeout",10).send()}catch(l){k=l
}ok(k&&k.indexOf("Timeout values cannot be used with synchronous requests")!==-1,"An error should be thrown when trying to use a timeout with a synchronous request");
var j=NO,n=NO,d=SC.Request.getUrl("http://www.sproutcore.com"),g;var h=Date.now();
d.set("timeout",10);d.set("didTimeout",function(){var e=Date.now()-h;ok(e>=10,"timeout must not fire earlier than 10msec - actual %@".fmt(e));
clearTimeout(g);window.start()});d.set("didReceive",function(){ok(false,"timeout did not fire before response was recieved.  should have fired after 10msec.  response time: %@msec".fmt(Date.now()-h));
window.start()});SC.RunLoop.begin();d.send();SC.RunLoop.end();stop();g=setTimeout(function(){ok(false,"timeout did not fire at all");
window.start()},500)});module("SC.RootResponder#makeKeyPane");test("returns receiver",function(){var g=SC.Pane.create(),e=SC.Pane.create({acceptsKeyPane:YES});
var d=SC.RootResponder.create();equals(d.makeKeyPane(g),d,"returns receiver even if pane does not accept key pane");
equals(d.makeKeyPane(e),d,"returns receiver")});test("changes keyPane to new pane if pane accepts key focus",function(){var g=SC.Pane.create({acceptsKeyPane:NO});
var e=SC.Pane.create({acceptsKeyPane:YES});var d=SC.RootResponder.create();d.makeKeyPane(g);
ok(d.get("keyPane")!==g,"keyPane should not change to view that does not accept key");
d.makeKeyPane(e);equals(d.get("keyPane"),e,"keyPane should change to view that does accept key")
});test("setting nil sets key pane to mainPane if mainPane accepts key focus",function(){var d=SC.Pane.create({acceptsKeyPane:YES});
var e=SC.Pane.create({acceptsKeyPane:YES});var g=SC.RootResponder.create({mainPane:d,keyPane:e});
g.makeKeyPane(null);equals(g.get("keyPane"),d,"keyPane should be main pane");g.makeKeyPane(e);
d.acceptsKeyPane=NO;g.makeKeyPane(null);equals(g.get("keyPane"),null,"keyPane should be null, not main");
g.keyPane=null;d.acceptsKeyPane=NO;g.makeKeyPane(null);equals(g.get("keyPane"),null,"keyPane should remain null")
});var p1,p2,r,callCount;module("SC.RootResponder#makeKeyPane - testing notifications",{setup:function(){p1=SC.Pane.create({acceptsKeyPane:YES});
p2=SC.Pane.create({acceptsKeyPane:YES});r=SC.RootResponder.create();callCount=0},teardown:function(){p1=p2=r
}});test("should call willLoseKeyPaneTo on current keyPane",function(){r.keyPane=p1;
p1.willLoseKeyPaneTo=function(d){equals(d,p2,"should pass new pane");callCount++};
r.makeKeyPane(p2);equals(callCount,1,"should invoke")});test("should call willBecomeKeyPaneFrom on new keyPane",function(){r.keyPane=p1;
p2.willBecomeKeyPaneFrom=function(d){equals(d,p1,"should pass old pane");callCount++
};r.makeKeyPane(p2);equals(callCount,1,"should invoke")});test("should call didLoseKeyPaneTo on old keyPane",function(){r.keyPane=p1;
p1.didLoseKeyPaneTo=function(d){equals(d,p2,"should pass new pane");callCount++};
r.makeKeyPane(p2);equals(callCount,1,"should invoke")});test("should call didBecomeKeyPaneFrom on new keyPane",function(){r.keyPane=p1;
p2.didBecomeKeyPaneFrom=function(d){equals(d,p1,"should pass old pane");callCount++
};r.makeKeyPane(p2);equals(callCount,1,"should invoke")});test("should not invoke callbacks if setting keyPane to itself",function(){r.keyPane=p1;
p1.didLoseKeyPaneTo=p1.willLoseKeyPaneTo=p1.willBecomeKeyPaneFrom=p1.didBecomeKeyPaneFrom=function(){callCount++
};r.makeKeyPane(p1);equals(callCount,0,"did not invoke any callbacks")});module("SC.RootResponder#makeMainPane");
test("returns receiver",function(){var g=SC.Pane.create(),e=SC.Pane.create();var d=SC.RootResponder.create();
equals(d.makeMainPane(g),d,"returns receiver")});test("changes mainPane to new pane",function(){var g=SC.Pane.create(),e=SC.Pane.create();
var d=SC.RootResponder.create();d.makeMainPane(g);equals(d.get("mainPane"),g,"mainPane should be p1");
d.makeMainPane(e);equals(d.get("mainPane"),e,"mainPane should be p2")});test("if current mainpane is also keypane, automatically make new main pane key also",function(){var g=SC.Pane.create({acceptsKeyPane:YES});
var e=SC.Pane.create({acceptsKeyPane:YES});var d=SC.RootResponder.create({mainPane:g,keyPane:g});
d.makeMainPane(e);ok(d.get("keyPane")===e,"should change keyPane(%@) p1 = %@ - p2 = %@".fmt(d.get("keyPane"),g,e))
});test("should call blurMainTo() on current pane, passing new pane",function(){var g=0;
var e=SC.Pane.create();var h=SC.Pane.create({blurMainTo:function(j){g++;equals(j,e,"should pass new pane")
}});var d=SC.RootResponder.create({mainPane:h});d.makeMainPane(e);equals(g,1,"should invoke callback")
});test("should call focusMainFrom() on new pane, passing old pane",function(){var g=0;
var h=SC.Pane.create();var e=SC.Pane.create({focusMainFrom:function(j){g++;equals(j,h,"should pass old pane")
}});var d=SC.RootResponder.create({mainPane:h});d.makeMainPane(e);equals(g,1,"should invoke callback")
});sc_require("panes/menu");var responder,menu;module("SC.RootResponder#makeMenuPane",{setup:function(){responder=SC.RootResponder.create();
menu=SC.Pane.create({acceptsMenuPane:YES})},teardown:function(){menu.remove();menu=responder=null
}});test("Returns receiver",function(){equals(responder.makeMenuPane(menu),responder,"returns receiver")
});test("Sets RootResponder's menuPane",function(){equals(responder.get("menuPane"),null,"precond - menuPane should be null by default");
responder.makeMenuPane(menu);equals(responder.get("menuPane"),menu,"menuPane should be passed menu")
});test("menuPane does not affect keyPane",function(){var d=SC.Pane.create();responder.makeKeyPane(d);
equals(responder.get("keyPane"),d,"precond - pane should be key pane");responder.makeMenuPane(menu);
equals(responder.get("menuPane"),menu,"menuPane should be set");equals(responder.get("keyPane"),d,"key pane should not change")
});test("Pane should not become menu pane if acceptsMenuPane is not YES",function(){menu.set("acceptsMenuPane",NO);
responder.makeMenuPane(menu);equals(responder.get("menuPane"),null,"menuPane should remain null")
});var sub,newPane,oldPane,lightPane,darkPane,myPane,responder;module("SC.RootResponder",{setup:function(){sub=SC.Object.create({action:function(){var d="hello"
}});newPane=SC.Pane.create({owner:this});oldPane=SC.Pane.create({owner:this});lightPane=SC.Pane.create({owner:this});
darkPane=SC.Pane.create({owner:this});myPane=SC.Pane.create();responder=SC.RootResponder.create({})
},teardown:function(){delete sub}});test("Basic requirements",function(){expect(2);
ok(SC.RootResponder,"SC.RootResponder");ok(SC.RootResponder.responder,"SC.RootResponder.responder")
});test("root_responder.makeMainPane() : Should change the new Pane to key view",function(){responder.makeMainPane(newPane);
equals(responder.get("mainPane"),newPane);equals(responder.get("keyPane"),newPane)
});test("root_responder.makeMainPane() : Should notify other panes about the changes",function(){responder.makeMainPane(newPane);
equals(newPane.get("isMainPane"),YES);equals(oldPane.get("isMainPane"),NO)});test("root_responder.makeKeyPane() : Should make the passed pane as the key pane",function(){responder.makeMainPane(oldPane);
equals(responder.get("keyPane"),oldPane);responder.makeKeyPane(lightPane);equals(responder.get("keyPane"),lightPane)
});test("root_responder.makeKeyPane() : Should make the main pane as the key pane if null is passed",function(){responder.makeMainPane(lightPane);
responder.makeKeyPane(oldPane);equals(responder.get("mainPane"),lightPane);equals(responder.get("keyPane"),oldPane);
responder.makeKeyPane();equals(responder.get("keyPane"),lightPane)});var r,sender,pane,barView,fooView,defaultResponder;
var keyPane,mainPane,globalResponder,actionSender;var CommonSetup={setup:function(){actionSender=null;
var d=function(e){actionSender=e};sender=SC.Object.create();defaultResponder=SC.Object.create({defaultAction:d});
globalResponder=SC.Object.create({globalAction:d});pane=SC.Pane.create({acceptsKeyPane:YES,defaultResponder:defaultResponder,childViews:[SC.View.extend({bar:d,childViews:[SC.View.extend({foo:d})]})],paneAction:d});
keyPane=SC.Pane.create({acceptsKeyPane:YES,keyAction:d});keyPane.firstResponder=keyPane;
mainPane=SC.Pane.create({acceptsKeyPane:YES,mainAction:d});mainPane.firstResponder=mainPane;
r=SC.RootResponder.create({mainPane:mainPane,keyPane:keyPane,defaultResponder:globalResponder});
barView=pane.childViews[0];ok(barView.bar,"barView should implement bar");fooView=barView.childViews[0];
ok(fooView.foo,"fooView should implement foo");window.Dummy={object:SC.Object.create({foo:d}),hash:{foo:d}}
},teardown:function(){r=sender=pane=window.Dummy=barView=fooView=null;defaultResponder=keyPane=mainPane=globalResponder=null
}};module("SC.RootResponder#targetForAction",CommonSetup);test("pass property path string as target",function(){var d=r.targetForAction("foo","Dummy.object");
equals(d,Dummy.object,"should find DummyNamespace.object if it implements the action");
equals(r.targetForAction("foo","Dummy.hash"),Dummy.hash,"should return if object found at path and it has function, even if it does not use respondsTo");
equals(r.targetForAction("bar","Dummy.object"),null,"should return null if found DummyNamepace.object but does not implement action");
equals(r.targetForAction("foo","Dummy.imaginary.item"),null,"should return null if property path could not resolve")
});test("pass real object as target",function(){equals(r.targetForAction("foo",Dummy.object),Dummy.object,"returns target if respondsTo() action");
equals(r.targetForAction("foo",Dummy.hash),Dummy.hash,"returns target if targets does not implement respondsTo() but does have action");
equals(r.targetForAction("bar",Dummy.object),null,"returns null of target does not implement action name")
});test("no target, explicit pane, nested firstResponder",function(){pane.set("firstResponder",fooView);
equals(r.targetForAction("foo",null,null,pane),fooView,"should return firstResponder if implementation action");
equals(r.targetForAction("bar",null,null,pane),barView,"should return parent of firstResponder");
equals(r.targetForAction("paneAction",null,null,pane),pane,"should return pane action");
equals(r.targetForAction("defaultAction",null,null,pane),defaultResponder,"should return defaultResponder");
equals(r.targetForAction("imaginaryAction",null,null,pane),null,"should return null for not-found action")
});test("no target, explicit pane, top-level firstResponder",function(){pane.set("firstResponder",barView);
equals(r.targetForAction("foo",null,null,pane),null,"should NOT return child of firstResponder");
equals(r.targetForAction("bar",null,null,pane),barView,"should return firstResponder");
equals(r.targetForAction("paneAction",null,null,pane),pane,"should return pane action");
equals(r.targetForAction("defaultAction",null,null,pane),defaultResponder,"should return defaultResponder");
equals(r.targetForAction("imaginaryAction",null,null,pane),null,"should return null for not-found action")
});test("no target, explicit pane, pane is first responder",function(){pane.set("firstResponder",pane);
equals(r.targetForAction("foo",null,null,pane),null,"should NOT return child view");
equals(r.targetForAction("bar",null,null,pane),null,"should NOT return child view");
equals(r.targetForAction("paneAction",null,null,pane),pane,"should return pane action");
equals(r.targetForAction("defaultAction",null,null,pane),defaultResponder,"should return defaultResponder");
equals(r.targetForAction("imaginaryAction",null,null,pane),null,"should return null for not-found action")
});test("no target, explicit pane, no first responder",function(){pane.set("firstResponder",null);
equals(r.targetForAction("foo",null,null,pane),null,"should NOT return child view");
equals(r.targetForAction("bar",null,null,pane),null,"should NOT return child view");
equals(r.targetForAction("paneAction",null,null,pane),pane,"should return pane");
equals(r.targetForAction("defaultAction",null,null,pane),defaultResponder,"should return defaultResponder");
equals(r.targetForAction("imaginaryAction",null,null,pane),null,"should return null for not-found action")
});test("no target, explicit pane, does not implement action",function(){equals(r.targetForAction("keyAction",null,null,pane),null,"should not return keyPane");
equals(r.targetForAction("mainAction",null,null,pane),null,"should not return mainPane");
equals(r.targetForAction("globalAction",null,null,pane),null,"should not return global defaultResponder")
});test("no target, no explicit pane",function(){equals(r.targetForAction("keyAction"),keyPane,"should find keyPane");
equals(r.targetForAction("mainAction"),mainPane,"should find mainPane");equals(r.targetForAction("globalAction"),globalResponder,"should find global defaultResponder");
equals(r.targetForAction("imaginaryAction"),null,"should return null for not-found action")
});module("SC.RootResponder#sendAction",CommonSetup);test("if pane passed, invokes action on pane if found",function(){pane.firstResponder=pane;
r.sendAction("paneAction",null,sender,pane);equals(actionSender,sender,"action did invoke");
actionSender=null;r.sendAction("imaginaryAction",null,sender,pane);equals(actionSender,null,"action did not invoke")
});test("searches panes if none passed, invokes action if found",function(){r.sendAction("keyAction",null,sender);
equals(actionSender,sender,"action did invoke");actionSender=null;r.sendAction("imaginaryAction",null,sender);
equals(actionSender,null,"action did not invoke")});test("searches target if passed, invokes action if found",function(){r.sendAction("foo",fooView,sender);
equals(actionSender,sender,"action did invoke");actionSender=null;r.sendAction("imaginaryAction",fooView,sender);
equals(actionSender,null,"action did not invoke")});var router;module("SC.routes setup");
test("Setup",function(){equals(SC.routes._didSetup,NO,"SC.routes should not have been setup yet")
});module("SC.routes setup",{setup:function(){router=SC.Object.create({route:function(){return
}});SC.run(function(){SC.routes.add("foo",router,router.route)})}});test("Setup",function(){equals(SC.routes._didSetup,YES,"SC.routes should have been setup")
});test("Initial route",function(){equals(SC.routes.get("location"),"","Initial route is an empty string")
});module("SC.routes._Route",{setup:function(){router=SC.Object.create({route:function(){return
}})}});test("Route tree",function(){var g=SC.routes._Route.create(),u=["a","b","c"],n=["a","b","d"],l=["a","b",":e"],j=["a","*foo"],y,x,o,m,k,z,h;
g.add(u,router,router.route);g.add(n,router,router.route);g.add(l,router,router.route);
g.add(j,router,router.route);y=g.staticRoutes.a;ok(y,"There should be a staticRoutes tree for a");
ok(!y.target,"A node should not have a target");ok(!y.method,"A node should not have a method");
x=y.staticRoutes.b;ok(x,"There should be a staticRoutes tree for b");ok(!x.target,"A node should not have a target");
ok(!x.method,"A node should not have a method");o=x.staticRoutes.c;ok(o,"There should be a staticRoutes tree for c");
equals(o.target,router,"A leaf should have a target");equals(o.method,router.route,"A leaf should have a method");
m=x.staticRoutes.d;ok(m,"There should be a staticRoutes tree for d");equals(m.target,router,"A leaf should have a target");
equals(m.method,router.route,"A leaf should have a method");k=x.dynamicRoutes.e;ok(k,"There should be a dynamicRoutes tree for e");
equals(m.target,router,"A leaf should have a target");equals(m.method,router.route,"A leaf should have a method");
z=y.wildcardRoutes.foo;ok(z,"There should be a wildcardRoutes tree for a");equals(g.routeForParts(["a"],{}),null,"routeForParts should return null for non existant routes");
equals(g.routeForParts(["a","b"],{}),null,"routeForParts should return null for non existant routes");
equals(g.routeForParts(u,{}),o,"routeForParts should return the correct route for a/b/c");
equals(g.routeForParts(n,{}),m,"routeForParts should return the correct route for a/b/d");
l[2]="foo";h={};equals(g.routeForParts(l,h),k,"routeForParts should return the correct route for a/b/:e");
equals(h.e,"foo","routeForParts should return the params for a/b/:e");h={};equals(g.routeForParts(["a","double","double","toil","and","trouble"],h),z,"routeForParts should return the correct route for a/*foo");
equals(h.foo,"double/double/toil/and/trouble","routeForParts should return the params for a/*foo")
});module("SC.routes location",{teardown:function(){SC.routes.set("location",null)
}});var routeWorks=function(d,e){SC.routes.set("location",d);equals(SC.routes.get("location"),d,e+" route has been set");
setTimeout(function(){equals(SC.routes.get("location"),d,e+" route is still the same");
start()},300);stop()};test("Null route",function(){SC.routes.set("location",null);
equals(SC.routes.get("location"),"","Null route is the empty string")});test("Simple route",function(){routeWorks("sixty-six","simple")
});test("UTF-8 route",function(){routeWorks("éàçùß€","UTF-8")});test("Already escaped route",function(){routeWorks("%C3%A9%C3%A0%20%C3%A7%C3%B9%20%C3%9F%E2%82%AC","already escaped")
});module("SC.routes defined routes",{setup:function(){router=SC.Object.create({params:null,route:function(d){this.set("params",d)
}})},teardown:function(){SC.routes.set("location",null)}});test("A mix of static, dynamic and wildcard route",function(){var e=false,d;
d=setTimeout(function(){ok(false,"Route change was not notified within 2 seconds");
window.start()},2000);router.addObserver("params",function(){if(!e){e=true;same(router.get("params"),{controller:"users",action:"éàçùß€",id:"5",witches:"double/double/toil/and/trouble"});
clearTimeout(d);window.start()}});SC.routes.add("foo/:controller/:action/bar/:id/*witches",router,router.route);
SC.routes.set("location","foo/users/éàçùß€/bar/5/double/double/toil/and/trouble");
stop()});test("Route with parameters defined in a string",function(){var e=false,d;
d=setTimeout(function(){ok(false,"Route change was not notified within 2 seconds");
window.start()},2000);router.addObserver("params",function(){if(!e){e=true;same(router.get("params"),{cuisine:"french",party:"4",url:""});
clearTimeout(d);window.start()}});SC.routes.add("*url",router,router.route);SC.routes.set("location","?cuisine=french&party=4");
stop()});test("Route with parameters defined in a hash",function(){var e=false,d;
d=setTimeout(function(){ok(false,"Route change was not notified within 2 seconds");
window.start()},2000);router.addObserver("params",function(){if(!e){e=true;same(router.get("params"),{cuisine:"french",party:"4",url:""});
clearTimeout(d);window.start()}});SC.routes.add("*url",router,router.route);SC.routes.set("location",{cuisine:"french",party:"4"});
stop()});test("A mix of everything",function(){var e=false,d;d=setTimeout(function(){ok(false,"Route change was not notified within 2 seconds");
window.start()},2000);router.addObserver("params",function(){if(!e){e=true;same(router.get("params"),{controller:"users",action:"éàçùß€",id:"5",witches:"double/double/toil/and/trouble",cuisine:"french",party:"4"});
clearTimeout(d);window.start()}});SC.routes.add("foo/:controller/:action/bar/:id/*witches",router,router.route);
SC.routes.set("location","foo/users/éàçùß€/bar/5/double/double/toil/and/trouble?cuisine=french&party=4");
stop()});module("SC.routes location observing",{setup:function(){router=SC.Object.create({hasBeenNotified:NO,route:function(d){this.set("hasBeenNotified",YES)
}})},teardown:function(){SC.routes.set("location",null)}});test("Location change",function(){var d;
d=setTimeout(function(){ok(false,"Route change was not notified within 2 seconds");
window.start()},2000);router.addObserver("hasBeenNotified",function(){equals(router.get("hasBeenNotified"),YES,"router should have been notified");
clearTimeout(d);window.start()});SC.routes.add("foo",router,router.route);window.location.hash="foo";
stop()});module("_extractParametersAndRoute");test("_extractParametersAndRoute with ? syntax",function(){same(SC.routes._extractParametersAndRoute({route:"videos/5?format=h264"}),{route:"videos/5",params:"?format=h264",format:"h264"},"route parameters should be correctly extracted");
same(SC.routes._extractParametersAndRoute({route:"videos/5?format=h264&size=small"}),{route:"videos/5",params:"?format=h264&size=small",format:"h264",size:"small"},"route parameters should be correctly extracted");
same(SC.routes._extractParametersAndRoute({route:"videos/5?format=h264&size=small",format:"ogg"}),{route:"videos/5",params:"?format=ogg&size=small",format:"ogg",size:"small"},"route parameters should be extracted and overwritten");
same(SC.routes._extractParametersAndRoute({route:"videos/5",format:"h264",size:"small"}),{route:"videos/5",params:"?format=h264&size=small",format:"h264",size:"small"},"route should be well formatted with the given parameters");
same(SC.routes._extractParametersAndRoute({format:"h264",size:"small"}),{route:"",params:"?format=h264&size=small",format:"h264",size:"small"},"route should be well formatted with the given parameters even if there is no initial route")
});test("_extractParametersAndRoute with & syntax",function(){same(SC.routes._extractParametersAndRoute({route:"videos/5&format=h264"}),{route:"videos/5",params:"&format=h264",format:"h264"},"route parameters should be correctly extracted");
same(SC.routes._extractParametersAndRoute({route:"videos/5&format=h264&size=small"}),{route:"videos/5",params:"&format=h264&size=small",format:"h264",size:"small"},"route parameters should be correctly extracted");
same(SC.routes._extractParametersAndRoute({route:"videos/5&format=h264&size=small",format:"ogg"}),{route:"videos/5",params:"&format=ogg&size=small",format:"ogg",size:"small"},"route parameters should be extracted and overwritten")
});module("Timer.invalidate");test("invalidate immediately should never execute",function(){var e=NO;
SC.RunLoop.begin();var g=SC.RunLoop.currentRunLoop.get("startTime");var d=SC.Timer.schedule({target:this,action:function(){e=YES
},interval:100});d.invalidate();SC.RunLoop.end();stop(2500);setTimeout(function(){equals(NO,e);
window.start()},1500)});module("SC.Object.invokeLater");test("should invoke method string after specified time",function(){SC.RunLoop.begin();
var e=NO;var h=SC.Object.create({func:function(){e=YES}});h.invokeLater("func",200);
SC.RunLoop.end();var g=20;var d=function d(){if(!e&&--g>=0){setTimeout(d,100);return
}equals(YES,e,"did not fire");window.start()};stop();setTimeout(d,300)});test("should invoke method instance after specified time",function(){SC.RunLoop.begin();
var e=NO;var h=SC.Object.create({func:function(){e=YES}});h.invokeLater(h.func,200);
SC.RunLoop.end();var g=20;var d=function d(){if(!e&&--g>=0){setTimeout(d,100);return
}equals(YES,e,"did not fire");window.start()};stop();setTimeout(d,300)});test("should invoke method string immediately if no time passed",function(){SC.RunLoop.begin();
var e=NO;var h=SC.Object.create({func:function(){e=YES}});h.invokeLater("func");SC.RunLoop.end();
var g=20;var d=function d(){if(!e&&--g>=0){setTimeout(d,100);return}equals(YES,e,"did not fire");
window.start()};stop();setTimeout(d,300)});test("should automatically bind with arguments if passed",function(){SC.RunLoop.begin();
var h=NO;var e=null,d=null;var k=SC.Object.create({func:function(m,l){e=m;d=l;h=YES
}});k.invokeLater("func",200,"ARG1","ARG2");SC.RunLoop.end();var j=20;var g=function g(){if(!h&&--j>=0){setTimeout(g,100);
return}equals(YES,h,"did not fire");equals(e,"ARG1","arg1");equals(d,"ARG2","arg2");
window.start()};stop();setTimeout(g,300)});module("Function.invokeLater");test("should invoke function with target after specified time",function(){SC.RunLoop.begin();
var h=NO;var g=null;var k=SC.Object.create();var d=function(){h=YES;g=this};d.invokeLater(k,200);
SC.RunLoop.end();var j=20;var e=function e(){if(!h&&--j>=0){setTimeout(e,100);return
}equals(YES,h,"did not fire");equals(g,k,"target");window.start()};stop();setTimeout(e,300)
});test("should invoke object with no target after specified time",function(){SC.RunLoop.begin();
var g=NO;var d=function(){g=YES};d.invokeLater(null,200);SC.RunLoop.end();var h=20;
var e=function e(){if(!g&&--h>=0){setTimeout(e,100);return}equals(YES,g,"did not fire");
window.start()};stop();setTimeout(e,300)});test("should invoke function immediately if no time passed",function(){SC.RunLoop.begin();
var g=NO;var j=SC.Object.create();var d=function(){g=YES};d.invokeLater(j);SC.RunLoop.end();
var h=20;var e=function e(){if(!g&&--h>=0){setTimeout(e,100);return}equals(YES,g,"did not fire");
window.start()};stop();setTimeout(e,300)});test("should automatically bind with arguments if passed",function(){SC.RunLoop.begin();
var j=NO;var e=null,d=null;var l=SC.Object.create();var g=function(n,m){e=n;d=m;j=YES
};g.invokeLater(l,200,"ARG1","ARG2");SC.RunLoop.end();var k=20;var h=function h(){if(!j&&--k>=0){setTimeout(h,100);
return}equals(YES,j,"did not fire");equals(e,"ARG1","arg1");equals(d,"ARG2","arg2");
window.start()};stop();setTimeout(h,300)});module("Timer.isPaused");test("setting isPaused should stop firing",function(){var e=0,d,m,k;
SC.RunLoop.begin();var l=SC.RunLoop.currentRunLoop.get("startTime");var g=SC.Timer.schedule({target:this,action:function(){e++
},interval:100,repeats:YES});SC.RunLoop.end();var j=10;d=function d(){if(e<2){if(--j>=0){setTimeout(d,100)
}else{equals(NO,YES,"Timer never fired 2 times - f1");window.start()}}else{equals(NO,g.get("isPaused"),"should start with isPaused = NO");
g.set("isPaused",YES);e=0;setTimeout(m,300)}};m=function m(){equals(0,e,"timer kept firing!");
equals(YES,g.get("isPaused"),"timer is not paused");g.set("isPaused",NO);setTimeout(k,300)
};var h=10;k=function k(){if(e<=2){if(--h>=0){setTimeout(k,100)}else{equals(NO,YES,"Timer did not resume");
window.start()}}else{g.invalidate();equals(NO,g.get("isPaused"),"timer did not unpause");
window.start()}};stop();setTimeout(d,300)});var objectA,objectB,object;module("SC.Timer.fireTime + SC.Timer.performAction ",{setup:function(){objectA={};
objectB={};object=SC.Object.create({performActionProp:"",callAction:function(){this.set("performActionProp","performAction")
}})}});test("performAction() should call the specified method ",function(){var d;
d=SC.Timer.create();d.action=object.callAction();d.performAction();equals("performAction",object.performActionProp)
});test("fireTime() should return the next time the timer should fire",function(){var d;
d=SC.Timer.create();equals(-1,d.fireTime(),"for isValid YES");equals(-1,d.fireTime(),"for startTime not set");
d.startTime=10;d.interval=10;d.lastFireTime=5;equals(20,d.fireTime(),"next fire time")
});test("fire() should call the action",function(){var e=0;SC.RunLoop.begin();var g=SC.RunLoop.currentRunLoop.get("startTime");
var d=SC.Timer.schedule({target:this,action:function(){e++},interval:100});d.fire();
SC.RunLoop.end();stop(2500);setTimeout(function(){equals(2,e);window.start()},1500)
});module("Timer.schedule single timer");test("single timer should execute once and invalidate",function(){var h=[];
SC.RunLoop.begin();var j=SC.RunLoop.currentRunLoop.get("startTime");var e=SC.Timer.schedule({target:this,action:function(){h.push(Date.now())
},interval:100,repeats:NO});SC.RunLoop.end();var d=10;var g=function g(){if(h.length===0&&--d>0){setTimeout(g,100);
return}equals(1,h.length,"fired count");equals(NO,e.get("isValid"),"isValid");window.start()
};stop();setTimeout(g,300)});test("repeating timer with no limit should repeat until terminated",function(){var h=[];
SC.RunLoop.begin();var k=SC.RunLoop.currentRunLoop.get("startTime");var j=4;var e=SC.Timer.schedule({target:this,action:function(){h.push(Date.now());
if(--j<=0){e.invalidate()}},interval:100,repeats:YES});SC.RunLoop.end();var d=10;
var g=function g(){if(--d<0){window.start();equals(YES,NO,"Check Count Exceeded")
}if(j>0){setTimeout(g,100)}else{var l=h.map(function(m){return m-k});equals(4,h.length,"fired count: %@".fmt(l.join(", ")));
equals(NO,e.get("isValid"),"isValid");window.start()}};stop();setTimeout(g,600)});
test("repeating timer should terminate after expiration",function(){var h=[];SC.RunLoop.begin();
var k=SC.RunLoop.currentRunLoop.get("startTime");var j=4;var e=SC.Timer.schedule({target:this,action:function(){h.push(Date.now())
},interval:100,repeats:YES,until:k+500});SC.RunLoop.end();var d=10;var g=function g(){if(--d<0){window.start();
equals(YES,NO,"Timer never invalidated :")}if((d>0)&&e.get("isValid")){setTimeout(g,100)
}else{var l=h.map(function(m){return m-k});equals(NO,e.get("isValid"),"Timer did not terminate: %@".fmt(l.join(", ")));
window.start()}};stop();setTimeout(g,600)});test("scheduling multiple timers at the same time should cause them to fire at same time",function(){var d=0;
var l=0;SC.RunLoop.begin();var k=SC.RunLoop.currentRunLoop.get("startTime");var g=SC.Timer.schedule({target:this,action:function(){d=SC.RunLoop.currentRunLoop.get("startTime")
},interval:100});var e=SC.Timer.schedule({target:this,action:function(){l=SC.RunLoop.currentRunLoop.get("startTime")
},interval:100});SC.RunLoop.end();var j=10;var h=function h(){if((d===0||l===0)&&--j>=0){setTimeout(h,100);
return}equals(d,l,"execution time f1 == f2");equals(NO,g.get("isValid"),"t1.isValid");
equals(NO,e.get("isValid"),"t2.isValid");window.start()};stop();setTimeout(h,200)
});var obj;module("User Defaults",{setup:function(){obj=SC.Object.create({bck:"green"})
}});test("To check if the user defaults are stored and read from local storage",function(){SC.userDefaults.writeDefault("Back",obj.bck);
equals(SC.userDefaults.readDefault("Back"),obj.bck,"should read written property")
});var url,url1,url2;module("SC.normalizeURL");test("should normalize the url passed as the parameter",function(){url="/desktop/mydocuments/music";
equals(SC.normalizeURL(url),"http://"+window.location.host+"/desktop/mydocuments/music","Path with slash");
url1="desktop/mydocuments/music";equals(SC.normalizeURL(url1),"%@/desktop/mydocuments/music".fmt(window.location.href),"Path without slash");
url2="http:";equals(YES,SC.normalizeURL(url2)===url2,"Path with http:")});module("SC.Range");
test("to find the maxRange() and minRange() values of a given range",function(){var d={start:15,length:75};
equals(YES,SC.minRange(d)==15,"Minimum range");equals(YES,SC.maxRange(d)==90,"Maximum range")
});test("unionRanges() to find the union of two ranges",function(){var d={start:15,length:75};
var e={start:5,length:50};var g=SC.unionRanges(d,e);equals(e.start,SC.minRange(g),"Minimum range");
equals(85,g.length,"Maximum range")});test("rangesEqual() to find if the given ranges are equal",function(){var g={start:15,length:75};
var j={start:15,length:75};var e={start:5,length:50};var k=SC.rangesEqual(g,j);var h=SC.rangesEqual(j,e);
equals(true,k,"Equal ranges");equals(false,h,"Unequal ranges")});test("cloneRange() to clone the given range",function(){var d={start:15,length:75};
var e=SC.cloneRange(d);equals(d.start,SC.minRange(e),"Minimum range");equals(75,e.length,"Maximum range")
});test("valueInRange() to find if a given value is in range",function(){var e={start:15,length:75};
var h=SC.valueInRange(25,e);var g=SC.valueInRange(10,e);equals(true,h,"In range");
equals(false,g,"Not in range")});test("intersectRanges() to get the intersection of 2 ranges",function(){var e={start:15,length:75};
var d={start:5,length:50};var g=SC.intersectRanges(e,d);equals(SC.minRange(e),SC.minRange(g),"Minimum Intersection Range");
equals(40,g.length,"Maximum Intersection Range")});module("Rect utilities");test("Get the X & Y points of a rect",function(){var d={x:50,y:40,width:700,height:9000};
expect(6);equals(SC.minX(d),50,"Left edge");equals(SC.maxX(d),750,"Right edge");equals(SC.midX(d),400,"Horizontal midpoint");
equals(SC.minY(d),40,"Top edge");equals(SC.maxY(d),9040,"Bottom edge");equals(SC.midY(d),4540,"Vertical midpoint")
});test("Treat empty object as frame with 0 width and height",function(){var d={};
expect(6);equals(SC.minX(d),0,"Left edge");equals(SC.maxX(d),0,"Right edge");equals(SC.midX(d),0,"Horizontal midpoint");
equals(SC.minY(d),0,"Top edge");equals(SC.maxY(d),0,"Bottom edge");equals(SC.midY(d),0,"Vertical midpoint")
});test("pointInRect() to test if a given point is inside the rect",function(){var d={x:50,y:40,width:700,height:9000};
ok(SC.pointInRect({x:100,y:100},d),"Point in rect");equals(NO,SC.pointInRect({x:40,y:100},d),"Point out of rect horizontally");
equals(NO,SC.pointInRect({x:600,y:9100},d),"Point out of rect vertically");equals(NO,SC.pointInRect({x:0,y:0},d),"Point up and left from rect");
equals(NO,SC.pointInRect({x:800,y:9500},d),"Point down and right from rect")});test("rectsEqual() tests equality with default delta",function(){var d={x:50,y:50,width:100,height:100};
equals(SC.rectsEqual(d,d),YES,"Frames are same object");equals(SC.rectsEqual(d,{x:50,y:50,width:100,height:100}),YES,"Frames have same position and dimensions");
equals(SC.rectsEqual(d,{x:50.08,y:50,width:100,height:100}),YES,"Frame.x above, within delta");
equals(SC.rectsEqual(d,{x:49.92,y:50,width:100,height:100}),YES,"Frame.x below, within delta");
equals(SC.rectsEqual(d,{x:50,y:50.099,width:100,height:100}),YES,"Frame.y within delta");
equals(SC.rectsEqual(d,{x:50,y:50,width:100.001,height:100}),YES,"Frame.width within delta");
equals(SC.rectsEqual(d,{x:50,y:50,width:100,height:100.09999}),YES,"Frame.height within delta");
equals(SC.rectsEqual(d,{x:55,y:50,width:100,height:100}),NO,"Frame.x not equal");
equals(SC.rectsEqual(d,{x:50,y:55,width:100,height:100}),NO,"Frame.y not equal");
equals(SC.rectsEqual(d,{x:50,y:50,width:105,height:100}),NO,"Frame.width not equal");
equals(SC.rectsEqual(d,{x:50,y:50,width:100,height:105}),NO,"Frame.height not equal")
});test("rectsEqual() tests equality with null delta",function(){var d={x:50,y:50,width:100,height:100};
equals(SC.rectsEqual(d,d),YES,"Frames are same object");equals(SC.rectsEqual(d,{x:50,y:50,width:100,height:100},null),YES,"Frames have same position and dimensions");
equals(SC.rectsEqual(d,{x:50.08,y:50,width:100,height:100},null),YES,"Frame.x above, within delta");
equals(SC.rectsEqual(d,{x:49.92,y:50,width:100,height:100},null),YES,"Frame.x below, within delta");
equals(SC.rectsEqual(d,{x:50,y:50.099,width:100,height:100},null),YES,"Frame.y within delta");
equals(SC.rectsEqual(d,{x:50,y:50,width:100.001,height:100},null),YES,"Frame.width within delta");
equals(SC.rectsEqual(d,{x:50,y:50,width:100,height:100.01},null),YES,"Frame.height within delta");
equals(SC.rectsEqual(d,{x:55,y:50,width:100,height:100},null),NO,"Frame.x not equal");
equals(SC.rectsEqual(d,{x:50,y:55,width:100,height:100},null),NO,"Frame.y not equal");
equals(SC.rectsEqual(d,{x:50,y:50,width:105,height:100},null),NO,"Frame.width not equal");
equals(SC.rectsEqual(d,{x:50,y:50,width:100,height:105},null),NO,"Frame.height not equal")
});test("rectsEqual() tests equality with delta of 10",function(){var d={x:50,y:50,width:100,height:100};
equals(SC.rectsEqual(d,d),YES,"Frames are same object");equals(SC.rectsEqual(d,{x:50,y:50,width:100,height:100},10),YES,"Frames have same position and dimensions");
equals(SC.rectsEqual(d,{x:59.99,y:50,width:100,height:100},10),YES,"Frame.x above, within delta");
equals(SC.rectsEqual(d,{x:41,y:50,width:100,height:100},10),YES,"Frame.x below, within delta");
equals(SC.rectsEqual(d,{x:50,y:59,width:100,height:100},10),YES,"Frame.y within delta");
equals(SC.rectsEqual(d,{x:50,y:50,width:109,height:100},10),YES,"Frame.width within delta");
equals(SC.rectsEqual(d,{x:50,y:50,width:100,height:100.000002},10),YES,"Frame.height within delta");
equals(SC.rectsEqual(d,{x:61,y:50,width:100,height:100},10),NO,"Frame.x not equal");
equals(SC.rectsEqual(d,{x:50,y:92,width:100,height:100},10),NO,"Frame.y not equal");
equals(SC.rectsEqual(d,{x:50,y:50,width:89,height:100},10),NO,"Frame.width not equal");
equals(SC.rectsEqual(d,{x:50,y:50,width:100,height:89.99999},10),NO,"Frame.height not equal")
});test("rectsEqual() tests equality with delta of 0",function(){var d={x:50,y:50,width:100,height:100};
equals(SC.rectsEqual(d,d),YES,"Frames are same object");equals(SC.rectsEqual(d,{x:50,y:50,width:100,height:100},0),YES,"Frames have same position and dimensions");
equals(SC.rectsEqual(d,{x:50.0001,y:50,width:100,height:100},0),NO,"Frame.x not equal");
equals(SC.rectsEqual(d,{x:50,y:51,width:100,height:100},0),NO,"Frame.y not equal");
equals(SC.rectsEqual(d,{x:50,y:50,width:99,height:100},0),NO,"Frame.width not equal");
equals(SC.rectsEqual(d,{x:50,y:50,width:100,height:102},0),NO,"Frame.height not equal")
});module("credit_card validation - fieldValueForObject()");test("Expects a string of 16 digits.  Will split into groups of 4 for display.",function(){var g=SC.Validator.CreditCard.create();
var d="1234567890123456";var e=g.fieldValueForObject("1234567891234567");equals(e,"1234 5678 9123 4567")
});test("Removes all whitespace or dashes to make a single string",function(){var g=SC.Validator.CreditCard.create();
var e="1234 5678-9012-3456";var d=g.objectForFieldValue(e);equals(d,"1234567890123456")
});test("Checks all valid card numbers or dashes to make a single string",function(){var g=SC.Validator.CreditCard.create();
var e="1234 5678-9012-3456";equals(g.checkNumber(e),false);var d="4111 1111 1111 1111";
equals(g.checkNumber(d),true)});module("SC.Validator.Date");test("Converts into date if a value is given",function(){var d=1234947136000;
var e=SC.Validator.Date.fieldValueForObject(1234947136000,"","");equals(YES,e==="Feb 18, 2009 12:52:16 AM","Number converted to date format")
});test("Converts into number when date string is given",function(){var e="Feb 18, 2009 12:52:16 AM";
var g=SC.Validator.Date.objectForFieldValue("Feb 18, 2009 12:52:16 AM","","");equals(YES,g===1234947136000,"Date String compared with value in seconds");
equals(YES,SC.typeOf(g)=="number","Number is obtained")});module("SC.Validator.Number ");
test("validate() a number",function(){var d=SC.$("input")});test("Checking fieldValueForObject",function(){var e={};
var d;d=SC.Validator.Number.fieldValueForObject(e,"","");equals(SC.T_HASH,SC.typeOf(d),"Returns an object");
d=SC.Validator.Number.fieldValueForObject(5354534545312.999,"","");equals(5354534545313,d,"Value rounded to closest value");
d=SC.Validator.Number.fieldValueForObject(null,"","");equals("",d,"for null");d=SC.Validator.Number.fieldValueForObject(undefined,"","");
equals("",d,"for undefined")});test("Checking objectForFieldValue",function(){var e={};
var d="";d=SC.Validator.Number.objectForFieldValue("","","");equals(null,d,"Returns null for an empty string parameter");
d=SC.Validator.Number.objectForFieldValue("121 222","","");equals(121,d,"numerical string with spaces");
d=SC.Validator.Number.objectForFieldValue("121.999","","");equals(121,d,"a float value string")
});test("Checking validateKeyDown",function(){});module("SC.Validator");test("Calling fieldValueForObject() should not fail if this.prototypefieldValueForObject() is null",function(){var d=SC.Validator.extend({fieldValueForObject:null});
equals(null,d.fieldValueForObject({},null,null),"should return null")});test("Calling objectForFieldValue() should not fail if this.prototype.objectForFieldValue() is null",function(){var d=SC.Validator.extend({objectForFieldValue:null});
equals(null,d.objectForFieldValue({},null,null),"should return null")});module("TODO: Test SC.ContainerView Methods");
(function(){var d=SC.ControlTestPane.design({height:100});d.add("basic",SC.ContainerView,{isEnabled:YES});
d.add("disabled",SC.ContainerView,{isEnabled:NO});d.show();module("SC.ContainerView UI",d.standardSetup());
test("basic",function(){var e=d.view("basic");ok(!e.$().hasClass("disabled"),"should not have disabled class");
ok(!e.$().hasClass("sel"),"should not have sel class")});test("disabled",function(){var e=d.view("disabled");
ok(e.$().hasClass("disabled"),"should have disabled class");ok(!e.$().hasClass("sel"),"should not have sel class")
})})();htmlbody("<style> .sc-static-layout { border: 1px red dotted; } </style>");
(function(){var d="http://photos4.meetupstatic.com/photos/event/4/6/9/9/600_4518073.jpeg";
var e=SC.ControlTestPane.design().add("image_not_loaded",SC.ImageView,{value:null,layout:{width:200,height:300}}).add("image_loaded",SC.ImageView,{value:d,status:"loaded",layout:{width:200,height:300}});
e.show();module("SC.ImageView ui",e.standardSetup());test("Verify that all the rendering properties of an image that is being loaded are correct",function(){var g=e.view("image_not_loaded");
ok(g.get("isVisibleInWindow"),"image_not_loaded is visible in window");g.set("value",d);
ok(g.get("status")!=="loaded","PRECOND - status should not be loaded (status=%@)".fmt(g.get("status")));
var h=g.$().attr("src");ok((h.indexOf("base64")!=-1)||(h.indexOf("blank.gif")!=-1),"The src should be blank URL. url = %@".fmt(h))
});test("Verify that all the rendering properties of an image that is loaded are correct",function(){ok(e.view("image_loaded").get("isVisibleInWindow"),"image_loaded is visible in window");
equals(e.view("image_loaded").$().attr("src"),d,"should be the same url")});test("Verify that the tooltip is correctly being set as both the title and attribute (disabling localization for this test)",function(){var g=e.view("image_loaded");
var h="This is a test tooltip";SC.RunLoop.begin();g.set("localization",NO);g.set("toolTip",h);
SC.RunLoop.end();ok((g.$().attr("title")===h),'The title attribute should be set to "'+h+'"');
ok((g.$().attr("alt")===h),'The alt attribute should be set to "'+h+'"')})})();htmlbody("<style> .sc-static-layout { border: 1px red dotted; } </style>");
var iconURL="http://www.freeiconsweb.com/Icons/16x16_people_icons/People_046.gif";
(function(){var d=SC.ControlTestPane.design().add("basic",SC.LabelView,{value:"hello"}).add("disabled",SC.LabelView,{value:"hello",isEnabled:NO}).add("selectable",SC.LabelView,{value:"hello",isTextSelectable:YES}).add("centered",SC.LabelView,{value:"hello",textAlign:SC.ALIGN_CENTER}).add("centered,icon",SC.LabelView,{value:"hello",textAlign:SC.ALIGN_CENTER,icon:iconURL}).add("regular size",SC.LabelView,{value:"hello",controlSize:SC.REGULAR_CONTROL_SIZE}).add("small size",SC.LabelView,{value:"hello",controlSize:SC.SMALL_CONTROL_SIZE}).add("tiny size",SC.LabelView,{value:"hello",controlSize:SC.TINY_CONTROL_SIZE}).add("bold",SC.LabelView,{value:"hello",fontWeight:SC.BOLD_WEIGHT}).add("bold height",SC.LabelView,{value:"hello",fontWeight:SC.BOLD_WEIGHT,height:16}).add("editable",SC.LabelView,{value:"double click me",isEditable:YES});
d.show();module("SC.LabelView ui");test("Check that all Label are visible",function(){ok(d.view("basic").get("isVisibleInWindow"),"basic.isVisibleInWindow should be YES");
ok(d.view("disabled").get("isVisibleInWindow"),"title.isVisibleInWindow should be YES");
ok(d.view("selectable").get("isVisibleInWindow"),"icon.isVisibleInWindow should be YES");
ok(d.view("centered").get("isVisibleInWindow"),"title,icon.isVisibleInWindow should be YES");
ok(d.view("centered,icon").get("isVisibleInWindow"),"title,icon,disabled.isVisibleInWindow should be YES");
ok(d.view("regular size").get("isVisibleInWindow"),"title,icon,default.isVisibleInWindow should be YES");
ok(d.view("small size").get("isVisibleInWindow"),"title.icon,selected.isVisibleInWindow should be YES");
ok(d.view("tiny size").get("isVisibleInWindow"),"title,toolTip.isVisibleInWindow should be YES");
ok(d.view("bold").get("isVisibleInWindow"),"title,toolTip.isVisibleInWindow should be YES");
ok(d.view("bold height").get("isVisibleInWindow"),"title,toolTip.isVisibleInWindow should be YES");
ok(d.view("editable").get("isVisibleInWindow"),"title,toolTip.isVisibleInWindow should be YES")
});test("Check that all labels have the right classes set",function(){var e=d.view("basic").$();
ok(e.hasClass("sc-view"),"basic.hasClass(sc-view) should be YES");ok(e.hasClass("sc-label-view"),"basic.hasClass(sc-label-view) should be YES");
ok(!e.hasClass("icon"),"basic.hasClass(icon) should be NO");ok(!e.hasClass("disabled"),"basic.hasClass(disabled) should be YES");
e=d.view("disabled").$();ok(e.hasClass("sc-view"),"title.hasClass(sc-view) should be YES");
ok(e.hasClass("sc-label-view"),"title.hasClass(sc-label-view) should be YES");ok(!e.hasClass("icon"),"title.hasClass(icon) should be NO");
ok(e.hasClass("disabled"),"title.hasClass(disabled) should be NO");e=d.view("selectable").$();
ok(e.hasClass("sc-view"),"icon.hasClass(sc-view) should be YES");ok(e.hasClass("sc-label-view"),"icon.hasClass(sc-label-view) should be YES");
ok(e.hasClass("sc-regular-size"),"icon.hasClass(sc-regular-size) should be YES");
ok(!e.hasClass("icon"),"icon.hasClass(icon) should be YES");ok(!e.hasClass("sel"),"icon.hasClass(sel) should be NO");
ok(!e.hasClass("disabled"),"icon.hasClass(disabled) should be NO");e=d.view("centered").$();
ok(e.hasClass("sc-view"),"title,icon.hasClass(sc-view) should be YES");ok(e.hasClass("sc-label-view"),"title,icon.hasClass(sc-label-view) should be YES");
ok(!e.hasClass("icon"),"title,icon.hasClass(icon) should be YES");ok(!e.hasClass("disabled"),"title,icon.hasClass(disabled) should be NO");
e=d.view("centered,icon").$();ok(e.hasClass("sc-view"),"title,icon,disabled.hasClass(sc-view) should be YES");
ok(e.hasClass("sc-label-view"),"title,icon,disabled.hasClass(sc-label-view) should be YES");
ok(e.hasClass("icon"),"title,icon,disabled.hasClass(icon) should be YES");ok(!e.hasClass("disabled"),"title,icon,disabled.hasClass(disabled) should be YES");
e=d.view("regular size").$();ok(e.hasClass("sc-view"),"title,icon,default.hasClass(sc-view) should be YES");
ok(e.hasClass("sc-label-view"),"title,icon,default.hasClass(sc-label-view) should be YES");
ok(e.hasClass("sc-regular-size"),"title,icon,default.hasClass(sc-regular-size) should be YES");
ok(!e.hasClass("disabled"),"title,icon,default.hasClass(disabled) should be NO");
e=d.view("bold").$();ok(e.hasClass("sc-view"),"title,icon,selected.hasClass(sc-view) should be YES");
ok(e.hasClass("sc-label-view"),"title,icon,selected.hasClass(sc-label-view) should be YES");
ok(!e.hasClass("icon"),"title,icon,selected.hasClass(icon) should be YES");ok(!e.hasClass("disabled"),"title,icon,selected.hasClass(disabled) should be NO")
});test("Check that the title is set or not and if it is in the appropriate element",function(){var e=d.view("basic").$();
equals(e.text(),"hello","has a value set");e=d.view("centered,icon").$("img");ok((e!==null),"should have an image corresponding to an icon")
})})();var FRAME={x:10,y:10,width:30,height:30};var pane,view;module("SC.MainPane");
test("should attach when calling append()",function(){var d=SC.MainPane.create();
d.append();equals(d.get("isPaneAttached"),YES)});test("appending should make pane main & key",function(){var e=SC.MainPane.create();
e.append();var d=e.get("rootResponder");equals(d.get("mainPane"),e,"should become mainPane");
equals(d.get("keyPane"),e,"should become keyPane")});htmlbody('<div id="appendtest"></div>');
module("SC.Pane#appendTo");test("adding to document for first time",function(){var g=SC.Pane.create();
ok(!g.get("layer"),"precond - does not yet have layer");ok(!g.get("isVisibleInWindow"),"precond - isVisibleInWindow = NO");
var e=Q$("body").get(0);ok(e,"precond - found element to add to");g.appendTo(e);var d=g.get("layer");
ok(d,"should create layer");equals(d.parentNode,e,"layer should belong to parent");
ok(g.get("isVisibleInWindow"),"isVisibleInWindow should  = YES");ok(g.rootResponder,"should have rootResponder")
});test("adding a pane twice should have no effect",function(){var d=0;var e=SC.Pane.create();
e._tmp_paneDidAttach=e.paneDidAttach;e.paneDidAttach=function(){d++;return this._tmp_paneDidAttach.apply(this,arguments)
};e.append();e.append();equals(d,1,"should only append once")});test("readding pane",function(){var h=SC.Pane.create();
var e=Q$("body").get(0),d=Q$("#appendtest").get(0);ok(e&&d,"precond - has elem1 && elem2: elem1=%@ elem2=%@".fmt(e,d));
h.appendTo(e);var g=h.get("layer");ok(g,"has layer");equals(g.parentNode,e,"layer belongs to parent");
h.appendTo(d);equals(g.parentNode,d,"layer moved to new parent");ok(h.get("isVisibleInWindow"),"isVisibleInWindow should  = YES");
ok(h.rootResponder,"should have rootResponder")});test("adding/remove/adding pane",function(){var h=SC.Pane.create();
var e=Q$("body").get(0),d=Q$("#appendtest").get(0);ok(e&&d,"precond - has elem1 && elem2");
h.appendTo(e);var g=h.get("layer");ok(g,"has layer");equals(g.parentNode,e,"layer belongs to parent");
ok(h.get("isVisibleInWindow"),"isVisibleInWindow is YES before remove");h.remove();
ok(!h.get("isVisibleInWindow"),"isVisibleInWindow is NO");h.appendTo(d);g=h.get("layer");
equals(g.parentNode,d,"layer moved to new parent");ok(h.get("isVisibleInWindow"),"isVisibleInWindow should  = YES");
ok(h.rootResponder,"should have rootResponder")});module("SC.Pane#remove");test("removes pane from DOM",function(){var g=SC.Pane.create();
var e=Q$("body").get(0);var d;g.appendTo(e);d=g.get("layer");ok(e,"precond - found element to add to");
g.remove();ok(d.parentNode!==e,"layer no longer belongs to parent");ok(!g.get("isVisibleInWindow"),"isVisibleInWindow is NO")
});test("updates frame and clippingFrame when loading MainPane",function(){var e=SC.MainPane.create();
var d=SC.RootResponder.responder.computeWindowSize().width;SC.run(function(){e.append()
});equals(e.get("frame").width,d,"frame width should have changed");equals(e.get("clippingFrame").width,d,"clippingFrame width should have changed")
});var pane,r,view0,view1;CommonSetup={setup:function(){pane=SC.Pane.create({childViews:[SC.View,SC.View]});
view0=pane.childViews[0];view1=pane.childViews[1];pane.append();r=pane.get("rootResponder");
ok(r,"has root responder")},teardown:function(){pane.remove();pane=r=view0=view1=null
}};module("SC.Pane#makeFirstResponder",CommonSetup);test("make firstResponder from null, not keyPane",function(){var d=0,e=0;
view0.didBecomeFirstResponder=function(){d++};view0.willBecomeKeyResponderFrom=view0.didBecomeKeyResponderFrom=function(){e++
};pane.makeFirstResponder(view0);equals(d,1,"should invoke didBecomeFirstResponder callbacks");
equals(e,0,"should not invoke ..BecomeKeyResponder callbacks");equals(pane.get("firstResponder"),view0,"should set firstResponder to view");
ok(view0.get("isFirstResponder"),"should set view.isFirstResponder to YES");ok(!view0.get("isKeyResponder"),"should not set view.isKeyResponder")
});test("make firstResponder from null, is keyPane",function(){var d=0;view0.didBecomeFirstResponder=view0.willBecomeKeyResponderFrom=view0.didBecomeKeyResponderFrom=function(){d++
};pane.becomeKeyPane();pane.makeFirstResponder(view0);equals(d,3,"should invoke didBecomeFirstResponder + KeyResponder callbacks");
equals(pane.get("firstResponder"),view0,"should set firstResponder to view");ok(view0.get("isFirstResponder"),"should set view.isFirstResponder to YES");
ok(view0.get("isKeyResponder"),"should set view.isKeyResponder")});test("make firstResponder from other view, not keyPane",function(){pane.makeFirstResponder(view1);
equals(pane.get("firstResponder"),view1,"precond - view1 is firstResponder");var d=0,e=0;
view0.didBecomeFirstResponder=function(){d++};view1.willLoseFirstResponder=function(){d++
};view0.willBecomeKeyResponderFrom=view0.didBecomeKeyResponderFrom=function(){e++
};view1.willLoseKeyResponderTo=view0.didLoseKeyResponderTo=function(){e++};pane.makeFirstResponder(view0);
equals(d,2,"should invoke ..BecomeFirstResponder callbacks");equals(e,0,"should not invoke ..BecomeKeyResponder callbacks");
equals(pane.get("firstResponder"),view0,"should set firstResponder to view");ok(view0.get("isFirstResponder"),"should set view.isFirstResponder to YES");
ok(!view0.get("isKeyResponder"),"should not set view.isKeyResponder");ok(!view1.get("isFirstResponder"),"view1.isFirstResponder should now be set to NO")
});test("make firstResponder from other view, as keyPane",function(){pane.becomeKeyPane();
pane.makeFirstResponder(view1);equals(pane.get("firstResponder"),view1,"precond - view1 is firstResponder");
ok(view1.get("isFirstResponder"),"precond - view1.isFirstResponder should be YES");
ok(view1.get("isKeyResponder"),"precond - view1.isFirstResponder should be YES");
var d=0;view0.didBecomeFirstResponder=view1.willLoseFirstResponder=view0.willBecomeKeyResponderFrom=view0.didBecomeKeyResponderFrom=view1.willLoseKeyResponderTo=view1.didLoseKeyResponderTo=function(){d++
};pane.makeFirstResponder(view0);equals(d,6,"should invoke FirstResponder + KeyResponder callbacks on both views");
equals(pane.get("firstResponder"),view0,"should set firstResponder to view");ok(view0.get("isFirstResponder"),"should set view.isFirstResponder to YES");
ok(view0.get("isKeyResponder"),"should set view.isKeyResponder");ok(!view1.get("isFirstResponder"),"view1.isFirstResponder should now be set to NO");
ok(!view1.get("isKeyResponder"),"view1.isFirstResponder should now be set to NO")
});test("makeFirstResponder(view) when view is already first responder",function(){pane.becomeKeyPane();
pane.makeFirstResponder(view0);equals(pane.get("firstResponder"),view0,"precond - view0 is firstResponder");
ok(view0.get("isFirstResponder"),"precond - view0.isFirstResponder should be YES");
ok(view0.get("isKeyResponder"),"precond - view0.isFirstResponder should be YES");
var d=0;view0.didBecomeFirstResponder=view0.willLoseFirstResponder=view0.willBecomeKeyResponderFrom=view0.didBecomeKeyResponderFrom=view0.willLoseKeyResponderTo=view0.didLoseKeyResponderTo=function(){d++
};pane.makeFirstResponder(view0);equals(d,0,"should invoke no FirstResponder + KeyResponder callbacks on view");
equals(pane.get("firstResponder"),view0,"should keep firstResponder to view");ok(view0.get("isFirstResponder"),"should keep view.isFirstResponder to YES");
ok(view0.get("isKeyResponder"),"should keep view.isKeyResponder")});var pane,r,view;
CommonSetup={setup:function(){pane=SC.Pane.create({childViews:[SC.View]});view=pane.childViews[0];
pane.makeFirstResponder(view);pane.append();r=pane.get("rootResponder");ok(r,"has root responder")
},teardown:function(){pane.remove();pane=r=view=null}};module("SC.Pane#becomeKeyPane",CommonSetup);
test("should become keyPane if not already keyPane",function(){ok(r.get("keyPane")!==pane,"precond - pane is not currently key");
pane.becomeKeyPane();equals(r.get("keyPane"),pane,"pane should be keyPane");equals(pane.get("isKeyPane"),YES,"isKeyPane should be set to YES")
});test("should do nothing if acceptsKeyPane is NO",function(){ok(r.get("keyPane")!==pane,"precond - pane is not currently key");
pane.acceptsKeyPane=NO;pane.becomeKeyPane();ok(r.get("keyPane")!==pane,"pane should not be keyPane");
equals(pane.get("isKeyPane"),NO,"isKeyPane should be NO")});test("should invoke willBecomeKeyPane & didBecomeKeyPane",function(){var d=0;
pane.willBecomeKeyPaneFrom=pane.didBecomeKeyPaneFrom=function(){d++};pane.becomeKeyPane();
equals(d,2,"should invoke both callbacks");d=0;pane.becomeKeyPane();equals(d,0,"should not invoke callbacks if already key pane")
});test("should invoke callbacks and update isKeyResponder state on firstResponder",function(){var d=0;
view.willBecomeKeyResponderFrom=view.didBecomeKeyResponderFrom=function(){d++};equals(view.get("isKeyResponder"),NO,"precond - view is not keyResponder");
equals(view.get("isFirstResponder"),YES,"precond - view is firstResponder");pane.becomeKeyPane();
equals(d,2,"should invoke both callbacks");equals(view.get("isKeyResponder"),YES,"should be keyResponder")
});module("SC.Pane#resignKeyPane",CommonSetup);test("should resign keyPane if keyPane",function(){pane.becomeKeyPane();
ok(r.get("keyPane")===pane,"precond - pane is currently key");pane.resignKeyPane();
ok(r.get("keyPane")!==pane,"pane should NOT be keyPane");equals(pane.get("isKeyPane"),NO,"isKeyPane should be set to NO")
});test("should still resign if acceptsKeyPane is NO",function(){pane.becomeKeyPane();
ok(r.get("keyPane")===pane,"precond - pane is currently key");pane.acceptsKeyPane=NO;
pane.resignKeyPane();ok(r.get("keyPane")!==pane,"pane should NOT be keyPane");equals(pane.get("isKeyPane"),NO,"isKeyPane should be set to NO")
});test("should invoke willLoseKeyPaneTo & didLoseKeyPaneTo",function(){pane.becomeKeyPane();
ok(r.get("keyPane")===pane,"precond - pane is currently key");var d=0;pane.willLoseKeyPaneTo=pane.didLoseKeyPaneTo=function(){d++
};pane.resignKeyPane();equals(d,2,"should invoke both callbacks");d=0;pane.resignKeyPane();
equals(d,0,"should not invoke callbacks if already key pane")});test("should invoke callbacks and update isKeyResponder state on firstResponder",function(){var d=0;
view.willLoseKeyResponderTo=view.didLoseKeyResponderTo=function(){d++};pane.becomeKeyPane();
equals(view.get("isKeyResponder"),YES,"precond - view is keyResponder");equals(view.get("isFirstResponder"),YES,"precond - view is firstResponder");
pane.resignKeyPane();equals(d,2,"should invoke both callbacks");equals(view.get("isKeyResponder"),NO,"should be keyResponder")
});var pane;module("SC.Pane#layout",{setup:function(){pane=SC.Pane.create({layout:{top:0,left:0,width:1,height:1}});
pane.append()},teardown:function(){pane.remove()}});test("make sure that a call to adjust actually adjusts the view's size",function(){SC.run(function(){pane.adjust({width:100,height:50})
});equals(pane.$()[0].style.width,"100px","width should have been adjusted");equals(pane.$()[0].style.height,"50px","height should have been adjusted")
});var pane,fooView,barView,defaultResponder,evt,callCount;module("SC.Pane#sendEvent",{setup:function(){callCount=0;
var d=function(e){callCount++;equals(e,evt,"should pass event")};defaultResponder=SC.Object.create({defaultEvent:d});
pane=SC.Pane.create({defaultResponder:defaultResponder,childViews:[SC.View.extend({fooEvent:d,childViews:[SC.View.extend({barEvent:d})]})]});
fooView=pane.childViews[0];ok(fooView.fooEvent,"has fooEvent handler");barView=fooView.childViews[0];
ok(barView.barEvent,"has barEvent handler");evt=SC.Object.create()},teardown:function(){pane=fooView=barView=defaultResponder=evt=null
}});test("when invoked with target = nested view",function(){var d;callCount=0;d=pane.sendEvent("barEvent",evt,barView);
equals(callCount,1,"should invoke handler");equals(d,barView,"should return view that handled event");
callCount=0;d=pane.sendEvent("fooEvent",evt,barView);equals(callCount,1,"should invoke handler");
equals(d,fooView,"should return responder that handled event");callCount=0;d=pane.sendEvent("defaultEvent",evt,barView);
equals(callCount,1,"should invoke handler");equals(d,defaultResponder,"should return responder that handled event");
callCount=0;d=pane.sendEvent("imaginary",evt,barView);equals(callCount,0,"should not invoke handler");
equals(d,null,"should return no responder")});test("when invoked with target = middle view",function(){var d;
callCount=0;d=pane.sendEvent("barEvent",evt,fooView);equals(callCount,0,"should not invoke handler");
equals(d,null,"should return no responder");callCount=0;d=pane.sendEvent("fooEvent",evt,fooView);
equals(callCount,1,"should invoke handler");equals(d,fooView,"should return responder that handled event");
callCount=0;d=pane.sendEvent("defaultEvent",evt,fooView);equals(callCount,1,"should invoke handler");
equals(d,defaultResponder,"should return responder that handled event");callCount=0;
d=pane.sendEvent("imaginary",evt,fooView);equals(callCount,0,"should not invoke handler");
equals(d,null,"should return no responder")});test("when invoked with target = pane",function(){var d;
callCount=0;d=pane.sendEvent("barEvent",evt,pane);equals(callCount,0,"should not invoke handler");
equals(d,null,"should return no responder");callCount=0;d=pane.sendEvent("fooEvent",evt,pane);
equals(callCount,0,"should not invoke handler");equals(d,null,"should return no responder");
callCount=0;d=pane.sendEvent("defaultEvent",evt,pane);equals(callCount,1,"should invoke handler");
equals(d,defaultResponder,"should return responder that handled event");callCount=0;
d=pane.sendEvent("imaginary",evt,pane);equals(callCount,0,"should not invoke handler");
equals(d,null,"should return no responder")});test("when invoked with target = null",function(){var d;
pane.firstResponder=fooView;callCount=0;d=pane.sendEvent("barEvent",evt);equals(callCount,0,"should not invoke handler");
equals(d,null,"should return no responder");callCount=0;d=pane.sendEvent("fooEvent",evt);
equals(callCount,1,"should invoke handler");equals(d,fooView,"should return responder that handled event");
callCount=0;d=pane.sendEvent("defaultEvent",evt);equals(callCount,1,"should invoke handler");
equals(d,defaultResponder,"should return responder that handled event");callCount=0;
d=pane.sendEvent("imaginary",evt);equals(callCount,0,"should not invoke handler");
equals(d,null,"should return no responder")});var pane,view,view1,view2;module("SC.TextFieldView",{setup:function(){SC.RunLoop.begin();
pane=SC.MainPane.create({childViews:[SC.TextFieldView.extend({hint:"First Name",value:"",title:"First Name"}),SC.TextFieldView.extend({hint:"Name",value:"SproutCore",isEnabled:NO}),SC.TextFieldView.extend({layerId:"fieldWithCustomId"})]});
pane.append();SC.RunLoop.end();view=pane.childViews[0];view1=pane.childViews[1];view2=pane.childViews[2]
},teardown:function(){pane.remove();pane=view=null}});test("renders an text field input tag with appropriate attributes",function(){equals(view.get("value"),"","value should be empty");
equals(view1.get("value"),"SproutCore","value should not be empty ");equals(view.get("isEnabled"),YES,"field enabled");
equals(view1.get("isEnabled"),NO,"field not enabled");var d=Q$("input",view.get("layer"));
equals(d.attr("type"),"text","should have type as text");equals(d.attr("name"),view.get("layerId"),"should have name as view_layerid")
});test("renders an text field with a custom layerId with correct id and name html attributes",function(){equals(view2.$().attr("id"),"fieldWithCustomId","label html element should have the custom id");
equals(view2.$input().attr("name"),"fieldWithCustomId","input html element should have the custom name")
});test("isEnabled=NO should add disabled class",function(){SC.RunLoop.begin();view.set("isEnabled",NO);
SC.RunLoop.end();ok(view.$().hasClass("disabled"),"should have disabled class")});
test("isEnabled and isEditable mapping",function(){var d=SC.TextFieldView.create();
d.set("isEnabled",false);equals(d.get("isEditable"),false);d.set("isEnabled",true);
equals(d.get("isEditable"),true)});(function(){var h=SC.ControlTestPane.design().add("empty",SC.TextFieldView,{hint:"Full Name",value:""}).add("with value",SC.TextFieldView,{hint:"Full Name",value:"John Doe"}).add("disabled - empty",SC.TextFieldView,{hint:"Full Name",value:null,isEnabled:NO}).add("disabled - with value",SC.TextFieldView,{hint:"Full Name",value:"John Doe",isEnabled:NO}).add("textarea - empty",SC.TextFieldView,{hint:"Full Name",value:"",isTextArea:YES}).add("textarea - with value",SC.TextFieldView,{hint:"Full Name",value:"John Doe",isTextArea:YES}).add("textarea - disabled - empty",SC.TextFieldView,{hint:"Full Name",value:"",isTextArea:YES,isEnabled:NO}).add("textarea - disabled - with value",SC.TextFieldView,{hint:"Full Name",value:"John Doe",isTextArea:YES,isEnabled:NO});
h.show();h.verifyEmpty=function d(j,m){var k=j.$("input");var l=j.$();ok(!l.hasClass("not-empty"),"layer should not have not-empty class");
equals(k.val(),"","input should have empty value");if(m){var n=j.$(".sc-hint");if(n.length===1){n=n.text()
}else{n=j.$("input");n=n.attr("placeholder")}equals(n,m,"hint span should have expected hint")
}};h.verifyNotEmpty=function g(j,l,n){var k=j.$("input");var m=j.$();ok(m.hasClass("not-empty"),"layer should have not-empty class");
equals(k.val(),l,"input should have value");if(n){var o=j.$(".sc-hint");if(o.length===1){o=o.text()
}else{o=j.$("input");o=o.attr("placeholder")}equals(o,n,"hint span should have expected hint")
}};h.verifyDisabled=function e(k,j){var m=k.$();var l=k.$("input");if(j){ok(m.hasClass("disabled"),"layer should have disabled class");
ok(l.attr("disabled"),"input should have disabled attr")}else{ok(!m.hasClass("disabled"),"layer should not have disabled class");
ok(!l.attr("disabled"),"input should not have disabled attr")}};module("SC.TextFieldView ui",h.standardSetup());
test("empty",function(){var j=h.view("empty");h.verifyEmpty(j,"Full Name");h.verifyDisabled(j,NO)
});test("with value",function(){var j=h.view("with value");h.verifyNotEmpty(j,"John Doe","Full Name");
h.verifyDisabled(j,NO)});test("disabled - empty",function(){var j=h.view("disabled - empty");
h.verifyEmpty(j,"Full Name");h.verifyDisabled(j,YES)});test("disabled - with value",function(){var j=h.view("disabled - with value");
h.verifyNotEmpty(j,"John Doe","Full Name");h.verifyDisabled(j,YES)});test("textarea - empty",function(){var j=h.view("empty");
h.verifyEmpty(j,"Full Name");h.verifyDisabled(j,NO)});test("textarea - with value",function(){var j=h.view("with value");
h.verifyNotEmpty(j,"John Doe","Full Name");h.verifyDisabled(j,NO)});test("textarea - disabled - empty",function(){var j=h.view("disabled - empty");
h.verifyEmpty(j,"Full Name");h.verifyDisabled(j,YES)});test("textarea - disabled - with value",function(){var j=h.view("disabled - with value");
h.verifyNotEmpty(j,"John Doe","Full Name");h.verifyDisabled(j,YES)});test("changing value from empty -> value",function(){var j=h.view("empty");
SC.RunLoop.begin();j.set("value","John Doe");SC.RunLoop.end();h.verifyNotEmpty(j,"John Doe","Full Name")
});test("disabling view",function(){var j=h.view("empty");SC.RunLoop.begin();j.set("isEnabled",NO);
SC.RunLoop.end();h.verifyDisabled(j,YES)});test("changing value to null",function(){var j=h.view("with value");
SC.RunLoop.begin();j.set("value",null);SC.RunLoop.end();equals(j.get("fieldValue"),null,"should have empty fieldValue");
h.verifyEmpty(j,"Full Name")});test("enabling disabled view",function(){var j=h.view("disabled - empty");
SC.RunLoop.begin();j.set("isEnabled",YES);SC.RunLoop.end();h.verifyDisabled(j,NO)
});test("Setting the selection to a null value should fail",function(){var j=h.view("with value");
var k=j.$input()[0];k.size=10;var l=null;try{j.set("selection",null)}catch(m){l=m
}ok(l.indexOf!==undefined,"an exception should have been thrown");if(l.indexOf!==undefined){ok(l.indexOf("must specify an SC.TextSelection instance")!==-1,"the exception should be about not specifying an SC.TextSelection instance")
}});test("Setting the selection to a non-SC.TextSelection value should fail",function(){var j=h.view("with value");
var k=j.$input()[0];k.size=10;var l=null;try{j.set("selection",{start:0,end:0})}catch(m){l=m
}ok(l.indexOf!==undefined,"an exception should have been thrown");if(l.indexOf!==undefined){ok(l.indexOf("must specify an SC.TextSelection instance")!==-1,"the exception should be about not specifying an SC.TextSelection instance")
}});test("Setting and then getting back the selection",function(){var k=h.view("with value");
var m=k.$input()[0];m.focus();m.size=10;var j=SC.TextSelection.create({start:2,end:5});
k.set("selection",j);var l=k.get("selection");ok(l.get("start")===2,"the selection should start at index 2");
ok(l.get("end")===5,"the selection should end at index 4");ok(l.get("length")===3,"the selection should have length 3")
});test("Adding left accessory view",function(){var j=h.view("with value");SC.RunLoop.begin();
var l=SC.View.create({layout:{top:1,left:2,width:16,height:16}});j.set("leftAccessoryView",l);
SC.RunLoop.end();ok(j.get("leftAccessoryView")===l,"left accessory view should be set to "+l.toString());
ok(j.get("childViews").length===1,"there should only be one child view");ok(j.get("childViews")[0]===l,"first child view should be set to "+l.toString());
var k=j.$(".padding")[0];ok(k.style.left==="18px","padding element should get 18px left");
SC.RunLoop.begin();j.set("leftAccessoryView",null);SC.RunLoop.end();ok(j.get("childViews").length===0,"after removing the left accessory view there should be no child views left");
ok(!k.style.left,"after removing the left accessory view the padding element should have no left style")
});test("Adding right accessory view",function(){var j=h.view("with value");SC.RunLoop.begin();
var l=SC.View.create({layout:{top:1,right:3,width:17,height:16}});j.set("rightAccessoryView",l);
SC.RunLoop.end();ok(j.get("rightAccessoryView")===l,"right accessory view should be set to "+l.toString());
ok(j.get("childViews").length===1,"there should only be one child view");ok(j.get("childViews")[0]===l,"first child view should be set to "+l.toString());
var k=j.$(".padding")[0];ok(k.style.right==="20px","padding element should get 20px right");
SC.RunLoop.begin();l=SC.View.create({layout:{top:1,left:2,width:16,height:16}});j.set("rightAccessoryView",l);
SC.RunLoop.end();ok(j.get("rightAccessoryView").get("layout").left===null,"right accessory view created with 'left' rather than 'right' in layout should have layout.left set to null");
ok(j.get("rightAccessoryView").get("layout").right===0,"right accessory view created with 'left' rather than 'right' in layout should have layout.right set to 0");
SC.RunLoop.begin();j.set("rightAccessoryView",null);SC.RunLoop.end();ok(j.get("childViews").length===0,"after removing the right accessory view there should be no child views left");
ok(!k.style.right,"after removing the right accessory view the padding element should have no right style")
});test("Adding both left and right accessory views",function(){var k=h.view("with value");
SC.RunLoop.begin();var l=SC.View.create({layout:{top:1,left:2,width:16,height:16}});
k.set("leftAccessoryView",l);var j=SC.View.create({layout:{top:1,right:3,width:17,height:16}});
k.set("rightAccessoryView",j);SC.RunLoop.end();ok(k.get("childViews").length===2,"we should have two child views since we added both a left and a right accessory view");
var m=k.$(".padding")[0];ok(m.style.left==="18px","padding element should get 18px left");
ok(m.style.right==="20px","padding element should get 20px right");SC.RunLoop.begin();
k.set("rightAccessoryView",null);SC.RunLoop.end();ok(k.get("childViews").length===1,"after removing the right accessory view there should be one child view left (the left accessory view)");
ok(!m.style.right,"after removing the right accessory view the padding element should have no right style");
SC.RunLoop.begin();k.set("leftAccessoryView",null);SC.RunLoop.end();ok(k.get("childViews").length===0,"after removing both accessory views there should be no child views left");
ok(!m.style.left,"after removing the left accessory view the padding element should have no left style")
});test("focus and blurring text field",function(){var j=h.view("empty");var k=j.$("input");
SC.Event.trigger(k,"focus");ok(j.get("isEditing"),"view.isEditing should be YES");
ok(j.$().hasClass("focus"),"view layer should have focus class");SC.Event.trigger(k,"keydown");
SC.Event.trigger(k,"keyup");k.val("f");SC.Event.trigger(k,"change");stop();setTimeout(function(){start();
equals(j.get("value"),"f","view should have new value");ok(j.$().hasClass("not-empty"),"should have not-empty class");
SC.Event.trigger(k,"blur");ok(!j.get("isEditing"),"view.isEditing should be NO");
ok(!j.$().hasClass("focus"),"view layer should NOT have focus class")},100)});test("editing a field should not change the cursor position",function(){var j=h.view("empty");
var k=j.$("input");k.val("John Doe");j.set("selection",SC.TextSelection.create({start:2,end:3}));
SC.Event.trigger(k,"change");ok(k.val()==="John Doe","input value should be 'John Doe'");
var l=j.get("selection");console.log("Selection:  %@".fmt(l));ok(l.get("start")==2&&l.get("end")==3,"cursor position should be unchanged")
})})();htmlbody("<style> .sc-view { border: 1px blue solid; position: absolute;  overflow: hidden; }</style>");
var pane,a,aa;module("SC.View#clippingFrame",{setup:function(){SC.RunLoop.begin();
pane=SC.Pane.design().layout({top:0,left:0,width:200,height:200}).childView(SC.View.design().layout({top:50,left:50,width:100,height:100}).childView(SC.View.design().layout({top:20,left:20,width:40,height:40}))).create();
pane.append();a=pane.childViews[0];aa=a.childViews[0]},teardown:function(){pane.remove();
pane=a=aa=null;SC.RunLoop.end()}});test("clippingFrame === frame w/ 0 offset if not partially hidden",function(){var d=pane.get("clippingFrame"),e=pane.get("frame");
e.x=e.y=0;same(d,e,"pane");d=a.get("clippingFrame");e=a.get("frame");e.x=e.y=0;same(d,e,"child");
d=aa.get("clippingFrame");e=aa.get("frame");e.x=e.y=0;same(d,e,"nested child")});
test("cuts off top of frame",function(){var d,e;a.adjust("top",-50);d=a.get("clippingFrame");
e=a.get("frame");e.x=0;e.y=50;e.height=50;same(d,e,"child");d=aa.get("clippingFrame");
e=aa.get("frame");e.x=0;e.y=30;e.height=10;same(d,e,"nested child")});test("cuts off bottom of frame",function(){var d,e;
a.adjust("top",150);d=a.get("clippingFrame");e=a.get("frame");e.x=0;e.y=0;e.height=50;
same(d,e,"child");d=aa.get("clippingFrame");e=aa.get("frame");e.x=0;e.y=0;e.height=30;
same(d,e,"nested child")});test("cuts off left of frame",function(){var d,e;a.adjust("left",-50);
d=a.get("clippingFrame");e=a.get("frame");e.y=0;e.x=50;e.width=50;same(d,e,"child");
d=aa.get("clippingFrame");e=aa.get("frame");e.y=0;e.x=30;e.width=10;same(d,e,"nested child")
});test("cuts off bottom of frame",function(){var d,e;a.adjust("left",150);d=a.get("clippingFrame");
e=a.get("frame");e.y=0;e.x=0;e.width=50;same(d,e,"child");d=aa.get("clippingFrame");
e=aa.get("frame");e.y=0;e.x=0;e.width=30;same(d,e,"nested child")});test("notifies receiver and each child if parent clipping frame changes",function(){var e=0;
function d(){e++}a.addObserver("clippingFrame",d);aa.addObserver("clippingFrame",d);
a.adjust("top",-50);equals(e,4,"should invoke observer on child and nested child")
});test("does not notify child views of clippingFrame changes if child view hasStaticLayout",function(){var e=0;
function d(){e++}a.addObserver("clippingFrame",d);aa.addObserver("clippingFrame",d);
aa.hasStaticLayout=YES;a.adjust("top",-50);equals(e,2,"should invoke observer on child only")
});htmlbody("<style> .sc-view { border: 1px blue solid; position: absolute; }</style>");
var pane,a,b,aa,aaa,bb,f;var A_LEFT=10,A_TOP=10,B_LEFT=100,B_TOP=100;function setupFrameViews(){pane=SC.Pane.design().layout({top:0,left:0,width:400,height:300}).childView(SC.View.design().layout({top:A_TOP,left:A_LEFT,width:150,height:150}).childView(SC.View.design().layout({top:A_TOP,left:A_LEFT,width:50,height:50}).childView(SC.View.design().layout({top:A_TOP,left:A_LEFT,width:10,height:10})))).childView(SC.View.design().layout({top:B_TOP,left:B_LEFT,width:150,height:150}).childView(SC.View.design().layout({top:B_TOP,left:B_LEFT,width:10,height:10}))).create();
a=pane.childViews[0];b=pane.childViews[1];aa=a.childViews[0];aaa=aa.childViews[0];
bb=b.childViews[0];f={x:10,y:10,width:10,height:10};pane.append()}function teardownFrameViews(){pane.remove();
pane=a=aa=aaa=b=bb=null}module("SC.View#convertFrameToView",{setup:setupFrameViews,teardown:teardownFrameViews});
test("convert a -> top level",function(){var d=a.convertFrameToView(f,null);f.x+=A_LEFT;
f.y+=A_TOP;same(d,f,"should convert frame")});test("convert child -> top level",function(){var d=aa.convertFrameToView(f,null);
f.x+=A_LEFT*2;f.y+=A_TOP*2;same(d,f,"should convert frame")});test("convert nested child -> top level",function(){var d=aaa.convertFrameToView(f,null);
f.x+=A_LEFT*3;f.y+=A_TOP*3;same(d,f,"should convert frame")});test("convert a -> sibling",function(){var d=a.convertFrameToView(f,b);
f.x+=A_LEFT-B_LEFT;f.y+=A_TOP-B_TOP;same(d,f,"should convert frame")});test("convert child -> parent sibling",function(){var d=aa.convertFrameToView(f,b);
f.x+=A_LEFT*2-B_LEFT;f.y+=A_TOP*2-B_TOP;same(d,f,"should convert frame")});test("convert nested child -> parent sibling",function(){var d=aaa.convertFrameToView(f,b);
f.x+=A_LEFT*3-B_LEFT;f.y+=A_TOP*3-B_TOP;same(d,f,"should convert frame")});test("convert a -> child",function(){var d=a.convertFrameToView(f,aa);
f.x-=A_LEFT;f.y-=A_TOP;same(d,f,"should convert frame")});test("convert child -> parent",function(){var d=aa.convertFrameToView(f,a);
f.x+=A_LEFT;f.y+=A_TOP;same(d,f,"should convert frame")});test("convert nested child -> parent",function(){var d=aaa.convertFrameToView(f,a);
f.x+=A_LEFT*2;f.y+=A_TOP*2;same(d,f,"should convert frame")});test("convert a -> nested child",function(){var d=a.convertFrameToView(f,aaa);
f.x-=(A_LEFT+A_LEFT);f.y-=(A_TOP+A_TOP);same(d,f,"should convert frame")});test("convert nested child -> direct parent (child)",function(){var d=aaa.convertFrameToView(f,aa);
f.x+=A_LEFT;f.y+=(A_TOP);same(d,f,"should convert frame")});test("convert a -> child of sibling",function(){var d=a.convertFrameToView(f,bb);
f.x+=A_LEFT-(B_LEFT+B_LEFT);f.y+=A_TOP-(B_TOP+B_TOP);same(d,f,"should convert frame")
});test("convert child -> child of sibling",function(){var d=aa.convertFrameToView(f,bb);
f.x+=A_LEFT*2-(B_LEFT+B_LEFT);f.y+=A_TOP*2-(B_TOP+B_TOP);same(d,f,"should convert frame")
});test("convert nested child -> child of sibling",function(){var d=aaa.convertFrameToView(f,bb);
f.x+=A_LEFT*3-(B_LEFT+B_LEFT);f.y+=A_TOP*3-(B_TOP+B_TOP);same(d,f,"should convert frame")
});module("SC.View#convertFrameFromView",{setup:setupFrameViews,teardown:teardownFrameViews});
test("convert a <- top level",function(){var d=a.convertFrameFromView(f,null);f.x-=A_LEFT;
f.y-=A_TOP;same(d,f,"should convert frame")});test("convert child <- top level",function(){var d=aa.convertFrameFromView(f,null);
f.x-=A_LEFT*2;f.y-=A_TOP*2;same(d,f,"should convert frame")});test("convert nested child <- top level",function(){var d=aaa.convertFrameFromView(f,null);
f.x-=A_LEFT*3;f.y-=A_TOP*3;same(d,f,"should convert frame")});test("convert a <- sibling",function(){var d=a.convertFrameFromView(f,b);
f.x+=B_LEFT-A_LEFT;f.y+=B_TOP-A_TOP;same(d,f,"should convert frame")});test("convert child <- parent sibling",function(){var d=aa.convertFrameFromView(f,b);
f.x+=B_LEFT-A_LEFT*2;f.y+=B_TOP-A_TOP*2;same(d,f,"should convert frame")});test("convert nested child <- parent sibling",function(){var d=aaa.convertFrameFromView(f,b);
f.x+=B_LEFT-A_LEFT*3;f.y+=B_TOP-A_TOP*3;same(d,f,"should convert frame")});test("convert a <- child",function(){var d=a.convertFrameFromView(f,aa);
f.x+=A_LEFT;f.y+=A_TOP;same(d,f,"should convert frame")});test("convert child <- parent",function(){var d=aa.convertFrameFromView(f,a);
f.x-=A_LEFT;f.y-=A_TOP;same(d,f,"should convert frame")});test("convert nested child <- parent",function(){var d=aaa.convertFrameFromView(f,a);
f.x-=A_LEFT*2;f.y-=A_TOP*2;same(d,f,"should convert frame")});test("convert a <- nested child",function(){var d=a.convertFrameFromView(f,aaa);
f.x+=(A_LEFT+A_LEFT);f.y+=(A_TOP+A_TOP);same(d,f,"should convert frame")});test("convert nested child <- direct parent (child)",function(){var d=aaa.convertFrameFromView(f,aa);
f.x-=A_LEFT;f.y-=(A_TOP);same(d,f,"should convert frame")});test("convert a <- child of sibling",function(){var d=a.convertFrameFromView(f,bb);
f.x+=(B_LEFT+B_LEFT)-A_LEFT;f.y+=(B_TOP+B_TOP)-A_TOP;same(d,f,"should convert frame")
});test("convert child <- child of sibling",function(){var d=aa.convertFrameFromView(f,bb);
f.x+=(B_LEFT+B_LEFT)-A_LEFT*2;f.y+=(B_TOP+B_TOP)-A_TOP*2;same(d,f,"should convert frame")
});test("convert nested child <- child of sibling",function(){var d=aaa.convertFrameFromView(f,bb);
f.x+=(B_LEFT+B_LEFT)-A_LEFT*3;f.y+=(B_TOP+B_TOP)-A_TOP*3;same(d,f,"should convert frame")
});var parent,child;var commonSetup={setup:function(){parent=SC.View.create({layout:{top:0,left:0,width:500,height:500}});
child=SC.View.create()},teardown:function(){parent=child=null}};module("BASIC LAYOUT CONVERSION",commonSetup);
test("layout {top, left, width, height}",function(){var e={top:10,left:10,width:50,height:50};
var d=SC.View.convertLayoutToAnchoredLayout(e,parent.get("frame"));same(d,e,"conversion is equal")
});test("layout {top, left, bottom, right}",function(){var g={top:10,left:10,bottom:10,right:10};
var d=SC.View.convertLayoutToAnchoredLayout(g,parent.get("frame"));var e={top:10,left:10,width:480,height:480};
same(d,e,"conversion is equal")});test("layout {bottom, right, width, height}",function(){var g={bottom:10,right:10,width:50,height:50};
var d=SC.View.convertLayoutToAnchoredLayout(g,parent.get("frame"));var e={top:440,left:440,width:50,height:50};
same(d,e,"conversion is equal")});test("layout {centerX, centerY, width, height}",function(){var g={centerX:10,centerY:10,width:50,height:50};
var d=SC.View.convertLayoutToAnchoredLayout(g,parent.get("frame"));var e={top:235,left:235,width:50,height:50};
same(d,e,"conversion is equal")});module("INVALID LAYOUT VARIATIONS",commonSetup);
test("layout {top, left} - assume right/bottom=0",function(){var g={top:10,left:10};
var d=SC.View.convertLayoutToAnchoredLayout(g,parent.get("frame"));var e={top:10,left:10,width:490,height:490};
same(d,e,"conversion is equal")});test("layout {height, width} - assume top/left=0",function(){var g={height:60,width:60};
var d=SC.View.convertLayoutToAnchoredLayout(g,parent.get("frame"));var e={top:0,left:0,width:60,height:60};
same(d,e,"conversion is equal")});test("layout {right, bottom} - assume top/left=0",function(){var g={right:10,bottom:10};
var d=SC.View.convertLayoutToAnchoredLayout(g,parent.get("frame"));var e={top:0,left:0,width:490,height:490};
same(d,e,"conversion is equal")});test("layout {centerX, centerY} - assume width/height=0",function(){var g={centerX:10,centerY:10};
var d=SC.View.convertLayoutToAnchoredLayout(g,parent.get("frame"));var e={top:260,left:260,width:0,height:0};
same(d,e,"conversion is equal")});test("layout {top, left, centerX, centerY, height, width} - top/left take presidence",function(){var g={top:10,left:10,centerX:10,centerY:10,height:60,width:60};
var d=SC.View.convertLayoutToAnchoredLayout(g,parent.get("frame"));var e={top:10,left:10,width:60,height:60};
same(d,e,"conversion is equal")});test("layout {bottom, right, centerX, centerY, height, width} - bottom/right take presidence",function(){var g={bottom:10,right:10,centerX:10,centerY:10,height:60,width:60};
var d=SC.View.convertLayoutToAnchoredLayout(g,parent.get("frame"));var e={top:430,left:430,width:60,height:60};
same(d,e,"conversion is equal")});test("layout {top, left, bottom, right, centerX, centerY, height, width} - top/left take presidence",function(){var g={top:10,left:10,bottom:10,right:10,centerX:10,centerY:10,height:60,width:60};
var d=SC.View.convertLayoutToAnchoredLayout(g,parent.get("frame"));var e={top:10,left:10,width:60,height:60};
same(d,e,"conversion is equal")});test("layout {centerX, centerY, width:auto, height:auto}",function(){});
module("SC.View#createChildViews");test("calls createChildView() for each class or string in childViews array",function(){var j=[];
var h=SC.View.create({childViews:[SC.View.extend({key:0}),SC.View.create({key:1}),"customClassName"],customClassName:SC.View.extend({key:2}),createChildView:function(k){j.push(k.prototype.key);
ok(k.isClass,"childView: %@ isClass".fmt(k));return arguments.callee.base.apply(this,arguments)
}});same(j,[0,2],"called createChildView for correct children");var g=h.childViews,e=g.length,d;
for(d=0;d<e;d++){equals(g[d].key,d,"has correct index key");ok(g[d].isObject,"isObject - %@".fmt(g[d]))
}});test("should not error when there is a dud view name in childViews list.",function(){var e=[];
var d=SC.View.create({childViews:["nonExistantClassNme","customClassName"],customClassName:SC.View.extend({key:2}),createChildView:function(g){e.push(g.prototype.key);
ok(g.isClass,"childView: %@ isClass".fmt(g));return arguments.callee.base.apply(this,arguments)
}});same(e,[2],"called createChildView for correct children")});test("should not throw error when there is an extra space in the childViews list",function(){var e=[];
var d=SC.View.create({childViews:"customClassName  customKlassName".w(),customClassName:SC.View.extend({key:2}),customKlassName:SC.View.extend({key:3})});
ok(true,"called awake without issue.")});test("should not create layer for created child views",function(){var d=SC.View.create({childViews:[SC.View]});
ok(d.childViews[0].isObject,"precondition - did create child view");equals(d.childViews[0].get("layer"),null,"childView does not have layer")
});var view,myViewClass;module("SC.View#createChildView",{setup:function(){view=SC.View.create({page:SC.Object.create()});
myViewClass=SC.View.extend({isMyView:YES,foo:"bar"})}});test("should create view from class with any passed attributes",function(){var d=view.createChildView(myViewClass,{foo:"baz"});
ok(d.isMyView,"v is instance of myView");equals(d.foo,"baz","view did get custom attributes")
});test("should set newView.owner & parentView to receiver",function(){var d=view.createChildView(myViewClass);
equals(d.get("owner"),view,"v.owner == view");equals(d.get("parentView"),view,"v.parentView == view")
});test("should set newView.page to receiver.page unless custom attr is passed",function(){var d=view.createChildView(myViewClass);
equals(d.get("page"),view.get("page"),"v.page == view.page");var e=SC.Object.create();
d=view.createChildView(myViewClass,{page:e});equals(d.get("page"),e,"v.page == custom page")
});module("SC.View#createLayer");test("returns the receiver",function(){var d=SC.View.create();
equals(d.createLayer(),d,"returns receiver")});test("calls prepareContext() and sets layer to resulting element",function(){var d=SC.View.create({tagName:"span",prepareContext:function(g,h){g.push("foo")
}});equals(d.get("layer"),null,"precondition - has no layer");d.createLayer();var e=d.get("layer");
ok(!!e,"has element now");equals(e.innerHTML,"foo","has innerHTML from context");
equals(e.tagName.toString().toLowerCase(),"span","has tagName from view");e=null});
test("invokes didCreateLayer() on receiver and all child views",function(){var g=0,e=0;
var d=SC.View.create({didCreateLayer:function(){g++},didCreateLayerMixin:function(){e++
},childViews:[SC.View.extend({didCreateLayer:function(){g++},childViews:[SC.View.extend({didCreateLayer:function(){g++
},didCreateLayerMixin:function(){e++}}),SC.View.extend({})]})]});ok(d.didCreateLayer,"precondition - has root");
ok(d.childViews[0].didCreateLayer,"precondition - has firstChild");ok(d.childViews[0].childViews[0].didCreateLayer,"precondition - has nested child");
ok(!d.get("layer"),"has no layer");d.createLayer();equals(g,3,"did invoke all methods");
equals(e,2,"did invoke all mixin methods")});test("generated layer include HTML from child views as well",function(){var d=SC.View.create({childViews:[SC.View.extend({layerId:"foo"})]});
d.createLayer();ok(Q$("#foo",d.get("layer")).get(0),"has element with child layerId")
});test("does NOT assign layer to child views immediately",function(){var d=SC.View.create({childViews:[SC.View.extend({layerId:"foo"})]});
d.createLayer();ok(!d.childViews[0]._view_layer,"has no layer yet")});module("SC.View#destroyLayer");
test("it if has no layer, does nothing",function(){var e=0;var d=SC.View.create({willDestroyLayer:function(){e++
}});ok(!d.get("layer"),"precond - does NOT have layer");d.destroyLayer();equals(e,0,"did not invoke callback")
});test("if it has a layer, calls willDestroyLayer on receiver and child views then deletes the layer",function(){var e=0;
var d=SC.View.create({willDestroyLayer:function(){e++},childViews:[SC.View.extend({childViews:[SC.View.extend({willDestroyLayer:function(){e++
}})]})]});d.createLayer();ok(d.get("layer"),"precond - view has layer");d.destroyLayer();
equals(e,2,"invoked destroy layer");ok(!d.get("layer"),"view no longer has layer")
});test("if it has a layer, calls willDestroyLayerMixin on receiver and child views if defined (comes from mixins)",function(){var h=0;
var g={willDestroyLayerMixin:function(){h++}};var e={willDestroyLayerMixin:function(){h++
}};var d=SC.View.create(g,e,{childViews:[SC.View.extend(g,e,{childViews:[SC.View.extend(g)]})]});
d.createLayer();d.destroyLayer();equals(h,5,"invoked willDestroyLayerMixin on all mixins")
});test("returns receiver",function(){var d=SC.View.create().createLayer();equals(d.destroyLayer(),d,"returns receiver")
});test("removes layer from parentNode if in DOM",function(){var d=SC.View.create();
var e=d.createLayer().get("layer");ok(e,"precond - has layer");document.body.appendChild(e);
d.destroyLayer();if(e.parentNode){equals(e.parentNode.nodeType,11,"layer no longer in parent node")
}else{equals(e.parentNode,null,"layer no longer in parent node")}e=null});var pane,view;
module("SC.View#didAppendToDocument");test("Check that didAppendToDocument gets called at the right moment",function(){var d=0;
pane=SC.MainPane.create({childViews:[SC.View.extend({render:function(g,h){g.push("new string")
},didAppendToDocument:function(){d++}})]});equals(d,0,"");pane.append();equals(d,1,"");
view=pane.childViews[0];view.displayDidChange();SC.RunLoop.begin().end();equals(d,2,"");
var e=SC.View.extend({didAppendToDocument:function(){d++}});e=e.create();pane.appendChild(e);
SC.RunLoop.begin().end();equals(d,3,"");pane.remove()});var view,parentDom,childDom,layerId;
module("SC.View#findLayerInParentLayer",{setup:function(){layerId="foo-123";childDom=document.createElement("div");
SC.$(childDom).attr("id",layerId);var d=document.createElement("div");d.appendChild(childDom);
parentDom=document.createElement("div");parentDom.appendChild(d);d=null;view=SC.View.create({layerId:layerId})
},teardown:function(){view=parentDom=childDom=layerId=null}});test("discovers layer by finding element with matching layerId - when DOM is in document already",function(){document.body.appendChild(parentDom);
equals(view.findLayerInParentLayer(parentDom),childDom,"should find childDom");document.body.removeChild(parentDom)
});test("discovers layer by finding element with matching layerId - when parent DOM is NOT in document",function(){if(parentDom.parentNode){equals(parentDom.parentNode.nodeType,11,"precond - NOT in parent doc")
}else{equals(parentDom.parentNode,null,"precond - NOT in parent doc")}equals(view.findLayerInParentLayer(parentDom),childDom,"found childDom")
});module("SC.View#init");test("registers view in the global views hash using layerId for event targeted",function(){var d=SC.View.create();
equals(SC.View.views[d.get("layerId")],d,"registers view")});test("adds displayDidChange observer on all display properties",function(){var e=NO;
var d=SC.View.create({displayDidChange:function(){e=YES},displayProperties:"foo bar".w(),foo:"foo",bar:"bar"});
d.set("foo","baz");ok(e,"didChange on set(foo)");e=NO;d.set("bar","baz");ok(e,"didChange on set(bar)")
});test("invokes createChildViews()",function(){var d=NO;var e=SC.View.create({createChildViews:function(){d=YES
}});ok(d,"did invoke createChildViews()")});test("does NOT create layer",function(){var d=SC.View.create();
equals(d.get("layer"),null,"did not create layer")});var parent,child;module("SC.View#insertBefore",{setup:function(){child=SC.View.create();
parent=SC.View.create({childViews:[SC.View]})}});test("returns receiver",function(){equals(parent.insertBefore(child,null),parent,"receiver")
});test("makes set child.parentView = to new parent view",function(){ok(child.get("parentView")!==parent,"precond - parent is not child.parentView yet");
var d=0;child.addObserver("parentView",function(){d++});parent.insertBefore(child,null);
equals(child.get("parentView"),parent,"parent is child.parentView");equals(d,1,"observer did fire")
});test("insertBefore(child, null) appends child to end of parent.childView's array",function(){parent.insertBefore(child,null);
equals(parent.childViews[parent.childViews.length-1],child,"child is last childView")
});test("insertBefore(child, otherChild) inserts child before other child view",function(){var d=parent.childViews[0];
ok(d,"precond - otherChild is not null");parent.insertBefore(child,d);equals(parent.childViews[0],child,"child inserted before other child")
});test("if child belongs to another parent view, child will be removed from other parent when added to new parent",function(){var d=SC.View.create({childViews:[SC.View]});
child=d.childViews[0];ok(child,"precond - got child");ok(child.get("parentView"),"precond - child has a parent view");
parent.insertBefore(child,null);ok(d.childViews.indexOf(child)<0,"oldParent no longer has childView");
equals(child.get("parentView"),parent,"child has new parent view")});test("invokes willAddChild() on receiver if defined before adding child",function(){var e=0;
var d=parent.childViews[0];parent.willAddChild=function(g,h){equals(g,child,"passed newChild");
equals(h,d,"passed beforeView");ok(parent.childViews.indexOf(child)<0,"should not have child yet");
ok(child.get("parentView")!==parent,"childView not changed yet either");e++};parent.insertBefore(child,d);
ok(e,1,"invoked")});test("invokes willAddToParent() on child view if defined before adding child",function(){var e=0;
var d=parent.childViews[0];child.willAddToParent=function(g,h){equals(g,parent,"passed parent");
equals(h,d,"passed beforeView");ok(parent.childViews.indexOf(child)<0,"should not have child yet");
ok(child.get("parentView")!==parent,"childView not changed yet either");e++};parent.insertBefore(child,d);
ok(e,1,"invoked")});test("invokes didAddChild() on receiver if defined after adding child",function(){var e=0;
var d=parent.childViews[0];parent.didAddChild=function(g,h){equals(g,child,"passed newChild");
equals(h,d,"passed beforeView");ok(parent.childViews.indexOf(child)>=0,"should have child");
ok(child.get("parentView")===parent,"childView should have new parentView");e++};
parent.insertBefore(child,d);ok(e,1,"invoked")});test("invokes didAddToParent() on child view if defined after adding child",function(){var e=0;
var d=parent.childViews[0];child.didAddToParent=function(g,h){equals(g,parent,"passed parent");
equals(h,d,"passed beforeView");ok(parent.childViews.indexOf(child)>=0,"should have child");
ok(child.get("parentView")===parent,"childView should have new parentView");e++};
parent.insertBefore(child,d);ok(e,1,"invoked")});test("invokes parentViewDidChange() on child view.  this is used by the view internals to update layer loc",function(){var d=0;
child.parentViewDidChange=function(){d++};parent.insertBefore(child,null);equals(d,1,"invoked parentViewDidChange")
});test("should not move layer immediately",function(){parent.createLayer();child.createLayer();
ok(parent.get("layer"),"precond - parent has layer");ok(child.get("layer"),"precond - child has layer");
parent.insertBefore(child,null);ok(child.get("layer").parentNode!==parent.get("layer"),"did not move layer")
});module("SC.View#appendChild",{setup:function(){parent=SC.View.create({childViews:[SC.View,SC.View]});
child=SC.View.create()}});test("returns receiver",function(){equals(parent.appendChild(child,null),parent,"receiver")
});test("should add child to end of childViews",function(){parent.appendChild(child);
equals(parent.childViews[parent.childViews.length-1],child,"child is last child view")
});var FRAME={x:10,y:10,width:30,height:30};var pane,view;module("isVisibleInWindow",{setup:function(){pane=SC.MainPane.create();
view=SC.View.create()},teardown:function(){view=null;pane.remove();pane=null}});test("a new view should not be visible initially",function(){ok(view.get("isVisible"),"view.get('isVisible') === NO")
});test("adding a new view to a visible pane should make it visible",function(){ok(view.get("isVisible"),"view.get('isVisible') === YES");
ok(pane.get("isVisible"),"pane.get('isVisible') === YES");SC.RunLoop.begin();pane.appendChild(view);
pane.append();view.set("isVisible",NO);SC.RunLoop.end();ok(!view.get("isVisible"),"after pane.appendChild(view), view.get('isVisible') === YES");
ok(view.$().hasClass("hidden"),"after view.set('isVisible', NO), view.$().hasClass('hidden') should be true")
});var FRAME={x:10,y:10,width:30,height:30};var pane,view;module("isVisibleInWindow",{setup:function(){pane=SC.MainPane.create();
pane.append();view=SC.View.create()},teardown:function(){view=null;pane.remove().destroy();
pane=null}});test("a new view should not be visible initially",function(){ok(!view.get("isVisibleInWindow"),"view.get('isVisibleInWindow') === NO")
});test("adding a new view to a visible pane should make it visible",function(){ok(!view.get("isVisibleInWindow"),"view.get('isVisibleInWindow') === NO");
ok(pane.get("isVisibleInWindow"),"pane.get('isVisibleInWindow') === YES");pane.appendChild(view);
ok(view.get("isVisibleInWindow"),"after pane.appendChild(view), view.get('isVisibleInWindow') === YES")
});test("removing a view from a visible pane should make it invisible again",function(){ok(!view.get("isVisibleInWindow"),"view.get('isVisibleInWindow') === NO");
ok(pane.get("isVisibleInWindow"),"pane.get('isVisibleInWindow') === YES");pane.appendChild(view);
ok(view.get("isVisibleInWindow"),"after pane.appendChild(view), view.get('isVisibleInWindow') === YES");
view.removeFromParent();ok(!view.get("isVisibleInWindow"),"after view.removeFromParent(), view.get('isVisibleInWindow') === NO")
});test("updateLayer should not be invoked even if layer becomes dirty until isVisibleInWindow changes, then it should invoke",function(){var d=0;
view.createLayer=function(){SC.View.prototype.createLayer.apply(this,arguments);d++
};ok(!view.get("isVisibleInWindow"),"precond - view should not be visible to start");
SC.RunLoop.begin();view.displayDidChange();SC.RunLoop.end();equals(d,0,"createLayer should not run b/c its not visible");
SC.RunLoop.begin();pane.appendChild(view);ok(view.get("isVisibleInWindow"),"view should now be visible in window");
SC.RunLoop.end();equals(d,1,"createLayer should exec now b/c isVisibleInWindow is YES")
});test("layoutChildViewsIfNeeded should not be invoked even if layer needs layout until isVisibleInWindow changes, then it should invoke",function(){var e=SC.View.create();
view.appendChild(e);var d=0;view.layoutChildViews=function(){d++};ok(!view.get("isVisibleInWindow"),"precond - view should not be visible to start");
SC.RunLoop.begin();view.layoutDidChangeFor(e);SC.RunLoop.end();equals(d,0,"layoutChildViews should not run b/c its not visible");
SC.RunLoop.begin();pane.appendChild(view);ok(view.get("isVisibleInWindow"),"view should now be visible in window");
SC.RunLoop.end();equals(d,1,"layoutChildViews should exec now b/c isVisibleInWindow is YES")
});test("setting isVisible to NO should trigger a layer update to hide the view",function(){SC.RunLoop.begin();
pane.appendChild(view);SC.RunLoop.end();SC.RunLoop.begin();view.set("isVisible",NO);
SC.RunLoop.end();ok(view.renderContext(view.get("layer")).classNames().indexOf("hidden")>=0,"layer should have the 'hidden' class")
});module("SC.View#layer");test("returns null if the view has no layer and no parent view",function(){var d=SC.View.create();
equals(d.get("parentView"),null,"precond - has no parentView");equals(d.get("layer"),null,"has no layer")
});test("returns null if the view has no layer and parent view has no layer",function(){var e=SC.View.create({childViews:[SC.View.extend()]});
var d=e.childViews[0];equals(d.get("parentView"),e,"precond - has parent view");equals(e.get("layer"),null,"parentView has no layer");
equals(d.get("layer"),null," has no layer")});test("returns layer if you set the value",function(){var d=SC.View.create();
equals(d.get("layer"),null,"precond- has no layer");var e=document.createElement("div");
d.set("layer",e);equals(d.get("layer"),e,"now has set layer");e=null});var parent,child,parentDom,childDom;
module("SC.View#layer - autodiscovery",{setup:function(){parent=SC.View.create({childViews:[SC.View.extend({findLayerInParentLayer:function(d){return d.firstChild
}})]});child=parent.childViews[0];parentDom=document.createElement("div");childDom=document.createElement("div");
parentDom.appendChild(childDom);parent.set("layer",parentDom)},teardown:function(){parent=child=parentDom=childDom=null
}});test("discovers layer if has no layer but parent view does have layer",function(){equals(parent.get("layer"),parentDom,"precond - parent has layer");
ok(!!parentDom.firstChild,"precond - parentDom has first child");equals(child.get("layer"),childDom,"view discovered child")
});test("once its discovers layer, returns the same element, even if you remove it from the parent view",function(){equals(child.get("layer"),childDom,"precond - view discovered child");
parentDom.removeChild(childDom);equals(child.get("layer"),childDom,"view kept layer cached (i.e. did not do a discovery again)")
});module("SC.View#layer - destroying");test("returns null again if it has layer and layer is destroyed",function(){});
test("returns null again if parent view's layer is destroyed",function(){});var pane,view;
module("SC.View#$",{setup:function(){pane=SC.Pane.design().childView(SC.View.design({render:function(d,e){d.push("<span></span>")
}})).create();view=pane.childViews[0];SC.RunLoop.begin();pane.append();SC.RunLoop.end()
},teardown:function(){SC.RunLoop.begin();pane.remove();SC.RunLoop.end()}});test("returns an empty CQ object if no layer",function(){var d=SC.View.create();
ok(!d.get("layer"),"precond - should have no layer");equals(d.$().size(),0,"should return empty CQ object");
equals(d.$("span").size(),0,"should return empty CQ object even if filter passed")
});test("returns CQ object selecting layer if provided",function(){ok(view.get("layer"),"precond - should have layer");
var d=view.$();equals(d.size(),1,"view.$() should have one element");equals(d.get(0),view.get("layer"),"element should be layer")
});test("returns CQ object selecting element inside layer if provided",function(){ok(view.get("layer"),"precond - should have layer");
var d=view.$("span");equals(d.size(),1,"view.$() should have one element");equals(d.get(0).parentNode,view.get("layer"),"element should be in layer")
});test("returns empty CQ object if filter passed that does not match item in parent",function(){ok(view.get("layer"),"precond - should have layer");
var d=view.$("body");equals(d.size(),0,"view.$(body) should have no elements")});
module("SC.View#layoutChildViews");test("calls renderLayout() on child views on views that need layout if they have a layer",function(){var e=0;
var j=SC.View.extend({updateLayout:function(k){e++}});var d=SC.View.create({childViews:[j,j,j]});
var h=d.childViews[0];var g=d.childViews[1];d.layoutDidChangeFor(h);d.layoutDidChangeFor(g);
d.layoutChildViews();equals(e,2,"updateLayout should be called on two dirty child views")
});module("SC.View#updateLayout");test("if view has layout, calls renderLayout with context to update element",function(){var g=0,e=NO;
var d=SC.View.create({renderLayout:function(h){if(!e){return}equals(h._elem,this.get("layer"),"should pass context that will edit layer");
g++}});d.createLayer();ok(d.get("layer"),"precond - should have a layer");e=YES;d.updateLayout();
equals(g,1,"should call renderLayout()")});test("if view has NO layout, should not call renderLayout",function(){var g=0,e=NO;
var d=SC.View.create({renderLayout:function(h){if(!e){return}g++}});ok(!d.get("layer"),"precond - should NOT have a layer");
e=YES;d.updateLayout();equals(g,0,"should NOT call renderLayout()")});test("returns receiver",function(){var d=SC.View.create();
equals(d.updateLayout(),d,"should return receiver")});module("SC.View#renderLayout");
test("adds layoutStyle property to passed context",function(){var d=SC.View.create({layoutStyle:{width:50,height:50}});
var e=d.renderContext();ok(e.styles().width!==50,"precond - should NOT have width style");
ok(e.styles().height!==50,"precond - should NOT have height style");d.renderLayout(e);
equals(e.styles().width,50,"should have width style");equals(e.styles().height,50,"should have height style")
});var view,callCount;module("SC.View#layoutChildViewsIfNeeded",{setup:function(){callCount=0;
view=SC.View.create({layoutChildViews:function(){callCount++}})},teardown:function(){view=null
}});test("calls layoutChildViews() if childViewsNeedLayout and isVisibleInWindow & sets childViewsNeedLayout to NO",function(){view.childViewsNeedLayout=YES;
view.isVisibleInWindow=YES;view.layoutChildViewsIfNeeded();equals(callCount,1,"should call layoutChildViews()");
equals(view.get("childViewsNeedLayout"),NO,"should set childViewsNeedLayout to NO")
});test("does not call layoutChildViews() if childViewsNeedLayout is NO",function(){view.childViewsNeedLayout=NO;
view.isVisibleInWindow=YES;view.layoutChildViewsIfNeeded();equals(callCount,0,"should NOT call layoutChildViews()")
});test("does not call layoutChildViews() if isVisibleInWindow is NO unless passed isVisible YES",function(){view.childViewsNeedLayout=YES;
view.isVisibleInWindow=NO;view.layoutChildViewsIfNeeded();equals(callCount,0,"should NOT call layoutChildViews()");
equals(view.get("childViewsNeedLayout"),YES,"should leave childViewsNeedLayout set to YES");
view.layoutChildViewsIfNeeded(YES);equals(callCount,1,"should call layoutChildViews()");
equals(view.get("childViewsNeedLayout"),NO,"should set childViewsNeedLayout to NO")
});test("returns receiver",function(){equals(view.layoutChildViewsIfNeeded(),view,"should return receiver")
});module("SC.View#layoutDidChange");test("notifies layoutStyle & frame change",function(){var d=SC.View.create();
var e=0;d.addObserver("layoutStyle",function(){e++});d.addObserver("frame",function(){e++
});d.layoutDidChange();equals(e,2,"should trigger observers for layoutStyle + frame")
});test("invokes layoutDidChangeFor() on layoutView each time it is called",function(){var g=0;
var e=SC.View.create({layoutDidChangeFor:function(h){equals(this.get("childViewsNeedLayout"),YES,"should set childViewsNeedLayout to YES before calling layoutDidChangeFor()");
equals(d,h,"should pass view");g++}});var d=SC.View.create({layoutView:e});d.layoutDidChange();
d.layoutDidChange();d.layoutDidChange();equals(g,3,"should call layoutView.layoutDidChangeFor each time")
});test("invokes layoutChildViewsIfNeeded() on layoutView once per runloop",function(){var g=0;
var e=SC.View.create({layoutChildViewsIfNeeded:function(){g++}});var d=SC.View.create({layoutView:e});
SC.RunLoop.begin();d.layoutDidChange();d.layoutDidChange();d.layoutDidChange();SC.RunLoop.end();
equals(g,1,"should call layoutView.layoutChildViewsIfNeeded one time")});test("should not invoke layoutChildViewsIfNeeded() if layoutDidChangeFor() sets childViewsNeedLayout to NO each time",function(){var g=0;
var e=SC.View.create({layoutDidChangeFor:function(){this.set("childViewsNeedLayout",NO)
},layoutChildViewsIfNeeded:function(){g++}});var d=SC.View.create({layoutView:e});
SC.RunLoop.begin();d.layoutDidChange();d.layoutDidChange();d.layoutDidChange();SC.RunLoop.end();
equals(g,0,"should not call layoutView.layoutChildViewsIfNeeded")});test("returns receiver",function(){var d=SC.View.create();
equals(d.layoutDidChange(),d,"should return receiver")});test("is invoked whenever layout property changes",function(){var g=0;
var e=SC.View.create({layoutDidChangeFor:function(h){g++}});var d=SC.View.create({layoutView:e});
d.set("layout",{top:0,left:10});equals(g,1,"should call layoutDidChangeFor when setting layout of child view")
});test("is invoked on parentView if no layoutView whenever layout property changes",function(){var g=0;
var e=SC.View.create({layoutDidChangeFor:function(h){g++}});var d=SC.View.create({});
d.set("parentView",e);d.set("layout",{top:0,left:10});equals(g,1,"should call layoutDidChangeFor when setting layout of child view")
});var parent,child;function performLayoutTest(j,h,e,d,k){var g="width height top bottom marginLeft marginTop left right zIndex minWidth maxWidth minHeight maxHeight".w();
g.forEach(function(l){if(e[l]===undefined){e[l]=null}if(k[l]===undefined){k[l]=null
}if(typeof e[l]==="number"){e[l]=e[l].toString()+"px"}if(typeof k[l]==="number"){k[l]=e[l].toString()+"px"
}});child.set("layout",j);console.log(child.get("layoutStyle"));g.forEach(function(l){equals(child.get("layoutStyle")[l],e[l],"STYLE NO PARENT %@".fmt(l))
});SC.RunLoop.begin();parent.appendChild(child);SC.RunLoop.end();g.forEach(function(l){equals(child.get("layoutStyle")[l],k[l],"STYLE W/ PARENT %@".fmt(l))
})}var commonSetup={setup:function(){parent=SC.View.create({layout:{top:0,left:0,width:200,height:200}});
child=SC.View.create()},teardown:function(){parent=child=null}};module("NOTIFICATIONS",commonSetup);
test("Setting layout will notify frame observers",function(){var d=NO,e=NO;child.addObserver("frame",this,function(){d=YES
});child.addObserver("layoutStyle",this,function(){e=YES});child.set("layout",{left:0,top:10,bottom:20,right:50});
ok(d,"didNotify");ok(e,"didNotifyStyle")});module("BASIC LAYOUT VARIATIONS",commonSetup);
test("layout {top, left, width, height}",function(){var h={top:10,left:10,width:50,height:50};
var e={top:10,left:10,width:50,height:50};var g={x:10,y:10,width:50,height:50};var d={x:10,y:10,width:50,height:50};
performLayoutTest(h,g,e,d,e)});test("layout {top, left, bottom, right}",function(){var h={top:10,left:10,bottom:10,right:10};
var g={x:10,y:10,width:0,height:0};var d={x:10,y:10,width:180,height:180};var e={top:10,left:10,bottom:10,right:10};
performLayoutTest(h,g,e,d,e)});test("layout {bottom, right, width, height}",function(){var h={bottom:10,right:10,width:50,height:50};
var g={x:0,y:0,width:50,height:50};var d={x:140,y:140,width:50,height:50};var e={bottom:10,right:10,width:50,height:50};
performLayoutTest(h,g,e,d,e)});test("layout {centerX, centerY, width, height}",function(){var h={centerX:10,centerY:10,width:60,height:60};
var g={x:10,y:10,width:60,height:60};var d={x:80,y:80,width:60,height:60};var e={marginLeft:-20,marginTop:-20,width:60,height:60,top:"50%",left:"50%"};
performLayoutTest(h,g,e,d,e)});test("layout {top, left, width: auto, height: auto}",function(){child=SC.View.create({useStaticLayout:YES,render:function(k){k.push('<div style="padding: 10px"></div>')
}});parent.createLayer();var e=parent.get("layer");document.body.appendChild(e);var j={top:0,left:0,width:"auto",height:"auto"};
var h={x:0,y:0,width:0,height:0};var d={x:0,y:0,width:20,height:20};var g={top:0,left:0,width:"auto",height:"auto"};
performLayoutTest(j,h,g,d,g);e.parentNode.removeChild(e)});module("BASIC LAYOUT VARIATIONS PERCENTAGE",commonSetup);
test("layout {top, left, width, height}",function(){var h={top:0.1,left:0.1,width:0.5,height:0.5};
var e={top:"10%",left:"10%",width:"50%",height:"50%"};var g={top:"10%",left:"10%",width:"50%",height:"50%"};
var d={top:"10%",left:"10%",width:"50%",height:"50%"};performLayoutTest(h,g,e,d,e)
});test("layout {top, left, bottom, right}",function(){var h={top:0.1,left:0.1,bottom:0.1,right:0.1};
var g={top:"10%",left:"10%",bottom:"10%",right:"10%"};var d={top:"10%",left:"10%",bottom:"10%",right:"10%"};
var e={top:"10%",left:"10%",bottom:"10%",right:"10%"};performLayoutTest(h,g,e,d,e)
});test("layout {bottom, right, width, height}",function(){var h={bottom:0.1,right:0.1,width:0.5,height:0.5};
var g={bottom:"10%",right:"10%",width:"50%",height:"50%"};var d={bottom:"10%",right:"10%",width:"50%",height:"50%"};
var e={bottom:"10%",right:"10%",width:"50%",height:"50%"};performLayoutTest(h,g,e,d,e)
});test("layout {centerX, centerY, width, height}",function(){var h={centerX:0.1,centerY:0.1,width:0.6,height:0.6};
var g={x:10,y:10,width:60,height:60};var d={x:80,y:80,width:60,height:60};var e={marginLeft:"-20%",marginTop:"-20%",width:"60%",height:"60%",top:"50%",left:"50%"};
performLayoutTest(h,g,e,d,e)});test("layout {top, left, width: auto, height: auto}",function(){child=SC.View.create({useStaticLayout:YES,render:function(k){k.push('<div style="padding: 10px"></div>')
}});parent.createLayer();var e=parent.get("layer");document.body.appendChild(e);var j={top:0.1,left:0.1,width:"auto",height:"auto"};
var h={x:0,y:0,width:0,height:0};var d={x:0,y:0,width:20,height:20};var g={top:"10%",left:"10%",width:"auto",height:"auto"};
performLayoutTest(j,h,g,d,g);e.parentNode.removeChild(e)});module("INVALID LAYOUT VARIATIONS",commonSetup);
test("layout {top, left} - assume right/bottom=0",function(){var h={top:0.1,left:0.1};
var g={x:10,y:10,width:0,height:0};var d={x:10,y:10,width:190,height:190};var e={bottom:0,right:0,top:"10%",left:"10%"};
performLayoutTest(h,g,e,d,e)});test("layout {height, width} - assume top/left=0",function(){var h={height:0.6,width:0.6};
var g={x:0,y:0,width:60,height:60};var d={x:0,y:0,width:60,height:60};var e={width:"60%",height:"60%",top:0,left:0};
performLayoutTest(h,g,e,d,e)});test("layout {right, bottom} - assume top/left=0",function(){var h={right:0.1,bottom:0.1};
var g={x:0,y:0,width:0,height:0};var d={x:0,y:0,width:190,height:190};var e={bottom:"10%",right:"10%",top:0,left:0};
performLayoutTest(h,g,e,d,e)});test("layout {right, bottom, maxWidth, maxHeight} - assume top/left=null",function(){var h={right:0.1,bottom:0.1,maxWidth:10,maxHeight:10};
var g={x:0,y:0,width:0,height:0};var d={x:0,y:0,width:190,height:190};var e={bottom:"10%",right:"10%",top:null,left:null,maxWidth:10,maxHeight:10};
performLayoutTest(h,g,e,d,e)});test("layout {centerX, centerY} - assume width/height=0",function(){var h={centerX:0.1,centerY:0.1};
var g={x:10,y:10,width:0,height:0};var d={x:110,y:110,width:0,height:0};var e={width:0,height:0,top:"50%",left:"50%",marginTop:"50%",marginLeft:"50%"};
performLayoutTest(h,g,e,d,e)});test("layout {top, left, centerX, centerY, height, width} - top/left take presidence",function(){var h={top:0.1,left:0.1,centerX:0.1,centerY:0.1,height:0.6,width:0.6};
var g={x:10,y:10,width:60,height:60};var d={x:10,y:10,width:60,height:60};var e={width:"60%",height:"60%",top:"10%",left:"10%"};
performLayoutTest(h,g,e,d,e)});test("layout {bottom, right, centerX, centerY, height, width} - bottom/right take presidence",function(){var h={bottom:0.1,right:0.1,centerX:0.1,centerY:0.1,height:0.6,width:0.6};
var g={x:0,y:0,width:60,height:60};var d={x:130,y:130,width:60,height:60};var e={width:"60%",height:"60%",bottom:"10%",right:"10%"};
performLayoutTest(h,g,e,d,e)});test("layout {top, left, bottom, right, centerX, centerY, height, width} - top/left take presidence",function(){var h={top:0.1,left:0.1,bottom:0.1,right:0.1,centerX:0.1,centerY:0.1,height:0.6,width:0.6};
var g={x:10,y:10,width:60,height:60};var d={x:10,y:10,width:60,height:60};var e={width:"60%",height:"60%",top:"10%",left:"10%"};
performLayoutTest(h,g,e,d,e)});test("layout {centerX, centerY, width:auto, height:auto}",function(){var d=null;
var g={centerX:0.1,centerY:0.1,width:"auto",height:"auto"};child.set("layout",g);
try{child.layoutStyle()}catch(h){d=h}equals(SC.T_ERROR,SC.typeOf(d),"Layout style functions should throw and error if centerx/y and width/height are set at the same time "+d)
});module("RESIZE FRAME",commonSetup);function verifyFrameResize(d,e,g){parent.appendChild(child);
child.set("layout",d);same(child.get("frame"),e,"Before: %@ == %@".fmt(SC.inspect(child.get("frame")),SC.inspect(e)));
parent.adjust("width",300).adjust("height",300);same(child.get("frame"),g,"After: %@ == %@".fmt(SC.inspect(child.get("frame")),SC.inspect(g)))
}test("frame does not change with top/left/w/h",function(){var d={top:10,left:10,width:60,height:60};
var e={x:10,y:10,width:60,height:60};var g={x:10,y:10,width:60,height:60};verifyFrameResize(d,e,g)
});test("frame shifts down with bottom/right/w/h",function(){var d={bottom:10,right:10,width:60,height:60};
var e={x:130,y:130,width:60,height:60};var g={x:230,y:230,width:60,height:60};verifyFrameResize(d,e,g)
});test("frame size shifts with top/left/bottom/right",function(){var d={top:10,left:10,bottom:10,right:10};
var e={x:10,y:10,width:180,height:180};var g={x:10,y:10,width:280,height:280};verifyFrameResize(d,e,g)
});test("frame loc shifts with centerX/centerY",function(){var d={centerX:10,centerY:10,width:60,height:60};
var e={x:80,y:80,width:60,height:60};var g={x:130,y:130,width:60,height:60};verifyFrameResize(d,e,g)
});test("frame does not change with top/left/w/h",function(){var d={top:0.1,left:0.1,width:0.6,height:0.6};
var e={x:20,width:120,y:20,height:120};var g={x:30,y:30,width:180,height:180};verifyFrameResize(d,e,g)
});test("frame shifts down with bottom/right/w/h",function(){var d={bottom:0.1,right:0.1,width:0.6,height:0.6};
var e={x:60,y:60,width:120,height:120};var g={x:90,y:90,width:180,height:180};verifyFrameResize(d,e,g)
});test("frame size shifts with top/left/bottom/right",function(){var d={top:0.1,left:0.1,bottom:0.1,right:0.1};
var e={x:20,y:20,width:160,height:160};var g={x:30,y:30,width:240,height:240};verifyFrameResize(d,e,g)
});test("frame loc shifts with centerX/centerY",function(){var d={centerX:0,centerY:0,width:0.6,height:0.6};
var e={x:40,y:40,width:120,height:120};var g={x:60,y:60,width:180,height:180};verifyFrameResize(d,e,g)
});var pane,textfield_view1,textfield_view2,textfield_view3,view1,view2,view3,view4,view5;
module("SC.View#nextValidKeyView",{setup:function(){SC.RunLoop.begin();pane=SC.Pane.design().layout({top:0,left:0,bottom:0,right:0}).childView(SC.TextFieldView.design()).childView(SC.View.design()).childView(SC.View.design().childView(SC.View.design().childView(SC.View.design().childView(SC.View.design().childView(SC.TextFieldView.design()))))).childView(SC.View.design()).childView(SC.View.design()).childView(SC.View.design()).childView(SC.View.design().childView(SC.TextFieldView.design())).childView(SC.View.design()).create();
pane.append();SC.RunLoop.end();textfield_view1=pane.childViews[0];textfield_view2=pane.childViews[2].childViews[0].childViews[0].childViews[0].childViews[0];
textfield_view3=pane.childViews[6].childViews[0];view1=pane.childViews[1];view2=pane.childViews[3];
view3=pane.childViews[4];view4=pane.childViews[5];view5=pane.childViews[7]},teardown:function(){SC.RunLoop.begin();
pane.remove();pane=textfield_view1=textfield_view2=textfield_view3=view1=view2=view3=null;
SC.RunLoop.end()}});test("Navigate between textfields- going forward",function(){SC.SAFARI_FOCUS_BEHAVIOR=YES;
var d=view2.nextValidKeyView();same(d,textfield_view3,"The next view should be "+textfield_view3.toString());
d=textfield_view3.nextValidKeyView();same(d,null,"The next view should be null")});
test("Navigate between textfields- going backwards",function(){SC.SAFARI_FOCUS_BEHAVIOR=YES;
var d=view2.previousValidKeyView();same(d,textfield_view2,"The previous key view should be "+textfield_view2.toString())
});test("Navigate forward with view that have a nextKeyView set",function(){SC.SAFARI_FOCUS_BEHAVIOR=YES;
var d=view2.nextValidKeyView();same(d,textfield_view3,"The next view should be "+textfield_view3.toString());
view3.set("nextKeyView",textfield_view1);d=view2.nextValidKeyView();same(d,textfield_view1,"The next view should be "+textfield_view1.toString())
});test("Navigate backwards with view that have a previousKeyView set",function(){SC.SAFARI_FOCUS_BEHAVIOR=YES;
var d=view2.previousValidKeyView();same(d,textfield_view2,"The next view should be "+textfield_view2.toString());
view4.set("previousKeyView",textfield_view1);d=textfield_view3.previousValidKeyView();
same(d,textfield_view1,"The next view should be "+textfield_view1.toString())});var view;
module("SC.View#parentViewDidChange",{setup:function(){view=SC.View.create()}});test("invokes updateLayerLocationIfNeeded at end of runloop if has layer",function(){view.createLayer();
ok(view.get("layer"),"precond - has layer");var d=0;view.updateLayerLocationIfNeeded=function(){d++
};SC.RunLoop.begin();view.parentViewDidChange();SC.RunLoop.end();equals(d,1,"did invoke")
});test("invokes updateLayerLocationIfNeeded only once no matter how many times it is run",function(){view.createLayer();
ok(view.get("layer"),"precond - has layer");var d=0;view.updateLayerLocationIfNeeded=function(){d++
};SC.RunLoop.begin();view.parentViewDidChange();view.parentViewDidChange();view.parentViewDidChange();
SC.RunLoop.end();equals(d,1,"did invoke once")});test("calls recomputeIsVisibleInWindow each time it is called",function(){var d=0;
view.recomputeIsVisibleInWindow=function(){d++};SC.RunLoop.begin();view.parentViewDidChange();
view.parentViewDidChange();view.parentViewDidChange();SC.RunLoop.end();equals(d,3,"did invoke each time")
});test("returns receiver",function(){equals(view.parentViewDidChange(),view,"receiver")
});module("SC.View#prepareContext");test("populates context with layerId & classNames from view if firstTime",function(){var d=SC.View.create({layerId:"foo",classNames:["bar"]});
var e=d.renderContext();d.prepareContext(e,YES);equals(e.id(),"foo","did set id");
ok(e.hasClass("bar"),"did set class names");e=d.renderContext();d.prepareContext(e,NO);
ok(e.id()!=="foo","did not set id");ok(e.hasClass("bar"),"did set class name")});
test("invokes renderLayout if first time",function(){var h=0;var g,e;var d=SC.View.create({renderLayout:function(j,k){equals(j,g,"passed context");
equals(k,e,"passed firstTime");h++}});g=d.renderContext();e=YES;d.prepareContext(g,YES);
equals(h,1,"should call renderLayout");h=0;g=d.renderContext();e=NO;d.prepareContext(g,NO);
equals(h,0,"should not call renderLayout")});test("adds text-selectable class if view has isTextSelectable",function(){var d=SC.View.create();
var e;e=d.renderContext();d.set("isTextSelectable",YES);d.prepareContext(e,YES);ok(e.hasClass("allow-select"),"should have text-selectable class");
e=d.renderContext();d.set("isTextSelectable",NO);d.prepareContext(e,YES);ok(!e.hasClass("allow-select"),"should NOT have text-selectable class")
});test("adds disabled class if view isEnabled = NO",function(){var d=SC.View.create();
var e;e=d.renderContext();d.set("isEnabled",YES);d.prepareContext(e,YES);ok(!e.hasClass("disabled"),"should NOT have disabled class");
e=d.renderContext();d.set("isEnabled",NO);d.prepareContext(e,YES);ok(e.hasClass("disabled"),"should have disabled class")
});test("adds hidden class if view isVisible = NO",function(){var d=SC.View.create();
var e;e=d.renderContext();d.set("isVisible",YES);d.prepareContext(e,YES);ok(!e.hasClass("hidden"),"should NOT have hidden class");
e=d.renderContext();d.set("isVisible",NO);d.prepareContext(e,YES);ok(e.hasClass("hidden"),"should have hidden class")
});test("invokes render() passing context & firstTime",function(){var h=0;var g,e;
var d=SC.View.create({render:function(k,j){equals(g,k,"context passed");equals(j,e,"firstTime passed");
h++}});g=d.renderContext();e=YES;d.prepareContext(g,YES);equals(h,1,"did invoke render()");
h=0;g=d.renderContext();e=NO;d.prepareContext(g,NO);equals(h,1,"did invoke render()")
});test("invokes renderMixin() from mixins, passing context & firstTime",function(){var h=0;
var g,e;var k={renderMixin:function(m,l){equals(g,m,"context passed");equals(l,e,"firstTime passed");
h++}};var j={renderMixin:function(m,l){equals(g,m,"context passed");equals(l,e,"firstTime passed");
h++}};var d=SC.View.create(k,j);g=d.renderContext();e=YES;d.prepareContext(g,YES);
equals(h,2,"did invoke renderMixin() from both mixins");h=0;g=d.renderContext();e=NO;
d.prepareContext(g,NO);equals(h,2,"did invoke renderMixin() from both mixins")});
var parent,child;module("SC.View#removeChild",{setup:function(){parent=SC.View.create({childViews:[SC.View]});
child=parent.childViews[0]}});test("returns receiver",function(){equals(parent.removeChild(child),parent,"receiver")
});test("removes child from parent.childViews array",function(){ok(parent.childViews.indexOf(child)>=0,"precond - has child in childViews array before remove");
parent.removeChild(child);ok(parent.childViews.indexOf(child)<0,"removed child")});
test("sets parentView property to null",function(){ok(child.get("parentView"),"precond - has parentView");
parent.removeChild(child);ok(!child.get("parentView"),"parentView is now null")});
test("does nothing if passed null",function(){var d=0;parent.willRemoveChild=parent.didRemoveChild=function(){d++
};parent.removeChild(null);equals(d,0,"did not invoke callbacks")});test("invokes child.willRemoveFromParent before removing if defined",function(){var d=0;
child.willRemoveFromParent=function(){equals(child.get("parentView"),parent,"still in parent");
d++};parent.removeChild(child);equals(d,1,"invoked callback")});test("invokes parent.willRemoveChild before removing if defined",function(){var d=0;
parent.willRemoveChild=function(e){equals(e,child,"passed child as param");equals(child.get("parentView"),parent,"still in parent");
d++};parent.removeChild(child);equals(d,1,"invoked callback")});test("invokes child.didRemoveFromParent AFTER removing if defined",function(){var d=0;
child.didRemoveFromParent=function(e){equals(e,parent,"passed parent as param");ok(!child.get("parentView"),"no longer in parent");
d++};parent.removeChild(child);equals(d,1,"invoked callback")});test("invokes parent.didRemoveChild before removing if defined",function(){var d=0;
parent.didRemoveChild=function(e){equals(e,child,"passed child as param");ok(!child.get("parentView"),"no longer in parent");
d++};parent.removeChild(child);equals(d,1,"invoked callback")});test("invokes parentViewDidChange() on child view.  this is used by the view internals to update layer loc",function(){var d=0;
child.parentViewDidChange=function(){d++};parent.removeChild(child);equals(d,1,"invoked parentViewDidChange")
});test("should not move layer immediately",function(){parent.createLayer();var e=parent.get("layer"),d=child.get("layer");
ok(e,"precond - parent has layer");ok(d,"precond - child has layer");equals(d.parentNode,e,"child layer belong to parent");
parent.removeChild(child);equals(d.parentNode,e,"child layer belong to parent")});
var view;module("SC.View#removeAllChildren",{setup:function(){view=SC.View.create({childViews:[SC.View,SC.View,SC.View]})
}});test("removes all child views",function(){equals(view.childViews.length,3,"precond - has child views");
view.removeAllChildren();equals(view.childViews.length,0,"removed all children")});
test("returns receiver",function(){equals(view.removeAllChildren(),view,"receiver")
});module("SC.View#removeFromParent");test("removes view from parent view",function(){var d=SC.View.create({childViews:[SC.View]});
var e=d.childViews[0];ok(e.get("parentView"),"precond - has parentView");e.removeFromParent();
ok(!e.get("parentView"),"no longer has parentView");ok(d.childViews.indexOf(e)<0,"no longer in parent childViews")
});test("returns receiver",function(){equals(child.removeFromParent(),child,"receiver")
});test("does nothing if not in parentView",function(){var d=0;var e=SC.View.create();
e.willRemoveFromParent=function(){d++};ok(!e.get("parentView"),"precond - has no parent");
e.removeFromParent();equals(d,0,"did not invoke callback")});module("SC.View#render");
test("default implementation invokes renderChildViews if firstTime = YES",function(){var g=0,e,h;
var d=SC.View.create({renderChildViews:function(j,k){equals(j,e,"passed context");
equals(k,h,"passed firstTime flag");g++}});e=d.renderContext();h=YES;d.render(e,h);
equals(g,1,"did invoke renderChildViews()");g=0;e=d.renderContext();h=NO;d.render(e,h);
equals(g,0,"did NOT invoke renderChildViews()")});module("SC.View#renderChildViews");
test("creates a context and then invokes prepareContext on each childView",function(){var g=0,e,h;
var j=SC.View.extend({prepareContext:function(k,l){equals(k.prevObject,e,"passed child context of curContext");
equals(l,h,"passed first time flag");equals(k.tagName(),this.get("tagName"),"context setup with current tag name");
g++}});var d=SC.View.create({childViews:[j.extend({tagName:"foo"}),j.extend({tagName:"bar"}),j.extend({tagName:"baz"})]});
e=d.renderContext("div");h=YES;equals(d.renderChildViews(e,h),e,"returns context");
equals(g,3,"prepareContext() invoked for each child view");g=0;e=d.renderContext("div");
h=NO;equals(d.renderChildViews(e,h),e,"returns context");equals(g,3,"prepareContext() invoked for each child view")
});var parent,child;module("SC.View#replaceChild",{setup:function(){child=SC.View.create();
parent=SC.View.create({childViews:[SC.View,SC.View,SC.View]})}});test("swaps the old child with the new child",function(){var d=parent.childViews[1];
parent.replaceChild(child,d);equals(child.get("parentView"),parent,"child has new parent");
ok(!d.get("parentView"),"old child no longer has parent");equals(parent.childViews[1],child,"parent view has new child at loc 1");
equals(parent.childViews.length,3,"parent has same number of children")});module("SC.View#updateLayer");
test("invokes prepareContext() and then updates layer element",function(){var e=document.createElement("div");
var d=SC.View.create({layer:e,prepareContext:function(g){g.addClass("did-update")
}});d.updateLayer();ok(SC.$(e).attr("class").indexOf("did-update")>=0,"has class name added by prepareContext()")
});var view,callCount;module("SC.View#updateLayerIfNeeded",{setup:function(){var d=document.createElement("div");
view=SC.View.create({layer:d,isVisibleInWindow:YES,layerNeedsUpdate:YES,updateLayer:function(){callCount++
}});callCount=0}});test("does not call updateLayer if layerNeedsUpdate is NO",function(){view.set("layerNeedsUpdate",NO);
view.updateLayerIfNeeded();equals(callCount,0,"updateLayer did NOT run")});test("does not call updateLayer if isVisibleInWindow is NO",function(){view.set("isVisibleInWindow",NO);
view.updateLayerIfNeeded();equals(callCount,0,"updateLayer did NOT run")});test("does call updateLayer() if isVisible & layerNeedsUpdate",function(){equals(view.get("isVisibleInWindow"),YES,"precond - isVisibleInWindow");
equals(view.get("layerNeedsUpdate"),YES,"precond - layerNeedsUpdate");view.updateLayerIfNeeded();
ok(callCount>0,"updateLayer() did run")});test("resets layerNeedsUpdate to NO if called",function(){equals(view.get("layerNeedsUpdate"),YES,"precond - layerNeedsUpdate");
view.updateLayerIfNeeded();equals(view.get("layerNeedsUpdate"),NO,"layerNeedsUpdate reset to NO")
});test("returns receiver",function(){equals(view.updateLayerIfNeeded(),view,"returns receiver")
});test("only runs updateLayer() once if called multiple times (since layerNeedsUpdate is set to NO)",function(){callCount=0;
view.updateLayerIfNeeded().updateLayerIfNeeded().updateLayerIfNeeded();equals(callCount,1,"updateLayer() called only once")
});module("SC.View#layerNeedsUpdate auto-triggers",{setup:function(){view=SC.View.create({updateLayerIfNeeded:function(){callCount++
}});callCount=0}});test("setting layerNeedsUpdate calls updateLayerIfNeeded at end of runloop",function(){SC.RunLoop.begin();
view.set("layerNeedsUpdate",YES);SC.RunLoop.end();equals(callCount,1,"updateLayerIfNeeded did run")
});test("setting & resetting only triggers updateLayerIfNeeded once per runloop",function(){SC.RunLoop.begin();
view.set("layerNeedsUpdate",YES).set("layerNeedsUpdate",NO).set("layerNeedsUpdate",YES);
SC.RunLoop.end();equals(callCount,1,"updateLayerIfNeeded did run")});module("SC.View#updateLayer - integration");
test("layerNeedsUpdate actually triggers updateLayer",function(){var g=0;var e=document.createElement("div");
var d=SC.View.create({layer:e,isVisibleInWindow:YES,updateLayer:function(){g++}});
SC.RunLoop.begin();d.set("layerNeedsUpdate",YES);SC.RunLoop.end();equals(g,1,"updateLayer did run b/c layerNeedsUpdate is YES");
g=0;SC.RunLoop.begin();d.set("layerNeedsUpdate",YES);d.set("layerNeedsUpdate",NO);
SC.RunLoop.end();equals(g,0,"updateLayer did NOT run b/c layerNeedsUpdate is NO")
});var parent,child,parentLayer,childLayer;module("SC.View#updateLayerLocation",{setup:function(){parent=SC.View.create({childViews:[SC.View]});
child=parent.childViews[0];parent.createLayer();parentLayer=parent.get("layer");childLayer=child.get("layer")
},teardown:function(){parent=child=parentLayer=childLayer=null}});test("returns receiver",function(){var d=SC.View.create();
equals(d.updateLayerLocation(),d,"returns receiver")});function parentHasChild(d,g){var e=d.firstChild;
while(e){if(e===g){return YES}e=e.nextSibling}return NO}test("CASE 1: remove child from parent - remove child layer from parent layer",function(){equals(childLayer.parentNode,parentLayer,"child layer currently belongs to parent");
child.removeFromParent();child.updateLayerLocation();ok(!parentHasChild(parentLayer,childLayer),"child layer no longer belongs to parent node")
});test("CASE 2: add child to new parent view with no layer if its own, destroy the layer...",function(){var d=SC.View.create();
ok(!d.get("layer"),"precond - new parent has no layer");d.appendChild(child);child.updateLayerLocation();
ok(!parentHasChild(parentLayer,childLayer),"child layer was removed from parent layer");
ok(!child.get("layer"),"child no longer has layer either")});test("CASE 3: add child with no layer or parent with no layer.  nothing to do.  this test ensures no errors are thrown",function(){var e=SC.View.create();
var d=SC.View.create();ok(!e.get("layer"),"precond - new parent has no layer");ok(!d.get("layer"),"precond - new child has no layer");
e.appendChild(d);ok(!e.get("layer"),"new parent still has no layer");ok(!d.get("layer"),"new child still has no layer")
});test("CASE 4: add child with no layer to parent with layer.  create layer for child",function(){var d=SC.View.create();
ok(!d.get("layer"),"precond - new child has no layer");parent.appendChild(d);d.updateLayerLocation();
var e=d.get("layer");ok(e,"newChild now has layer");equals(e.parentNode,parentLayer,"newChild layer belongs to parent layer")
});test("CASE 5: add child with layer to parent with layer.  move layer from previous location to new parent",function(){var e=SC.View.create();
var d=e.createLayer().get("layer");ok(d,"precond - newParent has layer");e.appendChild(child);
child.updateLayerLocation();ok(!parentHasChild(parentLayer,childLayer),"old parent layer no longer has child layer");
ok(parentHasChild(d,childLayer),"newParent layer now has child")});test("CASE 5a: insert child before a sibling w/ layer - should insert child layer before sibling layer",function(){var g=SC.View.create({childViews:[SC.View]}).createLayer();
var d=g.get("layer");var e=g.childViews[0];var h=e.get("layer");ok(d,"precond - newParent has layer");
ok(h,"precond - sibling has layer");ok(parentHasChild(d,h),"precond - siblingLayer belongs to new parent layer");
g.insertBefore(child,e);child.updateLayerLocation();equals(childLayer.nextSibling,h,"child layer inserted before sibling layer");
ok(parentHasChild(d,childLayer),"newParentLayer does not have childLayer")});test("CASE 5b: insert child w/ layer before a sibling w/ NO layer - should create and insert sibling & child's layers",function(){var g=SC.View.create().createLayer();
var d=g.get("layer");var e=SC.View.create();ok(d,"precond - newParent has layer");
ok(!e.get("layer"),"precond - sibling should have NO layer");g.appendChild(e);g.insertBefore(child,e);
ok(e.get("layerLocationNeedsUpdate"),"sibling.layerLocationNeedsUpdate should be YES");
child.updateLayerLocation();var h=e.get("layer");ok(h,"sibling should have layer now");
ok(parentHasChild(d,h),"sibling layer should belong to newParent layer");equals(childLayer.nextSibling,h,"child layer should be inserted before sibling layer");
ok(parentHasChild(d,childLayer),"newParentLayer should have childLayer")});var view,runCount;
module("SC.View#updateLayerLocationIfNeeded",{setup:function(){view=SC.View.create({updateLayerLocation:function(){runCount++
}});runCount=0},teardown:function(){view=null}});test("returns receiver",function(){equals(view.updateLayerLocationIfNeeded(),view,"returns receiver")
});test("invokes updateLayerLocation if layerLocationNeedsUpdate is YES",function(){view.set("layerLocationNeedsUpdate",YES);
view.updateLayerLocationIfNeeded();equals(runCount,1,"did invoke")});test("does NOT invoke updateLayerLocation if layerLocationNeedsUpdate is NO",function(){view.set("layerLocationNeedsUpdate",NO);
view.updateLayerLocationIfNeeded();equals(runCount,0,"did NOT invoke")});test("sets layerLocationNeedsUpdate to NO when run",function(){view.set("layerLocationNeedsUpdate",YES);
view.updateLayerLocationIfNeeded();equals(view.get("layerLocationNeedsUpdate"),NO,"did reset")
});module("SC.View#viewDidResize");test("invokes parentViewDidResize on all child views - ignoring views that do not implement method",function(){var e=0;
var g=SC.View.extend({parentViewDidResize:function(){e++}});var d=SC.View.create({childViews:[g,g,g]});
d.childViews[2].parentViewDidResize=null;d.viewDidResize();equals(e,2,"should invoke parentViewDidResize() on two methods that support it")
});test("triggers whenever layout property is changed",function(){var e=0;var d=SC.View.create({childViews:[SC.View.extend({parentViewDidResize:function(){e++
}})]});d.set("layout",{top:10,left:20,height:50,width:40});equals(e,1,"viewDidResize should invoke once")
});test("making sure that the frame value is correct inside viewDidResize()",function(){var g;
var d=SC.View.create({layout:{left:0,top:0,width:400,height:400},viewDidResize:function(){arguments.callee.base.apply(this,arguments);
g=this.get("frame")}});var e=d.get("frame");SC.RunLoop.begin();d.adjust("height",314);
SC.RunLoop.end();same(d.get("frame").height,g.height,"height")});module("SC.View#parentViewDidResize");
function testParentViewDidResizeWithAlignments(d){d.set("layout",{top:10,left:10,height:10,width:10});
d.callCount=0;d.parentViewDidResize();equals(d.callCount,0,"should not notify frame changed");
d.set("layout",{top:10,left:10,bottom:10,width:10});d.callCount=0;d.parentViewDidResize();
equals(d.callCount,1,"should notify frame changed");d.set("layout",{top:10,left:10,height:10,right:10});
d.callCount=0;d.parentViewDidResize();equals(d.callCount,1,"should notify frame changed");
d.set("layout",{top:10,right:10,height:10,width:10});d.callCount=0;d.parentViewDidResize();
equals(d.callCount,1,"should notify frame changed");d.set("layout",{top:10,bottom:10,height:10,width:10});
d.callCount=0;d.parentViewDidResize();equals(d.callCount,1,"should notify frame changed");
d.set("layout",{centerX:10,top:10,height:10,width:10});d.callCount=0;d.parentViewDidResize();
equals(d.callCount,1,"should notify frame changed");d.set("layout",{left:10,centerY:10,height:10,width:10});
d.callCount=0;d.parentViewDidResize();equals(d.callCount,1,"should notify frame changed")
}test("notifies 'frame' property change unless layout is fixed",function(){var d=SC.View.create({callCount:0,frameDidChange:function(){this.callCount++
}.observes("frame")});testParentViewDidResizeWithAlignments(d)});test("calls viewDidResize on self unless layout is fixed",function(){var d=SC.View.create({callCount:0,viewDidResize:function(){this.callCount++
}});testParentViewDidResizeWithAlignments(d)});test("invoked whenever view is added to a new parentView but not when it is removed",function(){var g=0;
var d=SC.View.create({parentViewDidResize:function(){g++}});var e=SC.Pane.create().append();
g=0;e.appendChild(d);equals(g,1,"should call parentViewDidResize");g=0;e.removeChild(d);
equals(g,0,"should not call parentViewDidResize()");e.remove()});module("SC.View#beginLiveResize");
test("invokes willBeginLiveResize on receiver and any child views that implement it",function(){var e=0;
var g=SC.View.extend({willBeginLiveResize:function(){e++}});var d=g.create({childViews:[SC.View.extend({childViews:[g]})]});
e=0;d.beginLiveResize();equals(e,2,"should invoke willBeginLiveResize when implemented")
});test("returns receiver",function(){var d=SC.View.create();equals(d.beginLiveResize(),d,"returns receiver")
});module("SC.View#endLiveResize");test("invokes didEndLiveResize on receiver and any child views that implement it",function(){var e=0;
var g=SC.View.extend({didEndLiveResize:function(){e++}});var d=g.create({childViews:[SC.View.extend({childViews:[g]})]});
e=0;d.endLiveResize();equals(e,2,"should invoke didEndLiveResize when implemented")
});test("returns receiver",function(){var d=SC.View.create();equals(d.endLiveResize(),d,"returns receiver")
});sc_require("validators/validator");SC.Validator.CreditCard=SC.Validator.extend({fieldValueForObject:function(d,e,g){if(typeof(d)=="string"&&d.length==16){d=[d.slice(0,4),d.slice(4,8),d.slice(8,12),d.slice(12,16)].join(" ")
}return d},objectForFieldValue:function(e,d,g){return e.replace(/[\s-\.\:]/g,"")},validate:function(d,e){return this.checkNumber(e.get("fieldValue"))
},validateError:function(e,g){var d=g.get("errorLabel")||"Field";return SC.$error("Invalid.CreditCard(%@)".loc(d),d)
},validateKeyDown:function(e,g,d){return !!d.match(/[0-9\- ]/)},checkNumber:function(n){if(!n||n.length===0){return YES
}n=n.replace(/[^0-9]/g,"");var d="0123456789";var m=n.length;var l=parseInt(n,0);
var p=n.toString();p=p.replace(/^\s+|\s+$/g,"");var o=0;var u=true;var e=false;var s;
var h;for(var g=0;g<m;g++){s=""+p.substring(g,g+1);if(d.indexOf(s)=="-1"){u=false
}}if(!u){e=false}if((m===0)&&(e)){e=false}else{if(m>=15){for(var k=m;k>0;k--){h=parseInt(l,0)%10;
h=parseInt(h,0);o+=h;k--;l=l/10;h=parseInt(l,0)%10;h=h*2;switch(h){case 10:h=1;break;
case 12:h=3;break;case 14:h=5;break;case 16:h=7;break;case 18:h=9;break;default:h=h
}l=l/10;o+=h}if((o%10)===0){e=true}else{e=false}}}return e}});sc_require("validators/validator");
SC.Validator.Date=SC.Validator.extend({format:"NNN d, yyyy h:mm:ss a",fieldValueForObject:function(e,g,h){var d;
if(typeof(e)==="number"){d=new Date(e)}else{if(e instanceof Date){d=e}}if(d){e=d.format(this.get("format"))
}return e},objectForFieldValue:function(g,e,h){if(g){var d=Date.parseDate(g);g=(d)?d.getTime():null
}return g}});SC.Validator.DateTime=SC.Validator.extend({format:"%d/%m/%Y",fieldValueForObject:function(d,e,g){if(SC.kindOf(d,SC.DateTime)){d=d.toFormattedString(this.get("format"))
}else{d=null}return d},objectForFieldValue:function(e,d,g){if(e){e=SC.DateTime.parse(e,this.get("format"))
}return e}});sc_require("validators/validator");SC.Validator.Email=SC.Validator.extend({validate:function(d,e){return(e.get("fieldValue")||"").match(/.+@.+\...+/)
},validateError:function(e,g){var d=g.get("errorLabel")||"Field";return SC.$error("Invalid.Email(%@)".loc(d),d)
}});SC.Validator.EmailOrEmpty=SC.Validator.Email.extend({validate:function(d,g){var e=g.get("fieldValue");
return(e&&e.length>0)?e.match(/.+@.+\...+/):true}});sc_require("validators/validator");
SC.Validator.NotEmpty=SC.Validator.extend({validate:function(e,h){var g=h.get("fieldValue");
var d=!!g;if(d&&g.length){d=g.length>0}return d},validateError:function(e,g){var d=g.get("errorLabel")||"Field";
return SC.$error("Invalid.NotEmpty(%@)".loc(d.capitalize()),g.get("errorLabel"))}});
sc_require("validators/validator");SC.Validator.Number=SC.Validator.extend({places:0,fieldValueForObject:function(d,e,g){switch(SC.typeOf(d)){case SC.T_NUMBER:d=d.toFixed(this.get("places"));
break;case SC.T_NULL:case SC.T_UNDEFINED:d="";break}return d},objectForFieldValue:function(e,d,g){e=e.replace(/,/g,"");
switch(SC.typeOf(e)){case SC.T_STRING:if(e.length===0){e=null}else{if(this.get("places")>0){e=parseFloat(e)
}else{if(e.length==1&&e.match(/-/)){e=null}else{e=parseInt(e,0)}}}break;case SC.T_NULL:case SC.T_UNDEFINED:e=null;
break}return e},validate:function(d,g){var e=g.get("fieldValue");return(e==="")||!(isNaN(e)||isNaN(parseFloat(e)))
},validateError:function(e,g){var d=g.get("errorLabel")||"Field";return SC.$error("Invalid.Number(%@)".loc(d),d)
},validateKeyDown:function(e,g,d){var h=g.$input().val();if(!h){h=""}h+=d;if(this.get("places")===0){if(d.length===0){return true
}else{return h.match(/^[\-{0,1}]?[0-9,\0]*/)[0]===h}}else{if(d.length===0){return true
}else{return h.match(/^[\-{0,1}]?[0-9,\0]*\.?[0-9\0]+/)===h}}}});sc_require("validators/validator");
SC.Validator.Password=SC.Validator.extend({attachTo:function(d,e){arguments.callee.base.apply(this,arguments);
if(!this.fields){this.fields=[]}this.fields.push(e)},validate:function(j){if(!this.fields||this.fields.length===0){return true
}var h=false;var e=false;var d=true;var g=this.fields[0].get("fieldValue");this.fields.forEach(function(l){var k=l.get("fieldValue");
if(k!=g){d=false}if(!k||k.length===0){h=true}if(k&&k.length>0){e=true}});if(j){return(e===false)?false:d
}else{return(h===true)?true:d}},updateFields:function(g,e){if(!this.fields||this.fields.length===0){return true
}var d="Invalid.Password".loc();var h=this._field;this.fields.forEach(function(j){var k=(e)?null:((j==h)?d:"");
g.setErrorFor(j,k)});return(e)?SC.VALIDATE_OK:d},validateChange:function(e,g,d){return this.updateFields(e,this.validate(false))
},validateSubmit:function(d,e){return this.updateFields(d,this.validate(true))},validatePartial:function(e,g){var d=!this._field.get("isValid");
if(d){return this.updateFields(e,this.validate(false))}else{return SC.VALIDATE_NO_CHANGE
}}});sc_require("validators/validator");SC.Validator.PositiveInteger=SC.Validator.extend({defaultValue:null,fieldValueForObject:function(d,e,g){switch(SC.typeOf(d)){case SC.T_NUMBER:d=d.toFixed(0);
break;case SC.T_NULL:case SC.T_UNDEFINED:d=this.get("defaultValue");break}return d
},objectForFieldValue:function(e,d,g){e=e.replace(/,/g,"");switch(SC.typeOf(e)){case SC.T_STRING:if(e.length===0){e=this.get("defaultValue")
}else{e=parseInt(e,0)}break;case SC.T_NULL:case SC.T_UNDEFINED:e=this.get("defaultValue");
break}return e},validate:function(d,g){var e=g.get("fieldValue");return(e==="")||!isNaN(e)
},validateError:function(e,g){var d=g.get("errorLabel")||"Field";return SC.$error("Invalid.Number(%@)".loc(d),d)
},validateKeyDown:function(e,g,d){var h=g.$input().val();if(!h){h=""}h+=d;if(d.length===0){return true
}else{return h.match(/^[0-9\0]*/)[0]===h}}});SC.VALIDATE_OK=YES;SC.VALIDATE_NO_CHANGE=NO;
SC.Validator=SC.Object.extend({fieldValueForObject:function(e,g,d){return e},objectForFieldValue:function(g,e,d){return g
},validate:function(d,e){return true},validateError:function(d,e){return SC.$error("Invalid.General(%@)".loc(e.get("fieldValue")),e.get("fieldKey"))
},validateChange:function(e,g,d){return this.validate(e,g)?SC.VALIDATE_OK:this.validateError(e,g)
},validateSubmit:function(d,e){return this.validate(d,e)?SC.VALIDATE_OK:this.validateError(d,e)
},validatePartial:function(d,e){if(!e.get("isValid")){return this.validate(d,e)?SC.VALIDATE_OK:this.validateError(d,e)
}else{return SC.VALIDATE_NO_CHANGE}},validateKeyDown:function(e,g,d){return true},attachTo:function(d,e){},detachFrom:function(d,e){}});
SC.Validator.mixin({OK:true,NO_CHANGE:false,findFor:function(j,l,k){var g;if(!k){return
}if(k instanceof SC.Validator){g=k}else{if(k.isClass){g=k.create()}else{if(SC.typeOf(k)===SC.T_STRING){var e=null;
var d=k.match(/^(.+)\[(.*)\]/);if(d){k=d[1];e=d[2]}k=k.classify();var h=SC.Validator[k];
if(SC.none(h)){throw"validator %@ not found for %@".fmt(k,l)}else{if(e){if(!j){throw"named validator (%@) could not be found for field %@ because the field does not belong to a form".fmt(e,l)
}if(!j._validatorHash){j._validatorHash={}}g=(e)?j._validatorHash[e]:null;if(!g){g=h.create()
}if(e){j._validatorHash[e]=g}}else{g=h.create()}}}}}return g},fieldValueForObject:function(d,e,g){if(this.prototype&&this.prototype.fieldValueForObject){return this.prototype.fieldValueForObject(d,e,g)
}else{return null}},objectForFieldValue:function(e,d,g){if(this.prototype&&this.prototype.objectForFieldValue){return this.prototype.objectForFieldValue(e,d,g)
}else{return null}}});sc_require("views/view");SC.ContainerView=SC.View.extend({classNames:["sc-container-view"],nowShowing:null,contentView:null,contentViewBindingDefault:SC.Binding.single(),replaceContent:function(d){this.removeAllChildren();
if(d){this.appendChild(d)}},createChildViews:function(){var d=this.get("contentView");
if(d){d=this.contentView=this.createChildView(d);this.childViews=[d]}},awake:function(){arguments.callee.base.apply(this,arguments);
var d=this.get("nowShowing");if(d&&d.length>0){this.nowShowingDidChange()}},nowShowingDidChange:function(){var e=this.get("nowShowing");
var d=null;if(SC.typeOf(e)===SC.T_STRING){if(e===SC.CONTENT_SET_DIRECTLY){return}if(e&&e.length>0){if(e.indexOf(".")>0){d=SC.objectForPropertyPath(e,null)
}else{d=SC.objectForPropertyPath(e,this.get("page"))}}}else{d=e}if(d&&!(d instanceof SC.View)){d=null
}this.set("contentView",d)}.observes("nowShowing"),contentViewDidChange:function(){this.replaceContent(this.get("contentView"))
}.observes("contentView")});sc_require("views/view");sc_require("mixins/control");
sc_require("mixins/validatable");SC.FieldView=SC.View.extend(SC.Control,SC.Validatable,{isTextArea:NO,_field_isMouseDown:NO,fieldValue:function(){var d=this.get("value");
if(SC.typeOf(d)===SC.T_ERROR){d=d.get("errorValue")}return this.fieldValueForObject(d)
}.property("value","validator").cacheable(),$input:function(){if(this.get("isTextArea")){return this.$("textarea").andSelf().filter("textarea")
}else{return this.$("input").andSelf().filter("input")}},setFieldValue:function(e){if(SC.none(e)){e=""
}var d=this.$input();if(d.val()!==e){d.val(e)}return this},getFieldValue:function(){return this.$input().val()
},_field_fieldValueDidChange:function(d){SC.RunLoop.begin();this.fieldValueDidChange(NO);
SC.RunLoop.end()},fieldValueDidChange:function(d){var g=this.getFieldValue();var e=this.objectForFieldValue(g,d);
this.setIfChanged("value",e)},_field_valueDidChange:function(){this.setFieldValue(this.get("fieldValue"))
}.observes("fieldValue"),didCreateLayer:function(){this.setFieldValue(this.get("fieldValue"));
SC.Event.add(this.$input(),"change",this,this._field_fieldValueDidChange)},didAppendToDocument:function(){if(this.get("isTextArea")){this.setFieldValue(this.get("fieldValue"));
SC.Event.add(this.$input(),"change",this,this._field_fieldValueDidChange)}},willDestroyLayer:function(){SC.Event.remove(this.$input(),"change",this,this._field_fieldValueDidChange)
},mouseDown:function(d){this._field_isMouseDown=YES;d.allowDefault();return YES},mouseOut:function(d){if(this._field_isMouseDown){this.set("isActive",NO)
}d.allowDefault();return YES},mouseOver:function(d){this.set("isActive",this._field_isMouseDown);
d.allowDefault();return YES},mouseUp:function(d){if(this._field_isMouseDown){this.set("isActive",NO)
}this._field_isMouseDown=NO;d.allowDefault();return YES},keyDown:function(e){if(e.which===9){var d=e.shiftKey?this.get("previousValidKeyView"):this.get("nextValidKeyView");
if(d){d.becomeFirstResponder()}else{e.allowDefault()}return YES}if(this.performValidateKeyDown(e)){this._isKeyDown=YES;
e.allowDefault()}else{e.stop()}return YES},acceptsFirstResponder:function(){if(!SC.SAFARI_FOCUS_BEHAVIOR){return this.get("isEnabled")
}else{return NO}}.property("isEnabled"),willBecomeKeyResponderFrom:function(d){if(!this._isFocused){this._isFocused=YES;
this.becomeFirstResponder();if(this.get("isVisibleInWindow")){this.$input()[0].focus()
}}},willLoseKeyResponderTo:function(d){if(this._isFocused){this._isFocused=NO}},_field_setFieldValue:function(e){this.propertyWillChange("fieldValue");
if(this.fieldValueForObject){e=this.fieldValueForObject(e)}var d=this.setFieldValue(e);
this.propertyDidChange("fieldValue");return d},_field_getFieldValue:function(){var d=this.getFieldValue();
if(this.objectForFieldValue){d=this.objectForFieldValue(d)}return d}});sc_require("views/view");
sc_require("mixins/control");SC.IMAGE_STATE_NONE="none";SC.IMAGE_STATE_LOADING="loading";
SC.IMAGE_STATE_LOADED="loaded";SC.IMAGE_STATE_FAILED="failed";SC.IMAGE_STATE_SPRITE="sprite";
SC.BLANK_IMAGE_DATAURL="data:image/gif;base64,R0lGODlhAQABAJAAAP///wAAACH5BAUQAAAALAAAAAABAAEAAAICBAEAOw==";
SC.BLANK_IMAGE_URL=SC.browser.msie&&SC.browser.msie<8?"/static/frameworks/en/0404a27d39b34c46f3df8b0d82ab2e9353e6a24f/foundation/english.lproj/blank.gif":SC.BLANK_IMAGE_DATAURL;
SC.ImageView=SC.View.extend(SC.Control,{classNames:"sc-image-view",tagName:"img",status:SC.IMAGE_STATE_NONE,value:null,useImageCache:YES,canLoadInBackground:NO,localize:YES,displayProperties:"status toolTip".w(),render:function(g,k){var d=this.get("status"),h=this.get("value");
if(d===SC.IMAGE_STATE_NONE&&h){this._image_valueDidChange()}d=this.get("status");
var j=(d===SC.IMAGE_STATE_LOADED)?h:SC.BLANK_IMAGE_URL;if(d===SC.IMAGE_STATE_SPRITE){g.addClass(h)
}g.attr("src",j);var e=this.get("toolTip");if(SC.typeOf(e)===SC.T_STRING){if(this.get("localize")){e=e.loc()
}g.attr("title",e);g.attr("alt",e)}},_image_valueDidChange:function(){var e=this.get("value"),g;
if(e&&e.isEnumerable){e=e.firstObject()}g=SC.ImageView.valueIsUrl(e);if(g&&this.get("useImageCache")){var d=this.get("isVisibleInWindow")||this.get("canLoadInBackground");
this._loadingUrl=e;SC.imageCache.loadImage(e,this,this.imageDidLoad,d);if(this._loadingUrl){this.set("status",SC.IMAGE_STATE_LOADING)
}}else{this._loadingUrl=null;this.set("status",(g)?SC.IMAGE_STATE_LOADED:SC.IMAGE_STATE_SPRITE);
this.displayDidChange()}}.observes("value"),imageDidLoad:function(d,e){if(d===this._loadingUrl){this._loadingUrl=null
}if(this.get("value")===d){this.set("status",SC.$ok(e)?SC.IMAGE_STATE_LOADED:SC.IMAGE_STATE_FAILED);
this.displayDidChange()}}});SC.ImageView.valueIsUrl=function(d){return d?d.indexOf("/")>=0:NO
};sc_require("views/view");sc_require("mixins/control");SC.ALIGN_LEFT="left";SC.ALIGN_RIGHT="right";
SC.ALIGN_CENTER="center";SC.REGULAR_WEIGHT="normal";SC.BOLD_WEIGHT="bold";SC.LabelView=SC.View.extend(SC.Control,{classNames:["sc-label-view"],fontWeight:SC.REGULAR_WEIGHT,escapeHTML:true,escapeHTMLBindingDefault:SC.Binding.oneWay().bool(),localize:false,localizeBindingDefault:SC.Binding.oneWay().bool(),formatter:null,value:"",hint:null,exampleInlineTextFieldView:SC.InlineTextFieldView,icon:null,textAlign:SC.ALIGN_LEFT,isInlineEditorMultiline:NO,displayValue:function(){var l,j;
l=this.get("value");j=this.getDelegateProperty("formatter",this.displayDelegate);
if(j){var k=(SC.typeOf(j)===SC.T_FUNCTION)?j(l,this):j.fieldValueForObject(l,this);
if(!SC.none(k)){l=k}}if(SC.typeOf(l)===SC.T_ARRAY){var h=[];for(var e=0,g=l.get("length");
e<g;e++){var d=l.objectAt(e);if(!SC.none(d)&&d.toString){d=d.toString()}h.push(d)
}l=h.join(",")}if(!SC.none(l)&&l.toString){l=l.toString()}if(l&&this.getDelegateProperty("localize",this.displayDelegate)){l=l.loc()
}if(this.get("escapeHTML")){l=SC.RenderContext.escapeHTML(l)}return l}.property("value","localize","formatter","escapeHTML").cacheable(),hintValue:function(){var d=this.get("hint");
if(this.get("escapeHTML")){d=SC.RenderContext.escapeHTML(d)}return d}.property("hint","escapeHTML").cacheable(),isEditable:NO,isEditableBindingDefault:SC.Binding.bool(),isEditing:NO,validator:null,doubleClick:function(d){return this.beginEditing()
},beginEditing:function(){if(this.get("isEditing")){return YES}if(!this.get("isEditable")){return NO
}var e=this.$(),h=this.get("value")||"",g=SC.viewportOffset(e[0]),d=this.convertFrameFromView(this.get("frame"),null);
g.width=d.width;g.height=d.height;SC.InlineTextFieldView.beginEditing({frame:g,delegate:this,exampleElement:e,value:h,multiline:this.get("isInlineEditorMultiline"),isCollection:NO,validator:this.get("validator"),exampleInlineTextFieldView:this.get("exampleInlineTextFieldView")})
},discardEditing:function(){if(!this.get("isEditing")){return YES}return SC.InlineTextFieldView.discardEditing()
},commitEditing:function(){if(!this.get("isEditing")){return YES}return SC.InlineTextFieldView.commitEditing()
},inlineEditorWillBeginEditing:function(d){this.set("isEditing",YES)},inlineEditorDidBeginEditing:function(e){var d=this.$();
this._oldOpacity=d.css("opacity");d.css("opacity",0)},inlineEditorShouldEndEditing:function(d,e){return YES
},inlineEditorDidEndEditing:function(d,e){this.setIfChanged("value",e);this.$().css("opacity",this._oldOpacity);
this._oldOpacity=null;this.set("isEditing",NO)},displayProperties:"displayValue textAlign fontWeight icon".w(),_TEMPORARY_CLASS_HASH:{},render:function(h,d){var p=this.get("displayValue"),o=this.get("icon"),l=this.get("hintValue"),k,j,s,m=false,g=false;
if(o){var e=(o.indexOf("/")>=0)?o:SC.BLANK_IMAGE_URL,n=(e===o)?"":o;o='<img src="'+e+'" alt="" class="icon '+n+'" />';
if(o!==this._iconCache){this._iconCache=o;m=true}}if(l&&(!p||p==="")){s='<span class="sc-hint">'+l+"</span>"
}else{s=p}if(s!==this._textCache){this._textCache=s;g=true}if(d||g||m){h.push(o,s)
}j={"text-align":this.get("textAlign"),"font-weight":this.get("fontWeight")};if(this.get("isEditing")){j.opacity=0
}h.addStyle(j);k=this._TEMPORARY_CLASS_HASH;k.icon=!!this.get("icon");h.setClass(k)
}});sc_require("views/field");sc_require("system/text_selection");sc_require("mixins/static_layout");
SC.TextFieldView=SC.FieldView.extend(SC.StaticLayout,SC.Editable,{tagName:"label",classNames:["sc-text-field-view"],applyImmediately:YES,isPassword:NO,isTextArea:NO,hint:null,isEditing:NO,leftAccessoryView:null,rightAccessoryView:null,_isFocused:NO,routeTouch:NO,isEditable:function(){return this.get("isEnabled")
}.property("isEnabled").cacheable(),selection:function(o,m){var h=this.$input()[0],j,d,g;
if(m===undefined){if(h){d=null;g=null;if(!h.value){d=g=0}else{if("selectionStart" in h){d=h.selectionStart
}if("selectionEnd" in h){g=h.selectionEnd}if(d===null||g===null){var n=document.selection;
if(n){var l=n.type;if(l&&(l==="None"||l==="Text")){j=n.createRange();if(!this.get("isTextArea")){var e=j.text.length;
d=Math.abs(j.moveStart("character",0-(h.value.length+1)));g=d+e}else{var k=j.duplicate();
k.moveToElementText(h);k.setEndPoint("EndToStart",j);d=k.text.length;g=d+j.text.length
}}}}}return SC.TextSelection.create({start:d,end:g})}else{return null}}else{if(!m||!m.kindOf||!m.kindOf(SC.TextSelection)){throw"When setting the selection, you must specify an SC.TextSelection instance."
}if(h){if(h.setSelectionRange){h.setSelectionRange(m.get("start"),m.get("end"))}else{j=h.createTextRange();
d=m.get("start");j.move("character",d);j.moveEnd("character",m.get("end")-d);j.select()
}}return m}}.property("fieldValue").cacheable(),displayProperties:"hint fieldValue isEditing leftAccessoryView rightAccessoryView isTextArea".w(),createChildViews:function(){this.accessoryViewObserver()
},acceptsFirstResponder:function(){return this.get("isEnabled")}.property("isEnabled"),accessoryViewObserver:function(){var k,m=["leftAccessoryView","rightAccessoryView"],d=m.length,e,j,h,l;
for(e=0;e<d;e++){j=m[e];h=this["_"+j];l=this.get(j);if(!(h&&l&&(h===l))){if(h){k=h.get("classNames");
k=k.without("sc-text-field-accessory-view");h.set("classNames",k);this.removeChild(h);
h=null;this["_"+j]=null}if(l){if(l.isClass){l=l.create({layoutView:this})}k=l.get("classNames");
var g="sc-text-field-accessory-view";if(k.indexOf(g)<0){k.push(g)}this.appendChild(l);
this["_"+j]=l}}}}.observes("leftAccessoryView","rightAccessoryView"),layoutChildViewsIfNeeded:function(d){if(!d){d=this.get("isVisibleInWindow")
}if(d&&this.get("childViewsNeedLayout")){var e=this.get("rightAccessoryView");if(e&&e.get){var g=e.get("layout");
if(g){g.left=null;if(!g.right){g.right=0}e.adjust({layout:g})}}}arguments.callee.base.apply(this,arguments)
},render:function(g,d){arguments.callee.base.apply(this,arguments);var j=this.get("isEnabled")?"":'disabled="disabled"',e=SC.guidFor(this),m=this.get("isPassword")?"password":"text",n,l,h,k;
if(this.get("isTextArea")){g.addClass("text-area")}n=this.get("fieldValue");if(SC.none(n)){n=""
}n=String(n);g.setClass("not-empty",n.length>0);l=this._getAccessoryViewWidths();
h=l.left;k=l.right;if(h){h+="px"}if(k){k+="px"}this._renderField(g,d,n,h,k);if(SC.browser.mozilla){this.invokeLast(this._applyFirefoxCursorFix)
}},_forceRenderFirstTime:NO,_renderFieldLikeFirstTime:function(){this.set("_forceRenderFirstTime",YES)
}.observes("isTextArea"),_renderField:function(g,d,p,h,m){var j=this.get("hint"),k,e,u,n,o,l,s;
if(d||this._forceRenderFirstTime){this._forceRenderFirstTime=NO;k=this.get("isEnabled")?"":'disabled="disabled"';
e=this.get("layerId");g.push('<span class="border"></span>');u="";if(h||m){u='style="';
if(h){u+="left: "+h+"; "}if(m){u+="right: "+m+";"}u+='"'}g.push('<span class="padding" '+u+">");
if(!SC.browser.safari){g.push('<span class="sc-hint">',j,"</span>")}p=this.get("escapeHTML")?SC.RenderContext.escapeHTML(p):p;
if(this.get("isTextArea")){g.push('<textarea name="',e,'" ',k,' placeholder="',j,'">',p,"</textarea></span>")
}else{n=this.get("isPassword")?"password":"text";g.push('<input type="',n,'" name="',e,'" ',k,' value="',p,'" placeholder="',j,'"/></span>')
}}else{o=this.$(".sc-hint");if(j!==this._textField_currentHint){this._textField_currentHint=j;
o.text(j)}l=this.$input()[0];if(l){if(!this.get("isEnabled")){l.disabled="true"}else{l.disabled=null
}s=l.parentNode.style;if(h){if(s.left!==h){s.left=h}}else{s.left=null}if(m){if(s.right!==m){s.right=m
}}else{s.right=null}}}},_getAccessoryViewWidths:function(){var g={},o=["left","right"],h=o.length,k,l,p,n,d,m,j,e;
for(k=0;k<h;k++){l=o[k];p=this.get(l+"AccessoryView");if(p&&p.get){e=p.get("frame");
if(e){d=e.width;if(d){m=p.get("layout");if(m){j=m[l];d+=j}g[l]=d}}}}return g},didCreateLayer:function(){arguments.callee.base.apply(this,arguments);
if(this.get("isTextArea")){this.invokeLast(this._addTextAreaEvents)}else{this._addTextAreaEvents();
if(SC.browser.mozilla){var d=this.$input();SC.Event.add(d,"keypress",this,this._firefox_dispatch_keypress)
}}},_addTextAreaEvents:function(){var d=this.$input();SC.Event.add(d,"focus",this,this._textField_fieldDidFocus);
SC.Event.add(d,"blur",this,this._textField_fieldDidBlur);SC.Event.add(d,"select",this,this._textField_selectionDidChange);
if(SC.browser.mozilla){this._cacheInputElement=this.$input();this._cachePaddingElement=this.$(".padding")
}},willDestroyLayer:function(){arguments.callee.base.apply(this,arguments);var d=this.$input();
SC.Event.remove(d,"focus",this,this._textField_fieldDidFocus);SC.Event.remove(d,"blur",this,this._textField_fieldDidBlur);
SC.Event.remove(d,"select",this,this._textField_selectionDidChange);SC.Event.remove(d,"focus",this,this._firefox_dispatch_keypress)
},_textField_fieldDidFocus:function(d){SC.RunLoop.begin();this.fieldDidFocus(d);SC.RunLoop.end()
},_textField_fieldDidBlur:function(d){SC.RunLoop.begin();this.fieldDidBlur(this._origEvent);
SC.RunLoop.end()},fieldDidFocus:function(d){this.beginEditing(d)},fieldDidBlur:function(d){this.commitEditing(d)
},_topOffsetForFirefoxCursorFix:3,_applyFirefoxCursorFix:function(){if(parseFloat(SC.browser.mozilla)<1.9&&!this.get("useStaticLayout")){var m,h,g,n,e,l,j,k;
j=this._cacheInputElement;k=this._cachePaddingElement;if(k&&k[0]){l=k[0];e=SC.$(l).offset();
if(SC.browser.compareVersion(1,9,2)<0&&j[0].tagName.toLowerCase()==="input"){m=e.top+this._topOffsetForFirefoxCursorFix
}else{m=e.top}h=e.left;g=l.offsetWidth;n=l.offsetHeight;var d="position: fixed; top: %@px; left: %@px; width: %@px; height: %@px;".fmt(m,h,g,n);
if(!this._prevStyle||this._prevStyle!=d){j.attr("style",d)}this._prevStyle=d}}return this
},_firefox_dispatch_keypress:function(d){var h=this.get("selection"),j=this.get("value"),g=j?j.length:0,e;
if(!h||(h.get("length")===0&&(h.get("start")===0||h.get("end")===g))){e=SC.RootResponder.responder;
e.keypress.call(e,d);d.stopPropagation()}},_textField_selectionDidChange:function(){this.notifyPropertyChange("selection")
},willBecomeKeyResponderFrom:function(d){if(this.get("isVisibleInWindow")){var e=this.$input()[0];
if(e){e.focus()}if(!this._txtFieldMouseDown){this.invokeLast(this._selectRootElement)
}}},willLoseKeyResponderTo:function(d){},_selectRootElement:function(){this.$input()[0].select()
},didLoseKeyResponderTo:function(d){var e=this.$input()[0];if(e){e.blur()}},parentViewDidResize:function(){if(SC.browser.mozilla){this.invokeLast(this._applyFirefoxCursorFix)
}arguments.callee.base.apply(this,arguments)},keyDown:function(e){var g=e.which;if((g===13&&!e.isIMEInput)&&!this.get("isTextArea")){return NO
}if(g===27){return NO}if(g===9){var d=e.shiftKey?this.get("previousValidKeyView"):this.get("nextValidKeyView");
if(d){d.becomeFirstResponder()}else{e.allowDefault()}return YES}if(this.performValidateKeyDown(e)){this._isKeyDown=YES;
e.allowDefault()}else{e.stop()}return YES},keyUp:function(d){this.notifyPropertyChange("selection");
if(this._isKeyDown&&this.get("applyImmediately")){this.invokeLater(this.fieldValueDidChange,1,YES)
}this._isKeyDown=NO;d.allowDefault();return YES},mouseDown:function(d){var e=this.get("fieldValue");
this._txtFieldMouseDown=YES;if(!this.get("isEnabled")){d.stop();return YES}else{if((e&&e.length===0)||!e){if(SC.browser.msie){this.invokeLater(this.focusIE7,1)
}else{this.$input()[0].focus()}return YES}else{if(!SC.browser.safari){this.$input()[0].focus()
}return arguments.callee.base.apply(this,arguments)}}},mouseUp:function(d){this._txtFieldMouseDown=NO;
this.notifyPropertyChange("selection");if(!this.get("isEnabled")){d.stop();return YES
}return arguments.callee.base.apply(this,arguments)},focusIE7:function(){this.$input()[0].focus()
},selectStart:function(d){return YES}});sc_require("system/browser");sc_require("system/event");
sc_require("system/cursor");sc_require("system/responder");sc_require("mixins/string");
SC.viewKey=SC.guidKey+"_view";SC.LAYOUT_HORIZONTAL="sc-layout-horizontal";SC.LAYOUT_VERTICAL="sc-layout-vertical";
SC._VIEW_DEFAULT_DIMS="marginTop marginLeft".w();SC.ANCHOR_TOP={top:0};SC.ANCHOR_LEFT={left:0};
SC.ANCHOR_TOP_LEFT={top:0,left:0};SC.ANCHOR_BOTTOM={bottom:0};SC.ANCHOR_RIGHT={right:0};
SC.ANCHOR_BOTTOM_RIGHT={bottom:0,right:0};SC.FULL_WIDTH={left:0,right:0};SC.FULL_HEIGHT={top:0,bottom:0};
SC.ANCHOR_CENTER={centerX:0,centerY:0};SC.LAYOUT_AUTO="auto";SC.CONTEXT_MENU_ENABLED=YES;
SC.TABBING_ONLY_INSIDE_DOCUMENT=YES;SC.ROUTE_TOUCH=NO;SC.EMPTY_CHILD_VIEWS_ARRAY=[];
SC.EMPTY_CHILD_VIEWS_ARRAY.needsClone=YES;SC.View=SC.Responder.extend(SC.DelegateSupport,{concatenatedProperties:"outlets displayProperties layoutProperties classNames renderMixin didCreateLayerMixin willDestroyLayerMixin".w(),pane:function(){var d=this;
while(d&&!d.isPane){d=d.get("parentView")}return d}.property("parentView").cacheable(),page:null,splitView:function(){var d=this;
while(d&&!d.isSplitView){d=d.get("parentView")}return d}.property("parentView").cacheable(),parentView:null,backgroundColor:null,routeTouch:YES,useStaticLayout:NO,isEnabled:YES,isEnabledBindingDefault:SC.Binding.oneWay().bool(),isEnabledInPane:function(){var d=this.get("isEnabled"),e;
if(d&&(e=this.get("parentView"))){d=e.get("isEnabledInPane")}return d}.property("parentView","isEnabled"),isEnabledObserver:function(){if(!this.get("isEnabled")&&this.get("isFirstResponder")){this.resignFirstResponder()
}}.observes("isEnabled"),isVisible:YES,isVisibleBindingDefault:SC.Binding.bool(),isVisibleInWindow:NO,isContextMenuEnabled:function(){return SC.CONTEXT_MENU_ENABLED
}.property(),recomputeIsVisibleInWindow:function(g){var j=this.get("isVisibleInWindow"),l=this.get("isVisible"),h;
if(l){l=(g===undefined)?((h=this.get("parentView"))?h.get("isVisibleInWindow"):NO):g
}this.set("isVisibleInWindow",l);this._needsVisibiltyChange=YES;var k=this.get("childViews"),e=k.length,d;
for(d=0;d<e;d++){k[d].recomputeIsVisibleInWindow(l)}if(l){if(this.parentViewDidResize){this.parentViewDidResize()
}if(this.get("childViewsNeedLayout")){this.invokeOnce(this.layoutChildViewsIfNeeded)
}}this.set("layerNeedsUpdate",YES);if(!l&&this.get("isFirstResponder")){this.resignFirstResponder()
}return this}.observes("isVisible"),childViews:SC.EMPTY_CHILD_VIEWS_ARRAY,insertBefore:function(e,h){e.beginPropertyChanges();
if(e.get("parentView")){e.removeFromParent()}if(this.willAddChild){this.willAddChild(e,h)
}if(e.willAddToParent){e.willAddToParent(this,h)}e.set("parentView",this);var d,g=this.get("childViews");
if(g.needsClone){this.set(g=[])}d=(h)?g.indexOf(h):g.length;if(d<0){d=g.length}g.insertAt(d,e);
e.parentViewDidChange();e.layoutDidChange();var j=e.get("pane");if(j&&j.get("isPaneAttached")){e._notifyDidAppendToDocument()
}if(this.didAddChild){this.didAddChild(e,h)}if(e.didAddToParent){e.didAddToParent(this,h)
}e.endPropertyChanges();return this},removeChild:function(e){if(!e){return this}if(e.parentView!==this){throw"%@.removeChild(%@) must belong to parent".fmt(this,e)
}if(e.willRemoveFromParent){e.willRemoveFromParent()}if(this.willRemoveChild){this.willRemoveChild(e)
}e.set("parentView",null);var g=this.get("childViews");var d=g.indexOf(e);if(d>=0){g.removeAt(d)
}e.parentViewDidChange();if(this.didRemoveChild){this.didRemoveChild(e)}if(e.didRemoveFromParent){e.didRemoveFromParent(this)
}return this},removeAllChildren:function(){var e=this.get("childViews"),d;while(d=e.objectAt(e.get("length")-1)){this.removeChild(d)
}return this},removeFromParent:function(){var d=this.get("parentView");if(d){d.removeChild(this)
}return this},replaceChild:function(d,e){d.beginPropertyChanges();e.beginPropertyChanges();
this.beginPropertyChanges();this.insertBefore(d,e).removeChild(e);this.endPropertyChanges();
e.endPropertyChanges();d.endPropertyChanges();return this},replaceAllChildren:function(g){var e=g.get("length"),d;
this.beginPropertyChanges();this.destroyLayer().removeAllChildren();for(d=0;d<e;d++){this.appendChild(g.objectAt(d))
}this.replaceLayer();this.endPropertyChanges();return this},appendChild:function(d){return this.insertBefore(d,null)
},parentViewDidChange:function(){this.recomputeIsVisibleInWindow();this.set("layerLocationNeedsUpdate",YES);
this.invokeOnce(this.updateLayerLocationIfNeeded);this._invalidatePaneCacheForSelfAndAllChildViews();
return this}.observes("isVisible"),_invalidatePaneCacheForSelfAndAllChildViews:function(){var h,g=this.get("childViews"),e=g.length,d;
this.notifyPropertyChange("pane");for(d=0;d<e;++d){h=g[d];if(h._invalidatePaneCacheForSelfAndAllChildViews){h._invalidatePaneCacheForSelfAndAllChildViews()
}}},layer:function(d,g){if(g!==undefined){this._view_layer=g}else{g=this._view_layer;
if(!g){var e=this.get("parentView");if(e){e=e.get("layer")}if(e){this._view_layer=g=this.findLayerInParentLayer(e)
}e=null}}return g}.property("isVisibleInWindow").cacheable(),$:function(g){var d,e=this.get("layer");
d=!e?SC.$([]):(g===undefined)?SC.$(e):SC.$(g,e);e=null;return d},containerLayer:function(){return this.get("layer")
}.property("layer").cacheable(),layerId:function(){return SC.guidFor(this)}.property().cacheable(),findLayerInParentLayer:function(h){var d=this.get("layerId"),k,g,e,m,j;
if(h.getElementById){j=h.getElementById(d)}else{j=document.getElementById(d)}if(SC.browser.msie&&j&&j.id!==d){j=null
}if(!j&&h.querySelector){j=h.querySelector("#"+d)}if(!j){j=h.firstChild;var l=[];
l.push(h);while(l.length!==0){k=l[0];l.shift();if(k.id===d){m=true;j=k;break}for(g=0,e=k.childNodes.length;
g<e;g++){l.push(k.childNodes[g])}}if(!m){j=null}}return j},isDescendantOf:function(d){var e=this.get("parentView");
if(this===d){return YES}else{if(e){return e.isDescendantOf(d)}else{return NO}}},displayDidChange:function(){this.set("layerNeedsUpdate",YES);
return this},layerNeedsUpdate:NO,_view_layerNeedsUpdateDidChange:function(){if(this.get("layerNeedsUpdate")){this.invokeOnce(this.updateLayerIfNeeded)
}}.observes("layerNeedsUpdate"),updateLayerIfNeeded:function(){var d=this.get("isVisibleInWindow");
if((d||this._needsVisibiltyChange)&&this.get("layerNeedsUpdate")){this._needsVisibiltyChange=NO;
if(this.get("layer")){this.beginPropertyChanges();this.set("layerNeedsUpdate",NO);
this.updateLayer();this.endPropertyChanges()}}else{this.set("layerNeedsUpdate",NO)
}return this},updateLayer:function(){var d=this.renderContext(this.get("layer"));
this.prepareContext(d,NO);d.update();if(d._innerHTMLReplaced){var e=this.get("pane");
if(e&&e.get("isPaneAttached")){this._notifyDidAppendToDocument()}}if(this.didUpdateLayer){this.didUpdateLayer()
}if(this.designer&&this.designer.viewDidUpdateLayer){this.designer.viewDidUpdateLayer()
}return this},renderContext:function(d){return SC.RenderContext(d)},createLayer:function(){if(this.get("layer")){return this
}var d=this.renderContext(this.get("tagName"));this.prepareContext(d,YES);this.set("layer",d.element());
this._notifyDidCreateLayer();return this},_notifyDidCreateLayer:function(){if(this.didCreateLayer){this.didCreateLayer()
}var g=this.didCreateLayerMixin,e,d,h=this.get("childViews");if(g){e=g.length;for(d=0;
d<e;++d){g[d].call(this)}}e=h.length;for(d=0;d<e;++d){if(!h[d]){continue}h[d]._notifyDidCreateLayer()
}},destroyLayer:function(){var d=this.get("layer");if(d){this._notifyWillDestroyLayer();
if(d.parentNode){d.parentNode.removeChild(d)}d=null}return this},replaceLayer:function(){this.destroyLayer();
this.set("layerLocationNeedsUpdate",YES);this.invokeOnce(this.updateLayerLocationIfNeeded)
},_notifyWillDestroyLayer:function(){if(this.willDestroyLayer){this.willDestroyLayer()
}var g=this.willDestroyLayerMixin,e,d,h=this.get("childViews");if(g){e=g.length;for(d=0;
d<e;++d){g[d].call(this)}}e=h.length;for(d=0;d<e;++d){h[d]._notifyWillDestroyLayer()
}this.set("layer",null)},prepareContext:function(k,m){var j,e,d,h,g,l;if(m){h=this.layerId?this.get("layerId"):SC.guidFor(this);
k.id(h).classNames(this.get("classNames"),YES);this.renderLayout(k,m)}else{k.resetClassNames();
k.classNames(this.get("classNames"),YES)}if(this.get("isTextSelectable")){k.addClass("allow-select")
}if(!this.get("isEnabled")){k.addClass("disabled")}if(!this.get("isVisible")){k.addClass("hidden")
}if(this.get("isFirstResponder")){k.addClass("focus")}if(this.get("useStaticLayout")){k.addClass("sc-static-layout")
}g=this.get("backgroundColor");if(g){k.addStyle("backgroundColor",g)}l=this.get("cursor");
if(l){k.addClass(l.get("className"))}this.beginPropertyChanges();this.set("layerNeedsUpdate",NO);
this.render(k,m);if(j=this.renderMixin){e=j.length;for(d=0;d<e;++d){j[d].call(this,k,m)
}}this.endPropertyChanges()},renderChildViews:function(j,k){var h=this.get("childViews"),e=h.length,d,g;
for(d=0;d<e;++d){g=h[d];if(!g){continue}j=j.begin(g.get("tagName"));g.prepareContext(j,k);
j=j.end()}return j},render:function(d,e){if(e){this.renderChildViews(d,e)}},_notifyDidAppendToDocument:function(){if(this.didAppendToDocument){this.didAppendToDocument()
}var g=0,h,d,e=this.get("childViews");for(g=0,d=e.length;g<d;g++){h=e[g];if(h._notifyDidAppendToDocument){h._notifyDidAppendToDocument()
}}},tagName:"div",classNames:["sc-view"],toolTip:null,isTextSelectable:NO,displayProperties:["isFirstResponder","isVisible"],cursor:null,layerLocationNeedsUpdate:NO,updateLayerLocationIfNeeded:function(d){if(this.get("layerLocationNeedsUpdate")){this.set("layerLocationNeedsUpdate",NO);
this.updateLayerLocation()}return this},updateLayerLocation:function(){var j=this.get("layer"),h=this.get("parentView"),e=h?h.get("containerLayer"):null;
if(j&&j.parentNode&&j.parentNode!==e){j.parentNode.removeChild(j)}if(!h){if(j&&j.parentNode){j.parentNode.removeChild(j)
}}else{if(!e){if(j){if(j.parentNode){j.parentNode.removeChild(j)}this.destroyLayer()
}}else{if(!j){this.createLayer();j=this.get("layer");if(!j){return}}var k=h.get("childViews"),g=k.objectAt(k.indexOf(this)+1),d=(g)?g.get("layer"):null;
if(g&&(!d||d.parentNode!==e)){g.updateLayerLocationIfNeeded();d=g.get("layer")}if((j.parentNode!==e)||(j.nextSibling!==d)){e.insertBefore(j,d);
if(this.parentViewDidResize){this.parentViewDidResize()}}}}e=h=j=d=null;return this
},nextResponder:function(){return this.get("parentView")}.property("parentView").cacheable(),acceptsFirstResponder:NO,isKeyResponder:NO,willLoseKeyResponderTo:function(d){},willBecomeKeyResponderFrom:function(d){},didLoseKeyResponderTo:function(d){},didBecomeKeyResponderFrom:function(d){},interpretKeyEvents:function(e){var d=e.commandCodes(),h=d[0],j=d[1],l;
if(!h&&!j){return null}if(h){var m=SC.MODIFIED_KEY_BINDINGS[h]||SC.BASE_KEY_BINDINGS[h.match(/[^_]+$/)[0]];
if(m){var k=this,g=this.get("pane"),n=null;while(k&&!(n=k.tryToPerform(m,e))){k=(k===g)?null:k.get("nextResponder")
}return n}}if(j&&this.respondsTo("insertText")){l=this.insertText(j,e);return l?(l===YES?this:l):null
}return null},insertText:function(d){return NO},performKeyEquivalent:function(j,g){var h=NO,k=this.get("childViews"),e=k.length,d=-1;
while(!h&&(++d<e)){h=k[d].performKeyEquivalent(j,g)}return h},nextKeyView:null,nextValidKeyView:function(){var d=[],g=this.pane(),e=this.get("nextKeyView");
if(!e){e=g._computeNextValidKeyView(this,d)}if(SC.TABBING_ONLY_INSIDE_DOCUMENT&&!e){e=g._computeNextValidKeyView(g,d)
}return e}.property("nextKeyView"),_computeNextValidKeyView:function(l,e){var g=this.get("nextKeyView"),j,h,d,k;
if(this!==l&&e.indexOf(l)!=-1&&this.get("acceptsFirstResponder")&&this.get("isVisibleInWindow")){return this
}e.push(this);if(!g){j=this.get("childViews");for(h=0,d=j.length;h<d;h++){k=j[h];
if(k.get("isVisibleInWindow")&&k.get("isVisible")){g=k._computeNextValidKeyView(l,e)
}if(g){return g}}g=null}return g},previousKeyView:null,previousValidKeyView:function(){var d=[],g=this.pane(),e=this.get("previousKeyView");
if(!e){e=g._computePreviousValidKeyView(this,d)}return e}.property("previousKeyView"),_computePreviousValidKeyView:function(k,d){var e=this.get("previousKeyView"),h,g,j;
if(this!==k&&d.indexOf(k)!=-1&&this.get("acceptsFirstResponder")&&this.get("isVisibleInWindow")){return this
}d.push(this);if(!e){h=this.get("childViews");for(g=h.length-1;0<=g;g--){j=h[g];if(j.get("isVisibleInWindow")&&j.get("isVisible")){e=j._computePreviousValidKeyView(k,d)
}if(e){return e}}e=null}return e},init:function(){var j,l,g,e,d,h,m;arguments.callee.base.apply(this,arguments);
if(!this.get("isMaterialized")){SC.View.views[this.get("layerId")]=this}var k=this.get("childViews");
this.childViews=k?k.slice():[];this.createChildViews();m=this.get("displayProperties");
e=m.length;while(--e>=0){this.addObserver(m[e],this,this.displayDidChange)}if(this.get("isDropTarget")){SC.Drag.addDropTarget(this)
}if(this.get("isScrollable")){SC.Drag.addScrollableView(this)}if(SC.ROUTE_TOUCH&&this.get("routeTouch")){this.routeTouchEvents()
}},routeTouchEvents:function(){if(!this.respondsTo("touchStart")&&this.respondsTo("mouseDown")){this.touchStart=this.mouseDown
}if(!this.respondsTo("touchEnd")&&this.respondsTo("mouseUp")){this.touchEnd=this.mouseUp
}if(!this.respondsTo("touchMoved")&&this.respondsTo("mouseMove")){this.touchMoved=this.mouseMoved
}if(!this.respondsTo("touchEntered")&&this.respondsTo("mouseEntered")){this.touchEntered=this.mouseEntered
}if(!this.respondsTo("touchExited")&&this.respondsTo("mouseExited")){this.touchExited=this.mouseExited
}},awake:function(){arguments.callee.base.apply(this,arguments);var g=this.get("childViews"),e=g.length,d;
for(d=0;d<e;++d){if(!g[d]){continue}g[d].awake()}},destroy:function(){if(this.get("isDestroyed")){return this
}this.removeFromParent();this._destroy();if(this.get("isDropTarget")){SC.Drag.removeDropTarget(this)
}if(this.get("isScrollable")){SC.Drag.removeScrollableView(this)}arguments.callee.base.apply(this,arguments);
return this},_destroy:function(){if(this.get("isDestroyed")){return this}this.destroyLayer();
var g=this.get("childViews"),e=g.length,d;if(e){g=g.slice();for(d=0;d<e;++d){g[d].destroy()
}}delete SC.View.views[this.get("layerId")];delete this._CQ;delete this.page;return this
},createChildViews:function(){var k=this.get("childViews"),e=k.length,d,j,h,g;this.beginPropertyChanges();
for(d=0;d<e;++d){if(j=(g=k[d])){if(typeof j===SC.T_STRING){g=this[j]}else{j=null}if(!g){console.error("No view with name "+j+" has been found in "+this.toString());
continue}if(g.isClass){g=this.createChildView(g);if(j){this[j]=g}}}k[d]=g}this.endPropertyChanges();
return this},createChildView:function(d,e){if(!e){e={}}e.owner=e.parentView=this;
e.isVisibleInWindow=this.get("isVisibleInWindow");if(!e.page){e.page=this.page}d=d.create(e);
return d},adjust:function(d,h){var e=SC.clone(this.get("layout")),g=NO,k;if(d===undefined){return this
}if(SC.typeOf(d)===SC.T_STRING){k=e[d];if(SC.none(h)){if(k!==undefined){g=YES}delete e[d]
}else{if(k!==h){g=YES}e[d]=h}}else{var j=d;for(d in j){if(!j.hasOwnProperty(d)){continue
}h=j[d];k=e[d];if(h===null){if(k!==undefined){g=YES}delete e[d]}else{if(h!==undefined){if(k!==h){g=YES
}e[d]=h}}}}if(g){this.set("layout",e)}return this},layout:{top:0,left:0,bottom:0,right:0},convertFrameToView:function(m,h){var g=0,e=0,k=0,j=0,d=this,l;
if(this.get("useStaticLayout")){throw"convertFrameToView is not available with static layout"
}while(d){l=d.get("frame");g+=l.x;e+=l.y;d=d.get("layoutView")}if(h){d=h;while(d){l=d.get("frame");
k+=l.x;j+=l.y;d=d.get("layoutView")}}g=m.x+g-k;e=m.y+e-j;return{x:g,y:e,width:m.width,height:m.height}
},convertFrameFromView:function(m,h){var g=0,e=0,k=0,j=0,d=this,l;if(this.get("useStaticLayout")){throw"convertFrameToView is not available with static layout"
}while(d&&d.get("frame")){l=d.get("frame");g+=l.x;e+=l.y;d=d.get("parentView")}if(h){d=h;
while(d){l=d.get("frame");k+=l.x;j+=l.y;d=d.get("parentView")}}g=m.x-g+k;e=m.y-e+j;
return{x:g,y:e,width:m.width,height:m.height}},scrollToVisible:function(){var d=this.get("parentView");
while(d&&!d.get("isScrollable")){d=d.get("parentView")}if(d){d.scrollToVisible();
return d.scrollToVisible(this)}else{return NO}},frame:function(){return this.computeFrameWithParentFrame(null)
}.property("layout","useStaticLayout").cacheable(),computeFrameWithParentFrame:function(l){var A=this.get("layout"),z={},x,D,u=SC.LAYOUT_AUTO,y=this.get("useStaticLayout"),s=this.get("parentView"),m,h,p,e,d=A.right,g=A.left,C=A.top,k=A.bottom,B=A.width,j=A.height,o=A.centerX,n=A.centerY;
if(B!==undefined&&B===SC.LAYOUT_AUTO&&y!==undefined&&!y){x=SC.Error.desc(("%@.layout() cannot use width:auto if staticLayout is disabled").fmt(this),"%@".fmt(this),-1);
console.error(x.toString());throw x}if(j!==undefined&&j===SC.LAYOUT_AUTO&&y!==undefined&&!y){x=SC.Error.desc(("%@.layout() cannot use height:auto if staticLayout is disabled").fmt(this),"%@".fmt(this),-1);
console.error(x.toString());throw x}if(y){if(D=this.get("layer")){z=SC.viewportOffset(D);
z.width=D.offsetWidth;z.height=D.offsetHeight;return z}return null}if(!l){l=this.computeParentDimensions(A)
}m=l.height;h=l.width;if(!SC.none(g)){if(SC.isPercentage(g)){z.x=h*g}else{z.x=g}if(B!==undefined){if(B===u){z.width=u
}else{if(SC.isPercentage(B)){z.width=h*B}else{z.width=B}}}else{z.width=h-z.x;if(d&&SC.isPercentage(d)){z.width=z.width-(d*h)
}else{z.width=z.width-(d||0)}}}else{if(!SC.none(d)){if(SC.none(B)){if(SC.isPercentage(g)){z.width=h-(h*d)
}else{z.width=h-d}z.x=0}else{if(B===u){z.width=u}else{if(SC.isPercentage(B)){z.width=h*B
}else{z.width=(B||0)}}if(SC.isPercentage(B)){z.x=h-(d*h)-z.width}else{z.x=h-d-z.width
}}}else{if(!SC.none(o)){if(B===u){z.width=u}else{if(SC.isPercentage(B)){z.width=B*h
}else{z.width=(B||0)}}if(SC.isPercentage(o)){z.x=(h-z.width)/2+(o*h)}else{z.x=(h-z.width)/2+o
}}else{z.x=0;if(SC.none(B)){z.width=h}else{if(B===u){z.width=u}if(SC.isPercentage(B)){z.width=B*h
}else{z.width=(B||0)}}}}}if(!SC.none(C)){if(SC.isPercentage(C)){z.y=C*m}else{z.y=C
}if(j!==undefined){if(j===u){z.height=u}else{if(SC.isPercentage(j)){z.height=j*m}else{z.height=j
}}}else{if(k&&SC.isPercentage(k)){z.height=m-z.y-(k*m)}else{z.height=m-z.y-(k||0)
}}}else{if(!SC.none(k)){if(SC.none(j)){if(SC.isPercentage(k)){z.height=m-(k*m)}else{z.height=m-k
}z.y=0}else{if(j===u){z.height=u}if(j&&SC.isPercentage(j)){z.height=j*m}else{z.height=(j||0)
}if(SC.isPercentage(k)){z.y=m-(k*m)-z.height}else{z.y=m-k-z.height}}}else{if(!SC.none(n)){if(j===u){z.height=u
}if(j&&SC.isPercentage(j)){z.height=j*m}else{z.height=(j||0)}if(SC.isPercentage(n)){z.y=(m-z.height)/2+(n*m)
}else{z.y=(m-z.height)/2+n}}else{z.y=0;if(SC.none(j)){z.height=m}else{if(j===u){z.height=u
}if(SC.isPercentage(j)){z.height=j*m}else{z.height=j||0}}}}}z.x=Math.floor(z.x);z.y=Math.floor(z.y);
if(z.height!==u){z.height=Math.floor(z.height)}if(z.width!==u){z.width=Math.floor(z.width)
}if(z.height===u||z.width===u){D=this.get("layer");if(z.height===u){z.height=D?D.clientHeight:0
}if(z.width===u){z.width=D?D.clientWidth:0}}if(this.get("hasBorder")){p=this.get("borderTop");
e=this.get("borderLeft");z.height-=p+this.get("borderBottom");z.y+=p;z.width-=e+this.get("borderRight");
z.x+=e}if(s&&s.isScrollContainer){s=s.get("parentView");z.x-=s.get("horizontalScrollOffset");
z.y-=s.get("verticalScrollOffset")}if(!SC.none(A.maxHeight)&&(z.height>A.maxHeight)){z.height=A.maxHeight
}if(!SC.none(A.minHeight)&&(z.height<A.minHeight)){z.height=A.minHeight}if(!SC.none(A.maxWidth)&&(z.width>A.maxWidth)){z.width=A.maxWidth
}if(!SC.none(A.minWidth)&&(z.width<A.minWidth)){z.width=A.minWidth}if(z.height<0){z.height=0
}if(z.width<0){z.width=0}return z},computeParentDimensions:function(j){var e,g=this.get("parentView"),d=(g)?g.get("frame"):null;
if(d){e={width:d.width,height:d.height}}else{var h=j;e={width:(h.left||0)+(h.width||0)+(h.right||0),height:(h.top||0)+(h.height||0)+(h.bottom||0)}
}return e},clippingFrame:function(){var e=this.get("parentView"),h=this.get("frame"),d=h,g;
if(e){g=e.get("contentClippingFrame");d=SC.intersectRects(g,h)}d.x-=h.x;d.y-=h.y;
return d}.property("parentView","frame").cacheable(),contentClippingFrame:function(){return this.get("clippingFrame")
}.property("clippingFrame").cacheable(),_sc_view_clippingFrameDidChange:function(){var h=this.get("childViews"),e=h.length,d,g;
for(d=0;d<e;++d){g=h[d];if(!g.hasStaticLayout){g.notifyPropertyChange("clippingFrame")
}}}.observes("clippingFrame"),parentViewDidResize:function(){var d=this.get("layout"),g,e;
e=((d.left!==undefined)&&(d.top!==undefined)&&(d.width!==undefined)&&(d.height!==undefined));
g=(SC.isPercentage(d.left)||SC.isPercentage(d.top)||SC.isPercentage(d.width)||SC.isPercentage(d.right)||SC.isPercentage(d.centerX)||SC.isPercentage(d.centerY));
if(!e||g){this.notifyPropertyChange("frame");this.viewDidResize()}},viewDidResize:function(){var h=this.childViews,e=h.length,d,g;
for(d=0;d<e;++d){g=h[d];if(g.parentViewDidResize){g.parentViewDidResize()}}}.observes("layout"),beginLiveResize:function(){if(this.willBeginLiveResize){this.willBeginLiveResize()
}var h=this.get("childViews"),e=h.length,d,g;for(d=0;d<e;++d){g=h[d];if(g.beginLiveResize){g.beginLiveResize()
}}return this},endLiveResize:function(){var h=this.get("childViews"),e=h.length,d,g;
for(d=e-1;d>=0;--d){g=h[d];if(g.endLiveResize){g.endLiveResize()}}if(this.didEndLiveResize){this.didEndLiveResize()
}return this},layoutStyle:function(){var B=this.get("layout"),E={},m=null,z,s=SC.LAYOUT_AUTO,u=SC._VIEW_DEFAULT_DIMS,l=u.length,n,y,F,A=this.get("useStaticLayout"),d=B.right,g=B.left,D=B.top,j=B.bottom,C=B.width,h=B.height,e=B.maxWidth,k=B.maxHeight,p=B.centerX,o=B.centerY;
if(C!==undefined&&C===SC.LAYOUT_AUTO&&!A){z=SC.Error.desc("%@.layout() you cannot use width:auto if "+"staticLayout is disabled".fmt(this),"%@".fmt(this),-1);
console.error(z.toString());throw z}if(h!==undefined&&h===SC.LAYOUT_AUTO&&!A){z=SC.Error.desc("%@.layout() you cannot use height:auto if "+"staticLayout is disabled".fmt(this),"%@".fmt(this),-1);
console.error(z.toString());throw z}if(!SC.none(g)){if(SC.isPercentage(g)){E.left=(g*100)+"%"
}else{E.left=Math.floor(g)}E.marginLeft=0;if(C!==undefined){if(C===SC.LAYOUT_AUTO){E.width=SC.LAYOUT_AUTO
}else{if(SC.isPercentage(C)){E.width=(C*100)+"%"}else{E.width=Math.floor(C)}}E.right=null
}else{E.width=null;if(d&&SC.isPercentage(d)){E.right=(d*100)+"%"}else{E.right=Math.floor(d||0)
}}}else{if(!SC.none(d)){if(SC.isPercentage(d)){E.right=Math.floor(d*100)+"%"}else{E.right=Math.floor(d)
}E.marginLeft=0;if(SC.none(C)){if(SC.none(e)){E.left=0}E.width=null}else{E.left=null;
if(C===SC.LAYOUT_AUTO){E.width=SC.LAYOUT_AUTO}else{if(C&&SC.isPercentage(C)){E.width=(C*100)+"%"
}else{E.width=Math.floor(C||0)}}}}else{if(!SC.none(p)){E.left="50%";if(C&&SC.isPercentage(C)){E.width=(C*100)+"%"
}else{E.width=Math.floor(C||0)}if(C&&SC.isPercentage(C)&&(SC.isPercentage(p)||SC.isPercentage(p*-1))){E.marginLeft=Math.floor((p-C/2)*100)+"%"
}else{if(C&&C>=1&&!SC.isPercentage(p)){E.marginLeft=Math.floor(p-E.width/2)}else{console.warn("You have to set width and centerX usign both percentages or pixels");
E.marginLeft="50%"}}E.right=null}else{if(!SC.none(C)){E.left=0;E.right=null;if(C===SC.LAYOUT_AUTO){E.width=SC.LAYOUT_AUTO
}else{if(SC.isPercentage(C)){E.width=(C*100)+"%"}else{E.width=Math.floor(C)}}E.marginLeft=0
}else{E.left=0;E.right=0;E.width=null;E.marginLeft=0}}}}E.minWidth=(B.minWidth===undefined)?null:B.minWidth;
E.maxWidth=(B.maxWidth===undefined)?null:B.maxWidth;if(!SC.none(D)){if(SC.isPercentage(D)){E.top=(D*100)+"%"
}else{E.top=Math.floor(D)}if(h!==undefined){if(h===SC.LAYOUT_AUTO){E.height=SC.LAYOUT_AUTO
}else{if(SC.isPercentage(h)){E.height=(h*100)+"%"}else{E.height=Math.floor(h)}}E.bottom=null
}else{E.height=null;if(j&&SC.isPercentage(j)){E.bottom=(j*100)+"%"}else{E.bottom=Math.floor(j||0)
}}E.marginTop=0}else{if(!SC.none(j)){E.marginTop=0;if(SC.isPercentage(j)){E.bottom=(j*100)+"%"
}else{E.bottom=Math.floor(j)}if(SC.none(h)){if(SC.none(k)){E.top=0}E.height=null}else{E.top=null;
if(h===SC.LAYOUT_AUTO){E.height=SC.LAYOUT_AUTO}else{if(h&&SC.isPercentage(h)){E.height=(h*100)+"%"
}else{E.height=Math.floor(h||0)}}}}else{if(!SC.none(o)){E.top="50%";E.bottom=null;
if(h&&SC.isPercentage(h)){E.height=(h*100)+"%"}else{E.height=Math.floor(h||0)}if(h&&SC.isPercentage(h)&&(SC.isPercentage(o)||SC.isPercentage(o*-1))){E.marginTop=Math.floor((o-h/2)*100)+"%"
}else{if(h&&h>=1&&!SC.isPercentage(o)){E.marginTop=Math.floor(o-E.height/2)}else{console.warn("You have to set height and centerY to use both percentages or pixels");
E.marginTop="50%"}}}else{if(!SC.none(h)){E.top=0;E.bottom=null;if(h===SC.LAYOUT_AUTO){E.height=SC.LAYOUT_AUTO
}else{if(h&&SC.isPercentage(h)){E.height=(h*100)+"%"}else{E.height=Math.floor(h||0)
}}E.marginTop=0}else{E.top=0;E.bottom=0;E.height=null;E.marginTop=0}}}}E.minHeight=(B.minHeight===undefined)?null:B.minHeight;
E.maxHeight=(B.maxHeight===undefined)?null:B.maxHeight;E.zIndex=SC.none(B.zIndex)?null:B.zIndex.toString();
E.backgroundPosition=SC.none(B.backgroundPosition)?null:B.backgroundPosition.toString();
while(--l>=0){n=u[l];if(E[n]===0){E[n]=null}}for(F in E){y=E[F];if(typeof y===SC.T_NUMBER){E[F]=(y+"px")
}}return E}.property().cacheable(),layoutView:function(){return this.get("parentView")
}.property("parentView").cacheable(),layoutDidChange:function(){this.beginPropertyChanges();
if(this.frame){this.notifyPropertyChange("frame")}this.notifyPropertyChange("layoutStyle");
this.endPropertyChanges();var d=this.get("layoutView");if(d){d.set("childViewsNeedLayout",YES);
d.layoutDidChangeFor(this);if(d.get("childViewsNeedLayout")){d.invokeOnce(d.layoutChildViewsIfNeeded)
}}return this}.observes("layout"),childViewsNeedLayout:NO,layoutDidChangeFor:function(e){var d=this._needLayoutViews;
if(!d){d=this._needLayoutViews=SC.CoreSet.create()}d.add(e)},layoutChildViewsIfNeeded:function(d){if(!d){d=this.get("isVisibleInWindow")
}if(d&&this.get("childViewsNeedLayout")){this.set("childViewsNeedLayout",NO);this.layoutChildViews()
}return this},layoutChildViews:function(){var g=this._needLayoutViews,d=g?g.length:0,e;
for(e=0;e<d;++e){g[e].updateLayout()}g.clear()},updateLayout:function(){var e=this.get("layer"),d;
if(e){d=this.renderContext(e);this.renderLayout(d);d.update()}e=null;return this},renderLayout:function(d,e){d.addStyle(this.get("layoutStyle"))
},isView:YES,selectStart:function(d){return this.get("isTextSelectable")},contextMenu:function(d){if(!this.get("isContextMenuEnabled")){d.stop()
}return true}});SC.View.mixin({isViewClass:YES,design:function(){if(this.isDesign){return this
}var d=this.extend.apply(this,arguments);d.isDesign=YES;if(SC.ViewDesigner){SC.ViewDesigner.didLoadDesign(d,this,SC.A(arguments))
}return d},layout:function(d){this.prototype.layout=d;return this},convertLayoutToAnchoredLayout:function(k,u){var m={top:0,left:0,width:u.width,height:u.height},h=u.width,p=u.height,s=k.right,d=k.left,o=k.top,l=k.bottom,n=k.width,j=k.height,g=k.centerX,e=k.centerY;
if(!SC.none(d)){if(SC.isPercentage(d)){m.left=d*h}else{m.left=d}if(n!==undefined){if(n===SC.LAYOUT_AUTO){m.width=SC.LAYOUT_AUTO
}else{if(SC.isPercentage(n)){m.width=n*h}else{m.width=n}}}else{if(s&&SC.isPercentage(s)){m.width=h-m.left-(s*h)
}else{m.width=h-m.left-(s||0)}}}else{if(!SC.none(s)){if(SC.none(n)){m.left=0;if(s&&SC.isPercentage(s)){m.width=h-(s*h)
}else{m.width=h-(s||0)}}else{if(n===SC.LAYOUT_AUTO){m.width=SC.LAYOUT_AUTO}else{if(SC.isPercentage(n)){m.width=n*h
}else{m.width=n}if(SC.isPercentage(s)){m.left=h-(m.width+s)}else{m.left=h-(m.width+s)
}}}}else{if(!SC.none(g)){if(n&&SC.isPercentage(n)){m.width=(n*h)}else{m.width=(n||0)
}m.left=((h-m.width)/2);if(SC.isPercentage(g)){m.left=m.left+g*h}else{m.left=m.left+g
}}else{if(!SC.none(n)){m.left=0;if(n===SC.LAYOUT_AUTO){m.width=SC.LAYOUT_AUTO}else{if(SC.isPercentage(n)){m.width=n*h
}else{m.width=n}}}else{m.left=0;m.width=0}}}}if(k.minWidth!==undefined){m.minWidth=k.minWidth
}if(k.maxWidth!==undefined){m.maxWidth=k.maxWidth}if(!SC.none(o)){if(SC.isPercentage(o)){m.top=o*p
}else{m.top=o}if(j!==undefined){if(j===SC.LAYOUT_AUTO){m.height=SC.LAYOUT_AUTO}else{if(SC.isPercentage(j)){m.height=j*p
}else{m.height=j}}}else{m.height=p-m.top;if(l&&SC.isPercentage(l)){m.height=m.height-(l*p)
}else{m.height=m.height-(l||0)}}}else{if(!SC.none(l)){if(SC.none(j)){m.top=0;if(l&&SC.isPercentage(l)){m.height=p-(l*p)
}else{m.height=p-(l||0)}}else{if(j===SC.LAYOUT_AUTO){m.height=SC.LAYOUT_AUTO}else{if(SC.isPercentage(j)){m.height=j*p
}else{m.height=j}m.top=p-m.height;if(SC.isPercentage(l)){m.top=m.top-(l*p)}else{m.top=m.top-l
}}}}else{if(!SC.none(e)){if(j&&SC.isPercentage(j)){m.height=(j*p)}else{m.height=(j||0)
}m.top=((p-m.height)/2);if(SC.isPercentage(e)){m.top=m.top+e*p}else{m.top=m.top+e
}}else{if(!SC.none(j)){m.top=0;if(j===SC.LAYOUT_AUTO){m.height=SC.LAYOUT_AUTO}else{if(SC.isPercentage(j)){m.height=j*p
}else{m.height=j}}}else{m.top=0;m.height=0}}}}if(m.top){m.top=Math.floor(m.top)}if(m.bottom){m.bottom=Math.floor(m.bottom)
}if(m.left){m.left=Math.floor(m.left)}if(m.right){m.right=Math.floor(m.right)}if(m.width!==SC.LAYOUT_AUTO){m.width=Math.floor(m.width)
}if(m.height!==SC.LAYOUT_AUTO){m.height=Math.floor(m.height)}if(k.minHeight!==undefined){m.minHeight=k.minHeight
}if(k.maxHeight!==undefined){m.maxHeight=k.maxHeight}return m},convertLayoutToCustomLayout:function(e,d,g){},classNames:function(d){d=(this.prototype.classNames||[]).concat(d);
this.prototype.classNames=d;return this},tagName:function(d){this.prototype.tagName=d;
return this},childView:function(d){var e=this.prototype.childViews||[];if(e===this.superclass.prototype.childViews){e=e.slice()
}e.push(d);this.prototype.childViews=e;return this},bind:function(e,h){var g=this.prototype,d=this.superclass.prototype;
var j=g._bindings;if(!j||j===d._bindings){j=g._bindings=(j||[]).slice()}e=e+"Binding";
g[e]=h;j.push(e);return this},prop:function(d,e){this.prototype[d]=e;return this},localization:function(e,d){if(d){e.rootElement=SC.$(d)[0]
}return e},viewFor:function(h,g){var e=SC.$A(arguments);if(SC.none(h)){e.shift()}else{e[0]={rootElement:SC.$(h)[0]}
}var d=this.create.apply(this,arguments);e=e[0]=null;return d},create:function(){var e=this,d=new e(arguments);
if(SC.ViewDesigner){SC.ViewDesigner.didCreateView(d,SC.$A(arguments))}return d},loc:function(j){var e=j.childViews;
delete j.childViews;this.applyLocalizedAttributes(j);if(SC.ViewDesigner){SC.ViewDesigner.didLoadLocalization(this,SC.$A(arguments))
}var h=this.prototype.childViews,d=h.length,g;while(--d>=0){g=h[d];j=e[d];if(j&&g&&g.loc){g.loc(j)
}}return this},applyLocalizedAttributes:function(d){SC.mixin(this.prototype,d)},views:{}});
SC.outlet=function(d){return function(e){return(this[e]=SC.objectForPropertyPath(d,this))
}.property()};SC.View.unload=function(){var d=SC.View.views;if(d){for(var e in d){if(!d.hasOwnProperty(e)){continue
}delete d[e]}}};SC.Event.add(window,"unload",SC.View,SC.View.unload);sc_require("views/controls");
sc_require("views/miniControls");SC.AudioView=SC.View.extend({classNames:"sc-audio-view",displayProperties:["value","shouldAutoResize"],audioObject:null,degradeList:["html5","quicktime","flash"],currentTime:0,duration:0,volume:0,paused:YES,loaded:NO,ended:NO,canPlay:NO,loadedTimeRanges:[],mediaControl:"mini",init:function(){var e=this.get("mediaControl");
if(e==="normal"){this.childViews="normal".w()}if(e==="mini"){this.childViews="mini".w()
}arguments.callee.base.apply(this,arguments);var d=this.get("childViews")[0];if(d){this.appendChild(d)
}},normal:SC.MediaControlsView.design({layout:{bottom:0,left:0,right:0,height:20},targetBinding:"*parentView"}),mini:SC.MiniMediaControlsView.design({layout:{bottom:0,left:0,right:0,height:20},targetBinding:"*parentView"}),time:function(){var g=this.get("currentTime"),d=this.get("duration");
var e=this._addZeros(Math.floor(g/60))+":"+this._addZeros(Math.floor(g%60))+"/"+this._addZeros(Math.floor(d/60))+":"+this._addZeros(Math.floor(d%60));
return e}.property("currentTime").cacheable(),render:function(g,d){var l,k,h,n,e=SC.guidFor(this);
if(d){for(l=0,h=this.degradeList.length;l<h;l++){switch(this.degradeList[l]){case"html5":if(SC.browser.safari){g.push('<audio src="'+this.get("value")+'" poster="'+this.poster+'"/>');
this.loaded="html5";return}break;case"quicktime":if(SC.browser.msie){g.push('<object id="qt_event_source" classid="clsid:CB927D12-4FF7-4a9e-A169-56E4B8A75598" codebase="http://www.apple.com/qtactivex/qtplugin.cab#version=7,2,1,0"> </object> ')
}g.push('<object width="100%" height="100%"');if(SC.browser.msie){g.push('style="behavior:url(#qt_event_source);"')
}g.push('classid="clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B" id="qt_'+e+'" codebase="http://www.apple.com/qtactivex/qtplugin.cab"><param name="src" value="'+this.get("value")+'"/><param name="autoplay" value="false"/><param name="loop" value="false"/><param name="controller" value="false"/><param name="postdomevents" value="true"/><param name="kioskmode" value="true"/><param name="bgcolor" value="000000"/><param name="scale" value="aspect"/><embed width="100%" height="100%" name="qt_'+e+'" src="'+this.get("value")+'" autostart="false" EnableJavaScript="true" postdomevents="true" kioskmode="true" controller="false" bgcolor="000000"scale="aspect" pluginspage="www.apple.com/quicktime/download"></embed></object></object>');
this.loaded="quicktime";return;case"flash":var m="";var o=this.get("value");if(o.indexOf("http:")==-1){o=location.protocol+"//"+location.host+o
}if(o.indexOf("?")!=-1){o=o.substring(0,o.indexOf("?"))}o=encodeURI(o);g.push('<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=8,0,0,0" width="100%" height="100%" id="flash_'+e+'" align="middle"><param name="allowScriptAccess" value="sameDomain" /><param name="allowFullScreen" value="true" /><param name="movie" value="'+m+"&src="+o+"&scid="+e+'" /><param name="quality" value="autohigh" /><param name="scale" value="default" /><param name="wmode" value="transparent" /><param name="menu" value="false" /><param name="bgcolor" value="#000000" />	<embed src="'+m+"&src="+o+"&scid="+e+'" quality="autohigh" scale="default" wmode="transparent" bgcolor="#000000" width="100%" height="100%" name="flash_'+e+'" align="middle" allowScriptAccess="sameDomain" allowFullScreen="true" menu="false" type="application/x-shockwave-flash" pluginspage="http://www.adobe.com/go/getflashplayer" /></object>');
this.loaded="flash";SC.AudioView.addToAudioFlashViews(this);return;default:g.push("audio is not supported by your browser");
return}}}},didCreateLayer:function(){if(this.loaded==="html5"){this.addAudioDOMEvents()
}if(this.loaded==="quicktime"){this.addQTDOMEvents()}},didAppendToDocument:function(){if(this.loaded==="quicktime"){this.addQTDOMEvents()
}},addAudioDOMEvents:function(){var e,d=this;e=this.$("audio")[0];this.set("audioObject",e);
SC.Event.add(e,"durationchange",this,function(){SC.RunLoop.begin();d.set("duration",e.duration);
SC.RunLoop.end()});SC.Event.add(e,"timeupdate",this,function(){SC.RunLoop.begin();
d.set("currentTime",e.currentTime);SC.RunLoop.end()});SC.Event.add(e,"loadstart",this,function(){SC.RunLoop.begin();
d.set("volume",e.volume);SC.RunLoop.end()});SC.Event.add(e,"play",this,function(){SC.RunLoop.begin();
d.set("paused",NO);SC.RunLoop.end()});SC.Event.add(e,"pause",this,function(){SC.RunLoop.begin();
d.set("paused",YES);SC.RunLoop.end()});SC.Event.add(e,"loadedmetadata",this,function(){SC.RunLoop.begin();
SC.RunLoop.end()});SC.Event.add(e,"canplay",this,function(){SC.RunLoop.begin();d.set("canPlay",YES);
SC.RunLoop.end()});SC.Event.add(e,"ended",this,function(){SC.RunLoop.begin();d.set("ended",YES);
SC.RunLoop.end()});SC.Event.add(e,"progress",this,function(n){SC.RunLoop.begin();
this.loadedTimeRanges=[];for(var h=0,m=e.seekable.length;h<m;h++){this.loadedTimeRanges.push(e.seekable.start(h));
this.loadedTimeRanges.push(e.seekable.end(h))}try{var g=d.GetTrackCount(),k;for(k=1;
k<=g;k++){if("Closed Caption"===this.GetTrackType(k)){d._closedCaptionTrackIndex=k
}}}catch(l){}SC.RunLoop.end()})},addQTDOMEvents:function(){var d=this._getAudioObject(),h=this.$()[0],g=this,j;
try{d.GetVolume()}catch(k){console.log("loaded fail trying later");this.invokeLater(this.didAppendToDocument,100);
return}this.set("audioObject",d);g.set("duration",d.GetDuration()/d.GetTimeScale());
g.set("volume",d.GetVolume()/256);j=d.GetRectangle().split(",");SC.Event.add(h,"qt_durationchange",this,function(){SC.RunLoop.begin();
g.set("duration",d.GetDuration()/d.GetTimeScale());SC.RunLoop.end()});SC.Event.add(h,"qt_begin",this,function(){SC.RunLoop.begin();
g.set("volume",d.GetVolume()/256);SC.RunLoop.end()});SC.Event.add(h,"qt_loadedmetadata",this,function(){SC.RunLoop.begin();
g.set("duration",d.GetDuration()/d.GetTimeScale());SC.RunLoop.end()});SC.Event.add(h,"qt_canplay",this,function(){SC.RunLoop.begin();
g.set("canPlay",YES);SC.RunLoop.end()});SC.Event.add(h,"qt_ended",this,function(){g.set("ended",YES)
});SC.Event.add(h,"qt_pause",this,function(){SC.RunLoop.begin();g.set("currentTime",d.GetTime()/d.GetTimeScale());
g.set("paused",YES)});SC.Event.add(h,"qt_play",this,function(){SC.RunLoop.begin();
g.set("currentTime",d.GetTime()/d.GetTimeScale());g.set("paused",NO)})},qtTimer:function(){if(this.loaded==="quicktime"&&!this.get("paused")){this.incrementProperty("currentTime");
this.invokeLater(this._qtTimer,1000)}}.observes("paused"),seek:function(){var h,e,g,d=this._getAudioObject();
if(this.loaded==="html5"){if(this.get("paused")){d.currentTime=this.get("currentTime")
}}if(this.loaded==="quicktime"){if(this.get("paused")){d.SetTime(this.get("currentTime")*d.GetTimeScale())
}}if(this.loaded==="flash"){if(this.get("paused")){d.setTime(this.get("currentTime"))
}}}.observes("currentTime"),startSeek:function(){if(!this.get("paused")){console.log("startseetk");
this.stop();this._wasPlaying=true}},endSeek:function(){if(this._wasPlaying){console.log("startseetk");
this.play();this._wasPlaying=false}},setVolume:function(){var d=this._getAudioObject();
if(this.loaded==="html5"){d.volume=this.get("volume")}if(this.loaded==="quicktime"){d.SetVolume(this.get("volume")*256)
}if(this.loaded==="flash"){d.setVolume(this.get("volume"))}}.observes("volume"),play:function(){var d=this._getAudioObject();
if(this.loaded==="html5"){d.play()}if(this.loaded==="quicktime"){d.Play()}if(this.loaded==="flash"){d.playVideo()
}this.set("paused",NO)},stop:function(){var d=this._getAudioObject();if(this.loaded==="html5"){d.pause()
}if(this.loaded==="quicktime"){d.Stop()}if(this.loaded==="flash"){d.pauseVideo()}this.set("paused",YES)
},playPause:function(){if(this.get("paused")){this.play()}else{this.stop()}},closedCaption:function(){if(this.loaded==="html5"){try{if(this.get("captionsEnabled")){if(this._closedCaptionTrackIndex){this.SetTrackEnabled(this._closedCaptionTrackIndex,true);
this.set("captionsEnabled",YES)}}else{this.SetTrackEnabled(this._closedCaptionTrackIndex,false);
this.set("captionsEnabled",NO)}}catch(d){}}return},_getAudioObject:function(){if(this.loaded==="html5"){return this.get("audioObject")
}if(this.loaded==="quicktime"){return document["qt_"+SC.guidFor(this)]}if(this.loaded==="flash"){var d="flash_"+SC.guidFor(this);
if(window.document[d]){return window.document[d]}if(navigator.appName.indexOf("Microsoft Internet")==-1){if(document.embeds&&document.embeds[d]){return document.embeds[d]
}}else{return document.getElementById(d)}}},_addZeros:function(d){if(d.toString().length<2){return"0"+d
}return d}});SC.AudioView.flashViews={};SC.AudioView.addToAudioFlashViews=function(d){SC.AudioView.flashViews[SC.guidFor(d)]=d
};SC.AudioView.updateProperty=function(e,h,g){var d=SC.AudioView.flashViews[e];if(d){SC.RunLoop.begin();
d.set(h,g);SC.RunLoop.end()}};SC.AudioView.logFlash=function(d){console.log("FLASHLOG: "+d)
};sc_require("views/mediaSlider");SC.MediaControlsView=SC.View.extend({target:null,childViews:"playButton progressView timeView minusLabelView volumeView plusLabelView theaterButton".w(),classNames:"sc-media-controls",playObserver:function(){if(this.getPath("target.paused")){this.get("playButton").set("icon","play")
}else{this.get("playButton").set("icon","stop")}}.observes("*target.paused"),playButton:SC.ButtonView.design({title:"",titleMinWidth:35,icon:"play",noStyle:YES,layout:{top:0,left:0,width:20,height:20},action:"playPause",targetBinding:"*owner.target",renderStyle:"renderImage",theme:""}),progressView:SC.mediaSlider.design({layout:{top:0,left:20,right:220,height:20},value:0,minimum:0,step:0.1,valueBinding:"*owner.target.currentTime",maximumBinding:"*owner.target.duration",mediaViewBinding:"*owner.target"}),timeView:SC.LabelView.design({layout:{top:0,right:160,width:60,height:20},classNames:"time",textAlign:SC.ALIGN_CENTER,valueBinding:"*owner.target.time"}),theaterButton:SC.ButtonView.design({title:"",icon:"theater",renderStyle:"renderImage",theme:"",titleMinWidth:35,layout:{top:0,right:140,width:20,height:20},action:"fullScreen",targetBinding:"*owner.target"}),minusLabelView:SC.LabelView.design({layout:{top:0,right:120,width:20,height:20},value:"",icon:"minus"}),volumeView:SC.SliderView.design({layout:{top:0,right:20,width:100,height:20},value:0,valueBinding:"*owner.target.volume",minimum:0,maximum:1,step:0.01}),plusLabelView:SC.LabelView.design({layout:{top:0,right:0,width:20,height:20},value:"",icon:"plus"})});
SC.mediaSlider=SC.SliderView.extend({mediaView:null,mouseDown:function(d){var e=this.get("mediaView");
if(e){e.startSeek()}return arguments.callee.base.apply(this,arguments)},mouseUp:function(d){var e=this.get("mediaView");
if(e){e.endSeek()}return arguments.callee.base.apply(this,arguments)}});sc_require("views/mediaSlider");
SC.MiniMediaControlsView=SC.View.extend({target:null,childViews:"playButton timeView minusLabelView volumeView".w(),classNames:"sc-media-controls",playObserver:function(){if(this.getPath("target.paused")){this.get("playButton").set("icon","play")
}else{this.get("playButton").set("icon","stop")}}.observes("*target.paused"),playButton:SC.ButtonView.design({title:"",titleMinWidth:35,icon:"play",noStyle:YES,layout:{top:0,left:0,width:20,height:20},action:"playPause",targetBinding:"*owner.target",renderStyle:"renderImage",theme:""}),timeView:SC.LabelView.design({layout:{top:0,left:20,width:60,height:20},classNames:"time",textAlign:SC.ALIGN_CENTER,valueBinding:"*owner.target.time"}),minusLabelView:SC.LabelView.design({layout:{top:0,left:80,width:20,height:20},value:"",icon:"minus"}),volumeView:SC.SliderView.design({layout:{top:0,left:100,width:100,height:20},value:0,valueBinding:"*owner.target.volume",minimum:0,maximum:1,step:0.01})});
sc_require("views/controls");sc_require("views/miniControls");SC.VideoView=SC.View.extend({classNames:"sc-video-view",displayProperties:["value","shouldAutoResize"],videoObject:null,degradeList:["html5","quicktime","flash"],currentTime:0,duration:0,volume:0,paused:YES,loaded:NO,ended:NO,canPlay:NO,videoWidth:0,videoHeight:0,captionsEnabled:NO,loadedTimeRanges:[],poster:null,mediaControl:"normal",init:function(){var e=this.get("mediaControl");
if(e==="normal"){this.childViews="normal".w()}if(e==="mini"){this.childViews="mini".w()
}arguments.callee.base.apply(this,arguments);var d=this.get("childViews")[0];if(d){this.appendChild(d)
}},normal:SC.MediaControlsView.design({layout:{bottom:0,left:0,right:0,height:20},targetBinding:"*parentView"}),mini:SC.MiniMediaControlsView.design({layout:{bottom:0,left:0,right:0,height:20},targetBinding:"*parentView"}),time:function(){var g=this.get("currentTime"),d=this.get("duration");
var e=this._addZeros(Math.floor(g/60))+":"+this._addZeros(Math.floor(g%60))+"/"+this._addZeros(Math.floor(d/60))+":"+this._addZeros(Math.floor(d%60));
return e}.property("currentTime").cacheable(),render:function(g,d){var l,k,h,n,e=SC.guidFor(this);
if(d){for(l=0,h=this.degradeList.length;l<h;l++){switch(this.degradeList[l]){case"html5":if(SC.browser.safari){g.push('<video src="'+this.get("value")+'"');
if(this.poster){g.push(' poster="'+this.poster+'"')}g.push("/>");this.loaded="html5";
return}break;case"quicktime":if(SC.browser.msie){g.push('<object id="qt_event_source" classid="clsid:CB927D12-4FF7-4a9e-A169-56E4B8A75598" codebase="http://www.apple.com/qtactivex/qtplugin.cab#version=7,2,1,0"> </object> ')
}g.push('<object width="100%" height="100%"');if(SC.browser.msie){g.push('style="behavior:url(#qt_event_source);"')
}g.push('classid="clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B" id="qt_'+e+'" codebase="http://www.apple.com/qtactivex/qtplugin.cab"><param name="src" value="'+this.get("value")+'"/><param name="autoplay" value="false"/><param name="loop" value="false"/><param name="controller" value="false"/><param name="postdomevents" value="true"/><param name="kioskmode" value="true"/><param name="bgcolor" value="000000"/><param name="scale" value="aspect"/><embed width="100%" height="100%" name="qt_'+e+'" src="'+this.get("value")+'" autostart="false" EnableJavaScript="true" postdomevents="true" kioskmode="true" controller="false" bgcolor="000000"scale="aspect" pluginspage="www.apple.com/quicktime/download"></embed></object></object>');
this.loaded="quicktime";return;case"flash":var m="";var o=this.get("value");if(o.indexOf("http:")==-1){o=location.protocol+"//"+location.host+o
}if(o.indexOf("?")!=-1){o=o.substring(0,o.indexOf("?"))}o=encodeURI(o);g.push('<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=8,0,0,0" width="100%" height="100%" id="flash_'+e+'" align="middle"><param name="allowScriptAccess" value="sameDomain" /><param name="allowFullScreen" value="true" /><param name="movie" value="'+m+"&src="+o+"&scid="+e+'" /><param name="quality" value="autohigh" /><param name="scale" value="default" /><param name="wmode" value="transparent" /><param name="menu" value="false" /><param name="bgcolor" value="#000000" />	<embed src="'+m+"&src="+o+"&scid="+e+'" quality="autohigh" scale="default" wmode="transparent" bgcolor="#000000" width="100%" height="100%" name="flash_'+e+'" align="middle" allowScriptAccess="sameDomain" allowFullScreen="true" menu="false" type="application/x-shockwave-flash" pluginspage="http://www.adobe.com/go/getflashplayer" /></object>');
this.loaded="flash";SC.VideoView.addToVideoFlashViews(this);return;default:g.push("video is not supported by your browser");
return}}}},frameDidChange:function(){if(this.loaded==="html5"){var d=this.get("frame"),e=this.$("video");
e.attr("width",d.width);e.attr("height",d.height)}}.observes("frame"),didCreateLayer:function(){if(this.loaded==="html5"){this.addVideoDOMEvents()
}if(this.loaded==="quicktime"){this.addQTDOMEvents()}},didAppendToDocument:function(){if(this.loaded==="quicktime"){this.addQTDOMEvents()
}},addVideoDOMEvents:function(){var e,d=this;e=this.$("video")[0];this.set("videoObject",e);
SC.Event.add(e,"durationchange",this,function(){SC.RunLoop.begin();d.set("duration",e.duration);
SC.RunLoop.end()});SC.Event.add(e,"timeupdate",this,function(){SC.RunLoop.begin();
d.set("currentTime",e.currentTime);SC.RunLoop.end()});SC.Event.add(e,"loadstart",this,function(){SC.RunLoop.begin();
d.set("volume",e.volume);SC.RunLoop.end()});SC.Event.add(e,"play",this,function(){SC.RunLoop.begin();
d.set("paused",NO);SC.RunLoop.end()});SC.Event.add(e,"pause",this,function(){SC.RunLoop.begin();
d.set("paused",YES);SC.RunLoop.end()});SC.Event.add(e,"loadedmetadata",this,function(){SC.RunLoop.begin();
d.set("videoWidth",e.videoWidth);d.set("videoHeight",e.videoHeight);SC.RunLoop.end()
});SC.Event.add(e,"canplay",this,function(){SC.RunLoop.begin();d.set("canPlay",YES);
SC.RunLoop.end()});SC.Event.add(e,"ended",this,function(){SC.RunLoop.begin();d.set("ended",YES);
SC.RunLoop.end()});SC.Event.add(e,"progress",this,function(n){SC.RunLoop.begin();
this.loadedTimeRanges=[];for(var h=0,m=e.seekable.length;h<m;h++){this.loadedTimeRanges.push(e.seekable.start(h));
this.loadedTimeRanges.push(e.seekable.end(h))}try{var g=d.GetTrackCount(),k;for(k=1;
k<=g;k++){if("Closed Caption"===this.GetTrackType(k)){d._closedCaptionTrackIndex=k
}}}catch(l){}SC.RunLoop.end()})},addQTDOMEvents:function(){var d=this._getVideoObject(),j=this.$()[0],g=this,h;
try{d.GetVolume()}catch(k){console.log("loaded fail trying later");this.invokeLater(this.didAppendToDocument,100);
return}this.set("videoObject",d);g.set("duration",d.GetDuration()/d.GetTimeScale());
g.set("volume",d.GetVolume()/256);h=d.GetRectangle().split(",");g.set("videoWidth",h[2]);
g.set("videoHeight",h[3]);SC.Event.add(j,"qt_durationchange",this,function(){SC.RunLoop.begin();
g.set("duration",d.GetDuration()/d.GetTimeScale());SC.RunLoop.end()});SC.Event.add(j,"qt_begin",this,function(){SC.RunLoop.begin();
g.set("volume",d.GetVolume()/256);SC.RunLoop.end()});SC.Event.add(j,"qt_loadedmetadata",this,function(){SC.RunLoop.begin();
g.set("duration",d.GetDuration()/d.GetTimeScale());var e=d.GetRectangle().split(",");
g.set("videoWidth",e[2]);g.set("videoHeight",e[3]);SC.RunLoop.end()});SC.Event.add(j,"qt_canplay",this,function(){SC.RunLoop.begin();
g.set("canPlay",YES);SC.RunLoop.end()});SC.Event.add(j,"qt_ended",this,function(){g.set("ended",YES)
});SC.Event.add(j,"qt_pause",this,function(){SC.RunLoop.begin();g.set("currentTime",d.GetTime()/d.GetTimeScale());
g.set("paused",YES)});SC.Event.add(j,"qt_play",this,function(){SC.RunLoop.begin();
g.set("currentTime",d.GetTime()/d.GetTimeScale());g.set("paused",NO)})},qtTimer:function(){if(this.loaded==="quicktime"&&!this.get("paused")){this.incrementProperty("currentTime");
this.invokeLater(this._qtTimer,1000)}}.observes("paused"),seek:function(){var h,e,g,d=this._getVideoObject();
if(this.loaded==="html5"){if(this.get("paused")){d.currentTime=this.get("currentTime")
}}if(this.loaded==="quicktime"){if(this.get("paused")){d.SetTime(this.get("currentTime")*d.GetTimeScale())
}}if(this.loaded==="flash"){if(this.get("paused")){d.setTime(this.get("currentTime"))
}}}.observes("currentTime"),startSeek:function(){if(!this.get("paused")){console.log("startseetk");
this.stop();this._wasPlaying=true}},endSeek:function(){if(this._wasPlaying){console.log("startseetk");
this.play();this._wasPlaying=false}},setVolume:function(){var d=this._getVideoObject();
if(this.loaded==="html5"){d.volume=this.get("volume")}if(this.loaded==="quicktime"){d.SetVolume(this.get("volume")*256)
}if(this.loaded==="flash"){d.setVolume(this.get("volume"))}}.observes("volume"),play:function(){var d=this._getVideoObject();
if(this.loaded==="html5"){d.play()}if(this.loaded==="quicktime"){d.Play()}if(this.loaded==="flash"){d.playVideo()
}this.set("paused",NO)},stop:function(){var d=this._getVideoObject();if(this.loaded==="html5"){d.pause()
}if(this.loaded==="quicktime"){d.Stop()}if(this.loaded==="flash"){d.pauseVideo()}this.set("paused",YES)
},playPause:function(){if(this.get("paused")){this.play()}else{this.stop()}},fullScreen:function(){var d=this._getVideoObject();
if(this.loaded==="html5"){this.$("video")[0].webkitEnterFullScreen()}if(this.loaded==="flash"){d.fullScreen()
}return},closedCaption:function(){if(this.loaded==="html5"){try{if(this.get("captionsEnabled")){if(this._closedCaptionTrackIndex){this.SetTrackEnabled(this._closedCaptionTrackIndex,true);
this.set("captionsEnabled",YES)}}else{this.SetTrackEnabled(this._closedCaptionTrackIndex,false);
this.set("captionsEnabled",NO)}}catch(d){}}return},_getVideoObject:function(){if(this.loaded==="html5"){return this.get("videoObject")
}if(this.loaded==="quicktime"){return document["qt_"+SC.guidFor(this)]}if(this.loaded==="flash"){var d="flash_"+SC.guidFor(this);
if(window.document[d]){return window.document[d]}if(navigator.appName.indexOf("Microsoft Internet")==-1){if(document.embeds&&document.embeds[d]){return document.embeds[d]
}}else{return document.getElementById(d)}}},_addZeros:function(d){if(d.toString().length<2){return"0"+d
}return d}});SC.VideoView.flashViews={};SC.VideoView.addToVideoFlashViews=function(d){SC.VideoView.flashViews[SC.guidFor(d)]=d
};SC.VideoView.updateProperty=function(e,h,g){var d=SC.VideoView.flashViews[e];if(d){SC.RunLoop.begin();
d.set(h,g);SC.RunLoop.end()}};SC.VideoView.logFlash=function(d){console.log("FLASHLOG: "+d)
};
/* @license
==========================================================================
SproutCore -- JavaScript Application Framework
copyright 2006-2008, Sprout Systems, Inc. and contributors.

Permission is hereby granted, free of charge, to any person obtaining a 
copy of this software and associated documentation files (the "Software"), 
to deal in the Software without restriction, including without limitation 
the rights to use, copy, modify, merge, publish, distribute, sublicense, 
and/or sell copies of the Software, and to permit persons to whom the 
Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in 
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR 
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, 
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE 
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER 
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING 
FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER 
DEALINGS IN THE SOFTWARE.

For more information about SproutCore, visit http://www.sproutcore.com


==========================================================================
@license */
SC.RootResponder=SC.RootResponder.extend({platform:"mobile",});
SC.ButtonView=SC.View.extend(SC.Control,SC.Button,{tagName:"a",classNames:["sc-button-view"],theme:"square",href:"",action:null,target:null,triggerAction:function(d){if(!this.get("isEnabled")){return false
}this.set("isActive",YES);this._action(d);this.invokeLater("set",200,"isActive",NO);
return true},_TEMPORARY_CLASS_HASH:{},displayProperties:"href icon title value".w(),render:function(g,k){if(this.get("tagName")==="a"){var d=this.get("href");
if(!d||(d.length===0)){d="javascript:;"}g.attr("href",d)}var e=this._TEMPORARY_CLASS_HASH,h=this.get("icon");
e.def=this.get("isDefault");e.cancel=this.get("isCancel");e.icon=!!h;var j=this.get("theme");
if(j){e[j]=YES}g.attr("role","button").setClass(e);if(!this._isTouchActive){g=g.begin("span").addClass("sc-button-inner");
this.renderTitle(g,k);g=g.end()}},_isTouchActive:NO,touchStart:function(d){if(!this.get("isEnabled")){return YES
}this.set("isActive",YES);this._isTouchActive=YES;return YES},touchExited:function(d){if(this._isTouchActive){this.set("isActive",NO)
}return YES},touchEntered:function(d){this.set("isActive",this._isTouchActive);return YES
},touchEnd:function(e){if(this._isTouchActive){this.set("isActive",NO)}this._isTouchActive=false;
var d,g,h,j;if(e.changedTouches.length>0){j=e.changedTouches[0];g={x:j.pageX,y:j.pageY};
h=this.convertFrameToView(this.get("frame"),null);d=SC.pointInRect(g,h)}else{d=YES
}if(!e.cancel&&d&&this.get("isEnabled")){this._action(e)}return true},_action:function(d){console.log("action!");
var g=this.get("action");var h=this.get("target")||null;var j=this.get("pane");var e=j?j.get("rootResponder"):null;
if(e){e.sendAction(g,h,this,j)}}});var require=require||function require(){};var sc_require=sc_require||require;
var sc_resource=sc_resource||function sc_resource(){};sc_require("license");var YES=true;
var NO=false;if(typeof console==="undefined"){window.console={};console.log=console.info=console.warn=console.error=function(){}
}var SC=SC||{};var SproutCore=SproutCore||SC;SC.mixin=function(){var j=arguments[0]||{},d=1,h=arguments.length,e,k,g;
if(h===1){j=this||{};d=0}for(;d<h;d++){if(!(e=arguments[d])){continue}for(g in e){if(!e.hasOwnProperty(g)){continue
}k=e[g];if(j===k){continue}if(k!==undefined){j[g]=k}}}return j};SC.supplement=function(){var j=arguments[0]||{};
var d=1;var h=arguments.length;var e;if(h===1){j=this||{};d=0}for(;d<h;d++){if(!(e=arguments[d])){continue
}for(var g in e){if(!e.hasOwnProperty(g)){continue}var k=j[g];var l=e[g];if(j===l){continue
}if(l!==undefined&&k===undefined){j[g]=l}}}return j};SC.extend=SC.mixin;SC.mixin({T_ERROR:"error",T_OBJECT:"object",T_NULL:"null",T_CLASS:"class",T_HASH:"hash",T_FUNCTION:"function",T_UNDEFINED:"undefined",T_NUMBER:"number",T_BOOL:"boolean",T_ARRAY:"array",T_STRING:"string",typeOf:function(e){if(e===undefined){return SC.T_UNDEFINED
}if(e===null){return SC.T_NULL}var d=typeof(e);if(d=="object"){if(e instanceof Array){d=SC.T_ARRAY
}else{if(e instanceof Function){d=e.isClass?SC.T_CLASS:SC.T_FUNCTION}else{if(SC.Error&&(e instanceof SC.Error)){d=SC.T_ERROR
}else{if(e.isObject===true){d=SC.T_OBJECT}else{d=SC.T_HASH}}}}}else{if(d===SC.T_FUNCTION){d=(e.isClass)?SC.T_CLASS:SC.T_FUNCTION
}}return d},none:function(d){return d===null||d===undefined},empty:function(d){return d===null||d===undefined||d===""
},isArray:function(g){if(g&&g.objectAt){return YES}var d=(g?g.length:null),e=SC.typeOf(g);
return !(SC.none(d)||(e===SC.T_FUNCTION)||(e===SC.T_STRING)||g.setInterval)},makeArray:function(d){return SC.isArray(d)?d:SC.A(d)
},A:function(g){if(SC.none(g)){return[]}if(g.slice instanceof Function){if(typeof(g)==="string"){return[g]
}else{return g.slice()}}if(g.toArray){return g.toArray()}if(!SC.isArray(g)){return[g]
}var e=[],d=g.length;while(--d>=0){e[d]=g[d]}return e},guidKey:"_sc_guid_"+new Date().getTime(),_nextGUID:0,_numberGuids:[],_stringGuids:{},_keyCache:{},guidFor:function(e){if(e===undefined){return"(undefined)"
}if(e===null){return"(null)"}if(e===Object){return"(Object)"}if(e===Array){return"(Array)"
}var d=this.guidKey;if(e[d]){return e[d]}switch(typeof e){case SC.T_NUMBER:return(this._numberGuids[e]=this._numberGuids[e]||("nu"+e));
case SC.T_STRING:return(this._stringGuids[e]=this._stringGuids[e]||("st"+e));case SC.T_BOOL:return(e)?"(true)":"(false)";
default:return SC.generateGuid(e)}},keyFor:function(h,g){var e,d=this._keyCache[h];
if(!d){d=this._keyCache[h]={}}e=d[g];if(!e){e=d[g]=h+"_"+g}return e},generateGuid:function(e){var d=("sc"+(this._nextGUID++));
if(e){e[this.guidKey]=d}return d},hashFor:function(d){return(d&&d.hash&&(typeof d.hash===SC.T_FUNCTION))?d.hash():this.guidFor(d)
},isEqual:function(e,d){if(e===null){return d===null}else{if(e===undefined){return d===undefined
}else{return this.hashFor(e)===this.hashFor(d)}}},compare:function(A,y){if(A===y){return 0
}var o=SC.typeOf(A);var m=SC.typeOf(y);var e=SC.ORDER_DEFINITION_MAPPING;if(!e){var h=SC.ORDER_DEFINITION;
e=SC.ORDER_DEFINITION_MAPPING={};var z,u;for(z=0,u=h.length;z<u;++z){e[h[z]]=z}delete SC.ORDER_DEFINITION
}var B=e[o];var g=e[m];if(B<g){return -1}if(B>g){return 1}switch(o){case SC.T_BOOL:case SC.T_NUMBER:if(A<y){return -1
}if(A>y){return 1}return 0;case SC.T_STRING:var p=A.localeCompare(y);if(p<0){return -1
}if(p>0){return 1}return 0;case SC.T_ARRAY:var x=A.length;var s=y.length;var j=Math.min(x,s);
var d=0;var n=0;var k=arguments.callee;while(d===0&&n<j){d=k(A[n],y[n]);n++}if(d!==0){return d
}if(x<s){return -1}if(x>s){return 1}return 0;case SC.T_OBJECT:if(A.constructor.isComparable===YES){return A.constructor.compare(A,y)
}return 0;default:return 0}},K:function(){return this},EMPTY_ARRAY:[],EMPTY_HASH:{},EMPTY_RANGE:{start:0,length:0},beget:function(g){if(SC.none(g)){return null
}var d=SC.K;d.prototype=g;var e=new d();d.prototype=null;if(SC.typeOf(g.didBeget)===SC.T_FUNCTION){e=g.didBeget(e)
}return e},copy:function(e){var d=e;if(e&&e.isCopyable){return e.copy()}switch(SC.typeOf(e)){case SC.T_ARRAY:if(e.clone&&SC.typeOf(e.clone)===SC.T_FUNCTION){d=e.clone()
}else{d=e.slice()}break;case SC.T_HASH:case SC.T_OBJECT:if(e.clone&&SC.typeOf(e.clone)===SC.T_FUNCTION){d=e.clone()
}else{d={};for(var g in e){d[g]=e[g]}}}return d},merge:function(){var g={},e=arguments.length,d;
for(d=0;d<e;d++){SC.mixin(g,arguments[d])}return g},keys:function(g){var d=[];for(var e in g){d.push(e)
}return d},inspect:function(h){var d,e=[];for(var g in h){d=h[g];if(d==="toString"){continue
}if(SC.typeOf(d)===SC.T_FUNCTION){d="function() { ... }"}e.push(g+": "+d)}return"{"+e.join(" , ")+"}"
},tupleForPropertyPath:function(j,d){if(SC.typeOf(j)===SC.T_ARRAY){return j}var g;
var e=j.indexOf("*");if(e<0){e=j.lastIndexOf(".")}g=(e>=0)?j.slice(e+1):j;var h=this.objectForPropertyPath(j,d,e);
return(h&&g)?[h,g]:null},objectForPropertyPath:function(k,g,h){var l,e,j,d;if(!g){g=window
}if(SC.typeOf(k)===SC.T_STRING){if(h===undefined){h=k.length}l=0;while((g)&&(l<h)){e=k.indexOf(".",l);
if((e<0)||(e>h)){e=h}j=k.slice(l,e);g=g.get?g.get(j):g[j];l=e+1}if(l<h){g=undefined
}}else{l=0;d=k.length;j=null;while((l<d)&&g){j=k[l++];if(j){g=(g.get)?g.get(j):g[j]
}}if(l<d){g=undefined}}return g},STRINGS:{},stringsFor:function(e,d){SC.mixin(SC.STRINGS,d);
return this}});SC.clone=SC.copy;SC.$A=SC.A;SC.didLoad=SC.K;SC.ORDER_DEFINITION=[SC.T_ERROR,SC.T_UNDEFINED,SC.T_NULL,SC.T_BOOL,SC.T_NUMBER,SC.T_STRING,SC.T_ARRAY,SC.T_HASH,SC.T_OBJECT,SC.T_FUNCTION,SC.T_CLASS];
SC.mixin(Function.prototype,{property:function(){this.dependentKeys=SC.$A(arguments);
var d=SC.guidFor(this);this.cacheKey="__cache__"+d;this.lastSetValueKey="__lastValue__"+d;
this.isProperty=YES;return this},cacheable:function(d){this.isProperty=YES;if(!this.dependentKeys){this.dependentKeys=[]
}this.isCacheable=(d===undefined)?YES:d;return this},idempotent:function(d){this.isProperty=YES;
if(!this.dependentKeys){this.dependentKeys=[]}this.isVolatile=(d===undefined)?YES:d;
return this},observes:function(d){var j=arguments.length,e=null,h=null;while(--j>=0){var g=arguments[j];
if((g.indexOf(".")<0)&&(g.indexOf("*")<0)){if(!e){e=this.localPropertyPaths=[]}e.push(g)
}else{if(!h){h=this.propertyPaths=[]}h.push(g)}}return this}});String.prototype.fmt=function(){var e=arguments,d=0;
return this.replace(/%@([0-9]+)?/g,function(g,h){h=(h)?parseInt(h,0)-1:d++;g=e[h];
return((g===null)?"(null)":(g===undefined)?"":g).toString()})};String.prototype.loc=function(){var d=SC.STRINGS[this]||this;
return d.fmt.apply(d,arguments)};String.prototype.w=function(){var g=[],h=this.split(" "),e=h.length,j,d=0;
for(d=0;d<e;++d){j=h[d];if(j.length!==0){g.push(j)}}return g};SC.ArraySuite=CoreTest.Suite.create("Verify SC.Array compliance: %@#%@",{simple:function(e){var d=[];
if(e===undefined){e=0}while(--e>=0){d[e]=e}return d},hashValueKey:"foo",hashes:function(e){var d=[];
if(e===undefined){e=0}while(--e>=0){d[e]={};d[e][this.hashValueKey]=e}return d},objectValueKey:"foo",objects:function(g){var d=[];
if(g===undefined){g=0}while(--g>=0){var e={};e[this.objectValueKey]=g;d[g]=SC.Object.create(e)
}return d},expected:function(d){return this.simple(d)},newObject:function(d){if(!d||SC.typeOf(d)===SC.T_NUMBER){d=this.expected(d)
}return d.slice()},observer:function(d){return SC.Object.create({observer:function(h,e,g){this.notified[e]=true;
this.notifiedValue[e]=g},resetObservers:function(){this.notified={};this.notifiedValue={}
},observe:function(){var e=SC.$A(arguments);var g=e.length;while(--g>=0){d.addObserver(e[g],this,this.observer)
}return this},didNotify:function(e){return !!this.notified[e]},init:function(){arguments.callee.base.apply(this,arguments);
this.resetObservers()},callCount:0,expectRangeChange:function(k,g,j,e,h){equals(this.callCount,1,"expects one callback");
if(k!==undefined&&k!==NO){ok(this.source,k,"source should equal array")}if(g!==undefined&&g!==NO){equals(this.object,g,"object")
}if(j!==undefined&&j!==NO){equals(this.key,j,"key")}if(e!==undefined&&e!==NO){if(e.isIndexSet){ok(this.indexes&&this.indexes.isIndexSet,"indexes should be index set");
ok(e.isEqual(this.indexes),"indexes should match %@ (actual: %@)".fmt(e,this.indexes))
}else{equals(this.indexes,e,"indexes")}}if(h!==undefined&&h!==NO){equals(this.context,h,"context should match")
}},rangeDidChange:function(k,g,j,e,h){this.callCount++;this.source=k;this.object=g;
this.key=j;this.indexes=(e&&e.isIndexSet)?e.clone():e;this.context=h}})},validateAfter:function(h,k,d,g,e){var j=k.length;
equals(h.get("length"),j,"length should update (%@)".fmt(h));while(--j>=0){equals(h.objectAt(j),k[j],"objectAt(%@)".fmt(j))
}if(e!==NO){equals(d.didNotify("[]"),YES,"should notify []")}if(g){equals(d.didNotify("length"),YES,"should notify length change")
}}});SC.ArraySuite.define(function(d){d.module("length");test("should return 0 on empty array",function(){equals(d.object.get("length"),0,"should have empty length")
});test("should return array length",function(){var e=d.newObject(3);equals(e.get("length"),3,"should return length")
})});sc_require("debug/test_suites/array/base");SC.ArraySuite.define(function(d){d.module("indexOf");
test("should return index of object",function(){var h=d.expected(3),j=d.newObject(3),g=3,e;
for(e=0;e<g;e++){equals(j.indexOf(h[e]),e,"obj.indexOf(%@) should match idx".fmt(h[e]))
}});test("should return -1 when requesting object not in index",function(){var e=d.newObject(3),g={};
equals(e.indexOf(g),-1,"obj.indexOf(foo) should be < 0")})});sc_require("debug/test_suites/array/base");
SC.ArraySuite.define(function(e){var d,g;module(e.desc("insertAt"),{setup:function(){g=e.newObject();
d=e.observer(g)}});test("[].insertAt(0, X) => [X] + notify",function(){var h=e.expected(1);
d.observe("[]");g.insertAt(0,h);e.validateAfter(g,h,d)});test("[].insertAt(200,X) => OUT_OF_RANGE_EXCEPTION exception",function(){var j=NO;
try{g.insertAt(200,e.expected(1))}catch(h){equals(h,SC.OUT_OF_RANGE_EXCEPTION,"should throw SC.OUT_OF_RANGE_EXCEPTION");
j=YES}ok(j,"should raise exception")});test("[A].insertAt(0, X) => [X,A] + notify",function(){var l=e.expected(2),j=l.slice(0,1),h=l[1],k=[h,j[0]];
g.replace(0,0,j);d.observe("[]");g.insertAt(0,h);e.validateAfter(g,k,d)});test("[A].insertAt(1, X) => [A,X] + notify",function(){var l=e.expected(2),j=l.slice(0,1),h=l[1],k=[j[0],h];
g.replace(0,0,j);d.observe("[]");g.insertAt(1,h);e.validateAfter(g,k,d)});test("[A].insertAt(200,X) => OUT_OF_RANGE exception",function(){g.replace(0,0,e.expected(1));
var j=NO;try{g.insertAt(200,e.expected(1))}catch(h){equals(h,SC.OUT_OF_RANGE_EXCEPTION,"should throw SC.OUT_OF_RANGE_EXCEPTION");
j=YES}ok(j,"should raise exception")});test("[A,B,C].insertAt(0,X) => [X,A,B,C] + notify",function(){var l=e.expected(4),j=l.slice(1),h=l[0],k=[h,j[0],j[1],j[2]];
g.replace(0,0,j);d.observe("[]");g.insertAt(0,h);e.validateAfter(g,k,d)});test("[A,B,C].insertAt(1,X) => [A,X,B,C] + notify",function(){var l=e.expected(4),j=l.slice(1),h=l[0],k=[j[0],h,j[1],j[2]];
g.replace(0,0,j);d.observe("[]");g.insertAt(1,h);e.validateAfter(g,k,d)});test("[A,B,C].insertAt(3,X) => [A,B,C,X] + notify",function(){var l=e.expected(4),j=l.slice(1),h=l[0],k=[j[0],j[1],j[2],h];
g.replace(0,0,j);d.observe("[]");g.insertAt(3,h);e.validateAfter(g,k,d)})});sc_require("debug/test_suites/array/base");
SC.ArraySuite.define(function(d){d.module("objectAt");test("should return object at specified index",function(){var h=d.expected(3),j=d.newObject(3),g=3,e;
for(e=0;e<g;e++){equals(j.objectAt(e),h[e],"obj.objectAt(%@) should match".fmt(e))
}});test("should return undefined when requesting objects beyond index",function(){var e=d.newObject(3);
equals(e.objectAt(5),undefined,"should return undefined for obj.objectAt(5) when len = 3");
equals(d.object.objectAt(0),undefined,"should return undefined for obj.objectAt(0) when len = 0")
})});sc_require("debug/test_suites/array/base");SC.ArraySuite.define(function(e){var d,g;
module(e.desc("popObject"),{setup:function(){g=e.newObject();d=e.observer(g)}});test("[].popObject() => [] + returns undefined + NO notify",function(){d.observe("[]","length");
equals(g.popObject(),undefined,"should return undefined");e.validateAfter(g,[],d,NO,NO)
});test("[X].popObject() => [] + notify",function(){var h=e.expected(1)[0];g.replace(0,0,[h]);
d.observe("[]","length");equals(g.popObject(),h,"should return popped object");e.validateAfter(g,[],d,YES,YES)
});test("[A,B,C].popObject() => [A,B] + notify",function(){var j=e.expected(3),h=j[2],k=j.slice(0,2);
g.replace(0,0,j);d.observe("[]","length");equals(g.popObject(),h,"should return popped object");
e.validateAfter(g,k,d,YES)})});sc_require("debug/test_suites/array/base");SC.ArraySuite.define(function(e){var d,g;
module(e.desc("pushObject"),{setup:function(){g=e.newObject();d=e.observer(g)}});
test("returns pushed object",function(){var h=e.expected(1)[0];equals(g.pushObject(h),h,"should return receiver")
});test("[].pushObject(X) => [X] + notify",function(){var h=e.expected(1);d.observe("[]","length");
g.pushObject(h[0]);e.validateAfter(g,h,d,YES)});test("[A,B,C].pushObject(X) => [A,B,C,X] + notify",function(){var k=e.expected(4),j=k.slice(0,3),h=k[3];
g.replace(0,0,j);d.observe("[]","length");g.pushObject(h);e.validateAfter(g,k,d,YES)
})});sc_require("debug/test_suites/array/base");SC.ArraySuite.define(function(e){var g,j,d,h;
module(e.desc("RangeObserver Methods"),{setup:function(){g=e.objects(10);j=e.newObject(g);
d=e.observer();h=j.addRangeObserver(SC.IndexSet.create(2,3),d,d.rangeDidChange,null,NO)
},teardown:function(){e.destroyObject(j)}});test("returns RangeObserver object",function(){ok(h&&h.isRangeObserver,"returns a range observer object")
});test("replacing object in range fires observer with index set covering only the effected item",function(){j.replace(2,1,e.objects(1));
d.expectRangeChange(j,null,"[]",SC.IndexSet.create(2,1))});test("replacing object before range",function(){j.replace(0,1,e.objects(1));
equals(d.callCount,0,"observer should not fire")});test("replacing object after range",function(){j.replace(9,1,e.objects(1));
equals(d.callCount,0,"observer should not fire")});test("updating range should be reflected by replace operations",function(){j.updateRangeObserver(h,SC.IndexSet.create(9,1));
d.callCount=0;j.replace(2,1,e.objects(1));equals(d.callCount,0,"observer should not fire");
d.callCount=0;j.replace(0,1,e.objects(1));equals(d.callCount,0,"observer should not fire");
d.callCount=0;j.replace(9,1,e.objects(1));d.expectRangeChange(j,null,"[]",SC.IndexSet.create(9))
});test("removing range should no longer fire observers",function(){j.removeRangeObserver(h);
d.callCount=0;j.replace(2,1,e.objects(1));equals(d.callCount,0,"observer should not fire");
d.callCount=0;j.replace(0,1,e.objects(1));equals(d.callCount,0,"observer should not fire");
d.callCount=0;j.replace(9,1,e.objects(1));equals(d.callCount,0,"observer should not fire")
});test("grouping property changes should notify observer only once at end with single IndexSet",function(){j.beginPropertyChanges();
j.replace(2,1,e.objects(1));j.replace(4,1,e.objects(1));j.endPropertyChanges();var k=SC.IndexSet.create().add(2).add(4);
d.expectRangeChange(j,null,"[]",k)});test("should notify observer when some but not all grouped changes are inside range",function(){j.beginPropertyChanges();
j.replace(2,1,e.objects(1));j.replace(9,1,e.objects(1));j.endPropertyChanges();var k=SC.IndexSet.create().add(2).add(9);
d.expectRangeChange(j,null,"[]",k)});test("should NOT notify observer when grouping changes all outside of observer",function(){j.beginPropertyChanges();
j.replace(0,1,e.objects(1));j.replace(9,1,e.objects(1));j.endPropertyChanges();equals(d.callCount,0,"observer should not fire")
});test("insertAt in range fires observer with index set covering edit to end of array",function(){var k=e.objects(1)[0],l=SC.IndexSet.create(3,j.get("length")-2);
j.insertAt(3,k);d.expectRangeChange(j,null,"[]",l)});test("insertAt BEFORE range fires observer with index set covering edit to end of array",function(){var k=e.objects(1)[0],l=SC.IndexSet.create(0,j.get("length")+1);
j.insertAt(0,k);d.expectRangeChange(j,null,"[]",l)});test("insertAt AFTER range does not fire observer",function(){var k=e.objects(1)[0];
j.insertAt(9,k);equals(d.callCount,0,"observer should not fire")});test("removeAt IN range fires observer with index set covering edit to end of array plus delta",function(){var k=SC.IndexSet.create(3,j.get("length")-3);
j.removeAt(3);d.expectRangeChange(j,null,"[]",k)});test("removeAt BEFORE range fires observer with index set covering edit to end of array plus delta",function(){var k=SC.IndexSet.create(0,j.get("length"));
j.removeAt(0);d.expectRangeChange(j,null,"[]",k)});test("removeAt AFTER range does not fire observer",function(){j.removeAt(9);
equals(d.callCount,0,"observer should not fire")});module(e.desc("RangeObserver Methods - No explicit range"),{setup:function(){g=e.objects(10);
j=e.newObject(g);d=e.observer();h=j.addRangeObserver(null,d,d.rangeDidChange,null,NO)
},teardown:function(){e.destroyObject(j)}});test("returns RangeObserver object",function(){ok(h&&h.isRangeObserver,"returns a range observer object")
});test("replacing object in range fires observer with index set covering only the effected item",function(){j.replace(2,1,e.objects(1));
d.expectRangeChange(j,null,"[]",SC.IndexSet.create(2,1))});test("replacing at start of array",function(){j.replace(0,1,e.objects(1));
d.expectRangeChange(j,null,"[]",SC.IndexSet.create(0,1))});test("replacing object at end of array",function(){j.replace(9,1,e.objects(1));
d.expectRangeChange(j,null,"[]",SC.IndexSet.create(9,1))});test("removing range should no longer fire observers",function(){j.removeRangeObserver(h);
d.callCount=0;j.replace(2,1,e.objects(1));equals(d.callCount,0,"observer should not fire");
d.callCount=0;j.replace(0,1,e.objects(1));equals(d.callCount,0,"observer should not fire");
d.callCount=0;j.replace(9,1,e.objects(1));equals(d.callCount,0,"observer should not fire")
});test("grouping property changes should notify observer only once at end with single IndexSet",function(){j.beginPropertyChanges();
j.replace(2,1,e.objects(1));j.replace(4,1,e.objects(1));j.endPropertyChanges();var k=SC.IndexSet.create().add(2).add(4);
d.expectRangeChange(j,null,"[]",k)});test("insertAt in range fires observer with index set covering edit to end of array",function(){var k=e.objects(1)[0],l=SC.IndexSet.create(3,j.get("length")-2);
j.insertAt(3,k);d.expectRangeChange(j,null,"[]",l)});test("adding object fires observer",function(){var k=e.objects(1)[0];
var l=SC.IndexSet.create(j.get("length"));j.pushObject(k);d.expectRangeChange(j,null,"[]",l)
});test("removeAt fires observer with index set covering edit to end of array",function(){var k=SC.IndexSet.create(3,j.get("length")-3);
j.removeAt(3);d.expectRangeChange(j,null,"[]",k)});test("popObject fires observer with index set covering removed range",function(){var k=SC.IndexSet.create(j.get("length")-1);
j.popObject();d.expectRangeChange(j,null,"[]",k)});module(e.desc("RangeObserver Methods - isDeep NO"),{setup:function(){g=e.objects(10);
j=e.newObject(g);d=e.observer();h=j.addRangeObserver(SC.IndexSet.create(2,3),d,d.rangeDidChange,null,NO)
},teardown:function(){e.destroyObject(j)}});test("editing property on object at any point should not fire observer",function(){var l=[0,3,9],n=3,m,k;
while(--n>=0){k=l[n];m=j.objectAt(k);m.set("foo","BAR");equals(d.callCount,0,"observer should not fire when editing object at index %@".fmt(k))
}});test("replacing object in range fires observer with index set",function(){j.replace(2,1,e.objects(1));
d.expectRangeChange(j,null,"[]",SC.IndexSet.create(2,1))})});sc_require("debug/test_suites/array/base");
SC.ArraySuite.define(function(e){var d,g;module(e.desc("removeAt"),{setup:function(){g=e.newObject();
d=e.observer(g)}});test("[X].removeAt(0) => [] + notify",function(){var h=e.expected(1);
g.replace(0,0,h);d.observe("[]","length");g.removeAt(0);e.validateAfter(g,[],d,YES)
});test("[].removeAt(200) => OUT_OF_RANGE_EXCEPTION exception",function(){var j=NO;
try{g.removeAt(200)}catch(h){equals(h,SC.OUT_OF_RANGE_EXCEPTION,"should throw SC.OUT_OF_RANGE_EXCEPTION");
j=YES}ok(j,"should raise exception")});test("[A,B].removeAt(0) => [B] + notify",function(){var h=e.expected(2),j=[h[1]];
g.replace(0,0,h);d.observe("[]","length");g.removeAt(0);e.validateAfter(g,j,d,YES)
});test("[A,B].removeAt(1) => [A] + notify",function(){var h=e.expected(2),j=[h[0]];
g.replace(0,0,h);d.observe("[]","length");g.removeAt(1);e.validateAfter(g,j,d,YES)
});test("[A,B,C].removeAt(1) => [A,C] + notify",function(){var h=e.expected(3),j=[h[0],h[2]];
g.replace(0,0,h);d.observe("[]","length");g.removeAt(1);e.validateAfter(g,j,d,YES)
});test("[A,B,C,D].removeAt(1,2) => [A,D] + notify",function(){var h=e.expected(4),j=[h[0],h[3]];
g.replace(0,0,h);d.observe("[]","length");g.removeAt(1,2);e.validateAfter(g,j,d,YES)
});test("[A,B,C,D].removeAt(IndexSet<0,2-3>) => [B] + notify",function(){var h=e.expected(4),j=[h[1]];
g.replace(0,0,h);d.observe("[]","length");g.removeAt(SC.IndexSet.create(0).add(2,2));
e.validateAfter(g,j,d,YES)})});sc_require("debug/test_suites/array/base");SC.ArraySuite.define(function(e){var d,g;
module(e.desc("removeObject"),{setup:function(){g=e.newObject();d=e.observer(g)}});
test("should return receiver",function(){g=e.newObject(3);equals(g.removeObject(g.objectAt(0)),g,"should return receiver")
});test("[A,B,C].removeObject(B) => [A,C] + notify",function(){var h=e.expected(3),j=[h[0],h[2]];
g.replace(0,0,h);d.observe("[]","length");g.removeObject(h[1]);e.validateAfter(g,j,d,YES)
});test("[A,B,C].removeObject(D) => [A,B,C]",function(){var j=e.expected(4),h=j.pop();
g.replace(0,0,j);d.observe("[]","length");g.removeObject(h);e.validateAfter(g,j,d,NO,NO)
})});sc_require("debug/test_suites/array/base");SC.ArraySuite.define(function(e){var d,g;
module(e.desc("replace"),{setup:function(){g=e.newObject();d=e.observer(g)}});test("[].replace(0,0,'X') => ['X'] + notify",function(){var h=e.expected(1);
d.observe("[]","length");g.replace(0,0,h);e.validateAfter(g,h,d,YES)});test("[A,B,C,D].replace(1,2,X) => [A,X,D] + notify",function(){var l=e.expected(5),j=l.slice(0,4),h=l.slice(4),k=[j[0],h[0],j[3]];
g.replace(0,0,j);d.observe("[]","length");g.replace(1,2,h);e.validateAfter(g,k,d,YES)
});test("[A,B,C,D].replace(1,2,[X,Y]) => [A,X,Y,D] + notify",function(){var l=e.expected(6),j=l.slice(0,4),h=l.slice(4),k=[j[0],h[0],h[1],j[3]];
g.replace(0,0,j);d.observe("[]","length");g.replace(1,2,h);e.validateAfter(g,k,d,YES)
});test("[A,B].replace(1,0,[X,Y]) => [A,X,Y,B] + notify",function(){var l=e.expected(4),j=l.slice(0,2),h=l.slice(2),k=[j[0],h[0],h[1],j[1]];
g.replace(0,0,j);d.observe("[]","length");g.replace(1,0,h);e.validateAfter(g,k,d,YES)
});test("[A,B,C,D].replace(2,2) => [A,B] + notify",function(){var h=e.expected(4),j=[h[0],h[1]];
g.replace(0,0,h);d.observe("[]","length");g.replace(2,2);e.validateAfter(g,j,d,YES)
})});sc_require("debug/test_suites/array/base");SC.ArraySuite.define(function(e){var d,g;
module(e.desc("shiftObject"),{setup:function(){g=e.newObject();d=e.observer(g)}});
test("[].shiftObject() => [] + returns undefined + NO notify",function(){d.observe("[]","length");
equals(g.shiftObject(),undefined,"should return undefined");e.validateAfter(g,[],d,NO,NO)
});test("[X].shiftObject() => [] + notify",function(){var h=e.expected(1)[0];g.replace(0,0,[h]);
d.observe("[]","length");equals(g.shiftObject(),h,"should return shifted object");
e.validateAfter(g,[],d,YES,YES)});test("[A,B,C].shiftObject() => [B,C] + notify",function(){var j=e.expected(3),h=j[0],k=j.slice(1);
g.replace(0,0,j);d.observe("[]","length");equals(g.shiftObject(),h,"should return shifted object");
e.validateAfter(g,k,d,YES)})});sc_require("debug/test_suites/array/base");SC.ArraySuite.define(function(e){var d,g;
module(e.desc("unshiftObject"),{setup:function(){g=e.newObject();d=e.observer(g)}});
test("returns unshifted object",function(){var h=e.expected(1)[0];equals(g.pushObject(h),h,"should return receiver")
});test("[].unshiftObject(X) => [X] + notify",function(){var h=e.expected(1);d.observe("[]","length");
g.unshiftObject(h[0]);e.validateAfter(g,h,d,YES)});test("[A,B,C].unshiftObject(X) => [X,A,B,C] + notify",function(){var k=e.expected(4),j=k.slice(1),h=k[0];
g.replace(0,0,j);d.observe("[]","length");g.unshiftObject(h);e.validateAfter(g,k,d,YES)
})});
/* @license
==========================================================================
SproutCore Costello -- Property Observing Library
Copyright ©2006-2009, Sprout Systems, Inc. and contributors.
Portions copyright ©2008-2009 Apple Inc. All rights reserved.

Permission is hereby granted, free of charge, to any person obtaining a 
copy of this software and associated documentation files (the "Software"), 
to deal in the Software without restriction, including without limitation 
the rights to use, copy, modify, merge, publish, distribute, sublicense, 
and/or sell copies of the Software, and to permit persons to whom the 
Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in 
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR 
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, 
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE 
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER 
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING 
FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER 
DEALINGS IN THE SOFTWARE.

For more information about SproutCore, visit http://www.sproutcore.com

==========================================================================
@license */
sc_require("mixins/observable");
sc_require("mixins/enumerable");sc_require("system/range_observer");SC.OUT_OF_RANGE_EXCEPTION="Index out of range";
SC.Array={isSCArray:YES,replace:function(d,g,e){throw"replace() must be implemented to support SC.Array"
},objectAt:function(d){if(d<0){return undefined}if(d>=this.get("length")){return undefined
}return this.get(d)},"[]":function(d,e){if(e!==undefined){this.replace(0,this.get("length"),e)
}return this}.property(),insertAt:function(d,e){if(d>this.get("length")){throw SC.OUT_OF_RANGE_EXCEPTION
}this.replace(d,0,[e]);return this},removeAt:function(h,d){var g=0,e=[];if(typeof h===SC.T_NUMBER){if((h<0)||(h>=this.get("length"))){throw SC.OUT_OF_RANGE_EXCEPTION
}if(d===undefined){this.replace(h,1,e);return this}else{h=SC.IndexSet.create(h,d)
}}this.beginPropertyChanges();h.forEachRange(function(k,j){k-=g;g+=j;this.replace(k,j,e)
},this);this.endPropertyChanges();return this},removeObject:function(e){var g=this.get("length")||0;
while(--g>=0){var d=this.objectAt(g);if(d==e){this.removeAt(g)}}return this},removeObjects:function(d){this.beginPropertyChanges();
d.forEach(function(e){this.removeObject(e)},this);this.endPropertyChanges();return this
},pushObject:function(d){this.insertAt(this.get("length"),d);return d},pushObjects:function(d){this.beginPropertyChanges();
d.forEach(function(e){this.pushObject(e)},this);this.endPropertyChanges();return this
},popObject:function(){var d=this.get("length");if(d===0){return null}var e=this.objectAt(d-1);
this.removeAt(d-1);return e},shiftObject:function(){if(this.get("length")===0){return null
}var d=this.objectAt(0);this.removeAt(0);return d},unshiftObject:function(d){this.insertAt(0,d);
return d},unshiftObjects:function(d){this.beginPropertyChanges();d.forEach(function(e){this.unshiftObject(e)
},this);this.endPropertyChanges();return this},isEqual:function(d){if(!d){return false
}if(d==this){return true}var e=d.get("length");if(e!=this.get("length")){return false
}while(--e>=0){if(!SC.isEqual(d.objectAt(e),this.objectAt(e))){return false}}return true
},compact:function(){return this.without(null)},without:function(e){if(this.indexOf(e)<0){return this
}var d=[];this.forEach(function(g){if(g!==e){d[d.length]=g}});return d},uniq:function(){var d=[];
this.forEach(function(e){if(d.indexOf(e)<0){d[d.length]=e}});return d},max:function(){return Math.max.apply(Math,this)
},min:function(){return Math.min.apply(Math,this)},rangeObserverClass:SC.RangeObserver,addRangeObserver:function(h,k,m,j){var d=this._array_rangeObservers;
if(!d){d=this._array_rangeObservers=SC.CoreSet.create()}if(this._array_oldLength===undefined){this._array_oldLength=this.get("length")
}var l=this.rangeObserverClass;var e=NO;var g=l.create(this,h,k,m,j,e);d.add(g);if(!this._array_isNotifyingRangeObservers){this._array_isNotifyingRangeObservers=YES;
this.addObserver("[]",this,this._array_notifyRangeObservers)}return g},updateRangeObserver:function(e,d){return e.update(this,d)
},removeRangeObserver:function(g){var e=g.destroy(this);var d=this._array_rangeObservers;
if(d){d.remove(g)}return e},enumerableContentDidChange:function(m,l,k){var d=this._array_rangeObservers,h=this._array_oldLength,j,g,e;
this.beginPropertyChanges();this.notifyPropertyChange("length");if(d&&d.length>0){if(h===undefined){h=0
}this._array_oldLength=j=this.get("length");if(m===undefined){m=0}if(k===undefined){k=j-h
}if(k!==0||l===undefined){g=j-m;if(k<0){g-=k}}else{g=l}e=this._array_rangeChanges;
if(!e){e=this._array_rangeChanges=SC.IndexSet.create()}e.add(m,g)}this.notifyPropertyChange("[]");
this.endPropertyChanges();return this},_array_notifyRangeObservers:function(){var g=this._array_rangeObservers,h=this._array_rangeChanges,e=g?g.length:0,d,j;
if(e>0&&h&&h.length>0){for(d=0;d<e;d++){g[d].rangeDidChange(h)}h.clear()}}};SC.mixin(Array.prototype,SC.Array);
SC.Array=SC.mixin({},SC.Enumerable,SC.Array);SC.Array.slice=function(e,h){var d=[];
var g=this.get("length");if(SC.none(e)){e=0}if(SC.none(h)||(h>g)){h=g}while(e<h){d[d.length]=this.objectAt(e++)
}return d};SC.Array.indexOf=function(h,g){var e,d=this.get("length");if(g===undefined){g=0
}else{g=(g<0)?Math.ceil(g):Math.floor(g)}if(g<0){g+=d}for(e=g;e<d;e++){if(this.objectAt(e)===h){return e
}}return -1};if(!Array.prototype.indexOf){Array.prototype.indexOf=SC.Array.indexOf
}SC.Array.lastIndexOf=function(h,g){var e,d=this.get("length");if(g===undefined){g=d-1
}else{g=(g<0)?Math.ceil(g):Math.floor(g)}if(g<0){g+=d}for(e=g;e>=0;e--){if(this.objectAt(e)===h){return e
}}return -1};if(!Array.prototype.lastIndexOf){Array.prototype.lastIndexOf=SC.Array.lastIndexOf
}(function(){SC.mixin(Array.prototype,{replace:function(h,l,k){if(this.isFrozen){throw SC.FROZEN_ERROR
}if(!k||k.length===0){this.splice(h,l)}else{var j=[h,l].concat(k);this.splice.apply(this,j)
}var g=k?(k.get?k.get("length"):k.length):0;this.enumerableContentDidChange(h,l,g-l);
return this},unknownProperty:function(h,j){var g=this.reducedProperty(h,j);if((j!==undefined)&&g===undefined){g=this[h]=j
}return g}});var e=Array.prototype.indexOf;if(!e||(e===SC.Array.indexOf)){Array.prototype.indexOf=function(k,j){var h,g=this.length;
if(j===undefined){j=0}else{j=(j<0)?Math.ceil(j):Math.floor(j)}if(j<0){j+=g}for(h=j;
h<g;h++){if(this[h]===k){return h}}return -1}}var d=Array.prototype.lastIndexOf;if(!d||(d===SC.Array.lastIndexOf)){Array.prototype.lastIndexOf=function(k,j){var h,g=this.length;
if(j===undefined){j=g-1}else{j=(j<0)?Math.ceil(j):Math.floor(j)}if(j<0){j+=g}for(h=j;
h>=0;h--){if(this[h]===k){return h}}return -1}}})();SC.Comparable={isComparable:YES,compare:function(e,d){throw"%@.compare() is not implemented".fmt(this.toString())
}};SC.Copyable={isCopyable:YES,copy:function(){throw"%@.copy() is not implemented"
},frozenCopy:function(){var d=this.get?this.get("isFrozen"):this.isFrozen;if(d===YES){return this
}else{if(d===undefined){throw"%@ does not support freezing".fmt(this)}else{return this.copy().freeze()
}}}};SC.mixin(Array.prototype,SC.Copyable);Array.prototype.copy=Array.prototype.slice;
SC.DelegateSupport={delegateFor:function(g){var e=1,d=arguments.length,h;while(e<d){h=arguments[e];
if(h&&h[g]!==undefined){return h}e++}return(this[g]!==undefined)?this:null},invokeDelegateMethod:function(g,d,e){e=SC.A(arguments);
e=e.slice(2,e.length);if(!g||!g[d]){g=this}var h=g[d];return h?h.apply(g,e):null},getDelegateProperty:function(h,j){var e=1,d=arguments.length,g;
while(e<d){g=arguments[e++];if(g&&g[h]!==undefined){return g.get?g.get(h):g[h]}}return(this[h]!==undefined)?this.get(h):undefined
}};require("core");require("system/enumerator");SC.Enumerable={isEnumerable:YES,nextObject:function(d,g,e){return this.objectAt?this.objectAt(d):this[d]
},firstObject:function(){if(this.get("length")===0){return undefined}if(this.objectAt){return this.objectAt(0)
}var e=SC.Enumerator._popContext(),d;d=this.nextObject(0,null,e);e=SC.Enumerator._pushContext(e);
return d}.property(),enumerator:function(){return SC.Enumerator.create(this)},forEach:function(l,k){if(typeof l!=="function"){throw new TypeError()
}var e=this.get?this.get("length"):this.length;if(k===undefined){k=null}var j=null;
var g=SC.Enumerator._popContext();for(var d=0;d<e;d++){var h=this.nextObject(d,j,g);
l.call(k,h,d,this);j=h}j=null;g=SC.Enumerator._pushContext(g);return this},getEach:function(d){return this.map(function(e){return e?(e.get?e.get(d):e[d]):null
},this)},setEach:function(d,e){this.forEach(function(g){if(g){if(g.set){g.set(d,e)
}else{g[d]=e}}},this);return this},map:function(m,l){if(typeof m!=="function"){throw new TypeError()
}var e=this.get?this.get("length"):this.length;if(l===undefined){l=null}var g=[];
var k=null;var h=SC.Enumerator._popContext();for(var d=0;d<e;d++){var j=this.nextObject(d,k,h);
g[d]=m.call(l,j,d,this);k=j}k=null;h=SC.Enumerator._pushContext(h);return g},mapProperty:function(d){return this.map(function(e){return e?(e.get?e.get(d):e[d]):null
})},filter:function(m,l){if(typeof m!=="function"){throw new TypeError()}var e=this.get?this.get("length"):this.length;
if(l===undefined){l=null}var g=[];var k=null;var h=SC.Enumerator._popContext();for(var d=0;
d<e;d++){var j=this.nextObject(d,k,h);if(m.call(l,j,d,this)){g.push(j)}k=j}k=null;
h=SC.Enumerator._pushContext(h);return g},sortProperty:function(e){var g=(typeof e===SC.T_STRING)?arguments:e,d=g.length,h;
if(this instanceof Array){h=this}else{h=[];this.forEach(function(j){h.push(j)})}if(!h){return[]
}return h.sort(function(l,k){var j,n,p,o,m=0;for(j=0;m===0&&j<d;j++){n=g[j];p=l?(l.get?l.get(n):l[n]):null;
o=k?(k.get?k.get(n):k[n]):null;m=SC.compare(p,o)}return m})},filterProperty:function(o,k){var h=this.get?this.get("length"):this.length;
var j=[];var n=null;var e=SC.Enumerator._popContext();for(var l=0;l<h;l++){var g=this.nextObject(l,n,e);
var m=g?(g.get?g.get(o):g[o]):null;var d=(k===undefined)?!!m:SC.isEqual(m,k);if(d){j.push(g)
}n=g}n=null;e=SC.Enumerator._pushContext(e);return j},find:function(m,h){var g=this.get?this.get("length"):this.length;
if(h===undefined){h=null}var l=null,e,n=NO,j=null;var d=SC.Enumerator._popContext();
for(var k=0;k<g&&!n;k++){e=this.nextObject(k,l,d);if(n=m.call(h,e,k,this)){j=e}l=e
}e=l=null;d=SC.Enumerator._pushContext(d);return j},findProperty:function(n,k){var g=this.get?this.get("length"):this.length;
var o=NO,h=null,m=null,e,l;var d=SC.Enumerator._popContext();for(var j=0;j<g&&!o;
j++){e=this.nextObject(j,m,d);l=e?(e.get?e.get(n):e[n]):null;o=(k===undefined)?!!l:SC.isEqual(l,k);
if(o){h=e}m=e}m=e=null;d=SC.Enumerator._pushContext(d);return h},every:function(m,l){if(typeof m!=="function"){throw new TypeError()
}var e=this.get?this.get("length"):this.length;if(l===undefined){l=null}var g=YES;
var k=null;var h=SC.Enumerator._popContext();for(var d=0;g&&(d<e);d++){var j=this.nextObject(d,k,h);
if(!m.call(l,j,d,this)){g=NO}k=j}k=null;h=SC.Enumerator._pushContext(h);return g},everyProperty:function(n,j){var g=this.get?this.get("length"):this.length;
var h=YES;var m=null;var d=SC.Enumerator._popContext();for(var k=0;h&&(k<g);k++){var e=this.nextObject(k,m,d);
var l=e?(e.get?e.get(n):e[n]):null;h=(j===undefined)?!!l:SC.isEqual(l,j);m=e}m=null;
d=SC.Enumerator._pushContext(d);return h},some:function(m,l){if(typeof m!=="function"){throw new TypeError()
}var e=this.get?this.get("length"):this.length;if(l===undefined){l=null}var g=NO;
var k=null;var h=SC.Enumerator._popContext();for(var d=0;(!g)&&(d<e);d++){var j=this.nextObject(d,k,h);
if(m.call(l,j,d,this)){g=YES}k=j}k=null;h=SC.Enumerator._pushContext(h);return g},someProperty:function(n,j){var g=this.get?this.get("length"):this.length;
var h=NO;var m=null;var d=SC.Enumerator._popContext();for(var k=0;!h&&(k<g);k++){var e=this.nextObject(k,m,d);
var l=e?(e.get?e.get(n):e[n]):null;h=(j===undefined)?!!l:SC.isEqual(l,j);m=e}m=null;
d=SC.Enumerator._pushContext(d);return h},reduce:function(l,m,n){if(typeof l!=="function"){throw new TypeError()
}var g=this.get?this.get("length"):this.length;if(g===0&&m===undefined){throw new TypeError()
}var h=m;var k=null;var d=SC.Enumerator._popContext();for(var j=0;j<g;j++){var e=this.nextObject(j,k,d);
if(e!==null){if(h===undefined){h=e}else{h=l.call(null,h,e,j,this,n)}}k=e}k=null;d=SC.Enumerator._pushContext(d);
if(h===undefined){throw new TypeError()}return h},invoke:function(m){var j=this.get?this.get("length"):this.length;
if(j<=0){return[]}var n;var l=[];var g=arguments.length;if(g>1){for(n=1;n<g;n++){l.push(arguments[n])
}}var k=[];var o=null;var e=SC.Enumerator._popContext();for(n=0;n<j;n++){var h=this.nextObject(n,o,e);
var d=h?h[m]:null;if(d){k[n]=d.apply(h,l)}o=h}o=null;e=SC.Enumerator._pushContext(e);
return k},invokeWhile:function(h,n){var k=this.get?this.get("length"):this.length;
if(k<=0){return null}var o;var m=[];var g=arguments.length;if(g>2){for(o=2;o<g;o++){m.push(arguments[o])
}}var l=h;var p=null;var e=SC.Enumerator._popContext();for(o=0;(l===h)&&(o<k);o++){var j=this.nextObject(o,p,e);
var d=j?j[n]:null;if(d){l=d.apply(j,m)}p=j}p=null;e=SC.Enumerator._pushContext(e);
return l},toArray:function(){var d=[];this.forEach(function(e){d.push(e)},this);return d
},groupBy:function(o){var h=this.get?this.get("length"):this.length,j=[],n=null,d=SC.Enumerator._popContext(),k=[],p=[];
for(var l=0;l<h;l++){var g=this.nextObject(l,n,d);var m=g?(g.get?g.get(o):g[o]):null;
if(SC.none(k[m])){k[m]=[];p.push(m)}k[m].push(g);n=g}n=null;d=SC.Enumerator._pushContext(d);
for(var l=0,e=p.length;l<e;l++){j.push(k[p[l]])}return j}};SC._buildReducerFor=function(d,e){return function(h,j){var k=this[d];
if(SC.typeOf(k)!==SC.T_FUNCTION){return this.unknownProperty?this.unknownProperty(h,j):null
}else{var g=SC.Enumerable.reduce.call(this,k,null,e);return g}}.property("[]")};SC.Reducers={"[]":function(d,e){return this
}.property(),enumerableContentDidChange:function(e,d){this.notifyPropertyChange("[]");
return this},reducedProperty:function(n,l,k){if(!n||n.charAt(0)!=="@"){return undefined
}var h=n.match(/^@([^(]*)(\(([^)]*)\))?$/);if(!h||h.length<2){return undefined}var m=h[1];
var o=h[3];m="reduce"+m.slice(0,1).toUpperCase()+m.slice(1);var d=this[m];if(SC.typeOf(d)!==SC.T_FUNCTION){return undefined
}if(k===NO){return SC.Enumerable.reduce.call(this,d,null,o)}var g=SC._buildReducerFor(m,o);
var e=this.constructor.prototype;if(e){e[n]=g;var j=e._properties||[];j.push(n);e._properties=j;
this.registerDependentKey(n,"[]")}return SC.Enumerable.reduce.call(this,d,null,o)
},reduceMax:function(d,j,g,k,h){if(h&&j){j=j.get?j.get(h):j[h]}if(d===null){return j
}return(j>d)?j:d},reduceMaxObject:function(g,k,h,l,j){var d=g,m=k;if(j){if(k){m=k.get?k.get(j):k[j]
}if(g){d=g.get?g.get(j):g[j]}}if(d===null){return k}return(m>d)?k:g},reduceMin:function(d,j,g,k,h){if(h&&j){j=j.get?j.get(h):j[h]
}if(d===null){return j}return(j<d)?j:d},reduceMinObject:function(g,k,h,l,j){var d=g,m=k;
if(j){if(k){m=k.get?k.get(j):k[j]}if(g){d=g.get?g.get(j):g[j]}}if(d===null){return k
}return(m<d)?k:g},reduceAverage:function(g,l,j,m,k){if(k&&l){l=l.get?l.get(k):l[k]
}var h=(g||0)+l;var d=m.get?m.get("length"):m.length;if(j>=d-1){h=h/d}return h},reduceSum:function(d,j,g,k,h){if(h&&j){j=j.get?j.get(h):j[h]
}return(d===null)?j:d+j}};SC.mixin(SC.Enumerable,SC.Reducers);SC.mixin(Array.prototype,SC.Reducers);
Array.prototype.isEnumerable=YES;(function(){var d={nextObject:SC.Enumerable.nextObject,enumerator:SC.Enumerable.enumerator,firstObject:SC.Enumerable.firstObject,sortProperty:SC.Enumerable.sortProperty,mapProperty:function(l){var j=this.length;
var k=[];for(var h=0;h<j;h++){var m=this[h];k[h]=m?(m.get?m.get(l):m[l]):null}return k
},filterProperty:function(m,o){var k=this.length;var l=[];for(var j=0;j<k;j++){var n=this[j];
var p=n?(n.get?n.get(m):n[m]):null;var h=(o===undefined)?!!p:SC.isEqual(p,o);if(h){l.push(n)
}}return l},groupBy:function(p){var k=this.length,l=[],m=[],s=[];for(var n=0;n<k;
n++){var j=this[n];var o=j?(j.get?j.get(p):j[p]):null;if(SC.none(m[o])){m[o]=[];s.push(o)
}m[o].push(j)}for(var n=0,h=s.length;n<h;n++){l.push(m[s[n]])}return l},find:function(o,n){if(typeof o!=="function"){throw new TypeError()
}var j=this.length;if(n===undefined){n=null}var l,k=null,m=NO;for(var h=0;h<j&&!m;
h++){l=this[h];if(m=o.call(n,l,h,this)){k=l}}l=null;return k},findProperty:function(l,o){var j=this.length;
var m,p,n=NO,k=null;for(var h=0;h<j&&!n;h++){p=(m=this[h])?(m.get?m.get(l):m[l]):null;
n=(o===undefined)?!!p:SC.isEqual(p,o);if(n){k=m}}m=null;return k},everyProperty:function(l,n){var j=this.length;
var k=YES;for(var h=0;k&&(h<j);h++){var m=this[h];var o=m?(m.get?m.get(l):m[l]):null;
k=(n===undefined)?!!o:SC.isEqual(o,n)}return k},someProperty:function(l,n){var j=this.length;
var k=NO;for(var h=0;!k&&(h<j);h++){var m=this[h];var o=m?(m.get?m.get(l):m[l]):null;
k=(n===undefined)?!!o:SC.isEqual(o,n)}return k},invoke:function(k){var j=this.length;
if(j<=0){return[]}var h;var m=[];var o=arguments.length;if(o>1){for(h=1;h<o;h++){m.push(arguments[h])
}}var l=[];for(h=0;h<j;h++){var n=this[h];var p=n?n[k]:null;if(p){l[h]=p.apply(n,m)
}}return l},invokeWhile:function(k,p){var m=this.length;if(m<=0){return null}var s;
var o=[];var j=arguments.length;if(j>2){for(s=2;s<j;s++){o.push(arguments[s])}}var n=k;
for(s=0;(n===k)&&(s<m);s++){var l=this[s];var h=l?l[p]:null;if(h){n=h.apply(l,o)}}return n
},toArray:function(){var j=this.length;if(j<=0){return[]}var k=[];for(var h=0;h<j;
h++){var l=this[h];k.push(l)}return k},getEach:function(l){var k=[];var j=this.length;
for(var h=0;h<j;h++){var m=this[h];k[h]=m?(m.get?m.get(l):m[l]):null}return k},setEach:function(k,l){var j=this.length;
for(var h=0;h<j;h++){var m=this[h];if(m){if(m.set){m.set(k,l)}else{m[k]=l}}}return this
}};var g={forEach:function(m,l){if(typeof m!=="function"){throw new TypeError()}var j=this.length;
if(l===undefined){l=null}for(var h=0;h<j;h++){var k=this[h];m.call(l,k,h,this)}return this
},map:function(n,m){if(typeof n!=="function"){throw new TypeError()}var j=this.length;
if(m===undefined){m=null}var k=[];for(var h=0;h<j;h++){var l=this[h];k[h]=n.call(m,l,h,this)
}return k},filter:function(n,m){if(typeof n!=="function"){throw new TypeError()}var j=this.length;
if(m===undefined){m=null}var k=[];for(var h=0;h<j;h++){var l=this[h];if(n.call(m,l,h,this)){k.push(l)
}}return k},every:function(n,m){if(typeof n!=="function"){throw new TypeError()}var j=this.length;
if(m===undefined){m=null}var k=YES;for(var h=0;k&&(h<j);h++){var l=this[h];if(!n.call(m,l,h,this)){k=NO
}}return k},some:function(n,m){if(typeof n!=="function"){throw new TypeError()}var j=this.length;
if(m===undefined){m=null}var k=NO;for(var h=0;(!k)&&(h<j);h++){var l=this[h];if(n.call(m,l,h,this)){k=YES
}}return k},reduce:function(o,k,n){if(typeof o!=="function"){throw new TypeError()
}var j=this.length;if(j===0&&k===undefined){throw new TypeError()}var l=k;for(var h=0;
h<j;h++){var m=this[h];if(m!==null){if(l===undefined){l=m}else{l=o.call(null,l,m,h,this,n)
}}}if(l===undefined){throw new TypeError()}return l}};for(var e in g){if(!g.hasOwnProperty(e)){continue
}if(!Array.prototype[e]||((typeof Prototype==="object")&&Prototype.Version.match(/^1\.6/))){Array.prototype[e]=g[e]
}}SC.mixin(Array.prototype,d)})();SC.FROZEN_ERROR=new Error("Cannot modify a frozen object");
SC.Freezable={isFreezable:YES,isFrozen:NO,freeze:function(){if(this.set){this.set("isFrozen",YES)
}else{this.isFrozen=YES}return this}};SC.mixin(Array.prototype,SC.Freezable);require("private/observer_set");
SC.LOG_OBSERVERS=NO;SC.Observable={isObservable:YES,automaticallyNotifiesObserversFor:function(d){return YES
},get:function(g){var e=this[g],d;if(e===undefined){return this.unknownProperty(g)
}else{if(e&&e.isProperty){if(e.isCacheable){d=this._kvo_cache;if(!d){d=this._kvo_cache={}
}return(d[e.cacheKey]!==undefined)?d[e.cacheKey]:(d[e.cacheKey]=e.call(this,g))}else{return e.call(this,g)
}}else{return e}}},set:function(m,k){var e=this[m],n=this.automaticallyNotifiesObserversFor(m),j=k,g,d,l,h;
if(!n&&this._kvo_cacheable&&(d=this._kvo_cache)){g=this._kvo_cachedep;if(!g||(g=g[m])===undefined){g=this._kvo_computeCachedDependentsFor(m)
}if(g){l=g.length;while(--l>=0){h=g[l];d[h.cacheKey]=d[h.lastSetValueKey]=undefined
}}}if(e&&e.isProperty){d=this._kvo_cache;if(e.isVolatile||!d||(d[e.lastSetValueKey]!==k)){if(!d){d=this._kvo_cache={}
}d[e.lastSetValueKey]=k;if(n){this.propertyWillChange(m)}j=e.call(this,m,k);if(e.isCacheable){d[e.cacheKey]=j
}if(n){this.propertyDidChange(m,j,YES)}}}else{if(e===undefined){if(n){this.propertyWillChange(m)
}this.unknownProperty(m,k);if(n){this.propertyDidChange(m,j)}}else{if(this[m]!==k){if(n){this.propertyWillChange(m)
}j=this[m]=k;if(n){this.propertyDidChange(m,j)}}}}return this},unknownProperty:function(d,e){if(!(e===undefined)){this[d]=e
}return e},beginPropertyChanges:function(){this._kvo_changeLevel=(this._kvo_changeLevel||0)+1;
return this},endPropertyChanges:function(){this._kvo_changeLevel=(this._kvo_changeLevel||1)-1;
var e=this._kvo_changeLevel,d=this._kvo_changes;if((e<=0)&&d&&(d.length>0)&&!SC.Observers.isObservingSuspended){this._notifyPropertyObservers()
}return this},propertyWillChange:function(d){return this},propertyDidChange:function(s,o,g){this._kvo_revision=(this._kvo_revision||0)+1;
var e=this._kvo_changeLevel||0,l,p,m,d,h,k=SC.LOG_OBSERVERS&&!(this.LOG_OBSERVING===NO);
if(d=this._kvo_cache){if(!g){h=this[s];if(h&&h.isProperty){d[h.cacheKey]=d[h.lastSetValueKey]=undefined
}}if(this._kvo_cacheable){l=this._kvo_cachedep;if(!l||(l=l[s])===undefined){l=this._kvo_computeCachedDependentsFor(s)
}if(l){p=l.length;while(--p>=0){m=l[p];d[m.cacheKey]=d[m.lastSetValueKey]=undefined
}}}}var j=SC.Observers.isObservingSuspended;if((e>0)||j){var n=this._kvo_changes;
if(!n){n=this._kvo_changes=SC.CoreSet.create()}n.add(s);if(j){if(k){console.log("%@%@: will not notify observers because observing is suspended".fmt(SC.KVO_SPACES,this))
}SC.Observers.objectHasPendingChanges(this)}}else{this._notifyPropertyObservers(s)
}return this},registerDependentKey:function(m,g){var j=this._kvo_dependents,e=this[m],n,l,d,k,h;
if(SC.typeOf(g)===SC.T_ARRAY){n=g;d=0}else{n=arguments;d=1}l=n.length;if(!j){this._kvo_dependents=j={}
}while(--l>=d){k=n[l];h=j[k];if(!h){h=j[k]=[]}h.push(m)}},_kvo_addCachedDependents:function(e,k,m,g){var d=k.length,j,h,l;
while(--d>=0){h=k[d];g.add(h);j=this[h];if(j&&(j instanceof Function)&&j.isProperty){if(j.isCacheable){e.push(j)
}if((l=m[h])&&l.length>0){this._kvo_addCachedDependents(e,l,m,g)}}}},_kvo_computeCachedDependentsFor:function(g){var h=this._kvo_cachedep,k=this._kvo_dependents,j=k?k[g]:null,d,e;
if(!h){h=this._kvo_cachedep={}}if(!j||j.length===0){return h[g]=null}d=h[g]=[];e=SC._TMP_SEEN_SET=(SC._TMP_SEEN_SET||SC.CoreSet.create());
e.add(g);this._kvo_addCachedDependents(d,j,k,e);e.clear();if(d.length===0){d=h[g]=null
}return d},_kvo_for:function(g,e){var d=this[g];if(!this._kvo_cloned){this._kvo_cloned={}
}if(!d){d=this[g]=(e===undefined)?[]:e.create();this._kvo_cloned[g]=YES}else{if(!this._kvo_cloned[g]){d=this[g]=d.copy();
this._kvo_cloned[g]=YES}}return d},addObserver:function(g,k,m,e){var h,d,j,l;if(m===undefined){m=k;
k=this}if(!k){k=this}if(SC.typeOf(m)===SC.T_STRING){m=k[m]}if(!m){throw"You must pass a method to addObserver()"
}g=g.toString();if(g.indexOf(".")>=0){d=SC._ChainObserver.createChain(this,g,k,m,e);
d.masterTarget=k;d.masterMethod=m;this._kvo_for(SC.keyFor("_kvo_chains",g)).push(d)
}else{if((this[g]===undefined)&&(g.indexOf("@")===0)){this.get(g)}if(k===this){k=null
}h=SC.keyFor("_kvo_observers",g);this._kvo_for(h,SC.ObserverSet).add(k,m,e);this._kvo_for("_kvo_observed_keys",SC.CoreSet).add(g)
}if(this.didAddObserver){this.didAddObserver(g,k,m)}return this},removeObserver:function(g,k,m){var h,j,e,l,d;
if(m===undefined){m=k;k=this}if(!k){k=this}if(SC.typeOf(m)===SC.T_STRING){m=k[m]}if(!m){throw"You must pass a method to removeObserver()"
}g=g.toString();if(g.indexOf(".")>=0){h=SC.keyFor("_kvo_chains",g);if(j=this[h]){j=this._kvo_for(h);
d=j.length;while(--d>=0){e=j[d];if(e&&(e.masterTarget===k)&&(e.masterMethod===m)){j[d]=e.destroyChain()
}}}}else{if(k===this){k=null}h=SC.keyFor("_kvo_observers",g);if(l=this[h]){l=this._kvo_for(h);
l.remove(k,m);if(l.targets<=0){this._kvo_for("_kvo_observed_keys",SC.CoreSet).remove(g)
}}}if(this.didRemoveObserver){this.didRemoveObserver(g,k,m)}return this},hasObserverFor:function(e){SC.Observers.flush(this);
var h=this[SC.keyFor("_kvo_observers",e)],g=this[SC.keyFor("_kvo_local",e)],d;if(g&&g.length>0){return YES
}if(h&&h.getMembers().length>0){return YES}return NO},initObservable:function(){if(this._observableInited){return
}this._observableInited=YES;var k,u,p,o,m,j,s,l,g,x,e,n,h,d;if(u=this._observers){l=u.length;
for(k=0;k<l;k++){p=u[k];m=this[p];j=m.propertyPaths;s=(j)?j.length:0;for(g=0;g<s;
g++){x=j[g];e=x.indexOf(".");if(e<0){this.addObserver(x,this,m)}else{if(x.indexOf("*")===0){this.addObserver(x.slice(1),this,m)
}else{n=null;if(e===0){n=this;x=x.slice(1)}else{if(e===4&&x.slice(0,5)==="this."){n=this;
x=x.slice(5)}else{if(e<0&&x.length===4&&x==="this"){n=this;x=""}}}SC.Observers.addObserver(x,this,m,n)
}}}}}this.bindings=[];if(u=this._bindings){for(k=0,d=u.length;k<d;k++){p=u[k];o=this[p];
h=p.slice(0,-7);this[p]=this.bind(h,o)}}if(u=this._properties){for(k=0,d=u.length;
k<d;k++){p=u[k];if(o=this[p]){if(o.isCacheable){this._kvo_cacheable=YES}if(o.dependentKeys&&(o.dependentKeys.length>0)){this.registerDependentKey(p,o.dependentKeys)
}}}}},observersForKey:function(d){var e=this._kvo_for("_kvo_observers",d);return e.getMembers()||[]
},_notifyPropertyObservers:function(D){if(!this._observableInited){this.initObservable()
}SC.Observers.flush(this);var l=SC.LOG_OBSERVERS&&!(this.LOG_OBSERVING===NO),y,B,u,h,x,s,A,z,o,d,k,C,g,n,j,e,m,p;
if(l){m=SC.KVO_SPACES=(SC.KVO_SPACES||"")+"  ";console.log('%@%@: notifying observers after change to key "%@"'.fmt(m,this,D))
}h=this["_kvo_observers_*"];this._kvo_changeLevel=(this._kvo_changeLevel||0)+1;while(((B=this._kvo_changes)&&(B.length>0))||D){A=++this.propertyRevision;
if(!B){B=SC.CoreSet.create()}this._kvo_changes=null;if(D==="*"){B.add("*");B.addEach(this._kvo_for("_kvo_observed_keys",SC.CoreSet))
}else{if(D){B.add(D)}}if(u=this._kvo_dependents){for(x=0;x<B.length;x++){D=B[x];s=u[D];
if(s&&(n=s.length)){if(l){console.log("%@...including dependent keys for %@: %@".fmt(m,D,s))
}p=this._kvo_cache;if(!p){p=this._kvo_cache={}}while(--n>=0){B.add(D=s[n]);if(j=this[D]){this[j.cacheKey]=undefined;
p[j.cacheKey]=p[j.lastSetValueKey]=undefined}}}}}while(B.length>0){D=B.pop();y=this[SC.keyFor("_kvo_observers",D)];
if(y){z=y.getMembers();o=z.length;for(k=0;k<o;k++){d=z[k];if(d[3]===A){continue}C=d[0]||this;
g=d[1];e=d[2];d[3]=A;if(l){console.log('%@...firing observer on %@ for key "%@"'.fmt(m,C,D))
}if(e!==undefined){g.call(C,this,D,null,e,A)}else{g.call(C,this,D,null,A)}}}z=this[SC.keyFor("_kvo_local",D)];
if(z){o=z.length;for(k=0;k<o;k++){d=z[k];g=this[d];if(g){if(l){console.log('%@...firing local observer %@.%@ for key "%@"'.fmt(m,this,d,D))
}g.call(this,this,D,null,A)}}}if(h&&D!=="*"){z=h.getMembers();o=z.length;for(k=0;
k<o;k++){d=z[k];C=d[0]||this;g=d[1];e=d[2];if(l){console.log('%@...firing * observer on %@ for key "%@"'.fmt(m,C,D))
}if(e!==undefined){g.call(C,this,D,null,e,A)}else{g.call(C,this,D,null,A)}}}if(this.propertyObserver){if(l){console.log('%@...firing %@.propertyObserver for key "%@"'.fmt(m,this,D))
}this.propertyObserver(this,D,null,A)}}if(B){B.destroy()}D=null}this._kvo_changeLevel=(this._kvo_changeLevel||1)-1;
if(l){SC.KVO_SPACES=m.slice(0,-2)}return YES},bind:function(d,g,j){var h,e;if(j!==undefined){g=[g,j]
}e=SC.typeOf(g);if(e===SC.T_STRING||e===SC.T_ARRAY){h=this[d+"BindingDefault"]||SC.Binding;
h=h.beget().from(g)}else{h=g}h=h.to(d,this).connect();this.bindings.push(h);return h
},didChangeFor:function(d){var e,k,j,o,h,g,m,n,l;d=SC.hashFor(d);e=this._kvo_didChange_valueCache;
if(!e){e=this._kvo_didChange_valueCache={}}k=this._kvo_didChange_revisionCache;if(!k){k=this._kvo_didChange_revisionCache={}
}j=e[d]||{};o=k[d]||{};h=false;g=this._kvo_revision||0;m=arguments.length;while(--m>=1){n=arguments[m];
if(o[n]!=g){l=this.get(n);if(j[n]!==l){h=true;j[n]=l}}o[n]=g}e[d]=j;k[d]=o;return h
},setIfChanged:function(d,e){return(this.get(d)!==e)?this.set(d,e):this},getPath:function(e){var d=SC.tupleForPropertyPath(e,this);
if(d===null||d[0]===null){return undefined}return d[0].get(d[1])},setPath:function(g,e){if(g.indexOf(".")>=0){var d=SC.tupleForPropertyPath(g,this);
if(!d||!d[0]){return null}d[0].set(d[1],e)}else{this.set(g,e)}return this},setPathIfChanged:function(g,e){if(g.indexOf(".")>=0){var d=SC.tupleForPropertyPath(g,this);
if(!d||!d[0]){return null}if(d[0].get(d[1])!==e){d[0].set(d[1],e)}}else{this.setIfChanged(g,e)
}return this},getEach:function(){var h=SC.A(arguments),g=[],d,e;for(d=0,e=h.length;
d<e;d++){g[g.length]=this.getPath(h[d])}return g},incrementProperty:function(e,d){if(!d){d=1
}this.set(e,(this.get(e)||0)+d);return this.get(e)},decrementProperty:function(e,d){if(!d){d=1
}this.set(e,(this.get(e)||0)-d);return this.get(e)},toggleProperty:function(d,e,g){if(e===undefined){e=true
}if(g===undefined){g=false}e=(this.get(d)==e)?g:e;this.set(d,e);return this.get(d)
},notifyPropertyChange:function(d,e){this.propertyWillChange(d);this.propertyDidChange(d,e);
return this},allPropertiesDidChange:function(){this._kvo_cache=null;this._notifyPropertyObservers("*");
return this},addProbe:function(d){this.addObserver(d,SC.logChange)},removeProbe:function(d){this.removeObserver(d,SC.logChange)
},logProperty:function(){var e=SC.$A(arguments),h,g,d;for(d=0,g=e.length;d<g;d++){h=e[d];
console.log("%@:%@: ".fmt(SC.guidFor(this),h),this.get(h))}},propertyRevision:1};
SC.logChange=function logChange(g,d,e){console.log("CHANGE: %@[%@] =>".fmt(g,d),g.get(d))
};SC.mixin(SC,{get:function(d,e){if(!d){return undefined}if(e===undefined){return this[d]
}if(d.get){return d.get(e)}return d[e]}});SC.mixin(Array.prototype,SC.Observable);
require("system/object");SC._ChainObserver=function(d){this.property=d};SC._ChainObserver.createChain=function(h,o,k,d,e){var g=o.split("."),m=new SC._ChainObserver(g[0]),l=m,j=g.length;
for(var n=1;n<j;n++){l=l.next=new SC._ChainObserver(g[n])}m.objectDidChange(h);l.target=k;
l.method=d;l.context=e;return m};SC._ChainObserver.prototype={isChainObserver:true,object:null,property:null,next:null,target:null,method:null,objectDidChange:function(d){if(d===this.object){return
}if(this.object&&this.object.removeObserver){this.object.removeObserver(this.property,this,this.propertyDidChange)
}this.object=d;if(this.object&&this.object.addObserver){this.object.addObserver(this.property,this,this.propertyDidChange)
}this.propertyDidChange()},propertyDidChange:function(){var e=this.object;var j=this.property;
var h=(e&&e.get)?e.get(j):null;if(this.next){this.next.objectDidChange(h)}var k=this.target,l=this.method,g=this.context;
if(k&&l){var d=e?e.propertyRevision:null;if(g){l.call(k,e,j,h,g,d)}else{l.call(k,e,j,h,d)
}}},destroyChain:function(){var d=this.object;if(d&&d.removeObserver){d.removeObserver(this.property,this,this.propertyDidChange)
}if(this.next){this.next.destroyChain()}this.next=this.target=this.method=this.object=this.context=null;
return null}};sc_require("mixins/observable");sc_require("system/set");SC.Observers={queue:[],addObserver:function(g,h,j,e){var d;
if(SC.typeOf(g)===SC.T_STRING){d=SC.tupleForPropertyPath(g,e)}else{d=g}if(d){d[0].addObserver(d[1],h,j)
}else{this.queue.push([g,h,j,e])}},removeObserver:function(k,l,m,h){var g,e,d,j;d=SC.tupleForPropertyPath(k,h);
if(d){d[0].removeObserver(d[1],l,m)}g=this.queue.length;e=this.queue;while(--g>=0){j=e[g];
if((j[0]===k)&&(j[1]===l)&&(j[2]==m)&&(j[3]===h)){e[g]=null}}},addPendingRangeObserver:function(d){var e=this.rangeObservers;
if(!e){e=this.rangeObservers=SC.CoreSet.create()}e.add(d);return this},_TMP_OUT:[],flush:function(d){var j=this.queue;
if(j&&j.length>0){var m=(this.queue=[]);var n=j.length;while(--n>=0){var o=j[n];if(!o){continue
}var k=SC.tupleForPropertyPath(o[0],o[3]);if(k){k[0].addObserver(k[1],o[1],o[2])}else{m.push(o)
}}}if(d._kvo_needsRangeObserver){var l=this.rangeObservers,h=l?l.get("length"):0,e=this._TMP_OUT,g;
for(n=0;n<h;n++){g=l[n];if(g.setupPending(d)){e.push(g)}}if(e.length>0){l.removeEach(e)
}e.length=0;d._kvo_needsRangeObserver=NO}},isObservingSuspended:0,_pending:SC.CoreSet.create(),objectHasPendingChanges:function(d){this._pending.add(d)
},suspendPropertyObserving:function(){this.isObservingSuspended++},resumePropertyObserving:function(){var g;
if(--this.isObservingSuspended<=0){g=this._pending;this._pending=SC.CoreSet.create();
var e,d=g.length;for(e=0;e<d;e++){g[e]._notifyPropertyObservers()}g.clear();g=null
}}};SC.ObserverSet={targets:0,_membersCacheIsValid:NO,add:function(h,k,e){var g=(h)?SC.guidFor(h):"__this__";
var d=this[g];if(!d){d=this[g]=SC.CoreSet.create();d.target=h;d.isTargetSet=YES;this.targets++
}d.add(k);if(e!==undefined){var j=d.contexts;if(!j){e=d.contexts={}}j[SC.guidFor(k)]=e
}this._membersCacheIsValid=NO},remove:function(g,h){var e=(g)?SC.guidFor(g):"__this__";
var d=this[e];if(!d){return NO}d.remove(h);if(d.length<=0){d.target=null;d.isTargetSet=NO;
d.contexts=null;delete this[e];this.targets--}else{if(d.contexts){delete d.contexts[SC.guidFor(h)]
}}this._membersCacheIsValid=NO;return YES},invokeMethods:function(){var e,g,d,h,j;
for(e in this){if(!this.hasOwnProperty(e)){continue}g=this[e];if(g&&g.isTargetSet){d=g.length;
h=g.target;while(--d>=0){j=g[d];if(j){j.call(h)}}}}},getMembers:function(){if(this._membersCacheIsValid){return this._members
}if(!this._members){this._members=[]}else{this._members.length=0}var e=this._members;
for(var g in this){if(!this.hasOwnProperty(g)){continue}var h=this[g];if(h&&h.isTargetSet){var d=h.length;
var j=h.target;var l=h.contexts;if(l){while(--d>=0){var k=h[d];e.push([j,k,l[SC.guidFor(k)]])
}}else{while(--d>=0){e.push([j,h[d]])}}}}this._membersCacheIsValid=YES;return e},clone:function(){var e,h,g,d=SC.ObserverSet.create();
for(g in this){if(!this.hasOwnProperty(g)){continue}e=this[g];if(e&&e.isTargetSet){h=e.clone();
h.target=e.target;if(e.contexts){h.contexts=SC.clone(e.contexts)}d[g]=h}}d.targets=this.targets;
d._membersCacheIsValid=NO;return d},create:function(){return SC.beget(this)}};SC.ObserverSet.slice=SC.ObserverSet.clone;
SC.ObservableProtocol={propertyObserver:function(d,j,g,h,e){}};SC.SparseArrayDelegate={sparseArrayDidRequestLength:function(d){},sparseArrayDidRequestIndex:function(d,e){},sparseArrayDidRequestRange:function(e,d){},sparseArrayDidRequestIndexOf:function(d,e){},sparseArrayShouldReplace:function(e,d,h,g){return NO
},sparseArrayDidReset:function(d){}};sc_require("system/object");SC.LOG_BINDINGS=NO;
SC.BENCHMARK_BINDING_NOTIFICATIONS=NO;SC.BENCHMARK_BINDING_SETUP=NO;SC.MULTIPLE_PLACEHOLDER="@@MULT@@";
SC.NULL_PLACEHOLDER="@@NULL@@";SC.EMPTY_PLACEHOLDER="@@EMPTY@@";SC.Binding={beget:function(e){var d=SC.beget(this);
d.parentBinding=this;if(e!==undefined){d=d.from(e)}return d},builder:function(){var e=this,d=function(g){return e.beget().from(g)
};d.beget=function(){return e.beget()};return d},from:function(e,d){if(!e){return this
}var g=(this===SC.Binding)?this.beget():this;g._fromPropertyPath=e;g._fromRoot=d;
g._fromTuple=null;return g},to:function(e,d){var g=(this===SC.Binding)?this.beget():this;
g._toPropertyPath=e;g._toRoot=d;g._toTuple=null;return g},connect:function(){if(this.isConnected){return this
}this.isConnected=YES;this._connectionPending=YES;this._syncOnConnect=YES;SC.Binding._connectQueue.add(this);
return this},_connect:function(){if(!this._connectionPending){return}this._connectionPending=NO;
var g,d,e=SC.BENCHMARK_BINDING_SETUP;if(e){SC.Benchmark.start("SC.Binding.connect()")
}g=this._fromPropertyPath;d=this._fromRoot;if(SC.typeOf(g)===SC.T_STRING){if(g.indexOf(".")===0){g=g.slice(1);
if(!d){d=this._toRoot}}else{if(g.indexOf("*")===0){g=[this._fromRoot||this._toRoot,g.slice(1)];
d=null}}}SC.Observers.addObserver(g,this,this.fromPropertyDidChange,d);if(!this._oneWay){g=this._toPropertyPath;
d=this._toRoot;SC.Observers.addObserver(g,this,this.toPropertyDidChange,d)}if(e){SC.Benchmark.end("SC.Binding.connect()")
}if(this._syncOnConnect){this._syncOnConnect=NO;if(e){SC.Benchmark.start("SC.Binding.connect().sync")
}this.sync();if(e){SC.Benchmark.end("SC.Binding.connect().sync")}}},disconnect:function(){if(!this.isConnected){return this
}if(this._connectionPending){this._connectionPending=NO}else{SC.Observers.removeObserver(this._fromPropertyPath,this,this.fromPropertyDidChange,(this._fromRoot||this._toRoot));
if(!this._oneWay){SC.Observers.removeObserver(this._toPropertyPath,this,this.toPropertyDidChange,this._toRoot)
}}this.isConnected=NO;return this},fromPropertyDidChange:function(g,e){var d=g?g.get(e):null;
if(d!==this._bindingValue||e==="[]"){this._setBindingValue(g,e);this._changePending=YES;
SC.Binding._changeQueue.add(this)}},toPropertyDidChange:function(g,e){if(this._oneWay){return
}var d=g.get(e);if(d!==this._transformedBindingValue){this._setBindingValue(g,e);
this._changePending=YES;SC.Binding._changeQueue.add(this)}},_setBindingValue:function(e,d){this._bindingSource=e;
this._bindingKey=d},_computeBindingValue:function(){var l=this._bindingSource,j=this._bindingKey,g,e;
this._bindingValue=g=(l?l.getPath(j):null);var k=this._transforms;if(k){var d=k.length,h;
for(e=0;e<d;e++){h=k[e];g=h(g,this)}}if(this._noError&&SC.typeOf(g)===SC.T_ERROR){g=null
}this._transformedBindingValue=g},_connectQueue:SC.CoreSet.create(),_alternateConnectQueue:SC.CoreSet.create(),_changeQueue:SC.CoreSet.create(),_alternateChangeQueue:SC.CoreSet.create(),_changePending:NO,flushPendingChanges:function(){if(this._isFlushing){return NO
}this._isFlushing=YES;SC.Observers.suspendPropertyObserving();var e=NO,g=SC.LOG_BINDINGS,d,h;
while((d=this._connectQueue).length>0){this._connectQueue=this._alternateConnectQueue;
this._alternateConnectQueue=d;while(h=d.pop()){h._connect()}}while((d=this._changeQueue).length>0){if(g){console.log("Begin: Trigger changed bindings")
}e=YES;this._changeQueue=this._alternateChangeQueue;this._alternateChangeQueue=d;
while(h=d.pop()){h.applyBindingValue()}if(g){console.log("End: Trigger changed bindings")
}}this._isFlushing=NO;SC.Observers.resumePropertyObserving();return e},applyBindingValue:function(){this._changePending=NO;
this._computeBindingTargets();this._computeBindingValue();var d=this._bindingValue,e=this._transformedBindingValue,g=SC.BENCHMARK_BINDING_NOTIFICATIONS,h=SC.LOG_BINDINGS;
if(!this._oneWay&&this._fromTarget){if(h){console.log("%@: %@ -> %@".fmt(this,d,e))
}if(g){SC.Benchmark.start(this.toString()+"->")}this._fromTarget.setPathIfChanged(this._fromPropertyKey,d);
if(g){SC.Benchmark.end(this.toString()+"->")}}if(this._toTarget){if(h){console.log("%@: %@ <- %@".fmt(this,d,e))
}if(g){SC.Benchmark.start(this.toString()+"<-")}this._toTarget.setPathIfChanged(this._toPropertyKey,e);
if(g){SC.Benchmark.start(this.toString()+"<-")}}},sync:function(){if(!this.isConnected){return this
}if(this._connectionPending){this._syncOnConnect=YES}else{this._computeBindingTargets();
var g=this._fromTarget,e=this._fromPropertyKey;if(!g||!e){return this}var d=g.getPath(e);
if(d!==this._bindingValue||e==="[]"){this._setBindingValue(g,e);this._changePending=YES;
SC.Binding._changeQueue.add(this)}}return this},_syncOnConnect:NO,_computeBindingTargets:function(){if(!this._fromTarget){var g,e,d;
g=this._fromPropertyPath;e=this._fromRoot;if(SC.typeOf(g)===SC.T_STRING){if(g.indexOf(".")===0){g=g.slice(1);
if(!e){e=this._toRoot}}else{if(g.indexOf("*")===0){g=[e||this._toRoot,g.slice(1)];
e=null}}}d=SC.tupleForPropertyPath(g,e);if(d){this._fromTarget=d[0];this._fromPropertyKey=d[1]
}}if(!this._toTarget){g=this._toPropertyPath;e=this._toRoot;d=SC.tupleForPropertyPath(g,e);
if(d){this._toTarget=d[0];this._toPropertyKey=d[1]}}},oneWay:function(g,d){if((d===undefined)&&(SC.typeOf(g)===SC.T_BOOL)){d=g;
g=null}var e=this.from(g);if(e===SC.Binding){e=e.beget()}e._oneWay=(d===undefined)?YES:d;
return e},transform:function(e){var g=(this===SC.Binding)?this.beget():this;var d=g._transforms;
if(d&&(d===g.parentBinding._transform)){d=g._transforms=d.slice()}if(!d){d=g._transforms=[]
}d.push(e);return g},resetTransforms:function(){var d=(this===SC.Binding)?this.beget():this;
d._transforms=null;return d},noError:function(g,d){if((d===undefined)&&(SC.typeOf(g)===SC.T_BOOL)){d=g;
g=null}var e=this.from(g);if(e===SC.Binding){e=e.beget()}e._noError=(d===undefined)?YES:d;
return e},single:function(e,d){if(d===undefined){d=SC.MULTIPLE_PLACEHOLDER}return this.from(e).transform(function(j,h){if(j&&j.isEnumerable){var g=j.get("length");
j=(g>1)?d:(g<=0)?null:j.firstObject()}return j})},notEmpty:function(e,d){if(d===undefined){d=SC.EMPTY_PLACEHOLDER
}return this.from(e).transform(function(h,g){if(SC.none(h)||(h==="")||(SC.isArray(h)&&h.length===0)){h=d
}return h})},notNull:function(e,d){if(d===undefined){d=SC.EMPTY_PLACEHOLDER}return this.from(e).transform(function(h,g){if(SC.none(h)){h=d
}return h})},multiple:function(d){return this.from(d).transform(function(e){if(!SC.isArray(e)){e=(e==null)?[]:[e]
}return e})},bool:function(d){return this.from(d).transform(function(e){var g=SC.typeOf(e);
if(g===SC.T_ERROR){return e}return(g==SC.T_ARRAY)?(e.length>0):(e==="")?NO:!!e})},and:function(e,d){var g=SC.Object.create({valueABinding:e,valueBBinding:d,and:function(){return(this.get("valueA")&&this.get("valueB"))
}.property("valueA","valueB").cacheable()});return this.from("and",g).oneWay()},or:function(e,d){var g=SC.Object.create({valueABinding:e,valueBBinding:d,or:function(){return(this.get("valueA")||this.get("valueB"))
}.property("valueA","valueB").cacheable()});return this.from("or",g).oneWay()},not:function(d){return this.from(d).transform(function(e){var g=SC.typeOf(e);
if(g===SC.T_ERROR){return e}return !((g==SC.T_ARRAY)?(e.length>0):(e==="")?NO:!!e)
})},isNull:function(d){return this.from(d).transform(function(e){var g=SC.typeOf(e);
return(g===SC.T_ERROR)?e:SC.none(e)})},toString:function(){var g=this._fromRoot?"<%@>:%@".fmt(this._fromRoot,this._fromPropertyPath):this._fromPropertyPath;
var e=this._toRoot?"<%@>:%@".fmt(this._toRoot,this._toPropertyPath):this._toPropertyPath;
var d=this._oneWay?"[oneWay]":"";return"SC.Binding%@(%@ -> %@)%@".fmt(SC.guidFor(this),g,e,d)
}};SC.binding=function(e,d){return SC.Binding.from(e,d)};SC.Cookie=SC.Object.extend({name:null,value:"",expires:null,path:null,domain:null,secure:NO,isCookie:YES,destroy:function(){this.set("expires",-1);
this.write();arguments.callee.base.apply(this,arguments)},write:function(){var e=this.get("name"),n=this.get("value"),g=this.get("expires"),p=this.get("path"),j=this.get("domain"),d=this.get("secure");
var m="";if(g&&(SC.typeOf(g)===SC.T_NUMBER||(SC.DateTime&&g.get&&g.get("milliseconds"))||SC.typeOf(g.toUTCString)===SC.T_FUNCTION)){var h;
if(SC.typeOf(g)===SC.T_NUMBER){h=new Date();h.setTime(h.getTime()+(g*24*60*60*1000))
}else{if(SC.DateTime&&g.get&&g.get("milliseconds")){h=new Date(g.get("milliseconds"))
}else{if(SC.typeOf(g.toUTCString)===SC.T_FUNCTION){h=g}}}if(h){m="; expires="+h.toUTCString()
}}var o=p?"; path="+p:"";var l=j?"; domain="+j:"";var k=d?"; secure":"";document.cookie=[e,"=",encodeURIComponent(n),m,o,l,k].join("");
return this}});SC.Cookie.mixin({find:function(d){if(document.cookie&&document.cookie!=""){var h=document.cookie.split(";");
for(var g=0;g<h.length;g++){var e=String(h[g]).trim();if(e.substring(0,d.length+1)===(d+"=")){return SC.Cookie.create({name:d,value:decodeURIComponent(e.substring(d.length+1))})
}}}return null}});SC.Enumerator=function(d){this.enumerable=d;this.reset();return this
};SC.Enumerator.prototype={nextObject:function(){var g=this._index;var d=this._length;
if(g>=d){return undefined}var e=this.enumerable.nextObject(g,this._previousObject,this._context);
this._previousObject=e;this._index=g+1;if(g>=d){this._context=SC.Enumerator._pushContext(this._context)
}return e},reset:function(){var g=this.enumerable;if(!g){throw SC.$error("Enumerator has been destroyed")
}this._length=g.get?g.get("length"):g.length;var d=this._length;this._index=0;this._previousObject=null;
this._context=(d>0)?SC.Enumerator._popContext():null},destroy:function(){this.enumerable=this._length=this._index=this._previousObject=this._context=null
}};SC.Enumerator.create=function(d){return new SC.Enumerator(d)};SC.Enumerator._popContext=function(){var d=this._contextCache?this._contextCache.pop():null;
return d||{}};SC.Enumerator._pushContext=function(e){this._contextCache=this._contextCache||[];
var d=this._contextCache;d.push(e);return null};SC.Error=SC.Object.extend({code:-1,message:"",errorValue:null,errorObject:function(){return this
}.property().cacheable(),label:null,toString:function(){return"SC.Error:%@:%@ (%@)".fmt(SC.guidFor(this),this.get("message"),this.get("code"))
},isError:YES});SC.Error.desc=function(h,d,j,g){var e={message:h};if(d!==undefined){e.label=d
}if(g!==undefined){e.code=g}if(j!==undefined){e.errorValue=j}return this.create(e)
};SC.$error=function(e,d,g,h){return SC.Error.desc(e,d,g,h)};SC.ok=function(d){return(d!==false)&&!(d&&d.isError)
};SC.$ok=SC.ok;SC.val=function(d){if(d&&d.isError){return d.get?d.get("errorValue"):null
}else{return d}};SC.$val=SC.val;SC.Error.HAS_MULTIPLE_VALUES=-100;sc_require("mixins/enumerable");
sc_require("mixins/observable");sc_require("mixins/freezable");sc_require("mixins/copyable");
SC.IndexSet=SC.mixin({},SC.Enumerable,SC.Observable,SC.Freezable,SC.Copyable,{_sc_sliceContent:function(h){if(h.length<1000){return h.slice()
}var g=0,d=[],e=h[0];while(e!==0){d[g]=e;g=(e<0)?(0-e):e;e=h[g]}d[g]=0;this._hint(0,g,d);
return d},create:function(g,e){var d=SC.beget(this);d.initObservable();d.registerDependentKey("min","[]");
if(g&&g.isIndexSet){d._content=this._sc_sliceContent(g._content);d.max=g.max;d.length=g.length;
d.source=g.source}else{d._content=[0];if(g!==undefined){d.add(g,e)}}return d},isIndexSet:YES,HINT_SIZE:256,length:0,max:0,min:function(){var d=this._content,e=d[0];
return(e===0)?-1:(e>0)?0:Math.abs(e)}.property("[]").cacheable(),firstObject:function(){return(this.get("length")>0)?this.get("min"):undefined
}.property(),rangeStartForIndex:function(g){var k=this._content,d=this.get("max"),e,j,h;
if(g>=d){return d}if(Math.abs(k[g])>g){return g}h=g-(g%SC.IndexSet.HINT_SIZE);e=k[h];
if(e<0||e>g){e=h}j=Math.abs(k[e]);while(j<g){e=j;j=Math.abs(k[e])}return e},isEqual:function(g){if(g===this){return YES
}if(!g||!g.isIndexSet||(g.max!==this.max)||(g.length!==this.length)){return NO}var j=this._content,e=g._content,h=0,d=j[h];
do{if(e[h]!==d){return NO}h=Math.abs(d);d=j[h]}while(h!==0);return YES},indexBefore:function(e){if(e===0){return -1
}e--;var g=this._content,d=this.get("max"),h=this.rangeStartForIndex(e);if(!g){return null
}while((h===d)||(g[h]<0)){if(h===0){return -1}e=h-1;h=this.rangeStartForIndex(e)}return e
},indexAfter:function(e){var h=this._content,d=this.get("max"),j,g;if(!h||(e>=d)){return -1
}e++;j=this.rangeStartForIndex(e);g=h[j];while(g<0){if(g===0){return -1}e=j=Math.abs(g);
g=h[j]}return e},contains:function(l,g){var e,k,d,j,h;if(g===undefined){if(l===null||l===undefined){return NO
}if(typeof l===SC.T_NUMBER){g=1}else{if(l&&l.isIndexSet){if(l===this){return YES}e=l._content;
k=0;d=e[k];while(d!==0){if((d>0)&&!this.contains(k,d-k)){return NO}k=Math.abs(d);
d=e[k]}return YES}else{g=l.length;l=l.start}}}j=this.rangeStartForIndex(l);h=this._content[j];
return(h>0)&&(j<=l)&&(h>=(l+g))},intersects:function(k,g){var e,j,d,h;if(g===undefined){if(typeof k===SC.T_NUMBER){g=1
}else{if(k&&k.isIndexSet){if(k===this){return YES}e=k._content;j=0;d=e[j];while(d!==0){if((d>0)&&this.intersects(j,d-j)){return YES
}j=Math.abs(d);d=e[j]}return NO}else{g=k.length;k=k.start}}}j=this.rangeStartForIndex(k);
e=this._content;d=e[j];h=k+g;while(j<h){if(d===0){return NO}if((d>0)&&(d>k)){return YES
}j=Math.abs(d);d=e[j]}return NO},without:function(e,d){if(e===this){return SC.IndexSet.create()
}return this.clone().remove(e,d)},replace:function(g,d){if(d===undefined){if(typeof g===SC.T_NUMBER){d=1
}else{if(g&&g.isIndexSet){this._content=this._sc_sliceContent(g._content);this.beginPropertyChanges().set("max",g.max).set("length",g.length).set("source",g.source).enumerableContentDidChange().endPropertyChanges();
return this}else{d=g.length;g=g.start}}}var e=this.length;this._content.length=1;
this._content[0]=0;this.length=this.max=0;return this.add(g,d)},add:function(d,e){if(this.isFrozen){throw SC.FROZEN_ERROR
}var j,n,h;if(d&&d.isIndexSet){j=d._content;if(!j){return this}n=0;h=j[0];while(h!==0){if(h>0){this.add(n,h-n)
}n=h<0?0-h:h;h=j[n]}return this}else{if(e===undefined){if(d===null||d===undefined){return this
}else{if(typeof d===SC.T_NUMBER){e=1}else{e=d.length;d=d.start}}}else{if(e===null){e=1
}}}if(e<=0){return this}var k=this.get("max"),g=k,m,l;j=this._content;if(d===k){if(d>0){n=this.rangeStartForIndex(d-1);
h=j[n];if(h>0){delete j[k];j[n]=k=d+e;d=n}else{j[k]=k=d+e}}else{j[d]=k=e}j[k]=0;this.set("max",k);
this.set("length",this.length+e);e=k-d}else{if(d>k){j[k]=0-d;j[d]=d+e;j[d+e]=0;this.set("max",d+e);
this.set("length",this.length+e);e=d+e-k;d=k}else{n=this.rangeStartForIndex(d);h=j[n];
k=d+e;m=0;if((d>0)&&(n===d)&&(h<=0)){n=this.rangeStartForIndex(d-1);h=j[n]}if(h<0){j[n]=0-d;
if(Math.abs(h)>k){j[d]=0-k;j[k]=h}else{j[d]=h}}else{d=n;if(h>k){k=h}}n=d;while(n<k){l=j[n];
if(l===0){j[k]=0;h=k;m+=k-n}else{h=Math.abs(l);if(h>k){j[k]=l;h=k}if(l<0){m+=h-n}}delete j[n];
n=h}if((n=j[k])>0){delete j[k];k=n}j[d]=k;if(k>g){this.set("max",k)}this.set("length",this.get("length")+m);
e=k-d}}this._hint(d,e);if(m!==0){this.enumerableContentDidChange()}return this},remove:function(d,e){if(this.isFrozen){throw SC.FROZEN_ERROR
}if(e===undefined){if(d===null||d===undefined){return this}else{if(typeof d===SC.T_NUMBER){e=1
}else{if(d.isIndexSet){d.forEachRange(this.remove,this);return this}else{e=d.length;
d=d.start}}}}if(e<=0){return this}var k=this.get("max"),g=k,j=this._content,o,h,n,l,m;
if(d>=k){return this}o=this.rangeStartForIndex(d);h=j[o];m=d+e;n=0;if((d>0)&&(o===d)&&(h>0)){o=this.rangeStartForIndex(d-1);
h=j[o]}if(h>0){j[o]=d;if(h>m){j[d]=m;j[m]=h}else{j[d]=h}}else{d=o;h=Math.abs(h);if(h>m){m=h
}}o=d;while(o<m){l=j[o];if(l===0){j[m]=0;h=m}else{h=Math.abs(l);if(h>m){j[m]=l;h=m
}if(l>0){n+=h-o}}delete j[o];o=h}if((o=j[m])<0){delete j[m];m=Math.abs(o)}if(j[m]===0){delete j[m];
j[d]=0;this.set("max",d)}else{j[d]=0-m}this.set("length",this.get("length")-n);e=m-d;
this._hint(d,e);if(n!==0){this.enumerableContentDidChange()}return this},_hint:function(l,h,g){if(g===undefined){g=this._content
}var e=SC.IndexSet.HINT_SIZE,d=Math.abs(g[l]),k=l-(l%e)+e,j=l+h;while(k<j){while((d!==0)&&(d<=k)){l=d;
d=Math.abs(g[l])}if(d===0){delete g[k]}else{if(k!==l){g[k]=l}}k+=e}},clear:function(){if(this.isFrozen){throw SC.FROZEN_ERROR
}var d=this.length;this._content.length=1;this._content[0]=0;this.set("length",0).set("max",0);
if(d>0){this.enumerableContentDidChange()}},addEach:function(e){if(this.isFrozen){throw SC.FROZEN_ERROR
}this.beginPropertyChanges();var d=e.get("length");if(e.isSCArray){while(--d>=0){this.add(e.objectAt(d))
}}else{if(e.isEnumerable){e.forEach(function(g){this.add(g)},this)}}this.endPropertyChanges();
return this},removeEach:function(e){if(this.isFrozen){throw SC.FROZEN_ERROR}this.beginPropertyChanges();
var d=e.get("length");if(e.isSCArray){while(--d>=0){this.remove(e.objectAt(d))}}else{if(e.isEnumerable){e.forEach(function(g){this.remove(g)
},this)}}this.endPropertyChanges();return this},clone:function(){return SC.IndexSet.create(this)
},inspect:function(){var j=this._content,e=j.length,d=0,g=[],h;for(d=0;d<e;d++){h=j[d];
if(h!==undefined){g.push("%@:%@".fmt(d,h))}}return"SC.IndexSet<%@>".fmt(g.join(" , "))
},forEachRange:function(k,h){var e=this._content,j=0,d=e[j],g=this.source;if(h===undefined){h=null
}while(d!==0){if(d>0){k.call(h,j,d-j,this,g)}j=Math.abs(d);d=e[j]}return this},forEachIn:function(e,g,o,k){var l=this._content,n=0,m=0,h=e+g,d=this.source,j=l[n];
if(k===undefined){k=null}while(j!==0){if(n<e){n=e}while((n<j)&&(n<h)){o.call(k,n++,m++,this,d)
}if(n>=h){n=j=0}else{n=Math.abs(j);j=l[n]}}return this},lengthIn:function(l,h){var d=0;
if(h===undefined){if(l===null||l===undefined){return 0}else{if(typeof l===SC.T_NUMBER){h=1
}else{if(l.isIndexSet){l.forEachRange(function(n,m){d+=this.lengthIn(n,m)},this);
return d}else{h=l.length;l=l.start}}}}if(this.get("length")===0){return 0}var g=this._content,k=0,e=g[k],j=l+h;
while(k<j&&e!==0){if(e>0){d+=(e>j)?j-k:e-k}k=Math.abs(e);e=g[k]}return d},source:null,indexOf:function(h,g){var k=this.source;
if(!k){throw"%@.indexOf() requires source".fmt(this)}var e=k.get("length"),j=this._content,l=j[0]<0?Math.abs(j[0]):0,d;
while(l>=0&&l<e){d=k.indexOf(h,l);if(d<0){return -1}if(this.contains(d)){return d
}l=d+1}return -1},lastIndexOf:function(h,g){var j=this.source;if(!j){throw"%@.lastIndexOf() requires source".fmt(this)
}var e=j.get("length"),k=this.max-1,d;if(k>=e){k=e-1}while(k>=0){d=j.lastIndexOf(h,k);
if(d<0){return -1}if(this.contains(d)){return d}k=d+1}return -1},forEachObject:function(l,j){var h=this.source;
if(!h){throw"%@.forEachObject() requires source".fmt(this)}var g=this._content,k=0,d=0,e=g[k];
if(j===undefined){j=null}while(e!==0){while(k<e){l.call(j,h.objectAt(k),k,h,this);
k++}k=Math.abs(e);e=g[k]}return this},addObject:function(g,h){var j=this.source;if(!j){throw"%@.addObject() requires source".fmt(this)
}var e=j.get("length"),k=0,d;while(k>=0&&k<e){d=j.indexOf(g,k);if(d>=0){this.add(d);
if(h){return this}k=d++}else{return this}}return this},addObjects:function(e,d){e.forEach(function(g){this.addObject(g,d)
},this);return this},removeObject:function(g,h){var j=this.source;if(!j){throw"%@.removeObject() requires source".fmt(this)
}var e=j.get("length"),k=0,d;while(k>=0&&k<e){d=j.indexOf(g,k);if(d>=0){this.remove(d);
if(h){return this}k=d+1}else{return this}}return this},removeObjects:function(e,d){e.forEach(function(g){this.removeObject(g,d)
},this);return this},LOG_OBSERVING:NO,forEach:function(l,j){var g=this._content,k=0,d=0,h=this.source,e=g[k];
if(j===undefined){j=null}while(e!==0){while(k<e){l.call(j,k++,d++,this,h)}k=Math.abs(e);
e=g[k]}return this},nextObject:function(k,e,g){var j=this._content,h=g.next,d=this.get("max");
if(e===null){e=h=0}else{if(e>=d){delete g.next;return null}else{e++}}if(e===h){do{e=Math.abs(h);
h=j[e]}while(h<0);g.next=h}return e},toString:function(){var d=[];this.forEachRange(function(g,e){d.push(e===1?g:"%@..%@".fmt(g,g+e-1))
},this);return"SC.IndexSet<%@>".fmt(d.join(","))},max:0});SC.IndexSet.slice=SC.IndexSet.copy=SC.IndexSet.clone;
SC.IndexSet.EMPTY=SC.IndexSet.create().freeze();SC.LOGGER_LOG_DELIMITER=", ";SC.LOGGER_LOG_ERROR="ERROR: ";
SC.LOGGER_LOG_INFO="INFO: ";SC.LOGGER_LOG_WARN="WARNING: ";SC.LOGGER_LOG_DEBUG="DEBUG: ";
SC.Logger=SC.Object.create({debugEnabled:NO,exists:function(){return typeof(this.get("reporter"))!=="undefined"&&this.get("reporter")!=null
}.property("reporter").cacheable(),fallBackOnAlert:NO,fallBackOnLog:YES,format:YES,reporter:console,log:function(){var d=this.get("reporter");
if(this.get("exists")&&typeof(d.log)==="function"){if(this.get("format")){d.log(this._argumentsToString.apply(this,arguments))
}else{d.log.apply(d,arguments)}return true}else{if(this.fallBackOnAlert){var e=this.get("format")?this._argumentsToString.apply(this,arguments):arguments;
if(this.get("exists")&&typeof(d.alert)==="function"){d.alert(e)}else{alert(e)}return true
}}return false},debug:function(){var e=this.get("reporter");if(this.get("debugEnabled")!==YES){return false
}if(this.get("exists")&&(typeof e.debug==="function")){e.debug.apply(e,arguments);
return true}else{if(this.fallBackOnLog){var d=this._argumentsToArray(arguments);if(typeof(d.unshift)==="function"){d.unshift(SC.LOGGER_LOG_DEBUG)
}return this.log.apply(this,d)}}return false},dir:function(){var d=this.get("reporter");
if(this.get("exists")&&typeof(d.dir)==="function"){d.dir.apply(d,arguments);return true
}return(this.fallBackOnLog)?this.log.apply(this,arguments):false},dirxml:function(){var d=this.get("reporter");
if(this.get("exists")&&typeof(d.dirxml)==="function"){d.dirxml.apply(d,arguments);
return true}return(this.fallBackOnLog)?this.log.apply(this,arguments):false},error:function(){var e=this.get("reporter");
if(this.get("exists")&&typeof(e.error)==="function"){e.error.apply(e,arguments);return true
}else{if(this.fallBackOnLog){var d=this._argumentsToArray(arguments);if(typeof(d.unshift)==="function"){d.unshift(SC.LOGGER_LOG_ERROR)
}return this.log.apply(this,d)}}return false},group:function(e){var d=this.get("reporter");
if(this.get("exists")&&typeof(d.group)==="function"){d.group(e);return true}return false
},groupEnd:function(){var d=this.get("reporter");if(this.get("exists")&&typeof(d.groupEnd)==="function"){d.groupEnd();
return true}return false},info:function(){var e=this.get("reporter");if(this.get("exists")&&typeof(e.info)==="function"){e.info.apply(e,arguments);
return true}else{if(this.fallBackOnLog){var d=this._argumentsToArray(arguments);if(typeof(d.unshift)==="function"){d.unshift(SC.LOGGER_LOG_INFO)
}return this.log.apply(this,d)}}return false},profile:function(){var d=this.get("reporter");
if(this.get("exists")&&typeof(d.profile)==="function"){d.profile();return true}return false
},profileEnd:function(){var d=this.get("reporter");if(this.get("exists")&&typeof(d.profileEnd)==="function"){d.profileEnd();
return true}return false},time:function(e){var d=this.get("reporter");if(this.get("exists")&&typeof(d.time)==="function"){d.time(e);
return true}return false},timeEnd:function(e){var d=this.get("reporter");if(this.get("exists")&&typeof(d.timeEnd)==="function"){d.timeEnd(e);
return true}return false},trace:function(){var d=this.get("reporter");if(this.get("exists")&&typeof(d.trace)==="function"){d.trace();
return true}return false},warn:function(){var e=this.get("reporter");if(this.get("exists")&&typeof(e.warn)==="function"){e.warn.apply(e,arguments);
return true}else{if(this.fallBackOnLog){var d=this._argumentsToArray(arguments);if(typeof(d.unshift)==="function"){d.unshift(SC.LOGGER_LOG_WARN)
}return this.log.apply(this,d)}}return false},_argumentsToArray:function(g){if(!g){return[]
}var d=[];for(var e=0;e<g.length;e++){d[e]=g[e]}return d},_argumentsToString:function(){var e="";
for(var d=0;d<arguments.length-1;d++){e+=arguments[d]+SC.LOGGER_LOG_DELIMITER}e+=arguments[arguments.length-1];
return e}});sc_require("core");sc_require("mixins/observable");sc_require("mixins/array");
sc_require("system/set");SC.BENCHMARK_OBJECTS=NO;SC._object_extend=function _object_extend(l,k){if(!k){throw"SC.Object.extend expects a non-null value.  Did you forget to 'sc_require' something?  Or were you passing a Protocol to extend() as if it were a mixin?"
}l._kvo_cloned=null;var G,u,C,j,m=l.concatenatedProperties,p=SC.K;var g,e;u=(m)?m.length:0;
var d=(u>0)?{}:null;while(--u>=0){G=m[u];g=l[G];e=k[G];if(g){if(!(g instanceof Array)){g=SC.$A(g)
}d[G]=(e)?g.concat(e):e}else{if(!(e instanceof Array)){e=SC.$A(e)}d[G]=e}}var F=l._bindings,s=NO;
var D=l._observers,E=NO;var n=l._properties,h=NO;var z,o,x;var B=l.outlets,A=NO;if(k.outlets){B=(B||SC.EMPTY_ARRAY).concat(k.outlets);
A=YES}for(G in k){if(G==="_kvo_cloned"){continue}if(!k.hasOwnProperty(G)){continue
}var y=(d.hasOwnProperty(G)?d[G]:null)||k[G];if(G.slice(-7)==="Binding"){if(!s){F=(F||SC.EMPTY_ARRAY).slice();
s=YES}if(F===null){F=(l._bindings||SC.EMPTY_ARRAY).slice()}F[F.length]=G}else{if(y&&(y instanceof Function)){if(!y.superclass&&(y!==(j=l[G]))){y.superclass=y.base=j||p
}if(y.propertyPaths){if(!E){D=(D||SC.EMPTY_ARRAY).slice();E=YES}D[D.length]=G}else{if(z=y.localPropertyPaths){o=z.length;
while(--o>=0){x=l._kvo_for(SC.keyFor("_kvo_local",z[o]),SC.Set);x.add(G);l._kvo_for("_kvo_observed_keys",SC.CoreSet).add(z[o])
}}else{if(y.dependentKeys){if(!h){n=(n||SC.EMPTY_ARRAY).slice();h=YES}n[n.length]=G
}else{if(y.autoconfiguredOutlet){if(!A){B=(B||SC.EMPTY_ARRAY).slice();A=YES}B[B.length]=G
}}}}}}l[G]=y}if(k.hasOwnProperty("toString")){G="toString";y=(d.hasOwnProperty(G)?d[G]:null)||k[G];
if(!y.superclass&&(y!==(j=l[G]))){y.superclass=y.base=j||p}l[G]=y}l._bindings=F||[];
l._observers=D||[];l._properties=n||[];l.outlets=B||[];return l};SC.Object=function(d){return this._object_init(d)
};SC.mixin(SC.Object,{mixin:function(e){var d=arguments.length,g;for(g=0;g<d;g++){SC.mixin(this,arguments[g])
}return this},superclass:null,extend:function(j){var h=SC.BENCHMARK_OBJECTS;if(h){SC.Benchmark.start("SC.Object.extend")
}var l,g=function(m){return this._object_init(m)};for(l in this){if(!this.hasOwnProperty(l)){continue
}g[l]=this[l]}if(this.hasOwnProperty("toString")){g.toString=this.toString}g.superclass=this;
SC.generateGuid(g);g.subclasses=SC.Set.create();this.subclasses.add(g);var k=(g.prototype=SC.beget(this.prototype));
var e,d=arguments.length;for(e=0;e<d;e++){SC._object_extend(k,arguments[e])}k.constructor=g;
if(h){SC.Benchmark.end("SC.Object.extend")}return g},create:function(){var e=this,d=new e(arguments);
if(SC.ObjectDesigner){SC.ObjectDesigner.didCreateObject(d,SC.$A(arguments))}return d
},isClass:YES,subclasses:SC.Set.create(),toString:function(){return SC._object_className(this)
},subclassOf:function(e){if(this===e){return NO}var d=this;while(d=d.superclass){if(d===e){return YES
}}return NO},hasSubclass:function(d){return(d&&d.subclassOf)?d.subclassOf(this):NO
},kindOf:function(d){return(this===d)||this.subclassOf(d)},design:function(){if(this.isDesign){return this
}var d=this.extend.apply(this,arguments);d.isDesign=YES;if(SC.ObjectDesigner){SC.ObjectDesigner.didLoadDesign(d,this,SC.A(arguments))
}return d}});SC.Object.prototype={_kvo_enabled:YES,_object_init:function(g){var e,d=(g)?g.length:0;
for(e=0;e<d;e++){SC._object_extend(this,g[e])}SC.generateGuid(this);this.init();var h=this.initMixin;
d=(h)?h.length:0;for(e=0;e<d;e++){h[e].call(this)}return this},mixin:function(){var e,d=arguments.length;
for(e=0;e<d;e++){SC.mixin(this,arguments[e])}for(e=0;e<d;e++){var g=arguments[e].initMixin;
if(g){g.call(this)}}return this},init:function(){this.initObservable();return this
},isDestroyed:NO,destroy:function(){if(this.get("isDestroyed")){return this}this.set("isDestroyed",YES);
var e,g=this.destroyMixin,d=(g)?g.length:0;for(e=0;e<d;e++){g[e].call(this)}return this
},isObject:true,respondsTo:function(d){return !!(SC.typeOf(this[d])===SC.T_FUNCTION)
},tryToPerform:function(e,g,d){return this.respondsTo(e)&&(this[e](g,d)!==NO)},superclass:function(e){var d=arguments.callee.caller;
if(!d){throw"superclass cannot determine the caller method"}return d.superclass?d.superclass.apply(this,arguments):null
},instanceOf:function(d){return this.constructor===d},kindOf:function(d){return this.constructor.kindOf(d)
},toString:function(){if(!this._object_toString){var d=SC._object_className(this.constructor);
var e="%@:%@".fmt(d,SC.guidFor(this));if(d){this._object_toString=e}else{return e
}}return this._object_toString},awake:function(d){this.outlets.forEach(function(e){this.get(e)
},this);this.bindings.invoke("sync")},invokeOnce:function(d){SC.RunLoop.currentRunLoop.invokeOnce(this,d);
return this},invokeLast:function(d){SC.RunLoop.currentRunLoop.invokeLast(this,d);
return this},concatenatedProperties:["concatenatedProperties","initMixin","destroyMixin"]};
SC.Object.prototype.constructor=SC.Object;SC.mixin(SC.Object.prototype,SC.Observable);
function findClassNames(){if(SC._object_foundObjectClassNames){return}SC._object_foundObjectClassNames=true;
var e=[];var d=function(g,h,l){l--;if(e.indexOf(h)>=0){return}e.push(h);for(var j in h){if(j=="__scope__"){continue
}if(j=="superclass"){continue}if(!j.match(/^[A-Z0-9]/)){continue}var m=(g)?[g,j].join("."):j;
var k=h[j];switch(SC.typeOf(k)){case SC.T_CLASS:if(!k._object_className){k._object_className=m
}if(l>=0){d(m,k,l)}break;case SC.T_OBJECT:if(l>=0){d(m,k,l)}break;case SC.T_HASH:if(((g)||(m==="SC"))&&(l>=0)){d(m,k,l)
}break;default:break}}};d(null,window,2)}SC.instanceOf=function(d,e){return !!(d&&d.constructor===e)
};SC.kindOf=function(d,e){if(d&&!d.isClass){d=d.constructor}return !!(d&&d.kindOf&&d.kindOf(e))
};SC._object_className=function(e){if(!SC.isReady){return""}if(!e._object_className){findClassNames()
}if(e._object_className){return e._object_className}var d=e;while(d&&!d._object_className){d=d.superclass
}return(d&&d._object_className)?d._object_className:"Anonymous"};SC.RangeObserver={isRangeObserver:YES,toString:function(){var d=this.indexes?this.indexes.toString():"SC.IndexSet<..>";
return d.replace("IndexSet","RangeObserver(%@)".fmt(SC.guidFor(this)))},create:function(h,k,j,l,g,d){var e=SC.beget(this);
e.source=h;e.indexes=k?k.frozenCopy():null;e.target=j;e.method=l;e.context=g;e.isDeep=d||NO;
e.beginObserving();return e},extend:function(j){var h=SC.beget(this),g=arguments,e=g.length,d;
for(d=0;d<e;d++){SC.mixin(h,g[d])}return h},destroy:function(d){this.endObserving();
return this},update:function(d,e){if(this.indexes&&this.indexes.isEqual(e)){return this
}this.indexes=e?e.frozenCopy():null;this.endObserving().beginObserving();return this
},beginObserving:function(){if(!this.isDeep){return this}var e=this.observing;if(!e){e=this.observing=SC.CoreSet.create()
}var d=this._beginObservingForEach;if(!d){d=this._beginObservingForEach=function(g){var h=this.source.objectAt(g);
if(h&&h.addObserver){e.push(h);h._kvo_needsRangeObserver=YES}}}this.indexes.forEach(d,this);
this.isObserving=NO;SC.Observers.addPendingRangeObserver(this);return this},setupPending:function(d){var h=this.observing;
if(this.isObserving||!h||(h.get("length")===0)){return YES}if(h.contains(d)){this.isObserving=YES;
var e=this._setupPendingForEach;if(!e){var g=this.source,j=this.objectPropertyDidChange;
e=this._setupPendingForEach=function(k){var n=this.source.objectAt(k),l=SC.guidFor(n),m;
if(n&&n.addObserver){h.push(n);n.addObserver("*",this,j);m=this[l];if(m===undefined||m===null){this[l]=k
}else{if(m.isIndexSet){m.add(k)}else{m=this[l]=SC.IndexSet.create(m).add(k)}}}}}this.indexes.forEach(e,this);
return YES}else{return NO}},endObserving:function(){if(!this.isDeep){return this}var j=this.observing;
if(this.isObserving){var e=this.objectPropertyDidChange,g=this.source,d,k,h;if(j){k=j.length;
for(d=0;d<k;d++){h=j[d];h.removeObserver("*",this,e);this[SC.guidFor(h)]=null}j.length=0
}this.isObserving=NO}if(j){j.clear()}return this},rangeDidChange:function(e){var d=this.indexes;
if(!e||!d||d.intersects(e)){this.endObserving();this.method.call(this.target,this.source,null,"[]",e,this.context);
this.beginObserving()}return this},objectPropertyDidChange:function(h,k,l,d){var j=this.context,m=this.method,g=SC.guidFor(h),e=this[g];
if(e&&!e.isIndexSet){e=this[g]=SC.IndexSet.create(e).freeze()}if(j){m.call(this.target,this.source,h,k,e,j,d)
}else{m.call(this.target,this.source,h,k,e,d)}}};sc_require("private/observer_set");
SC.RunLoop=SC.Object.extend({beginRunLoop:function(){this._start=new Date().getTime();
if(SC.LOG_BINDINGS||SC.LOG_OBSERVERS){console.log("-- SC.RunLoop.beginRunLoop at %@".fmt(this._start))
}return this},endRunLoop:function(){var d;if(SC.LOG_BINDINGS||SC.LOG_OBSERVERS){console.log("-- SC.RunLoop.endRunLoop ~ flushing application queues")
}do{d=this.flushApplicationQueues();if(!d){d=this._flushinvokeLastQueue()}}while(d);
this._start=null;if(SC.LOG_BINDINGS||SC.LOG_OBSERVERS){console.log("-- SC.RunLoop.endRunLoop ~ End")
}return this},invokeOnce:function(d,e){if(e===undefined){e=d;d=this}if(SC.typeOf(e)===SC.T_STRING){e=d[e]
}if(!this._invokeQueue){this._invokeQueue=SC.ObserverSet.create()}this._invokeQueue.add(d,e);
return this},invokeLast:function(d,e){if(e===undefined){e=d;d=this}if(SC.typeOf(e)===SC.T_STRING){e=d[e]
}if(!this._invokeLastQueue){this._invokeLastQueue=SC.ObserverSet.create()}this._invokeLastQueue.add(d,e);
return this},flushApplicationQueues:function(){var e=NO,d=this._invokeQueue;if(d&&d.targets>0){this._invokeQueue=null;
e=YES;d.invokeMethods()}return SC.Binding.flushPendingChanges()||e},_flushinvokeLastQueue:function(){var d=this._invokeLastQueue,e=NO;
if(d&&d.targets>0){this._invokeLastQueue=null;e=YES;if(e){d.invokeMethods()}}return e
}});SC.RunLoop.currentRunLoop=null;SC.RunLoop.runLoopClass=SC.RunLoop;SC.RunLoop.begin=function(){var d=this.currentRunLoop;
if(!d){d=this.currentRunLoop=this.runLoopClass.create()}d.beginRunLoop();return this
};SC.RunLoop.end=function(){var d=this.currentRunLoop;if(!d){throw"SC.RunLoop.end() called outside of a runloop!"
}d.endRunLoop();return this};SC.run=function(e,d){SC.RunLoop.begin();e.call(d);SC.RunLoop.end()
};sc_require("system/object");sc_require("mixins/enumerable");sc_require("mixins/copyable");
sc_require("mixins/freezable");SC.SelectionSet=SC.Object.extend(SC.Enumerable,SC.Freezable,SC.Copyable,{isSelectionSet:YES,length:function(){var d=0,e=this._sets,g=this._objects;
if(g){d+=g.get("length")}if(e){e.forEach(function(h){d+=h.get("length")})}return d
}.property().cacheable(),sources:function(){var g=[],h=this._sets,e=h?h.length:0,d,k,j;
for(d=0;d<e;d++){k=h[d];if(k&&k.get("length")>0&&k.source){g.push(k.source)}}return g
}.property().cacheable(),indexSetForSource:function(j){if(!j||!j.isSCArray){return null
}var e=this._indexSetCache,h=this._objects,g,d;if(!e){e=this._indexSetCache={}}g=e[SC.guidFor(j)];
if(g&&g._sourceRevision&&(g._sourceRevision!==j.propertyRevision)){g=null}if(!g){g=this._indexSetForSource(j,NO);
if(g&&g.get("length")===0){g=null}if(h){if(g){g=g.copy()}h.forEach(function(k){if((d=j.indexOf(k))>=0){if(!g){g=SC.IndexSet.create()
}g.add(d)}},this)}if(g){g=e[SC.guidFor(j)]=g.frozenCopy();g._sourceRevision=j.propertyRevision
}}return g},_indexSetForSource:function(k,l){if(l===undefined){l=YES}var h=SC.guidFor(k),g=this[h],j=this._sets,d=j?j.length:0,e=null;
if(g>=d){g=null}if(SC.none(g)){if(l&&!this.isFrozen){this.propertyWillChange("sources");
if(!j){j=this._sets=[]}e=j[d]=SC.IndexSet.create();e.source=k;this[h]=d;this.propertyDidChange("sources")
}}else{e=j?j[g]:null}return e},add:function(d,e,h){if(this.isFrozen){throw SC.FROZEN_ERROR
}var l,k,o,n,g,j,m,p;if(e===undefined&&h===undefined){if(!d){throw"Must pass params to SC.SelectionSet.add()"
}if(d.isIndexSet){return this.add(d.source,d)}if(d.isSelectionSet){l=d._sets;p=d._objects;
k=l?l.length:0;this.beginPropertyChanges();for(o=0;o<k;o++){n=l[o];if(n&&n.get("length")>0){this.add(n.source,n)
}}if(p){this.addObjects(p)}this.endPropertyChanges();return this}}n=this._indexSetForSource(d,YES);
g=this.get("length");m=n.get("length");j=g-m;n.add(e,h);this._indexSetCache=null;
j+=n.get("length");if(j!==g){this.propertyDidChange("length");this.enumerableContentDidChange();
if(m===0){this.notifyPropertyChange("sources")}}return this},remove:function(d,e,h){if(this.isFrozen){throw SC.FROZEN_ERROR
}var l,k,o,n,g,j,m,p;if(e===undefined&&h===undefined){if(!d){throw"Must pass params to SC.SelectionSet.remove()"
}if(d.isIndexSet){return this.remove(d.source,d)}if(d.isSelectionSet){l=d._sets;p=d._objects;
k=l?l.length:0;this.beginPropertyChanges();for(o=0;o<k;o++){n=l[o];if(n&&n.get("length")>0){this.remove(n.source,n)
}}if(p){this.removeObjects(p)}this.endPropertyChanges();return this}}n=this._indexSetForSource(d,YES);
g=this.get("length");j=g-n.get("length");if(n&&(p=this._objects)){if(h!==undefined){e=SC.IndexSet.create(e,h);
h=undefined}p.forEach(function(s){o=d.indexOf(s);if(e.contains(o)){p.remove(s);j--
}},this)}n.remove(e,h);m=n.get("length");j+=m;this._indexSetCache=null;if(j!==g){this.propertyDidChange("length");
this.enumerableContentDidChange();if(m===0){this.notifyPropertyChange("sources")}}return this
},contains:function(e,h,d){if(h===undefined&&d===undefined){return this.containsObject(e)
}var g=this.indexSetForSource(e);if(!g){return NO}return g.contains(h,d)},intersects:function(e,h,d){var g=this.indexSetForSource(e,NO);
if(!g){return NO}return g.intersects(h,d)},_TMP_ARY:[],addObject:function(e){var g=this._TMP_ARY,d;
g[0]=e;d=this.addObjects(g);g.length=0;return d},addObjects:function(d){var h=this._objects,e,g;
if(!h){h=this._objects=SC.CoreSet.create()}e=h.get("length");h.addEach(d);g=h.get("length");
this._indexSetCache=null;if(g!==e){this.propertyDidChange("length");this.enumerableContentDidChange()
}return this},removeObject:function(e){var g=this._TMP_ARY,d;g[0]=e;d=this.removeObjects(g);
g.length=0;return d},removeObjects:function(e){var j=this._objects,g,h,d;if(!j){return this
}g=j.get("length");j.removeEach(e);h=j.get("length");if(d=this._sets){d.forEach(function(k){g+=k.get("length");
k.removeObjects(e);h+=k.get("length")},this)}this._indexSetCache=null;if(h!==g){this.propertyDidChange("length");
this.enumerableContentDidChange()}return this},containsObject:function(g){var j=this._objects;
if(j&&j.contains(g)){return YES}var h=this._sets,e=h?h.length:0,d,k;for(d=0;d<e;d++){k=h[d];
if(k&&k.indexOf(g)>=0){return YES}}return NO},constrain:function(h){var j,e,d,g;this.beginPropertyChanges();
this.get("sources").forEach(function(k){if(k===h){return}var l=this._indexSetForSource(h,NO);
if(l){this.remove(h,l)}},this);j=this._indexSetForSource(h,NO);if(j&&((d=j.get("max"))>(e=h.get("length")))){this.remove(h,e,d-e)
}if(g=this._objects){g.forEach(function(k){if(h.indexOf(k)<0){this.removeObject(k)
}},this)}this.endPropertyChanges();return this},isEqual:function(l){var k,h,e,d,g,j;
if(!l||!l.isSelectionSet){return NO}if(l===this){return YES}if((this._sets===l._sets)&&(this._objects===l._objects)){return YES
}if(this.get("length")!==l.get("length")){return NO}k=this._objects;h=l._objects;
if(k||h){if((k?k.get("length"):0)!==(h?h.get("length"):0)){return NO}if(k&&!k.isEqual(h)){return NO
}}g=this.get("sources");d=g.get("length");for(e=0;e<d;e++){j=g.objectAt(e);k=this._indexSetForSource(j,NO);
h=this._indexSetForSource(j,NO);if(!!h!==!!k){return NO}if(k&&!k.isEqual(h)){return NO
}}return YES},clear:function(){if(this.isFrozen){throw SC.FROZEN_ERROR}if(this._sets){this._sets.length=0
}if(this._objects){this._objects=null}this._indexSetCache=null;this.propertyDidChange("length");
this.enumerableContentDidChange();this.notifyPropertyChange("sources");return this
},copy:function(){var g=this.constructor.create(),h=this._sets,e=h?h.length:0,d,j;
if(h&&e>0){h=g._sets=h.slice();for(d=0;d<e;d++){if(!(j=h[d])){continue}j=h[d]=j.copy();
g[SC.guidFor(j.source)]=d}}if(this._objects){g._objects=this._objects.copy()}return g
},freeze:function(){if(this.isFrozen){return this}var d=this._sets,e=d?d.length:0,g;
while(--e>=0){if(g=d[e]){g.freeze()}}if(this._objects){this._objects.freeze()}return arguments.callee.base.apply(this,arguments)
},toString:function(){var d=this._sets||[];d=d.map(function(e){return e.toString().replace("SC.IndexSet",SC.guidFor(e.source))
},this);if(this._objects){d.push(this._objects.toString())}return"SC.SelectionSet:%@<%@>".fmt(SC.guidFor(this),d.join(","))
},firstObject:function(){var e=this._sets,g=this._objects;if(e&&e.get("length")>0){var j=e?e[0]:null,h=j?j.source:null,d=j?j.firstObject():-1;
if(h&&d>=0){return h.objectAt(d)}}return g?g.firstObject():undefined}.property(),nextObject:function(g,j,e){var h,d;
if(g===0){h=e.objects=[];this.forEach(function(k){h.push(k)},this);e.max=h.length
}h=e.objects;d=h[g];if(g+1>=e.max){e.objects=e.max=null}return d},forEach:function(l,j){var g=this._sets,h=this._objects,e=g?g.length:0,k,d;
for(d=0;d<e;d++){k=g[d];if(k){k.forEachObject(l,j)}}if(h){h.forEach(l,j)}return this
}});SC.SelectionSet.prototype.clone=SC.SelectionSet.prototype.copy;SC.SelectionSet.EMPTY=SC.SelectionSet.create().freeze();
sc_require("mixins/enumerable");sc_require("mixins/observable");sc_require("mixins/freezable");
sc_require("mixins/copyable");SC.Set=SC.mixin({},SC.Enumerable,SC.Observable,SC.Freezable,{create:function(e){var g,d,h=SC.Set._pool,j=this.isObservable;
if(!j&&e===undefined&&h.length>0){g=h.pop()}else{g=SC.beget(this);if(j){g.initObservable()
}if(e&&e.isEnumerable&&e.get("length")>0){g.isObservable=NO;if(e.isSCArray){d=e.get?e.get("length"):e.length;
while(--d>=0){g.add(e.objectAt(d))}}else{if(e.isSet){d=e.length;while(--d>=0){g.add(e[d])
}}else{e.forEach(function(k){g.add(k)},this)}}g.isObservable=j}}return g},isSet:YES,length:0,firstObject:function(){return(this.length>0)?this[0]:undefined
}.property(),clear:function(){if(this.isFrozen){throw SC.FROZEN_ERROR}this.length=0;
return this},contains:function(e){if(e===null){return NO}var d=this[SC.hashFor(e)];
return(!SC.none(d)&&(d<this.length)&&(this[d]===e))},isEqual:function(d){if(!d||!d.isSet||(d.get("length")!==this.get("length"))){return NO
}var e=this.get("length");while(--e>=0){if(!d.contains(this[e])){return NO}}return YES
},add:function(h){if(this.isFrozen){throw SC.FROZEN_ERROR}if(h===null||h===undefined){return this
}var g=SC.hashFor(h);var e=this[g];var d=this.length;if((e===null||e===undefined)||(e>=d)||(this[e]!==h)){this[d]=h;
this[g]=d;this.length=d+1}if(this.isObservable){this.enumerableContentDidChange()
}return this},addEach:function(g){if(this.isFrozen){throw SC.FROZEN_ERROR}if(!g||!g.isEnumerable){throw"%@.addEach must pass enumerable".fmt(this)
}var d,e=this.isObservable;if(e){this.beginPropertyChanges()}if(g.isSCArray){d=g.get("length");
while(--d>=0){this.add(g.objectAt(d))}}else{if(g.isSet){d=g.length;while(--d>=0){this.add(g[d])
}}else{g.forEach(function(h){this.add(h)},this)}}if(e){this.endPropertyChanges()}return this
},remove:function(h){if(this.isFrozen){throw SC.FROZEN_ERROR}if(SC.none(h)){return this
}var g=SC.hashFor(h);var e=this[g];var d=this.length;if(SC.none(e)||(e>=d)||(this[e]!==h)){return this
}delete this[g];if(e<(d-1)){h=this[e]=this[d-1];this[SC.hashFor(h)]=e}this.length=d-1;
if(this.isObservable){this.enumerableContentDidChange()}return this},pop:function(){if(this.isFrozen){throw SC.FROZEN_ERROR
}var d=(this.length>0)?this[this.length-1]:null;if(d){this.remove(d)}return d},removeEach:function(g){if(this.isFrozen){throw SC.FROZEN_ERROR
}if(!g||!g.isEnumerable){throw"%@.addEach must pass enumerable".fmt(this)}var d,e=this.isObservable;
if(e){this.beginPropertyChanges()}if(g.isSCArray){d=g.get("length");while(--d>=0){this.remove(g.objectAt(d))
}}else{if(g.isSet){d=g.length;while(--d>=0){this.remove(g[d])}}else{g.forEach(function(h){this.remove(h)
},this)}}if(e){this.endPropertyChanges()}return this},copy:function(){return this.constructor.create(this)
},destroy:function(){this.isFrozen=NO;if(!this.isObservable){SC.Set._pool.push(this.clear())
}return this},forEach:function(g,h){var e=this.length;if(!h){h=this}for(var d=0;d<e;
d++){g.call(h,this[d],d,this)}return this},toString:function(){var e=this.length,d,g=[];
for(d=0;d<e;d++){g[d]=this[d]}return"SC.Set<%@>".fmt(g.join(","))},_pool:[],isObservable:YES});
SC.Set.constructor=SC.Set;SC.Set.clone=SC.Set.copy;SC.Set.push=SC.Set.unshift=SC.Set.add;
SC.Set.shift=SC.Set.pop;SC.Set.addObject=SC.Set.add;SC.Set.removeObject=SC.Set.remove;
SC.Set._pool=[];SC.CoreSet=SC.beget(SC.Set);SC.CoreSet.isObservable=NO;SC.CoreSet.constructor=SC.CoreSet;
sc_require("mixins/enumerable");sc_require("mixins/array");sc_require("mixins/observable");
sc_require("mixins/delegate_support");SC.SparseArray=SC.Object.extend(SC.Observable,SC.Enumerable,SC.Array,SC.DelegateSupport,{_requestingLength:0,_requestingIndex:0,length:function(){var d=this.delegate;
if(d&&SC.none(this._length)&&d.sparseArrayDidRequestLength){this._requestingLength++;
d.sparseArrayDidRequestLength(this);this._requestingLength--}return this._length||0
}.property().cacheable(),provideLength:function(d){if(SC.none(d)){this._sa_content=null
}if(d!==this._length){this._length=d;if(this._requestingLength<=0){this.enumerableContentDidChange()
}}return this},rangeWindowSize:1,requestedRangeIndex:[],objectAt:function(d){var g=this._sa_content,e;
if(!g){g=this._sa_content=[]}if((e=g[d])===undefined){this.requestIndex(d);e=g[d]
}return e},definedIndexes:function(h){var g=SC.IndexSet.create(),j=this._sa_content,e,d;
if(!j){return g.freeze()}if(h){h.forEach(function(k){if(j[k]!==undefined){g.add(k)
}})}else{d=j.length;for(e=0;e<d;e++){if(j[e]!==undefined){g.add(e)}}}return g.freeze()
},_TMP_RANGE:{},requestIndex:function(e){var g=this.delegate;if(!g){return this}var d=this.get("rangeWindowSize"),j=e;
if(d>1){j=j-Math.floor(j%d)}if(d<1){d=1}this._requestingIndex++;if(g.sparseArrayDidRequestRange){var h=this._TMP_RANGE;
if(this.wasRangeRequested(j)===-1){h.start=j;h.length=d;g.sparseArrayDidRequestRange(this,h);
this.requestedRangeIndex.push(j)}}else{if(g.sparseArrayDidRequestIndex){while(--d>=0){g.sparseArrayDidRequestIndex(this,j+d)
}}}this._requestingIndex--;return this},wasRangeRequested:function(g){var e,d;for(e=0,d=this.requestedRangeIndex.length;
e<d;e++){if(this.requestedRangeIndex[e]===g){return e}}return -1},rangeRequestCompleted:function(e){var d=this.wasRangeRequested(e);
if(d>=0){this.requestedRangeIndex.removeAt(d,1);return YES}return NO},provideObjectsInRange:function(e,j){var g=this._sa_content;
if(!g){g=this._sa_content=[]}var h=e.start,d=e.length;while(--d>=0){g[h+d]=j[d]}if(this._requestingIndex<=0){this.enumerableContentDidChange()
}return this},_TMP_PROVIDE_ARRAY:[],_TMP_PROVIDE_RANGE:{length:1},provideObjectAtIndex:function(g,e){var h=this._TMP_PROVIDE_ARRAY,d=this._TMP_PROVIDE_RANGE;
h[0]=e;d.start=g;return this.provideObjectsInRange(d,h)},objectsDidChangeInRange:function(d){var e=this._sa_content;
if(e){if(d.start===0&&SC.maxRange(d)>=e.length){this._sa_content=null}else{var h=d.start,g=Math.min(h+d.length,e.length);
while(--g>=h){e[g]=undefined}}}this.enumerableContentDidChange(d);return this},indexOf:function(g){var d=this.delegate;
if(d&&d.sparseArrayDidRequestIndexOf){return d.sparseArrayDidRequestIndexOf(this,g)
}else{var e=this._sa_content;if(!e){e=this._sa_content=[]}return e.indexOf(g)}},replace:function(e,l,j){j=j||[];
var g=this.delegate;if(g){if(!g.sparseArrayShouldReplace||!g.sparseArrayShouldReplace(this,e,l,j)){return this
}}var h=this._sa_content;if(!h){h=this._sa_content=[]}h.replace(e,l,j);var d=j?(j.get?j.get("length"):j.length):0;
var k=d-l;if(!SC.none(this._length)){this.propertyWillChange("length");this._length+=k;
this.propertyDidChange("length")}this.enumerableContentDidChange(e,l,k);return this
},reset:function(){this._sa_content=null;this._length=null;this.enumerableContentDidChange();
this.invokeDelegateMethod(this.delegate,"sparseArrayDidReset",this);return this}});
SC.SparseArray.array=function(d){return this.create({_length:d||0})};var objectA,objectB,arrayA,stringA;
module("Beget function Module",{setup:function(){objectA={};objectB={};arrayA=[1,3];
stringA="stringA"}});test("should return a new object with same prototype as that of passed object",function(){equals(YES,SC.beget(objectA)!==objectA,"Beget for an object");
equals(YES,SC.beget(stringA)!==stringA,"Beget for a string");equals(YES,SC.beget(SC.hashFor(objectB))!==SC.hashFor(objectB),"Beget for a hash");
equals(YES,SC.beget(arrayA)!==arrayA,"Beget for an array")});var object;module("Cloned Objects",{setup:function(){object=SC.Object.create({name:"Cloned Object",value:"value1",clone:function(e){var d=e;
switch(SC.typeOf(e)){case SC.T_ARRAY:d=e.slice();break;case SC.T_OBJECT:d={};for(var g in e){d[g]=e[g]
}}return d}})}});test("should return a cloned object",function(){var j=[1,2,3,4,5];
var h="SproutCore";var e=SC.hashFor(j);var k=100;var g=SC.clone(j);var d=SC.clone(j);
equals(SC.clone(h),SC.clone(h));equals(SC.clone(e),SC.clone(e));equals(SC.clone(k),SC.clone(k));
same(g,d)});test("should return cloned object when the object is null",function(){var d=null;
equals(SC.clone(d),SC.clone(d))});test("should return a cloned array ",function(){var d=["value1","value2"];
var e=object.clone(d);equals(e[0],d[0],"check first array item");equals(e[1],d[1],"check first array item")
});test("should use copy() if isCopyable",function(){var d=SC.Object.create(SC.Copyable,{isCopy:NO,copy:function(){return SC.Object.create(SC.Copyable,{isCopy:YES})
}});var e=SC.clone(d);ok(!!e,"clone should return a copy");equals(e.isCopy,YES,"copy.isCopy should be YES")
});test("SC.copy should be an alias for SC.clone",function(){equals(SC.copy,SC.clone,"SC.copy should equal SC.clone")
});var v=[];module("SC.compare()",{setup:function(){v[0]=null;v[1]=false;v[2]=true;
v[3]=-12;v[4]=3.5;v[5]="a string";v[6]="another string";v[7]="last string";v[8]=[1,2];
v[9]=[1,2,3];v[10]=[1,3];v[11]={a:"hash"};v[12]=SC.Object.create();v[13]=function(d){return d
}}});test("ordering should work",function(){for(var d=0;d<v.length;d++){equals(SC.compare(v[d],v[d]),0,d+" should equal itself");
for(var e=d+1;e<v.length;e++){equals(SC.compare(v[d],v[e]),-1,"v["+d+"] ("+SC.typeOf(v[d])+") should be smaller than v["+e+"] ("+SC.typeOf(v[e])+")")
}}});module("Console object");test("The console object should be defined for all browsers and work if supported",function(){ok((console!==undefined),"console should not be undefined");
console.info("Console.info is working");console.log("Console.log is working");console.warn("Console.warn is working");
console.error("Console.error is working")});var objectA,objectB;module("Object",{setup:function(){objectA={};
objectB={}}});test("should return same guid for same instance every time",function(){equals(SC.guidFor(objectA),SC.guidFor(objectA))
});test("should return different guid for different instances",function(){ok(SC.guidFor(objectA)!==SC.guidFor(objectB))
});test("guid should not parse to a number",function(){equals(YES,isNaN(parseInt(SC.guidFor(objectA),0)))
});var stringA,stringACopy,stringB;module("String",{setup:function(){stringA="string A";
stringACopy="string A";stringB="string B"}});test("same string instance should have same guide every time",function(){equals(SC.guidFor(stringA),SC.guidFor(stringA))
});test("two string instances with same value should have same guid",function(){equals(SC.guidFor(stringA),SC.guidFor(stringACopy))
});test("two instances with different value should have different guid",function(){ok(SC.guidFor(stringA)!==SC.guidFor(stringB))
});test("guid should not parse to a number",function(){equals(YES,isNaN(parseInt(SC.guidFor(stringA),0)))
});var numberA,numberACopy,numberB;module("Number",{setup:function(){numberA=23;numberACopy=23;
numberB=34}});test("same number instance should have same guide every time",function(){equals(SC.guidFor(numberA),SC.guidFor(numberA))
});test("two number instances with same value should have same guid",function(){equals(SC.guidFor(numberA),SC.guidFor(numberACopy))
});test("two instances with different value should have different guid",function(){ok(SC.guidFor(numberA)!==SC.guidFor(numberB))
});test("guid should not parse to a number",function(){equals(YES,isNaN(parseInt(SC.guidFor(numberA),0)))
});module("Boolean");test("should always have same guid",function(){equals(SC.guidFor(true),SC.guidFor(true));
equals(SC.guidFor(false),SC.guidFor(false))});test("true should have different guid than false",function(){ok(SC.guidFor(true)!==SC.guidFor(false))
});test("guid should not parse to a number",function(){equals(YES,isNaN(parseInt(SC.guidFor(true),0)),"guid for boolean-true");
equals(YES,isNaN(parseInt(SC.guidFor(false),0)),"guid for boolean-false")});module("Null and Undefined");
test("should always have same guid",function(){equals(SC.guidFor(null),SC.guidFor(null));
equals(SC.guidFor(undefined),SC.guidFor(undefined))});test("null should have different guid than undefined",function(){ok(SC.guidFor(null)!==SC.guidFor(undefined))
});test("guid should not parse to a number",function(){equals(YES,isNaN(parseInt(SC.guidFor(null),0)));
equals(YES,isNaN(parseInt(SC.guidFor(undefined),0)))});var array1,array1copy,array2,array2copy;
module("Arrays",{setup:function(){array1=["a","b","c"];array1copy=array1;array2=["1","2","3"];
array2copy=["1","2","3"]}});test("same array instance should have same guide every time",function(){equals(SC.guidFor(array1),SC.guidFor(array1));
equals(SC.guidFor(array2),SC.guidFor(array2))});test("two array instances with same value, by assigning one to the other.",function(){equals(SC.guidFor(array1),SC.guidFor(array1copy))
});test("two array instances with same value, by assigning the same value",function(){ok(SC.guidFor(array2)!==SC.guidFor(array2copy))
});test("two instances with different value should have different guid",function(){ok(SC.guidFor(array1)!==SC.guidFor(array2));
ok(SC.guidFor(array1copy)!==SC.guidFor(array2copy))});test("guid should not parse to a number",function(){equals(YES,isNaN(parseInt(SC.guidFor(array1),0)))
});var obj1,obj2,obj3;module("Inspect module",{setup:function(){obj1=[1,3,4,9];obj2=24;
obj3={}}});test("SC.inspect module should give a string type",function(){var g=SC.inspect(obj1);
equals(YES,SC.T_STRING===SC.typeOf(g),"description of the array");var e=SC.inspect(obj2);
equals(YES,SC.T_STRING===SC.typeOf(e),"description of the numbers");var d=SC.inspect(obj3);
equals(YES,SC.T_STRING===SC.typeOf(d),"description of the object")});var objectA,objectB,objectC,objectD,objectE;
module("Array Check",{setup:function(){objectA=[1,2,3];objectB=23;objectC=["Hello","Hi"];
objectD="Hello";objectE={}}});test("should check if a given object is an array or not ",function(){equals(SC.isArray(objectA),true);
equals(SC.isArray(objectB),false);equals(SC.isArray(objectC),true);equals(SC.isArray(objectD),false);
equals(SC.isArray(objectE),false)});var StringA,StringB,StringC;module("String's - isEqual",{setup:function(){StringA="Hello";
StringB="Hi";StringC="Hello"}});test("strings should be equal ",function(){equals(SC.isEqual(StringA,StringB),false);
equals(SC.isEqual(StringA,StringC),true)});var num1,num2,num3;module("Number's - isEqual",{setup:function(){num1=24;
num2=24;num3=21}});test("numericals should be equal ",function(){equals(SC.isEqual(num1,num2),true);
equals(SC.isEqual(num1,num3),false)});var objectA,objectB,objectC;module("Array's - isEqual",{setup:function(){objectA=[1,2];
objectB=[1,2];objectC=[1]}});test("array should be equal  ",function(){equals(SC.isEqual(objectA,objectB),false,"two array instances with the same values should not be equal");
equals(SC.isEqual(objectA,objectC),false,"two array instances with different values should not be equal")
});var object;module("item type",{setup:function(){object=SC.Object.create({method:function(){}})
}});test("should return the type for the passed item",function(){var e=null;var d=[1,2,3];
var g={};equals(SC.T_NULL,SC.typeOf(e),"item of type null ");equals(SC.T_ARRAY,SC.typeOf(d),"item of type array ");
equals(SC.T_HASH,SC.typeOf(g),"item of type hash");equals(SC.T_OBJECT,SC.typeOf(object),"item of type object");
equals(SC.T_FUNCTION,SC.typeOf(object.method),"item of type function");equals(SC.T_CLASS,SC.typeOf(SC.Object),"item of type class")
});var a,b;module("none or undefined object type",{setup:function(){a=null;b=undefined
}});test("should return true for null and undefined ",function(){equals(YES,SC.none(a),"for a null parameter passed  ");
equals(YES,SC.none(b),"for a undefined parameter passed ")});module("Fetch Keys ");
test("should get a key array for a specified object ",function(){var e={};e.names="Rahul";
e.age="23";e.place="Mangalore";var d=[];d=SC.keys(e);same(d,["names","age","place"])
});var objectA,objectB,objectC;module("Make Array ",{setup:function(){var e=[1,2,3,4,5];
var d=SC.hashFor(e);var h=null;var g="string A"}});test("should return an array for the object passed ",function(){var d=["value1","value2"];
var h=100;var g="SproutCore";var j={};var e=SC.makeArray(j);equals(SC.isArray(e),true);
e=SC.makeArray(g);equals(SC.isArray(e),true);e=SC.makeArray(h);equals(SC.isArray(e),true);
e=SC.makeArray(d);equals(SC.isArray(e),true)});module("SC.objectForPropertyPath");
test("should be able to resolve an object on the window",function(){var d=(window.myGlobal={test:"this "});
same(d,{test:"this "});same(window.myGlobal,{test:"this "});same(SC.objectForPropertyPath("myGlobal"),{test:"this "});
window.myGlobal=null});var object,object1,object3;module("Checking the tuple for property path",{setup:function(){object=SC.Object.create({name:"SproutCore",value:"",objectA:SC.Object.create({propertyVal:"chainedProperty"})})
}});test("should check for the tuple property",function(){var d=[];d=SC.tupleForPropertyPath(object.name,"");
equals(d[0],window,"the window object");equals(d[1],"SproutCore","the property name");
d=SC.tupleForPropertyPath(object.objectA.propertyVal,"object");equals(d[0],"object","the root");
equals(d[1],"chainedProperty","a chained property")});test("should check for the tuple property when path is undefined",function(){var d;
d=SC.tupleForPropertyPath(object.value,"");equals(YES,d===null,"returns null for undefined path")
});SC.ArraySuite.generate("built-in Array");var DummyArray=SC.Object.extend(SC.Array,{length:0,content:null,replace:function(e,h,g){if(!this.content){this.content=[]
}this.beginPropertyChanges();this.content.replace(e,h,g);this.set("length",this.content.length);
var d=g?g.get("length"):0;this.enumerableContentDidChange(e,h,d-h);this.endPropertyChanges()
},objectAt:function(d){if(!this.content){this.content=[]}return this.content[d]}});
SC.ArraySuite.generate("DummyArray",{newObject:function(d){if(!d||typeof d===SC.T_NUMBER){d=this.expected(d)
}return DummyArray.create({content:d,length:d.length})}});var Rectangle=SC.Object.extend({length:0,width:0,area:function(){return this.get("length")*this.get("width")
}});Rectangle.mixin(SC.Comparable,{compare:function(e,d){return SC.compare(e.area(),d.area())
}});var r1,r2;module("Comparable",{setup:function(){r1=Rectangle.create({length:6,width:12});
r2=Rectangle.create({length:6,width:13})},teardown:function(){}});test("should be comparable and return the correct result",function(){equals(r1.constructor.isComparable,YES);
equals(SC.compare(r1,r1),0);equals(SC.compare(r1,r2),-1);equals(SC.compare(r2,r1),1)
});var enumerables;var DummyEnumerable=SC.Object.extend(SC.Enumerable,{content:[],length:function(){return this.content.length
}.property(),objectAt:function(d){return this.content[d]},nextObject:function(d){return this.content[d]
},unknownProperty:function(e,g){var d=this.reducedProperty(e,g);if(d===undefined){if(g!==undefined){this[e]=g
}d=g}return d},pushObject:function(d){this.content.push(d);this.enumerableContentDidChange()
}});var runFunc=function(e,d){return["DONE",e,d]};var invokeWhileOK=function(){return"OK"
};var invokeWhileNotOK=function(){return"FAIL"};var reduceTestFunc=function(j,h,d,k,g){return g||"TEST"
};var CommonArray=[{first:"Charles",gender:"male",californian:NO,ready:YES,visited:"Prague",doneTravelling:NO,run:runFunc,invokeWhileTest:invokeWhileOK,balance:1},{first:"Jenna",gender:"female",californian:YES,ready:YES,visited:"Prague",doneTravelling:NO,run:runFunc,invokeWhileTest:invokeWhileOK,balance:2},{first:"Peter",gender:"male",californian:NO,ready:YES,visited:"Prague",doneTravelling:NO,run:runFunc,invokeWhileTest:invokeWhileNotOK,balance:3},{first:"Chris",gender:"male",californian:NO,ready:YES,visited:"Prague",doneTravelling:NO,run:runFunc,invokeWhileTest:invokeWhileOK,balance:4}];
module("Real Array & DummyEnumerable",{setup:function(){enumerables=[SC.$A(CommonArray),DummyEnumerable.create({content:CommonArray})]
},teardown:function(){delete enumerables;delete Array.prototype["@max(balance)"];
delete Array.prototype["@min(balance)"]}});test("should get enumerator that iterates through objects",function(){var m,j=enumerables;
for(var h=0,g=j.length;h<g;h++){m=j[h];var k=m.enumerator();ok(k!==null,"enumerator must not be null");
var d=0;var l;while(l=k.nextObject()){equals(m.objectAt(d),l,"object at index %@".fmt(d));
d++}equals(m.get("length"),d)}});test("should return firstObject for item with content",function(){var h,g=enumerables;
for(var e=0,d=g.length;e<d;e++){h=g[e];equals(h.firstObject(),CommonArray[0],"firstObject should return first object")
}equals([].firstObject(),undefined,"firstObject() on empty enumerable should return undefined")
});test("should run forEach() to go through objects",function(){var d,g=enumerables;
for(var j=0,h=g.length;j<h;j++){d=g[j];var o=0;var n=[];var k=[];var e=[];var m=[];
d.forEach(function(s,p,u){n.push(s);k.push(p);e.push(u);m.push(this)},this);var l=d.get("length");
for(o=0;o<l;o++){equals(n[o],d.objectAt(o));equals(k[o],o);equals(e[o],d);ok(m[o]===this,"target should always be this")
}}});test("should map to values while passing proper params",function(){var d,g=enumerables;
for(var j=0,h=g.length;j<h;j++){d=g[j];var p=0;var o=[];var k=[];var e=[];var m=[];
var n=d.map(function(u,s,x){o.push(u);k.push(s);e.push(x);m.push(this);return s},this);
var l=d.get("length");for(p=0;p<l;p++){equals(d.objectAt(p),o[p],"items");equals(p,k[p],"indexes");
equals(d,e[p],"arrays");equals(SC.guidFor(this),SC.guidFor(m[p]),"this");equals(p,n[p],"mapped")
}}});test("should filter to items that return for callback",function(){var d,g=enumerables;
for(var j=0,h=g.length;j<h;j++){d=g[j];var p=0;var o=[];var k=[];var e=[];var m=[];
var n=d.filter(function(u,s,x){o.push(u);k.push(s);e.push(x);m.push(this);return u.gender==="female"
},this);var l=d.get("length");for(p=0;p<l;p++){equals(d.objectAt(p),o[p],"items");
equals(p,k[p],"indexes");equals(d,e[p],"arrays");equals(SC.guidFor(this),SC.guidFor(m[p]),"this")
}equals(n.length,1);equals(n[0].first,"Jenna")}});test("should return true if function for every() returns true",function(){var d,g=enumerables;
for(var j=0,h=g.length;j<h;j++){d=g[j];var o=0;var n=[];var k=[];var e=[];var m=[];
var p=d.every(function(u,s,x){n.push(u);k.push(s);e.push(x);m.push(this);return true
},this);var l=d.get("length");for(o=0;o<l;o++){equals(d.objectAt(o),n[o],"items");
equals(o,k[o],"indexes");equals(d,e[o],"arrays");equals(SC.guidFor(this),SC.guidFor(m[o]),"this")
}equals(p,YES)}});test("should return false if one function for every() returns false",function(){var j,h=enumerables;
for(var g=0,e=h.length;g<e;g++){j=h[g];var d=j.every(function(l,k,m){return l.gender==="male"
},this);equals(d,NO)}});test("should return false if all functions for some() returns false",function(){var d,g=enumerables;
for(var j=0,h=g.length;j<h;j++){d=g[j];var o=0;var n=[];var k=[];var e=[];var m=[];
var p=d.some(function(u,s,x){n.push(u);k.push(s);e.push(x);m.push(this);return false
},this);var l=d.get("length");for(o=0;o<l;o++){equals(d.objectAt(o),n[o],"items");
equals(o,k[o],"indexes");equals(d,e[o],"arrays");equals(SC.guidFor(this),SC.guidFor(m[o]),"this")
}equals(p,NO)}});test("should return true if one function for some() returns true",function(){var j,h=enumerables;
for(var g=0,e=h.length;g<e;g++){j=h[g];var d=j.some(function(l,k,m){return l.gender!=="male"
},this);equals(d,YES)}});test("should mapProperty for all items",function(){var l,k=enumerables;
for(var j=0,h=k.length;j<h;j++){l=k[j];var g=l.mapProperty("first");var e;var d=l.get("length");
for(e=0;e<d;e++){equals(g[e],l.objectAt(e).first)}}});test("should filterProperty with match",function(){var j,h=enumerables;
for(var e=0,d=h.length;e<d;e++){j=h[e];var g=j.filterProperty("gender","female");
equals(g.length,1);equals(g[0].first,"Jenna")}});test("should filterProperty with default bool",function(){var j,h=enumerables;
for(var e=0,d=h.length;e<d;e++){j=h[e];var g=j.filterProperty("californian");equals(g.length,1);
equals(g[0].first,"Jenna")}});test("should groupBy a given property",function(){var j,h=enumerables;
for(var e=0,d=h.length;e<d;e++){j=h[e];var g=j.groupBy("gender");equals(g.length,2);
equals(g[1][0].first,"Jenna")}});test("everyProperty should return true if all properties macth",function(){var j,h=enumerables;
for(var e=0,d=h.length;e<d;e++){j=h[e];var g=j.everyProperty("visited","Prague");
equals(YES,g,"visited")}});test("everyProperty should return true if all properties true",function(){var j,h=enumerables;
for(var e=0,d=h.length;e<d;e++){j=h[e];var g=j.everyProperty("ready");equals(YES,g,"ready")
}});test("everyProperty should return false if any properties false",function(){var j,h=enumerables;
for(var e=0,d=h.length;e<d;e++){j=h[e];var g=j.everyProperty("gender","male");equals(NO,g,"ready")
}});test("someProperty should return false if all properties not match",function(){var j,h=enumerables;
for(var e=0,d=h.length;e<d;e++){j=h[e];var g=j.someProperty("visited","Timbuktu");
equals(NO,g,"visited")}});test("someProperty should return false if all properties false",function(){var j,h=enumerables;
for(var e=0,d=h.length;e<d;e++){j=h[e];var g=j.someProperty("doneTravelling");equals(NO,g,"doneTravelling")
}});test("someProperty should return true if any properties true",function(){var j,h=enumerables;
for(var e=0,d=h.length;e<d;e++){j=h[e];var g=j.someProperty("first","Charles");equals(YES,g,"first")
}});test("invokeWhile should call method on member objects until return does not match",function(){var j,h=enumerables;
for(var e=0,d=h.length;e<d;e++){j=h[e];var g=j.invokeWhile("OK","invokeWhileTest","item2");
equals("FAIL",g,"return value")}});test("get @min(balance) should return the minimum balance",function(){var h,g=enumerables;
for(var e=0,d=g.length;e<d;e++){h=g[e];equals(1,h.get("@min(balance)"))}});test("get @max(balance) should return the maximum balance",function(){var h,g=enumerables;
for(var e=0,d=g.length;e<d;e++){h=g[e];equals(4,h.get("@max(balance)"))}});test("get @minObject(balance) should return the record with min balance",function(){var h,g=enumerables;
for(var e=0,d=g.length;e<d;e++){h=g[e];equals(h.objectAt(0),h.get("@minObject(balance)"))
}});test("get @maxObject(balance) should return the record with the max balance",function(){var h,g=enumerables;
for(var e=0,d=g.length;e<d;e++){h=g[e];equals(h.objectAt(3),h.get("@maxObject(balance)"))
}});test("get @sum(balance) should return the sum of the balances.",function(){var h,g=enumerables;
for(var e=0,d=g.length;e<d;e++){h=g[e];equals(1+2+3+4,h.get("@sum(balance)"))}});
test("get @average(balance) should return the average of balances",function(){var h,g=enumerables;
for(var e=0,d=g.length;e<d;e++){h=g[e];equals((1+2+3+4)/4,h.get("@average(balance)"))
}});test("should invoke custom reducer",function(){var h,g=enumerables;for(var e=0,d=g.length;
e<d;e++){h=g[e];h.reduceTest=reduceTestFunc;equals("TEST",h.get("@test"));equals("prop",h.get("@test(prop)"))
}});test("should trigger observer of reduced prop when array changes once property retrieved once",function(){var j,h=enumerables;
for(var g=0,e=h.length;g<e;g++){j=h[g];j.get("@max(balance)");var d=null;j.addObserver("@max(balance)",function(){d=j.get("@max(balance)")
});j.addProbe("[]");j.addProbe("@max(balance)");j.pushObject({first:"John",gender:"male",californian:NO,ready:YES,visited:"Paris",balance:5});
equals(5,d,"observedValue")}});test("should trigger observer of reduced prop when array changes - even if you never retrieved the property before",function(){var j,h=enumerables;
for(var g=0,e=h.length;g<e;g++){j=h[g];var d=null;j.addObserver("@max(balance)",function(){d=j.get("@max(balance)")
});j.pushObject({first:"John",gender:"male",californian:NO,ready:YES,visited:"Paris",balance:5});
equals(5,d,"observedValue")}});test("should find the first element matching the criteria",function(){var e=enumerables[1];
var d=e.find(function(g){return g.gender=="female"});equals(d.first,"Jenna")});var source;
module("Real Array",{setup:function(){source=SC.$A(CommonArray)},teardown:function(){delete source;
delete Array.prototype["@max(balance)"];delete Array.prototype["@min(balance)"]}});
test("should notify observers even if reduced property is cached on prototype",function(){source.get("@max(balance)");
source=SC.$A(CommonArray);source.get("@max(balance)");var d=null;source.addObserver("@max(balance)",function(){d=source.get("@max(balance)")
});source.addProbe("[]");source.addProbe("@max(balance)");source.pushObject({first:"John",gender:"male",californian:NO,ready:YES,visited:"Paris",balance:5});
equals(5,d,"observedValue")});var object,ObjectC,ObjectD,objectA,objectB;module("object.get()",{setup:function(){object=SC.Object.create({normal:"value",numberVal:24,toggleVal:true,computed:function(){return"value"
}.property(),method:function(){return"value"},nullProperty:null,unknownProperty:function(d,e){this.lastUnknownProperty=d;
return"unknown"}})}});test("should get normal properties",function(){equals(object.get("normal"),"value")
});test("should call computed properties and return their result",function(){equals(object.get("computed"),"value")
});test("should return the function for a non-computed property",function(){var d=object.get("method");
equals(SC.typeOf(d),SC.T_FUNCTION)});test("should return null when property value is null",function(){equals(object.get("nullProperty"),null)
});test("should call unknownProperty when value is undefined",function(){equals(object.get("unknown"),"unknown");
equals(object.lastUnknownProperty,"unknown")});module("SC.get()",{setup:function(){objectA=SC.Object.create({normal:"value",numberVal:24,toggleVal:true,computed:function(){return"value"
}.property(),method:function(){return"value"},nullProperty:null,unknownProperty:function(d,e){this.lastUnknownProperty=d;
return"unknown"}});objectB={normal:"value",nullProperty:null}}});test("should get normal properties on SC.Observable",function(){equals(SC.get(objectA,"normal"),"value")
});test("should call computed properties on SC.Observable and return their result",function(){equals(SC.get(objectA,"computed"),"value")
});test("should return the function for a non-computed property on SC.Observable",function(){var d=SC.get(objectA,"method");
equals(SC.typeOf(d),SC.T_FUNCTION)});test("should return null when property value is null on SC.Observable",function(){equals(SC.get(objectA,"nullProperty"),null)
});test("should call unknownProperty when value is undefined on SC.Observable",function(){equals(SC.get(object,"unknown"),"unknown");
equals(object.lastUnknownProperty,"unknown")});test("should get normal properties on standard objects",function(){equals(SC.get(objectB,"normal"),"value")
});test("should return null when property is null on standard objects",function(){equals(SC.get(objectB,"nullProperty"),null)
});test("should return undefined if the provided object is null",function(){equals(SC.get(null,"key"),undefined)
});test("should return undefined if the provided object is undefined",function(){equals(SC.get(undefined,"key"),undefined)
});test("should work when object is SC (used in SC.objectForPropertyPath)",function(){equals(SC.objectForPropertyPath("SC.RunLoop"),SC.RunLoop);
equals(SC.get("RunLoop"),SC.RunLoop);equals(SC.get(SC,"RunLoop"),SC.RunLoop)});module("object.set()",{setup:function(){object=SC.Object.create({normal:"value",_computed:"computed",computed:function(d,e){if(e!==undefined){this._computed=e
}return this._computed}.property(),_method:"method",method:function(d,e){if(e!==undefined){this._method=e
}return this._method},nullProperty:null,_unknown:"unknown",unknownProperty:function(d,e){if(e!==undefined){this._unknown=e
}return this._unknown}})}});test("should change normal properties and return this",function(){var d=object.set("normal","changed");
equals(object.normal,"changed");equals(d,object)});test("should call computed properties passing value and return this",function(){var d=object.set("computed","changed");
equals(object._computed,"changed");equals(SC.typeOf(object.computed),SC.T_FUNCTION);
equals(d,object)});test("should replace the function for a non-computed property and return this",function(){var d=object.set("method","changed");
equals(object._method,"method");ok(SC.typeOf(object.method)!==SC.T_FUNCTION);equals(d,object)
});test("should replace prover when property value is null",function(){var d=object.set("nullProperty","changed");
equals(object.nullProperty,"changed");equals(object._unknown,"unknown");equals(d,object)
});test("should call unknownProperty with value when property is undefined",function(){var d=object.set("unknown","changed");
equals(object._unknown,"changed");equals(d,object)});module("Computed properties",{setup:function(){object=SC.Object.create({computedCalls:[],computed:function(d,e){this.computedCalls.push(e);
return"computed"}.property(),computedCachedCalls:[],computedCached:function(d,e){this.computedCachedCalls.push(e);
return"computedCached"}.property().cacheable(),changer:"foo",dependentCalls:[],dependent:function(d,e){this.dependentCalls.push(e);
return"dependent"}.property("changer"),dependentCachedCalls:[],dependentCached:function(d,e){this.dependentCachedCalls.push(e);
return"dependentCached"}.property("changer").cacheable(),incCallCount:0,inc:function(){return this.incCallCount++
}.property("changer").cacheable(),nestedIncCallCount:0,nestedInc:function(d,e){return this.nestedIncCallCount++
}.property("inc").cacheable(),state:"on",isOn:function(d,e){if(e!==undefined){this.set("state","on")
}return this.get("state")==="on"}.property("state"),isOff:function(d,e){if(e!==undefined){this.set("state","off")
}return this.get("state")==="off"}.property("state")})}});test("getting values should call function return value",function(){var d="computed computedCached dependent dependentCached".w();
d.forEach(function(e){equals(object.get(e),e,"Try #1: object.get(%@) should run function".fmt(e));
equals(object.get(e),e,"Try #2: object.get(%@) should run function".fmt(e))});"computedCalls dependentCalls".w().forEach(function(e){equals(object[e].length,2,"non-cached property %@ should be called 2x".fmt(e))
});"computedCachedCalls dependentCachedCalls".w().forEach(function(e){equals(object[e].length,1,"non-cached property %@ should be called 1x".fmt(e))
})});test("setting values should call function return value",function(){var e="computed dependent computedCached dependentCached".w();
var d="value1 value2".w();e.forEach(function(g){equals(object.set(g,d[0]),object,"Try #1: object.set(%@, %@) should run function".fmt(g,d[0]));
equals(object.set(g,d[1]),object,"Try #2: object.set(%@, %@) should run function".fmt(g,d[1]));
equals(object.set(g,d[1]),object,"Try #3: object.set(%@, %@) should not run function since it is setting same value as before".fmt(g,d[1]))
});e.forEach(function(j){var h=object[j+"Calls"],g;equals(h.length,2,"set(%@) should be called 2x".fmt(j));
for(g=0;g<2;g++){equals(h[g],d[g],"call #%@ to set(%@) should have passed value %@".fmt(g+1,j,d[g]))
}})});test("notify change should clear cache",function(){object.get("computedCached");
object.get("computedCached");object.propertyWillChange("computedCached").propertyDidChange("computedCached");
object.get("computedCached");equals(object.computedCachedCalls.length,2,"should have invoked method 2x")
});test("change dependent should clear cache",function(){var d=object.get("inc");
equals(object.get("inc"),d,"multiple calls should not run cached prop");object.set("changer","bar");
equals(object.get("inc"),d+1,"should increment after dependent key changes")});test("just notifying change of dependent should clear cache",function(){var d=object.get("inc");
equals(object.get("inc"),d,"multiple calls should not run cached prop");object.notifyPropertyChange("changer");
equals(object.get("inc"),d+1,"should increment after dependent key changes")});test("changing dependent should clear nested cache",function(){var d=object.get("nestedInc");
equals(object.get("nestedInc"),d,"multiple calls should not run cached prop");object.set("changer","bar");
equals(object.get("nestedInc"),d+1,"should increment after dependent key changes")
});test("just notifying change of dependent should clear nested cache",function(){var d=object.get("nestedInc");
equals(object.get("nestedInc"),d,"multiple calls should not run cached prop");object.notifyPropertyChange("changer");
equals(object.get("nestedInc"),d+1,"should increment after dependent key changes")
});test("change dependent should clear cache when observers of dependent are called",function(){var d=object.get("inc");
equals(object.get("inc"),d,"multiple calls should not run cached prop");object.addObserver("inc",this,function(){equals(object.get("inc"),d+1,"should increment after dependent key changes")
});object.set("changer","bar")});test("allPropertiesDidChange should clear cache",function(){var d=object.get("inc");
equals(object.get("inc"),d,"should not change after first call");object.allPropertiesDidChange();
equals(object.get("inc"),d+1,"should increment after change")});test("setting one of two computed properties that depend on a third property should clear the kvo cache",function(){object.set("isOff",YES);
object.set("isOn",YES);object.set("isOff",YES);equals(object.get("isOff"),YES,"object.isOff should be YES");
equals(object.get("isOn"),NO,"object.isOn should be NO")});module("Observable objects & object properties ",{setup:function(){object=SC.Object.create({normal:"value",abnormal:"zeroValue",numberVal:24,toggleVal:true,observedProperty:"beingWatched",testRemove:"observerToBeRemoved",normalArray:[1,2,3,4,5],automaticallyNotifiesObserversFor:function(d){return NO
},getEach:function(){var g=["normal","abnormal"];var e=[];for(var d=0;d<g.length;
d++){e[e.length]=this.getPath(g[d])}return e},newObserver:function(){this.abnormal="changedValueObserved"
},testObserver:function(){this.abnormal="removedObserver"}.observes("normal"),testArrayObserver:function(){this.abnormal="notifiedObserver"
}.observes("*normalArray.[]")})}});test("incrementProperty and decrementProperty",function(){var d=object.incrementProperty("numberVal");
equals(25,d,"numerical value incremented");object.numberVal=24;d=object.decrementProperty("numberVal");
equals(23,d,"numerical value decremented");object.numberVal=25;d=object.incrementProperty("numberVal",5);
equals(30,d,"numerical value incremented by specified increment");object.numberVal=25;
d=object.decrementProperty("numberVal",5);equals(20,d,"numerical value decremented by specified increment")
});test("toggle function, should be boolean",function(){equals(object.toggleProperty("toggleVal",true,false),object.get("toggleVal"));
equals(object.toggleProperty("toggleVal",true,false),object.get("toggleVal"));equals(object.toggleProperty("toggleVal",undefined,undefined),object.get("toggleVal"))
});test("should not notify the observers of a property automatically",function(){object.set("normal","doNotNotifyObserver");
equals(object.abnormal,"zeroValue")});test("should notify array observer when array changes",function(){object.normalArray.replace(0,0,6);
equals(object.abnormal,"notifiedObserver","observer should be notified")});module("object.addObserver()",{setup:function(){ObjectC=SC.Object.create({ObjectE:SC.Object.create({propertyVal:"chainedProperty"}),normal:"value",normal1:"zeroValue",normal2:"dependentValue",incrementor:10,action:function(){this.normal1="newZeroValue"
},observeOnceAction:function(){this.incrementor=this.incrementor+1},chainedObserver:function(){this.normal2="chainedPropertyObserved"
}})}});test("should register an observer for a property",function(){ObjectC.addObserver("normal",ObjectC,"action");
ObjectC.set("normal","newValue");equals(ObjectC.normal1,"newZeroValue")});test("should register an observer for a property - Special case of chained property",function(){ObjectC.addObserver("ObjectE.propertyVal",ObjectC,"chainedObserver");
ObjectC.ObjectE.set("propertyVal","chainedPropertyValue");equals("chainedPropertyObserved",ObjectC.normal2);
ObjectC.normal2="dependentValue";ObjectC.set("ObjectE","");equals("chainedPropertyObserved",ObjectC.normal2)
});module("object.removeObserver()",{setup:function(){ObjectD=SC.Object.create({ObjectF:SC.Object.create({propertyVal:"chainedProperty"}),normal:"value",normal1:"zeroValue",normal2:"dependentValue",ArrayKeys:["normal","normal1"],addAction:function(){this.normal1="newZeroValue"
},removeAction:function(){this.normal2="newDependentValue"},removeChainedObserver:function(){this.normal2="chainedPropertyObserved"
}})}});test("should unregister an observer for a property",function(){ObjectD.addObserver("normal",ObjectD,"addAction");
ObjectD.set("normal","newValue");equals(ObjectD.normal1,"newZeroValue");ObjectD.set("normal1","zeroValue");
ObjectD.removeObserver("normal",ObjectD,"addAction");ObjectD.set("normal","newValue");
equals(ObjectD.normal1,"zeroValue")});test("should unregister an observer for a property - special case when key has a '.' in it.",function(){ObjectD.addObserver("ObjectF.propertyVal",ObjectD,"removeChainedObserver");
ObjectD.ObjectF.set("propertyVal","chainedPropertyValue");ObjectD.removeObserver("ObjectF.propertyVal",ObjectD,"removeChainedObserver");
ObjectD.normal2="dependentValue";ObjectD.ObjectF.set("propertyVal","removedPropertyValue");
equals("dependentValue",ObjectD.normal2);ObjectD.set("ObjectF","");equals("dependentValue",ObjectD.normal2)
});module("Bind function ",{setup:function(){objectA=SC.Object.create({name:"Sproutcore",location:"Timbaktu"});
objectB=SC.Object.create({normal:"value",computed:function(){this.normal="newValue"
}});Namespace={objectA:objectA,objectB:objectB}}});test("should bind property with method parameter as undefined",function(){objectA.bind("name","Namespace.objectB.normal",undefined);
SC.Binding.flushPendingChanges();objectB.set("normal","changedValue");SC.Binding.flushPendingChanges();
equals("changedValue",objectA.get("name"),"objectA.name is binded")});test("changing chained observer object to null should not raise exception",function(){var e=SC.Object.create({foo:SC.Object.create({bar:SC.Object.create({bat:"BAT"})})});
var d=0;e.foo.addObserver("bar.bat",e,function(j,g,h){equals(j,null,"new target value should be null");
equals(g,"bat","key should be bat");d++});SC.run(function(){e.foo.set("bar",null)
});equals(d,1,"changing bar should trigger observer");expect(3)});var revMatches=NO,ObjectA;
module("object.propertyChanges",{setup:function(){ObjectA=SC.Object.create({foo:"fooValue",prop:"propValue",action:function(){this.prop="changedPropValue"
}.observes("foo"),newFoo:"newFooValue",newProp:"newPropValue",notifyAction:function(){this.newProp="changedNewPropValue"
}.observes("newFoo"),notifyAllAction:function(){this.newFoo="changedNewFooValue"}.observes("prop"),starProp:null,starObserver:function(h,e,g,d){revMatches=(d===h.propertyRevision);
this.starProp=e}})}});test("should observe the changes within the nested begin / end property changes",function(){ObjectA.beginPropertyChanges();
ObjectA.beginPropertyChanges();ObjectA.set("foo","changeFooValue");equals(ObjectA.prop,"propValue");
ObjectA.endPropertyChanges();ObjectA.set("prop","changePropValue");equals(ObjectA.newFoo,"newFooValue");
ObjectA.endPropertyChanges();equals(ObjectA.prop,"changedPropValue");equals(ObjectA.newFoo,"changedNewFooValue")
});test("should increment the indicator before begining the changes to the object",function(){equals(ObjectA.beginPropertyChanges()._kvo_changeLevel,1)
});test("should increment the indicator before begining the changes to the object",function(){equals(ObjectA.endPropertyChanges()._kvo_changeLevel,0)
});test("should observe the changes within the begin and end property changes",function(){ObjectA.beginPropertyChanges();
ObjectA.set("foo","changeFooValue");equals(ObjectA.prop,"propValue");ObjectA.endPropertyChanges();
equals(ObjectA.prop,"changedPropValue")});test("should indicate that the property of an object has just changed",function(){ObjectA.propertyWillChange("foo");
equals(ObjectA.prop,"propValue");ObjectA.foo="changeFooValue";ObjectA.propertyDidChange("foo",null);
equals(ObjectA.prop,"changedPropValue")});test("should notify that the property of an object has changed",function(){ObjectA.notifyPropertyChange("newFoo","fooValue");
equals(ObjectA.newProp,"changedNewPropValue")});test("should notify all observers that their property might have changed",function(){ObjectA.allPropertiesDidChange();
equals(ObjectA.prop,"changedPropValue");equals(ObjectA.newProp,"changedNewPropValue");
equals(ObjectA.newFoo,"changedNewFooValue")});test("star observers",function(){ObjectA.addObserver("*",ObjectA,ObjectA.starObserver);
ObjectA.set("foo","bar");equals(ObjectA.starProp,"foo","should have fired star observer for foo");
ObjectA.set("bar","foo");equals(ObjectA.starProp,"bar","should have fired star observer for bar")
});test("revision passed to observers should match .propertyRevision",function(){equals(revMatches,true)
});test("should invalidate function property cache when notifyPropertyChange is called",function(){var d=SC.Object.create({_b:null,b:function(e,g){if(g!==undefined){this._b=g;
return this}return this._b}.property()});d.set("b","foo");equals(d.get("b"),"foo","should have set the correct value for property b");
d._b="bar";d.notifyPropertyChange("b");d.set("b","foo");equals(d.get("b"),"foo","should have invalidated the cache so that the newly set value is actually set")
});var object;module("object.registerDependentKeys()",{setup:function(){object=SC.Object.create({firstName:"John",lastName:"Doe",observedValue:"",fullName:function(){return this.getEach("firstName","lastName").compact().join(" ")
}.property(),init:function(){arguments.callee.base.apply(this,arguments);this.registerDependentKey("fullName","firstName","lastName")
},fullNameDidChange:function(){this.set("observedValue",this.get("fullName"))}.observes("fullName")})
}});test("should indicate the registered property changes if the dependent key value changes",function(){object.set("firstName","Jane");
equals(object.get("observedValue"),"Jane Doe");object.set("lastName","Johnson");equals(object.get("observedValue"),"Jane Johnson")
});test("should indicate the registered property changes if the dependent key value changes and change is within begin property loop ",function(){object.beginPropertyChanges();
object.set("firstName","Jane");object.set("lastName","Johnson");equals(object.get("observedValue"),"");
object.endPropertyChanges();object.set("lastName","Johnson");equals(object.get("observedValue"),"Jane Johnson")
});var ObjectA;module("object.propertyChanges()",{setup:function(){ObjectA=SC.Object.create({normal:"value",normal1:"zeroValue",action:function(){this.normal1="newValue"
}.observes("normal"),normal2:"dependentValue",normal3:"notifiedValue",notifyAction:function(){this.normal3="newDependentValue"
}.observes("normal2"),notifyAllAction:function(){this.normal2="newZeroValue"}.observes("normal1")})
}});test("should increment the indicator before begining the changes to the object",function(){equals(ObjectA.beginPropertyChanges()._kvo_changeLevel,1)
});test("should increment the indicator before begining the changes to the object",function(){equals(ObjectA.endPropertyChanges()._kvo_changeLevel,0)
});test("should indicate that the property of an object has just changed",function(){equals(ObjectA.propertyWillChange("normal"),ObjectA);
ObjectA.normal="newValue";equals(ObjectA.propertyDidChange("normal",null),ObjectA);
equals(ObjectA.normal1,"newValue")});test("should notify that the property of an object has changed",function(){ObjectA.notifyPropertyChange("normal2","value");
equals(ObjectA.normal3,"newDependentValue")});test("should notify all observers that their property might have changed",function(){ObjectA.allPropertiesDidChange();
equals(ObjectA.normal2,"newZeroValue")});var callCount,obj;module("SC.Observers.isObservingSuspended",{setup:function(){callCount=0;
obj=SC.Object.create({foo:"bar",fooDidChange:function(){callCount++}.observes("foo")})
}});test("suspending observers stops notification",function(){SC.Observers.suspendPropertyObserving();
SC.Observers.suspendPropertyObserving();obj.set("foo");equals(callCount,0,"should not notify observer while suspended");
SC.Observers.resumePropertyObserving();equals(callCount,0,"should not notify observer while still suspended");
SC.Observers.resumePropertyObserving();equals(callCount,1,"should notify observer when resumed")
});test("suspended notifications should work when nesting property change groups",function(){SC.Observers.suspendPropertyObserving();
obj.beginPropertyChanges();obj.set("foo");equals(callCount,0,"should not notify observer while suspended");
obj.endPropertyChanges();equals(callCount,0,"should not notify observer while suspended");
SC.Observers.resumePropertyObserving();equals(callCount,1,"should notify observer when resumed")
});var fromObject,toObject,binding,Bon1,bon2;module("basic object binding",{setup:function(){fromObject=SC.Object.create({value:"start"});
toObject=SC.Object.create({value:"end"});binding=SC.Binding.from("value",fromObject).to("value",toObject).connect();
SC.Binding.flushPendingChanges()}});test("binding is connected",function(){equals(binding.isConnected,YES,"binding.isConnected")
});test("binding has actually been setup",function(){equals(binding._connectionPending,NO,"binding._connectionPending")
});test("binding should have synced on connect",function(){equals(toObject.get("value"),"start","toObject.value should match fromObject.value")
});test("changing fromObject should mark binding as dirty",function(){fromObject.set("value","change");
equals(binding._changePending,YES)});test("fromObject change should propogate to toObject only after flush",function(){fromObject.set("value","change");
equals(toObject.get("value"),"start");SC.Binding.flushPendingChanges();equals(toObject.get("value"),"change")
});test("changing toObject should mark binding as dirty",function(){toObject.set("value","change");
equals(binding._changePending,YES)});test("toObject change should propogate to fromObject only after flush",function(){toObject.set("value","change");
equals(fromObject.get("value"),"start");SC.Binding.flushPendingChanges();equals(fromObject.get("value"),"change")
});test("suspended observing during bindings",function(){fromObject=SC.Object.create({value1:"value1",value2:"value2"});
toObject=SC.Object.create({value1:"value1",value2:"value2",callCount:0,observer:function(){equals(this.get("value1"),"CHANGED","value1 when observer fires");
equals(this.get("value2"),"CHANGED","value2 when observer fires");this.callCount++
}.observes("value1","value2")});toObject.bind("value1",fromObject,"value1");toObject.bind("value2",fromObject,"value2");
fromObject.set("value1","CHANGED").set("value2","CHANGED");SC.Binding.flushPendingChanges();
equals(toObject.callCount,2,"should call observer twice")});test("binding will disconnect",function(){binding.disconnect();
equals(binding.isConnected,NO,"binding.isConnected")});test("binding disconnection actually works",function(){binding.disconnect();
fromObject.set("value","change");SC.Binding.flushPendingChanges();equals(toObject.get("value"),"start")
});module("one way binding",{setup:function(){fromObject=SC.Object.create({value:"start"});
toObject=SC.Object.create({value:"end"});binding=SC.Binding.from("value",fromObject).to("value",toObject).oneWay().connect();
SC.Binding.flushPendingChanges()}});test("changing fromObject should mark binding as dirty",function(){fromObject.set("value","change");
equals(binding._changePending,YES)});test("fromObject change should propogate after flush",function(){fromObject.set("value","change");
equals(toObject.get("value"),"start");SC.Binding.flushPendingChanges();equals(toObject.get("value"),"change")
});test("changing toObject should not make binding dirty",function(){toObject.set("value","change");
equals(binding._changePending,NO)});test("toObject change should NOT propogate",function(){toObject.set("value","change");
equals(fromObject.get("value"),"start");SC.Binding.flushPendingChanges();equals(fromObject.get("value"),"start")
});var first,second,third,binding1,binding2;module("chained binding",{setup:function(){first=SC.Object.create({output:"first"});
second=SC.Object.create({input:"second",output:"second",inputDidChange:function(){this.set("output",this.get("input"))
}.observes("input")});third=SC.Object.create({input:"third"});binding1=SC.Binding.from("output",first).to("input",second).connect();
binding2=SC.Binding.from("output",second).to("input",third).connect();SC.Binding.flushPendingChanges()
}});test("changing first output should propograte to third after flush",function(){first.set("output","change");
equals("change",first.get("output"),"first.output");ok("change"!==third.get("input"),"third.input");
var d=YES;while(d){d=SC.Binding.flushPendingChanges()}equals(binding1._changePending,NO,"binding1._changePending");
equals(binding2._changePending,NO,"binding2._changePending");equals("change",first.get("output"),"first.output");
equals("change",second.get("input"),"second.input");equals("change",second.get("output"),"second.output");
equals("change",third.get("input"),"third.input")});module("Custom Binding",{setup:function(){Bon1=SC.Object.extend({value1:"hi",value2:83,array1:[]});
bon2=SC.Object.create({val1:"hello",val2:25,arr:[1,2,3,4]});TestNamespace={bon2:bon2,Bon1:Bon1}
},teardown:function(){delete Bon1;delete bon2}});test("Binding value1 such that it will recieve only single values",function(){var e=Bon1.create({value1Binding:SC.Binding.single("TestNamespace.bon2.val1"),array1Binding:SC.Binding.single("TestNamespace.bon2.arr")});
SC.Binding.flushPendingChanges();var d=[23,31,12,21];bon2.set("arr",d);bon2.set("val1","changed");
SC.Binding.flushPendingChanges();equals(bon2.get("val1"),e.get("value1"));equals("@@MULT@@",e.get("array1"));
e.destroy()});test("Single binding using notEmpty function.",function(){var d=Bon1.create({array1Binding:SC.Binding.single("TestNamespace.bon2.arr").notEmpty(null,"(EMPTY)")});
SC.Binding.flushPendingChanges();bon2.set("arr",[]);SC.Binding.flushPendingChanges();
equals("(EMPTY)",d.get("array1"))});test("Binding with transforms, function to check the type of value",function(){var d=Bon1.create({value1Binding:SC.Binding.transform(function(e){return(SC.typeOf(e)==SC.T_STRING)?e:""
}).from("TestNamespace.bon2.val1")});SC.Binding.flushPendingChanges();bon2.set("val1","changed");
SC.Binding.flushPendingChanges();equals(d.get("value1"),bon2.get("val1"))});test("two bindings to the same value should sync in the order they are initialized",function(){SC.LOG_BINDINGS=YES;
SC.RunLoop.begin();window.a=SC.Object.create({foo:"bar"});var e=window.a;window.b=SC.Object.create({foo:"baz",fooBinding:"a.foo",C:SC.Object.extend({foo:"bee",fooBinding:"*owner.foo"}),init:function(){arguments.callee.base.apply(this,arguments);
this.set("c",this.C.create({owner:this}))}});var d=window.b;SC.LOG_BINDINGS=YES;SC.RunLoop.end();
equals(e.get("foo"),"bar","a.foo should not change");equals(d.get("foo"),"bar","a.foo should propogate up to b.foo");
equals(d.c.get("foo"),"bar","a.foo should propogate up to b.c.foo");window.a=window.b=null
});module("AND binding",{setup:function(){SC.testControllerA=SC.Object.create({value:NO});
SC.testControllerB=SC.Object.create({value:NO});toObject=SC.Object.create({value:null,valueBinding:SC.Binding.and("SC.testControllerA.value","SC.testControllerB.value")})
},teardown:function(){delete SC.testControllerA;delete SC.testControllerB}});test("toObject.value should be YES if both sources are YES",function(){SC.RunLoop.begin();
SC.testControllerA.set("value",YES);SC.testControllerB.set("value",YES);SC.RunLoop.end();
SC.Binding.flushPendingChanges();equals(toObject.get("value"),YES)});test("toObject.value should be NO if either source is NO",function(){SC.RunLoop.begin();
SC.testControllerA.set("value",YES);SC.testControllerB.set("value",NO);SC.RunLoop.end();
SC.Binding.flushPendingChanges();equals(toObject.get("value"),NO);SC.RunLoop.begin();
SC.testControllerA.set("value",YES);SC.testControllerB.set("value",YES);SC.RunLoop.end();
SC.Binding.flushPendingChanges();equals(toObject.get("value"),YES);SC.RunLoop.begin();
SC.testControllerA.set("value",NO);SC.testControllerB.set("value",YES);SC.RunLoop.end();
SC.Binding.flushPendingChanges();equals(toObject.get("value"),NO)});module("OR binding",{setup:function(){SC.testControllerA=SC.Object.create({value:NO});
SC.testControllerB=SC.Object.create({value:null});toObject=SC.Object.create({value:null,valueBinding:SC.Binding.or("SC.testControllerA.value","SC.testControllerB.value")})
},teardown:function(){delete SC.testControllerA;delete SC.testControllerB}});test("toObject.value should be first value if first value is truthy",function(){SC.RunLoop.begin();
SC.testControllerA.set("value","first value");SC.testControllerB.set("value","second value");
SC.RunLoop.end();SC.Binding.flushPendingChanges();equals(toObject.get("value"),"first value")
});test("toObject.value should be second value if first is falsy",function(){SC.RunLoop.begin();
SC.testControllerA.set("value",NO);SC.testControllerB.set("value","second value");
SC.RunLoop.end();SC.Binding.flushPendingChanges();equals(toObject.get("value"),"second value")
});module("Binding with '[]'",{setup:function(){fromObject=SC.Object.create({value:[]});
toObject=SC.Object.create({value:""});binding=SC.Binding.transform(function(d){return d?d.join(","):""
}).from("value.[]",fromObject).to("value",toObject).connect()}});test("Binding refreshes after a couple of items have been pushed in the array",function(){fromObject.get("value").pushObjects(["foo","bar"]);
SC.Binding.flushPendingChanges();equals(toObject.get("value"),"foo,bar")});var setCookies=["cookie","cookie2","cookie-hashincreate","cookie-usingset","cookie-2-1","cookie-2-2","cookie-2-3","cookie-expires","cookie-destroy","cookie-find"];
eraseCookies();setCookies=[];if(document.cookie!=""){SC.Logger.warn("document.cookie not empty -- test results may be contaminated -- %@".fmt(document.cookie))
}module("SC.Cookie",{setup:function(){setCookies=[]},teardown:function(){eraseCookies()
}});function createCookie(g,h,j){var d;if(j){var e=new Date();e.setTime(e.getTime()+(j*24*60*60*1000));
d="; expires="+e.toGMTString()}else{d=""}document.cookie=g+"="+h+d+"; path=/"}function readCookie(e){var h=e+"=";
var d=document.cookie.split(";");for(var g=0;g<d.length;g++){var j=d[g];while(j.charAt(0)==" "){j=j.substring(1,j.length)
}if(j.indexOf(h)==0){return decodeURIComponent(j.substring(h.length,j.length))}}return null
}function eraseCookies(){setCookies.forEach(function(d){createCookie(d,"",-1)})}test("Setting a cookie - hash in create",function(){var e=new Date();
e.setTime(e.getTime()+1000);var g=SC.Cookie.create({name:"cookie-hashincreate",value:"testing value",expires:e}).write();
var d=readCookie("cookie-hashincreate");equals(d,"testing value","value from document.cookie should match what we set");
setCookies=["cookie-hashincreate"]});test("Setting a cookie - using set",function(){var e=new Date();
e.setTime(e.getTime()+1000);var g=SC.Cookie.create({expires:e}).set("name","cookie-usingset").set("value","testing value").write();
var d=readCookie("cookie-usingset");equals(d,"testing value","value from document.cookie should match what we set");
setCookies=["cookie-usingset"]});test("Setting a cookie - no write",function(){var e=new Date();
e.setTime(e.getTime()+1000);var g=SC.Cookie.create({name:"cookie-nowrite",value:"testing value",expires:e});
var d=readCookie("cookie-nowrite");equals(d,null,"value from document.cookie should be null");
setCookies=["cookie-nowrite"]});test("Setting 2 cookies",function(){var e=new Date();
e.setTime(e.getTime()+1000);var g=SC.Cookie.create({name:"cookie-2-1",value:"testing value",expires:e}).write();
var h=SC.Cookie.create({name:"cookie-2-2",value:"testing value for second",expires:e}).write();
var j=readCookie("cookie-2-1");equals(j,"testing value","value from first cookie");
var d=readCookie("cookie-2-2");equals(d,"testing value for second","value from second cookie");
setCookies=["cookie-2-1","cookie-2-2"]});test("Setting 2 cookies - overwriting",function(){var e=new Date();
e.setTime(e.getTime()+1000);var g=SC.Cookie.create({name:"cookie-2-3",value:"testing value",expires:e}).write();
var j=readCookie("cookie-2-3");equals(j,"testing value","value from first cookie");
var h=SC.Cookie.create({name:"cookie-2-3",value:"testing value for second",expires:e}).write();
var d=readCookie("cookie-2-3");equals(d,"testing value for second","value from second cookie");
setCookies=["cookie-2-3"]});test("Destroying a cookie - expires",function(){var g=new Date();
g.setTime(g.getTime()+1000);var h=SC.Cookie.create({name:"cookie-expires",value:"testing value",expires:g}).write();
var d=readCookie("cookie-expires");equals(d,"testing value","value from document.cookie should match what we set");
h.set("expires",-1).write();var e=readCookie("cookie-expires");equals(e,null,"value from document.cookie should be null");
setCookies=["cookie-expires"]});test("Destroying a cookie - destroy",function(){var g=new Date();
g.setTime(g.getTime()+1000);var h=SC.Cookie.create({name:"cookie-destroy",value:"testing value",expires:g}).write();
var d=readCookie("cookie-destroy");equals(d,"testing value","value from document.cookie should match what we set");
h.destroy();var e=readCookie("cookie-destroy");equals(e,null,"value from document.cookie should be null");
setCookies=["cookie-destroy"]});test("find",function(){var e=new Date();e.setTime(e.getTime()+1000);
var g=SC.Cookie.create({name:"cookie-find",value:"testing value",expires:e}).write();
var d=SC.Cookie.find("cookie-find");equals(d.get("name"),g.get("name"),"cookie names should be equal");
equals(d.get("value"),g.get("value"),"cookie values should be equal");setCookies=["cookie-find"]
});module("SC.ERROR");test("SC.Error.desc creates an error instance with description,label and code",function(){var d=SC.Error.desc("This is an error instance","Error Instance","FOO",99999);
equals(SC.T_ERROR,SC.typeOf(d),"Error instance");equals("This is an error instance",d.message,"Description");
equals("Error Instance",d.label,"Label");equals(d.get("errorValue"),"FOO","error value should be set");
equals(99999,d.code,"Code")});test("SC.$error creates an error instance with description,label and code",function(){var e=SC.$error("This is a new error instance","New Error Instance","FOO",99999);
equals(SC.T_ERROR,SC.typeOf(e),"New Error instance");equals("This is a new error instance",e.message,"Description");
equals("New Error Instance",e.label,"Label");equals(e.get("errorValue"),"FOO","error value should be set");
equals(99999,e.code,"Code")});test("SC.$ok should return YES if the passed value is an error object or false",function(){ok(SC.$ok(true),"$ok(true) should be YES");
ok(!SC.$ok(false),"$ok(false) should be NO");ok(SC.$ok(null),"$ok(null) should be YES");
ok(SC.$ok(undefined),"$ok(undefined) should be YES");ok(SC.$ok("foo"),"$ok(foo) should be YES");
ok(!SC.$ok(SC.$error("foo")),"$ok(SC.Error) should be NO");ok(!SC.$ok(new SC.Error()),"$ok(Error) should be NO");
ok(!SC.$ok(SC.Object.create({isError:YES})),"$ok({ isError: YES }) should be NO")
});test("SC.$val should return the error value if it has one",function(){equals(SC.val(true),true,"val(true) should be true");
equals(SC.val(false),false,"val(false) should be false");equals(SC.val(null),null,"val(null) should be YES");
equals(SC.val(undefined),undefined,"$ok(undefined) should be YES");equals(SC.val("foo"),"foo","val(foo) should be YES");
equals(SC.val(SC.$error("foo","FOO","BAZ")),"BAZ","val(SC.Error) should be BAZ");
equals(SC.val(SC.$error("foo","FOO")),undefined,"val(SC.Error) should be undefined");
equals(SC.val(new SC.Error()),null,"val(Error) should be null");equals(SC.val(SC.Object.create({isError:YES,errorValue:"BAR"})),"BAR","val({ isError: YES, errorValue: BAR }) should be BAR")
});test("errorObject property should return the error itself",function(){var d=SC.$error("foo");
equals(d.get("errorObject"),d,"errorObject should return receiver")});var set;module("SC.IndexSet#add",{setup:function(){set=SC.IndexSet.create()
}});function iter(e){var d=[];set.forEach(function(g){d.push(g)});return d}test("add range to end of set",function(){set.add(1000,5);
equals(set.get("length"),5,"should have correct index count");equals(set.get("max"),1005,"max should return 1 past last index");
same(iter(set),[1000,1001,1002,1003,1004])});test("add range into middle of empty range",function(){set.add(100,2);
equals(iter(set)[0],100,"precond - first index is 100");set.add(10,1);equals(set.get("length"),3,"should have extra length");
equals(set.get("max"),102,"max should return 1 past last index");same(iter(set),[10,100,101])
});test("add range overlapping front edge of range",function(){set.add(100,2);equals(iter(set)[0],100,"precond - first index is 100");
set.add(99,2);equals(set.get("length"),3,"should have extra length");equals(set.get("max"),102,"max should return 1 past last index");
same(iter(set),[99,100,101])});test("add range overlapping last edge of range",function(){set.add(100,2).add(200,2);
same(iter(set),[100,101,200,201],"should have two sets");set.add(101,2);equals(set.get("length"),5,"new set.length");
equals(set.get("max"),202,"max should return 1 past last index");same(iter(set),[100,101,102,200,201],"should include 101-102")
});test("add range overlapping two ranges, merging into one",function(){set.add(100,2).add(110,2);
same(iter(set),[100,101,110,111],"should have two sets");set.add(101,10);equals(set.get("length"),12,"new set.length");
equals(set.get("max"),112,"max should return 1 past last index");same(iter(set),[100,101,102,103,104,105,106,107,108,109,110,111],"should include one range 100-111")
});test("add range overlapping three ranges, merging into one",function(){set.add(100,2).add(105,2).add(110,2);
same(iter(set),[100,101,105,106,110,111],"should have two sets");set.add(101,10);
equals(set.get("length"),12,"new set.length");equals(set.get("max"),112,"max should return 1 past last index");
same(iter(set),[100,101,102,103,104,105,106,107,108,109,110,111],"should include one range 100-111")
});test("add range partially overlapping one range and replaing another range, merging into one",function(){set.add(100,2).add(105,2);
same(iter(set),[100,101,105,106],"should have two sets");set.add(101,10);equals(set.get("length"),11,"new set.length");
equals(set.get("max"),111,"max should return 1 past last index");same(iter(set),[100,101,102,103,104,105,106,107,108,109,110],"should include one range 100-110")
});test("add range overlapping last index",function(){set.add(100,2);equals(iter(set)[0],100,"precond - first index is 100");
set.add(101,2);equals(set.get("length"),3,"should have extra length");equals(set.get("max"),103,"max should return 1 past last index");
same(iter(set),[100,101,102])});test("add range matching existing range",function(){set.add(100,5);
equals(iter(set)[0],100,"precond - first index is 100");set.add(100,5);equals(set.get("length"),5,"should not change");
equals(set.get("max"),105,"max should return 1 past last index");same(iter(set),[100,101,102,103,104])
});test("add with no params should do nothing",function(){set.add();same(iter(set),[])
});test("add with single number should add index only",function(){set.add(2);same(iter(set),[2])
});test("add with range object should add range only",function(){set.add({start:2,length:2});
same(iter(set),[2,3])});test("add with index set should add indexes in set",function(){set.add(SC.IndexSet.create().add(2,2).add(10,2));
same(iter(set),[2,3,10,11])});test("adding a range should trigger an observer notification",function(){var d=0;
set.addObserver("[]",function(){d++});set.add(10,10);equals(d,1,"should have called observer once")
});test("adding a range over an existing range should not trigger an observer notification",function(){var d=0;
set.add(10,10);set.addObserver("[]",function(){d++});set.add(15,5);equals(d,0,"should not have called observer")
});test("appending a range to end should merge into last range",function(){set=SC.IndexSet.create(2).add(3);
equals(set.rangeStartForIndex(3),2,"last two range should merge together (%@)".fmt(set.inspect()));
equals(set.get("max"),4,"should have max");equals(set.get("length"),2,"should have length");
set=SC.IndexSet.create(2000,1000).add(3000,1000);equals(set.rangeStartForIndex(3990),2000,"last two range should merge together (%@)".fmt(set.inspect()));
equals(set.get("max"),4000,"should have max");equals(set.get("length"),2000,"should have length")
});test("appending range to start of empty set should create a single range",function(){set=SC.IndexSet.create().add(0,2);
equals(set.rangeStartForIndex(1),0,"should have single range (%@)".fmt(set.inspect()));
equals(set.get("length"),2,"should have length");equals(set.get("max"),2,"should have max");
set=SC.IndexSet.create().add(0,2000);equals(set.rangeStartForIndex(1998),0,"should have single range (%@)".fmt(set.inspect()));
equals(set.get("length"),2000,"should have length");equals(set.get("max"),2000,"should have max")
});test("add raises exception when frozen",function(){should_throw(function(){set.freeze().add(0,2)
},SC.FROZEN_ERROR)});test("adding in the same range should keep length consistent",function(){set=SC.IndexSet.create();
set.add(1,4);equals(set.length,4,"set length should be 4");set.add(1,3);equals(set.length,4,"set length should remain 4 after set.add(1,3)");
set.add(1,2);equals(set.length,4,"set length should remain 4 after set.add(1,2)")
});var set;module("SC.IndexSet#addEach",{setup:function(){set=SC.IndexSet.create()
}});function iter(e){var d=[];set.forEach(function(g){d.push(g)});return d}test("adding should iterate over an array",function(){set.addEach([1000,1010,1020,1030]);
equals(set.get("length"),4,"should have correct index count");equals(set.get("max"),1031,"max should return 1 past last index");
same(iter(set),[1000,1010,1020,1030])});test("adding should iterate over a set",function(){var d=SC.Set.create().add(1030).add(1010).add(1020).add(1000);
set.addEach(d);equals(set.get("length"),4,"should have correct index count");equals(set.get("max"),1031,"max should return 1 past last index");
same(iter(set),[1000,1010,1020,1030])});test("adding should iterate over a indexset",function(){var d=SC.IndexSet.create().add(1000,2).add(1010).add(1020).add(1030);
set.addEach(d);equals(set.get("length"),5,"should have correct index count");equals(set.get("max"),1031,"max should return 1 past last index");
same(iter(set),[1000,1001,1010,1020,1030])});var set;module("SC.IndexSet#clone",{setup:function(){set=SC.IndexSet.create()
}});test("clone should return new object with same key properties",function(){set.add(100,100).add(200,100);
set.source="foo";var d=set.clone();ok(d!==null,"return value should not be null");
ok(d!==set,"cloned set should not be same instance as set");ok(set.isEqual(d),"set.isEqual(set2) should be true");
equals(d.get("length"),set.get("length"),"clone should have same length");equals(d.get("min"),set.get("min"),"clone should have same min");
equals(d.get("max"),set.get("max"),"clone should have same max");equals(d.get("source"),set.get("source"),"clone should have same source")
});test("cloning frozen object returns unfrozen",function(){var d=set.freeze().clone();
equals(d.get("isFrozen"),NO,"set2.isFrozen should be NO")});test("copy works like clone",function(){same(set.copy(),set,"should return copy");
ok(set.copy()!==set,"should not return same instance");set.freeze();equals(set.frozenCopy(),set,"should return same instance when frozen")
});var set;module("SC.IndexSet#contains",{setup:function(){set=SC.IndexSet.create().add(1000,10).add(2000,1)
}});test("handle index in set",function(){equals(set.contains(1001),YES,"index 1001 should be in set %@".fmt(set));
equals(set.contains(1009),YES,"index 1009 should be in set %@".fmt(set));equals(set.contains(2000),YES,"index 2000 should be in set %@".fmt(set))
});test("handle index not in set",function(){equals(set.contains(0),NO,"index 0 should not be in set");
equals(set.contains(10),NO,"index 10 should not be in set");equals(set.contains(1100),NO,"index 1100 should not be in set")
});test("handle index past end of set",function(){equals(set.contains(3000),NO,"index 3000 should not be in set")
});test("handle range inside set",function(){equals(set.contains(1001,4),YES,"1001..1003 should be in set")
});test("handle range outside of set",function(){equals(set.contains(100,4),NO,"100..1003 should NOT be in set")
});test("handle range partially inside set",function(){equals(set.contains(998,4),NO,"998..1001 should be in set")
});test("handle set inside set",function(){var d=SC.IndexSet.create().add(1001,4).add(1005,2);
equals(set.contains(d),YES,"%@ should be in %@".fmt(d,set))});test("handle range outside of set",function(){var d=SC.IndexSet.create().add(100,4).add(105,2);
equals(set.contains(d),NO,"%@ should be in %@".fmt(d,set))});test("handle range partially inside set",function(){var d=SC.IndexSet.create().add(1001,4).add(100,2);
equals(set.contains(d),NO,"%@ should be in %@".fmt(d,set))});test("handle self",function(){equals(set.contains(set),YES,"should return YES when passed itself")
});module("SC.IndexSet#create");test("create with no params",function(){var d=SC.IndexSet.create();
equals(d.get("length"),0,"should have no indexes")});test("create with just index",function(){var d=SC.IndexSet.create(4);
equals(d.get("length"),1,"should have 1 index");equals(d.contains(4),YES,"should contain index");
equals(d.contains(5),NO,"should not contain 5")});test("create with index and length",function(){var d=SC.IndexSet.create(4,2);
equals(d.get("length"),2,"should have 2 indexes");equals(d.contains(4),YES,"should contain 4");
equals(d.contains(5),YES,"should contain 5")});test("create with other set",function(){var d=SC.IndexSet.create(4,2);
var e=SC.IndexSet.create(d);equals(e.get("length"),2,"should have same number of indexes (2)");
equals(e.contains(4),YES,"should contain 4, just like first");equals(e.contains(5),YES,"should contain 5, just like first")
});var set;module("SC.IndexSet.indexAfter",{setup:function(){set=SC.IndexSet.create(5).add(10,5).add(100)
}});test("no earlier index in set",function(){equals(set.indexAfter(3),5,"set.indexAfter(3) in %@ should start of first index range".fmt(set))
});test("with index after end of set",function(){equals(set.indexAfter(1000),-1,"set.indexAfter(1000) in %@ should return -1".fmt(set))
});test("inside of multi-index range",function(){equals(set.indexAfter(12),13,"set.indexAfter(12) in %@ should return next index".fmt(set))
});test("end of multi-index range",function(){equals(set.indexAfter(14),100,"set.indexAfter(14) in %@ should start of next range".fmt(set))
});test("single index range",function(){equals(set.indexAfter(5),10,"set.indexAfter(5) in %@ should start of next range multi-index range".fmt(set))
});var set;module("SC.IndexSet.indexBefore",{setup:function(){set=SC.IndexSet.create(5).add(10,5).add(100)
}});test("no earlier index in set",function(){equals(set.indexBefore(4),-1,"set.indexBefore(4) in %@ should not have index before it".fmt(set))
});test("with index after end of set",function(){equals(set.indexBefore(1000),100,"set.indexBefore(1000) in %@ should return last index in set".fmt(set))
});test("inside of multi-index range",function(){equals(set.indexBefore(12),11,"set.indexBefore(12) in %@ should return previous index".fmt(set))
});test("beginning of multi-index range",function(){equals(set.indexBefore(10),5,"set.indexBefore(10) in %@ should end of previous range".fmt(set))
});test("single index range",function(){equals(set.indexBefore(100),14,"set.indexBefore(100) in %@ should end of previous range multi-index range".fmt(set))
});var set;module("SC.IndexSet#intersects",{setup:function(){set=SC.IndexSet.create().add(1000,10).add(2000,1)
}});test("handle index in set",function(){equals(set.intersects(1001),YES,"index 1001 should be in set %@".fmt(set));
equals(set.intersects(1009),YES,"index 1009 should be in set %@".fmt(set));equals(set.intersects(2000),YES,"index 2000 should be in set %@".fmt(set))
});test("handle index not in set",function(){equals(set.intersects(0),NO,"index 0 should not be in set");
equals(set.intersects(10),NO,"index 10 should not be in set");equals(set.intersects(1100),NO,"index 1100 should not be in set")
});test("handle index past end of set",function(){equals(set.intersects(3000),NO,"index 3000 should not be in set")
});test("handle range inside set",function(){equals(set.intersects(1001,4),YES,"1001..1003 should be in set")
});test("handle range outside of set",function(){equals(set.intersects(100,4),NO,"100..1003 should NOT be in set")
});test("handle range partially inside set",function(){equals(set.intersects(998,4),YES,"998..1001 should be in set")
});test("handle set inside set",function(){var d=SC.IndexSet.create().add(1001,4).add(1005,2);
equals(set.intersects(d),YES,"%@ should be in %@".fmt(d,set))});test("handle range outside of set",function(){var d=SC.IndexSet.create().add(100,4).add(105,2);
equals(set.intersects(d),NO,"%@ should be in %@".fmt(d,set))});test("handle range partially inside set",function(){var d=SC.IndexSet.create().add(1001,4).add(100,2);
equals(set.intersects(d),YES,"%@ should be in %@".fmt(d,set))});test("handle self",function(){equals(set.contains(set),YES,"should return YES when passed itself")
});module("SC.IndexSet#max");test("newly created index",function(){var d=SC.IndexSet.create();
equals(d.get("max"),0,"max should be 0")});test("after adding one range",function(){var d=SC.IndexSet.create().add(4,2);
equals(d.get("max"),6,"max should be one greater than max index")});test("after adding range then removing part of range",function(){var d=SC.IndexSet.create().add(4,4).remove(6,4);
equals(d.get("max"),6,"max should be one greater than max index")});test("after adding range several disjoint ranges",function(){var d=SC.IndexSet.create().add(4,4).add(6000);
equals(d.get("max"),6001,"max should be one greater than max index")});test("after removing disjoint range",function(){var d=SC.IndexSet.create().add(4,2).add(6000).remove(5998,10);
equals(d.get("max"),6,"max should be one greater than max index")});test("after removing all ranges",function(){var d=SC.IndexSet.create().add(4,2).add(6000).remove(3,6200);
equals(d.get("max"),0,"max should be back to 0 with no content")});module("SC.IndexSet#min");
test("newly created index",function(){var d=SC.IndexSet.create();equals(d.get("min"),-1,"min should be -1")
});test("after adding one range",function(){var d=SC.IndexSet.create().add(4,2);equals(d.get("min"),4,"min should be lowest index")
});test("after adding range then removing part of range",function(){var d=SC.IndexSet.create().add(4,4).remove(2,4);
equals(d.get("min"),6,"min should be lowest index")});test("after adding range several disjoint ranges",function(){var d=SC.IndexSet.create().add(6000).add(4,4);
equals(d.get("min"),4,"min should be lowest index")});test("after removing disjoint range",function(){var d=SC.IndexSet.create().add(4,2).add(6000).remove(2,10);
equals(d.get("min"),6000,"min should be lowest index")});test("after removing all ranges",function(){var d=SC.IndexSet.create().add(4,2).add(6000).remove(3,6200);
equals(d.get("min"),-1,"min should be back to -1 with no content")});test("newly created index, clearing and then adding",function(){var d=SC.IndexSet.create().add(4,2);
equals(d.get("min"),4,"min should be lowest index");d.clear();equals(d.get("min"),-1,"min should be back to -1 with no content");
d.add(7,3);equals(d.get("min"),7,"min should be lowest index")});var set,start,len;
module("SC.IndexSet#rangeStartForIndex",{setup:function(){start=SC.IndexSet.HINT_SIZE*2+10;
len=Math.floor(SC.IndexSet.HINT_SIZE*1.5);set=SC.IndexSet.create().add(start,len)
}});test("index is start of range",function(){equals(set.rangeStartForIndex(start),start,"should return start");
equals(set.rangeStartForIndex(0),0,"should return first range")});test("index is middle of range",function(){equals(set.rangeStartForIndex(start+20),start,"should return start");
equals(set.rangeStartForIndex(start+SC.IndexSet.HINT_SIZE),start,"should return start");
equals(set.rangeStartForIndex(20),0,"should return first range")});test("index last index",function(){equals(set.rangeStartForIndex(start+len),start+len,"should return end of range")
});test("index past last index",function(){equals(set.rangeStartForIndex(start+len+20),start+len,"should return end of range")
});var set;module("SC.IndexSet#remove",{setup:function(){set=SC.IndexSet.create()
}});function iter(e){var d=[];set.forEach(function(g){d.push(g)});return d}test("remove a range after end of set",function(){equals(set.get("length"),0,"precond - should be empty");
set.remove(1000,5);equals(set.get("length"),0,"should still be empty");equals(set.get("max"),0,"max should return 1 past last index");
same(iter(set),[],"should be empty")});test("remove range in middle of an existing range",function(){set.add(100,4);
same(iter(set),[100,101,102,103],"precond - should have range");set.remove(101,2);
equals(set.get("length"),2,"new length should not include removed range");equals(set.get("max"),104,"max should return 1 past last index");
same(iter(set),[100,103],"should remove range in the middle")});test("remove range overlapping front edge of range",function(){set.add(100,2);
equals(iter(set)[0],100,"precond - first index is 100");set.remove(99,2);equals(set.get("length"),1,"should have extra length");
equals(set.get("max"),102,"max should return 1 past last index");same(iter(set),[101])
});test("remove range overlapping last edge of range",function(){set.add(100,2).add(200,2);
same(iter(set),[100,101,200,201],"should have two sets");set.remove(101,2);equals(set.get("length"),3,"new set.length");
equals(set.get("max"),202,"max should return 1 past last index");same(iter(set),[100,200,201],"should remove 101-102")
});test("remove range overlapping two ranges, remove parts of both",function(){set.add(100,2).add(110,2);
same(iter(set),[100,101,110,111],"should have two sets");set.remove(101,10);equals(set.get("length"),2,"new set.length");
equals(set.get("max"),112,"max should return 1 past last index");same(iter(set),[100,111],"should remove range 101-110")
});test("remove range overlapping three ranges, removing one and parts of the others",function(){set.add(100,2).add(105,2).add(110,2);
same(iter(set),[100,101,105,106,110,111],"should have two sets");set.remove(101,10);
equals(set.get("length"),2,"new set.length");equals(set.get("max"),112,"max should return 1 past last index");
same(iter(set),[100,111],"should remove range 101-110")});test("remove range partially overlapping one range and replacing another range",function(){set.add(100,2).add(105,2);
same(iter(set),[100,101,105,106],"should have two sets");set.remove(101,10);equals(set.get("length"),1,"new set.length");
equals(set.get("max"),101,"max should return 1 past last index");same(iter(set),[100],"should include one range 100-110")
});test("remove range overlapping last index",function(){set.add(100,2);equals(iter(set)[0],100,"precond - first index is 100");
set.remove(101,2);equals(set.get("length"),1,"should have extra length");equals(set.get("max"),101,"max should return 1 past last index");
same(iter(set),[100])});test("remove range matching existing range",function(){set.add(100,5);
same(iter(set),[100,101,102,103,104]);set.remove(100,5);equals(set.get("length"),0,"should be empty");
equals(set.get("max"),0,"max should return 1 past last index");same(iter(set),[])
});test("remove with no params should do nothing",function(){set.add(10,2).remove();
same(iter(set),[10,11])});test("remove with single number should add index only",function(){set.add(10,2).remove(10);
same(iter(set),[11])});test("remove with range object should add range only",function(){set.add(10,5).remove({start:10,length:2});
same(iter(set),[12,13,14])});test("remove with index set should add indexes in set",function(){set.add(0,14).remove(SC.IndexSet.create().add(2,2).add(10,2));
same(iter(set),[0,1,4,5,6,7,8,9,12,13])});test("remove a range should trigger an observer notification",function(){var d=0;
set.add(10,20);set.addObserver("[]",function(){d++});set.remove(10,10);equals(d,1,"should have called observer once")
});test("removing a non-existant range should not trigger observer notification",function(){var d=0;
set.addObserver("[]",function(){d++});set.remove(10,10);equals(d,0,"should NOT have called observer")
});test("removing a clone of the same index set should leave an empty set",function(){var e=SC.IndexSet.create(0,2),d=e.clone();
ok(e.isEqual(d),"precond - clone is equal to receiver");e.remove(d);equals(e.get("length"),0,"set should now be empty")
});test("removing an index range outside of target range (specific bug)",function(){var e=SC.IndexSet.create(10,3);
var d=SC.IndexSet.create(0,3);e.remove(d);equals(e.get("length"),3,"length should not change")
});test("remove() raises exception when frozen",function(){should_throw(function(){set.freeze().remove(0,2)
},SC.FROZEN_ERROR)});var set;module("SC.IndexSet#addEach",{setup:function(){set=SC.IndexSet.create().add(1000,2).add(1010).add(1020).add(1030)
}});function iter(e){var d=[];set.forEach(function(g){d.push(g)});return d}test("should iterate over an array",function(){set.removeEach([1000,1010,1020,1030]);
equals(set.get("length"),1,"should have correct index count");equals(set.get("max"),1002,"max should return 1 past last index");
same(iter(set),[1001])});test("adding should iterate over a set",function(){var d=SC.Set.create().add(1030).add(1010).add(1020).add(1000);
set.removeEach(d);equals(set.get("length"),1,"should have correct index count");equals(set.get("max"),1002,"max should return 1 past last index");
same(iter(set),[1001])});test("adding should iterate over a indexset",function(){var d=SC.IndexSet.create().add(1000).add(1010).add(1020).add(1030);
set.removeEach(d);equals(set.get("length"),1,"should have correct index count");equals(set.get("max"),1002,"max should return 1 past last index");
same(iter(set),[1001])});var set,ret;module("SC.IndexSet#without",{setup:function(){set=SC.IndexSet.create(1,9)
}});function iter(e){var d=[];e.forEach(function(g){d.push(g)});return d}test("should return empty set when removing self",function(){ret=set.without(set);
ok(ret!==set,"is not same instance");same(iter(ret),[])});test("should return set with range removed from middle",function(){ret=SC.IndexSet.create(2,6);
ret=set.without(ret);ok(ret!==set,"is not same instance");same(iter(ret),[1,8,9])
});test("should return set with range removed overlapping end",function(){ret=set.without(SC.IndexSet.create(6,6));
ok(ret!==set,"is not same instance");same(iter(ret),[1,2,3,4,5])});test("should return set with range removed overlapping beginning",function(){ret=set.without(SC.IndexSet.create(0,6));
ok(ret!==set,"is not same instance");same(iter(ret),[6,7,8,9])});test("should return set with multiple ranges removed",function(){ret=set.without(SC.IndexSet.create(2,2).add(6,2));
ok(ret!==set,"is not same instance");same(iter(ret),[1,4,5,8,9])});test("using without should properly hint returned index set",function(){var h=SC.IndexSet.create(10000,5),d=SC.IndexSet.create(10000),g=h.without(d),e=SC.IndexSet.HINT_SIZE;
while(e<2000){equals(g._content[e],0,"index set should have hint at loc %@ - set: %@".fmt(e,g.inspect()));
e+=SC.IndexSet.HINT_SIZE}});test("passing no params should return clone",function(){ret=set.without();
ok(ret!==set,"is not same instance");ok(ret.isEqual(set),"has same content")});test("passing single number should remove just that index",function(){ret=set.without(5);
same(iter(ret),[1,2,3,4,6,7,8,9])});test("passing two numbers should remove range",function(){ret=set.without(2,6);
same(iter(ret),[1,8,9])});test("passing range object should remove range",function(){ret=set.without({start:2,length:6});
same(iter(ret),[1,8,9])});function testConsole(){return{log:function(){return true
},alert:function(){return true},debug:function(){return true},dir:function(){return true
},dirxml:function(){return true},error:function(){return true},group:function(){return true
},groupEnd:function(){return true},info:function(){return true},profile:function(){return true
},profileEnd:function(){return true},time:function(){return true},timeEnd:function(){return true
},trace:function(){return true},warn:function(){return true}}}module("SC.Logger",{setup:function(){SC.Logger.set("reporter",testConsole());
SC.Logger.debugEnabled=true;SC.Logger.format=true;SC.Logger.fallBackOnLog=true;SC.Logger.fallBackOnAlert=false
},teardown:function(){}});test("exists",function(){equals(SC.Logger.get("exists"),true,"Reporter does exist check");
SC.Logger.set("reporter",null);equals(SC.Logger.get("exists"),false,"Reporter does not exist check")
});test("log",function(){equals(SC.Logger.log("test"),true,"Function is defined");
var d=SC.Logger.get("reporter");d.log=null;equals(SC.Logger.log("test"),false,"Function is null");
SC.Logger.fallBackOnAlert=true;equals(SC.Logger.log("test"),true,"Function is null -- fallBackOnAlert true")
});test("debug",function(){equals(SC.Logger.debug("Debug"),true,"Function is defined");
SC.Logger.get("reporter").debug=null;equals(SC.Logger.debug("Debug"),true,"Function is null -- fallBackOnLog true");
SC.Logger.fallBackOnLog=false;equals(SC.Logger.debug("Debug"),false,"Function is null -- fallBackOnLog false")
});test("dir",function(){equals(SC.Logger.dir({test:"string"}),true,"Function is defined");
SC.Logger.get("reporter").dir=null;equals(SC.Logger.dir({test:"string"}),true,"Function is null -- fallBackOnLog true");
SC.Logger.fallBackOnLog=false;equals(SC.Logger.dir({test:"string"}),false,"Function is null -- fallBackOnLog false")
});test("dirxml",function(){equals(SC.Logger.dirxml("<here id='2'>is some XML</here>"),true,"Function is defined");
SC.Logger.get("reporter").dirxml=null;equals(SC.Logger.dirxml("<here id='2'>is some XML</here>"),true,"Function is null -- fallBackOnLog true");
SC.Logger.fallBackOnLog=false;equals(SC.Logger.dirxml("<here id='2'>is some XML</here>"),false,"Function is null -- fallBackOnLog false")
});test("error",function(){equals(SC.Logger.error("Error"),true,"Function is defined");
SC.Logger.get("reporter").error=null;equals(SC.Logger.error("Error"),true,"Function is null -- fallBackOnLog true");
SC.Logger.fallBackOnLog=false;equals(SC.Logger.error("Error"),false,"Function is null -- fallBackOnLog false")
});test("group",function(){equals(SC.Logger.group("mygroup"),true,"Function is defined");
SC.Logger.get("reporter").group=null;equals(SC.Logger.group("mygroup"),false,"Function is null")
});test("groupEnd",function(){equals(SC.Logger.groupEnd("mygroup"),true,"Function is defined");
SC.Logger.get("reporter").groupEnd=null;equals(SC.Logger.groupEnd("mygroup"),false,"Function is null")
});test("info",function(){equals(SC.Logger.info("Info"),true,"Function is defined");
SC.Logger.get("reporter").info=null;equals(SC.Logger.info("Info"),true,"Function is null -- fallBackOnLog true");
SC.Logger.fallBackOnLog=false;equals(SC.Logger.info("Info"),false,"Function is null -- fallBackOnLog false")
});test("profile",function(){equals(SC.Logger.profile(),true,"Function is defined");
SC.Logger.get("reporter").profile=null;equals(SC.Logger.profile(),false,"Function is null")
});test("profileEnd",function(){equals(SC.Logger.profileEnd(),true,"Function is defined");
SC.Logger.get("reporter").profileEnd=null;equals(SC.Logger.profileEnd(),false,"Function is null")
});test("time",function(){equals(SC.Logger.time("mytime"),true,"Function is defined");
SC.Logger.get("reporter").time=null;equals(SC.Logger.time("mytime"),false,"Function is null")
});test("timeEnd",function(){equals(SC.Logger.timeEnd("mytime"),true,"Function is defined");
SC.Logger.get("reporter").timeEnd=null;equals(SC.Logger.timeEnd("mytime"),false,"Function is null")
});test("trace",function(){equals(SC.Logger.trace(),true,"Function is defined");SC.Logger.get("reporter").trace=null;
equals(SC.Logger.trace(),false,"Function is null")});test("warn",function(){equals(SC.Logger.warn("Warn"),true,"Function is defined");
SC.Logger.get("reporter").warn=null;equals(SC.Logger.warn("Warn"),true,"Function is null -- fallBackOnLog true");
SC.Logger.fallBackOnLog=false;equals(SC.Logger.warn("Warn"),false,"Function is null -- fallBackOnLog false")
});test("_argumentsToString",function(){equals(SC.Logger._argumentsToString.apply(SC.Logger,["test","test2"]),"test"+SC.LOGGER_LOG_DELIMITER+"test2","Formatting using default delimiter");
SC.LOGGER_LOG_DELIMITER="|";equals(SC.Logger._argumentsToString.apply(SC.Logger,["test","test2"]),"test|test2","Formatting using custom delimiter")
});var obj,obj1,don,don1;module("A new SC.Object instance",{setup:function(){obj=SC.Object.create({foo:"bar",total:12345,aMethodThatExists:function(){},aMethodThatReturnsTrue:function(){return true
},aMethodThatReturnsFoobar:function(){return"Foobar"},aMethodThatReturnsFalse:function(){return NO
}})},teardown:function(){obj=undefined}});test("Should identify it's methods using the 'respondsTo' method",function(){equals(obj.respondsTo("aMethodThatExists"),true);
equals(obj.respondsTo("aMethodThatDoesNotExist"),false)});test("Should return false when asked to perform a method it does not have",function(){equals(obj.tryToPerform("aMethodThatDoesNotExist"),false)
});test("Should pass back the return YES if method returned YES, NO if method not implemented or returned NO",function(){equals(obj.tryToPerform("aMethodThatReturnsTrue"),YES,"method that returns YES");
equals(obj.tryToPerform("aMethodThatReturnsFoobar"),YES,"method that returns non-NO");
equals(obj.tryToPerform("aMethodThatReturnsFalse"),NO,"method that returns NO");equals(obj.tryToPerform("imaginaryMethod"),NO,"method that is not implemented")
});test("Should return it's properties when requested using SC.Object#get",function(){equals(obj.get("foo"),"bar");
equals(obj.get("total"),12345)});test("Should allow changing of those properties by calling SC.Object#set",function(){equals(obj.get("foo"),"bar");
equals(obj.get("total"),12345);obj.set("foo","Chunky Bacon");obj.set("total",12);
equals(obj.get("foo"),"Chunky Bacon");equals(obj.get("total"),12)});test("Should only advertise changes once per request to SC.Object#didChangeFor",function(){obj.set("foo","Chunky Bacon");
equals(obj.didChangeFor(this,"foo"),true);equals(obj.didChangeFor(this,"foo"),false)
});test("Should advertise changes once per request to SC.Object#didChangeFor when setting property to NULL",function(){obj.set("foo",null);
equals(obj.didChangeFor(this,"foo"),true);equals(obj.didChangeFor(this,"foo"),false)
});test("When the object is destroyed the 'isDestroyed' status should change accordingly",function(){equals(obj.get("isDestroyed"),NO);
obj.destroy();equals(obj.get("isDestroyed"),YES)});module("SC.Object instance extended",{setup:function(){obj=SC.Object.extend();
obj1=obj.create();don=SC.Object.extend();don1=don.create()},teardown:function(){obj=undefined;
obj1=undefined;don=undefined;don1=undefined}});test("Checking the instance of method for an object",function(){equals(obj1.instanceOf(obj),YES);
equals(obj1.instanceOf(don),NO)});test("Checking the kind of method for an object",function(){equals(obj1.kindOf(obj),YES);
equals(obj1.kindOf(don),NO);equals(SC.kindOf(obj1,obj),YES);equals(SC.kindOf(obj1,don),NO);
equals(SC.kindOf(null,obj1),NO)});module("SC.Object superclass and subclasses",{setup:function(){obj=SC.Object.extend({method1:function(){return"hello"
}});obj1=obj.extend();don=obj1.create({method2:function(){return this.superclass()
}})},teardown:function(){obj=undefined;obj1=undefined;don=undefined}});test("Checking the superclass method for an existing function",function(){equals(don.method2().method1(),"hello")
});test("Checking the subclassOf function on an object and its subclass",function(){equals(obj1.subclassOf(obj),YES);
equals(obj.subclassOf(obj1),NO)});test("subclasses should contain defined subclasses",function(){ok(obj.subclasses.contains(obj1),"obj.subclasses should contain obj1");
equals(obj1.subclasses.get("length"),0,"obj1.subclasses should be empty");var d=obj1.extend();
ok(obj1.subclasses.contains(d),"obj1.subclasses should contain kls2")});var testObject,fromObject,extraObject,TestObject;
module("bind() method",{setup:function(){testObject=SC.Object.create({foo:"bar",bar:"foo",extraObject:null});
fromObject=SC.Object.create({bar:"foo",extraObject:null});extraObject=SC.Object.create({foo:"extraObjectValue"});
TestNamespace={fromObject:fromObject,testObject:testObject}},teardown:function(){testObject=fromObject=extraObject=null
}});test("bind(TestNamespace.fromObject.bar) should follow absolute path",function(){testObject.bind("foo","TestNamespace.fromObject.bar");
SC.Binding.flushPendingChanges();fromObject.set("bar","changedValue");SC.Binding.flushPendingChanges();
equals("changedValue",testObject.get("foo"),"testObject.foo")});test("bind(.bar) should bind to relative path",function(){testObject.bind("foo",".bar");
SC.Binding.flushPendingChanges();testObject.set("bar","changedValue");SC.Binding.flushPendingChanges();
equals("changedValue",testObject.get("foo"),"testObject.foo")});test("SC.Binding.bool(TestNamespace.fromObject.bar)) should create binding with bool transform",function(){testObject.bind("foo",SC.Binding.bool("TestNamespace.fromObject.bar"));
SC.Binding.flushPendingChanges();fromObject.set("bar",1);SC.Binding.flushPendingChanges();
equals(YES,testObject.get("foo"),"testObject.foo == YES");fromObject.set("bar",0);
SC.Binding.flushPendingChanges();equals(NO,testObject.get("foo"),"testObject.foo == NO")
});test("bind(TestNamespace.fromObject*extraObject.foo) should create chained binding",function(){testObject.bind("foo","TestNamespace.fromObject*extraObject.foo");
SC.Binding.flushPendingChanges();fromObject.set("extraObject",extraObject);SC.Binding.flushPendingChanges();
equals("extraObjectValue",testObject.get("foo"),"testObject.foo")});test("bind(*extraObject.foo) should create locally chained binding",function(){testObject.bind("foo","*extraObject.foo");
SC.Binding.flushPendingChanges();testObject.set("extraObject",extraObject);SC.Binding.flushPendingChanges();
equals("extraObjectValue",testObject.get("foo"),"testObject.foo")});test("bind(*extraObject.foo) should be disconnectable",function(){var d=testObject.bind("foo","*extraObject.foo");
SC.Binding.flushPendingChanges();d.disconnect();SC.Binding.flushPendingChanges()});
module("fooBinding method",{setup:function(){TestObject=SC.Object.extend({foo:"bar",bar:"foo",extraObject:null});
fromObject=SC.Object.create({bar:"foo",extraObject:null});extraObject=SC.Object.create({foo:"extraObjectValue"});
TestNamespace={fromObject:fromObject,testObject:TestObject}},teardown:function(){TestObject=fromObject=extraObject=null
}});test("fooBinding: TestNamespace.fromObject.bar should follow absolute path",function(){testObject=TestObject.create({fooBinding:"TestNamespace.fromObject.bar"});
SC.Binding.flushPendingChanges();fromObject.set("bar","changedValue");SC.Binding.flushPendingChanges();
equals("changedValue",testObject.get("foo"),"testObject.foo")});test("fooBinding: .bar should bind to relative path",function(){testObject=TestObject.create({fooBinding:".bar"});
SC.Binding.flushPendingChanges();testObject.set("bar","changedValue");SC.Binding.flushPendingChanges();
equals("changedValue",testObject.get("foo"),"testObject.foo")});test("fooBinding: SC.Binding.bool(TestNamespace.fromObject.bar should create binding with bool transform",function(){testObject=TestObject.create({fooBinding:SC.Binding.bool("TestNamespace.fromObject.bar")});
SC.Binding.flushPendingChanges();fromObject.set("bar",1);SC.Binding.flushPendingChanges();
equals(YES,testObject.get("foo"),"testObject.foo == YES");fromObject.set("bar",0);
SC.Binding.flushPendingChanges();equals(NO,testObject.get("foo"),"testObject.foo == NO")
});test("fooBinding: TestNamespace.fromObject*extraObject.foo should create chained binding",function(){testObject=TestObject.create({fooBinding:"TestNamespace.fromObject*extraObject.foo"});
SC.Binding.flushPendingChanges();fromObject.set("extraObject",extraObject);SC.Binding.flushPendingChanges();
equals("extraObjectValue",testObject.get("foo"),"testObject.foo")});test("fooBinding: *extraObject.foo should create locally chained binding",function(){testObject=TestObject.create({fooBinding:"*extraObject.foo"});
SC.Binding.flushPendingChanges();testObject.set("extraObject",extraObject);SC.Binding.flushPendingChanges();
equals("extraObjectValue",testObject.get("foo"),"testObject.foo")});module("fooBindingDefault: SC.Binding.Bool (old style)",{setup:function(){TestObject=SC.Object.extend({foo:"bar",fooBindingDefault:SC.Binding.bool(),bar:"foo",extraObject:null});
fromObject=SC.Object.create({bar:"foo",extraObject:null});TestNamespace={fromObject:fromObject,testObject:TestObject}
},teardown:function(){TestObject=fromObject=null}});test("fooBinding: TestNamespace.fromObject.bar should have bool binding",function(){testObject=TestObject.create({fooBinding:"TestNamespace.fromObject.bar"});
SC.Binding.flushPendingChanges();fromObject.set("bar",1);SC.Binding.flushPendingChanges();
equals(YES,testObject.get("foo"),"testObject.foo == YES");fromObject.set("bar",0);
SC.Binding.flushPendingChanges();equals(NO,testObject.get("foo"),"testObject.foo == NO")
});test("fooBinding: SC.Binding.not(TestNamespace.fromObject.bar should override default",function(){testObject=TestObject.create({fooBinding:SC.Binding.not("TestNamespace.fromObject.bar")});
SC.Binding.flushPendingChanges();fromObject.set("bar",1);SC.Binding.flushPendingChanges();
equals(NO,testObject.get("foo"),"testObject.foo == NO");fromObject.set("bar",0);SC.Binding.flushPendingChanges();
equals(YES,testObject.get("foo"),"testObject.foo == YES")});module("fooBindingDefault: SC.Binding.bool() (new style)",{setup:function(){TestObject=SC.Object.extend({foo:"bar",fooBindingDefault:SC.Binding.bool(),bar:"foo",extraObject:null});
fromObject=SC.Object.create({bar:"foo",extraObject:null});TestNamespace={fromObject:fromObject,testObject:testObject}
},teardown:function(){TestObject=fromObject=null}});test("fooBinding: TestNamespace.fromObject.bar should have bool binding",function(){testObject=TestObject.create({fooBinding:"TestNamespace.fromObject.bar"});
SC.Binding.flushPendingChanges();fromObject.set("bar",1);SC.Binding.flushPendingChanges();
equals(YES,testObject.get("foo"),"testObject.foo == YES");fromObject.set("bar",0);
SC.Binding.flushPendingChanges();equals(NO,testObject.get("foo"),"testObject.foo == NO")
});test("fooBinding: SC.Binding.not(TestNamespace.fromObject.bar should override default",function(){testObject=TestObject.create({fooBinding:SC.Binding.not("TestNamespace.fromObject.bar")});
SC.Binding.flushPendingChanges();fromObject.set("bar",1);SC.Binding.flushPendingChanges();
equals(NO,testObject.get("foo"),"testObject.foo == NO");fromObject.set("bar",0);SC.Binding.flushPendingChanges();
equals(YES,testObject.get("foo"),"testObject.foo == YES")});test("Chained binding should be null if intermediate object in chain is null",function(){var d,e;
d=SC.Object.create({b:SC.Object.create({c:"c"}),zBinding:"*b.c"});SC.Binding.flushPendingChanges();
equals(d.get("z"),"c","a.z == 'c'");d.set("b",null);SC.Binding.flushPendingChanges();
equals(d.get("z"),null,"a.z == null")});var source,indexes,observer,obj;module("SC.RangeObserver#create",{setup:function(){source=[1,2,3,4,5].map(function(d){return SC.Object.create({item:d,foo:"bar"})
},this);indexes=SC.IndexSet.create(2,2);observer=SC.Object.create({callCount:0,rangeDidChange:function(){this.callCount++
}});obj=SC.RangeObserver.create(source,indexes,observer,observer.rangeDidChange,"context",YES)
}});test("returns new instance",function(){ok(obj&&obj.isRangeObserver,"returns range observer")
});test("sets up observing on properties for each object in range in index if isDeep",function(){var e=source.length,d;
for(d=0;d<e;d++){source[d].set("foo","baz")}equals(observer.callCount,2,"range observer should fire twice")
});test("does not observe object properties if isDeep is NO",function(){obj.destroy();
obj=SC.RangeObserver.create(source,indexes,observer,observer.rangeDidChange,"context",NO);
var e=source.length,d;for(d=0;d<e;d++){source[d].set("foo","baz")}equals(observer.callCount,0,"range observer should not fire")
});var source,indexes,observer,obj;module("SC.RangeObserver#destroy",{setup:function(){source=[1,2,3,4,5].map(function(d){return SC.Object.create({item:d,foo:"bar"})
},this);indexes=SC.IndexSet.create(2,2);observer=SC.Object.create({callCount:0,rangeDidChange:function(){this.callCount++
}});obj=SC.RangeObserver.create(source,indexes,observer,observer.rangeDidChange,"context",YES)
}});test("returns receiver",function(){ok(obj.destroy()===obj,"should return receiver")
});test("never observes changes if no changes happend",function(){obj.destroy();var e=source.length,d;
for(d=0;d<e;d++){source[d].set("foo","baz")}equals(observer.callCount,0,"range observer should not fire")
});test("stops observes changes if changes happend before destroy",function(){var e=source.length,d;
for(d=0;d<e;d++){source[d].set("foo","baz")}obj.destroy();for(d=0;d<e;d++){source[d].set("foo","bar")
}equals(observer.callCount,2,"range observer should fire only first time through")
});var source,indexes,observer,obj;module("SC.RangeObserver#objectPropertyDidChange",{setup:function(){source=[1,2,3,4,5].map(function(d){return SC.Object.create({item:d,foo:"bar"})
},this);indexes=SC.IndexSet.create(2,2);observer=SC.Object.create({verify:NO,callCount:0,object:NO,key:NO,indexes:NO,context:NO,setupVerify:function(e,h,d,g){this.verify=YES;
this.object=(e===undefined)?NO:e;this.key=(h===undefined)?NO:h;this.indexes=(d===undefined)?NO:d;
this.context=(g===undefined)?NO:g;return this},changeObserver:function(d,g,e,h,j){this.callCount++;
if(this.verify){ok(source===d,"source should match source array");if(this.object||this.object===null){equals(g,this.object,"passed object should match")
}if(this.key!==NO){equals(e,this.key,"passed key should match")}if(this.indexes){ok(h&&h.isIndexSet,"passed indexes should be an index set (actual: %@)".fmt(h));
if(this.indexes.isIndexSet){ok(this.indexes.isEqual(h),"passed indexes should match %@ (actual: %@)".fmt(this.indexes,h))
}}else{if(this.indexes===null){equals(h,null,"passed indexes should be null")}}if(this.context!==NO){equals(j,this.context,"passed context should match")
}}}})}});test("changing property on object that does not appear in range",function(){obj=SC.RangeObserver.create(source,indexes,observer,observer.changeObserver,null,YES);
source[4].set("foo","baz");equals(observer.callCount,0,"should not invoke observer callback")
});test("changing property on object that appears one time in range",function(){observer.setupVerify(source[2],"foo",SC.IndexSet.create(2));
obj=SC.RangeObserver.create(source,indexes,observer,observer.changeObserver,null,YES);
source[2].set("foo","baz");equals(observer.callCount,1,"should not invoke observer callback")
});test("changing property on object that appears more than one time in range",function(){source[3]=source[2];
observer.setupVerify(source[2],"foo",SC.IndexSet.create(2,2));obj=SC.RangeObserver.create(source,indexes,observer,observer.changeObserver,null,YES);
source[2].set("foo","baz");equals(observer.callCount,1,"should not invoke observer callback")
});test("changing all properties on object that apepars one time in range",function(){observer.setupVerify(source[2],"*",SC.IndexSet.create(2));
obj=SC.RangeObserver.create(source,indexes,observer,observer.changeObserver,null,YES);
source[2].allPropertiesDidChange();equals(observer.callCount,1,"should not invoke observer callback")
});test("notifications with context",function(){observer.setupVerify(source[2],"foo",SC.IndexSet.create(2),"context");
obj=SC.RangeObserver.create(source,indexes,observer,observer.changeObserver,"context",YES);
source[2].set("foo","baz");equals(observer.callCount,1,"should not invoke observer callback")
});var source,indexes,observer,obj;module("SC.RangeObserver#rangeDidChange",{setup:function(){source=[1,2,3,4,5].map(function(d){return SC.Object.create({item:d,foo:"bar"})
},this);indexes=SC.IndexSet.create(2,2);observer=SC.Object.create({verify:NO,callCount:0,indexes:NO,changeObserver:function(d,g,e,h,j){this.callCount++;
if(this.verify){ok(source===d,"source should match source array");ok(!g,"object param should be null");
equals(e,"[]","passed key should be brackets");if(this.indexes){ok(this.indexes.isEqual(h),"passed indexes should be %@.  actual: %@".fmt(this.indexes,h))
}else{if(this.indexes===null){equals(h,null,"passed indexes should be null")}}equals(j,"context","should pass context")
}}});obj=SC.RangeObserver.create(source,indexes,observer,observer.changeObserver,"context",YES)
}});test("returns receiver",function(){ok(obj.rangeDidChange()===obj,"should return receiver")
});test("invokes callback if no changes set is passed",function(){observer.verify=YES;
observer.indexes=null;obj.rangeDidChange();equals(observer.callCount,1,"should invoke callback")
});test("invokes callback if changes set is passed and it intersects with observed range",function(){observer.verify=YES;
observer.indexes=SC.IndexSet.create(1,2);obj.rangeDidChange(observer.indexes);equals(observer.callCount,1,"should invoke callback")
});test("does NOT invoke callback if changes set is passed and it intersects with observed range",function(){obj.rangeDidChange(SC.IndexSet.create(4));
equals(observer.callCount,0,"should NOT invoke callback")});test("if object in observed range changes, should stop observing old objects and start observing new objects - no previous changes",function(){var d=SC.Object.create({item:10,foo:"baz"});
source[2]=d;obj.rangeDidChange(SC.IndexSet.create(2));observer.callCount=0;d.set("foo","bar");
equals(observer.callCount,1,"should invoke observer when new object changes")});test("if object in observed range changes, should stop observing old objects and start observing new objects - previous changes",function(){source[2].set("foo","FOO2");
equals(observer.callCount,1,"precond - should invoke observer on original object");
var d=SC.Object.create({item:10,foo:"baz"});source[2]=d;obj.rangeDidChange(SC.IndexSet.create(2));
observer.callCount=0;d.set("foo","bar");equals(observer.callCount,1,"should invoke observer when new object changes")
});var source,indexes,observer,obj;module("SC.RangeObserver#update",{setup:function(){source=[1,2,3,4,5].map(function(d){return SC.Object.create({item:d,foo:"bar"})
},this);indexes=SC.IndexSet.create(2,2);observer=SC.Object.create({callCount:0,rangeDidChange:function(){this.callCount++
}});obj=SC.RangeObserver.create(source,indexes,observer,observer.rangeDidChange,"context",YES)
}});test("returns receiver",function(){ok(obj===obj.update(source,SC.IndexSet.create()),"should return receiver")
});test("switches to observing new range - no previous updated",function(){obj.update(source,SC.IndexSet.create(0));
observer.callCount=0;var e=source.length,d;for(d=0;d<e;d++){source[d].set("foo","baz")
}equals(observer.callCount,1,"range observer should fire on new range")});test("switches to observing new range - previously updated",function(){var e=source.length,d;
for(d=0;d<e;d++){source[d].set("foo","baz")}observer.callCount=0;obj.update(source,SC.IndexSet.create(0));
observer.callCount=0;for(d=0;d<e;d++){source[d].set("foo","bar")}equals(observer.callCount,1,"range observer should fire on new range")
});module("System:run_loop() - chained binding",{setup:function(){first=SC.Object.create({output:"first"});
second=SC.Object.create({input:"second",output:"second",inputDidChange:function(){this.set("output",this.get("input"))
}.observes("input")});third=SC.Object.create({input:"third"})}});test("Should propograte bindings after the RunLoop completes (using SC.RunLoop)",function(){SC.RunLoop.begin();
binding1=SC.Binding.from("output",first).to("input",second).connect();binding2=SC.Binding.from("output",second).to("input",third).connect();
SC.Binding.flushPendingChanges();first.set("output","change");equals(first.get("output"),"change");
equals(second.get("output"),"first");SC.RunLoop.end();equals(first.get("output"),"change");
equals(second.get("output"),"change")});test("Should propograte bindings after the RunLoop completes (using SC.beginRunLoop)",function(){SC.beginRunLoop;
binding1=SC.Binding.from("output",first).to("input",second).connect();binding2=SC.Binding.from("output",second).to("input",third).connect();
SC.Binding.flushPendingChanges();first.set("output","change");equals(first.get("output"),"change");
equals(second.get("output"),"first");SC.endRunLoop;SC.Binding.flushPendingChanges();
equals(first.get("output"),"change");equals(second.get("output"),"change")});test("Should propograte bindings after the RunLoop completes (checking invokeOnce() function)",function(){SC.RunLoop.begin();
binding1=SC.Binding.from("output",first).to("input",second).connect();binding2=SC.Binding.from("output",second).to("input",third).connect();
SC.Binding.flushPendingChanges();first.set("output","change");equals(first.get("output"),"change");
equals(second.get("output"),"first");second.invokeOnce("second","inputDidChange");
SC.RunLoop.end();equals(first.get("output"),"change");equals(second.get("output"),"change");
first.set("output","againChanged");equals(first.get("output"),"againChanged");equals(second.get("output"),"change")
});var set,array,array2;module("SC.SelectionSet#add",{setup:function(){set=SC.SelectionSet.create();
array="0 1 2 3 4 5 6 7 8 9".w();array2="a b c d e f g h i k l m".w()}});function validate(m,j,h){var g=m.get("sources"),e=j.length,d,k,l;
equals(g.length,j.length,"should have same number of sources (actual sources: %@)".fmt(g));
for(d=0;d<e;d++){k=j[d];if(!k.source){k.source=h}l=m.indexSetForSource(k.source,NO);
ok(l,"should have indexSet for source: %@".fmt(k.source));equals(l.source,k.source,"indexSet.source should match source");
ok(l.isEqual(k),"indexSet should match for source %@ (actual: %@ expected: %@)".fmt(k.source,l,k))
}}test("Adding indexes for single source",function(){set.add(array,4,3);validate(set,[SC.IndexSet.create(4,3)],array);
set.add(array,1);validate(set,[SC.IndexSet.create(1).add(4,3)],array)});test("Adding multiple sources",function(){var d=SC.IndexSet.create(4,3);
var e=SC.IndexSet.create(1);d.source=array;e.source=array2;set.add(array,4,3);validate(set,[d]);
set.add(array2,1);validate(set,[d,e])});test("Adding IndexSet with source",function(){var d=SC.IndexSet.create(4,3);
d.source=array;set.add(d);validate(set,[d])});test("Adding another SelectionSet",function(){var e=SC.IndexSet.create(4,3);
var g=SC.IndexSet.create(1,5);e.source=array;g.source=array2;set.add(array,4,3);validate(set,[e]);
var d=SC.SelectionSet.create().add(array2,1,5);validate(d,[g]);set.add(d);validate(set,[e,g])
});test("Adding indexes with range object !!",function(){set.add(array,{start:4,length:3});
validate(set,[SC.IndexSet.create(4,3)],array)});module("SC.SelectionSet.copy");test("basic copy",function(){var d="1 2 3 4 5 6 7 8 9".w(),g=SC.SelectionSet.create().add(d,4,4).remove(d,6),e=g.copy();
equals(g.get("length"),3,"precond - original set should have length");equals(e.get("length"),3,"copy should have same length");
same(e,g,"copy should be the same as original set")});var set,array,array2;module("SC.SelectionSet#indexSetForSource",{setup:function(){set=SC.SelectionSet.create();
array="0 1 2 3 4 5 6 7 8 9".w();array2="a b c d e f g h i k l m".w()}});test("empty selection set",function(){equals(set.indexSetForSource(array),null,"should return null for source not in set");
equals(set.indexSetForSource(array2),null,"should return null for source not in set (2)")
});test("selection set if index range is added",function(){var d;set.add(array,3,4);
d=set.indexSetForSource(array);ok(d,"should return an index set for the array");same(d,SC.IndexSet.create(3,4),"should be index set that was added");
set.remove(array,3,1);d=set.indexSetForSource(array);same(d,SC.IndexSet.create(4,3),"should return new index set when membership changes");
set.add(array,10,1);d=set.indexSetForSource(array);same(d,SC.IndexSet.create(4,3).add(10,1),"should return combined index set when multiple items are added")
});test("selection set if objects in index set are added",function(){var d;set.addObjects(["0","a"]);
d=set.indexSetForSource(array);same(d,SC.IndexSet.create(0,1),"should return index set with objects found in set interpolated");
d=set.indexSetForSource(array2);same(d,SC.IndexSet.create(0,1),"should return index set with objects found in set interpolated (2)");
set.removeObject("0");d=set.indexSetForSource(array);equals(d,null,"should return null when matching objects are removed");
d=set.indexSetForSource(array2);same(d,SC.IndexSet.create(0,1),"removing other objects should not effect")
});test("selection set if objects and ranged are added",function(){var d;set.add(array,4,3).addObjects(["0","a"]);
d=set.indexSetForSource(array);same(d,SC.IndexSet.create(0,1).add(4,3),"should return index set with objects found in set interpolated");
d=set.indexSetForSource(array2);same(d,SC.IndexSet.create(0,1),"should return index set with objects found in set interpolated (2)");
set.removeObject("0");d=set.indexSetForSource(array);same(d,SC.IndexSet.create(4,3),"should return just range when objects are removed");
d=set.indexSetForSource(array2);same(d,SC.IndexSet.create(0,1),"removing other objects should not effect")
});test("add and remove source",function(){set.add(array,3,4).remove(array,3,4);equals(set.indexSetForSource(array),null,"should return null for source not in set")
});test("looking up indexSet for source when objects are added should recache when source content changes",function(){var e=array.objectAt(0),d;
set=SC.SelectionSet.create().addObject(e);d=set.indexSetForSource(array);same(d,SC.IndexSet.create(0),"should return index set with item at 0");
array.removeObject(e).pushObject(e);d=set.indexSetForSource(array);same(d,SC.IndexSet.create(array.indexOf(e)),"should return index set with item at end")
});var set1,set2,content;module("SC.SelectionSet.isEqual",{setup:function(){content="1 2 3 4 5 6 7 8 9 0".w();
set1=SC.SelectionSet.create();set2=SC.SelectionSet.create()}});test("set.isEqual(same instance)",function(){ok(set1.isEqual(set1),"same instance should return YES")
});test("set.isEqual(null)",function(){ok(!set1.isEqual(null),"null should return NO")
});test("set1.isEqual(set2)",function(){ok(set1.isEqual(set2),"same content should return YES");
set1.add(content,4,4);set2.add(content,4,4);ok(set1.isEqual(set2),"same content should return YES");
set1.remove(content,6);set2.remove(content,6);ok(set1.isEqual(set2),"same content should return YES");
set1.remove(content,4,4);set2.remove(content,4,4);ok(set1.isEqual(set2),"same content should return YES")
});test("multiple content objects",function(){var d="1 2 3 4 5".w();set1.add(content,4,4).add(d,3);
ok(!set1.isEqual(set2),"should not be same when set2 is empty");set2.add(d,3);ok(!set1.isEqual(set2),"should not be same when set2 has only one content");
set2.add(content,4,4);ok(set1.isEqual(set2),"should not be same when set2 has both content")
});test("set1.isEqual(set2) after set2 is filled and emptied",function(){set2.add(content,4,4).remove(content,4,4);
ok(set1.isEqual(set2),"same content should return YES")});var set,array,array2,expected,expected2;
module("SC.SelectionSet#remove",{setup:function(){set=SC.SelectionSet.create();array="0 1 2 3 4 5 6 7 8 9".w();
array2="a b c d e f g h i k l m".w();expected=SC.IndexSet.create(4,3);expected2=SC.IndexSet.create(1);
expected.source=array;expected2.source=array2}});function validate(m,j,h){var g=m.get("sources"),e=j.length,d,k,l;
equals(g.length,j.length,"should have same number of sources (actual sources: %@)".fmt(g));
for(d=0;d<e;d++){k=j[d];if(!k.source){k.source=h}l=m.indexSetForSource(k.source,NO);
ok(l,"should have indexSet for source: %@".fmt(k.source));equals(l.source,k.source,"indexSet.source should match source");
ok(l.isEqual(k),"indexSet should match for source %@ (actual: %@ expected: %@)".fmt(k.source,l,k))
}}test("Removed indexes for single source",function(){set.add(array,4,3);validate(set,[SC.IndexSet.create(4,3)],array);
set.remove(array,4,1);validate(set,[SC.IndexSet.create(5,2)],array)});test("Removed multiple sources",function(){set.add(array,4,3).add(array2,1);
validate(set,[expected,expected2]);set.remove(array,4,1).remove(array2,1);expected.remove(4,1);
validate(set,[expected])});test("Remove IndexSet with source",function(){set.add(array,4,3);
validate(set,[SC.IndexSet.create(4,3)],array);var d=SC.IndexSet.create(4,1);d.source=array;
set.remove(d);validate(set,[SC.IndexSet.create(5,2)],array)});test("Adding another SelectionSet",function(){set.add(array,4,3).add(array2,1);
validate(set,[expected,expected2]);var d=SC.SelectionSet.create().add(array,4,1).add(array2,1);
set.remove(d);expected.remove(4,1);validate(set,[SC.IndexSet.create(5,2)],array)});
test("removing index set should also remove individually added objects",function(){var e=array[3];
var d=array2[3];set.addObject(e).addObject(d);set.add(array,4,3);ok(set.contains(e),"set should contain objToRemove");
ok(set.contains(d),"set should contain objToNotRemove");equals(set.get("length"),5,"set.length sould == two objects + index.length");
set.remove(array,2,4);SC.stopIt=NO;ok(!set.contains(e),"set should NOT contain objToRemove");
ok(set.contains(d),"set should contain objToNotRemove");equals(set.get("length"),2,"set.length should == 1 object + index.length")
});var a,b,c;module("creating SC.Set instances",{setup:function(){a={name:"a"};b={name:"b"};
c={name:"c"}},teardown:function(){a=undefined;b=undefined;c=undefined}});test("SC.Set.create() should create empty set",function(){var d=SC.Set.create();
equals(d.length,0)});test("SC.Set.create([1,2,3]) should create set with three items in them",function(){var d=SC.Set.create([a,b,c]);
equals(d.length,3);equals(d.contains(a),YES);equals(d.contains(b),YES);equals(d.contains(c),YES)
});test("SC.Set.create() should accept anything that implements SC.Array",function(){var d=SC.Object.create(SC.Array,{_content:[a,b,c],length:3,objectAt:function(g){return this._content[g]
}});var e=SC.Set.create(d);equals(e.length,3);equals(e.contains(a),YES);equals(e.contains(b),YES);
equals(e.contains(c),YES)});var set;module("SC.Set.add + SC.Set.contains",{setup:function(){set=SC.Set.create()
},teardown:function(){set=undefined}});test("should add an SC.Object",function(){var e=SC.Object.create();
var d=set.length;set.add(e);equals(set.contains(e),YES,"contains()");equals(d+1,set.length,"new set length")
});test("should add a regular hash",function(){var e={};var d=set.length;set.add(e);
equals(set.contains(e),YES,"contains()");equals(d+1,set.length,"new set length")});
test("should add a string",function(){var e="String!";var d=set.length;set.add(e);
equals(set.contains(e),YES,"contains()");equals(d+1,set.length,"new set length")});
test("should add a number",function(){var e=23;var d=set.length;set.add(e);equals(set.contains(e),YES,"contains()");
equals(d+1,set.length,"new set length")});test("should add a bool",function(){var e=true;
var d=set.length;set.add(e);equals(set.contains(e),YES,"contains()");equals(d+1,set.length,"new set length")
});test("should add a function",function(){var e=function(){return"Test function"
};var d=set.length;set.add(e);equals(set.contains(e),YES,"contains()");equals(d+1,set.length,"new set length")
});test("should NOT add a null",function(){set.add(null);equals(set.length,0);equals(set.contains(null),NO)
});test("should NOT add an undefined",function(){set.add(undefined);equals(set.length,0);
equals(set.contains(undefined),NO)});test("adding an item, removing it, adding another item",function(){var e="item1";
var d="item2";set.add(e);set.remove(e);set.add(d);equals(NO,set.contains(e),"set.contains(item1)");
set.add(e);equals(2,set.length,"set.length")});module("SC.Set.remove + SC.Set.contains",{setup:function(){set=SC.Set.create([SC.Object.create({dummy:YES}),{isHash:YES},"Not the String",16,false])
},teardown:function(){set=undefined}});test("should remove an SC.Object and reduce length",function(){var e=SC.Object.create();
set.add(e);equals(set.contains(e),YES);var d=set.length;set.remove(e);equals(NO,set.contains(e),"should be removed");
equals(d-1,set.length,"should be 1 shorter")});test("should remove a regular hash and reduce length",function(){var e={};
set.add(e);equals(set.contains(e),YES);var d=set.length;set.remove(e);equals(NO,set.contains(e),"should be removed");
equals(d-1,set.length,"should be 1 shorter")});test("should remove a string and reduce length",function(){var e="String!";
set.add(e);equals(set.contains(e),YES);var d=set.length;set.remove(e);equals(NO,set.contains(e),"should be removed");
equals(d-1,set.length,"should be 1 shorter")});test("should remove a number and reduce length",function(){var e=23;
set.add(e);equals(set.contains(e),YES);var d=set.length;set.remove(e);equals(NO,set.contains(e),"should be removed");
equals(d-1,set.length,"should be 1 shorter")});test("should remove a bool and reduce length",function(){var e=true;
set.add(e);equals(set.contains(e),YES);var d=set.length;set.remove(e);equals(NO,set.contains(e),"should be removed");
equals(d-1,set.length,"should be 1 shorter")});test("should remove a function and reduce length",function(){var e=function(){return"Test function"
};set.add(e);equals(set.contains(e),YES);var d=set.length;set.remove(e);equals(NO,set.contains(e),"should be removed");
equals(d-1,set.length,"should be 1 shorter")});test("should NOT remove a null",function(){var d=set.length;
set.remove(null);equals(d,set.length)});test("should NOT remove an undefined",function(){var d=set.length;
set.remove(undefined);equals(d,set.length)});test("should ignore removing an object not in the set",function(){var e=SC.Object.create();
var d=set.length;set.remove(e);equals(d,set.length)});module("SC.Set.pop + SC.Set.clone",{setup:function(){set=SC.Set.create([SC.Object.create({dummy:YES}),{isHash:YES},"Not the String",16,false])
},teardown:function(){set=undefined}});test("the pop() should remove an arbitrary object from the set",function(){var d=set.length;
var e=set.pop();equals(SC.T_OBJECT,SC.typeOf(e),"pops up an object");equals(d-1,set.length,"length shorter by 1")
});test("the clone() should return an indentical set",function(){var d=set.length;
var e=set.clone();equals(d,e.length,"length of the clone should be same");equals(YES,e.contains(set[0]));
equals(YES,e.contains(set[1]));equals(YES,e.contains(set[2]));equals(YES,e.contains(set[3]));
equals(YES,e.contains(set[4]))});var objectA=23,objectB=12,objectC=31,numbers,new_numbers;
module("SC.SparseArray");test("new SparseArray has expected length",function(){var d=SC.SparseArray.array(10000);
equals(10000,d.get("length"),"length")});test("fetching the object at index",function(){var e=SC.SparseArray.create(10);
var d=["I'll","be","there","4u"];e=d;equals(2,e.indexOf("there"),"Index of 'there' is")
});test("Update the sparse array using provideObjectAtIndex",function(){var d=SC.SparseArray.create(2);
var e="not";d.provideObjectAtIndex(0,e);equals(e,d._sa_content[0],"Content at 0th index");
e="now";d.provideObjectAtIndex(1,e);equals(e,d._sa_content[1],"Content at 1st index")
});test("objectAt() should get the object at the specified index",function(){var e=SC.SparseArray.create(4);
var d=[SC.Object.create({dummy:YES}),"Sproutcore",2,true];e=d;equals(4,e.length,"the length");
equals(d[0],e.objectAt(0),"first object");equals(d[1],e.objectAt(1),"second object");
equals(d[2],e.objectAt(2),"third object");equals(d[3],e.objectAt(3),"fourth object")
});module("SC.replace",{setup:function(){numbers=[1,2,3];new_numbers=[4,5,6]}});test("element to be added is at idx > length of array ",function(){var d=SC.SparseArray.array(5);
equals(5,d.get("length"),"length");d=numbers;d.replace(7,3,new_numbers,"put the new number at idx>len ");
equals(6,d.get("length"),"length")});test("element to be added is such that amt + idx > length of array ",function(){var d=SC.SparseArray.array(5);
equals(5,d.get("length"),"length");d=numbers;d.replace(4,3,new_numbers,"put the new number at idx < len ");
equals(6,d.get("length"),"length")});test("element to be added is at idx > length of array ",function(){var d=SC.SparseArray.array(5);
equals(5,d.get("length"),"length");d=numbers;d.replace(2,3,new_numbers,"put the new number overlapping existing numbers ");
equals(5,d.get("length"),"length")});test("modifying a range should not require the rest of the array to refetch",function(){var d={cnt:0,sparseArrayDidRequestIndex:function(h,g){this.cnt++;
h.provideObjectAtIndex(g,"foo")},sparseArrayDidRequestLength:function(g){g.provideLength(100)
},sparseArrayShouldReplace:function(){return YES}};var e=SC.SparseArray.create({delegate:d});
equals(e.objectAt(10),"foo","precond - should provide foo");equals(d.cnt,1,"precond - should invoke sparseArrayDidRequestIndex() one time");
d.cnt=0;e.removeAt(5);equals(e.objectAt(9),"foo","should provide foo at index after delete");
equals(d.cnt,0,"should NOT invoke sparseArrayRequestIndex() since it was provided already")
});test("Check that requestIndex works with a rangeWindowSize larger than 1",function(){var d=SC.SparseArray.array(10);
var g=NO;var e=SC.Object.extend({content:[],sparseArrayDidRequestLength:function(h){h.provideLength(this.content.length)
},sparseArrayDidRequestIndex:function(h,j){h.provideObjectAtIndex(j,this.content[j])
},sparseArrayDidRequestIndexOf:function(h,j){return this.content.indexOf(j)},sparseArrayShouldReplace:function(j,h,l,k){this.content.replace(h,l,k);
return YES},sparseArrayDidRequestRange:function(j,h){g=YES}});d.set("delegate",e.create());
d.set("rangeWindowSize",4);equals(10,d.get("length"),"length");d.objectAt(7);equals(g,YES,"The range was requested")
});test("definedIndexes",function(){var d=SC.SparseArray.array(10);d.provideObjectAtIndex(5,"foo");
var e=SC.IndexSet.create().add(5);same(d.definedIndexes(),e,"definedIndexes() should return all defined indexes");
same(d.definedIndexes(SC.IndexSet.create().add(2,10)),e,"definedIndexes([2..11]) should return indexes within");
same(d.definedIndexes(SC.IndexSet.create().add(2)),SC.IndexSet.EMPTY,"definedIndexes([2]) should return empty set (since does not overlap with defined index)")
});var DummyDelegate=SC.Object.extend({content:[],sparseArrayDidRequestLength:function(d){d.provideLength(this.content.length)
},sparseArrayDidRequestIndex:function(d,e){d.provideObjectAtIndex(e,this.content[e])
},sparseArrayDidRequestIndexOf:function(d,e){return this.content.indexOf(e)},sparseArrayShouldReplace:function(e,d,h,g){this.content.replace(d,h,g);
return YES}});SC.ArraySuite.generate("SC.SparseArray",{newObject:function(e){if(e===undefined||typeof e===SC.T_NUMBER){e=this.expected(e)
}var d=DummyDelegate.create({content:e});return SC.SparseArray.create({delegate:d})
}});SC.DEFAULT_TREE="default";require("system/state");SC.Statechart={isStatechart:true,log:NO,initMixin:function(){this._all_states={};
this._all_states[SC.DEFAULT_TREE]={};this._current_state={};this._current_state[SC.DEFAULT_TREE]=null;
this._goStateLocked=NO;this._pendingStateTransitions=[];this.sendAction=this.sendEvent;
if(this.get("startOnInit")){this.startupStatechart()}},startOnInit:YES,startupStatechart:function(){if(!this._started){var j,d,l,g,h,e,k;
for(j in this){if(this.hasOwnProperty(j)&&SC.kindOf(this[j],SC.State)&&this[j].get&&!this[j].get("beenAddedToStatechart")){l=this[j];
this._addState(j,l)}}g=this._all_states;for(j in g){if(g.hasOwnProperty(j)){d=g[j];
for(l in d){if(d.hasOwnProperty(l)){d[l].initState()}}}}h=this.get("startStates");
if(!h){throw"Please add startStates to your statechart!"}for(j in g){if(g.hasOwnProperty(j)){e=h[j];
k=g[j];if(!e){console.error("The parallel statechart %@ must have a start state!".fmt(j))
}if(!k){throw"The parallel statechart %@ does not exist!".fmt(j)}if(!k[e]){throw"The parallel statechart %@ doesn't have a start state [%@]!".fmt(j,e)
}this.goState(e,j)}}}this._started=YES},registerState:function(j,h,g){var e,d;e=SC.State.create(j);
if(h&&g){if(h.isStatechart){h._addState(g,e);e.initState()}else{throw"Cannot add state: %@ because state manager does not mixin SC.Statechart".fmt(e.get("name"))
}}else{e.set("beenAddedToStatechart",NO)}return e},goHistoryState:function(g,d,k){var h=this._all_states[d],e,j;
if(!d||!h){throw"State requesting go history does not have a valid parallel tree"
}e=h[g];if(e){j=e.get("history")||e.get("initialSubState")}if(!j){if(!k){console.warn("Requesting History State for [%@] and it is not a parent state".fmt(g))
}j=g;this.goState(j,d)}else{if(k){this.goHistoryState(j,d,k)}else{this.goState(j,d)
}}},goState:function(d,u){var e=this._current_state[u],o=[],n=[],s,g,p,h,j,l,m=this.get("log"),k;
if(!u){throw"#goState: State requesting go does not have a valid parallel tree"}d=this._all_states[u][d];
if(!d){throw"#goState: Could not find the requested state!"}if(this._goStateLocked){this._pendingStateTransitions.push({requestedState:d,tree:u});
return}this._goStateLocked=YES;o=this._parentStates_with_root(d);n=e?this._parentStates_with_root(e):[];
p=n.find(function(y,x){g=x;s=o.indexOf(y);if(s>=0){return YES}});if(!s){s=o.length-1
}k="";for(l=0;l<g;l+=1){if(m){k+="Exiting State: [%@] in [%@]\n".fmt(n[l],u)}n[l].exitState()
}if(m){console.info(k)}k="";for(l=s-1;l>=0;l-=1){j=o[l];if(m){k+="Entering State: [%@] in [%@]\n".fmt(j,u)
}h=o[l+1];if(h&&SC.typeOf(h)===SC.T_OBJECT){h.set("history",j.name)}j.enterState();
if(j===d){j.enterInitialSubState(this._all_states[u||SC.DEFAULT_TREE])}}if(m){console.info(k)
}this._current_state[u]=d;this._goStateLocked=NO;this._flushPendingStateTransition()
},_flushPendingStateTransition:function(){var d=this._pendingStateTransitions.shift();
if(!d){return}this.goState(d.requestedState,d.tree)},currentState:function(d){d=d||SC.DEFAULT_TREE;
return this._current_state[d]},isResponderContext:YES,sendEvent:function(l,j,h){var k=this.get("log"),m=NO,g=this._current_state,e;
this._locked=YES;if(k){console.log("%@: begin action '%@' (%@, %@)".fmt(this,l,j,h))
}for(var d in g){if(g.hasOwnProperty(d)){m=NO;e=g[d];while(!m&&e){if(e.tryToPerform){m=e.tryToPerform(l,j,h)
}if(!m){e=e.get("parentState")?this._all_states[d][e.get("parentState")]:null}}if(k){if(!m){console.log("%@:  action '%@' NOT HANDLED in tree %@".fmt(this,l,d))
}else{console.log("%@: action '%@' handled by %@ in tree %@".fmt(this,l,e.get("name"),d))
}}}}this._locked=NO;return e},_addState:function(e,g){g.set("stateManager",this);
g.set("name",e);var d=g.get("parallelStatechart")||SC.DEFAULT_TREE;g.setIfChanged("parallelStatechart",d);
if(!this._all_states[d]){this._all_states[d]={}}if(this._all_states[d][e]){throw"Trying to add state %@ to state tree %@ and it already exists".fmt(e,d)
}this._all_states[d][e]=g;g.set("beenAddedToStatechart",YES)},_parentStates:function(e){var d=[],g=e;
d.push(g);g=g.get("parentStateObject");while(g){d.push(g);g=g.get("parentStateObject")
}return d},_parentStates_with_root:function(e){var d=this._parentStates(e);d.push("root");
return d},parentStateObject:function(e,d){if(e&&d&&this._all_states[d]&&this._all_states[d][e]){return this._all_states[d][e]
}return null}};SC.State=SC.Object.extend({initState:function(){},enterState:function(d){},exitState:function(d){},parallelStatechart:SC.DEFAULT_STATE,parentState:null,history:null,initialSubState:null,name:null,state:function(){var d=this.get("stateManager");
if(!d){throw"Cannot access the current state because state does not have a state manager"
}return d.currentState(this.get("parallelStatechart"))},goState:function(d){var e=this.get("stateManager");
if(e){e.goState(d,this.get("parallelStatechart"))}else{throw"Cannot goState cause state does not have a stateManager!"
}},goHistoryState:function(d,e){var g=this.get("stateManager");if(g){g.goHistoryState(d,this.get("parallelStatechart"),e)
}else{throw"Cannot goState cause state does not have a stateManager!"}},enterInitialSubState:function(d){var e=this.get("initialSubState");
if(e){if(!d[e]){throw"Cannot find initial sub state: %@ defined on state: %@".fmt(e,this.get("name"))
}this.set("history",e);var g=d[e];return this.goState(e,d)}return this},toString:function(){return this.get("name")
},parentStateObject:function(){var d=this.get("stateManager");if(d){return d.parentStateObject(this.get("parentState"),this.get("parallelStatechart"))
}else{throw"Cannot access parentState cause state does not have a stateManager!"}}.property("parentState").cacheable(),trace:function(){var d=this.get("stateManager");
if(d){return d._parentStates(this)}else{throw"Cannot trace cause state does not have a stateManager!"
}}});var basic;module("SC.Statechart Mixin: Basic Unit test",{setup:function(){basic=SC.Object.create(SC.Statechart,{startStates:{"default":"bar"},startOnInit:NO,foo:SC.Statechart.registerState({initState:function(){this.set("fooStateInit",true)
},enterState:function(){},exitState:function(){},blah:function(){this.goState("bar")
},whatever:function(){basic.set("whateverWasCalled",YES)}})});basic.mixin({bar:SC.Statechart.registerState({enterState:function(){},exitState:function(){},blah:function(){this.goState("bar")
}})});basic.startupStatechart()},teardown:function(){basic.destroy()}});test("basic state transition",function(){basic.foo.goState("foo");
equals(basic.foo,basic.foo.state(),"should be in state foo");basic.foo.goState("bar");
equals(basic.bar,basic.bar.state(),"should be in state bar");equals(basic.bar,basic.foo.state(),"should be in state bar")
});test("basic sendEvent",function(){basic.foo.goState("foo");equals(basic.get("whateverWasCalled"),null,"nothing to report");
basic.sendEvent("whatever");equals(basic.get("whateverWasCalled"),YES,"whatever method was called")
});test("test method alias",function(){equals(basic.sendAction,basic.sendEvent,"these methods are the same")
});test("test basic init",function(){ok(basic.getPath("foo.fooStateInit"),"foo state should have had init called")
});var nested,exitTotal,enterTotal;module("SC.Statechart Mixin History Statechart",{setup:function(){enterTotal=exitTotal=0;
nested=SC.Object.create(SC.Statechart,{startStates:{"default":"b"},startOnInit:YES,a:SC.Statechart.registerState({enterState:function(){enterTotal+=1
},exitState:function(){exitTotal+=1}}),b:SC.Statechart.registerState({initialSubState:"c",enterState:function(){enterTotal+=1
},exitState:function(){exitTotal+=1}}),c:SC.Statechart.registerState({initialSubState:"f",parentState:"b",enterState:function(){enterTotal+=1
},exitState:function(){exitTotal+=1}}),d:SC.Statechart.registerState({parentState:"b",enterState:function(){enterTotal+=1
},exitState:function(){exitTotal+=1}}),e:SC.Statechart.registerState({enterState:function(){enterTotal+=1
},exitState:function(){exitTotal+=1}}),f:SC.Statechart.registerState({parentState:"c",enterState:function(){enterTotal+=1
},exitState:function(){exitTotal+=1}}),g:SC.Statechart.registerState({parentState:"c",enterState:function(){enterTotal+=1
},exitState:function(){exitTotal+=1}})})},teardown:function(){nested.destroy();enterTotal=exitTotal=0
}});test("nested state initialization",function(){equals(nested.get("f"),nested.get("f").state(),"f state should be the current state for default statechart")
});test("history state transition",function(){var e=nested.get("f");equals(nested.get("f").state(),e,"f state should be the current state for default statechart");
e.goState("d");equals(nested.get("d").state(),nested.get("d"),"d state should be the current state for default statechart");
enterTotal=exitTotal=0;var g=nested.get("d");g.goHistoryState("c");equals(nested.get("f").state(),e,"f state should be the current state for default statechart after going to the history of c");
equals(enterTotal,2,"should have entered 2 state after transition");equals(exitTotal,1,"should have exited 1 states after transition")
});test("Recursive history state transition",function(){var d=nested.get("f");equals(nested.get("f").state(),d,"f state should be the current state for default statechart");
d.goState("e");equals(nested.get("e").state(),nested.get("e"),"e state should be the current state for default statechart");
enterTotal=exitTotal=0;d.goHistoryState("b",YES);equals(nested.get("f").state(),d,"f state should be the current state for default statechart after going to the history of c");
equals(enterTotal,3,"should have entered 2 state after transition");equals(exitTotal,1,"should have exited 1 states after transition")
});var nested,exitTotal,enterTotal;module("SC.Statechart Mixin Nested Statechart",{setup:function(){enterTotal=exitTotal=0;
nested=SC.Object.create(SC.Statechart,{startStates:{"default":"a",other:"f"},startOnInit:YES,a:SC.Statechart.registerState({initialSubState:"b",enterState:function(){enterTotal+=1
},exitState:function(){exitTotal+=1}}),b:SC.Statechart.registerState({parentState:"a",initialSubState:"c",enterState:function(){enterTotal+=1
},exitState:function(){exitTotal+=1}}),c:SC.Statechart.registerState({parentState:"b",enterState:function(){enterTotal+=1
},exitState:function(){exitTotal+=1}}),d:SC.Statechart.registerState({parentState:"b",enterState:function(){enterTotal+=1
},exitState:function(){exitTotal+=1}}),e:SC.Statechart.registerState({enterState:function(){enterTotal+=1
},exitState:function(){exitTotal+=1}}),f:SC.Statechart.registerState({parallelStatechart:"other"}),g:SC.Statechart.registerState({parallelStatechart:"other"})})
},teardown:function(){nested.destroy();exitTotal=enterTotal=0}});test("nested state initialization",function(){equals(nested.get("c"),nested.get("c").state(),"c state should be the current state for default statechart");
equals(nested.get("f"),nested.get("f").state(),"f state should be the current state for other statechart")
});test("nested state transition",function(){var d=nested.get("c");equals(d,d.state(),"c state should be the current state for default statechart");
equals(enterTotal,3,"should have entered 3 states");equals(exitTotal,0,"should have exited 0 states");
enterTotal=exitTotal=0;d.goState("e");equals(nested.get("e"),nested.get("e").state(),"e state should be the current state for other statechart");
equals(enterTotal,1,"should have entered 1 state after transition");equals(exitTotal,3,"should have exited 3 states after transition")
});var basic;var advanced;var sequence;module("SC.Statechart Mixin: Transient States",{setup:function(){sequence=[];
basic=SC.Object.create(SC.Statechart,{startStates:{"default":"a"},startOnInit:NO,a:SC.Statechart.registerState({enterState:function(){sequence.push("enter:a")
},exitState:function(){sequence.push("exit:a")},foo:function(){this.goState("b")}}),b:SC.Statechart.registerState({enterState:function(){sequence.push("enter:b");
this.goState("c")},exitState:function(){sequence.push("exit:b")}}),c:SC.Statechart.registerState({enterState:function(){sequence.push("enter:c");
this.goState("d")},exitState:function(){sequence.push("exit:c")}}),d:SC.Statechart.registerState({enterState:function(){sequence.push("enter:d")
},exitState:function(){sequence.push("exit:d")}})});advanced=SC.Object.create(SC.Statechart,{startStates:{"default":"a"},startOnInit:NO,a:SC.Statechart.registerState({initialSubState:"b",enterState:function(){sequence.push("enter:a")
},exitState:function(){sequence.push("exit:a")}}),b:SC.Statechart.registerState({parentState:"a",initialSubState:"c",enterState:function(){sequence.push("enter:b")
},exitState:function(){sequence.push("exit:b")}}),c:SC.Statechart.registerState({parentState:"b",enterState:function(){sequence.push("enter:c")
},exitState:function(){sequence.push("exit:c")},foo:function(){this.goState("d")}}),d:SC.Statechart.registerState({parentState:"b",enterState:function(){sequence.push("enter:d");
this.goState("e")},exitState:function(){sequence.push("exit:d")}}),e:SC.Statechart.registerState({initialSubState:"f",enterState:function(){sequence.push("enter:e")
},exitState:function(){sequence.push("exit:e")}}),f:SC.Statechart.registerState({parentState:"e",enterState:function(){sequence.push("enter:f");
this.goState("g")},exitState:function(){sequence.push("exit:f")}}),g:SC.Statechart.registerState({parentState:"e",enterState:function(){sequence.push("enter:g")
},exitState:function(){sequence.push("exit:g")}})})},teardown:function(){basic.destroy();
advanced.destroy();sequence=null}});test("basic state transition",function(){sequence=[];
basic.startupStatechart();equals(basic.currentState(),basic.a,"current state should be a");
equals(sequence.length,1,"should be length 1");equals(sequence[0],"enter:a","should be 'enter:a'");
sequence=[];basic.sendEvent("foo");equals(basic.currentState(),basic.d,"current state should be d");
equals(sequence.length,6,"should be length 6");equals(sequence[0],"exit:a","should be 'exit:a'");
equals(sequence[1],"enter:b","should be 'enter:b'");equals(sequence[2],"exit:b","should be 'exit:b'");
equals(sequence[3],"enter:c","should be 'enter:c'");equals(sequence[4],"exit:c","should be 'exit:c'");
equals(sequence[5],"enter:d","should be 'enter:d'");console.log(sequence)});test("advanced state transition",function(){sequence=[];
advanced.startupStatechart();equals(advanced.currentState(),advanced.c,"current state should be c");
equals(sequence.length,3,"should be length 3");equals(sequence[0],"enter:a","should be 'enter:a'");
equals(sequence[1],"enter:b","should be 'enter:b'");equals(sequence[2],"enter:c","should be 'enter:c'");
sequence=[];advanced.sendEvent("foo");equals(advanced.currentState(),advanced.g,"current state should be c");
equals(sequence.length,9,"should be length 9");equals(sequence[0],"exit:c","should be 'exit:c'");
equals(sequence[1],"enter:d","should be 'enter:d'");equals(sequence[2],"exit:d","should be 'exit:d'");
equals(sequence[3],"exit:b","should be 'exit:b'");equals(sequence[4],"exit:a","should be 'exit:a'");
equals(sequence[5],"enter:e","should be 'enter:c'");equals(sequence[6],"enter:f","should be 'enter:f'");
equals(sequence[7],"exit:f","should be 'exit:f'");equals(sequence[8],"enter:g","should be 'enter:g'");
console.log(sequence)});SC.TableDelegate={isTableDelegate:YES,tableShouldResizeColumnTo:function(j,h,e){var g=h.get("minWidth")||0,d=h.get("maxWidth")||e;
e=Math.max(g,e);e=Math.min(d,e);return e},tableShouldResizeWidthTo:function(h,e){var g=h.get("minWidth")||0,d=h.get("maxWidth")||e;
e=Math.max(g,e);e=Math.min(d,e);return e}};SC.SORT_ASCENDING="ascending";SC.SORT_DESCENDING="descending";
SC.TableColumn=SC.Object.extend({key:null,title:null,width:100,minWidth:16,maxWidth:700,escapeHTML:NO,formatter:null,isVisible:YES,isFlexible:NO,isReorderable:YES,isSortable:YES,icon:null,tableHeader:null,sortState:null,tableContent:null});
sc_require("views/list");sc_require("views/table_row");sc_require("views/table_head");
sc_require("mixins/table_delegate");SC.TableView=SC.ListView.extend(SC.TableDelegate,{classNames:["sc-table-view"],childViews:"tableHeadView scrollView".w(),scrollView:SC.ScrollView.design({isVisible:YES,layout:{left:-1,right:0,bottom:0,top:19},hasHorizontalScroller:NO,borderStyle:SC.BORDER_NONE,contentView:SC.View.design({}),_sv_offsetDidChange:function(){this.get("parentView")._sctv_scrollOffsetDidChange()
}.observes("verticalScrollOffset","horizontalScrollOffset")}),hasHorizontalScroller:NO,hasVerticalScroller:NO,selectOnMouseDown:NO,containerView:function(){var d=this.get("scrollView");
return(d&&d.get)?d.get("contentView"):null}.property("scrollView"),layout:{left:0,right:0,top:0,bottom:0},init:function(){window.table=this;
return arguments.callee.base.apply(this,arguments)},canReorderContent:NO,isInDragMode:NO,mouseDownInTableHeaderView:function(d,g){var e=g.get("column");
if(!e.get("isReorderable")&&!e.get("isSortable")){return NO}this._mouseDownEvent=d;
this._mouseDownTimer=SC.Timer.schedule({target:this,action:"_scthv_enterDragMode",interval:300});
return YES},mouseUpInTableHeaderView:function(e,k){var h=this.get("isInDragMode");
if(!h){var g=k.get("column");this.set("sortedColumn",g);var d=g.get("sortState");
var j=d===SC.SORT_ASCENDING?SC.SORT_DESCENDING:SC.SORT_ASCENDING;g.set("sortState",j)
}this._dragging=false;if(this._mouseDownTimer){this._mouseDownTimer.invalidate()}},mouseDraggedInTableHeaderView:function(d,g){SC.RunLoop.begin();
var e=this.get("isInDragMode");if(!e){return NO}if(!this._dragging){SC.Drag.start({event:this._mouseDownEvent,source:g,dragView:this._scthv_dragViewForHeader(),ghost:YES});
this._dragging=true}return arguments.callee.base.apply(this,arguments);SC.RunLoop.end()
},columns:[],flexibleColumn:null,sortedColumn:null,hasTableHead:YES,tableHeadView:SC.TableHeadView.design({layout:{top:0,left:0,right:0}}),tableHeadHeight:18,hasUniformRowHeights:YES,rowHeight:18,exampleView:SC.TableRowView,isInColumnDragMode:NO,filterKey:null,rowOffsetForContentIndex:function(g){var e=0,d;
if(this.get("hasUniformRowHeights")){return e+(this.get("rowHeight")*g)}else{for(d=0;
d<g;i++){e+=this.rowHeightForContentIndex(d)}return e}},rowHeightForContentIndex:function(d){if(this.get("hasUniformRowHeights")){return this.get("rowHeight")
}else{}},layoutForContentIndex:function(d){return{top:this.rowOffsetForContentIndex(d),height:this.rowHeightForContentIndex(d),left:0,right:0}
},createItemView:function(g,d,e){e.tableView=this;return g.create(e)},clippingFrame:function(){var e=this.get("containerView"),d=this.get("scrollView"),g=this.get("frame");
if(!d.get){return g}return{height:g.height,width:g.width,x:d.get("horizontalScrollOffset"),y:d.get("verticalScrollOffset")}
}.property("frame","content").cacheable(),_sctv_scrollOffsetDidChange:function(){this.notifyPropertyChange("clippingFrame")
},computeLayout:function(){var e=arguments.callee.base.apply(this,arguments),d=this.get("containerView"),h=this.get("frame");
var g=e.minHeight;delete e.minHeight;d.adjust("minHeight",g);d.layoutDidChange();
this.notifyPropertyChange("clippingFrame");return e},_sctv_columnsDidChange:function(){var e=this.get("columns"),g=this.get("content"),d;
for(d=0;d<e.get("length");d++){e.objectAt(d).set("tableContent",g)}this.get("tableHeadView")._scthv_handleChildren();
this.reload()}.observes("columns"),_sctv_adjustColumnWidthsOnResize:function(){var k=this.get("frame").width;
var l=this.get("content"),g=this.delegateFor("isTableDelegate",this.delegate,l);if(this.get("columns").length==0){return
}k=g.tableShouldResizeWidthTo(this,k);var j=this.get("columns"),m=0,d;for(var d=0;
d<j.length;d++){m+=j.objectAt(d).get("width")}if(k===0){k=m}var e=this.get("flexibleColumn")||this.get("columns").objectAt(this.get("columns").length-1);
var h=e.get("width")+(k-m);e.set("width",h)}.observes("frame"),_sctv_sortContent:function(){var e=this.get("sortedColumn");
var d=e.get("key");this.set("orderBy",d)},_sctv_sortedColumnDidChange:function(){var e=this.get("columns"),h=this.get("sortedColumn"),g,d;
for(d=0;d<e.get("length");d++){g=e.objectAt(d);if(g!==h){g.set("sortState",null)}}this.invokeOnce("_sctv_sortContent")
}.observes("sortedColumn")});sc_require("views/table_row");SC.TableCellView=SC.View.extend({classNames:["sc-table-cell"],column:null,escapeHTMLBinding:SC.Binding.oneWay(".column.escapeHTML"),formatter:SC.Binding.oneWay(".column.formatter"),displayValue:function(){var k=this.get("content");
var h=this.get("column").get("formatter");if(h){var j=(SC.typeOf(h)===SC.T_FUNCTION)?h(k,this):h.fieldValueForObject(k,this);
if(!SC.none(j)){k=j}}if(SC.typeOf(k)===SC.T_ARRAY){var g=[];for(var e=0;e<k.get("length");
e++){var d=k.objectAt(e);if(!SC.none(d)&&d.toString){d=d.toString()}g.push(d)}k=g.join(",")
}if(!SC.none(k)&&k.toString){k=k.toString()}if(this.get("escapeHTML")){k=SC.RenderContext.escapeHTML(k)
}return k}.property("content","escapeHTML","formatter").cacheable(),render:function(d,e){d.push(this.get("displayValue"))
},init:function(){var d=this.get("column");d.addObserver("width",this,"_sctcv_layoutDidChange");
d.addObserver("maxWidth",this,"_sctcv_layoutDidChange");d.addObserver("minWidth",this,"_sctcv_layoutDidChange")
},_sctcv_layoutDidChange:function(g,e,j,d){var h=this.get("parentView");SC.run(function(){h.layoutChildViews()
})}});sc_require("views/table");sc_require("views/table_header");SC.TableHeadView=SC.View.extend({layout:{height:18,left:0,right:0,top:0},classNames:["sc-table-head"],cells:[],acceptsFirstResponder:YES,dragOrder:null,init:function(){this._scthv_handleChildren()
},columns:function(){return this.get("parentView").get("columns")}.property(),renderChildViews:function(h,j){var g=this.get("cells"),e,d;
for(d=0;d<g.get("length");d++){e=g.objectAt(d);h=h.begin(e.get("tagName"));e.prepareContext(h,j);
h=h.end()}return h},layoutChildViews:function(){var g=this.get("cells"),e,d;for(d=0;
d<g.get("length");d++){e=g.objectAt(d);e.adjust(this._scthv_layoutForHeaderAtColumnIndex(d));
e.updateLayout()}},_scthv_enterDragMode:function(){var e=[],g=this.get("columns"),d;
for(d=0;d<g.get("length");d++){e.push(g.objectAt(d).get("key"))}this.set("dragOrder",e)
},_scthv_changeDragOrder:function(g,h){var e=this.get("dragOrder"),d=e.objectAt(g);
e.removeAt(idx);e.insertAt(h,d)},_scthv_reorderDragColumnViews:function(){}.observes("dragOrder"),_scthv_columnContentFromTableContent:function(h,l){var k=this.get("columns").objectAt(l),j=k.get("key"),g=[],e;
if(!h){return g}var d=this.get("parentView"),m=h.get("length");for(e=0;e<m;e++){g.push(h.objectAt(e).get(j))
}return g},_scthv_layoutForHeaderAtColumnIndex:function(e){var g=this.get("columns"),j=this.get("parentView").get("rowHeight"),h={},k=0,d;
for(d=0;d<e;d++){k+=g.objectAt(d).get("width")}return{left:k,width:g.objectAt(e).get("width"),height:j}
},_scthv_handleChildren:function(){var e=this.get("columns");var h=this.get("parentView");
var g=h.get("content");var d,n,k,j,o=[],m,l;for(l=0;l<e.get("length");l++){d=e.objectAt(l);
n=d.get("key");k=d.get("label");j=this._scthv_columnContentFromTableContent(g,l);
m=this._scthv_createTableHeader(d,k,j,l);o.push(m)}this.set("cells",o);if(o.length>0){this.replaceAllChildren(o)
}},_scthv_createTableHeader:function(j,h,k,g){var e=this.get("parentView");var d=SC.TableHeaderView.create({column:j,label:h,content:k,tableView:e,columnIndex:g});
return d}});sc_require("views/table");SC.TableHeaderView=SC.View.extend({classNames:["sc-table-header"],displayProperties:["sortState","isInDragMode"],acceptsFirstResponder:YES,isInDragMode:NO,hasHorizontalScroller:NO,hasVerticalScroller:NO,childViews:["dragModeView"],dragModeView:SC.ListView.design({isVisible:NO,layout:{left:0,right:0,bottom:0},init:function(){var d=this.get("parentView");
if(d){d.addObserver("isInDragMode",this,"_scthv_dragModeDidChange")}},_scthv_dragModeDidChange:function(){}}),column:null,render:function(e,k){var j=this.get("column"),h=j.get("icon"),d;
var g=e.begin("span");if(h){d='<img src="%@" class="icon" />'.fmt(h);g.push(d)}else{g.push(this.get("label"))
}g.end()},init:function(){var d=this.get("column");d.addObserver("width",this,"_scthv_layoutDidChange");
d.addObserver("maxWidth",this,"_scthv_layoutDidChange");d.addObserver("minWidth",this,"_scthv_layoutDidChange");
d.addObserver("sortState",this,"_scthv_sortStateDidChange");d.addObserver("tableContent",this,"_scthv_tableContentDidChange");
return arguments.callee.base.apply(this,arguments)},sortState:function(){return this.get("column").get("sortState")
}.property(),mouseDown:function(e){var d=this.get("tableView");return d?d.mouseDownInTableHeaderView(e,this):arguments.callee.base.apply(this,arguments)
},mouseUp:function(e){var d=this.get("tableView");return d?d.mouseUpInTableHeaderView(e,this):arguments.callee.base.apply(this,arguments)
},mouseDragged:function(e){var d=this.get("tableView");return d?d.mouseDraggedInTableHeaderView(e,this):arguments.callee.base.apply(this,arguments)
},_scthv_dragViewForHeader:function(){var e=this.get("layer").cloneNode(true);var d=SC.View.create({layer:e,parentView:this});
SC.$(e).css("backgroundColor","transparent").css("border","none").css("top",0).css("left",0);
return d},_scthv_enterDragMode:function(){this.set("isInDragMode",YES)},_scthv_exitDragMode:function(){this.set("isInDragMode",NO)
},_scthv_dragModeViewDidChange:function(){var d=this.get("dragModeView");if(d&&d.set){d.set("tableHeadView",this);
d.set("tableView",this.get("tableView"))}}.observes("dragModeView"),_scthv_layoutDidChange:function(g,e,k,d){var j=this.get("parentView");
j.invokeOnce(j.layoutChildViews);var h=this.get("layout")},_scthv_tableContentDidChange:function(){var e=this.get("column").get("tableContent");
var d=this.get("parentView")._scthv_columnContentFromTableContent(e,this.get("columnIndex"));
this.set("content",d)},_scthv_sortStateDidChange:function(){SC.RunLoop.begin();var d=this.get("column").get("sortState");
var e=this.get("classNames");e.removeObject("sc-table-header-sort-asc");e.removeObject("sc-table-header-sort-desc");
e.removeObject("sc-table-header-sort-active");if(d!==null){e.push("sc-table-header-sort-active")
}if(d===SC.SORT_ASCENDING){e.push("sc-table-header-sort-asc")}if(d===SC.SORT_DESCENDING){e.push("sc-table-header-sort-desc")
}this.displayDidChange();this.invokeOnce("updateLayer");SC.RunLoop.end()}});sc_require("views/list");
SC.TableRowView=SC.View.extend({classNames:["sc-table-row"],cells:[],acceptsFirstResponder:YES,tableView:null,init:function(){this._sctrv_handleChildren()
},columns:function(){return this.get("tableView").get("columns")}.property(),prepareContext:function(d,e){arguments.callee.base.apply(this,arguments);
d.setClass("sel",this.get("isSelected"))},render:function(e,g){var d=[];d.push((this.get("contentIndex")%2===0)?"even":"odd");
e.addClass(d);arguments.callee.base.apply(this,arguments)},renderChildViews:function(h,j){var g=this.get("cells"),e,d;
for(d=0;d<g.get("length");d++){e=g.objectAt(d);h=h.begin(e.get("tagName"));e.prepareContext(h,j);
h=h.end()}return h},layoutChildViews:function(){var g=this.get("cells"),h=this.get("columns"),e,k,d;
var m=0,j,l=this.get("tableView").get("rowHeight");for(d=0;d<g.get("length");d++){e=g.objectAt(d);
k=h.objectAt(d);j=k.get("width");e.adjust({left:m,width:j,height:l});m+=j;e.updateLayout()
}},_sctrv_layoutForChildAtColumnIndex:function(e){var g=this.get("columns"),j=this.get("tableView").get("rowHeight"),h={},k=0,d;
for(d=0;d<e;d++){k+=g.objectAt(d).get("width")}return{left:k,width:g.objectAt(e).get("width"),height:j}
},_sctrv_createTableCell:function(e,g){var d=SC.TableCellView.create({column:e,content:g});
return d},_sctrv_handleSelection:function(){this.displayDidChange()}.observes("isSelected"),_sctrv_handleChildren:function(){var l=this.get("content"),j=this.get("columns");
this.removeAllChildren();var k,h,m,g=[],e,d;for(d=0;d<j.get("length");d++){k=j.objectAt(d);
h=k.get("key");m=l?l.getPath(h):"";e=this._sctrv_createTableCell(k,m);g.push(e);this.appendChild(e)
}this.set("cells",g)}});var require=require||function sc_require(){};var sc_require=sc_require||require;
var sc_resource=sc_resource||function sc_resource(){};CoreTest={K:function(){return this
},beget:function(g){if(!g){return null}var d=CoreTest.K;d.prototype=g;var e=new d();
d.prototype=null;return e},mixin:function(){var j=arguments[0]||{};var d=1;var h=arguments.length;
var e;if(h===1){j=this||{};d=0}for(;d<h;d++){if(!(e=arguments[d])){continue}for(var g in e){if(!e.hasOwnProperty(g)){continue
}var k=j[g];var l=e[g];if(j===l){continue}if(l!==undefined){j[g]=l}}}return j},fmt:function(g){var e=arguments;
var d=1;return g.replace(/%@([0-9]+)?/g,function(h,j){j=(j)?parseInt(j,0):d++;h=e[j];
return((h===null)?"(null)":(h===undefined)?"":h).toString()})},stub:function(g,j){var e={};
if(typeof j==="function"){e.action=j}else{if(typeof j==="object"){e=j}}var d=function(){d.callCount++;
var k=[],l=arguments.length;while(--l>=0){k[l]=arguments[l]}k.unshift(this);d.history.push(k);
return d.action.apply(this,arguments)};d.callCount=0;d.history=[];d.stubName=g;var h;
for(h in e){if(!e.hasOwnProperty(h)){continue}d[h]=e[h]}if(!d.reset){d.reset=function(){this.callCount=0;
this.history=[]}}if(!d.action){d.action=function(){return this}}if(!d.expect){d.expect=function(k){if(k===YES){ok(this.callCount>0,CoreTest.fmt("%@ should be called at least once",this.stubName))
}else{if(k===NO){k=0}equals(this.callCount,k,CoreTest.fmt("%@ should be called X times",this.stubName))
}}}return d},OK:"passed",FAIL:"failed",ERROR:"errors",WARN:"warnings",showUI:false};
function notest(d,g,e){}(function(){
/*
 *
 * jQuery 1.2.6 - New Wave Javascript
 *
 * Copyright (c) 2008 John Resig (jquery.com)
 * Dual licensed under the MIT (MIT-LICENSE.txt)
 * and GPL (GPL-LICENSE.txt) licenses.
 *
 * $Date: 2008-05-24 14:22:17 -0400 (Sat, 24 May 2008) $
 * $Rev: 5685 $
 */
var _jQuery=window.jQuery,_$=window.$;
var jQuery=window.jQuery=window.$=function(selector,context){return new jQuery.fn.init(selector,context)
};var quickExpr=/^[^<]*(<(.|\s)+>)[^>]*$|^#(\w+)$/,isSimple=/^.[^:#\[\.]*$/,undefined;
jQuery.fn=jQuery.prototype={init:function(selector,context){selector=selector||document;
if(selector.nodeType){this[0]=selector;this.length=1;return this}if(typeof selector=="string"){var match=quickExpr.exec(selector);
if(match&&(match[1]||!context)){if(match[1]){selector=jQuery.clean([match[1]],context)
}else{var elem=document.getElementById(match[3]);if(elem){if(elem.id!=match[3]){return jQuery().find(selector)
}return jQuery(elem)}selector=[]}}else{return jQuery(context).find(selector)}}else{if(jQuery.isFunction(selector)){return jQuery(document)[jQuery.fn.ready?"ready":"load"](selector)
}}return this.setArray(jQuery.makeArray(selector))},jquery:"1.2.6",size:function(){return this.length
},length:0,get:function(num){return num==undefined?jQuery.makeArray(this):this[num]
},pushStack:function(elems){var ret=jQuery(elems);ret.prevObject=this;return ret},setArray:function(elems){this.length=0;
Array.prototype.push.apply(this,elems);return this},each:function(callback,args){return jQuery.each(this,callback,args)
},index:function(elem){var ret=-1;return jQuery.inArray(elem&&elem.jquery?elem[0]:elem,this)
},attr:function(name,value,type){var options=name;if(name.constructor==String){if(value===undefined){return this[0]&&jQuery[type||"attr"](this[0],name)
}else{options={};options[name]=value}}return this.each(function(i){for(name in options){jQuery.attr(type?this.style:this,name,jQuery.prop(this,options[name],type,i,name))
}})},css:function(key,value){if((key=="width"||key=="height")&&parseFloat(value)<0){value=undefined
}return this.attr(key,value,"curCSS")},text:function(text){if(typeof text!="object"&&text!=null){return this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(text))
}var ret="";jQuery.each(text||this,function(){jQuery.each(this.childNodes,function(){if(this.nodeType!=8){ret+=this.nodeType!=1?this.nodeValue:jQuery.fn.text([this])
}})});return ret},wrapAll:function(html){if(this[0]){jQuery(html,this[0].ownerDocument).clone().insertBefore(this[0]).map(function(){var elem=this;
while(elem.firstChild){elem=elem.firstChild}return elem}).append(this)}return this
},wrapInner:function(html){return this.each(function(){jQuery(this).contents().wrapAll(html)
})},wrap:function(html){return this.each(function(){jQuery(this).wrapAll(html)})},append:function(){return this.domManip(arguments,true,false,function(elem){if(this.nodeType==1){this.appendChild(elem)
}})},prepend:function(){return this.domManip(arguments,true,true,function(elem){if(this.nodeType==1){this.insertBefore(elem,this.firstChild)
}})},before:function(){return this.domManip(arguments,false,false,function(elem){this.parentNode.insertBefore(elem,this)
})},after:function(){return this.domManip(arguments,false,true,function(elem){this.parentNode.insertBefore(elem,this.nextSibling)
})},end:function(){return this.prevObject||jQuery([])},find:function(selector){var elems=jQuery.map(this,function(elem){return jQuery.find(selector,elem)
});return this.pushStack(/[^+>] [^+>]/.test(selector)||selector.indexOf("..")>-1?jQuery.unique(elems):elems)
},clone:function(events){var ret=this.map(function(){if(jQuery.browser.msie&&!jQuery.isXMLDoc(this)){var clone=this.cloneNode(true),container=document.createElement("div");
container.appendChild(clone);return jQuery.clean([container.innerHTML])[0]}else{return this.cloneNode(true)
}});var clone=ret.find("*").andSelf().each(function(){if(this[expando]!=undefined){this[expando]=null
}});if(events===true){this.find("*").andSelf().each(function(i){if(this.nodeType==3){return
}var events=jQuery.data(this,"events");for(var type in events){for(var handler in events[type]){jQuery.event.add(clone[i],type,events[type][handler],events[type][handler].data)
}}})}return ret},filter:function(selector){return this.pushStack(jQuery.isFunction(selector)&&jQuery.grep(this,function(elem,i){return selector.call(elem,i)
})||jQuery.multiFilter(selector,this))},not:function(selector){if(selector.constructor==String){if(isSimple.test(selector)){return this.pushStack(jQuery.multiFilter(selector,this,true))
}else{selector=jQuery.multiFilter(selector,this)}}var isArrayLike=selector.length&&selector[selector.length-1]!==undefined&&!selector.nodeType;
return this.filter(function(){return isArrayLike?jQuery.inArray(this,selector)<0:this!=selector
})},add:function(selector){return this.pushStack(jQuery.unique(jQuery.merge(this.get(),typeof selector=="string"?jQuery(selector):jQuery.makeArray(selector))))
},is:function(selector){return !!selector&&jQuery.multiFilter(selector,this).length>0
},hasClass:function(selector){return this.is("."+selector)},val:function(value){if(value==undefined){if(this.length){var elem=this[0];
if(jQuery.nodeName(elem,"select")){var index=elem.selectedIndex,values=[],options=elem.options,one=elem.type=="select-one";
if(index<0){return null}for(var i=one?index:0,max=one?index+1:options.length;i<max;
i++){var option=options[i];if(option.selected){value=jQuery.browser.msie&&!option.attributes.value.specified?option.text:option.value;
if(one){return value}values.push(value)}}return values}else{return(this[0].value||"").replace(/\r/g,"")
}}return undefined}if(value.constructor==Number){value+=""}return this.each(function(){if(this.nodeType!=1){return
}if(value.constructor==Array&&/radio|checkbox/.test(this.type)){this.checked=(jQuery.inArray(this.value,value)>=0||jQuery.inArray(this.name,value)>=0)
}else{if(jQuery.nodeName(this,"select")){var values=jQuery.makeArray(value);jQuery("option",this).each(function(){this.selected=(jQuery.inArray(this.value,values)>=0||jQuery.inArray(this.text,values)>=0)
});if(!values.length){this.selectedIndex=-1}}else{this.value=value}}})},html:function(value){return value==undefined?(this[0]?this[0].innerHTML:null):this.empty().append(value)
},replaceWith:function(value){return this.after(value).remove()},eq:function(i){return this.slice(i,i+1)
},slice:function(){return this.pushStack(Array.prototype.slice.apply(this,arguments))
},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem)
}))},andSelf:function(){return this.add(this.prevObject)},data:function(key,value){var parts=key.split(".");
parts[1]=parts[1]?"."+parts[1]:"";if(value===undefined){var data=this.triggerHandler("getData"+parts[1]+"!",[parts[0]]);
if(data===undefined&&this.length){data=jQuery.data(this[0],key)}return data===undefined&&parts[1]?this.data(parts[0]):data
}else{return this.trigger("setData"+parts[1]+"!",[parts[0],value]).each(function(){jQuery.data(this,key,value)
})}},removeData:function(key){return this.each(function(){jQuery.removeData(this,key)
})},domManip:function(args,table,reverse,callback){var clone=this.length>1,elems;
return this.each(function(){if(!elems){elems=jQuery.clean(args,this.ownerDocument);
if(reverse){elems.reverse()}}var obj=this;if(table&&jQuery.nodeName(this,"table")&&jQuery.nodeName(elems[0],"tr")){obj=this.getElementsByTagName("tbody")[0]||this.appendChild(this.ownerDocument.createElement("tbody"))
}var scripts=jQuery([]);jQuery.each(elems,function(){var elem=clone?jQuery(this).clone(true)[0]:this;
if(jQuery.nodeName(elem,"script")){scripts=scripts.add(elem)}else{if(elem.nodeType==1){scripts=scripts.add(jQuery("script",elem).remove())
}callback.call(obj,elem)}});scripts.each(evalScript)})}};jQuery.fn.init.prototype=jQuery.fn;
function evalScript(i,elem){if(elem.src){jQuery.ajax({url:elem.src,async:false,dataType:"script"})
}else{jQuery.globalEval(elem.text||elem.textContent||elem.innerHTML||"")}if(elem.parentNode){elem.parentNode.removeChild(elem)
}}function now(){return +new Date}jQuery.extend=jQuery.fn.extend=function(){var target=arguments[0]||{},i=1,length=arguments.length,deep=false,options;
if(target.constructor==Boolean){deep=target;target=arguments[1]||{};i=2}if(typeof target!="object"&&typeof target!="function"){target={}
}if(length==i){target=this;--i}for(;i<length;i++){if((options=arguments[i])!=null){for(var name in options){var src=target[name],copy=options[name];
if(target===copy){continue}if(deep&&copy&&typeof copy=="object"&&!copy.nodeType){target[name]=jQuery.extend(deep,src||(copy.length!=null?[]:{}),copy)
}else{if(copy!==undefined){target[name]=copy}}}}}return target};var expando="jQuery"+now(),uuid=0,windowData={},exclude=/z-?index|font-?weight|opacity|zoom|line-?height/i,defaultView=document.defaultView||{};
jQuery.extend({noConflict:function(deep){window.$=_$;if(deep){window.jQuery=_jQuery
}return jQuery},isFunction:function(fn){return !!fn&&typeof fn!="string"&&!fn.nodeName&&fn.constructor!=Array&&/^[\s[]?function/.test(fn+"")
},isXMLDoc:function(elem){return elem.documentElement&&!elem.body||elem.tagName&&elem.ownerDocument&&!elem.ownerDocument.body
},globalEval:function(data){data=jQuery.trim(data);if(data){var head=document.getElementsByTagName("head")[0]||document.documentElement,script=document.createElement("script");
script.type="text/javascript";if(jQuery.browser.msie){script.text=data}else{script.appendChild(document.createTextNode(data))
}head.insertBefore(script,head.firstChild);head.removeChild(script)}},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toUpperCase()==name.toUpperCase()
},cache:{},data:function(elem,name,data){elem=elem==window?windowData:elem;var id=elem[expando];
if(!id){id=elem[expando]=++uuid}if(name&&!jQuery.cache[id]){jQuery.cache[id]={}}if(data!==undefined){jQuery.cache[id][name]=data
}return name?jQuery.cache[id][name]:id},removeData:function(elem,name){elem=elem==window?windowData:elem;
var id=elem[expando];if(name){if(jQuery.cache[id]){delete jQuery.cache[id][name];
name="";for(name in jQuery.cache[id]){break}if(!name){jQuery.removeData(elem)}}}else{try{delete elem[expando]
}catch(e){if(elem.removeAttribute){elem.removeAttribute(expando)}}delete jQuery.cache[id]
}},each:function(object,callback,args){var name,i=0,length=object.length;if(args){if(length==undefined){for(name in object){if(callback.apply(object[name],args)===false){break
}}}else{for(;i<length;){if(callback.apply(object[i++],args)===false){break}}}}else{if(length==undefined){for(name in object){if(callback.call(object[name],name,object[name])===false){break
}}}else{for(var value=object[0];i<length&&callback.call(value,i,value)!==false;value=object[++i]){}}}return object
},prop:function(elem,value,type,i,name){if(jQuery.isFunction(value)){value=value.call(elem,i)
}return value&&value.constructor==Number&&type=="curCSS"&&!exclude.test(name)?value+"px":value
},className:{add:function(elem,classNames){jQuery.each((classNames||"").split(/\s+/),function(i,className){if(elem.nodeType==1&&!jQuery.className.has(elem.className,className)){elem.className+=(elem.className?" ":"")+className
}})},remove:function(elem,classNames){if(elem.nodeType==1){elem.className=classNames!=undefined?jQuery.grep(elem.className.split(/\s+/),function(className){return !jQuery.className.has(classNames,className)
}).join(" "):""}},has:function(elem,className){return jQuery.inArray(className,(elem.className||elem).toString().split(/\s+/))>-1
}},swap:function(elem,options,callback){var old={};for(var name in options){old[name]=elem.style[name];
elem.style[name]=options[name]}callback.call(elem);for(var name in options){elem.style[name]=old[name]
}},css:function(elem,name,force){if(name=="width"||name=="height"){var val,props={position:"absolute",visibility:"hidden",display:"block"},which=name=="width"?["Left","Right"]:["Top","Bottom"];
function getWH(){val=name=="width"?elem.offsetWidth:elem.offsetHeight;var padding=0,border=0;
jQuery.each(which,function(){padding+=parseFloat(jQuery.curCSS(elem,"padding"+this,true))||0;
border+=parseFloat(jQuery.curCSS(elem,"border"+this+"Width",true))||0});val-=Math.round(padding+border)
}if(jQuery(elem).is(":visible")){getWH()}else{jQuery.swap(elem,props,getWH)}return Math.max(0,val)
}return jQuery.curCSS(elem,name,force)},curCSS:function(elem,name,force){var ret,style=elem.style;
function color(elem){if(!jQuery.browser.safari){return false}var ret=defaultView.getComputedStyle(elem,null);
return !ret||ret.getPropertyValue("color")==""}if(name=="opacity"&&jQuery.browser.msie){ret=jQuery.attr(style,"opacity");
return ret==""?"1":ret}if(jQuery.browser.opera&&name=="display"){var save=style.outline;
style.outline="0 solid black";style.outline=save}if(name.match(/float/i)){name=styleFloat
}if(!force&&style&&style[name]){ret=style[name]}else{if(defaultView.getComputedStyle){if(name.match(/float/i)){name="float"
}name=name.replace(/([A-Z])/g,"-$1").toLowerCase();var computedStyle=defaultView.getComputedStyle(elem,null);
if(computedStyle&&!color(elem)){ret=computedStyle.getPropertyValue(name)}else{var swap=[],stack=[],a=elem,i=0;
for(;a&&color(a);a=a.parentNode){stack.unshift(a)}for(;i<stack.length;i++){if(color(stack[i])){swap[i]=stack[i].style.display;
stack[i].style.display="block"}}ret=name=="display"&&swap[stack.length-1]!=null?"none":(computedStyle&&computedStyle.getPropertyValue(name))||"";
for(i=0;i<swap.length;i++){if(swap[i]!=null){stack[i].style.display=swap[i]}}}if(name=="opacity"&&ret==""){ret="1"
}}else{if(elem.currentStyle){var camelCase=name.replace(/\-(\w)/g,function(all,letter){return letter.toUpperCase()
});ret=elem.currentStyle[name]||elem.currentStyle[camelCase];if(!/^\d+(px)?$/i.test(ret)&&/^\d/.test(ret)){var left=style.left,rsLeft=elem.runtimeStyle.left;
elem.runtimeStyle.left=elem.currentStyle.left;style.left=ret||0;ret=style.pixelLeft+"px";
style.left=left;elem.runtimeStyle.left=rsLeft}}}}return ret},clean:function(elems,context){var ret=[];
context=context||document;if(typeof context.createElement=="undefined"){context=context.ownerDocument||context[0]&&context[0].ownerDocument||document
}jQuery.each(elems,function(i,elem){if(!elem){return}if(elem.constructor==Number){elem+=""
}if(typeof elem=="string"){elem=elem.replace(/(<(\w+)[^>]*?)\/>/g,function(all,front,tag){return tag.match(/^(abbr|br|col|img|input|link|meta|param|hr|area|embed)$/i)?all:front+"></"+tag+">"
});var tags=jQuery.trim(elem).toLowerCase(),div=context.createElement("div");var wrap=!tags.indexOf("<opt")&&[1,"<select multiple='multiple'>","</select>"]||!tags.indexOf("<leg")&&[1,"<fieldset>","</fieldset>"]||tags.match(/^<(thead|tbody|tfoot|colg|cap)/)&&[1,"<table>","</table>"]||!tags.indexOf("<tr")&&[2,"<table><tbody>","</tbody></table>"]||(!tags.indexOf("<td")||!tags.indexOf("<th"))&&[3,"<table><tbody><tr>","</tr></tbody></table>"]||!tags.indexOf("<col")&&[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"]||jQuery.browser.msie&&[1,"div<div>","</div>"]||[0,"",""];
div.innerHTML=wrap[1]+elem+wrap[2];while(wrap[0]--){div=div.lastChild}if(jQuery.browser.msie){var tbody=!tags.indexOf("<table")&&tags.indexOf("<tbody")<0?div.firstChild&&div.firstChild.childNodes:wrap[1]=="<table>"&&tags.indexOf("<tbody")<0?div.childNodes:[];
for(var j=tbody.length-1;j>=0;--j){if(jQuery.nodeName(tbody[j],"tbody")&&!tbody[j].childNodes.length){tbody[j].parentNode.removeChild(tbody[j])
}}if(/^\s/.test(elem)){div.insertBefore(context.createTextNode(elem.match(/^\s*/)[0]),div.firstChild)
}}elem=jQuery.makeArray(div.childNodes)}if(elem.length===0&&(!jQuery.nodeName(elem,"form")&&!jQuery.nodeName(elem,"select"))){return
}if(elem[0]==undefined||jQuery.nodeName(elem,"form")||elem.options){ret.push(elem)
}else{ret=jQuery.merge(ret,elem)}});return ret},attr:function(elem,name,value){if(!elem||elem.nodeType==3||elem.nodeType==8){return undefined
}var notxml=!jQuery.isXMLDoc(elem),set=value!==undefined,msie=jQuery.browser.msie;
name=notxml&&jQuery.props[name]||name;if(elem.tagName){var special=/href|src|style/.test(name);
if(name=="selected"&&jQuery.browser.safari){elem.parentNode.selectedIndex}if(name in elem&&notxml&&!special){if(set){if(name=="type"&&jQuery.nodeName(elem,"input")&&elem.parentNode){throw"type property can't be changed"
}elem[name]=value}if(jQuery.nodeName(elem,"form")&&elem.getAttributeNode(name)){return elem.getAttributeNode(name).nodeValue
}return elem[name]}if(msie&&notxml&&name=="style"){return jQuery.attr(elem.style,"cssText",value)
}if(set){elem.setAttribute(name,""+value)}var attr=msie&&notxml&&special?elem.getAttribute(name,2):elem.getAttribute(name);
return attr===null?undefined:attr}if(msie&&name=="opacity"){if(set){elem.zoom=1;elem.filter=(elem.filter||"").replace(/alpha\([^)]*\)/,"")+(parseInt(value)+""=="NaN"?"":"alpha(opacity="+value*100+")")
}return elem.filter&&elem.filter.indexOf("opacity=")>=0?(parseFloat(elem.filter.match(/opacity=([^)]*)/)[1])/100)+"":""
}name=name.replace(/-([a-z])/ig,function(all,letter){return letter.toUpperCase()});
if(set){elem[name]=value}return elem[name]},trim:function(text){return(text||"").replace(/^\s+|\s+$/g,"")
},makeArray:function(array){var ret=[];if(array!=null){var i=array.length;if(i==null||array.split||array.setInterval||array.call){ret[0]=array
}else{while(i){ret[--i]=array[i]}}}return ret},inArray:function(elem,array){for(var i=0,length=array.length;
i<length;i++){if(array[i]===elem){return i}}return -1},merge:function(first,second){var i=0,elem,pos=first.length;
if(jQuery.browser.msie){while(elem=second[i++]){if(elem.nodeType!=8){first[pos++]=elem
}}}else{while(elem=second[i++]){first[pos++]=elem}}return first},unique:function(array){var ret=[],done={};
try{for(var i=0,length=array.length;i<length;i++){var id=jQuery.data(array[i]);if(!done[id]){done[id]=true;
ret.push(array[i])}}}catch(e){ret=array}return ret},grep:function(elems,callback,inv){var ret=[];
for(var i=0,length=elems.length;i<length;i++){if(!inv!=!callback(elems[i],i)){ret.push(elems[i])
}}return ret},map:function(elems,callback){var ret=[];for(var i=0,length=elems.length;
i<length;i++){var value=callback(elems[i],i);if(value!=null){ret[ret.length]=value
}}return ret.concat.apply([],ret)}});var userAgent=navigator.userAgent.toLowerCase();
jQuery.browser={version:(userAgent.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1],safari:/webkit/.test(userAgent),opera:/opera/.test(userAgent),msie:/msie/.test(userAgent)&&!/opera/.test(userAgent),mozilla:/mozilla/.test(userAgent)&&!/(compatible|webkit)/.test(userAgent)};
var styleFloat=jQuery.browser.msie?"styleFloat":"cssFloat";jQuery.extend({boxModel:!jQuery.browser.msie||document.compatMode=="CSS1Compat",props:{"for":"htmlFor","class":"className","float":styleFloat,cssFloat:styleFloat,styleFloat:styleFloat,readonly:"readOnly",maxlength:"maxLength",cellspacing:"cellSpacing"}});
jQuery.each({parent:function(elem){return elem.parentNode},parents:function(elem){return jQuery.dir(elem,"parentNode")
},next:function(elem){return jQuery.nth(elem,2,"nextSibling")},prev:function(elem){return jQuery.nth(elem,2,"previousSibling")
},nextAll:function(elem){return jQuery.dir(elem,"nextSibling")},prevAll:function(elem){return jQuery.dir(elem,"previousSibling")
},siblings:function(elem){return jQuery.sibling(elem.parentNode.firstChild,elem)},children:function(elem){return jQuery.sibling(elem.firstChild)
},contents:function(elem){return jQuery.nodeName(elem,"iframe")?elem.contentDocument||elem.contentWindow.document:jQuery.makeArray(elem.childNodes)
}},function(name,fn){jQuery.fn[name]=function(selector){var ret=jQuery.map(this,fn);
if(selector&&typeof selector=="string"){ret=jQuery.multiFilter(selector,ret)}return this.pushStack(jQuery.unique(ret))
}});jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(){var args=arguments;
return this.each(function(){for(var i=0,length=args.length;i<length;i++){jQuery(args[i])[original](this)
}})}});jQuery.each({removeAttr:function(name){jQuery.attr(this,name,"");if(this.nodeType==1){this.removeAttribute(name)
}},addClass:function(classNames){jQuery.className.add(this,classNames)},removeClass:function(classNames){jQuery.className.remove(this,classNames)
},toggleClass:function(classNames){jQuery.className[jQuery.className.has(this,classNames)?"remove":"add"](this,classNames)
},remove:function(selector){if(!selector||jQuery.filter(selector,[this]).r.length){jQuery("*",this).add(this).each(function(){jQuery.event.remove(this);
jQuery.removeData(this)});if(this.parentNode){this.parentNode.removeChild(this)}}},empty:function(){jQuery(">*",this).remove();
while(this.firstChild){this.removeChild(this.firstChild)}}},function(name,fn){jQuery.fn[name]=function(){return this.each(fn,arguments)
}});jQuery.each(["Height","Width"],function(i,name){var type=name.toLowerCase();jQuery.fn[type]=function(size){return this[0]==window?jQuery.browser.opera&&document.body["client"+name]||jQuery.browser.safari&&window["inner"+name]||document.compatMode=="CSS1Compat"&&document.documentElement["client"+name]||document.body["client"+name]:this[0]==document?Math.max(Math.max(document.body["scroll"+name],document.documentElement["scroll"+name]),Math.max(document.body["offset"+name],document.documentElement["offset"+name])):size==undefined?(this.length?jQuery.css(this[0],type):null):this.css(type,size.constructor==String?size:size+"px")
}});function num(elem,prop){return elem[0]&&parseInt(jQuery.curCSS(elem[0],prop,true),10)||0
}var chars=jQuery.browser.safari&&parseInt(jQuery.browser.version)<417?"(?:[\\w*_-]|\\\\.)":"(?:[\\w\u0128-\uFFFF*_-]|\\\\.)",quickChild=new RegExp("^>\\s*("+chars+"+)"),quickID=new RegExp("^("+chars+"+)(#)("+chars+"+)"),quickClass=new RegExp("^([#.]?)("+chars+"*)");
jQuery.extend({expr:{"":function(a,i,m){return m[2]=="*"||jQuery.nodeName(a,m[2])
},"#":function(a,i,m){return a.getAttribute("id")==m[2]},":":{lt:function(a,i,m){return i<m[3]-0
},gt:function(a,i,m){return i>m[3]-0},nth:function(a,i,m){return m[3]-0==i},eq:function(a,i,m){return m[3]-0==i
},first:function(a,i){return i==0},last:function(a,i,m,r){return i==r.length-1},even:function(a,i){return i%2==0
},odd:function(a,i){return i%2},"first-child":function(a){return a.parentNode.getElementsByTagName("*")[0]==a
},"last-child":function(a){return jQuery.nth(a.parentNode.lastChild,1,"previousSibling")==a
},"only-child":function(a){return !jQuery.nth(a.parentNode.lastChild,2,"previousSibling")
},parent:function(a){return a.firstChild},empty:function(a){return !a.firstChild},contains:function(a,i,m){return(a.textContent||a.innerText||jQuery(a).text()||"").indexOf(m[3])>=0
},visible:function(a){return"hidden"!=a.type&&jQuery.css(a,"display")!="none"&&jQuery.css(a,"visibility")!="hidden"
},hidden:function(a){return"hidden"==a.type||jQuery.css(a,"display")=="none"||jQuery.css(a,"visibility")=="hidden"
},enabled:function(a){return !a.disabled},disabled:function(a){return a.disabled},checked:function(a){return a.checked
},selected:function(a){return a.selected||jQuery.attr(a,"selected")},text:function(a){return"text"==a.type
},radio:function(a){return"radio"==a.type},checkbox:function(a){return"checkbox"==a.type
},file:function(a){return"file"==a.type},password:function(a){return"password"==a.type
},submit:function(a){return"submit"==a.type},image:function(a){return"image"==a.type
},reset:function(a){return"reset"==a.type},button:function(a){return"button"==a.type||jQuery.nodeName(a,"button")
},input:function(a){return/input|select|textarea|button/i.test(a.nodeName)},has:function(a,i,m){return jQuery.find(m[3],a).length
},header:function(a){return/h\d/i.test(a.nodeName)},animated:function(a){return jQuery.grep(jQuery.timers,function(fn){return a==fn.elem
}).length}}},parse:[/^(\[) *@?([\w-]+) *([!*$^~=]*) *('?"?)(.*?)\4 *\]/,/^(:)([\w-]+)\("?'?(.*?(\(.*?\))?[^(]*?)"?'?\)/,new RegExp("^([:.#]*)("+chars+"+)")],multiFilter:function(expr,elems,not){var old,cur=[];
while(expr&&expr!=old){old=expr;var f=jQuery.filter(expr,elems,not);expr=f.t.replace(/^\s*,\s*/,"");
cur=not?elems=f.r:jQuery.merge(cur,f.r)}return cur},find:function(t,context){if(typeof t!="string"){return[t]
}if(context&&context.nodeType!=1&&context.nodeType!=9){return[]}context=context||document;
var ret=[context],done=[],last,nodeName;while(t&&last!=t){var r=[];last=t;t=jQuery.trim(t);
var foundToken=false,re=quickChild,m=re.exec(t);if(m){nodeName=m[1].toUpperCase();
for(var i=0;ret[i];i++){for(var c=ret[i].firstChild;c;c=c.nextSibling){if(c.nodeType==1&&(nodeName=="*"||c.nodeName.toUpperCase()==nodeName)){r.push(c)
}}}ret=r;t=t.replace(re,"");if(t.indexOf(" ")==0){continue}foundToken=true}else{re=/^([>+~])\s*(\w*)/i;
if((m=re.exec(t))!=null){r=[];var merge={};nodeName=m[2].toUpperCase();m=m[1];for(var j=0,rl=ret.length;
j<rl;j++){var n=m=="~"||m=="+"?ret[j].nextSibling:ret[j].firstChild;for(;n;n=n.nextSibling){if(n.nodeType==1){var id=jQuery.data(n);
if(m=="~"&&merge[id]){break}if(!nodeName||n.nodeName.toUpperCase()==nodeName){if(m=="~"){merge[id]=true
}r.push(n)}if(m=="+"){break}}}}ret=r;t=jQuery.trim(t.replace(re,""));foundToken=true
}}if(t&&!foundToken){if(!t.indexOf(",")){if(context==ret[0]){ret.shift()}done=jQuery.merge(done,ret);
r=ret=[context];t=" "+t.substr(1,t.length)}else{var re2=quickID;var m=re2.exec(t);
if(m){m=[0,m[2],m[3],m[1]]}else{re2=quickClass;m=re2.exec(t)}m[2]=m[2].replace(/\\/g,"");
var elem=ret[ret.length-1];if(m[1]=="#"&&elem&&elem.getElementById&&!jQuery.isXMLDoc(elem)){var oid=elem.getElementById(m[2]);
if((jQuery.browser.msie||jQuery.browser.opera)&&oid&&typeof oid.id=="string"&&oid.id!=m[2]){oid=jQuery('[@id="'+m[2]+'"]',elem)[0]
}ret=r=oid&&(!m[3]||jQuery.nodeName(oid,m[3]))?[oid]:[]}else{for(var i=0;ret[i];i++){var tag=m[1]=="#"&&m[3]?m[3]:m[1]!=""||m[0]==""?"*":m[2];
if(tag=="*"&&ret[i].nodeName.toLowerCase()=="object"){tag="param"}r=jQuery.merge(r,ret[i].getElementsByTagName(tag))
}if(m[1]=="."){r=jQuery.classFilter(r,m[2])}if(m[1]=="#"){var tmp=[];for(var i=0;
r[i];i++){if(r[i].getAttribute("id")==m[2]){tmp=[r[i]];break}}r=tmp}ret=r}t=t.replace(re2,"")
}}if(t){var val=jQuery.filter(t,r);ret=r=val.r;t=jQuery.trim(val.t)}}if(t){ret=[]
}if(ret&&context==ret[0]){ret.shift()}done=jQuery.merge(done,ret);return done},classFilter:function(r,m,not){m=" "+m+" ";
var tmp=[];for(var i=0;r[i];i++){var pass=(" "+r[i].className+" ").indexOf(m)>=0;
if(!not&&pass||not&&!pass){tmp.push(r[i])}}return tmp},filter:function(t,r,not){var last;
while(t&&t!=last){last=t;var p=jQuery.parse,m;for(var i=0;p[i];i++){m=p[i].exec(t);
if(m){t=t.substring(m[0].length);m[2]=m[2].replace(/\\/g,"");break}}if(!m){break}if(m[1]==":"&&m[2]=="not"){r=isSimple.test(m[3])?jQuery.filter(m[3],r,true).r:jQuery(r).not(m[3])
}else{if(m[1]=="."){r=jQuery.classFilter(r,m[2],not)}else{if(m[1]=="["){var tmp=[],type=m[3];
for(var i=0,rl=r.length;i<rl;i++){var a=r[i],z=a[jQuery.props[m[2]]||m[2]];if(z==null||/href|src|selected/.test(m[2])){z=jQuery.attr(a,m[2])||""
}if((type==""&&!!z||type=="="&&z==m[5]||type=="!="&&z!=m[5]||type=="^="&&z&&!z.indexOf(m[5])||type=="$="&&z.substr(z.length-m[5].length)==m[5]||(type=="*="||type=="~=")&&z.indexOf(m[5])>=0)^not){tmp.push(a)
}}r=tmp}else{if(m[1]==":"&&m[2]=="nth-child"){var merge={},tmp=[],test=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(m[3]=="even"&&"2n"||m[3]=="odd"&&"2n+1"||!/\D/.test(m[3])&&"0n+"+m[3]||m[3]),first=(test[1]+(test[2]||1))-0,last=test[3]-0;
for(var i=0,rl=r.length;i<rl;i++){var node=r[i],parentNode=node.parentNode,id=jQuery.data(parentNode);
if(!merge[id]){var c=1;for(var n=parentNode.firstChild;n;n=n.nextSibling){if(n.nodeType==1){n.nodeIndex=c++
}}merge[id]=true}var add=false;if(first==0){if(node.nodeIndex==last){add=true}}else{if((node.nodeIndex-last)%first==0&&(node.nodeIndex-last)/first>=0){add=true
}}if(add^not){tmp.push(node)}}r=tmp}else{var fn=jQuery.expr[m[1]];if(typeof fn=="object"){fn=fn[m[2]]
}if(typeof fn=="string"){fn=eval("false||function(a,i){return "+fn+";}")}r=jQuery.grep(r,function(elem,i){return fn(elem,i,m,r)
},not)}}}}}return{r:r,t:t}},dir:function(elem,dir){var matched=[],cur=elem[dir];while(cur&&cur!=document){if(cur.nodeType==1){matched.push(cur)
}cur=cur[dir]}return matched},nth:function(cur,result,dir,elem){result=result||1;
var num=0;for(;cur;cur=cur[dir]){if(cur.nodeType==1&&++num==result){break}}return cur
},sibling:function(n,elem){var r=[];for(;n;n=n.nextSibling){if(n.nodeType==1&&n!=elem){r.push(n)
}}return r}});jQuery.event={add:function(elem,types,handler,data){if(elem.nodeType==3||elem.nodeType==8){return
}if(jQuery.browser.msie&&elem.setInterval){elem=window}if(!handler.guid){handler.guid=this.guid++
}if(data!=undefined){var fn=handler;handler=this.proxy(fn,function(){return fn.apply(this,arguments)
});handler.data=data}var events=jQuery.data(elem,"events")||jQuery.data(elem,"events",{}),handle=jQuery.data(elem,"handle")||jQuery.data(elem,"handle",function(){if(typeof jQuery!="undefined"&&!jQuery.event.triggered){return jQuery.event.handle.apply(arguments.callee.elem,arguments)
}});handle.elem=elem;jQuery.each(types.split(/\s+/),function(index,type){var parts=type.split(".");
type=parts[0];handler.type=parts[1];var handlers=events[type];if(!handlers){handlers=events[type]={};
if(!jQuery.event.special[type]||jQuery.event.special[type].setup.call(elem)===false){if(elem.addEventListener){elem.addEventListener(type,handle,false)
}else{if(elem.attachEvent){elem.attachEvent("on"+type,handle)}}}}handlers[handler.guid]=handler;
jQuery.event.global[type]=true});elem=null},guid:1,global:{},remove:function(elem,types,handler){if(elem.nodeType==3||elem.nodeType==8){return
}var events=jQuery.data(elem,"events"),ret,index;if(events){if(types==undefined||(typeof types=="string"&&types.charAt(0)==".")){for(var type in events){this.remove(elem,type+(types||""))
}}else{if(types.type){handler=types.handler;types=types.type}jQuery.each(types.split(/\s+/),function(index,type){var parts=type.split(".");
type=parts[0];if(events[type]){if(handler){delete events[type][handler.guid]}else{for(handler in events[type]){if(!parts[1]||events[type][handler].type==parts[1]){delete events[type][handler]
}}}for(ret in events[type]){break}if(!ret){if(!jQuery.event.special[type]||jQuery.event.special[type].teardown.call(elem)===false){if(elem.removeEventListener){elem.removeEventListener(type,jQuery.data(elem,"handle"),false)
}else{if(elem.detachEvent){elem.detachEvent("on"+type,jQuery.data(elem,"handle"))
}}}ret=null;delete events[type]}}})}for(ret in events){break}if(!ret){var handle=jQuery.data(elem,"handle");
if(handle){handle.elem=null}jQuery.removeData(elem,"events");jQuery.removeData(elem,"handle")
}}},trigger:function(type,data,elem,donative,extra){data=jQuery.makeArray(data);if(type.indexOf("!")>=0){type=type.slice(0,-1);
var exclusive=true}if(!elem){if(this.global[type]){jQuery("*").add([window,document]).trigger(type,data)
}}else{if(elem.nodeType==3||elem.nodeType==8){return undefined}var val,ret,fn=jQuery.isFunction(elem[type]||null),event=!data[0]||!data[0].preventDefault;
if(event){data.unshift({type:type,target:elem,preventDefault:function(){},stopPropagation:function(){},timeStamp:now()});
data[0][expando]=true}data[0].type=type;if(exclusive){data[0].exclusive=true}var handle=jQuery.data(elem,"handle");
if(handle){val=handle.apply(elem,data)}if((!fn||(jQuery.nodeName(elem,"a")&&type=="click"))&&elem["on"+type]&&elem["on"+type].apply(elem,data)===false){val=false
}if(event){data.shift()}if(extra&&jQuery.isFunction(extra)){ret=extra.apply(elem,val==null?data:data.concat(val));
if(ret!==undefined){val=ret}}if(fn&&donative!==false&&val!==false&&!(jQuery.nodeName(elem,"a")&&type=="click")){this.triggered=true;
try{elem[type]()}catch(e){}}this.triggered=false}return val},handle:function(event){var val,ret,namespace,all,handlers;
event=arguments[0]=jQuery.event.fix(event||window.event);namespace=event.type.split(".");
event.type=namespace[0];namespace=namespace[1];all=!namespace&&!event.exclusive;handlers=(jQuery.data(this,"events")||{})[event.type];
for(var j in handlers){var handler=handlers[j];if(all||handler.type==namespace){event.handler=handler;
event.data=handler.data;ret=handler.apply(this,arguments);if(val!==false){val=ret
}if(ret===false){event.preventDefault();event.stopPropagation()}}}return val},fix:function(event){if(event[expando]==true){return event
}var originalEvent=event;event={originalEvent:originalEvent};var props="altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode metaKey newValue originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target timeStamp toElement type view wheelDelta which".split(" ");
for(var i=props.length;i;i--){event[props[i]]=originalEvent[props[i]]}event[expando]=true;
event.preventDefault=function(){if(originalEvent.preventDefault){originalEvent.preventDefault()
}originalEvent.returnValue=false};event.stopPropagation=function(){if(originalEvent.stopPropagation){originalEvent.stopPropagation()
}originalEvent.cancelBubble=true};event.timeStamp=event.timeStamp||now();if(!event.target){event.target=event.srcElement||document
}if(event.target.nodeType==3){event.target=event.target.parentNode}if(!event.relatedTarget&&event.fromElement){event.relatedTarget=event.fromElement==event.target?event.toElement:event.fromElement
}if(event.pageX==null&&event.clientX!=null){var doc=document.documentElement,body=document.body;
event.pageX=event.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc.clientLeft||0);
event.pageY=event.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc.clientTop||0)
}if(!event.which&&((event.charCode||event.charCode===0)?event.charCode:event.keyCode)){event.which=event.charCode||event.keyCode
}if(!event.metaKey&&event.ctrlKey){event.metaKey=event.ctrlKey}if(!event.which&&event.button){event.which=(event.button&1?1:(event.button&2?3:(event.button&4?2:0)))
}return event},proxy:function(fn,proxy){proxy.guid=fn.guid=fn.guid||proxy.guid||this.guid++;
return proxy},special:{ready:{setup:function(){bindReady();return},teardown:function(){return
}},mouseenter:{setup:function(){if(jQuery.browser.msie){return false}jQuery(this).bind("mouseover",jQuery.event.special.mouseenter.handler);
return true},teardown:function(){if(jQuery.browser.msie){return false}jQuery(this).unbind("mouseover",jQuery.event.special.mouseenter.handler);
return true},handler:function(event){if(withinElement(event,this)){return true}event.type="mouseenter";
return jQuery.event.handle.apply(this,arguments)}},mouseleave:{setup:function(){if(jQuery.browser.msie){return false
}jQuery(this).bind("mouseout",jQuery.event.special.mouseleave.handler);return true
},teardown:function(){if(jQuery.browser.msie){return false}jQuery(this).unbind("mouseout",jQuery.event.special.mouseleave.handler);
return true},handler:function(event){if(withinElement(event,this)){return true}event.type="mouseleave";
return jQuery.event.handle.apply(this,arguments)}}}};jQuery.fn.extend({bind:function(type,data,fn){return type=="unload"?this.one(type,data,fn):this.each(function(){jQuery.event.add(this,type,fn||data,fn&&data)
})},one:function(type,data,fn){var one=jQuery.event.proxy(fn||data,function(event){jQuery(this).unbind(event,one);
return(fn||data).apply(this,arguments)});return this.each(function(){jQuery.event.add(this,type,one,fn&&data)
})},unbind:function(type,fn){return this.each(function(){jQuery.event.remove(this,type,fn)
})},trigger:function(type,data,fn){return this.each(function(){jQuery.event.trigger(type,data,this,true,fn)
})},triggerHandler:function(type,data,fn){return this[0]&&jQuery.event.trigger(type,data,this[0],false,fn)
},toggle:function(fn){var args=arguments,i=1;while(i<args.length){jQuery.event.proxy(fn,args[i++])
}return this.click(jQuery.event.proxy(fn,function(event){this.lastToggle=(this.lastToggle||0)%i;
event.preventDefault();return args[this.lastToggle++].apply(this,arguments)||false
}))},hover:function(fnOver,fnOut){return this.bind("mouseenter",fnOver).bind("mouseleave",fnOut)
},ready:function(fn){bindReady();if(jQuery.isReady){fn.call(document,jQuery)}else{jQuery.readyList.push(function(){return fn.call(this,jQuery)
})}return this}});jQuery.extend({isReady:false,readyList:[],ready:function(){if(!jQuery.isReady){jQuery.isReady=true;
if(jQuery.readyList){jQuery.each(jQuery.readyList,function(){this.call(document)});
jQuery.readyList=null}jQuery(document).triggerHandler("ready")}}});var readyBound=false;
function bindReady(){if(readyBound){return}readyBound=true;if(document.addEventListener&&!jQuery.browser.opera){document.addEventListener("DOMContentLoaded",jQuery.ready,false)
}if(jQuery.browser.msie&&window==top){(function(){if(jQuery.isReady){return}try{document.documentElement.doScroll("left")
}catch(error){setTimeout(arguments.callee,0);return}jQuery.ready()})()}if(jQuery.browser.opera){document.addEventListener("DOMContentLoaded",function(){if(jQuery.isReady){return
}for(var i=0;i<document.styleSheets.length;i++){if(document.styleSheets[i].disabled){setTimeout(arguments.callee,0);
return}}jQuery.ready()},false)}if(jQuery.browser.safari){var numStyles;(function(){if(jQuery.isReady){return
}if(document.readyState!="loaded"&&document.readyState!="complete"){setTimeout(arguments.callee,0);
return}if(numStyles===undefined){numStyles=jQuery("style, link[rel=stylesheet]").length
}if(document.styleSheets.length!=numStyles){setTimeout(arguments.callee,0);return
}jQuery.ready()})()}jQuery.event.add(window,"load",jQuery.ready)}jQuery.each(("blur,focus,load,resize,scroll,unload,click,dblclick,mousedown,mouseup,mousemove,mouseover,mouseout,change,select,submit,keydown,keypress,keyup,error").split(","),function(i,name){jQuery.fn[name]=function(fn){return fn?this.bind(name,fn):this.trigger(name)
}});var withinElement=function(event,elem){var parent=event.relatedTarget;while(parent&&parent!=elem){try{parent=parent.parentNode
}catch(error){parent=elem}}return parent==elem};jQuery(window).bind("unload",function(){jQuery("*").add(document).unbind()
});jQuery.fn.extend({_load:jQuery.fn.load,load:function(url,params,callback){if(typeof url!="string"){return this._load(url)
}var off=url.indexOf(" ");if(off>=0){var selector=url.slice(off,url.length);url=url.slice(0,off)
}callback=callback||function(){};var type="GET";if(params){if(jQuery.isFunction(params)){callback=params;
params=null}else{params=jQuery.param(params);type="POST"}}var self=this;jQuery.ajax({url:url,type:type,dataType:"html",data:params,complete:function(res,status){if(status=="success"||status=="notmodified"){self.html(selector?jQuery("<div/>").append(res.responseText.replace(/<script(.|\s)*?\/script>/g,"")).find(selector):res.responseText)
}self.each(callback,[res.responseText,status,res])}});return this},serialize:function(){return jQuery.param(this.serializeArray())
},serializeArray:function(){return this.map(function(){return jQuery.nodeName(this,"form")?jQuery.makeArray(this.elements):this
}).filter(function(){return this.name&&!this.disabled&&(this.checked||/select|textarea/i.test(this.nodeName)||/text|hidden|password/i.test(this.type))
}).map(function(i,elem){var val=jQuery(this).val();return val==null?null:val.constructor==Array?jQuery.map(val,function(val,i){return{name:elem.name,value:val}
}):{name:elem.name,value:val}}).get()}});jQuery.each("ajaxStart,ajaxStop,ajaxComplete,ajaxError,ajaxSuccess,ajaxSend".split(","),function(i,o){jQuery.fn[o]=function(f){return this.bind(o,f)
}});var jsc=now();jQuery.extend({get:function(url,data,callback,type){if(jQuery.isFunction(data)){callback=data;
data=null}return jQuery.ajax({type:"GET",url:url,data:data,success:callback,dataType:type})
},getScript:function(url,callback){return jQuery.get(url,null,callback,"script")},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json")
},post:function(url,data,callback,type){if(jQuery.isFunction(data)){callback=data;
data={}}return jQuery.ajax({type:"POST",url:url,data:data,success:callback,dataType:type})
},ajaxSetup:function(settings){jQuery.extend(jQuery.ajaxSettings,settings)},ajaxSettings:{url:location.href,global:true,type:"GET",timeout:0,contentType:"application/x-www-form-urlencoded",processData:true,async:true,data:null,username:null,password:null,accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"}},lastModified:{},ajax:function(s){s=jQuery.extend(true,s,jQuery.extend(true,{},jQuery.ajaxSettings,s));
var jsonp,jsre=/=\?(&|$)/g,status,data,type=s.type.toUpperCase();if(s.data&&s.processData&&typeof s.data!="string"){s.data=jQuery.param(s.data)
}if(s.dataType=="jsonp"){if(type=="GET"){if(!s.url.match(jsre)){s.url+=(s.url.match(/\?/)?"&":"?")+(s.jsonp||"callback")+"=?"
}}else{if(!s.data||!s.data.match(jsre)){s.data=(s.data?s.data+"&":"")+(s.jsonp||"callback")+"=?"
}}s.dataType="json"}if(s.dataType=="json"&&(s.data&&s.data.match(jsre)||s.url.match(jsre))){jsonp="jsonp"+jsc++;
if(s.data){s.data=(s.data+"").replace(jsre,"="+jsonp+"$1")}s.url=s.url.replace(jsre,"="+jsonp+"$1");
s.dataType="script";window[jsonp]=function(tmp){data=tmp;success();complete();window[jsonp]=undefined;
try{delete window[jsonp]}catch(e){}if(head){head.removeChild(script)}}}if(s.dataType=="script"&&s.cache==null){s.cache=false
}if(s.cache===false&&type=="GET"){var ts=now();var ret=s.url.replace(/(\?|&)_=.*?(&|$)/,"$1_="+ts+"$2");
s.url=ret+((ret==s.url)?(s.url.match(/\?/)?"&":"?")+"_="+ts:"")}if(s.data&&type=="GET"){s.url+=(s.url.match(/\?/)?"&":"?")+s.data;
s.data=null}if(s.global&&!jQuery.active++){jQuery.event.trigger("ajaxStart")}var remote=/^(?:\w+:)?\/\/([^\/?#]+)/;
if(s.dataType=="script"&&type=="GET"&&remote.test(s.url)&&remote.exec(s.url)[1]!=location.host){var head=document.getElementsByTagName("head")[0];
var script=document.createElement("script");script.src=s.url;if(s.scriptCharset){script.charset=s.scriptCharset
}if(!jsonp){var done=false;script.onload=script.onreadystatechange=function(){if(!done&&(!this.readyState||this.readyState=="loaded"||this.readyState=="complete")){done=true;
success();complete();head.removeChild(script)}}}head.appendChild(script);return undefined
}var requestDone=false;var xhr=window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest();
if(s.username){xhr.open(type,s.url,s.async,s.username,s.password)}else{xhr.open(type,s.url,s.async)
}try{if(s.data){xhr.setRequestHeader("Content-Type",s.contentType)}if(s.ifModified){xhr.setRequestHeader("If-Modified-Since",jQuery.lastModified[s.url]||"Thu, 01 Jan 1970 00:00:00 GMT")
}xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");xhr.setRequestHeader("Accept",s.dataType&&s.accepts[s.dataType]?s.accepts[s.dataType]+", */*":s.accepts._default)
}catch(e){}if(s.beforeSend&&s.beforeSend(xhr,s)===false){s.global&&jQuery.active--;
xhr.abort();return false}if(s.global){jQuery.event.trigger("ajaxSend",[xhr,s])}var onreadystatechange=function(isTimeout){if(!requestDone&&xhr&&(xhr.readyState==4||isTimeout=="timeout")){requestDone=true;
if(ival){clearInterval(ival);ival=null}status=isTimeout=="timeout"&&"timeout"||!jQuery.httpSuccess(xhr)&&"error"||s.ifModified&&jQuery.httpNotModified(xhr,s.url)&&"notmodified"||"success";
if(status=="success"){try{data=jQuery.httpData(xhr,s.dataType,s.dataFilter)}catch(e){status="parsererror"
}}if(status=="success"){var modRes;try{modRes=xhr.getResponseHeader("Last-Modified")
}catch(e){}if(s.ifModified&&modRes){jQuery.lastModified[s.url]=modRes}if(!jsonp){success()
}}else{jQuery.handleError(s,xhr,status)}complete();if(s.async){xhr=null}}};if(s.async){var ival=setInterval(onreadystatechange,13);
if(s.timeout>0){setTimeout(function(){if(xhr){xhr.abort();if(!requestDone){onreadystatechange("timeout")
}}},s.timeout)}}try{xhr.send(s.data)}catch(e){jQuery.handleError(s,xhr,null,e)}if(!s.async){onreadystatechange()
}function success(){if(s.success){s.success(data,status)}if(s.global){jQuery.event.trigger("ajaxSuccess",[xhr,s])
}}function complete(){if(s.complete){s.complete(xhr,status)}if(s.global){jQuery.event.trigger("ajaxComplete",[xhr,s])
}if(s.global&&!--jQuery.active){jQuery.event.trigger("ajaxStop")}}return xhr},handleError:function(s,xhr,status,e){if(s.error){s.error(xhr,status,e)
}if(s.global){jQuery.event.trigger("ajaxError",[xhr,s,e])}},active:0,httpSuccess:function(xhr){try{return !xhr.status&&location.protocol=="file:"||(xhr.status>=200&&xhr.status<300)||xhr.status==304||xhr.status==1223||jQuery.browser.safari&&xhr.status==undefined
}catch(e){}return false},httpNotModified:function(xhr,url){try{var xhrRes=xhr.getResponseHeader("Last-Modified");
return xhr.status==304||xhrRes==jQuery.lastModified[url]||jQuery.browser.safari&&xhr.status==undefined
}catch(e){}return false},httpData:function(xhr,type,filter){var ct=xhr.getResponseHeader("content-type"),xml=type=="xml"||!type&&ct&&ct.indexOf("xml")>=0,data=xml?xhr.responseXML:xhr.responseText;
if(xml&&data.documentElement.tagName=="parsererror"){throw"parsererror"}if(filter){data=filter(data,type)
}if(type=="script"){jQuery.globalEval(data)}if(type=="json"){data=eval("("+data+")")
}return data},param:function(a){var s=[];if(a.constructor==Array||a.jquery){jQuery.each(a,function(){s.push(encodeURIComponent(this.name)+"="+encodeURIComponent(this.value))
})}else{for(var j in a){if(a[j]&&a[j].constructor==Array){jQuery.each(a[j],function(){s.push(encodeURIComponent(j)+"="+encodeURIComponent(this))
})}else{s.push(encodeURIComponent(j)+"="+encodeURIComponent(jQuery.isFunction(a[j])?a[j]():a[j]))
}}}return s.join("&").replace(/%20/g,"+")}});jQuery.fn.extend({show:function(speed,callback){return speed?this.animate({height:"show",width:"show",opacity:"show"},speed,callback):this.filter(":hidden").each(function(){this.style.display=this.oldblock||"";
if(jQuery.css(this,"display")=="none"){var elem=jQuery("<"+this.tagName+" />").appendTo("body");
this.style.display=elem.css("display");if(this.style.display=="none"){this.style.display="block"
}elem.remove()}}).end()},hide:function(speed,callback){return speed?this.animate({height:"hide",width:"hide",opacity:"hide"},speed,callback):this.filter(":visible").each(function(){this.oldblock=this.oldblock||jQuery.css(this,"display");
this.style.display="none"}).end()},_toggle:jQuery.fn.toggle,toggle:function(fn,fn2){return jQuery.isFunction(fn)&&jQuery.isFunction(fn2)?this._toggle.apply(this,arguments):fn?this.animate({height:"toggle",width:"toggle",opacity:"toggle"},fn,fn2):this.each(function(){jQuery(this)[jQuery(this).is(":hidden")?"show":"hide"]()
})},slideDown:function(speed,callback){return this.animate({height:"show"},speed,callback)
},slideUp:function(speed,callback){return this.animate({height:"hide"},speed,callback)
},slideToggle:function(speed,callback){return this.animate({height:"toggle"},speed,callback)
},fadeIn:function(speed,callback){return this.animate({opacity:"show"},speed,callback)
},fadeOut:function(speed,callback){return this.animate({opacity:"hide"},speed,callback)
},fadeTo:function(speed,to,callback){return this.animate({opacity:to},speed,callback)
},animate:function(prop,speed,easing,callback){var optall=jQuery.speed(speed,easing,callback);
return this[optall.queue===false?"each":"queue"](function(){if(this.nodeType!=1){return false
}var opt=jQuery.extend({},optall),p,hidden=jQuery(this).is(":hidden"),self=this;for(p in prop){if(prop[p]=="hide"&&hidden||prop[p]=="show"&&!hidden){return opt.complete.call(this)
}if(p=="height"||p=="width"){opt.display=jQuery.css(this,"display");opt.overflow=this.style.overflow
}}if(opt.overflow!=null){this.style.overflow="hidden"}opt.curAnim=jQuery.extend({},prop);
jQuery.each(prop,function(name,val){var e=new jQuery.fx(self,opt,name);if(/toggle|show|hide/.test(val)){e[val=="toggle"?hidden?"show":"hide":val](prop)
}else{var parts=val.toString().match(/^([+-]=)?([\d+-.]+)(.*)$/),start=e.cur(true)||0;
if(parts){var end=parseFloat(parts[2]),unit=parts[3]||"px";if(unit!="px"){self.style[name]=(end||1)+unit;
start=((end||1)/e.cur(true))*start;self.style[name]=start+unit}if(parts[1]){end=((parts[1]=="-="?-1:1)*end)+start
}e.custom(start,end,unit)}else{e.custom(start,val,"")}}});return true})},queue:function(type,fn){if(jQuery.isFunction(type)||(type&&type.constructor==Array)){fn=type;
type="fx"}if(!type||(typeof type=="string"&&!fn)){return queue(this[0],type)}return this.each(function(){if(fn.constructor==Array){queue(this,type,fn)
}else{queue(this,type).push(fn);if(queue(this,type).length==1){fn.call(this)}}})},stop:function(clearQueue,gotoEnd){var timers=jQuery.timers;
if(clearQueue){this.queue([])}this.each(function(){for(var i=timers.length-1;i>=0;
i--){if(timers[i].elem==this){if(gotoEnd){timers[i](true)}timers.splice(i,1)}}});
if(!gotoEnd){this.dequeue()}return this}});var queue=function(elem,type,array){if(elem){type=type||"fx";
var q=jQuery.data(elem,type+"queue");if(!q||array){q=jQuery.data(elem,type+"queue",jQuery.makeArray(array))
}}return q};jQuery.fn.dequeue=function(type){type=type||"fx";return this.each(function(){var q=queue(this,type);
q.shift();if(q.length){q[0].call(this)}})};jQuery.extend({speed:function(speed,easing,fn){var opt=speed&&speed.constructor==Object?speed:{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&easing.constructor!=Function&&easing};
opt.duration=(opt.duration&&opt.duration.constructor==Number?opt.duration:jQuery.fx.speeds[opt.duration])||jQuery.fx.speeds.def;
opt.old=opt.complete;opt.complete=function(){if(opt.queue!==false){jQuery(this).dequeue()
}if(jQuery.isFunction(opt.old)){opt.old.call(this)}};return opt},easing:{linear:function(p,n,firstNum,diff){return firstNum+diff*p
},swing:function(p,n,firstNum,diff){return((-Math.cos(p*Math.PI)/2)+0.5)*diff+firstNum
}},timers:[],timerId:null,fx:function(elem,options,prop){this.options=options;this.elem=elem;
this.prop=prop;if(!options.orig){options.orig={}}}});jQuery.fx.prototype={update:function(){if(this.options.step){this.options.step.call(this.elem,this.now,this)
}(jQuery.fx.step[this.prop]||jQuery.fx.step._default)(this);if(this.prop=="height"||this.prop=="width"){this.elem.style.display="block"
}},cur:function(force){if(this.elem[this.prop]!=null&&this.elem.style[this.prop]==null){return this.elem[this.prop]
}var r=parseFloat(jQuery.css(this.elem,this.prop,force));return r&&r>-10000?r:parseFloat(jQuery.curCSS(this.elem,this.prop))||0
},custom:function(from,to,unit){this.startTime=now();this.start=from;this.end=to;
this.unit=unit||this.unit||"px";this.now=this.start;this.pos=this.state=0;this.update();
var self=this;function t(gotoEnd){return self.step(gotoEnd)}t.elem=this.elem;jQuery.timers.push(t);
if(jQuery.timerId==null){jQuery.timerId=setInterval(function(){var timers=jQuery.timers;
for(var i=0;i<timers.length;i++){if(!timers[i]()){timers.splice(i--,1)}}if(!timers.length){clearInterval(jQuery.timerId);
jQuery.timerId=null}},13)}},show:function(){this.options.orig[this.prop]=jQuery.attr(this.elem.style,this.prop);
this.options.show=true;this.custom(0,this.cur());if(this.prop=="width"||this.prop=="height"){this.elem.style[this.prop]="1px"
}jQuery(this.elem).show()},hide:function(){this.options.orig[this.prop]=jQuery.attr(this.elem.style,this.prop);
this.options.hide=true;this.custom(this.cur(),0)},step:function(gotoEnd){var t=now();
if(gotoEnd||t>this.options.duration+this.startTime){this.now=this.end;this.pos=this.state=1;
this.update();this.options.curAnim[this.prop]=true;var done=true;for(var i in this.options.curAnim){if(this.options.curAnim[i]!==true){done=false
}}if(done){if(this.options.display!=null){this.elem.style.overflow=this.options.overflow;
this.elem.style.display=this.options.display;if(jQuery.css(this.elem,"display")=="none"){this.elem.style.display="block"
}}if(this.options.hide){this.elem.style.display="none"}if(this.options.hide||this.options.show){for(var p in this.options.curAnim){jQuery.attr(this.elem.style,p,this.options.orig[p])
}}}if(done){this.options.complete.call(this.elem)}return false}else{var n=t-this.startTime;
this.state=n/this.options.duration;this.pos=jQuery.easing[this.options.easing||(jQuery.easing.swing?"swing":"linear")](this.state,n,0,1,this.options.duration);
this.now=this.start+((this.end-this.start)*this.pos);this.update()}return true}};
jQuery.extend(jQuery.fx,{speeds:{slow:600,fast:200,def:400},step:{scrollLeft:function(fx){fx.elem.scrollLeft=fx.now
},scrollTop:function(fx){fx.elem.scrollTop=fx.now},opacity:function(fx){jQuery.attr(fx.elem.style,"opacity",fx.now)
},_default:function(fx){fx.elem.style[fx.prop]=fx.now+fx.unit}}});jQuery.fn.offset=function(){var left=0,top=0,elem=this[0],results;
if(elem){with(jQuery.browser){var parent=elem.parentNode,offsetChild=elem,offsetParent=elem.offsetParent,doc=elem.ownerDocument,safari2=safari&&parseInt(version)<522&&!/adobeair/i.test(userAgent),css=jQuery.curCSS,fixed=css(elem,"position")=="fixed";
if(elem.getBoundingClientRect){var box=elem.getBoundingClientRect();add(box.left+Math.max(doc.documentElement.scrollLeft,doc.body.scrollLeft),box.top+Math.max(doc.documentElement.scrollTop,doc.body.scrollTop));
add(-doc.documentElement.clientLeft,-doc.documentElement.clientTop)}else{add(elem.offsetLeft,elem.offsetTop);
while(offsetParent){add(offsetParent.offsetLeft,offsetParent.offsetTop);if(mozilla&&!/^t(able|d|h)$/i.test(offsetParent.tagName)||safari&&!safari2){border(offsetParent)
}if(!fixed&&css(offsetParent,"position")=="fixed"){fixed=true}offsetChild=/^body$/i.test(offsetParent.tagName)?offsetChild:offsetParent;
offsetParent=offsetParent.offsetParent}while(parent&&parent.tagName&&!/^body|html$/i.test(parent.tagName)){if(!/^inline|table.*$/i.test(css(parent,"display"))){add(-parent.scrollLeft,-parent.scrollTop)
}if(mozilla&&css(parent,"overflow")!="visible"){border(parent)}parent=parent.parentNode
}if((safari2&&(fixed||css(offsetChild,"position")=="absolute"))||(mozilla&&css(offsetChild,"position")!="absolute")){add(-doc.body.offsetLeft,-doc.body.offsetTop)
}if(fixed){add(Math.max(doc.documentElement.scrollLeft,doc.body.scrollLeft),Math.max(doc.documentElement.scrollTop,doc.body.scrollTop))
}}results={top:top,left:left}}}function border(elem){add(jQuery.curCSS(elem,"borderLeftWidth",true),jQuery.curCSS(elem,"borderTopWidth",true))
}function add(l,t){left+=parseInt(l,10)||0;top+=parseInt(t,10)||0}return results};
jQuery.fn.extend({position:function(){var left=0,top=0,results;if(this[0]){var offsetParent=this.offsetParent(),offset=this.offset(),parentOffset=/^body|html$/i.test(offsetParent[0].tagName)?{top:0,left:0}:offsetParent.offset();
offset.top-=num(this,"marginTop");offset.left-=num(this,"marginLeft");parentOffset.top+=num(offsetParent,"borderTopWidth");
parentOffset.left+=num(offsetParent,"borderLeftWidth");results={top:offset.top-parentOffset.top,left:offset.left-parentOffset.left}
}return results},offsetParent:function(){var offsetParent=this[0].offsetParent;while(offsetParent&&(!/^body|html$/i.test(offsetParent.tagName)&&jQuery.css(offsetParent,"position")=="static")){offsetParent=offsetParent.offsetParent
}return jQuery(offsetParent)}});jQuery.each(["Left","Top"],function(i,name){var method="scroll"+name;
jQuery.fn[method]=function(val){if(!this[0]){return}return val!=undefined?this.each(function(){this==window||this==document?window.scrollTo(!i?val:jQuery(window).scrollLeft(),i?val:jQuery(window).scrollTop()):this[method]=val
}):this[0]==window||this[0]==document?self[i?"pageYOffset":"pageXOffset"]||jQuery.boxModel&&document.documentElement[method]||document.body[method]:this[0][method]
}});jQuery.each(["Height","Width"],function(i,name){var tl=i?"Left":"Top",br=i?"Right":"Bottom";
jQuery.fn["inner"+name]=function(){return this[name.toLowerCase()]()+num(this,"padding"+tl)+num(this,"padding"+br)
};jQuery.fn["outer"+name]=function(margin){return this["inner"+name]()+num(this,"border"+tl+"Width")+num(this,"border"+br+"Width")+(margin?num(this,"margin"+tl)+num(this,"margin"+br):0)
}})})();var Q$=jQuery.noConflict(true);sc_require("jquery");(function(l){var h=function(){var Q;
var R=[];function N(S){if(typeof S==="string"){return"string"}else{if(typeof S==="boolean"){return"boolean"
}else{if(typeof S==="number"){if(isNaN(S)){return"nan"}else{return"number"}}else{if(typeof S==="undefined"){return"undefined"
}else{if(S===null){return"null"}else{if(S instanceof Array){return"array"}else{if(S instanceof Date){return"date"
}else{if(S instanceof RegExp){return"regexp"}else{if(typeof S==="object"){return"object"
}else{if(S instanceof Function){return"function"}}}}}}}}}}}function P(U,T,S){var V=N(U);
if(V){if(N(T[V])==="function"){return T[V].apply(T,S)}else{return T[V]}}}var O=function(){function S(T,U){return U===T
}return{string:S,"boolean":S,number:S,"null":S,"undefined":S,nan:function(T){return isNaN(T)
},date:function(T,U){return N(T)==="date"&&U.valueOf()===T.valueOf()},regexp:function(T,U){return N(T)==="regexp"&&U.source===T.source&&U.global===T.global&&U.ignoreCase===T.ignoreCase&&U.multiline===T.multiline
},"function":function(){var T=R[R.length-1];return T!==Object&&typeof T!=="undefined"
},array:function(U,V){var W;var T;if(!(N(U)==="array")){return false}T=V.length;if(T!==U.length){return false
}for(W=0;W<T;W++){if(!Q(V[W],U[W])){return false}}return true},object:function(U,V){var X;
var T=true;var W=[],Y=[];if(V.constructor!==U.constructor){return false}R.push(V.constructor);
for(X in V){W.push(X);if(!Q(V[X],U[X])){T=false}}R.pop();for(X in U){Y.push(X)}return T&&Q(W.sort(),Y.sort())
}}}();Q=function(){var S=Array.prototype.slice.apply(arguments);if(S.length<2){return true
}return(function(U,T){if(U===T){return true}else{if(typeof U!==typeof T||U===null||T===null||typeof U==="undefined"||typeof T==="undefined"){return false
}else{return P(U,O,[T,U])}}})(S[0],S[1])&&arguments.callee.apply(this,S.splice(1,S.length-1))
};return Q}();var z=l.map(location.search.slice(1).split("&"),decodeURIComponent),o=l.inArray("noglobals",z),y=o!==-1;
if(y){z.splice(o,1)}var M={stats:{all:0,bad:0},queue:[],blocking:true,filters:z,isLocal:!!(window.location.protocol=="file:")};
l.extend(window,{test:K,module:d,expect:j,ok:A,equals:s,start:m,stop:G,reset:L,synchronize:u,isLocal:M.isLocal,same:function(O,N,P){n(h(O,N),O,N,P)
},QUnit:{equiv:h},isSet:I,isObj:H,compare:function(){throw"compare is deprecated - use same() instead"
},compare2:function(){throw"compare2 is deprecated - use same() instead"},serialArray:function(){throw"serialArray is deprecated - use jsDump.parse() instead"
},q:E,t:B,url:k,triggerEvent:g});l(window).load(function(){});function u(N){M.queue.push(N);
if(!M.blocking){F()}}function F(){window.config=M;while(M.queue.length&&!M.blocking){M.queue.shift()()
}}function G(N){M.blocking=true;if(N){M.timeout=setTimeout(function(){A(false,"Test timed out");
m()},N)}}function m(){setTimeout(function(){if(M.timeout){clearTimeout(M.timeout)
}M.blocking=false;F()},13)}function p(N){var O=M.filters.length,R=false;if(!O){return true
}while(O--){var P=M.filters[O],Q=P.charAt(0)=="!";if(Q){P=P.slice(1)}if(N.indexOf(P)!=-1){return !Q
}if(Q){R=true}}return R}function x(){M.blocking=false;var N=+new Date;M.ajaxSettings=l.ajaxSettings;
u(function(){l('<p id="testresult" class="result"/>').html(["Tests completed in ",+new Date-N," milliseconds.<br/>",'<span class="bad">',M.stats.bad,'</span> tests of <span class="all">',M.stats.all,"</span> failed."].join("")).appendTo("#qunit");
l("#banner").addClass(M.stats.bad?"fail":"pass")})}var e;function J(){e=[];if(y){for(var N in window){e.push(N)
}}}function D(O){var N=e;J();if(e.length>N.length){A(false,"Introduced global variable(s): "+C(N,e).join(", "));
M.expected++}}function C(N,O){return l.grep(O,function(P){return l.inArray(P,N)==-1
})}function K(O,P){if(M.currentModule){O=M.currentModule+" module: "+O}var N=l.extend({setup:function(){},teardown:function(){}},M.moduleLifecycle);
if(!p(O)){return}u(function(){var Q=document.getElementById("main");M.fixture=Q?Q.innerHTML:"";
Q=null;M.assertions=[];M.expected=null;try{if(!e){J()}N.setup()}catch(R){M.assertions.push({result:false,message:"Setup failed on "+O+": "+R.message})
}});u(function(){try{P()}catch(Q){if(typeof console!="undefined"&&console.error&&console.warn){console.error("Test "+O+" died, exception and test follows");
console.error(Q);console.warn(P.toString())}M.assertions.push({result:false,message:"Died on test #"+(M.assertions.length+1)+": "+Q.message});
J()}});u(function(){try{D();N.teardown()}catch(Q){M.assertions.push({result:false,message:"Teardown failed on "+O+": "+Q.message})
}});u(function(){try{L()}catch(V){if(typeof console!="undefined"&&console.error&&console.warn){console.error("reset() failed, following Test "+O+", exception and reset fn follows");
console.error(V);console.warn(L.toString())}}if(M.expected&&M.expected!=M.assertions.length){M.assertions.push({result:false,message:"Expected "+M.expected+" assertions, but "+M.assertions.length+" were run"})
}var U=0,W=0;var S=l("<ol/>").hide();M.stats.all+=M.assertions.length;for(var T=0;
T<M.assertions.length;T++){var R=M.assertions[T];l("<li/>").addClass(R.result?"pass":"fail").text(R.message||"(no message)").appendTo(S);
R.result?U++:W++}M.stats.bad+=W;var Q=l("<strong/>").html(O+" <b style='color:black;'>(<b class='fail'>"+W+"</b>, <b class='pass'>"+U+"</b>, "+M.assertions.length+")</b>").click(function(){l(this).next().toggle()
}).dblclick(function(X){var Y=l(X.target).filter("strong").clone();if(Y.length){Y.children().remove();
location.href=location.href.match(/^(.+?)(\?.*)?$/)[1]+"?"+encodeURIComponent(l.trim(Y.text()))
}});l("<li/>").addClass(W?"fail":"pass").append(Q).append(S).appendTo("#tests");if(W){l("#filter").attr("disabled",null)
}})}function d(O,N){M.currentModule=O;M.moduleLifecycle=N}function j(N){M.expected=N
}function L(){l("#main").html(M.fixture);l.event.global={};l.ajaxSettings=l.extend({},M.ajaxSettings)
}function A(N,O){M.assertions.push({result:!!N,message:O})}function I(O,N,S){function R(T){var V=[];
if(T&&T.length){for(var U=0;U<T.length;U++){var W=T[U].nodeName;if(W){W=W.toLowerCase();
if(T[U].id){W+="#"+T[U].id}}else{W=T[U]}V.push(W)}}return"[ "+V.join(", ")+" ]"}var P=true;
if(O&&N&&O.length!=undefined&&O.length==N.length){for(var Q=0;Q<O.length;Q++){if(O[Q]!=N[Q]){P=false
}}}else{P=false}window.ok(P,O,N,S)}function H(O,N,R){var P=true;if(O&&N){for(var Q in O){if(O[Q]!=N[Q]){P=false
}}for(Q in N){if(O[Q]!=N[Q]){P=false}}}else{P=false}M.assertions.push({result:P,message:R})
}function E(){var O=[];for(var N=0;N<arguments.length;N++){O.push(document.getElementById(arguments[N]))
}return O}function B(U,S,R){var P=l(S);var V="";for(var O=0;O<P.length;O++){V+=(V&&",")+'"'+P[O].id+'"'
}var N=U,T=S;var Q=true;U=P;S=E.apply(E,R);if(U&&S&&U.length!=undefined&&U.length==S.length){for(var O=0;
O<U.length;O++){if(U[O]!=S[O]){Q=false}}}else{Q=false}window.ok(Q,U,S,N+" ("+T+")")
}function k(N){return N+(/\?/.test(N)?"&":"?")+new Date().getTime()+""+parseInt(Math.random()*100000)
}function s(P,O,N){n(O==P,P,O,N)}function n(N,Q,P,O){O=O||(N?"okay":"failed");M.assertions.push({result:N,message:N?O+": "+jsDump.parse(P):O+", expected: "+jsDump.parse(P)+" result: "+jsDump.parse(Q)})
}function g(P,N,O){if(l.browser.mozilla||l.browser.opera){O=document.createEvent("MouseEvents");
O.initMouseEvent(N,true,true,P.ownerDocument.defaultView,0,0,0,0,0,false,false,false,false,0,null);
P.dispatchEvent(O)}else{if(l.browser.msie){P.fireEvent("on"+N)}}}})(Q$);(function(){function d(l){return'"'+l.toString().replace(/"/g,'\\"')+'"'
}function e(l){return l+""}function h(p,l,m){var n=g.separator(),o=g.indent();inner=g.indent(1);
if(l.join){l=l.join(","+n+inner)}if(!l){return p+m}return[p,inner+l,o+m].join(n)}function k(l){var n=l.length,m=Array(n);
this.up();while(n--){m[n]=this.parse(l[n])}this.down();return h("[",m,"]")}var j=/^function (\w+)/;
var g=window.jsDump={parse:function(m,l){var n=this.parsers[l||this.typeOf(m)];l=typeof n;
return l=="function"?n.call(this,m):l=="string"?n:this.parsers.error},typeOf:function(n){var l=typeof n,m="function";
if(n&&(n.isObject||n.isClass)){return"scobj"}return l!="object"&&l!=m?l:!n?"null":n.exec?"regexp":n.getHours?"date":n.scrollBy?"window":n.nodeName=="#document"?"document":n.nodeName?"node":n.item?"nodelist":n.callee?"arguments":n.call||n.constructor!=Array&&(n+"").indexOf(m)!=-1?m:"length" in n?"array":l
},separator:function(){return this.multiline?this.HTML?"<br />":"\n":this.HTML?"&nbsp;":" "
},indent:function(l){if(!this.multiline){return""}var m=this.indentChar;if(this.HTML){m=m.replace(/\t/g,"   ").replace(/ /g,"&nbsp;")
}return Array(this._depth_+(l||0)).join(m)},up:function(l){this._depth_+=l||1},down:function(l){this._depth_-=l||1
},setParser:function(l,m){this.parsers[l]=m},quote:d,literal:e,join:h,_depth_:1,parsers:{window:"[Window]",document:"[Document]",error:"[ERROR]",unknown:"[Unknown]","null":"null",undefined:"undefined","function":function(n){var m="function",l="name" in n?n.name:(j.exec(n)||[])[1];
if(l){m+=" "+l}m+="(";m=[m,this.parse(n,"functionArgs"),"){"].join("");return h(m,this.parse(n,"functionCode"),"}")
},array:k,nodelist:k,arguments:k,scobj:function(l){return l.toString()},object:function(n){var l=[];
this.up();for(var m in n){l.push(this.parse(m,"key")+": "+this.parse(n[m]))}this.down();
return h("{",l,"}")},node:function(p){var o=this.HTML?"&lt;":"<",u=this.HTML?"&gt;":">";
var l=p.nodeName.toLowerCase(),n=o+l;for(var m in this.DOMAttrs){var s=p[this.DOMAttrs[m]];
if(s){n+=" "+m+"="+this.parse(s,"attribute")}}return n+u+o+"/"+l+u},functionArgs:function(o){var m=o.length;
if(!m){return""}var n=Array(m);while(m--){n[m]=String.fromCharCode(97+m)}return" "+n.join(", ")+" "
},key:d,functionCode:"[code]",attribute:d,string:d,date:d,regexp:e,number:e,"boolean":e},DOMAttrs:{id:"id",name:"name","class":"className"},HTML:false,indentChar:"   ",multiline:true}
})();(function(){var l,j;function d(m){return'"'+m.toString().replace(/"/g,'\\"')+'"'
}function e(m){return m+""}function h(x,m,o){var p=j.separator(),u=j.indent(),n=j.indent(1);
if(m.join){m=m.join(","+p+n)}if(!m){return x+o}return[x,n+m,u+o].join(p)}function k(m){var o=m.length,n=new Array(o);
this.up();while(o--){n[o]=this._parse(m[o])}this.down();return h("[",n,"]")}l=/^function (\w+)/;
j=CoreTest.jsDump={parse:function(p,n){if(p&&p.toString){var o=p.toString;if((o!==Object.prototype.toString)&&(o!==Array.toString)){return p.toString()
}}if(p&&p.inspect){return p.inspect()}this.seen=[];var m=this._parse(p,n);this.seen=null;
return m},_parse:function(n,m){var o=this.parsers[m||this.typeOf(n)];m=typeof o;if((o===this.parsers.object)&&(this.seen.indexOf(n)>=0)){return"(recursive)"
}this.seen.push(n);return m=="function"?o.call(this,n):m=="string"?o:this.parsers.error
},typeOf:function(o){var m=typeof o,n="function";if(o&&(o.isObject||o.isClass)){return"scobj"
}return m!="object"&&m!=n?m:!o?"null":o.exec?"regexp":o.getHours?"date":o.scrollBy?"window":o.nodeName=="#document"?"document":o.nodeName?"node":o.item?"nodelist":o.callee?"arguments":o.call||o.constructor!=Array&&(o+"").indexOf(n)!=-1?n:"length" in o?"array":m
},separator:function(){return this.multiline?this.HTML?"<br />":"\n":this.HTML?"&nbsp;":" "
},indent:function(m){if(!this.multiline){return""}var n=this.indentChar;if(this.HTML){n=n.replace(/\t/g,"   ").replace(/ /g,"&nbsp;")
}return(new Array(this._depth_+(m||0))).join(n)},up:function(m){this._depth_+=m||1
},down:function(m){this._depth_-=m||1},setParser:function(m,n){this.parsers[m]=n},quote:d,literal:e,join:h,_depth_:1,parsers:{window:"[Window]",document:"[Document]",error:"[ERROR]",unknown:"[Unknown]","null":"null","undefined":"undefined","function":function(o){var n="function",m="name" in o?o.name:(l.exec(o)||[])[1];
if(m){n+=" "+m}n+="(";n=[n,this._parse(o,"functionArgs"),"){"].join("");return h(n,this._parse(o,"functionCode"),"}")
},array:k,nodelist:k,"arguments":k,scobj:function(m){return m.toString()},object:function(o){var m=[];
this.up();for(var n in o){m.push(this._parse(n,"key")+": "+this._parse(o[n]))}this.down();
return h("{",m,"}")},node:function(s){var p=this.HTML?"&lt;":"<",x=this.HTML?"&gt;":">";
var m=s.nodeName.toLowerCase(),o=p+m;for(var n in this.DOMAttrs){var u=s[this.DOMAttrs[n]];
if(u){o+=" "+n+"="+this._parse(u,"attribute")}}return o+x+p+"/"+m+x},functionArgs:function(o){var m=o.length;
if(!m){return""}var n=new Array(m);while(m--){n[m]=String.fromCharCode(97+m)}return" "+n.join(", ")+" "
},key:d,functionCode:"[code]",attribute:d,string:d,date:d,regexp:e,number:e,"boolean":e},DOMAttrs:{id:"id",name:"name","class":"className"},HTML:true,indentChar:"   ",multiline:true};
CoreTest.dump=function g(n,m){return CoreTest.jsDump.parse(n,m)}})();CoreTest.equiv=function(){var h;
var j=[];function d(k){if(typeof k==="string"){return"string"}else{if(typeof k==="boolean"){return"boolean"
}else{if(typeof k==="number"){if(isNaN(k)){return"nan"}else{return"number"}}else{if(typeof k==="undefined"){return"undefined"
}else{if(k===null){return"null"}else{if(k instanceof Array){return"array"}else{if(k instanceof Date){return"date"
}else{if(k instanceof RegExp){return"regexp"}else{if(typeof k==="object"){return"object"
}else{if(k instanceof Function){return"function"}}}}}}}}}}}function g(m,l,k){var n=d(m);
if(n){if(d(l[n])==="function"){return l[n].apply(l,k)}else{return l[n]}}}var e=function(){function k(l,m){return m===l
}return{string:k,"boolean":k,number:k,"null":k,"undefined":k,nan:function(l){return isNaN(l)
},date:function(l,m){return d(l)==="date"&&m.valueOf()===l.valueOf()},regexp:function(l,m){return d(l)==="regexp"&&m.source===l.source&&m.global===l.global&&m.ignoreCase===l.ignoreCase&&m.multiline===l.multiline
},"function":function(){var l=j[j.length-1];return l!==Object&&typeof l!=="undefined"
},array:function(m,n){var o;var l;if(!(d(m)==="array")){return false}l=n.length;if(l!==m.length){return false
}for(o=0;o<l;o++){if(!h(n[o],m[o])){return false}}return true},object:function(m,n){var p;
var l=true;var o=[],s=[];if(m===n){return true}if(n.constructor!==m.constructor){return false
}j.push(n.constructor);for(p in n){o.push(p);if(!h(n[p],m[p])){l=false}}j.pop();for(p in m){s.push(p)
}return l&&h(o.sort(),s.sort())}}}();h=function(){var k=Array.prototype.slice.apply(arguments);
if(k.length<2){return true}return(function(m,l){if(m===l){return true}else{if(typeof m!==typeof l||m===null||l===null||typeof m==="undefined"||typeof l==="undefined"){return false
}else{if(l&&l.isEqual&&l.isEqual instanceof Function){return l.isEqual(m)}else{return g(m,e,[l,m])
}}}})(k[0],k[1])&&arguments.callee.apply(this,k.splice(1,k.length-1))};return h}();
sc_require("jquery");CoreTest.Plan={create:function(h){var e=arguments.length,g=CoreTest.beget(this),d;
for(d=0;d<e;d++){CoreTest.mixin(g,h)}g.queue=g.queue.slice();return g},queue:[],isRunning:false,synchronize:function synchronize(d){this.queue.push(d);
if(this.isRunning){this.process()}return this},process:function process(){while(this.queue.length&&this.isRunning){this.queue.shift().call(this)
}return this},start:function(){var d=this;setTimeout(function(){if(d.timeout){clearTimeout(d.timeout)
}d.timeout=null;d.isRunning=true;d.process()},13);return this},stop:function(d){this.isRunning=false;
if(this.timeout){clearTimeout(this.timeout)}if(d){var e=this;this.timeout=setTimeout(function(){e.fail("Test timed out").start()
},d)}else{this.timeout=null}return this},pause:function(){if(this.isRunning){var d=this.delegate;
if(d&&d.planDidPause){d.planDidPause(this)}this.isRunning=false;this.start()}return this
},run:function(){this.isRunning=true;this.prepare();this.results={start:new Date().getTime(),finish:null,runtime:0,tests:0,total:0,passed:0,failed:0,errors:0,warnings:0,assertions:[]};
this.begin().synchronize(this.finish).process();return this},begin:function(){var d=this.delegate;
if(d&&d.planDidBegin){d.planDidBegin(this)}return this},finish:function(){var e=this.results,d=this.delegate;
e.finish=new Date().getTime();e.runtime=e.finish-e.start;if(d&&d.planDidFinish){d.planDidFinish(this,e)
}return this},module:function(e,d){if(typeof SC!=="undefined"&&SC.filename){e=SC.filename.replace(/^.+?\/current\/tests\//,"")+"\n"+e
}this.currentModule=e;if(!d){d={}}this.setup(d.setup).teardown(d.teardown);return this
},setup:function(d){this.currentSetup=d||CoreTest.K;return this},teardown:function teardown(d){this.currentTeardown=d||CoreTest.K;
return this},now:function(){return new Date().getTime()},test:function test(l,j){if(!this.enabled(this.currentModule,l)){return this
}var e={module:this.currentModule,test:l,expected:0,assertions:[]};var k;var g=l;
if(this.currentModule){g=this.currentModule+" module: "+g}var d=this.currentSetup||CoreTest.K;
var h=this.currentTeardown||CoreTest.K;this.synchronize(function(){var m=document.getElementById("main");
this.fixture=m?m.innerHTML:"";m=null;this.working=e;try{e.total_begin=e.setup_begin=this.now();
d.call(this);e.setup_end=this.now()}catch(n){k=(n&&n.toString)?n.toString():"(unknown error)";
this.error("Setup exception on "+g+": "+k)}});this.synchronize(function(){if(!j){this.warn("Test not yet implemented: "+g)
}else{try{if(CoreTest.trace){console.log("run: "+g)}this.working.test_begin=this.now();
j.call(this);this.working.test_end=this.now()}catch(m){k=(m&&m.toString)?m.toString():"(unknown error)";
this.error("Died on test #"+(this.working.assertions.length+1)+": "+k)}}});this.synchronize(function(){try{this.working.teardown_begin=this.now();
h.call(this);this.working.teardown_end=this.now()}catch(m){k=(m&&m.toString)?m.toString():"(unknown error)";
this.error("Teardown exception on "+g+": "+k)}});this.synchronize(function(){if(this.reset){try{this.working.reset_begin=this.now();
this.reset();this.working.total_end=this.working.reset_end=this.now()}catch(p){k=(p&&p.toString)?p.toString():"(unknown error)";
this.error("Reset exception on "+g+": "+k)}}var n=this.working,s=n.expected,m=n.assertions.length;
if(s&&s!==m){this.fail("Expected "+s+" assertions, but "+m+" were run")}this.working=null;
this.record(n.module,n.test,n.assertions,n);if(!this.pauseTime){this.pauseTime=new Date().getTime()
}else{var o=new Date().getTime();if((o-this.pauseTime)>250){this.pause();this.pauseTime=o
}}})},htmlbody:function htmlbody(d){this.synchronize(function(){var g=Q$(d);var e=Q$("body")[0];
var h=Q$("body #htmlbody-begin")[0];if(!h){h=Q$('<div id="htmlbody-begin"></div>')[0];
e.appendChild(h)}else{while(h.nextSibling){e.removeChild(h.nextSibling)}}h=null;g.each(function(){e.appendChild(this)
})})},record:function(e,j,n,g){var d=this.results,h=n.length,m=this.delegate,k,l;
d.tests++;for(k=0;k<h;k++){l=n[k];l.module=e;l.test=j;d.total++;d[l.result]++;d.assertions.push(l)
}if(m&&m.planDidRecord){m.planDidRecord(this,e,j,n,g)}},reset:function(){if(this.fixture){var d=document.getElementById("main");
if(d){d.innerHTML=this.fixture}d=null}return this},enabled:function(e,d){return true
},pass:function(e){var d=this.working;if(!d){throw"pass("+e+") called outside of a working test"
}d.assertions.push({message:e,result:CoreTest.OK});return this},fail:function(e){var d=this.working;
if(!d){throw"fail("+e+") called outside of a working test"}d.assertions.push({message:e,result:CoreTest.FAIL});
return this},warn:function(e){var d=this.working;if(!d){throw"warn("+e+") called outside of a working test"
}d.assertions.push({message:e,result:CoreTest.WARN});return this},error:function(h,g){var d=this.working;
if(!d){throw"error("+h+") called outside of a working test"}if(g&&typeof console!="undefined"&&console.error&&console.warn){console.error(h);
console.error(g)}d.assertions.push({message:h,result:CoreTest.ERROR});return this
},fn:{ok:function ok(e,h,d,g){if(g===undefined){g=h;if(!g){g=e?"OK":"failed"}}else{if(!g){g=e?"OK":"failed"
}if(e){g=g+": "+CoreTest.dump(d)}else{g=g+", expected: "+CoreTest.dump(d)+" result: "+CoreTest.dump(h)
}}return !!e?this.pass(g):this.fail(g)},equals:function equals(g,d,e){if(e===undefined){e=null
}return this.ok(g==d,g,d,e)},should_throw:function should_throw(k,d,h){var j=false;
try{k()}catch(g){j=(typeof d==="string")?g.message:g}if(d===false){ok(j===false,CoreTest.fmt("%@ expected no exception, actual %@",h,j))
}else{if(d===Error||d===null||d===true){ok(!!j,CoreTest.fmt("%@ expected exception, actual %@",h,j))
}else{equals(j,d,h)}}},expect:function expect(d){this.working.expected=d},same:function(g,d,e){if(e===undefined){e=null
}return this.ok(CoreTest.equiv(g,d),g,d,e)},stop:function(d){return this.stop(d)},start:function(){return this.start()
},reset:function(){return this.reset()}},prepare:function(){var e=this.fn,h=this,d,g;
for(d in e){if(!e.hasOwnProperty(d)){continue}g=e[d];if(typeof g!=="function"){continue
}window[d]=this._bind(g);if(!h[d]){h[d]=g}}return this},_bind:function(d){var e=this;
return function(){return d.apply(e,arguments)}}};CoreTest.defaultPlan=function defaultPlan(){var d=CoreTest.plan;
if(!d){CoreTest.runner=CoreTest.Runner.create();d=CoreTest.plan=CoreTest.runner.plan
}return d};window.module=function(e,d){CoreTest.defaultPlan().module(e,d)};window.test=function(e,d){CoreTest.defaultPlan().test(e,d)
};window.htmlbody=function(d){CoreTest.defaultPlan().htmlbody(d)};sc_require("jquery");
sc_require("system/plan");CoreTest.Runner={plan:null,errors:null,create:function(){var e=arguments.length,g=CoreTest.beget(this),d;
for(d=0;d<e;d++){CoreTest.mixin(g,arguments[e])}if(!g.plan){g.plan=CoreTest.Plan.create({delegate:g})
}Q$(window).load(function(){g.begin()});return g},begin:function(){var d=CoreTest.plan;
d.delegate=this;d.run()},planDidBegin:function(e){this.report=Q$(['<div class="core-test">','<div class="useragent">UserAgent</div>','<div class="testresult">','<label class="hide-passed">','<input type="checkbox" checked="checked" /> Hide passed tests',"</label>",'<span class="status">Running...</span>',"</div>",'<div class="detail">',"<table>","<thead><tr>",'<th class="desc">Test</th><th>Result</th>',"</tr></thead>","<tbody><tr></tr></tbody>","</table>","</div>","</div>"].join(""));
this.report.find(".useragent").html(navigator.userAgent);this.logq=this.report.find("tbody");
this.testCount=0;var d=this;this.checkbox=this.report.find(".hide-passed input");
this.checkbox.change(function(){d.hidePassedTestsDidChange()});Q$("body").append(this.report)
},hidePassedTestsDidChange:function(){var d=!!this.checkbox.val();if(d){this.logq.addClass("hide-clean")
}else{this.logq.removeClass("hide-clean")}},planDidFinish:function(g,e){this.flush();
var d=this.report.find(".testresult .status");var h=CoreTest.fmt('<span>Completed %@ tests in %@ msec. </span><span class="total">%@</span> total assertions: ',e.tests,e.runtime,e.total);
if(e.passed>0){h+=CoreTest.fmt('&nbsp;<span class="passed">%@ passed</span>',e.passed)
}if(e.failed>0){h+=CoreTest.fmt('&nbsp;<span class="failed">%@ failed</span>',e.failed)
}if(e.errors>0){h+=CoreTest.fmt('&nbsp;<span class="errors">%@ error%@</span>',e.errors,(e.errors!==1?"s":""))
}if(e.warnings>0){h+=CoreTest.fmt('&nbsp;<span class="warnings">%@ warnings%@</span>',e.warnings,(e.warnings!==1?"s":""))
}if(this.errors){this.errors.push("</tr></tbody></table>")}if((e.failed+e.errors+e.warnings)>0){this.hidePassedTestsDidChange()
}else{this.report.find(".hide-passed").addClass("disabled").find("input").attr("disabled",true);
if(this.errors){this.errors.length=0}}if(CoreTest.showUI){Q$(".core-test").css("right","360px")
}d.html(h);if(this.errors){CoreTest.errors=this.errors.join("")}},planDidRecord:function(n,g,m,x,j){var e=m,y={passed:0,failed:0,errors:0,warnings:0},k=x.length,l="",p,u,d;
for(p=0;p<k;p++){y[x[p].result]++}if((y.failed+y.errors+y.warnings)===0){l="clean"
}if(g){e=g.replace(/\n/g,"<br />")+" module: "+m}e=CoreTest.fmt("%@ - %@msec",e,j.total_end-j.total_begin);
var h=this.logstr;var o=this.errors;if(!h){h=this.logstr=[]}if(!this.errors){this.errors=['<style type="text/css">* {font: 12px arial;}.passed { background-color: #80D175; color: white;}.failed { background-color: #ea4d4; color: black; }.errors { background-color: red; color: black; }.warnings { background-color: #E49723; color: black;}.desc { text-align: left;}</style><table style="border:1px solid"><thead><tr><th class="desc">'+navigator.userAgent+"</th><th>Result</th></tr></thead><tbody><tr>"]
}h.push(CoreTest.fmt('<tr class="test %@"><th class="desc" colspan="2">%@ (<span class="passed">%@</span>, <span class="failed">%@</span>, <span class="errors">%@</span>, <span class="warnings">%@</span>)</th></tr>',l,e,y.passed,y.failed,y.errors,y.warnings));
if(y.failed>0||y.errors>0){this.errors.push(CoreTest.fmt('<tr class="test %@"><th style="background:grey; color:white" class="desc" colspan="2">%@ (<span class="passed">%@</span>, <span class="failed">%@</span>, <span class="errors">%@</span>, <span class="warnings">%@</span>)</th></tr>',l,e,y.passed,y.failed,y.errors,y.warnings))
}k=x.length;for(p=0;p<k;p++){u=x[p];l=u.result===CoreTest.OK?"clean":"dirty";h.push(CoreTest.fmt('<tr class="%@"><td class="desc">%@</td><td class="action %@">%@</td></tr>',l,u.message,u.result,(u.result||"").toUpperCase()));
if(l=="dirty"){this.errors.push(CoreTest.fmt('<tr class="%@"><td class="desc">%@</td><td class="action %@">%@</td></tr>',l,u.message,u.result,(u.result||"").toUpperCase()))
}}this.testCount++;this.resultStr=CoreTest.fmt("Running – Completed %@ tests so far.",this.testCount)
},planDidPause:function(d){if(navigator.userAgent.indexOf("MSIE")==-1){this.flush()
}},flush:function(){var g=this.logstr,e=this.resultStr,d=this.report.find(".testresult .status");
if(g){this.logq.append(this.logstr.join(""))}if(e){d.html(e)}this.resultStr=this.logstr=null
}};CoreTest.Suite={create:function(j,h){var e=arguments.length,g=CoreTest.beget(this),d;
for(d=1;d<e;d++){CoreTest.mixin(g,arguments[d])}if(j){g.basedesc=j}g.definitions=g.definitions.slice();
return g},generate:function(k,j){var g=arguments.length,h=CoreTest.beget(this),e,d;
for(e=1;e<g;e++){CoreTest.mixin(h,arguments[e])}h.subdesc=k;d=h.definitions;g=d.length;
for(e=0;e<g;e++){d[e].call(h,h)}return h},define:function(d){this.definitions.push(d);
return this},definitions:[],desc:function(d){return this.basedesc.fmt(this.subdesc,d)
},basedesc:"%@ > %@",setup:function(){this.object=this.newObject()},teardown:function(){if(this.object){this.destroyObject(this.object)
}this.object=null},newObject:function(){return null},destroyObject:function(d){},module:function(e){var d=this;
module(d.desc(e),{setup:function(){d.setup()},teardown:function(){d.teardown()}})
}};if(!String.prototype.camelize){String.prototype.camelize=function camelize(){var e=this.replace(SC.STRING_TITLEIZE_REGEXP,function(j,k,h){return(h)?h.toUpperCase():""
});var g=e.charAt(0),d=g.toLowerCase();return(g!==d)?(d+e.slice(1)):e}}if(!String.prototype.trim){String.prototype.trim=function trim(){return this.replace(/^\s+|\s+$/g,"")
}}if(!String.prototype.fmt){String.prototype.fmt=function fmt(){var e=arguments;var d=0;
return this.replace(/%@([0-9]+)?/g,function(g,h){h=(h)?parseInt(h,0)-1:d++;g=e[h];
return((g===null)?"(null)":(g===undefined)?"":g).toString()})}}if(!Array.prototype.uniq){Array.prototype.uniq=function uniq(){var g=[],e=this.length,h,d;
for(d=0;d<e;d++){h=this[d];if(g.indexOf(h)<0){g.push(h)}}return g}}if(!String.prototype.w){String.prototype.w=function w(){var g=[],h=this.split(" "),e=h.length;
for(var d=0;d<e;++d){var j=h[d];if(j.length!==0){g.push(j)}}return g}}require("views/designer_drop_target");
require("views/page_item_view");SC.designPage=SC.Page.create({designMainPane:SC.MainPane.design({classNames:["workspace"],childViews:"rotated container viewList".w(),container:SC.DesignerDropTarget.design({layout:{top:20,left:20,right:20,bottom:83},classNames:["design"],contentViewBinding:SC.Binding.transform(function(d,e){return d&&d.kindOf&&d.kindOf(SC.View)?d:null
}).from("SC.designController.view")}),rotated:SC.View.design({layout:{top:20,left:20,right:20,bottom:83},classNames:["rotated-page"]}),viewList:SC.ScrollView.design({layout:{left:0,right:0,bottom:0,height:63},classNames:["dock"],hasBorder:NO,hasVerticalScroller:NO,contentView:SC.GridView.design({contentIconKey:"type",exampleView:SC.pageItemView,rowHeight:63,columnWidth:100,hasContentIcon:YES,delegate:SC.designsController,selectionBinding:"SC.designsController.selection",contentValueKey:"name",isDropTarget:YES,canEditContent:YES,canReorderContent:YES,canDeleteContent:YES,actOnSelect:YES,targetIsInIFrame:YES,target:"SC.designController",action:"viewSelected"})})})});
require("panes/pane");SC.MainPane=SC.Pane.extend({layout:{left:0,right:0,top:0,bottom:0},paneDidAttach:function(){var e=arguments.callee.base.apply(this,arguments);
var d=this.rootResponder;d.makeMainPane(this);if(!d.get("keyRootView")){d.makeKeyPane(this)
}return e},acceptsKeyPane:YES,classNames:["sc-main"]});if((typeof SC!=="undefined")&&SC&&SC.bundleDidLoad){SC.bundleDidLoad("frameworks")
};